# Comparing `tmp/hivemind_bus_client-0.0.4a8-py3-none-any.whl.zip` & `tmp/hivemind_bus_client-0.0.4a9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,19 +1,19 @@
-Zip file size: 24096 bytes, number of entries: 17
--rw-r--r--  2.0 unx       91 b- defN 23-Sep-12 14:42 hivemind_bus_client/__init__.py
--rw-r--r--  2.0 unx    15171 b- defN 23-Sep-12 14:42 hivemind_bus_client/client.py
--rw-r--r--  2.0 unx     5980 b- defN 23-Sep-12 14:42 hivemind_bus_client/decorators.py
--rw-r--r--  2.0 unx      835 b- defN 23-Sep-12 14:42 hivemind_bus_client/exceptions.py
--rw-r--r--  2.0 unx     1735 b- defN 23-Sep-12 14:42 hivemind_bus_client/identity.py
--rw-r--r--  2.0 unx     6117 b- defN 23-Sep-12 14:42 hivemind_bus_client/message.py
--rw-r--r--  2.0 unx     9627 b- defN 23-Sep-12 14:42 hivemind_bus_client/protocol.py
--rw-r--r--  2.0 unx     3993 b- defN 23-Sep-12 14:42 hivemind_bus_client/scripts.py
--rw-r--r--  2.0 unx     9302 b- defN 23-Sep-12 14:42 hivemind_bus_client/serialization.py
--rw-r--r--  2.0 unx     5577 b- defN 23-Sep-12 14:42 hivemind_bus_client/util.py
--rw-r--r--  2.0 unx      177 b- defN 23-Sep-12 14:42 hivemind_bus_client/version.py
--rw-r--r--  2.0 unx    11358 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/LICENSE.md
--rw-r--r--  2.0 unx     3526 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/WHEEL
--rw-r--r--  2.0 unx       79 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       20 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1534 b- defN 23-Sep-12 14:42 hivemind_bus_client-0.0.4a8.dist-info/RECORD
-17 files, 75214 bytes uncompressed, 21528 bytes compressed:  71.4%
+Zip file size: 24755 bytes, number of entries: 17
+-rw-r--r--  2.0 unx       91 b- defN 23-Sep-14 20:32 hivemind_bus_client/__init__.py
+-rw-r--r--  2.0 unx    16232 b- defN 23-Sep-14 20:32 hivemind_bus_client/client.py
+-rw-r--r--  2.0 unx     5980 b- defN 23-Sep-14 20:32 hivemind_bus_client/decorators.py
+-rw-r--r--  2.0 unx      835 b- defN 23-Sep-14 20:32 hivemind_bus_client/exceptions.py
+-rw-r--r--  2.0 unx     2110 b- defN 23-Sep-14 20:32 hivemind_bus_client/identity.py
+-rw-r--r--  2.0 unx     6117 b- defN 23-Sep-14 20:32 hivemind_bus_client/message.py
+-rw-r--r--  2.0 unx     9627 b- defN 23-Sep-14 20:32 hivemind_bus_client/protocol.py
+-rw-r--r--  2.0 unx     5387 b- defN 23-Sep-14 20:32 hivemind_bus_client/scripts.py
+-rw-r--r--  2.0 unx     9302 b- defN 23-Sep-14 20:32 hivemind_bus_client/serialization.py
+-rw-r--r--  2.0 unx     5577 b- defN 23-Sep-14 20:32 hivemind_bus_client/util.py
+-rw-r--r--  2.0 unx      177 b- defN 23-Sep-14 20:32 hivemind_bus_client/version.py
+-rw-r--r--  2.0 unx    11358 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/LICENSE.md
+-rw-r--r--  2.0 unx     3844 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/WHEEL
+-rw-r--r--  2.0 unx       79 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       20 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1534 b- defN 23-Sep-14 20:32 hivemind_bus_client-0.0.4a9.dist-info/RECORD
+17 files, 78362 bytes uncompressed, 22187 bytes compressed:  71.7%
```

## zipnote {}

```diff
@@ -27,26 +27,26 @@
 
 Filename: hivemind_bus_client/util.py
 Comment: 
 
 Filename: hivemind_bus_client/version.py
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/LICENSE.md
+Filename: hivemind_bus_client-0.0.4a9.dist-info/LICENSE.md
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/METADATA
+Filename: hivemind_bus_client-0.0.4a9.dist-info/METADATA
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/WHEEL
+Filename: hivemind_bus_client-0.0.4a9.dist-info/WHEEL
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/entry_points.txt
+Filename: hivemind_bus_client-0.0.4a9.dist-info/entry_points.txt
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/top_level.txt
+Filename: hivemind_bus_client-0.0.4a9.dist-info/top_level.txt
 Comment: 
 
-Filename: hivemind_bus_client-0.0.4a8.dist-info/RECORD
+Filename: hivemind_bus_client-0.0.4a9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## hivemind_bus_client/client.py

```diff
@@ -7,14 +7,15 @@
 from ovos_bus_client import Message as MycroftMessage, MessageBusClient as OVOSBusClient
 from ovos_utils.log import LOG
 from ovos_utils.messagebus import FakeBus
 from pyee import EventEmitter
 from websocket import ABNF
 from websocket import WebSocketApp, WebSocketConnectionClosedException
 
+from hivemind_bus_client.identity import NodeIdentity
 from hivemind_bus_client.message import HiveMessage, HiveMessageType
 from hivemind_bus_client.serialization import get_bitstring, decode_bitstring
 from hivemind_bus_client.util import serialize_message, \
     encrypt_as_json, decrypt_from_json, encrypt_bin, decrypt_bin
 
 
 class HiveMessageWaiter:
@@ -76,48 +77,87 @@
             self.received_msg = message
             self.response_event.set()
         else:
             self.bus.once(self.msg_type, self._handler)
 
 
 class HiveMessageBusClient(OVOSBusClient):
-    def __init__(self, key, password=None, crypto_key=None, host='127.0.0.1', port=5678,
-                 useragent="HiveMessageBusClientV0.0.1", self_signed=True, share_bus=False,
+    def __init__(self, key=None, password=None, crypto_key=None, host='127.0.0.1', port=5678,
+                 useragent="", self_signed=True, share_bus=False,
                  compress=True, binarize=True):
         ssl = host.startswith("wss://")
         host = host.replace("ws://", "").replace("wss://", "").strip()
-        self.key = key
-        self.useragent = useragent
+
+        self.identity = NodeIdentity()
+        self.identity.password = password or self.identity.password
+        self.identity.access_key = key or self.identity.access_key
+        self.identity.name = useragent or self.identity.name or "HiveMessageBusClientV0.0.1"
+
+        if not self.identity.access_key or not self.identity.password:
+            raise RuntimeError("NodeIdentity not set, please pass key and password or "
+                               "call 'hivemind-client set-identity'")
+
         self.crypto_key = crypto_key
-        self.password = password
         self.allow_self_signed = self_signed
         self._mycroft_events = {}  # msg_type: [handler]
-        self.password = password
         self.share_bus = share_bus
         self.handshake_event = Event()
 
         # if you want to reduce CPU usage in exchange for more bandwidth set below to False
         self.compress = compress  # None -> auto
         self.binarize = binarize  # only if hivemind reports also supporting it
 
         super().__init__(host=host, port=port, ssl=ssl, emitter=EventEmitter())
 
+    @property
+    def useragent(self):
+        return self.identity.name
+
+    @useragent.setter
+    def useragent(self, val):
+        self.identity.name = val
+
+    @property
+    def password(self):
+        return self.identity.password
+
+    @property
+    def key(self):
+        return self.identity.access_key
+
+    @property
+    def site_id(self):
+        return self.identity.site_id
+
+    @site_id.setter
+    def site_id(self, val):
+        self.identity.site_id = val
+
+    @password.setter
+    def password(self, val):
+        self.identity.password = val
+
+    @key.setter
+    def key(self, val):
+        self.identity.access_key = val
+
     def connect(self, bus=FakeBus(), identity=None, protocol=None, site_id=None):
         from hivemind_bus_client.protocol import HiveMindSlaveProtocol
-        from hivemind_bus_client.identity import NodeIdentity
-        ident = identity or NodeIdentity()
-        ident.password = self.password or ident.password
+
+        self.identity = identity or self.identity
+        self.identity.site_id = site_id or self.identity.site_id
         if protocol is None:
             LOG.debug("Initializing HiveMindSlaveProtocol")
             self.protocol = HiveMindSlaveProtocol(self,
                                                   shared_bus=self.share_bus,
                                                   site_id=site_id or "unknown",
-                                                  identity=ident)
+                                                  identity=self.identity)
         else:
             self.protocol = protocol
+            self.protocol.identity = self.identity
             if site_id is not None:
                 self.protocol.site_id = site_id
 
         LOG.info("Connecting to Hivemind")
         self.run_in_thread()
         self.protocol.bind(bus)
         self.wait_for_handshake()
@@ -275,15 +315,15 @@
     # event api
     def on(self, event_name, func):
         if event_name not in list(HiveMessageType):
             # assume it's a mycroft message
             # this could be done better,
             # but makes this lib almost a drop in replacement
             # for the mycroft bus client
-            #LOG.info(f"registering mycroft handler: {event_name}")
+            # LOG.info(f"registering mycroft handler: {event_name}")
             self.on_mycroft(event_name, func)
         else:
             # hivemind message
             LOG.debug(f"registering handler: {event_name}")
             self.emitter.on(event_name, func)
 
     # utility
```

## hivemind_bus_client/identity.py

```diff
@@ -40,12 +40,28 @@
         can connect to each other (access keys still need to be valid)"""
         return self.IDENTITY_FILE.get("password")
 
     @password.setter
     def password(self, val):
         self.IDENTITY_FILE["password"] = val
 
+    @property
+    def access_key(self):
+        return self.IDENTITY_FILE.get("access_key")
+
+    @access_key.setter
+    def access_key(self, val):
+        self.IDENTITY_FILE["access_key"] = val
+
+    @property
+    def site_id(self):
+        return self.IDENTITY_FILE.get("site_id")
+
+    @site_id.setter
+    def site_id(self, val):
+        self.IDENTITY_FILE["site_id"] = val
+
     def save(self):
         self.IDENTITY_FILE.store()
 
     def reload(self):
         self.IDENTITY_FILE.reload()
```

## hivemind_bus_client/scripts.py

```diff
@@ -3,31 +3,57 @@
 import click
 from ovos_bus_client import Message
 from ovos_utils.log import LOG
 from ovos_utils.messagebus import FakeBus
 
 from hivemind_bus_client.client import HiveMessageBusClient
 from hivemind_bus_client.message import HiveMessage, HiveMessageType
-
+from hivemind_bus_client.identity import NodeIdentity
 LOG.set_level("DEBUG")
 
 
 @click.group()
 def hmclient_cmds():
     pass
 
 
+@hmclient_cmds.command(help="persist node identity / credentials", name="set-identity")
+@click.option("--key", help="HiveMind access key", type=str, default="")
+@click.option("--password", help="HiveMind password", type=str, default="")
+@click.option("--siteid", help="location identifier for message.context", type=str, default="")
+def identity_set(key: str, password: str, siteid: str):
+    if not key and not password and not siteid:
+        raise ValueError("please set at least one of key/password/siteid")
+    identity = NodeIdentity()
+    identity.password = password or identity.password
+    identity.access_key = key or identity.access_key
+    identity.site_id = siteid or identity.site_id
+    identity.save()
+    print(f"identity saved: {identity.IDENTITY_FILE.path}")
+
+
 @hmclient_cmds.command(help="simple cli interface to inject utterances and print speech", name="terminal")
-@click.option("--key", help="HiveMind access key", type=str)
-@click.option("--password", help="HiveMind password", type=str)
+@click.option("--key", help="HiveMind access key", type=str, default="")
+@click.option("--password", help="HiveMind password", type=str, default="")
 @click.option("--host", help="HiveMind host", type=str, default="0.0.0.0")
 @click.option("--port", help="HiveMind port number", type=int, default=5678)
-def terminal(key: str, password: str, host: str, port: int):
+@click.option("--siteid", help="location identifier for message.context", type=str, default="")
+def terminal(key: str, password: str, host: str, port: int, siteid: str):
+    if not password or not key or not siteid:
+        identity = NodeIdentity()
+        password = password or identity.password
+        key = key or identity.access_key
+        siteid = siteid or identity.site_id or "unknown"
+
+    if not key or not password:
+        raise RuntimeError("NodeIdentity not set, please pass key and password or "
+                           "call 'hivemind-client set-identity'")
+
     node = HiveMessageBusClient(key, host=host, port=port, password=password)
-    node.connect(FakeBus())
+    node.connect(FakeBus(), site_id=siteid)
 
     # node.connected_event.wait()
     print("== connected to HiveMind")
 
     def handle_speak(message: Message):
         utt = message.data["utterance"]
         print("> ", utt)
```

## hivemind_bus_client/version.py

```diff
@@ -1,7 +1,7 @@
 # The following lines are replaced during the release process.
 # START_VERSION_BLOCK
 VERSION_MAJOR = 0
 VERSION_MINOR = 0
 VERSION_BUILD = 4
-VERSION_ALPHA = 8
+VERSION_ALPHA = 9
 # END_VERSION_BLOCK
```

## Comparing `hivemind_bus_client-0.0.4a8.dist-info/LICENSE.md` & `hivemind_bus_client-0.0.4a9.dist-info/LICENSE.md`

 * *Files identical despite different names*

## Comparing `hivemind_bus_client-0.0.4a8.dist-info/METADATA` & `hivemind_bus_client-0.0.4a9.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: hivemind-bus-client
-Version: 0.0.4a8
+Version: 0.0.4a9
 Summary: Hivemind Websocket Client
 Home-page: https://github.com/JarbasHiveMind/hivemind_websocket_client
 Author: JarbasAi
 Author-email: jarbasai@mailfence.com
 License: Apache-2.0
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
@@ -75,14 +75,27 @@
 
 Commands:
   escalate      escalate a single mycroft message
   propagate     propagate a single mycroft message
   send-mycroft  send a single mycroft message
   terminal      simple cli interface to inject utterances and print speech
 
+
+$ hivemind-client set-identity --help
+Usage: hivemind-client set-identity [OPTIONS]
+
+  persist node identity / credentials
+
+Options:
+  --key TEXT       HiveMind access key
+  --password TEXT  HiveMind password
+  --siteid TEXT    location identifier for message.context
+  --help           Show this message and exit.
+
+
 $ hivemind-client terminal --help
 Usage: hivemind-client terminal [OPTIONS]
 
   simple cli interface to inject utterances and print speech
 
 Options:
   --key TEXT      HiveMind access key
```

## Comparing `hivemind_bus_client-0.0.4a8.dist-info/RECORD` & `hivemind_bus_client-0.0.4a9.dist-info/RECORD`

 * *Files 24% similar despite different names*

```diff
@@ -1,17 +1,17 @@
 hivemind_bus_client/__init__.py,sha256=-iP9tFZvB1lS0nfqmfvQtvKaFABVvhlSixcGCkS680w,91
-hivemind_bus_client/client.py,sha256=i8NkneQ4uV84e3PCx69bX2B_qhzNhW7vDTk6hefKXpo,15171
+hivemind_bus_client/client.py,sha256=MhOGjbnaK0MT1izNTV8GLPd9_nmCEzLQ-dXS9CONEJs,16232
 hivemind_bus_client/decorators.py,sha256=1nBk6zhEjb_viHBVvckiNHnQVJIHEOZrKv_m7wDTSSs,5980
 hivemind_bus_client/exceptions.py,sha256=ulWd6qw_8T0CUgllsVpIJIRPa1RgmUM-49y03RiWa3s,835
-hivemind_bus_client/identity.py,sha256=D5D41zajsly--b7qIBzRO6qvRU1iDfjYf5bZWcf1yCQ,1735
+hivemind_bus_client/identity.py,sha256=hgVzTB0E08rxvBZkpqqg9XRGs9tKd9kuW6hd-m_J8A8,2110
 hivemind_bus_client/message.py,sha256=6KR4JJSWirw5jDZcFL4bCUPZsj2Ci8MjvYlTo3mS4bc,6117
 hivemind_bus_client/protocol.py,sha256=grS51HR9AiVn7uBso7zbrtg9sCjvhQe3ZufZW6_QXas,9627
-hivemind_bus_client/scripts.py,sha256=73jRKp05BmrGQ3pko_7PrEY4EM4XUwqAaqikFY8BGrc,3993
+hivemind_bus_client/scripts.py,sha256=aCGLckkbDZp1ZTLKbtVUVrR9pywfU7PlUWu0iwu4Bn8,5387
 hivemind_bus_client/serialization.py,sha256=jHwWbpG9LewksLhrau0RG-whMQgDzqYPp-pP50n_fGQ,9302
 hivemind_bus_client/util.py,sha256=ID_RBe_gjbQdqp8l7VZ1U_K7UjifUWAMUem7CfLQSTI,5577
-hivemind_bus_client/version.py,sha256=KGZp76DPeDg1rUvbNEu-ElpVytlolGx4KY0F2C1sH7c,177
-hivemind_bus_client-0.0.4a8.dist-info/LICENSE.md,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-hivemind_bus_client-0.0.4a8.dist-info/METADATA,sha256=gnnnGbruLdpKE5IvC1Sk8CI_GbmDHfXX1midXZ4vfLs,3526
-hivemind_bus_client-0.0.4a8.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
-hivemind_bus_client-0.0.4a8.dist-info/entry_points.txt,sha256=y30uwp7h_4zPKUDhNjDgh5pi_ar6QN1P40RVdW3w7-g,79
-hivemind_bus_client-0.0.4a8.dist-info/top_level.txt,sha256=Mp5mHCXFbw1-mgviGLH7kl8semppiV8d0nnV3pYfrns,20
-hivemind_bus_client-0.0.4a8.dist-info/RECORD,,
+hivemind_bus_client/version.py,sha256=3kG2MfrYDlMck6cum79o2MEt00stHU12dkpaKZXL_eM,177
+hivemind_bus_client-0.0.4a9.dist-info/LICENSE.md,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+hivemind_bus_client-0.0.4a9.dist-info/METADATA,sha256=CXK4TZr8ja2NEEGcFV4CyWQp64IFaiIPKz7cOzB8x9M,3844
+hivemind_bus_client-0.0.4a9.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
+hivemind_bus_client-0.0.4a9.dist-info/entry_points.txt,sha256=y30uwp7h_4zPKUDhNjDgh5pi_ar6QN1P40RVdW3w7-g,79
+hivemind_bus_client-0.0.4a9.dist-info/top_level.txt,sha256=Mp5mHCXFbw1-mgviGLH7kl8semppiV8d0nnV3pYfrns,20
+hivemind_bus_client-0.0.4a9.dist-info/RECORD,,
```


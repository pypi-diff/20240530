# Comparing `tmp/froster-0.10.1.tar.gz` & `tmp/froster-0.11.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "froster-0.10.1.tar", last modified: Fri May  3 14:14:32 2024, max compression
+gzip compressed data, was "froster-0.11.0.tar", last modified: Thu May 30 15:23:06 2024, max compression
```

## Comparing `froster-0.10.1.tar` & `froster-0.11.0.tar`

### file list

```diff
@@ -1,16 +1,20 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2024-05-03 14:14:32.922936 froster-0.10.1/
--rwxrwxrwx   0 root         (0) root         (0)    11357 2024-05-02 13:10:23.000000 froster-0.10.1/LICENSE
--rw-r--r--   0 root         (0) root         (0)    50465 2024-05-03 14:14:32.918421 froster-0.10.1/PKG-INFO
--rwxrwxrwx   0 root         (0) root         (0)    50154 2024-05-02 13:10:23.000000 froster-0.10.1/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2024-05-03 14:14:32.842349 froster-0.10.1/froster/
--rwxrwxrwx   0 root         (0) root         (0)        0 2024-05-02 13:38:16.000000 froster-0.10.1/froster/__init__.py
--rwxrwxrwx   0 root         (0) root         (0)   258061 2024-05-03 14:00:53.000000 froster-0.10.1/froster/froster.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2024-05-03 14:14:32.912664 froster-0.10.1/froster.egg-info/
--rw-r--r--   0 root         (0) root         (0)    50465 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      253 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)       49 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)       78 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)        8 2024-05-03 14:14:32.000000 froster-0.10.1/froster.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)       38 2024-05-03 14:14:32.923440 froster-0.10.1/setup.cfg
--rwxrwxrwx   0 root         (0) root         (0)      596 2024-05-03 14:00:43.000000 froster-0.10.1/setup.py
+drwxrwsr-x   0 vmachado  (1001) vmachado  (1001)        0 2024-05-30 15:23:06.010195 froster-0.11.0/
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)    11357 2024-03-14 13:04:03.000000 froster-0.11.0/LICENSE
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)    50399 2024-05-30 15:23:06.010195 froster-0.11.0/PKG-INFO
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)    50215 2024-05-29 10:38:57.000000 froster-0.11.0/README.md
+drwxrwsr-x   0 vmachado  (1001) vmachado  (1001)        0 2024-05-30 15:23:06.010195 froster-0.11.0/froster/
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)       64 2024-05-21 14:13:58.000000 froster-0.11.0/froster/__init__.py
+-rwxrwxr-x   0 vmachado  (1001) vmachado  (1001)   278526 2024-05-30 15:17:42.000000 froster-0.11.0/froster/froster.py
+drwxrwsr-x   0 vmachado  (1001) vmachado  (1001)        0 2024-05-30 15:23:06.010195 froster-0.11.0/froster.egg-info/
+-rw-r--r--   0 vmachado  (1001) vmachado  (1001)    50399 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/PKG-INFO
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)      322 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/SOURCES.txt
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)        1 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/dependency_links.txt
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)       50 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/entry_points.txt
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)      110 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/requires.txt
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)       14 2024-05-30 15:23:05.000000 froster-0.11.0/froster.egg-info/top_level.txt
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)       38 2024-05-30 15:23:06.010195 froster-0.11.0/setup.cfg
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)      526 2024-05-30 14:42:12.000000 froster-0.11.0/setup.py
+drwxrwsr-x   0 vmachado  (1001) vmachado  (1001)        0 2024-05-30 15:23:06.010195 froster-0.11.0/tests/
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)        0 2024-05-15 10:43:19.000000 froster-0.11.0/tests/__init__.py
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)     1604 2024-05-15 10:43:19.000000 froster-0.11.0/tests/generate_dummy_files.py
+-rw-rw-r--   0 vmachado  (1001) vmachado  (1001)    31214 2024-05-21 16:02:26.000000 froster-0.11.0/tests/test_config.py
```

### Comparing `froster-0.10.1/LICENSE` & `froster-0.11.0/LICENSE`

 * *Files identical despite different names*

### Comparing `froster-0.10.1/PKG-INFO` & `froster-0.11.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,60 +1,56 @@
 Metadata-Version: 2.1
 Name: froster
-Version: 0.10.1
+Version: 0.11.0
+Summary: UNKNOWN
+Home-page: UNKNOWN
 License: MIT
+Platform: UNKNOWN
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: duckdb<1.0
-Requires-Dist: textual<0.60
-Requires-Dist: requests<2.40
-Requires-Dist: boto3<1.40
-Requires-Dist: psutil<6.0
-Requires-Dist: visidata
-Requires-Dist: inquirer
 
 ![image](https://user-images.githubusercontent.com/1427719/235330281-bd876f06-2b2a-46fc-8505-c065bb508973.png)
 
 Froster is a user-friendly archiving tool for teams that move data between higher cost Posix file systems and lower cost S3-like object storage systems such as AWS Glacier. Froster crawls your Posix file system metadata, recommends folders for archiving, generates checksums, and uploads your selections to Glacier or other S3-like storage. It can retrieve data back from the archive using a single command. Additionally, Froster can mount S3/Glacier storage inside your on-premise file system and also restore to an AWS EC2 instance. 
 
 </br>
 
 ## Installation pre-requisite: packages
 
 ### On Debian/Ubuntu
 
 ```
 sudo apt-get update
-sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip fuse3
 ```
 
 ### On RHEL 
 
 ```
 sudo yum update
-sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip fuse3 python3-devel
 ```
 
 ### On HPC machine
 
 Please contact your administrator to install these packages:
 ```
-curl pipx git gcc lib32gcc-s1 unzip
+curl pipx git gcc lib32gcc-s1 unzip fuse3 python3.xx-devel
 ```
 
 </br>
 
 
 ## Installation
 
 After you installed the pre-requisites, close and open the terminal again to refresh the environment.
 To install Froster, execute the following command into your terminal:
 
 ```
-curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh | bash
+curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh?$(date +%s) | bash
 
 ```
 
 ## Update (TODO)
 
 </br>
 
@@ -870,7 +866,9 @@
 Froster is a good on-ramp to Starfish. If many users in your organization end up using Froster, it is time considering Starfish as an alternative but if fewer than a handful users find Froster useful, you may be able to defer your Starfish project until you have a critical mass. You can access many advanced Starfish features through a web browser while Froster has a simple CLI/TUI interface.
 
 ## Discontinuing Froster  
 
 All good things inevitably come to an end. Consider what you might encounter when attempting to restore your data 15 years from now. While AWS Glacier and Rclone will still exist, we cannot guarantee the continued maintenance of components like Textual or DuckDB, or even Froster itself. However, even if certain tools fade away, you can always rely on utilities like Rclone or [Cyberduck](#using-cyberduck-to-browse-glacier) (for smaller amounts of data) to retrieve your data, as it is kept in its original format.   
 
 Alternatively, the shell script [s3-restore.sh](https://github.com/dirkpetersen/froster/blob/main/s3-restore.sh) simplifies this process, driving Rclone with the appropriate settings. Using the command `s3-restore.sh list`, you can view all folders archived in the JSON database `foster-archives.json` (default location: `~/.froster/config/`). To restore a specific folder, simply use the command followed by the desired path, for example: `s3-restore.sh /my/shared/folder`. It's worth noting that system administrators might hesitate to endorse tools written in programming languages they aren't familiar with, such as Python. Fortunately, `s3-restore.sh` is a straightforward bash shell script, easily customizable to suit specific needs. Note: You may have to change the AWS profile in `s3-restore.sh` to a profile you find under `~/.aws`
+
+
```

### Comparing `froster-0.10.1/README.md` & `froster-0.11.0/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -6,41 +6,41 @@
 
 ## Installation pre-requisite: packages
 
 ### On Debian/Ubuntu
 
 ```
 sudo apt-get update
-sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip fuse3
 ```
 
 ### On RHEL 
 
 ```
 sudo yum update
-sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip fuse3 python3-devel
 ```
 
 ### On HPC machine
 
 Please contact your administrator to install these packages:
 ```
-curl pipx git gcc lib32gcc-s1 unzip
+curl pipx git gcc lib32gcc-s1 unzip fuse3 python3.xx-devel
 ```
 
 </br>
 
 
 ## Installation
 
 After you installed the pre-requisites, close and open the terminal again to refresh the environment.
 To install Froster, execute the following command into your terminal:
 
 ```
-curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh | bash
+curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh?$(date +%s) | bash
 
 ```
 
 ## Update (TODO)
 
 </br>
```

### Comparing `froster-0.10.1/froster/froster.py` & `froster-0.11.0/froster/froster.py`

 * *Files 6% similar despite different names*

```diff
@@ -4,16126 +4,17405 @@
 00000030: 7563 6820 6f66 2074 6865 2063 6861 6c6c  uch of the chall
 00000040: 656e 6769 6e67 2074 6173 6b73 2077 6865  enging tasks whe
 00000050: 6e0a 6172 6368 6976 696e 6720 6d61 6e79  n.archiving many
 00000060: 2054 6572 6162 7974 6573 206f 6620 6461   Terabytes of da
 00000070: 7461 206f 6e20 6c61 7267 6520 2848 5043  ta on large (HPC
 00000080: 2920 7379 7374 656d 732e 0a22 2222 0a0a  ) systems.."""..
 00000090: 2320 696e 7465 726e 616c 206d 6f64 756c  # internal modul
-000000a0: 6573 0a69 6d70 6f72 7420 7379 730a 696d  es.import sys.im
-000000b0: 706f 7274 206f 730a 696d 706f 7274 2061  port os.import a
-000000c0: 7267 7061 7273 650a 696d 706f 7274 206a  rgparse.import j
-000000d0: 736f 6e0a 696d 706f 7274 2063 6f6e 6669  son.import confi
-000000e0: 6770 6172 7365 720a 696d 706f 7274 2063  gparser.import c
-000000f0: 7376 0a69 6d70 6f72 7420 706c 6174 666f  sv.import platfo
-00000100: 726d 0a69 6d70 6f72 7420 6173 796e 6369  rm.import asynci
-00000110: 6f0a 696d 706f 7274 2073 7461 740a 696d  o.import stat.im
-00000120: 706f 7274 2064 6174 6574 696d 650a 696d  port datetime.im
-00000130: 706f 7274 2074 6172 6669 6c65 0a69 6d70  port tarfile.imp
-00000140: 6f72 7420 7465 7874 7772 6170 0a69 6d70  ort textwrap.imp
-00000150: 6f72 7420 7461 7266 696c 650a 696d 706f  ort tarfile.impo
-00000160: 7274 2074 696d 650a 696d 706f 7274 2070  rt time.import p
-00000170: 6c61 7466 6f72 6d0a 696d 706f 7274 2063  latform.import c
-00000180: 6f6e 6375 7272 656e 742e 6675 7475 7265  oncurrent.future
-00000190: 730a 696d 706f 7274 2068 6173 686c 6962  s.import hashlib
-000001a0: 0a69 6d70 6f72 7420 666e 6d61 7463 680a  .import fnmatch.
-000001b0: 696d 706f 7274 2069 6f0a 696d 706f 7274  import io.import
-000001c0: 206d 6174 680a 696d 706f 7274 2073 6967   math.import sig
-000001d0: 6e61 6c0a 696d 706f 7274 2073 686c 6578  nal.import shlex
-000001e0: 0a69 6d70 6f72 7420 7368 7574 696c 0a69  .import shutil.i
-000001f0: 6d70 6f72 7420 7465 6d70 6669 6c65 0a69  mport tempfile.i
-00000200: 6d70 6f72 7420 7375 6270 726f 6365 7373  mport subprocess
-00000210: 0a69 6d70 6f72 7420 6974 6572 746f 6f6c  .import itertool
-00000220: 730a 696d 706f 7274 2073 6f63 6b65 740a  s.import socket.
-00000230: 696d 706f 7274 2069 6e73 7065 6374 0a69  import inspect.i
-00000240: 6d70 6f72 7420 6765 7470 6173 730a 696d  mport getpass.im
-00000250: 706f 7274 2070 7764 0a69 6d70 6f72 7420  port pwd.import 
-00000260: 6772 700a 696d 706f 7274 2073 7461 740a  grp.import stat.
-00000270: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
-00000280: 2075 726c 6c69 622e 7061 7273 650a 696d   urllib.parse.im
-00000290: 706f 7274 2074 7261 6365 6261 636b 0a0a  port traceback..
-000002a0: 6672 6f6d 2070 6174 686c 6962 2069 6d70  from pathlib imp
-000002b0: 6f72 7420 5061 7468 0a0a 2320 7374 7566  ort Path..# stuf
-000002c0: 6620 6672 6f6d 2070 7970 690a 696d 706f  f from pypi.impo
-000002d0: 7274 2069 6e71 7569 7265 720a 696d 706f  rt inquirer.impo
-000002e0: 7274 2072 6571 7565 7374 730a 696d 706f  rt requests.impo
-000002f0: 7274 2064 7563 6b64 620a 696d 706f 7274  rt duckdb.import
-00000300: 2062 6f74 6f33 0a69 6d70 6f72 7420 626f   boto3.import bo
-00000310: 746f 636f 7265 0a69 6d70 6f72 7420 7073  tocore.import ps
-00000320: 7574 696c 0a0a 6672 6f6d 2074 6578 7475  util..from textu
-00000330: 616c 2069 6d70 6f72 7420 6f6e 2c20 776f  al import on, wo
-00000340: 726b 0a66 726f 6d20 7465 7874 7561 6c2e  rk.from textual.
-00000350: 6170 7020 696d 706f 7274 2041 7070 2c20  app import App, 
-00000360: 436f 6d70 6f73 6552 6573 756c 740a 6672  ComposeResult.fr
-00000370: 6f6d 2074 6578 7475 616c 2e63 6f6e 7461  om textual.conta
-00000380: 696e 6572 7320 696d 706f 7274 2048 6f72  iners import Hor
-00000390: 697a 6f6e 7461 6c2c 2056 6572 7469 6361  izontal, Vertica
-000003a0: 6c0a 6672 6f6d 2074 6578 7475 616c 2e73  l.from textual.s
-000003b0: 6372 6565 6e20 696d 706f 7274 204d 6f64  creen import Mod
-000003c0: 616c 5363 7265 656e 0a66 726f 6d20 7465  alScreen.from te
-000003d0: 7874 7561 6c2e 7769 6467 6574 7320 696d  xtual.widgets im
-000003e0: 706f 7274 204c 6162 656c 2c20 496e 7075  port Label, Inpu
-000003f0: 742c 204c 6f61 6469 6e67 496e 6469 6361  t, LoadingIndica
-00000400: 746f 720a 6672 6f6d 2074 6578 7475 616c  tor.from textual
-00000410: 2e77 6964 6765 7473 2069 6d70 6f72 7420  .widgets import 
-00000420: 4461 7461 5461 626c 652c 2046 6f6f 7465  DataTable, Foote
-00000430: 722c 2042 7574 746f 6e0a 0a5f 5f61 7070  r, Button..__app
-00000440: 5f5f 203d 2027 4672 6f73 7465 722c 2061  __ = 'Froster, a
-00000450: 2075 7365 7220 6672 6965 6e64 6c79 2053   user friendly S
-00000460: 332f 476c 6163 6965 7220 6172 6368 6976  3/Glacier archiv
-00000470: 696e 6720 746f 6f6c 270a 5f5f 7665 7273  ing tool'.__vers
-00000480: 696f 6e5f 5f20 3d20 2730 2e31 302e 3127  ion__ = '0.10.1'
-00000490: 0a0a 0a63 6c61 7373 2043 6f6e 6669 674d  ...class ConfigM
-000004a0: 616e 6167 6572 3a0a 2020 2020 2727 2720  anager:.    ''' 
-000004b0: 4672 6f73 7465 7220 636f 6e66 6967 7572  Froster configur
-000004c0: 6174 696f 6e20 6d61 6e61 6765 720a 0a20  ation manager.. 
-000004d0: 2020 2054 6869 7320 636c 6173 7320 6d61     This class ma
-000004e0: 6e61 6765 7320 7468 6520 636f 6e66 6967  nages the config
-000004f0: 7572 6174 696f 6e20 6f66 2046 726f 7374  uration of Frost
-00000500: 6572 2e0a 2020 2020 4974 2072 6561 6473  er..    It reads
-00000510: 2061 6e64 2077 7269 7465 7320 7468 6520   and writes the 
-00000520: 636f 6e66 6967 7572 6174 696f 6e20 6669  configuration fi
-00000530: 6c65 732e 2727 270a 0a20 2020 2064 6566  les.'''..    def
-00000540: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
-00000550: 0a20 2020 2020 2020 2027 2727 2049 6e69  .        ''' Ini
-00000560: 7469 616c 697a 6520 7468 6520 436f 6e66  tialize the Conf
-00000570: 6967 4d61 6e61 6765 7220 6f62 6a65 6374  igManager object
-00000580: 0a0a 2020 2020 2020 2020 5468 6973 2066  ..        This f
-00000590: 756e 6374 696f 6e20 696e 6974 6961 6c69  unction initiali
-000005a0: 7a65 7320 7468 6520 436f 6e66 6967 4d61  zes the ConfigMa
-000005b0: 6e61 6765 7220 6f62 6a65 6374 2077 6974  nager object wit
-000005c0: 6820 6465 6661 756c 7420 7661 6c75 6573  h default values
-000005d0: 2e0a 2020 2020 2020 2020 5468 656e 2069  ..        Then i
-000005e0: 7420 7265 6164 7320 7468 6520 636f 6e66  t reads the conf
-000005f0: 6967 7572 6174 696f 6e20 6669 6c65 2028  iguration file (
-00000600: 6966 2065 7869 7374 7329 2061 6e64 2070  if exists) and p
-00000610: 6f70 756c 6174 6573 2074 6865 206f 626a  opulates the obj
-00000620: 6563 7420 7661 7269 6162 6c65 732e 0a20  ect variables.. 
-00000630: 2020 2020 2020 2049 7420 666f 6c6c 6f77         It follow
-00000640: 7320 7468 6520 5844 4720 4261 7365 2044  s the XDG Base D
-00000650: 6972 6563 746f 7279 2063 6f6e 7665 6e74  irectory convent
-00000660: 696f 6e73 3a0a 2020 2020 2020 2020 6874  ions:.        ht
-00000670: 7470 733a 2f2f 7370 6563 6966 6963 6174  tps://specificat
-00000680: 696f 6e73 2e66 7265 6564 6573 6b74 6f70  ions.freedesktop
-00000690: 2e6f 7267 2f62 6173 6564 6972 2d73 7065  .org/basedir-spe
-000006a0: 632f 6261 7365 6469 722d 7370 6563 2d6c  c/basedir-spec-l
-000006b0: 6174 6573 742e 6874 6d6c 0a20 2020 2020  atest.html.     
-000006c0: 2020 2027 2727 0a0a 2020 2020 2020 2020     '''..        
-000006d0: 2320 4465 6275 673a 2070 7269 6e74 2063  # Debug: print c
-000006e0: 7572 7265 6e74 2066 756e 6374 696f 6e20  urrent function 
-000006f0: 6e61 6d65 0a20 2020 2020 2020 2070 7269  name.        pri
-00000700: 6e74 6462 6728 6627 7b69 6e73 7065 6374  ntdbg(f'{inspect
-00000710: 2e73 7461 636b 2829 5b30 5d5b 335d 7d5c  .stack()[0][3]}\
-00000720: 6e27 290a 0a20 2020 2020 2020 2023 2049  n')..        # I
-00000730: 6e69 7469 616c 697a 6520 7468 6520 6669  nitialize the fi
-00000740: 6c65 6e61 6d65 2076 6172 6961 626c 6573  lename variables
-00000750: 2074 6861 7420 6172 6520 6e65 6564 6564   that are needed
-00000760: 2065 6c73 6577 6865 7265 0a20 2020 2020   elsewhere.     
-00000770: 2020 2073 656c 662e 6172 6368 6976 655f     self.archive_
-00000780: 6a73 6f6e 5f66 696c 655f 6e61 6d65 203d  json_file_name =
-00000790: 2027 6672 6f73 7465 722d 6172 6368 6976   'froster-archiv
-000007a0: 6573 2e6a 736f 6e27 0a20 2020 2020 2020  es.json'.       
-000007b0: 2073 656c 662e 7368 6172 6564 5f63 6f6e   self.shared_con
-000007c0: 6669 675f 6669 6c65 5f6e 616d 6520 3d20  fig_file_name = 
-000007d0: 2773 6861 7265 645f 636f 6e66 6967 2e69  'shared_config.i
-000007e0: 6e69 270a 0a20 2020 2020 2020 2023 2049  ni'..        # I
-000007f0: 6e69 7469 616c 697a 6520 7468 6520 7661  nitialize the va
-00000800: 7269 6162 6c65 7320 7468 6174 2063 6865  riables that che
-00000810: 636b 2069 6620 7370 6563 6966 6963 2063  ck if specific c
-00000820: 6f6e 6669 6775 7261 7469 6f6e 2073 6563  onfiguration sec
-00000830: 7469 6f6e 7320 6861 7665 2062 6565 6e20  tions have been 
-00000840: 696e 6974 6961 6c69 7a65 640a 2020 2020  initialized.    
-00000850: 2020 2020 7365 6c66 2e75 7365 725f 696e      self.user_in
-00000860: 6974 203d 2046 616c 7365 0a20 2020 2020  it = False.     
-00000870: 2020 2073 656c 662e 6177 735f 696e 6974     self.aws_init
-00000880: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00000890: 2073 656c 662e 7333 5f69 6e69 7420 3d20   self.s3_init = 
-000008a0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
-000008b0: 2057 686f 616d 690a 2020 2020 2020 2020   Whoami.        
-000008c0: 7365 6c66 2e77 686f 616d 6920 3d20 6765  self.whoami = ge
-000008d0: 7470 6173 732e 6765 7475 7365 7228 290a  tpass.getuser().
-000008e0: 0a20 2020 2020 2020 2023 2045 7870 616e  .        # Expan
-000008f0: 6420 7468 6520 7e20 7379 6d62 6f6c 7320  d the ~ symbols 
-00000900: 746f 2075 7365 7227 7320 686f 6d65 2064  to user's home d
-00000910: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
-00000920: 2073 656c 662e 686f 6d65 5f64 6972 203d   self.home_dir =
-00000930: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-00000940: 7365 7228 277e 2729 0a0a 2020 2020 2020  ser('~')..      
-00000950: 2020 2320 4672 6f73 7465 7227 7320 686f    # Froster's ho
-00000960: 6d65 2064 6972 6563 746f 7279 0a20 2020  me directory.   
-00000970: 2020 2020 2073 656c 662e 6672 6f73 7465       self.froste
-00000980: 725f 6469 7220 3d20 6f73 2e70 6174 682e  r_dir = os.path.
-00000990: 6a6f 696e 2873 7973 2e70 7265 6669 7829  join(sys.prefix)
-000009a0: 0a0a 2020 2020 2020 2020 2320 4672 6f73  ..        # Fros
-000009b0: 7465 7227 7320 6269 6e61 7279 2064 6972  ter's binary dir
-000009c0: 6563 746f 7279 0a20 2020 2020 2020 2073  ectory.        s
-000009d0: 656c 662e 6269 6e5f 6469 7220 3d20 6f73  elf.bin_dir = os
-000009e0: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
-000009f0: 6672 6f73 7465 725f 6469 722c 2027 6269  froster_dir, 'bi
-00000a00: 6e27 290a 0a20 2020 2020 2020 2023 2046  n')..        # F
-00000a10: 726f 7374 6572 2773 2063 6f6e 6669 6775  roster's configu
-00000a20: 7261 7469 6f6e 2064 6972 6563 746f 7279  ration directory
-00000a30: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00000a40: 6e66 6967 5f64 6972 203d 206f 732e 7061  nfig_dir = os.pa
-00000a50: 7468 2e6a 6f69 6e28 7365 6c66 2e68 6f6d  th.join(self.hom
-00000a60: 655f 6469 722c 2027 2e63 6f6e 6669 6727  e_dir, '.config'
-00000a70: 2c20 2766 726f 7374 6572 2729 0a0a 2020  , 'froster')..  
-00000a80: 2020 2020 2020 2320 4672 6f73 7465 7227        # Froster'
-00000a90: 7320 636f 6e66 6967 7572 6174 696f 6e20  s configuration 
-00000aa0: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
-00000ab0: 662e 636f 6e66 6967 5f66 696c 6520 3d20  f.config_file = 
-00000ac0: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
-00000ad0: 662e 636f 6e66 6967 5f64 6972 2c20 2763  f.config_dir, 'c
-00000ae0: 6f6e 6669 672e 696e 6927 290a 0a20 2020  onfig.ini')..   
-00000af0: 2020 2020 2023 2046 726f 7374 6572 2773       # Froster's
-00000b00: 2064 6174 6120 6469 7265 6374 6f72 790a   data directory.
-00000b10: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00000b20: 615f 6469 7220 3d20 6f73 2e70 6174 682e  a_dir = os.path.
-00000b30: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-00000b40: 2020 7365 6c66 2e68 6f6d 655f 6469 722c    self.home_dir,
-00000b50: 2027 2e6c 6f63 616c 272c 2027 7368 6172   '.local', 'shar
-00000b60: 6527 2c20 2766 726f 7374 6572 2729 0a0a  e', 'froster')..
-00000b70: 2020 2020 2020 2020 2320 4672 6f73 7465          # Froste
-00000b80: 7227 7320 6172 6368 6976 6520 6a73 6f6e  r's archive json
-00000b90: 2066 696c 650a 2020 2020 2020 2020 7365   file.        se
-00000ba0: 6c66 2e61 7263 6869 7665 5f6a 736f 6e20  lf.archive_json 
-00000bb0: 3d20 6f73 2e70 6174 682e 6a6f 696e 280a  = os.path.join(.
-00000bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00000bd0: 2e64 6174 615f 6469 722c 2073 656c 662e  .data_dir, self.
-00000be0: 6172 6368 6976 655f 6a73 6f6e 5f66 696c  archive_json_fil
-00000bf0: 655f 6e61 6d65 290a 0a20 2020 2020 2020  e_name)..       
-00000c00: 2023 2041 5753 2064 6972 6563 746f 7279   # AWS directory
-00000c10: 0a20 2020 2020 2020 2073 656c 662e 6177  .        self.aw
-00000c20: 735f 6469 7220 3d20 6f73 2e70 6174 682e  s_dir = os.path.
-00000c30: 6a6f 696e 2873 656c 662e 686f 6d65 5f64  join(self.home_d
-00000c40: 6972 2c20 272e 6177 7327 290a 0a20 2020  ir, '.aws')..   
-00000c50: 2020 2020 2023 2041 5753 2063 6f6e 6669       # AWS confi
-00000c60: 6720 6669 6c65 0a20 2020 2020 2020 2073  g file.        s
-00000c70: 656c 662e 6177 735f 636f 6e66 6967 5f66  elf.aws_config_f
-00000c80: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
-00000c90: 696e 2873 656c 662e 6177 735f 6469 722c  in(self.aws_dir,
-00000ca0: 2027 636f 6e66 6967 2729 0a0a 2020 2020   'config')..    
-00000cb0: 2020 2020 2320 4157 5320 6372 6564 656e      # AWS creden
-00000cc0: 7469 616c 7320 6669 6c65 0a20 2020 2020  tials file.     
-00000cd0: 2020 2073 656c 662e 6177 735f 6372 6564     self.aws_cred
-00000ce0: 656e 7469 616c 735f 6669 6c65 203d 206f  entials_file = o
-00000cf0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00000d00: 2e61 7773 5f64 6972 2c20 2763 7265 6465  .aws_dir, 'crede
-00000d10: 6e74 6961 6c73 2729 0a0a 2020 2020 2020  ntials')..      
-00000d20: 2020 2320 4672 6f73 7465 7227 7320 6465    # Froster's de
-00000d30: 6661 756c 7420 7368 6172 6564 2063 6f6e  fault shared con
-00000d40: 6669 6775 7261 7469 6f6e 0a20 2020 2020  figuration.     
-00000d50: 2020 2073 656c 662e 6973 5f73 6861 7265     self.is_share
-00000d60: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
-00000d70: 2020 2023 2042 6173 6963 2073 6574 7570     # Basic setup
-00000d80: 2c20 666f 6375 7320 7468 6520 696e 6465  , focus the inde
-00000d90: 7865 7220 6f6e 206c 6172 6765 7220 666f  xer on larger fo
-00000da0: 6c64 6572 7320 616e 6420 6669 6c65 2073  lders and file s
-00000db0: 697a 6573 0a20 2020 2020 2020 2073 656c  izes.        sel
-00000dc0: 662e 6d61 785f 736d 616c 6c5f 6669 6c65  f.max_small_file
-00000dd0: 5f73 697a 655f 6b69 6220 3d20 3130 3234  _size_kib = 1024
-00000de0: 0a20 2020 2020 2020 2073 656c 662e 6d69  .        self.mi
-00000df0: 6e5f 696e 6465 785f 666f 6c64 6572 5f73  n_index_folder_s
-00000e00: 697a 655f 6769 6220 3d20 310a 2020 2020  ize_gib = 1.    
-00000e10: 2020 2020 7365 6c66 2e6d 696e 5f69 6e64      self.min_ind
-00000e20: 6578 5f66 6f6c 6465 725f 7369 7a65 5f61  ex_folder_size_a
-00000e30: 7667 5f6d 6962 203d 2031 300a 2020 2020  vg_mib = 10.    
-00000e40: 2020 2020 7365 6c66 2e6d 6178 5f68 6f74      self.max_hot
-00000e50: 7370 6f74 735f 6469 7370 6c61 795f 656e  spots_display_en
-00000e60: 7472 6965 7320 3d20 3530 3030 0a0a 2020  tries = 5000..  
-00000e70: 2020 2020 2020 2320 4672 6f73 7465 7227        # Froster'
-00000e80: 7320 7373 6820 6465 6661 756c 7420 6b65  s ssh default ke
-00000e90: 7920 6e61 6d65 0a20 2020 2020 2020 2073  y name.        s
-00000ea0: 656c 662e 7373 685f 6b65 795f 6e61 6d65  elf.ssh_key_name
-00000eb0: 203d 2027 6672 6f73 7465 722d 6563 3227   = 'froster-ec2'
-00000ec0: 0a0a 2020 2020 2020 2020 2320 486f 7473  ..        # Hots
-00000ed0: 706f 7473 2064 6972 0a20 2020 2020 2020  pots dir.       
-00000ee0: 2073 656c 662e 686f 7473 706f 7473 5f64   self.hotspots_d
-00000ef0: 6972 203d 206f 732e 7061 7468 2e6a 6f69  ir = os.path.joi
-00000f00: 6e28 7365 6c66 2e64 6174 615f 6469 722c  n(self.data_dir,
-00000f10: 2027 686f 7473 706f 7473 2729 0a0a 2020   'hotspots')..  
-00000f20: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-00000f30: 2074 6865 7265 2069 7320 6120 7e2f 2e63   there is a ~/.c
-00000f40: 6f6e 6669 672f 6672 6f73 7465 722f 636f  onfig/froster/co
-00000f50: 6e66 6967 2e69 6e69 2066 696c 6520 616e  nfig.ini file an
-00000f60: 6420 706f 7075 6c61 7465 2074 6865 2076  d populate the v
-00000f70: 6172 6961 626c 6573 0a20 2020 2020 2020  ariables.       
-00000f80: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00000f90: 7473 2873 656c 662e 636f 6e66 6967 5f66  ts(self.config_f
-00000fa0: 696c 6529 3a0a 0a20 2020 2020 2020 2020  ile):..         
-00000fb0: 2020 2023 2043 7265 6174 6520 6120 436f     # Create a Co
-00000fc0: 6e66 6967 5061 7273 6572 206f 626a 6563  nfigParser objec
-00000fd0: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
-00000fe0: 6e66 6967 203d 2063 6f6e 6669 6770 6172  nfig = configpar
-00000ff0: 7365 722e 436f 6e66 6967 5061 7273 6572  ser.ConfigParser
-00001000: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00001010: 2320 506f 7075 6c61 7465 2073 656c 6620  # Populate self 
-00001020: 7661 7269 6162 6c65 7320 7573 696e 6720  variables using 
-00001030: 6c6f 6361 6c20 636f 6e66 6967 2e69 6e69  local config.ini
-00001040: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
-00001050: 2020 636f 6e66 6967 2e72 6561 6428 7365    config.read(se
-00001060: 6c66 2e63 6f6e 6669 675f 6669 6c65 290a  lf.config_file).
-00001070: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-00001080: 7365 7220 636f 6e66 6967 7572 6174 696f  ser configuratio
-00001090: 6e0a 2020 2020 2020 2020 2020 2020 7365  n.            se
-000010a0: 6c66 2e6e 616d 6520 3d20 636f 6e66 6967  lf.name = config
-000010b0: 2e67 6574 2827 5553 4552 272c 2027 6e61  .get('USER', 'na
-000010c0: 6d65 272c 2066 616c 6c62 6163 6b3d 4e6f  me', fallback=No
-000010d0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-000010e0: 7365 6c66 2e65 6d61 696c 203d 2063 6f6e  self.email = con
-000010f0: 6669 672e 6765 7428 2755 5345 5227 2c20  fig.get('USER', 
-00001100: 2765 6d61 696c 272c 2066 616c 6c62 6163  'email', fallbac
-00001110: 6b3d 4e6f 6e65 290a 0a20 2020 2020 2020  k=None)..       
-00001120: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
-00001130: 7573 6572 2063 6f6e 6669 6775 7261 7469  user configurati
-00001140: 6f6e 2069 7320 636f 6d70 6c65 7465 0a20  on is complete. 
-00001150: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00001160: 6c66 2e6e 616d 6520 616e 6420 7365 6c66  lf.name and self
-00001170: 2e65 6d61 696c 3a0a 2020 2020 2020 2020  .email:.        
-00001180: 2020 2020 2020 2020 7365 6c66 2e75 7365          self.use
-00001190: 725f 696e 6974 203d 2054 7275 650a 0a20  r_init = True.. 
-000011a0: 2020 2020 2020 2020 2020 2023 2041 5753             # AWS
-000011b0: 2070 726f 6669 6c65 0a20 2020 2020 2020   profile.       
-000011c0: 2020 2020 2073 656c 662e 6177 735f 7072       self.aws_pr
-000011d0: 6f66 696c 6520 3d20 636f 6e66 6967 2e67  ofile = config.g
-000011e0: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-000011f0: 2020 2020 2741 5753 272c 2027 6177 735f      'AWS', 'aws_
-00001200: 7072 6f66 696c 6527 2c20 6661 6c6c 6261  profile', fallba
-00001210: 636b 3d4e 6f6e 6529 0a0a 2020 2020 2020  ck=None)..      
-00001220: 2020 2020 2020 2320 4157 5320 7265 6769        # AWS regi
-00001230: 6f6e 0a20 2020 2020 2020 2020 2020 2073  on.            s
-00001240: 656c 662e 6177 735f 7265 6769 6f6e 203d  elf.aws_region =
-00001250: 2063 6f6e 6669 672e 6765 7428 0a20 2020   config.get(.   
-00001260: 2020 2020 2020 2020 2020 2020 2027 4157               'AW
-00001270: 5327 2c20 2761 7773 5f72 6567 696f 6e27  S', 'aws_region'
-00001280: 2c20 6661 6c6c 6261 636b 3d4e 6f6e 6529  , fallback=None)
-00001290: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000012a0: 4368 6563 6b20 6966 2061 7773 2063 6f6e  Check if aws con
-000012b0: 6669 6775 7261 7469 6f6e 2069 7320 636f  figuration is co
-000012c0: 6d70 6c65 7465 0a20 2020 2020 2020 2020  mplete.         
-000012d0: 2020 2069 6620 7365 6c66 2e61 7773 5f70     if self.aws_p
-000012e0: 726f 6669 6c65 2061 6e64 2073 656c 662e  rofile and self.
-000012f0: 6177 735f 7265 6769 6f6e 3a0a 2020 2020  aws_region:.    
-00001300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00001310: 2e61 7773 5f69 6e69 7420 3d20 5472 7565  .aws_init = True
-00001320: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00001330: 5368 6172 6564 2063 6f6e 6669 6775 7261  Shared configura
-00001340: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00001350: 2073 656c 662e 6973 5f73 6861 7265 6420   self.is_shared 
-00001360: 3d20 636f 6e66 6967 2e67 6574 626f 6f6c  = config.getbool
-00001370: 6561 6e28 0a20 2020 2020 2020 2020 2020  ean(.           
-00001380: 2020 2020 2027 5348 4152 4544 272c 2027       'SHARED', '
-00001390: 6973 5f73 6861 7265 6427 2c20 6661 6c6c  is_shared', fall
-000013a0: 6261 636b 3d46 616c 7365 290a 0a20 2020  back=False)..   
-000013b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000013c0: 2e69 735f 7368 6172 6564 3a0a 0a20 2020  .is_shared:..   
-000013d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000013e0: 662e 7368 6172 6564 5f64 6972 203d 2063  f.shared_dir = c
-000013f0: 6f6e 6669 672e 6765 7428 0a20 2020 2020  onfig.get(.     
-00001400: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00001410: 5348 4152 4544 272c 2027 7368 6172 6564  SHARED', 'shared
-00001420: 5f64 6972 272c 2066 616c 6c62 6163 6b3d  _dir', fallback=
-00001430: 4e6f 6e65 290a 0a20 2020 2020 2020 2020  None)..         
-00001440: 2020 2020 2020 2073 656c 662e 7368 6172         self.shar
-00001450: 6564 5f63 6f6e 6669 675f 6669 6c65 203d  ed_config_file =
-00001460: 206f 732e 7061 7468 2e6a 6f69 6e28 0a20   os.path.join(. 
-00001470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001480: 2020 2073 656c 662e 7368 6172 6564 5f64     self.shared_d
-00001490: 6972 2c20 2073 656c 662e 7368 6172 6564  ir,  self.shared
-000014a0: 5f63 6f6e 6669 675f 6669 6c65 5f6e 616d  _config_file_nam
-000014b0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-000014c0: 2020 2020 7365 6c66 2e61 7263 6869 7665      self.archive
-000014d0: 5f6a 736f 6e20 3d20 6f73 2e70 6174 682e  _json = os.path.
-000014e0: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-000014f0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00001500: 6861 7265 645f 6469 722c 2073 656c 662e  hared_dir, self.
-00001510: 6172 6368 6976 655f 6a73 6f6e 5f66 696c  archive_json_fil
-00001520: 655f 6e61 6d65 290a 0a20 2020 2020 2020  e_name)..       
-00001530: 2020 2020 2020 2020 2073 656c 662e 7368           self.sh
-00001540: 6172 6564 5f68 6f74 7370 6f74 735f 6469  ared_hotspots_di
-00001550: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
-00001560: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00001570: 2020 2020 2020 7365 6c66 2e73 6861 7265        self.share
-00001580: 645f 6469 722c 2027 686f 7473 706f 7473  d_dir, 'hotspots
-00001590: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-000015a0: 2020 2020 2320 4368 616e 6765 2063 6f6e      # Change con
-000015b0: 6669 6720 6669 6c65 2069 6620 7468 6973  fig file if this
-000015c0: 2069 7320 6120 7368 6172 6564 2063 6f6e   is a shared con
-000015d0: 6669 6775 7261 7469 6f6e 0a20 2020 2020  figuration.     
-000015e0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000015f0: 672e 7265 6164 2873 656c 662e 7368 6172  g.read(self.shar
-00001600: 6564 5f63 6f6e 6669 675f 6669 6c65 290a  ed_config_file).
-00001610: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
-00001620: 4948 2063 6f6e 6669 6775 7261 7469 6f6e  IH configuration
-00001630: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00001640: 662e 6973 5f6e 6968 203d 2063 6f6e 6669  f.is_nih = confi
-00001650: 672e 6765 7462 6f6f 6c65 616e 2827 4e49  g.getboolean('NI
-00001660: 4827 2c20 2769 735f 6e69 6827 2c20 6661  H', 'is_nih', fa
-00001670: 6c6c 6261 636b 3d4e 6f6e 6529 0a0a 2020  llback=None)..  
-00001680: 2020 2020 2020 2020 2020 2320 4375 7272            # Curr
-00001690: 656e 7420 5333 2042 7563 6b65 7420 6e61  ent S3 Bucket na
-000016a0: 6d65 0a20 2020 2020 2020 2020 2020 2073  me.            s
-000016b0: 656c 662e 6275 636b 6574 5f6e 616d 6520  elf.bucket_name 
-000016c0: 3d20 636f 6e66 6967 2e67 6574 280a 2020  = config.get(.  
-000016d0: 2020 2020 2020 2020 2020 2020 2020 2753                'S
-000016e0: 3327 2c20 2762 7563 6b65 745f 6e61 6d65  3', 'bucket_name
-000016f0: 272c 2066 616c 6c62 6163 6b3d 4e6f 6e65  ', fallback=None
-00001700: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00001710: 2041 7263 6869 7665 2064 6972 6563 746f   Archive directo
-00001720: 7920 696e 7369 6465 2041 5753 2053 3320  y inside AWS S3 
-00001730: 6275 636b 6574 0a20 2020 2020 2020 2020  bucket.         
-00001740: 2020 2073 656c 662e 6172 6368 6976 655f     self.archive_
-00001750: 6469 7220 3d20 636f 6e66 6967 2e67 6574  dir = config.get
-00001760: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00001770: 2020 2753 3327 2c20 2761 7263 6869 7665    'S3', 'archive
-00001780: 5f64 6972 272c 2066 616c 6c62 6163 6b3d  _dir', fallback=
-00001790: 4e6f 6e65 290a 0a20 2020 2020 2020 2020  None)..         
-000017a0: 2020 2023 2053 746f 7265 2061 7773 2073     # Store aws s
-000017b0: 3320 7374 6f72 6167 6520 636c 6173 7320  3 storage class 
-000017c0: 696e 2074 6865 2063 6f6e 6669 6720 6f62  in the config ob
-000017d0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
-000017e0: 2073 656c 662e 7374 6f72 6167 655f 636c   self.storage_cl
-000017f0: 6173 7320 3d20 636f 6e66 6967 2e67 6574  ass = config.get
-00001800: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00001810: 2020 2753 3327 2c20 2773 746f 7261 6765    'S3', 'storage
-00001820: 5f63 6c61 7373 272c 2066 616c 6c62 6163  _class', fallbac
-00001830: 6b3d 4e6f 6e65 290a 0a20 2020 2020 2020  k=None)..       
-00001840: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
-00001850: 7333 2063 6f6e 6669 6775 7261 7469 6f6e  s3 configuration
-00001860: 2069 7320 636f 6d70 6c65 7465 0a20 2020   is complete.   
-00001870: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00001880: 2e62 7563 6b65 745f 6e61 6d65 2061 6e64  .bucket_name and
-00001890: 2073 656c 662e 6172 6368 6976 655f 6469   self.archive_di
-000018a0: 7220 616e 6420 7365 6c66 2e73 746f 7261  r and self.stora
-000018b0: 6765 5f63 6c61 7373 3a0a 2020 2020 2020  ge_class:.      
-000018c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-000018d0: 335f 696e 6974 203d 2054 7275 650a 0a20  3_init = True.. 
-000018e0: 2020 2020 2020 2020 2020 2023 2053 6c75             # Slu
-000018f0: 726d 2063 6f6e 6669 6775 7261 7469 6f6e  rm configuration
-00001900: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00001910: 662e 736c 7572 6d5f 7761 6c6c 7469 6d65  f.slurm_walltime
-00001920: 5f64 6179 7320 3d20 636f 6e66 6967 2e67  _days = config.g
-00001930: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-00001940: 2020 2020 2753 4c55 524d 272c 2027 736c      'SLURM', 'sl
-00001950: 7572 6d5f 7761 6c6c 7469 6d65 5f64 6179  urm_walltime_day
-00001960: 7327 2c20 6661 6c6c 6261 636b 3d4e 6f6e  s', fallback=Non
-00001970: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00001980: 7365 6c66 2e73 6c75 726d 5f77 616c 6c74  self.slurm_wallt
-00001990: 696d 655f 686f 7572 7320 3d20 636f 6e66  ime_hours = conf
-000019a0: 6967 2e67 6574 280a 2020 2020 2020 2020  ig.get(.        
-000019b0: 2020 2020 2020 2020 2753 4c55 524d 272c          'SLURM',
-000019c0: 2027 736c 7572 6d5f 7761 6c6c 7469 6d65   'slurm_walltime
-000019d0: 5f68 6f75 7273 272c 2066 616c 6c62 6163  _hours', fallbac
-000019e0: 6b3d 4e6f 6e65 290a 0a20 2020 2020 2020  k=None)..       
-000019f0: 2020 2020 2073 656c 662e 736c 7572 6d5f       self.slurm_
-00001a00: 7061 7274 6974 696f 6e20 3d20 636f 6e66  partition = conf
-00001a10: 6967 2e67 6574 280a 2020 2020 2020 2020  ig.get(.        
-00001a20: 2020 2020 2020 2020 2753 4c55 524d 272c          'SLURM',
-00001a30: 2027 736c 7572 6d5f 7061 7274 6974 696f   'slurm_partitio
-00001a40: 6e27 2c20 6661 6c6c 6261 636b 3d4e 6f6e  n', fallback=Non
-00001a50: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00001a60: 7365 6c66 2e73 6c75 726d 5f71 6f73 203d  self.slurm_qos =
-00001a70: 2063 6f6e 6669 672e 6765 7428 0a20 2020   config.get(.   
-00001a80: 2020 2020 2020 2020 2020 2020 2027 534c               'SL
-00001a90: 5552 4d27 2c20 2773 6c75 726d 5f71 6f73  URM', 'slurm_qos
-00001aa0: 272c 2066 616c 6c62 6163 6b3d 4e6f 6e65  ', fallback=None
-00001ab0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00001ac0: 656c 662e 736c 7572 6d5f 6c73 6372 6174  elf.slurm_lscrat
-00001ad0: 6368 203d 2063 6f6e 6669 672e 6765 7428  ch = config.get(
-00001ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001af0: 2027 534c 5552 4d27 2c20 2773 6c75 726d   'SLURM', 'slurm
-00001b00: 5f6c 7363 7261 7463 6827 2c20 6661 6c6c  _lscratch', fall
-00001b10: 6261 636b 3d4e 6f6e 6529 0a0a 2020 2020  back=None)..    
-00001b20: 2020 2020 2020 2020 7365 6c66 2e6c 7363          self.lsc
-00001b30: 7261 7463 685f 6d6b 6469 7220 3d20 636f  ratch_mkdir = co
-00001b40: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
-00001b50: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
-00001b60: 272c 2027 6c73 6372 6174 6368 5f6d 6b64  ', 'lscratch_mkd
-00001b70: 6972 272c 2066 616c 6c62 6163 6b3d 4e6f  ir', fallback=No
-00001b80: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
-00001b90: 2073 656c 662e 6c73 6372 6174 6368 5f72   self.lscratch_r
-00001ba0: 6d64 6972 203d 2063 6f6e 6669 672e 6765  mdir = config.ge
-00001bb0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00001bc0: 2020 2027 534c 5552 4d27 2c20 276c 7363     'SLURM', 'lsc
-00001bd0: 7261 7463 685f 726d 6469 7227 2c20 6661  ratch_rmdir', fa
-00001be0: 6c6c 6261 636b 3d4e 6f6e 6529 0a0a 2020  llback=None)..  
-00001bf0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00001c00: 7363 7261 7463 685f 726f 6f74 203d 2063  scratch_root = c
-00001c10: 6f6e 6669 672e 6765 7428 0a20 2020 2020  onfig.get(.     
-00001c20: 2020 2020 2020 2020 2020 2027 534c 5552             'SLUR
-00001c30: 4d27 2c20 276c 7363 7261 7463 685f 726f  M', 'lscratch_ro
-00001c40: 6f74 272c 2066 616c 6c62 6163 6b3d 4e6f  ot', fallback=No
-00001c50: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
-00001c60: 2023 2043 6c6f 7564 2063 6f6e 6669 6775   # Cloud configu
-00001c70: 7261 7469 6f6e 0a20 2020 2020 2020 2020  ration.         
-00001c80: 2020 2073 656c 662e 7365 735f 7665 7269     self.ses_veri
-00001c90: 6679 5f72 6571 7565 7374 735f 7365 6e74  fy_requests_sent
-00001ca0: 203d 2063 6f6e 6669 672e 6765 7428 0a20   = config.get(. 
-00001cb0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00001cc0: 434c 4f55 4427 2c20 2773 6573 5f76 6572  CLOUD', 'ses_ver
-00001cd0: 6966 795f 7265 7175 6573 7473 5f73 656e  ify_requests_sen
-00001ce0: 7427 2c20 6661 6c6c 6261 636b 3d5b 5d29  t', fallback=[])
-00001cf0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00001d00: 6c66 2e65 6332 5f6c 6173 745f 696e 7374  lf.ec2_last_inst
-00001d10: 616e 6365 203d 2063 6f6e 6669 672e 6765  ance = config.ge
-00001d20: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00001d30: 2020 2027 434c 4f55 4427 2c20 2765 6332     'CLOUD', 'ec2
-00001d40: 5f6c 6173 745f 696e 7374 616e 6365 272c  _last_instance',
-00001d50: 2066 616c 6c62 6163 6b3d 4e6f 6e65 290a   fallback=None).
-00001d60: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
-00001d70: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00001d80: 2027 2727 2052 6574 7572 6e20 6120 7374   ''' Return a st
-00001d90: 7269 6e67 2072 6570 7265 7365 6e74 6174  ring representat
-00001da0: 696f 6e20 6f66 2074 6865 206f 626a 6563  ion of the objec
-00001db0: 7427 2727 0a0a 2020 2020 2020 2020 7265  t'''..        re
-00001dc0: 7475 726e 2022 3c7b 6b6c 6173 737d 2040  turn "<{klass} @
-00001dd0: 7b69 643a 787d 207b 6174 7472 737d 3e22  {id:x} {attrs}>"
-00001de0: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-00001df0: 2020 2020 206b 6c61 7373 3d73 656c 662e       klass=self.
-00001e00: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00001e10: 5f5f 2c0a 2020 2020 2020 2020 2020 2020  __,.            
-00001e20: 6964 3d69 6428 7365 6c66 2920 2620 3078  id=id(self) & 0x
-00001e30: 4646 4646 4646 2c0a 2020 2020 2020 2020  FFFFFF,.        
-00001e40: 2020 2020 6174 7472 733d 2220 222e 6a6f      attrs=" ".jo
-00001e50: 696e 2822 7b7d 3d7b 2172 7d5c 6e22 2e66  in("{}={!r}\n".f
-00001e60: 6f72 6d61 7428 6b2c 2076 290a 2020 2020  ormat(k, v).    
-00001e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e80: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00001e90: 696e 2073 656c 662e 5f5f 6469 6374 5f5f  in self.__dict__
-00001ea0: 2e69 7465 6d73 2829 292c 0a20 2020 2020  .items()),.     
-00001eb0: 2020 2029 0a0a 2020 2020 6465 6620 6164     )..    def ad
-00001ec0: 645f 6372 6f6e 5f6a 6f62 2873 656c 662c  d_cron_job(self,
-00001ed0: 2063 6d64 2c20 6d69 6e75 7465 2c20 686f   cmd, minute, ho
-00001ee0: 7572 3d27 2a27 2c20 6461 795f 6f66 5f6d  ur='*', day_of_m
-00001ef0: 6f6e 7468 3d27 2a27 2c20 6d6f 6e74 683d  onth='*', month=
-00001f00: 272a 272c 2064 6179 5f6f 665f 7765 656b  '*', day_of_week
-00001f10: 3d27 2a27 293a 0a20 2020 2020 2020 2023  ='*'):.        #
-00001f20: 2046 554e 4354 494f 4e20 4355 5252 454e   FUNCTION CURREN
-00001f30: 544c 5920 4e4f 5420 4245 494e 4720 5553  TLY NOT BEING US
-00001f40: 4544 0a0a 2020 2020 2020 2020 6966 206e  ED..        if n
-00001f50: 6f74 206d 696e 7574 653a 0a20 2020 2020  ot minute:.     
-00001f60: 2020 2020 2020 2070 7269 6e74 2827 596f         print('Yo
-00001f70: 7520 6d75 7374 2073 6574 2074 6865 206d  u must set the m
-00001f80: 696e 7574 6520 2831 2d36 3029 2065 7870  inute (1-60) exp
-00001f90: 6c69 6369 6c79 2729 0a20 2020 2020 2020  licily').       
-00001fa0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00001fb0: 650a 2020 2020 2020 2020 7769 7468 2074  e.        with t
-00001fc0: 656d 7066 696c 652e 4e61 6d65 6454 656d  empfile.NamedTem
-00001fd0: 706f 7261 7279 4669 6c65 2864 656c 6574  poraryFile(delet
-00001fe0: 653d 4661 6c73 6529 2061 7320 7465 6d70  e=False) as temp
-00001ff0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00002000: 4475 6d70 2074 6865 2063 7572 7265 6e74  Dump the current
-00002010: 2063 726f 6e74 6162 2074 6f20 7468 6520   crontab to the 
-00002020: 7465 6d70 6f72 6172 7920 6669 6c65 0a20  temporary file. 
-00002030: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00002040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002050: 6f73 2e73 7973 7465 6d28 2763 726f 6e74  os.system('cront
-00002060: 6162 202d 6c20 3e20 7b7d 272e 666f 726d  ab -l > {}'.form
-00002070: 6174 2874 656d 702e 6e61 6d65 2929 0a20  at(temp.name)). 
-00002080: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00002090: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000020a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000020b0: 2020 7072 696e 7428 6622 4572 726f 723a    print(f"Error:
-000020c0: 207b 657d 222c 2066 696c 653d 7379 732e   {e}", file=sys.
-000020d0: 7374 6465 7272 290a 0a20 2020 2020 2020  stderr)..       
-000020e0: 2020 2020 2023 2041 6464 2074 6865 206e       # Add the n
-000020f0: 6577 2063 726f 6e20 6a6f 6220 746f 2074  ew cron job to t
-00002100: 6865 2074 656d 706f 7261 7279 2066 696c  he temporary fil
-00002110: 650a 2020 2020 2020 2020 2020 2020 6372  e.            cr
-00002120: 6f6e 5f74 696d 6520 3d20 227b 7d20 7b7d  on_time = "{} {}
-00002130: 207b 7d20 7b7d 207b 7d22 2e66 6f72 6d61   {} {} {}".forma
-00002140: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00002150: 2020 2073 7472 286d 696e 7574 6529 2c20     str(minute), 
-00002160: 686f 7572 2c20 6461 795f 6f66 5f6d 6f6e  hour, day_of_mon
-00002170: 7468 2c20 6d6f 6e74 682c 2064 6179 5f6f  th, month, day_o
-00002180: 665f 7765 656b 290a 2020 2020 2020 2020  f_week).        
-00002190: 2020 2020 7769 7468 206f 7065 6e28 7465      with open(te
-000021a0: 6d70 2e6e 616d 652c 2027 6127 2920 6173  mp.name, 'a') as
-000021b0: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
-000021c0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-000021d0: 6528 277b 7d20 7b7d 5c6e 272e 666f 726d  e('{} {}\n'.form
-000021e0: 6174 2863 726f 6e5f 7469 6d65 2c20 636d  at(cron_time, cm
-000021f0: 6429 290a 0a20 2020 2020 2020 2020 2020  d))..           
-00002200: 2023 2049 6e73 7461 6c6c 2074 6865 206e   # Install the n
-00002210: 6577 2063 726f 6e74 6162 0a20 2020 2020  ew crontab.     
-00002220: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00002230: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
-00002240: 7973 7465 6d28 2763 726f 6e74 6162 207b  ystem('crontab {
-00002250: 7d27 2e66 6f72 6d61 7428 7465 6d70 2e6e  }'.format(temp.n
-00002260: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
-00002270: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00002280: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00002290: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-000022a0: 2245 7272 6f72 3a20 7b65 7d22 2c20 6669  "Error: {e}", fi
-000022b0: 6c65 3d73 7973 2e73 7464 6572 7229 0a0a  le=sys.stderr)..
-000022c0: 2020 2020 2020 2020 2020 2020 2320 436c              # Cl
-000022d0: 6561 6e20 7570 2062 7920 7265 6d6f 7669  ean up by removi
-000022e0: 6e67 2074 6865 2074 656d 706f 7261 7279  ng the temporary
-000022f0: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
-00002300: 2020 6f73 2e75 6e6c 696e 6b28 7465 6d70    os.unlink(temp
-00002310: 2e6e 616d 6529 0a0a 2020 2020 2020 2020  .name)..        
-00002320: 7072 696e 7428 2243 726f 6e20 6a6f 6220  print("Cron job 
-00002330: 6164 6465 6421 2229 0a0a 2020 2020 6465  added!")..    de
-00002340: 6620 6164 645f 7379 7374 656d 645f 6372  f add_systemd_cr
-00002350: 6f6e 5f6a 6f62 2873 656c 662c 2063 6d64  on_job(self, cmd
-00002360: 2c20 6d69 6e75 7465 2c20 686f 7572 3d27  , minute, hour='
-00002370: 2a27 293a 0a0a 2020 2020 2020 2020 2320  *'):..        # 
-00002380: 5472 6f75 626c 6573 686f 6f74 2077 6974  Troubleshoot wit
-00002390: 683a 0a20 2020 2020 2020 2023 0a20 2020  h:.        #.   
-000023a0: 2020 2020 2023 206a 6f75 726e 616c 6374       # journalct
-000023b0: 6c20 2d66 202d 2d75 7365 722d 756e 6974  l -f --user-unit
-000023c0: 2066 726f 7374 6572 2d6d 6f6e 6974 6f72   froster-monitor
-000023d0: 2e73 6572 7669 6365 0a20 2020 2020 2020  .service.       
-000023e0: 2023 206a 6f75 726e 616c 6374 6c20 2d66   # journalctl -f
-000023f0: 202d 2d75 7365 722d 756e 6974 2066 726f   --user-unit fro
-00002400: 7374 6572 2d6d 6f6e 6974 6f72 2e74 696d  ster-monitor.tim
-00002410: 6572 0a20 2020 2020 2020 2023 206a 6f75  er.        # jou
-00002420: 726e 616c 6374 6c20 2d2d 7369 6e63 6520  rnalctl --since 
-00002430: 2235 206d 696e 7574 6573 2061 676f 2220  "5 minutes ago" 
-00002440: 7c20 6772 6570 2066 726f 7374 6572 2d6d  | grep froster-m
-00002450: 6f6e 6974 6f72 0a0a 2020 2020 2020 2020  onitor..        
-00002460: 5345 5256 4943 455f 434f 4e54 454e 5420  SERVICE_CONTENT 
-00002470: 3d20 7465 7874 7772 6170 2e64 6564 656e  = textwrap.deden
-00002480: 7428 6622 2222 0a20 2020 2020 2020 205b  t(f""".        [
-00002490: 556e 6974 5d0a 2020 2020 2020 2020 4465  Unit].        De
-000024a0: 7363 7269 7074 696f 6e3d 5275 6e20 4672  scription=Run Fr
-000024b0: 6f73 7465 722d 4d6f 6e69 746f 7220 4372  oster-Monitor Cr
-000024c0: 6f6e 204a 6f62 0a0a 2020 2020 2020 2020  on Job..        
-000024d0: 5b53 6572 7669 6365 5d0a 2020 2020 2020  [Service].      
-000024e0: 2020 5479 7065 3d73 696d 706c 650a 2020    Type=simple.  
-000024f0: 2020 2020 2020 4578 6563 5374 6172 743d        ExecStart=
-00002500: 7b63 6d64 7d0a 0a20 2020 2020 2020 205b  {cmd}..        [
-00002510: 496e 7374 616c 6c5d 0a20 2020 2020 2020  Install].       
-00002520: 2057 616e 7465 6442 793d 6465 6661 756c   WantedBy=defaul
-00002530: 742e 7461 7267 6574 0a20 2020 2020 2020  t.target.       
-00002540: 2022 2222 290a 0a20 2020 2020 2020 2054   """)..        T
-00002550: 494d 4552 5f43 4f4e 5445 4e54 203d 2074  IMER_CONTENT = t
-00002560: 6578 7477 7261 702e 6465 6465 6e74 2866  extwrap.dedent(f
-00002570: 2222 220a 2020 2020 2020 2020 5b55 6e69  """.        [Uni
-00002580: 745d 0a20 2020 2020 2020 2044 6573 6372  t].        Descr
-00002590: 6970 7469 6f6e 3d52 756e 2046 726f 7374  iption=Run Frost
-000025a0: 6572 2d4d 6f6e 6974 6f72 2043 726f 6e20  er-Monitor Cron 
-000025b0: 4a6f 6220 686f 7572 6c79 0a0a 2020 2020  Job hourly..    
-000025c0: 2020 2020 5b54 696d 6572 5d0a 2020 2020      [Timer].    
-000025d0: 2020 2020 5065 7273 6973 7465 6e74 3d74      Persistent=t
-000025e0: 7275 650a 2020 2020 2020 2020 4f6e 4361  rue.        OnCa
-000025f0: 6c65 6e64 6172 3d2a 2d2a 2d2a 207b 686f  lendar=*-*-* {ho
-00002600: 7572 7d3a 7b6d 696e 7574 657d 3a30 300a  ur}:{minute}:00.
-00002610: 2020 2020 2020 2020 2352 616e 646f 6d69          #Randomi
-00002620: 7a65 6444 656c 6179 5365 633d 3330 300a  zedDelaySec=300.
-00002630: 2020 2020 2020 2020 2346 6978 6564 5261          #FixedRa
-00002640: 6e64 6f6d 4465 6c61 793d 7472 7565 0a20  ndomDelay=true. 
-00002650: 2020 2020 2020 2023 4f6e 426f 6f74 5365         #OnBootSe
-00002660: 633d 3138 300a 2020 2020 2020 2020 234f  c=180.        #O
-00002670: 6e55 6e69 7441 6374 6976 6553 6563 3d33  nUnitActiveSec=3
-00002680: 3630 300a 2020 2020 2020 2020 556e 6974  600.        Unit
-00002690: 3d66 726f 7374 6572 2d6d 6f6e 6974 6f72  =froster-monitor
-000026a0: 2e73 6572 7669 6365 0a0a 2020 2020 2020  .service..      
-000026b0: 2020 5b49 6e73 7461 6c6c 5d0a 2020 2020    [Install].    
-000026c0: 2020 2020 5761 6e74 6564 4279 3d74 696d      WantedBy=tim
-000026d0: 6572 732e 7461 7267 6574 0a20 2020 2020  ers.target.     
-000026e0: 2020 2022 2222 290a 0a20 2020 2020 2020     """)..       
-000026f0: 2023 2045 6e73 7572 6520 7468 6520 6469   # Ensure the di
-00002700: 7265 6374 6f72 7920 6578 6973 7473 0a20  rectory exists. 
-00002710: 2020 2020 2020 2023 2054 4f44 4f3a 2043         # TODO: C
-00002720: 6865 636b 2074 6869 7320 7061 7468 0a20  heck this path. 
-00002730: 2020 2020 2020 2075 7365 725f 7379 7374         user_syst
-00002740: 656d 645f 6469 7220 3d20 6f73 2e70 6174  emd_dir = os.pat
-00002750: 682e 6578 7061 6e64 7573 6572 2822 7e2f  h.expanduser("~/
-00002760: 2e63 6f6e 6669 672f 7379 7374 656d 642f  .config/systemd/
-00002770: 7573 6572 2f22 290a 2020 2020 2020 2020  user/").        
-00002780: 6f73 2e6d 616b 6564 6972 7328 7573 6572  os.makedirs(user
-00002790: 5f73 7973 7465 6d64 5f64 6972 2c20 6578  _systemd_dir, ex
-000027a0: 6973 745f 6f6b 3d54 7275 652c 206d 6f64  ist_ok=True, mod
-000027b0: 653d 306f 3737 3529 0a0a 2020 2020 2020  e=0o775)..      
-000027c0: 2020 5345 5256 4943 455f 5041 5448 203d    SERVICE_PATH =
-000027d0: 206f 732e 7061 7468 2e6a 6f69 6e28 0a20   os.path.join(. 
-000027e0: 2020 2020 2020 2020 2020 2075 7365 725f             user_
-000027f0: 7379 7374 656d 645f 6469 722c 2022 6672  systemd_dir, "fr
-00002800: 6f73 7465 722d 6d6f 6e69 746f 722e 7365  oster-monitor.se
-00002810: 7276 6963 6522 290a 2020 2020 2020 2020  rvice").        
-00002820: 5449 4d45 525f 5041 5448 203d 206f 732e  TIMER_PATH = os.
-00002830: 7061 7468 2e6a 6f69 6e28 7573 6572 5f73  path.join(user_s
-00002840: 7973 7465 6d64 5f64 6972 2c20 2266 726f  ystemd_dir, "fro
-00002850: 7374 6572 2d6d 6f6e 6974 6f72 2e74 696d  ster-monitor.tim
-00002860: 6572 2229 0a0a 2020 2020 2020 2020 2320  er")..        # 
-00002870: 4372 6561 7465 2073 6572 7669 6365 2061  Create service a
-00002880: 6e64 2074 696d 6572 2066 696c 6573 0a20  nd timer files. 
-00002890: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-000028a0: 2853 4552 5649 4345 5f50 4154 482c 2022  (SERVICE_PATH, "
-000028b0: 7722 2920 6173 2073 6572 7669 6365 5f66  w") as service_f
-000028c0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-000028d0: 2073 6572 7669 6365 5f66 696c 652e 7772   service_file.wr
-000028e0: 6974 6528 5345 5256 4943 455f 434f 4e54  ite(SERVICE_CONT
-000028f0: 454e 5429 0a0a 2020 2020 2020 2020 7769  ENT)..        wi
-00002900: 7468 206f 7065 6e28 5449 4d45 525f 5041  th open(TIMER_PA
-00002910: 5448 2c20 2277 2229 2061 7320 7469 6d65  TH, "w") as time
-00002920: 725f 6669 6c65 3a0a 2020 2020 2020 2020  r_file:.        
-00002930: 2020 2020 7469 6d65 725f 6669 6c65 2e77      timer_file.w
-00002940: 7269 7465 2854 494d 4552 5f43 4f4e 5445  rite(TIMER_CONTE
-00002950: 4e54 290a 0a20 2020 2020 2020 2023 2052  NT)..        # R
-00002960: 656c 6f61 6420 7379 7374 656d 6420 616e  eload systemd an
-00002970: 6420 656e 6162 6c65 2f73 7461 7274 2074  d enable/start t
-00002980: 696d 6572 0a20 2020 2020 2020 2074 7279  imer.        try
-00002990: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-000029a0: 2e63 6864 6972 2875 7365 725f 7379 7374  .chdir(user_syst
-000029b0: 656d 645f 6469 7229 0a20 2020 2020 2020  emd_dir).       
-000029c0: 2020 2020 206f 732e 7379 7374 656d 2822       os.system("
-000029d0: 7379 7374 656d 6374 6c20 2d2d 7573 6572  systemctl --user
-000029e0: 2064 6165 6d6f 6e2d 7265 6c6f 6164 2229   daemon-reload")
-000029f0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00002a00: 7379 7374 656d 2822 7379 7374 656d 6374  system("systemct
-00002a10: 6c20 2d2d 7573 6572 2065 6e61 626c 6520  l --user enable 
-00002a20: 6672 6f73 7465 722d 6d6f 6e69 746f 722e  froster-monitor.
-00002a30: 7365 7276 6963 6522 290a 2020 2020 2020  service").      
-00002a40: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
-00002a50: 2273 7973 7465 6d63 746c 202d 2d75 7365  "systemctl --use
-00002a60: 7220 656e 6162 6c65 2066 726f 7374 6572  r enable froster
-00002a70: 2d6d 6f6e 6974 6f72 2e74 696d 6572 2229  -monitor.timer")
-00002a80: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00002a90: 7379 7374 656d 2822 7379 7374 656d 6374  system("systemct
-00002aa0: 6c20 2d2d 7573 6572 2073 7461 7274 2066  l --user start f
-00002ab0: 726f 7374 6572 2d6d 6f6e 6974 6f72 2e74  roster-monitor.t
-00002ac0: 696d 6572 2229 0a20 2020 2020 2020 2020  imer").         
-00002ad0: 2020 2070 7269 6e74 2822 5379 7374 656d     print("System
-00002ae0: 6420 6672 6f73 7465 722d 6d6f 6e69 746f  d froster-monito
-00002af0: 722e 7469 6d65 7220 6372 6f6e 206a 6f62  r.timer cron job
-00002b00: 2073 7461 7274 6564 2122 290a 2020 2020   started!").    
-00002b10: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00002b20: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00002b30: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00002b40: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00002b50: 436f 756c 6420 6e6f 7420 6164 6420 7379  Could not add sy
-00002b60: 7374 656d 6420 7363 6865 6475 6c65 7220  stemd scheduler 
-00002b70: 6a6f 622c 2045 7272 6f72 3a20 7b65 7d27  job, Error: {e}'
-00002b80: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
-00002b90: 7229 0a0a 2020 2020 6465 6620 6173 7375  r)..    def assu
-00002ba0: 7265 5f70 6572 6d69 7373 696f 6e73 5f61  re_permissions_a
-00002bb0: 6e64 5f67 726f 7570 2873 656c 662c 2064  nd_group(self, d
-00002bc0: 6972 6563 746f 7279 293a 0a20 2020 2020  irectory):.     
-00002bd0: 2020 2027 2727 4173 7375 7265 2063 6f72     '''Assure cor
-00002be0: 7265 6374 2070 6572 6d69 7373 696f 6e73  rect permissions
-00002bf0: 2061 6e64 2067 726f 7570 4944 206f 6620   and groupID of 
-00002c00: 6120 6469 7265 6374 6f72 7927 2727 0a20  a directory'''. 
-00002c10: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
-00002c20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00002c30: 6f73 2e70 6174 682e 6973 6469 7228 6469  os.path.isdir(di
-00002c40: 7265 6374 6f72 7929 3a0a 2020 2020 2020  rectory):.      
-00002c50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00002c60: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00002c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c80: 6627 7b69 6e73 7065 6374 2e63 7572 7265  f'{inspect.curre
-00002c90: 6e74 6672 616d 6528 292e 665f 636f 6465  ntframe().f_code
-00002ca0: 2e63 6f5f 6e61 6d65 7d3a 2074 7269 6564  .co_name}: tried
-00002cb0: 2074 6f20 6669 7820 7065 726d 6973 7369   to fix permissi
-00002cc0: 6f6e 7320 6f66 2061 206e 6f6e 2d64 6972  ons of a non-dir
-00002cd0: 6563 746f 7279 2022 7b64 6972 6563 746f  ectory "{directo
-00002ce0: 7279 7d22 2729 0a0a 2020 2020 2020 2020  ry}"')..        
-00002cf0: 2020 2020 2320 4765 7420 7468 6520 6772      # Get the gr
-00002d00: 6f75 7020 4944 206f 6620 7468 6520 6469  oup ID of the di
-00002d10: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
-00002d20: 2020 2020 6469 725f 7374 6174 203d 206f      dir_stat = o
-00002d30: 732e 7374 6174 2864 6972 6563 746f 7279  s.stat(directory
-00002d40: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-00002d50: 725f 6769 6420 3d20 6469 725f 7374 6174  r_gid = dir_stat
-00002d60: 2e73 745f 6769 640a 0a20 2020 2020 2020  .st_gid..       
-00002d70: 2020 2020 2023 2043 6861 6e67 6520 7468       # Change th
-00002d80: 6520 7065 726d 6973 7369 6f6e 7320 6f66  e permissions of
-00002d90: 2074 6865 2064 6972 6563 746f 7279 2074   the directory t
-00002da0: 6f20 306f 3237 3735 0a20 2020 2020 2020  o 0o2775.       
-00002db0: 2020 2020 206f 732e 6368 6d6f 6428 6469       os.chmod(di
-00002dc0: 7265 6374 6f72 792c 2030 6f32 3737 3529  rectory, 0o2775)
-00002dd0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00002de0: 4974 6572 6174 6520 6f76 6572 2061 6c6c  Iterate over all
-00002df0: 2066 696c 6573 2061 6e64 2064 6972 6563   files and direc
-00002e00: 746f 7269 6573 2069 6e20 7468 6520 6469  tories in the di
-00002e10: 7265 6374 6f72 7920 616e 6420 6974 7320  rectory and its 
-00002e20: 7375 6264 6972 6563 746f 7269 6573 0a20  subdirectories. 
-00002e30: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00002e40: 6f6f 742c 2064 6972 732c 2066 696c 6573  oot, dirs, files
-00002e50: 2069 6e20 6f73 2e77 616c 6b28 6469 7265   in os.walk(dire
-00002e60: 6374 6f72 7929 3a0a 2020 2020 2020 2020  ctory):.        
-00002e70: 2020 2020 2020 2020 666f 7220 6469 7220          for dir 
-00002e80: 696e 2064 6972 733a 0a20 2020 2020 2020  in dirs:.       
-00002e90: 2020 2020 2020 2020 2020 2020 2064 6972               dir
-00002ea0: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
-00002eb0: 6a6f 696e 2872 6f6f 742c 2064 6972 290a  join(root, dir).
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ed0: 2020 2020 2320 4368 616e 6765 2074 6865      # Change the
-00002ee0: 2070 6572 6d69 7373 696f 6e73 206f 6620   permissions of 
-00002ef0: 7468 6520 7375 6264 6972 6563 746f 7279  the subdirectory
-00002f00: 2074 6f20 306f 3237 3735 0a20 2020 2020   to 0o2775.     
-00002f10: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00002f20: 732e 6368 6d6f 6428 6469 725f 7061 7468  s.chmod(dir_path
-00002f30: 2c20 306f 3237 3735 290a 0a20 2020 2020  , 0o2775)..     
-00002f40: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00002f50: 696c 6520 696e 2066 696c 6573 3a0a 2020  ile in files:.  
-00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f70: 2020 7061 7468 203d 206f 732e 7061 7468    path = os.path
-00002f80: 2e6a 6f69 6e28 726f 6f74 2c20 6669 6c65  .join(root, file
-00002f90: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00002fa0: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
-00002fb0: 2066 696c 6520 6578 7465 6e73 696f 6e0a   file extension.
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fd0: 2020 2020 5f2c 2065 7874 656e 7369 6f6e      _, extension
-00002fe0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00002ff0: 6578 7428 7061 7468 290a 0a20 2020 2020  ext(path)..     
-00003000: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00003010: 2049 6620 7468 6520 6669 6c65 2069 7320   If the file is 
-00003020: 6120 2e70 656d 2066 696c 650a 2020 2020  a .pem file.    
-00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003040: 6966 2065 7874 656e 7369 6f6e 203d 3d20  if extension == 
-00003050: 272e 7065 6d27 3a0a 2020 2020 2020 2020  '.pem':.        
-00003060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003070: 2320 4368 616e 6765 2074 6865 2070 6572  # Change the per
-00003080: 6d69 7373 696f 6e73 2074 6f20 3430 300a  missions to 400.
-00003090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030a0: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
-000030b0: 2870 6174 682c 2030 6f34 3030 290a 2020  (path, 0o400).  
-000030c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000000a0: 6573 0a66 726f 6d20 7465 7874 7561 6c2e  es.from textual.
+000000b0: 7769 6467 6574 7320 696d 706f 7274 2044  widgets import D
+000000c0: 6174 6154 6162 6c65 2c20 466f 6f74 6572  ataTable, Footer
+000000d0: 2c20 4275 7474 6f6e 0a66 726f 6d20 7465  , Button.from te
+000000e0: 7874 7561 6c2e 7769 6467 6574 7320 696d  xtual.widgets im
+000000f0: 706f 7274 204c 6162 656c 2c20 496e 7075  port Label, Inpu
+00000100: 742c 204c 6f61 6469 6e67 496e 6469 6361  t, LoadingIndica
+00000110: 746f 720a 6672 6f6d 2074 6578 7475 616c  tor.from textual
+00000120: 2e73 6372 6565 6e20 696d 706f 7274 204d  .screen import M
+00000130: 6f64 616c 5363 7265 656e 0a66 726f 6d20  odalScreen.from 
+00000140: 7465 7874 7561 6c2e 636f 6e74 6169 6e65  textual.containe
+00000150: 7273 2069 6d70 6f72 7420 486f 7269 7a6f  rs import Horizo
+00000160: 6e74 616c 2c20 5665 7274 6963 616c 0a66  ntal, Vertical.f
+00000170: 726f 6d20 7465 7874 7561 6c2e 6170 7020  rom textual.app 
+00000180: 696d 706f 7274 2041 7070 2c20 436f 6d70  import App, Comp
+00000190: 6f73 6552 6573 756c 740a 6672 6f6d 2074  oseResult.from t
+000001a0: 6578 7475 616c 2069 6d70 6f72 7420 6f6e  extual import on
+000001b0: 2c20 776f 726b 0a69 6d70 6f72 7420 7073  , work.import ps
+000001c0: 7574 696c 0a69 6d70 6f72 7420 626f 746f  util.import boto
+000001d0: 636f 7265 0a69 6d70 6f72 7420 626f 746f  core.import boto
+000001e0: 330a 696d 706f 7274 2064 7563 6b64 620a  3.import duckdb.
+000001f0: 696d 706f 7274 2072 6571 7565 7374 730a  import requests.
+00000200: 696d 706f 7274 2069 6e71 7569 7265 720a  import inquirer.
+00000210: 696d 706f 7274 2073 7973 0a69 6d70 6f72  import sys.impor
+00000220: 7420 6f73 0a69 6d70 6f72 7420 6172 6770  t os.import argp
+00000230: 6172 7365 0a69 6d70 6f72 7420 6a73 6f6e  arse.import json
+00000240: 0a69 6d70 6f72 7420 636f 6e66 6967 7061  .import configpa
+00000250: 7273 6572 0a69 6d70 6f72 7420 6373 760a  rser.import csv.
+00000260: 696d 706f 7274 2070 6c61 7466 6f72 6d0a  import platform.
+00000270: 696d 706f 7274 2061 7379 6e63 696f 0a69  import asyncio.i
+00000280: 6d70 6f72 7420 7374 6174 0a69 6d70 6f72  mport stat.impor
+00000290: 7420 6461 7465 7469 6d65 0a69 6d70 6f72  t datetime.impor
+000002a0: 7420 7461 7266 696c 650a 696d 706f 7274  t tarfile.import
+000002b0: 2074 6578 7477 7261 700a 696d 706f 7274   textwrap.import
+000002c0: 2074 6172 6669 6c65 0a69 6d70 6f72 7420   tarfile.import 
+000002d0: 7469 6d65 0a69 6d70 6f72 7420 706c 6174  time.import plat
+000002e0: 666f 726d 0a69 6d70 6f72 7420 636f 6e63  form.import conc
+000002f0: 7572 7265 6e74 2e66 7574 7572 6573 0a69  urrent.futures.i
+00000300: 6d70 6f72 7420 6861 7368 6c69 620a 696d  mport hashlib.im
+00000310: 706f 7274 2066 6e6d 6174 6368 0a69 6d70  port fnmatch.imp
+00000320: 6f72 7420 696f 0a69 6d70 6f72 7420 6d61  ort io.import ma
+00000330: 7468 0a69 6d70 6f72 7420 7369 676e 616c  th.import signal
+00000340: 0a69 6d70 6f72 7420 7368 6c65 780a 696d  .import shlex.im
+00000350: 706f 7274 2073 6875 7469 6c0a 696d 706f  port shutil.impo
+00000360: 7274 2074 656d 7066 696c 650a 696d 706f  rt tempfile.impo
+00000370: 7274 2073 7562 7072 6f63 6573 730a 696d  rt subprocess.im
+00000380: 706f 7274 2069 7465 7274 6f6f 6c73 0a69  port itertools.i
+00000390: 6d70 6f72 7420 736f 636b 6574 0a69 6d70  mport socket.imp
+000003a0: 6f72 7420 696e 7370 6563 740a 696d 706f  ort inspect.impo
+000003b0: 7274 2067 6574 7061 7373 0a69 6d70 6f72  rt getpass.impor
+000003c0: 7420 7077 640a 696d 706f 7274 2067 7270  t pwd.import grp
+000003d0: 0a69 6d70 6f72 7420 7374 6174 0a69 6d70  .import stat.imp
+000003e0: 6f72 7420 7265 0a69 6d70 6f72 7420 7572  ort re.import ur
+000003f0: 6c6c 6962 2e70 6172 7365 0a69 6d70 6f72  llib.parse.impor
+00000400: 7420 7472 6163 6562 6163 6b0a 696d 706f  t traceback.impo
+00000410: 7274 2070 6b67 5f72 6573 6f75 7263 6573  rt pkg_resources
+00000420: 0a0a 6672 6f6d 2070 6174 686c 6962 2069  ..from pathlib i
+00000430: 6d70 6f72 7420 5061 7468 0a0a 696d 706f  mport Path..impo
+00000440: 7274 2077 6172 6e69 6e67 730a 7761 726e  rt warnings.warn
+00000450: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
+00000460: 6e67 7328 2261 6c77 6179 7322 2c20 6361  ngs("always", ca
+00000470: 7465 676f 7279 3d52 6573 6f75 7263 6557  tegory=ResourceW
+00000480: 6172 6e69 6e67 290a 7761 726e 696e 6773  arning).warnings
+00000490: 2e66 696c 7465 7277 6172 6e69 6e67 7328  .filterwarnings(
+000004a0: 2269 676e 6f72 6522 2c20 6361 7465 676f  "ignore", catego
+000004b0: 7279 3d52 6573 6f75 7263 6557 6172 6e69  ry=ResourceWarni
+000004c0: 6e67 290a 0a23 2073 7475 6666 2066 726f  ng)..# stuff fro
+000004d0: 6d20 7079 7069 0a0a 0a63 6c61 7373 2043  m pypi...class C
+000004e0: 6f6e 6669 674d 616e 6167 6572 3a0a 2020  onfigManager:.  
+000004f0: 2020 2727 2720 4672 6f73 7465 7220 636f    ''' Froster co
+00000500: 6e66 6967 7572 6174 696f 6e20 6d61 6e61  nfiguration mana
+00000510: 6765 720a 0a20 2020 2054 6869 7320 636c  ger..    This cl
+00000520: 6173 7320 6d61 6e61 6765 7320 7468 6520  ass manages the 
+00000530: 636f 6e66 6967 7572 6174 696f 6e20 6f66  configuration of
+00000540: 2046 726f 7374 6572 2e0a 2020 2020 4974   Froster..    It
+00000550: 2072 6561 6473 2061 6e64 2077 7269 7465   reads and write
+00000560: 7320 7468 6520 636f 6e66 6967 7572 6174  s the configurat
+00000570: 696f 6e20 6669 6c65 732e 2727 270a 0a20  ion files.'''.. 
+00000580: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00000590: 7365 6c66 293a 0a20 2020 2020 2020 2027  self):.        '
+000005a0: 2727 2049 6e69 7469 616c 697a 6520 7468  '' Initialize th
+000005b0: 6520 436f 6e66 6967 4d61 6e61 6765 7220  e ConfigManager 
+000005c0: 6f62 6a65 6374 0a0a 2020 2020 2020 2020  object..        
+000005d0: 5468 6973 2066 756e 6374 696f 6e20 696e  This function in
+000005e0: 6974 6961 6c69 7a65 7320 7468 6520 436f  itializes the Co
+000005f0: 6e66 6967 4d61 6e61 6765 7220 6f62 6a65  nfigManager obje
+00000600: 6374 2077 6974 6820 6465 6661 756c 7420  ct with default 
+00000610: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+00000620: 5468 656e 2069 7420 7265 6164 7320 7468  Then it reads th
+00000630: 6520 636f 6e66 6967 7572 6174 696f 6e20  e configuration 
+00000640: 6669 6c65 2028 6966 2065 7869 7374 7329  file (if exists)
+00000650: 2061 6e64 2070 6f70 756c 6174 6573 2074   and populates t
+00000660: 6865 206f 626a 6563 7420 7661 7269 6162  he object variab
+00000670: 6c65 732e 0a20 2020 2020 2020 2049 7420  les..        It 
+00000680: 666f 6c6c 6f77 7320 7468 6520 5844 4720  follows the XDG 
+00000690: 4261 7365 2044 6972 6563 746f 7279 2063  Base Directory c
+000006a0: 6f6e 7665 6e74 696f 6e73 3a0a 2020 2020  onventions:.    
+000006b0: 2020 2020 6874 7470 733a 2f2f 7370 6563      https://spec
+000006c0: 6966 6963 6174 696f 6e73 2e66 7265 6564  ifications.freed
+000006d0: 6573 6b74 6f70 2e6f 7267 2f62 6173 6564  esktop.org/based
+000006e0: 6972 2d73 7065 632f 6261 7365 6469 722d  ir-spec/basedir-
+000006f0: 7370 6563 2d6c 6174 6573 742e 6874 6d6c  spec-latest.html
+00000700: 0a20 2020 2020 2020 2027 2727 0a0a 2020  .        '''..  
+00000710: 2020 2020 2020 2320 4465 6275 673a 2070        # Debug: p
+00000720: 7269 6e74 2063 7572 7265 6e74 2066 756e  rint current fun
+00000730: 6374 696f 6e20 6e61 6d65 0a20 2020 2020  ction name.     
+00000740: 2020 2070 7269 6e74 6462 6728 6627 7b69     printdbg(f'{i
+00000750: 6e73 7065 6374 2e73 7461 636b 2829 5b30  nspect.stack()[0
+00000760: 5d5b 335d 7d5c 6e27 290a 0a20 2020 2020  ][3]}\n')..     
+00000770: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+00000780: 7468 6520 6669 6c65 6e61 6d65 2076 6172  the filename var
+00000790: 6961 626c 6573 2074 6861 7420 6172 6520  iables that are 
+000007a0: 6e65 6564 6564 2065 6c73 6577 6865 7265  needed elsewhere
+000007b0: 0a20 2020 2020 2020 2073 656c 662e 6172  .        self.ar
+000007c0: 6368 6976 655f 6a73 6f6e 5f66 696c 655f  chive_json_file_
+000007d0: 6e61 6d65 203d 2027 6672 6f73 7465 722d  name = 'froster-
+000007e0: 6172 6368 6976 6573 2e6a 736f 6e27 0a20  archives.json'. 
+000007f0: 2020 2020 2020 2073 656c 662e 7368 6172         self.shar
+00000800: 6564 5f63 6f6e 6669 675f 6669 6c65 5f6e  ed_config_file_n
+00000810: 616d 6520 3d20 2773 6861 7265 645f 636f  ame = 'shared_co
+00000820: 6e66 6967 2e69 6e69 270a 0a20 2020 2020  nfig.ini'..     
+00000830: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+00000840: 7468 6520 7661 7269 6162 6c65 7320 7468  the variables th
+00000850: 6174 2063 6865 636b 2069 6620 7370 6563  at check if spec
+00000860: 6966 6963 2063 6f6e 6669 6775 7261 7469  ific configurati
+00000870: 6f6e 2073 6563 7469 6f6e 7320 6861 7665  on sections have
+00000880: 2062 6565 6e20 696e 6974 6961 6c69 7a65   been initialize
+00000890: 640a 2020 2020 2020 2020 7365 6c66 2e75  d.        self.u
+000008a0: 7365 725f 696e 6974 203d 2046 616c 7365  ser_init = False
+000008b0: 0a20 2020 2020 2020 2073 656c 662e 6177  .        self.aw
+000008c0: 735f 696e 6974 203d 2046 616c 7365 0a20  s_init = False. 
+000008d0: 2020 2020 2020 2073 656c 662e 6e69 685f         self.nih_
+000008e0: 696e 6974 203d 2046 616c 7365 0a20 2020  init = False.   
+000008f0: 2020 2020 2073 656c 662e 7333 5f69 6e69       self.s3_ini
+00000900: 7420 3d20 4661 6c73 650a 2020 2020 2020  t = False.      
+00000910: 2020 7365 6c66 2e63 6f6e 6669 6775 7261    self.configura
+00000920: 7469 6f6e 5f64 6f6e 6520 3d20 4661 6c73  tion_done = Fals
+00000930: 650a 0a20 2020 2020 2020 2023 2057 686f  e..        # Who
+00000940: 616d 690a 2020 2020 2020 2020 7365 6c66  ami.        self
+00000950: 2e77 686f 616d 6920 3d20 6765 7470 6173  .whoami = getpas
+00000960: 732e 6765 7475 7365 7228 290a 0a20 2020  s.getuser()..   
+00000970: 2020 2020 2023 2045 7870 616e 6420 7468       # Expand th
+00000980: 6520 7e20 7379 6d62 6f6c 7320 746f 2075  e ~ symbols to u
+00000990: 7365 7227 7320 686f 6d65 2064 6972 6563  ser's home direc
+000009a0: 746f 7279 0a20 2020 2020 2020 2073 656c  tory.        sel
+000009b0: 662e 686f 6d65 5f64 6972 203d 206f 732e  f.home_dir = os.
+000009c0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+000009d0: 277e 2729 0a0a 2020 2020 2020 2020 2320  '~')..        # 
+000009e0: 4672 6f73 7465 7227 7320 686f 6d65 2064  Froster's home d
+000009f0: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
+00000a00: 2073 656c 662e 6672 6f73 7465 725f 6469   self.froster_di
+00000a10: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
+00000a20: 2873 7973 2e70 7265 6669 7829 0a0a 2020  (sys.prefix)..  
+00000a30: 2020 2020 2020 2320 4672 6f73 7465 7227        # Froster'
+00000a40: 7320 6269 6e61 7279 2064 6972 6563 746f  s binary directo
+00000a50: 7279 0a20 2020 2020 2020 2073 656c 662e  ry.        self.
+00000a60: 6269 6e5f 6469 7220 3d20 6f73 2e70 6174  bin_dir = os.pat
+00000a70: 682e 6a6f 696e 2873 656c 662e 6672 6f73  h.join(self.fros
+00000a80: 7465 725f 6469 722c 2027 6269 6e27 290a  ter_dir, 'bin').
+00000a90: 0a20 2020 2020 2020 2023 2046 726f 7374  .        # Frost
+00000aa0: 6572 2773 2064 6174 6120 6469 7265 6374  er's data direct
+00000ab0: 6f72 790a 2020 2020 2020 2020 7864 675f  ory.        xdg_
+00000ac0: 6461 7461 5f68 6f6d 6520 3d20 6f73 2e65  data_home = os.e
+00000ad0: 6e76 6972 6f6e 2e67 6574 2827 5844 475f  nviron.get('XDG_
+00000ae0: 4441 5441 5f48 4f4d 4527 290a 0a20 2020  DATA_HOME')..   
+00000af0: 2020 2020 2069 6620 7864 675f 6461 7461       if xdg_data
+00000b00: 5f68 6f6d 653a 0a20 2020 2020 2020 2020  _home:.         
+00000b10: 2020 2073 656c 662e 6461 7461 5f64 6972     self.data_dir
+00000b20: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00000b30: 7864 675f 6461 7461 5f68 6f6d 652c 2027  xdg_data_home, '
+00000b40: 6672 6f73 7465 7227 290a 2020 2020 2020  froster').      
+00000b50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00000b60: 2020 2020 7365 6c66 2e64 6174 615f 6469      self.data_di
+00000b70: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
+00000b80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00000b90: 2020 7365 6c66 2e68 6f6d 655f 6469 722c    self.home_dir,
+00000ba0: 2027 2e6c 6f63 616c 272c 2027 7368 6172   '.local', 'shar
+00000bb0: 6527 2c20 2766 726f 7374 6572 2729 0a0a  e', 'froster')..
+00000bc0: 2020 2020 2020 2020 7365 6c66 2e73 6c75          self.slu
+00000bd0: 726d 5f64 6972 203d 206f 732e 7061 7468  rm_dir = os.path
+00000be0: 2e6a 6f69 6e28 7365 6c66 2e64 6174 615f  .join(self.data_
+00000bf0: 6469 722c 2027 736c 7572 6d27 290a 0a20  dir, 'slurm').. 
+00000c00: 2020 2020 2020 2023 2046 726f 7374 6572         # Froster
+00000c10: 2773 2063 6f6e 6669 6775 7261 7469 6f6e  's configuration
+00000c20: 2064 6972 6563 746f 7279 0a20 2020 2020   directory.     
+00000c30: 2020 2078 6467 5f63 6f6e 6669 675f 686f     xdg_config_ho
+00000c40: 6d65 203d 206f 732e 656e 7669 726f 6e2e  me = os.environ.
+00000c50: 6765 7428 2758 4447 5f43 4f4e 4649 475f  get('XDG_CONFIG_
+00000c60: 484f 4d45 2729 0a0a 2020 2020 2020 2020  HOME')..        
+00000c70: 6966 2078 6467 5f63 6f6e 6669 675f 686f  if xdg_config_ho
+00000c80: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00000c90: 7365 6c66 2e63 6f6e 6669 675f 6469 7220  self.config_dir 
+00000ca0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2878  = os.path.join(x
+00000cb0: 6467 5f63 6f6e 6669 675f 686f 6d65 2c20  dg_config_home, 
+00000cc0: 2766 726f 7374 6572 2729 0a20 2020 2020  'froster').     
+00000cd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00000ce0: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
+00000cf0: 5f64 6972 203d 206f 732e 7061 7468 2e6a  _dir = os.path.j
+00000d00: 6f69 6e28 7365 6c66 2e68 6f6d 655f 6469  oin(self.home_di
+00000d10: 722c 2027 2e63 6f6e 6669 6727 2c20 2766  r, '.config', 'f
+00000d20: 726f 7374 6572 2729 0a0a 2020 2020 2020  roster')..      
+00000d30: 2020 2320 4672 6f73 7465 7227 7320 636f    # Froster's co
+00000d40: 6e66 6967 7572 6174 696f 6e20 6669 6c65  nfiguration file
+00000d50: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+00000d60: 6e66 6967 5f66 696c 6520 3d20 6f73 2e70  nfig_file = os.p
+00000d70: 6174 682e 6a6f 696e 2873 656c 662e 636f  ath.join(self.co
+00000d80: 6e66 6967 5f64 6972 2c20 2763 6f6e 6669  nfig_dir, 'confi
+00000d90: 672e 696e 6927 290a 0a20 2020 2020 2020  g.ini')..       
+00000da0: 2023 2046 726f 7374 6572 2773 2061 7263   # Froster's arc
+00000db0: 6869 7665 206a 736f 6e20 6669 6c65 0a20  hive json file. 
+00000dc0: 2020 2020 2020 2073 656c 662e 6172 6368         self.arch
+00000dd0: 6976 655f 6a73 6f6e 203d 206f 732e 7061  ive_json = os.pa
+00000de0: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
+00000df0: 2020 2020 2073 656c 662e 6461 7461 5f64       self.data_d
+00000e00: 6972 2c20 7365 6c66 2e61 7263 6869 7665  ir, self.archive
+00000e10: 5f6a 736f 6e5f 6669 6c65 5f6e 616d 6529  _json_file_name)
+00000e20: 0a0a 2020 2020 2020 2020 2320 4672 6f73  ..        # Fros
+00000e30: 7465 7227 7320 6465 6661 756c 7420 7368  ter's default sh
+00000e40: 6172 6564 2063 6f6e 6669 6775 7261 7469  ared configurati
+00000e50: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
+00000e60: 6973 5f73 6861 7265 6420 3d20 4661 6c73  is_shared = Fals
+00000e70: 650a 0a20 2020 2020 2020 2023 2042 6173  e..        # Bas
+00000e80: 6963 2073 6574 7570 2c20 666f 6375 7320  ic setup, focus 
+00000e90: 7468 6520 696e 6465 7865 7220 6f6e 206c  the indexer on l
+00000ea0: 6172 6765 7220 666f 6c64 6572 7320 616e  arger folders an
+00000eb0: 6420 6669 6c65 2073 697a 6573 0a20 2020  d file sizes.   
+00000ec0: 2020 2020 2073 656c 662e 6d61 785f 736d       self.max_sm
+00000ed0: 616c 6c5f 6669 6c65 5f73 697a 655f 6b69  all_file_size_ki
+00000ee0: 6220 3d20 3130 3234 0a20 2020 2020 2020  b = 1024.       
+00000ef0: 2073 656c 662e 6d69 6e5f 696e 6465 785f   self.min_index_
+00000f00: 666f 6c64 6572 5f73 697a 655f 6769 6220  folder_size_gib 
+00000f10: 3d20 310a 2020 2020 2020 2020 7365 6c66  = 1.        self
+00000f20: 2e6d 696e 5f69 6e64 6578 5f66 6f6c 6465  .min_index_folde
+00000f30: 725f 7369 7a65 5f61 7667 5f6d 6962 203d  r_size_avg_mib =
+00000f40: 2031 300a 2020 2020 2020 2020 7365 6c66   10.        self
+00000f50: 2e6d 6178 5f68 6f74 7370 6f74 735f 6469  .max_hotspots_di
+00000f60: 7370 6c61 795f 656e 7472 6965 7320 3d20  splay_entries = 
+00000f70: 3530 3030 0a0a 2020 2020 2020 2020 2320  5000..        # 
+00000f80: 4672 6f73 7465 7227 7320 7373 6820 6465  Froster's ssh de
+00000f90: 6661 756c 7420 6b65 7920 6e61 6d65 0a20  fault key name. 
+00000fa0: 2020 2020 2020 2073 656c 662e 7373 685f         self.ssh_
+00000fb0: 6b65 795f 6e61 6d65 203d 2027 6672 6f73  key_name = 'fros
+00000fc0: 7465 722d 6563 3227 0a0a 2020 2020 2020  ter-ec2'..      
+00000fd0: 2020 2320 486f 7473 706f 7473 2064 6972    # Hotspots dir
+00000fe0: 0a20 2020 2020 2020 2073 656c 662e 686f  .        self.ho
+00000ff0: 7473 706f 7473 5f64 6972 203d 206f 732e  tspots_dir = os.
+00001000: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e64  path.join(self.d
+00001010: 6174 615f 6469 722c 2027 686f 7473 706f  ata_dir, 'hotspo
+00001020: 7473 2729 0a0a 2020 2020 2020 2020 2320  ts')..        # 
+00001030: 4368 6563 6b20 6966 2074 6865 7265 2069  Check if there i
+00001040: 7320 6120 7e2f 2e63 6f6e 6669 672f 6672  s a ~/.config/fr
+00001050: 6f73 7465 722f 636f 6e66 6967 2e69 6e69  oster/config.ini
+00001060: 2066 696c 6520 616e 6420 706f 7075 6c61   file and popula
+00001070: 7465 2074 6865 2076 6172 6961 626c 6573  te the variables
+00001080: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00001090: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+000010a0: 636f 6e66 6967 5f66 696c 6529 3a0a 0a20  config_file):.. 
+000010b0: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
+000010c0: 6174 6520 6120 436f 6e66 6967 5061 7273  ate a ConfigPars
+000010d0: 6572 206f 626a 6563 740a 2020 2020 2020  er object.      
+000010e0: 2020 2020 2020 636f 6e66 6967 203d 2063        config = c
+000010f0: 6f6e 6669 6770 6172 7365 722e 436f 6e66  onfigparser.Conf
+00001100: 6967 5061 7273 6572 2829 0a0a 2020 2020  igParser()..    
+00001110: 2020 2020 2020 2020 2320 506f 7075 6c61          # Popula
+00001120: 7465 2073 656c 6620 7661 7269 6162 6c65  te self variable
+00001130: 7320 7573 696e 6720 6c6f 6361 6c20 636f  s using local co
+00001140: 6e66 6967 2e69 6e69 2066 696c 650a 2020  nfig.ini file.  
+00001150: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00001160: 2e72 6561 6428 7365 6c66 2e63 6f6e 6669  .read(self.confi
+00001170: 675f 6669 6c65 290a 0a20 2020 2020 2020  g_file)..       
+00001180: 2020 2020 2023 2055 7365 7220 636f 6e66       # User conf
+00001190: 6967 7572 6174 696f 6e0a 2020 2020 2020  iguration.      
+000011a0: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
+000011b0: 3d20 636f 6e66 6967 2e67 6574 2827 5553  = config.get('US
+000011c0: 4552 272c 2027 6e61 6d65 272c 2066 616c  ER', 'name', fal
+000011d0: 6c62 6163 6b3d 4e6f 6e65 290a 2020 2020  lback=None).    
+000011e0: 2020 2020 2020 2020 7365 6c66 2e65 6d61          self.ema
+000011f0: 696c 203d 2063 6f6e 6669 672e 6765 7428  il = config.get(
+00001200: 2755 5345 5227 2c20 2765 6d61 696c 272c  'USER', 'email',
+00001210: 2066 616c 6c62 6163 6b3d 4e6f 6e65 290a   fallback=None).
+00001220: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00001230: 6865 636b 2069 6620 7573 6572 2063 6f6e  heck if user con
+00001240: 6669 6775 7261 7469 6f6e 2069 7320 636f  figuration is co
+00001250: 6d70 6c65 7465 0a20 2020 2020 2020 2020  mplete.         
+00001260: 2020 2069 6620 7365 6c66 2e6e 616d 6520     if self.name 
+00001270: 616e 6420 7365 6c66 2e65 6d61 696c 3a0a  and self.email:.
+00001280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001290: 7365 6c66 2e75 7365 725f 696e 6974 203d  self.user_init =
+000012a0: 2054 7275 650a 0a20 2020 2020 2020 2020   True..         
+000012b0: 2020 2023 2041 5753 2064 6972 6563 746f     # AWS directo
+000012c0: 7279 0a20 2020 2020 2020 2020 2020 2073  ry.            s
+000012d0: 656c 662e 6177 735f 6469 7220 3d20 636f  elf.aws_dir = co
+000012e0: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
+000012f0: 2020 2020 2020 2020 2020 2741 5753 272c            'AWS',
+00001300: 2027 6177 735f 6469 7227 2c20 6661 6c6c   'aws_dir', fall
+00001310: 6261 636b 3d6f 732e 7061 7468 2e6a 6f69  back=os.path.joi
+00001320: 6e28 7365 6c66 2e68 6f6d 655f 6469 722c  n(self.home_dir,
+00001330: 2027 2e61 7773 2729 290a 0a20 2020 2020   '.aws'))..     
+00001340: 2020 2020 2020 2023 2041 5753 2063 6f6e         # AWS con
+00001350: 6669 6720 6669 6c65 0a20 2020 2020 2020  fig file.       
+00001360: 2020 2020 2073 656c 662e 6177 735f 636f       self.aws_co
+00001370: 6e66 6967 5f66 696c 6520 3d20 6f73 2e70  nfig_file = os.p
+00001380: 6174 682e 6a6f 696e 2873 656c 662e 6177  ath.join(self.aw
+00001390: 735f 6469 722c 2027 636f 6e66 6967 2729  s_dir, 'config')
+000013a0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000013b0: 4157 5320 6372 6564 656e 7469 616c 7320  AWS credentials 
+000013c0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+000013d0: 2073 656c 662e 6177 735f 6372 6564 656e   self.aws_creden
+000013e0: 7469 616c 735f 6669 6c65 203d 206f 732e  tials_file = os.
+000013f0: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
+00001400: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001410: 6177 735f 6469 722c 2027 6372 6564 656e  aws_dir, 'creden
+00001420: 7469 616c 7327 290a 0a20 2020 2020 2020  tials')..       
+00001430: 2020 2020 2023 2041 5753 2070 726f 6669       # AWS profi
+00001440: 6c65 0a20 2020 2020 2020 2020 2020 2073  le.            s
+00001450: 656c 662e 6177 735f 7072 6f66 696c 6520  elf.aws_profile 
+00001460: 3d20 636f 6e66 6967 2e67 6574 280a 2020  = config.get(.  
+00001470: 2020 2020 2020 2020 2020 2020 2020 2741                'A
+00001480: 5753 272c 2027 6177 735f 7072 6f66 696c  WS', 'aws_profil
+00001490: 6527 2c20 6661 6c6c 6261 636b 3d4e 6f6e  e', fallback=Non
+000014a0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+000014b0: 2320 4157 5320 7265 6769 6f6e 0a20 2020  # AWS region.   
+000014c0: 2020 2020 2020 2020 2073 656c 662e 6177           self.aw
+000014d0: 735f 7265 6769 6f6e 203d 2063 6f6e 6669  s_region = confi
+000014e0: 672e 6765 7428 0a20 2020 2020 2020 2020  g.get(.         
+000014f0: 2020 2020 2020 2027 4157 5327 2c20 2761         'AWS', 'a
+00001500: 7773 5f72 6567 696f 6e27 2c20 6661 6c6c  ws_region', fall
+00001510: 6261 636b 3d4e 6f6e 6529 0a0a 2020 2020  back=None)..    
+00001520: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00001530: 6966 2061 7773 2063 6f6e 6669 6775 7261  if aws configura
+00001540: 7469 6f6e 2069 7320 636f 6d70 6c65 7465  tion is complete
+00001550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00001560: 7365 6c66 2e61 7773 5f70 726f 6669 6c65  self.aws_profile
+00001570: 2061 6e64 2073 656c 662e 6177 735f 7265   and self.aws_re
+00001580: 6769 6f6e 3a0a 2020 2020 2020 2020 2020  gion:.          
+00001590: 2020 2020 2020 7365 6c66 2e61 7773 5f69        self.aws_i
+000015a0: 6e69 7420 3d20 5472 7565 0a0a 2020 2020  nit = True..    
+000015b0: 2020 2020 2020 2020 2320 5368 6172 6564          # Shared
+000015c0: 2063 6f6e 6669 6775 7261 7469 6f6e 0a20   configuration. 
+000015d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000015e0: 6973 5f73 6861 7265 6420 3d20 636f 6e66  is_shared = conf
+000015f0: 6967 2e67 6574 626f 6f6c 6561 6e28 0a20  ig.getboolean(. 
+00001600: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00001610: 5348 4152 4544 272c 2027 6973 5f73 6861  SHARED', 'is_sha
+00001620: 7265 6427 2c20 6661 6c6c 6261 636b 3d46  red', fallback=F
+00001630: 616c 7365 290a 0a20 2020 2020 2020 2020  alse)..         
+00001640: 2020 2069 6620 7365 6c66 2e69 735f 7368     if self.is_sh
+00001650: 6172 6564 3a0a 0a20 2020 2020 2020 2020  ared:..         
+00001660: 2020 2020 2020 2073 656c 662e 7368 6172         self.shar
+00001670: 6564 5f64 6972 203d 2063 6f6e 6669 672e  ed_dir = config.
+00001680: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00001690: 2020 2020 2020 2020 2027 5348 4152 4544           'SHARED
+000016a0: 272c 2027 7368 6172 6564 5f64 6972 272c  ', 'shared_dir',
+000016b0: 2066 616c 6c62 6163 6b3d 4e6f 6e65 290a   fallback=None).
+000016c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000016d0: 2073 656c 662e 7368 6172 6564 5f63 6f6e   self.shared_con
+000016e0: 6669 675f 6669 6c65 203d 206f 732e 7061  fig_file = os.pa
+000016f0: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
+00001700: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00001710: 662e 7368 6172 6564 5f64 6972 2c20 2073  f.shared_dir,  s
+00001720: 656c 662e 7368 6172 6564 5f63 6f6e 6669  elf.shared_confi
+00001730: 675f 6669 6c65 5f6e 616d 6529 0a0a 2020  g_file_name)..  
+00001740: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00001750: 6c66 2e61 7263 6869 7665 5f6a 736f 6e20  lf.archive_json 
+00001760: 3d20 6f73 2e70 6174 682e 6a6f 696e 280a  = os.path.join(.
+00001770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001780: 2020 2020 7365 6c66 2e73 6861 7265 645f      self.shared_
+00001790: 6469 722c 2073 656c 662e 6172 6368 6976  dir, self.archiv
+000017a0: 655f 6a73 6f6e 5f66 696c 655f 6e61 6d65  e_json_file_name
+000017b0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000017c0: 2020 2073 656c 662e 7368 6172 6564 5f68     self.shared_h
+000017d0: 6f74 7370 6f74 735f 6469 7220 3d20 6f73  otspots_dir = os
+000017e0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+000017f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001800: 7365 6c66 2e73 6861 7265 645f 6469 722c  self.shared_dir,
+00001810: 2027 686f 7473 706f 7473 2729 0a0a 2020   'hotspots')..  
+00001820: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00001830: 4368 616e 6765 2063 6f6e 6669 6720 6669  Change config fi
+00001840: 6c65 2069 6620 7468 6973 2069 7320 6120  le if this is a 
+00001850: 7368 6172 6564 2063 6f6e 6669 6775 7261  shared configura
+00001860: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00001870: 2020 2020 2063 6f6e 6669 672e 7265 6164       config.read
+00001880: 2873 656c 662e 7368 6172 6564 5f63 6f6e  (self.shared_con
+00001890: 6669 675f 6669 6c65 290a 0a20 2020 2020  fig_file)..     
+000018a0: 2020 2020 2020 2023 204e 4948 2063 6f6e         # NIH con
+000018b0: 6669 6775 7261 7469 6f6e 0a20 2020 2020  figuration.     
+000018c0: 2020 2020 2020 2073 656c 662e 6973 5f6e         self.is_n
+000018d0: 6968 203d 2063 6f6e 6669 672e 6765 7462  ih = config.getb
+000018e0: 6f6f 6c65 616e 2827 4e49 4827 2c20 2769  oolean('NIH', 'i
+000018f0: 735f 6e69 6827 2c20 6661 6c6c 6261 636b  s_nih', fallback
+00001900: 3d4e 6f6e 6529 0a0a 2020 2020 2020 2020  =None)..        
+00001910: 2020 2020 2320 5365 7420 6e69 6820 696e      # Set nih in
+00001920: 6974 2066 6c61 670a 2020 2020 2020 2020  it flag.        
+00001930: 2020 2020 7365 6c66 2e6e 6968 5f69 6e69      self.nih_ini
+00001940: 7420 3d20 5472 7565 2069 6620 7365 6c66  t = True if self
+00001950: 2e69 735f 6e69 6820 6973 206e 6f74 204e  .is_nih is not N
+00001960: 6f6e 6520 656c 7365 2046 616c 7365 0a0a  one else False..
+00001970: 2020 2020 2020 2020 2020 2020 2320 4375              # Cu
+00001980: 7272 656e 7420 5333 2042 7563 6b65 7420  rrent S3 Bucket 
+00001990: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+000019a0: 2073 656c 662e 6275 636b 6574 5f6e 616d   self.bucket_nam
+000019b0: 6520 3d20 636f 6e66 6967 2e67 6574 280a  e = config.get(.
+000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019d0: 2753 3327 2c20 2762 7563 6b65 745f 6e61  'S3', 'bucket_na
+000019e0: 6d65 272c 2066 616c 6c62 6163 6b3d 4e6f  me', fallback=No
+000019f0: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
+00001a00: 2023 2041 7263 6869 7665 2064 6972 6563   # Archive direc
+00001a10: 746f 7920 696e 7369 6465 2041 5753 2053  toy inside AWS S
+00001a20: 3320 6275 636b 6574 0a20 2020 2020 2020  3 bucket.       
+00001a30: 2020 2020 2073 656c 662e 6172 6368 6976       self.archiv
+00001a40: 655f 6469 7220 3d20 636f 6e66 6967 2e67  e_dir = config.g
+00001a50: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
+00001a60: 2020 2020 2753 3327 2c20 2761 7263 6869      'S3', 'archi
+00001a70: 7665 5f64 6972 272c 2066 616c 6c62 6163  ve_dir', fallbac
+00001a80: 6b3d 4e6f 6e65 290a 0a20 2020 2020 2020  k=None)..       
+00001a90: 2020 2020 2023 2053 746f 7265 2061 7773       # Store aws
+00001aa0: 2073 3320 7374 6f72 6167 6520 636c 6173   s3 storage clas
+00001ab0: 7320 696e 2074 6865 2063 6f6e 6669 6720  s in the config 
+00001ac0: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
+00001ad0: 2020 2073 656c 662e 7374 6f72 6167 655f     self.storage_
+00001ae0: 636c 6173 7320 3d20 636f 6e66 6967 2e67  class = config.g
+00001af0: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
+00001b00: 2020 2020 2753 3327 2c20 2773 746f 7261      'S3', 'stora
+00001b10: 6765 5f63 6c61 7373 272c 2066 616c 6c62  ge_class', fallb
+00001b20: 6163 6b3d 4e6f 6e65 290a 0a20 2020 2020  ack=None)..     
+00001b30: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+00001b40: 6620 7333 2063 6f6e 6669 6775 7261 7469  f s3 configurati
+00001b50: 6f6e 2069 7320 636f 6d70 6c65 7465 0a20  on is complete. 
+00001b60: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00001b70: 6c66 2e62 7563 6b65 745f 6e61 6d65 2061  lf.bucket_name a
+00001b80: 6e64 2073 656c 662e 6172 6368 6976 655f  nd self.archive_
+00001b90: 6469 7220 616e 6420 7365 6c66 2e73 746f  dir and self.sto
+00001ba0: 7261 6765 5f63 6c61 7373 3a0a 2020 2020  rage_class:.    
+00001bb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001bc0: 2e73 335f 696e 6974 203d 2054 7275 650a  .s3_init = True.
+00001bd0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00001be0: 6c75 726d 2063 6f6e 6669 6775 7261 7469  lurm configurati
+00001bf0: 6f6e 0a20 2020 2020 2020 2020 2020 2073  on.            s
+00001c00: 656c 662e 736c 7572 6d5f 7761 6c6c 7469  elf.slurm_wallti
+00001c10: 6d65 5f64 6179 7320 3d20 636f 6e66 6967  me_days = config
+00001c20: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
+00001c30: 2020 2020 2020 2753 4c55 524d 272c 2027        'SLURM', '
+00001c40: 736c 7572 6d5f 7761 6c6c 7469 6d65 5f64  slurm_walltime_d
+00001c50: 6179 7327 2c20 6661 6c6c 6261 636b 3d4e  ays', fallback=N
+00001c60: 6f6e 6529 0a0a 2020 2020 2020 2020 2020  one)..          
+00001c70: 2020 7365 6c66 2e73 6c75 726d 5f77 616c    self.slurm_wal
+00001c80: 6c74 696d 655f 686f 7572 7320 3d20 636f  ltime_hours = co
+00001c90: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
+00001ca0: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
+00001cb0: 272c 2027 736c 7572 6d5f 7761 6c6c 7469  ', 'slurm_wallti
+00001cc0: 6d65 5f68 6f75 7273 272c 2066 616c 6c62  me_hours', fallb
+00001cd0: 6163 6b3d 4e6f 6e65 290a 0a20 2020 2020  ack=None)..     
+00001ce0: 2020 2020 2020 2073 656c 662e 736c 7572         self.slur
+00001cf0: 6d5f 7061 7274 6974 696f 6e20 3d20 636f  m_partition = co
+00001d00: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
+00001d10: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
+00001d20: 272c 2027 736c 7572 6d5f 7061 7274 6974  ', 'slurm_partit
+00001d30: 696f 6e27 2c20 6661 6c6c 6261 636b 3d4e  ion', fallback=N
+00001d40: 6f6e 6529 0a0a 2020 2020 2020 2020 2020  one)..          
+00001d50: 2020 7365 6c66 2e73 6c75 726d 5f71 6f73    self.slurm_qos
+00001d60: 203d 2063 6f6e 6669 672e 6765 7428 0a20   = config.get(. 
+00001d70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00001d80: 534c 5552 4d27 2c20 2773 6c75 726d 5f71  SLURM', 'slurm_q
+00001d90: 6f73 272c 2066 616c 6c62 6163 6b3d 4e6f  os', fallback=No
+00001da0: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
+00001db0: 2073 656c 662e 736c 7572 6d5f 6c73 6372   self.slurm_lscr
+00001dc0: 6174 6368 203d 2063 6f6e 6669 672e 6765  atch = config.ge
+00001dd0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00001de0: 2020 2027 534c 5552 4d27 2c20 2773 6c75     'SLURM', 'slu
+00001df0: 726d 5f6c 7363 7261 7463 6827 2c20 6661  rm_lscratch', fa
+00001e00: 6c6c 6261 636b 3d4e 6f6e 6529 0a0a 2020  llback=None)..  
+00001e10: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00001e20: 7363 7261 7463 685f 6d6b 6469 7220 3d20  scratch_mkdir = 
+00001e30: 636f 6e66 6967 2e67 6574 280a 2020 2020  config.get(.    
+00001e40: 2020 2020 2020 2020 2020 2020 2753 4c55              'SLU
+00001e50: 524d 272c 2027 6c73 6372 6174 6368 5f6d  RM', 'lscratch_m
+00001e60: 6b64 6972 272c 2066 616c 6c62 6163 6b3d  kdir', fallback=
+00001e70: 4e6f 6e65 290a 0a20 2020 2020 2020 2020  None)..         
+00001e80: 2020 2073 656c 662e 6c73 6372 6174 6368     self.lscratch
+00001e90: 5f72 6d64 6972 203d 2063 6f6e 6669 672e  _rmdir = config.
+00001ea0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00001eb0: 2020 2020 2027 534c 5552 4d27 2c20 276c       'SLURM', 'l
+00001ec0: 7363 7261 7463 685f 726d 6469 7227 2c20  scratch_rmdir', 
+00001ed0: 6661 6c6c 6261 636b 3d4e 6f6e 6529 0a0a  fallback=None)..
+00001ee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001ef0: 2e6c 7363 7261 7463 685f 726f 6f74 203d  .lscratch_root =
+00001f00: 2063 6f6e 6669 672e 6765 7428 0a20 2020   config.get(.   
+00001f10: 2020 2020 2020 2020 2020 2020 2027 534c               'SL
+00001f20: 5552 4d27 2c20 276c 7363 7261 7463 685f  URM', 'lscratch_
+00001f30: 726f 6f74 272c 2066 616c 6c62 6163 6b3d  root', fallback=
+00001f40: 4e6f 6e65 290a 0a20 2020 2020 2020 2020  None)..         
+00001f50: 2020 2023 2043 6c6f 7564 2063 6f6e 6669     # Cloud confi
+00001f60: 6775 7261 7469 6f6e 0a20 2020 2020 2020  guration.       
+00001f70: 2020 2020 2073 656c 662e 7365 735f 7665       self.ses_ve
+00001f80: 7269 6679 5f72 6571 7565 7374 735f 7365  rify_requests_se
+00001f90: 6e74 203d 2063 6f6e 6669 672e 6765 7428  nt = config.get(
+00001fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001fb0: 2027 434c 4f55 4427 2c20 2773 6573 5f76   'CLOUD', 'ses_v
+00001fc0: 6572 6966 795f 7265 7175 6573 7473 5f73  erify_requests_s
+00001fd0: 656e 7427 2c20 6661 6c6c 6261 636b 3d5b  ent', fallback=[
+00001fe0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+00001ff0: 7365 6c66 2e65 6332 5f6c 6173 745f 696e  self.ec2_last_in
+00002000: 7374 616e 6365 203d 2063 6f6e 6669 672e  stance = config.
+00002010: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00002020: 2020 2020 2027 434c 4f55 4427 2c20 2765       'CLOUD', 'e
+00002030: 6332 5f6c 6173 745f 696e 7374 616e 6365  c2_last_instance
+00002040: 272c 2066 616c 6c62 6163 6b3d 4e6f 6e65  ', fallback=None
+00002050: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00002060: 6c66 2e75 7365 725f 696e 6974 2061 6e64  lf.user_init and
+00002070: 2073 656c 662e 6177 735f 696e 6974 2061   self.aws_init a
+00002080: 6e64 2073 656c 662e 7333 5f69 6e69 7420  nd self.s3_init 
+00002090: 616e 6420 7365 6c66 2e6e 6968 5f69 6e69  and self.nih_ini
+000020a0: 743a 0a20 2020 2020 2020 2020 2020 2073  t:.            s
+000020b0: 656c 662e 636f 6e66 6967 7572 6174 696f  elf.configuratio
+000020c0: 6e5f 646f 6e65 203d 2054 7275 650a 0a20  n_done = True.. 
+000020d0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+000020e0: 7365 6c66 293a 0a20 2020 2020 2020 2027  self):.        '
+000020f0: 2727 2052 6574 7572 6e20 6120 7374 7269  '' Return a stri
+00002100: 6e67 2072 6570 7265 7365 6e74 6174 696f  ng representatio
+00002110: 6e20 6f66 2074 6865 206f 626a 6563 7427  n of the object'
+00002120: 2727 0a0a 2020 2020 2020 2020 7265 7475  ''..        retu
+00002130: 726e 2022 3c7b 6b6c 6173 737d 2040 7b69  rn "<{klass} @{i
+00002140: 643a 787d 207b 6174 7472 737d 3e22 2e66  d:x} {attrs}>".f
+00002150: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
+00002160: 2020 206b 6c61 7373 3d73 656c 662e 5f5f     klass=self.__
+00002170: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00002180: 2c0a 2020 2020 2020 2020 2020 2020 6964  ,.            id
+00002190: 3d69 6428 7365 6c66 2920 2620 3078 4646  =id(self) & 0xFF
+000021a0: 4646 4646 2c0a 2020 2020 2020 2020 2020  FFFF,.          
+000021b0: 2020 6174 7472 733d 2220 222e 6a6f 696e    attrs=" ".join
+000021c0: 2822 7b7d 3d7b 2172 7d5c 6e22 2e66 6f72  ("{}={!r}\n".for
+000021d0: 6d61 7428 6b2c 2076 290a 2020 2020 2020  mat(k, v).      
+000021e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021f0: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00002200: 2073 656c 662e 5f5f 6469 6374 5f5f 2e69   self.__dict__.i
+00002210: 7465 6d73 2829 292c 0a20 2020 2020 2020  tems()),.       
+00002220: 2029 0a0a 2020 2020 6465 6620 6164 645f   )..    def add_
+00002230: 6372 6f6e 5f6a 6f62 2873 656c 662c 2063  cron_job(self, c
+00002240: 6d64 2c20 6d69 6e75 7465 2c20 686f 7572  md, minute, hour
+00002250: 3d27 2a27 2c20 6461 795f 6f66 5f6d 6f6e  ='*', day_of_mon
+00002260: 7468 3d27 2a27 2c20 6d6f 6e74 683d 272a  th='*', month='*
+00002270: 272c 2064 6179 5f6f 665f 7765 656b 3d27  ', day_of_week='
+00002280: 2a27 293a 0a20 2020 2020 2020 2023 2046  *'):.        # F
+00002290: 554e 4354 494f 4e20 4355 5252 454e 544c  UNCTION CURRENTL
+000022a0: 5920 4e4f 5420 4245 494e 4720 5553 4544  Y NOT BEING USED
+000022b0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000022c0: 206d 696e 7574 653a 0a20 2020 2020 2020   minute:.       
+000022d0: 2020 2020 2070 7269 6e74 2827 596f 7520       print('You 
+000022e0: 6d75 7374 2073 6574 2074 6865 206d 696e  must set the min
+000022f0: 7574 6520 2831 2d36 3029 2065 7870 6c69  ute (1-60) expli
+00002300: 6369 6c79 2729 0a20 2020 2020 2020 2020  cily').         
+00002310: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00002320: 2020 2020 2020 2020 7769 7468 2074 656d          with tem
+00002330: 7066 696c 652e 4e61 6d65 6454 656d 706f  pfile.NamedTempo
+00002340: 7261 7279 4669 6c65 2864 656c 6574 653d  raryFile(delete=
+00002350: 4661 6c73 6529 2061 7320 7465 6d70 3a0a  False) as temp:.
+00002360: 2020 2020 2020 2020 2020 2020 2320 4475              # Du
+00002370: 6d70 2074 6865 2063 7572 7265 6e74 2063  mp the current c
+00002380: 726f 6e74 6162 2074 6f20 7468 6520 7465  rontab to the te
+00002390: 6d70 6f72 6172 7920 6669 6c65 0a20 2020  mporary file.   
+000023a0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000023b0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+000023c0: 2e73 7973 7465 6d28 2763 726f 6e74 6162  .system('crontab
+000023d0: 202d 6c20 3e20 7b7d 272e 666f 726d 6174   -l > {}'.format
+000023e0: 2874 656d 702e 6e61 6d65 2929 0a20 2020  (temp.name)).   
+000023f0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00002400: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+00002410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002420: 7072 696e 7428 6622 4572 726f 723a 207b  print(f"Error: {
+00002430: 657d 222c 2066 696c 653d 7379 732e 7374  e}", file=sys.st
+00002440: 6465 7272 290a 0a20 2020 2020 2020 2020  derr)..         
+00002450: 2020 2023 2041 6464 2074 6865 206e 6577     # Add the new
+00002460: 2063 726f 6e20 6a6f 6220 746f 2074 6865   cron job to the
+00002470: 2074 656d 706f 7261 7279 2066 696c 650a   temporary file.
+00002480: 2020 2020 2020 2020 2020 2020 6372 6f6e              cron
+00002490: 5f74 696d 6520 3d20 227b 7d20 7b7d 207b  _time = "{} {} {
+000024a0: 7d20 7b7d 207b 7d22 2e66 6f72 6d61 7428  } {} {}".format(
+000024b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000024c0: 2073 7472 286d 696e 7574 6529 2c20 686f   str(minute), ho
+000024d0: 7572 2c20 6461 795f 6f66 5f6d 6f6e 7468  ur, day_of_month
+000024e0: 2c20 6d6f 6e74 682c 2064 6179 5f6f 665f  , month, day_of_
+000024f0: 7765 656b 290a 2020 2020 2020 2020 2020  week).          
+00002500: 2020 7769 7468 206f 7065 6e28 7465 6d70    with open(temp
+00002510: 2e6e 616d 652c 2027 6127 2920 6173 2066  .name, 'a') as f
+00002520: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00002530: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+00002540: 277b 7d20 7b7d 5c6e 272e 666f 726d 6174  '{} {}\n'.format
+00002550: 2863 726f 6e5f 7469 6d65 2c20 636d 6429  (cron_time, cmd)
+00002560: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00002570: 2049 6e73 7461 6c6c 2074 6865 206e 6577   Install the new
+00002580: 2063 726f 6e74 6162 0a20 2020 2020 2020   crontab.       
+00002590: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000025a0: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
+000025b0: 7465 6d28 2763 726f 6e74 6162 207b 7d27  tem('crontab {}'
+000025c0: 2e66 6f72 6d61 7428 7465 6d70 2e6e 616d  .format(temp.nam
+000025d0: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+000025e0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+000025f0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00002600: 2020 2020 2020 2070 7269 6e74 2866 2245         print(f"E
+00002610: 7272 6f72 3a20 7b65 7d22 2c20 6669 6c65  rror: {e}", file
+00002620: 3d73 7973 2e73 7464 6572 7229 0a0a 2020  =sys.stderr)..  
+00002630: 2020 2020 2020 2020 2020 2320 436c 6561            # Clea
+00002640: 6e20 7570 2062 7920 7265 6d6f 7669 6e67  n up by removing
+00002650: 2074 6865 2074 656d 706f 7261 7279 2066   the temporary f
+00002660: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00002670: 6f73 2e75 6e6c 696e 6b28 7465 6d70 2e6e  os.unlink(temp.n
+00002680: 616d 6529 0a0a 2020 2020 2020 2020 7072  ame)..        pr
+00002690: 696e 7428 2243 726f 6e20 6a6f 6220 6164  int("Cron job ad
+000026a0: 6465 6421 2229 0a0a 2020 2020 6465 6620  ded!")..    def 
+000026b0: 6164 645f 7379 7374 656d 645f 6372 6f6e  add_systemd_cron
+000026c0: 5f6a 6f62 2873 656c 662c 2063 6d64 2c20  _job(self, cmd, 
+000026d0: 6d69 6e75 7465 2c20 686f 7572 3d27 2a27  minute, hour='*'
+000026e0: 293a 0a0a 2020 2020 2020 2020 7472 793a  ):..        try:
+000026f0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00002700: 726f 7562 6c65 7368 6f6f 7420 7769 7468  roubleshoot with
+00002710: 3a0a 2020 2020 2020 2020 2020 2020 230a  :.            #.
+00002720: 2020 2020 2020 2020 2020 2020 2320 6a6f              # jo
+00002730: 7572 6e61 6c63 746c 202d 6620 2d2d 7573  urnalctl -f --us
+00002740: 6572 2d75 6e69 7420 6672 6f73 7465 722d  er-unit froster-
+00002750: 6d6f 6e69 746f 722e 7365 7276 6963 650a  monitor.service.
+00002760: 2020 2020 2020 2020 2020 2020 2320 6a6f              # jo
+00002770: 7572 6e61 6c63 746c 202d 6620 2d2d 7573  urnalctl -f --us
+00002780: 6572 2d75 6e69 7420 6672 6f73 7465 722d  er-unit froster-
+00002790: 6d6f 6e69 746f 722e 7469 6d65 720a 2020  monitor.timer.  
+000027a0: 2020 2020 2020 2020 2020 2320 6a6f 7572            # jour
+000027b0: 6e61 6c63 746c 202d 2d73 696e 6365 2022  nalctl --since "
+000027c0: 3520 6d69 6e75 7465 7320 6167 6f22 207c  5 minutes ago" |
+000027d0: 2067 7265 7020 6672 6f73 7465 722d 6d6f   grep froster-mo
+000027e0: 6e69 746f 720a 0a20 2020 2020 2020 2020  nitor..         
+000027f0: 2020 2053 4552 5649 4345 5f43 4f4e 5445     SERVICE_CONTE
+00002800: 4e54 203d 2074 6578 7477 7261 702e 6465  NT = textwrap.de
+00002810: 6465 6e74 2866 2222 220a 2020 2020 2020  dent(f""".      
+00002820: 2020 2020 2020 5b55 6e69 745d 0a20 2020        [Unit].   
+00002830: 2020 2020 2020 2020 2044 6573 6372 6970           Descrip
+00002840: 7469 6f6e 3d52 756e 2046 726f 7374 6572  tion=Run Froster
+00002850: 2d4d 6f6e 6974 6f72 2043 726f 6e20 4a6f  -Monitor Cron Jo
+00002860: 620a 0a20 2020 2020 2020 2020 2020 205b  b..            [
+00002870: 5365 7276 6963 655d 0a20 2020 2020 2020  Service].       
+00002880: 2020 2020 2054 7970 653d 7369 6d70 6c65       Type=simple
+00002890: 0a20 2020 2020 2020 2020 2020 2045 7865  .            Exe
+000028a0: 6353 7461 7274 3d7b 636d 647d 0a0a 2020  cStart={cmd}..  
+000028b0: 2020 2020 2020 2020 2020 5b49 6e73 7461            [Insta
+000028c0: 6c6c 5d0a 2020 2020 2020 2020 2020 2020  ll].            
+000028d0: 5761 6e74 6564 4279 3d64 6566 6175 6c74  WantedBy=default
+000028e0: 2e74 6172 6765 740a 2020 2020 2020 2020  .target.        
+000028f0: 2020 2020 2222 2229 0a0a 2020 2020 2020      """)..      
+00002900: 2020 2020 2020 5449 4d45 525f 434f 4e54        TIMER_CONT
+00002910: 454e 5420 3d20 7465 7874 7772 6170 2e64  ENT = textwrap.d
+00002920: 6564 656e 7428 6622 2222 0a20 2020 2020  edent(f""".     
+00002930: 2020 2020 2020 205b 556e 6974 5d0a 2020         [Unit].  
+00002940: 2020 2020 2020 2020 2020 4465 7363 7269            Descri
+00002950: 7074 696f 6e3d 5275 6e20 4672 6f73 7465  ption=Run Froste
+00002960: 722d 4d6f 6e69 746f 7220 4372 6f6e 204a  r-Monitor Cron J
+00002970: 6f62 2068 6f75 726c 790a 0a20 2020 2020  ob hourly..     
+00002980: 2020 2020 2020 205b 5469 6d65 725d 0a20         [Timer]. 
+00002990: 2020 2020 2020 2020 2020 2050 6572 7369             Persi
+000029a0: 7374 656e 743d 7472 7565 0a20 2020 2020  stent=true.     
+000029b0: 2020 2020 2020 204f 6e43 616c 656e 6461         OnCalenda
+000029c0: 723d 2a2d 2a2d 2a20 7b68 6f75 727d 3a7b  r=*-*-* {hour}:{
+000029d0: 6d69 6e75 7465 7d3a 3030 0a20 2020 2020  minute}:00.     
+000029e0: 2020 2020 2020 2023 5261 6e64 6f6d 697a         #Randomiz
+000029f0: 6564 4465 6c61 7953 6563 3d33 3030 0a20  edDelaySec=300. 
+00002a00: 2020 2020 2020 2020 2020 2023 4669 7865             #Fixe
+00002a10: 6452 616e 646f 6d44 656c 6179 3d74 7275  dRandomDelay=tru
+00002a20: 650a 2020 2020 2020 2020 2020 2020 234f  e.            #O
+00002a30: 6e42 6f6f 7453 6563 3d31 3830 0a20 2020  nBootSec=180.   
+00002a40: 2020 2020 2020 2020 2023 4f6e 556e 6974           #OnUnit
+00002a50: 4163 7469 7665 5365 633d 3336 3030 0a20  ActiveSec=3600. 
+00002a60: 2020 2020 2020 2020 2020 2055 6e69 743d             Unit=
+00002a70: 6672 6f73 7465 722d 6d6f 6e69 746f 722e  froster-monitor.
+00002a80: 7365 7276 6963 650a 0a20 2020 2020 2020  service..       
+00002a90: 2020 2020 205b 496e 7374 616c 6c5d 0a20       [Install]. 
+00002aa0: 2020 2020 2020 2020 2020 2057 616e 7465             Wante
+00002ab0: 6442 793d 7469 6d65 7273 2e74 6172 6765  dBy=timers.targe
+00002ac0: 740a 2020 2020 2020 2020 2020 2020 2222  t.            ""
+00002ad0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00002ae0: 2320 456e 7375 7265 2074 6865 2064 6972  # Ensure the dir
+00002af0: 6563 746f 7279 2065 7869 7374 730a 2020  ectory exists.  
+00002b00: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
+00002b10: 3a20 4368 6563 6b20 7468 6973 2070 6174  : Check this pat
+00002b20: 680a 2020 2020 2020 2020 2020 2020 7573  h.            us
+00002b30: 6572 5f73 7973 7465 6d64 5f64 6972 203d  er_systemd_dir =
+00002b40: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00002b50: 7365 7228 227e 2f2e 636f 6e66 6967 2f73  ser("~/.config/s
+00002b60: 7973 7465 6d64 2f75 7365 722f 2229 0a20  ystemd/user/"). 
+00002b70: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+00002b80: 6b65 6469 7273 2875 7365 725f 7379 7374  kedirs(user_syst
+00002b90: 656d 645f 6469 722c 2065 7869 7374 5f6f  emd_dir, exist_o
+00002ba0: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
+00002bb0: 3735 290a 0a20 2020 2020 2020 2020 2020  75)..           
+00002bc0: 2053 4552 5649 4345 5f50 4154 4820 3d20   SERVICE_PATH = 
+00002bd0: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+00002be0: 2020 2020 2020 2020 2020 2020 2020 7573                us
+00002bf0: 6572 5f73 7973 7465 6d64 5f64 6972 2c20  er_systemd_dir, 
+00002c00: 2266 726f 7374 6572 2d6d 6f6e 6974 6f72  "froster-monitor
+00002c10: 2e73 6572 7669 6365 2229 0a20 2020 2020  .service").     
+00002c20: 2020 2020 2020 2054 494d 4552 5f50 4154         TIMER_PAT
+00002c30: 4820 3d20 6f73 2e70 6174 682e 6a6f 696e  H = os.path.join
+00002c40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002c50: 2020 7573 6572 5f73 7973 7465 6d64 5f64    user_systemd_d
+00002c60: 6972 2c20 2266 726f 7374 6572 2d6d 6f6e  ir, "froster-mon
+00002c70: 6974 6f72 2e74 696d 6572 2229 0a0a 2020  itor.timer")..  
+00002c80: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
+00002c90: 7465 2073 6572 7669 6365 2061 6e64 2074  te service and t
+00002ca0: 696d 6572 2066 696c 6573 0a20 2020 2020  imer files.     
+00002cb0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+00002cc0: 2853 4552 5649 4345 5f50 4154 482c 2022  (SERVICE_PATH, "
+00002cd0: 7722 2920 6173 2073 6572 7669 6365 5f66  w") as service_f
+00002ce0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00002cf0: 2020 2020 2073 6572 7669 6365 5f66 696c       service_fil
+00002d00: 652e 7772 6974 6528 5345 5256 4943 455f  e.write(SERVICE_
+00002d10: 434f 4e54 454e 5429 0a0a 2020 2020 2020  CONTENT)..      
+00002d20: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00002d30: 5449 4d45 525f 5041 5448 2c20 2277 2229  TIMER_PATH, "w")
+00002d40: 2061 7320 7469 6d65 725f 6669 6c65 3a0a   as timer_file:.
+00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d60: 7469 6d65 725f 6669 6c65 2e77 7269 7465  timer_file.write
+00002d70: 2854 494d 4552 5f43 4f4e 5445 4e54 290a  (TIMER_CONTENT).
+00002d80: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+00002d90: 656c 6f61 6420 7379 7374 656d 6420 616e  eload systemd an
+00002da0: 6420 656e 6162 6c65 2f73 7461 7274 2074  d enable/start t
+00002db0: 696d 6572 0a0a 2020 2020 2020 2020 2020  imer..          
+00002dc0: 2020 6f73 2e63 6864 6972 2875 7365 725f    os.chdir(user_
+00002dd0: 7379 7374 656d 645f 6469 7229 0a20 2020  systemd_dir).   
+00002de0: 2020 2020 2020 2020 206f 732e 7379 7374           os.syst
+00002df0: 656d 2822 7379 7374 656d 6374 6c20 2d2d  em("systemctl --
+00002e00: 7573 6572 2064 6165 6d6f 6e2d 7265 6c6f  user daemon-relo
+00002e10: 6164 2229 0a20 2020 2020 2020 2020 2020  ad").           
+00002e20: 206f 732e 7379 7374 656d 2822 7379 7374   os.system("syst
+00002e30: 656d 6374 6c20 2d2d 7573 6572 2065 6e61  emctl --user ena
+00002e40: 626c 6520 6672 6f73 7465 722d 6d6f 6e69  ble froster-moni
+00002e50: 746f 722e 7365 7276 6963 6522 290a 2020  tor.service").  
+00002e60: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
+00002e70: 7465 6d28 2273 7973 7465 6d63 746c 202d  tem("systemctl -
+00002e80: 2d75 7365 7220 656e 6162 6c65 2066 726f  -user enable fro
+00002e90: 7374 6572 2d6d 6f6e 6974 6f72 2e74 696d  ster-monitor.tim
+00002ea0: 6572 2229 0a20 2020 2020 2020 2020 2020  er").           
+00002eb0: 206f 732e 7379 7374 656d 2822 7379 7374   os.system("syst
+00002ec0: 656d 6374 6c20 2d2d 7573 6572 2073 7461  emctl --user sta
+00002ed0: 7274 2066 726f 7374 6572 2d6d 6f6e 6974  rt froster-monit
+00002ee0: 6f72 2e74 696d 6572 2229 0a20 2020 2020  or.timer").     
+00002ef0: 2020 2020 2020 2070 7269 6e74 2822 5379         print("Sy
+00002f00: 7374 656d 6420 6672 6f73 7465 722d 6d6f  stemd froster-mo
+00002f10: 6e69 746f 722e 7469 6d65 7220 6372 6f6e  nitor.timer cron
+00002f20: 206a 6f62 2073 7461 7274 6564 2122 290a   job started!").
+00002f30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00002f40: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00002f50: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00002f60: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00002f70: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00002f80: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+00002f90: 6c64 206e 6f74 2061 6464 2073 7973 7465  ld not add syste
+00002fa0: 6d64 2073 6368 6564 756c 6572 206a 6f62  md scheduler job
+00002fb0: 2c20 4572 726f 723a 207b 657d 272c 2066  , Error: {e}', f
+00002fc0: 696c 653d 7379 732e 7374 6465 7272 290a  ile=sys.stderr).
+00002fd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00002fe0: 745f 6572 726f 7228 290a 2020 2020 2020  t_error().      
+00002ff0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00003000: 7365 0a0a 2020 2020 6465 6620 6173 7375  se..    def assu
+00003010: 7265 5f70 6572 6d69 7373 696f 6e73 5f61  re_permissions_a
+00003020: 6e64 5f67 726f 7570 2873 656c 662c 2064  nd_group(self, d
+00003030: 6972 6563 746f 7279 293a 0a20 2020 2020  irectory):.     
+00003040: 2020 2027 2727 4173 7375 7265 2063 6f72     '''Assure cor
+00003050: 7265 6374 2070 6572 6d69 7373 696f 6e73  rect permissions
+00003060: 2061 6e64 2067 726f 7570 4944 206f 6620   and groupID of 
+00003070: 6120 6469 7265 6374 6f72 7927 2727 0a20  a directory'''. 
+00003080: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
+00003090: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000030a0: 6f73 2e70 6174 682e 6973 6469 7228 6469  os.path.isdir(di
+000030b0: 7265 6374 6f72 7929 3a0a 2020 2020 2020  rectory):.      
+000030c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000030d0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
 000030e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030f0: 2320 4368 616e 6765 2074 6865 2070 6572  # Change the per
-00003100: 6d69 7373 696f 6e73 2074 6f20 3636 340a  missions to 664.
-00003110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003120: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
-00003130: 2870 6174 682c 2030 6f36 3634 290a 0a20  (path, 0o664).. 
-00003140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003150: 2020 2023 2043 6861 6e67 6520 7468 6520     # Change the 
-00003160: 6772 6f75 7020 4944 2074 6f20 7468 6520  group ID to the 
-00003170: 7361 6d65 2061 7320 7468 6520 6469 7265  same as the dire
-00003180: 6374 6f72 790a 2020 2020 2020 2020 2020  ctory.          
-00003190: 2020 2020 2020 2020 2020 6f73 2e63 686f            os.cho
-000031a0: 776e 2870 6174 682c 202d 312c 2064 6972  wn(path, -1, dir
-000031b0: 5f67 6964 290a 0a20 2020 2020 2020 2065  _gid)..        e
-000031c0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-000031d0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000031e0: 2020 7072 696e 7428 6627 5c6e 4572 726f    print(f'\nErro
-000031f0: 723a 207b 657d 272c 2066 696c 653d 7379  r: {e}', file=sy
-00003200: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
-00003210: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00003220: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
-00003230: 6f75 6c64 206e 6f74 2066 6978 2070 6572  ould not fix per
-00003240: 6d69 7373 696f 6e73 206f 6620 7368 6172  missions of shar
-00003250: 6564 2066 6f6c 6465 7220 227b 6469 7265  ed folder "{dire
-00003260: 6374 6f72 797d 225c 6e27 2c20 6669 6c65  ctory}"\n', file
-00003270: 3d73 7973 2e73 7464 6572 7229 0a0a 2020  =sys.stderr)..  
-00003280: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
-00003290: 5f63 6865 636b 5f62 7563 6b65 745f 6e61  _check_bucket_na
-000032a0: 6d65 2873 656c 662c 2061 6e73 7765 7273  me(self, answers
-000032b0: 2c20 6375 7272 656e 7429 3a0a 0a20 2020  , current):..   
-000032c0: 2020 2020 2069 6620 6e6f 7420 6375 7272       if not curr
-000032d0: 656e 742e 7374 6172 7473 7769 7468 2822  ent.startswith("
-000032e0: 6672 6f73 7465 722d 2229 3a0a 2020 2020  froster-"):.    
-000032f0: 2020 2020 2020 2020 7261 6973 6520 696e          raise in
-00003300: 7175 6972 6572 2e65 7272 6f72 732e 5661  quirer.errors.Va
-00003310: 6c69 6461 7469 6f6e 4572 726f 7228 0a20  lidationError(. 
-00003320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003330: 222c 2072 6561 736f 6e3d 2257 726f 6e67  ", reason="Wrong
-00003340: 2062 7563 6b65 7420 6e61 6d65 2e20 452e   bucket name. E.
-00003350: 672e 3a20 6672 6f73 7465 722d 2229 0a0a  g.: froster-")..
-00003360: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
-00003370: 656e 2863 7572 7265 6e74 2920 3e20 383a  en(current) > 8:
-00003380: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00003390: 7365 2069 6e71 7569 7265 722e 6572 726f  se inquirer.erro
-000033a0: 7273 2e56 616c 6964 6174 696f 6e45 7272  rs.ValidationErr
-000033b0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000033c0: 2020 2020 2222 2c20 7265 6173 6f6e 3d22      "", reason="
-000033d0: 4275 636b 6574 206e 616d 6520 746f 6f20  Bucket name too 
-000033e0: 7368 6f72 742e 2045 2e67 2e3a 2066 726f  short. E.g.: fro
-000033f0: 7374 6572 2d22 290a 0a20 2020 2020 2020  ster-")..       
-00003400: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
-00003410: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
-00003420: 5f63 6865 636b 5f65 6d61 696c 5f66 6f72  _check_email_for
-00003430: 6d61 7428 7365 6c66 2c20 616e 7377 6572  mat(self, answer
-00003440: 732c 2063 7572 7265 6e74 293a 0a20 2020  s, current):.   
-00003450: 2020 2020 2070 6174 7465 726e 203d 2072       pattern = r
-00003460: 275e 5b61 2d7a 412d 5a30 2d39 5f2e 2b2d  '^[a-zA-Z0-9_.+-
-00003470: 5d2b 405b 612d 7a41 2d5a 302d 392d 5d2b  ]+@[a-zA-Z0-9-]+
-00003480: 5c2e 5b61 2d7a 412d 5a30 2d39 2d2e 5d2b  \.[a-zA-Z0-9-.]+
-00003490: 2427 0a20 2020 2020 2020 2069 6620 7265  $'.        if re
-000034a0: 2e6d 6174 6368 2870 6174 7465 726e 2c20  .match(pattern, 
-000034b0: 6375 7272 656e 7429 2069 7320 4e6f 6e65  current) is None
-000034c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000034d0: 6973 6520 696e 7175 6972 6572 2e65 7272  ise inquirer.err
-000034e0: 6f72 732e 5661 6c69 6461 7469 6f6e 4572  ors.ValidationEr
-000034f0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00003500: 2020 2020 2022 222c 2072 6561 736f 6e3d       "", reason=
-00003510: 2257 726f 6e67 2065 6d61 696c 2066 6f72  "Wrong email for
-00003520: 6d61 742e 2045 2e67 2e3a 2078 7878 4079  mat. E.g.: xxx@y
-00003530: 7979 2e7a 7a7a 2229 0a20 2020 2020 2020  yy.zzz").       
-00003540: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
-00003550: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
-00003560: 5f63 6865 636b 5f69 735f 656d 7074 795f  _check_is_empty_
-00003570: 6f72 5f6e 756d 6265 7228 7365 6c66 2c20  or_number(self, 
-00003580: 616e 7377 6572 732c 2063 7572 7265 6e74  answers, current
-00003590: 293a 0a0a 2020 2020 2020 2020 7061 7474  ):..        patt
-000035a0: 6572 6e20 3d20 7222 5e5b 302d 395d 2b24  ern = r"^[0-9]+$
-000035b0: 7c5e 2422 0a20 2020 2020 2020 2069 6620  |^$".        if 
-000035c0: 7265 2e6d 6174 6368 2870 6174 7465 726e  re.match(pattern
-000035d0: 2c20 6375 7272 656e 7429 2069 7320 4e6f  , current) is No
-000035e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000035f0: 7261 6973 6520 696e 7175 6972 6572 2e65  raise inquirer.e
-00003600: 7272 6f72 732e 5661 6c69 6461 7469 6f6e  rrors.Validation
-00003610: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00003620: 2020 2020 2020 2022 222c 2072 6561 736f         "", reaso
-00003630: 6e3d 224d 7573 7420 6265 2061 206e 756d  n="Must be a num
-00003640: 6265 7222 290a 2020 2020 2020 2020 7265  ber").        re
-00003650: 7475 726e 2054 7275 650a 0a20 2020 2064  turn True..    d
-00003660: 6566 205f 5f69 6e71 7569 7265 725f 6368  ef __inquirer_ch
-00003670: 6563 6b5f 7265 7175 6972 6564 2873 656c  eck_required(sel
-00003680: 662c 2061 6e73 7765 7273 2c20 6375 7272  f, answers, curr
-00003690: 656e 7429 3a0a 2020 2020 2020 2020 6966  ent):.        if
-000036a0: 206e 6f74 2063 7572 7265 6e74 3a0a 2020   not current:.  
-000036b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000036c0: 696e 7175 6972 6572 2e65 7272 6f72 732e  inquirer.errors.
-000036d0: 5661 6c69 6461 7469 6f6e 4572 726f 7228  ValidationError(
-000036e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000036f0: 2022 222c 2072 6561 736f 6e3d 2246 6965   "", reason="Fie
-00003700: 6c64 2069 7320 7265 7175 6972 6564 2229  ld is required")
-00003710: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003720: 5472 7565 0a0a 2020 2020 6465 6620 5f5f  True..    def __
-00003730: 696e 7175 6972 6572 5f63 6865 636b 5f70  inquirer_check_p
-00003740: 6174 685f 6578 6973 7473 2873 656c 662c  ath_exists(self,
-00003750: 2061 6e73 7765 7273 2c20 6375 7272 656e   answers, curren
-00003760: 7429 3a0a 2020 2020 2020 2020 6966 206e  t):.        if n
-00003770: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00003780: 7328 6f73 2e70 6174 682e 6578 7061 6e64  s(os.path.expand
-00003790: 7573 6572 2863 7572 7265 6e74 2929 3a0a  user(current)):.
-000037a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000037b0: 6520 696e 7175 6972 6572 2e65 7272 6f72  e inquirer.error
-000037c0: 732e 5661 6c69 6461 7469 6f6e 4572 726f  s.ValidationErro
-000037d0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000037e0: 2020 2022 222c 2072 6561 736f 6e3d 2250     "", reason="P
-000037f0: 6174 6820 646f 6573 206e 6f74 2065 7869  ath does not exi
-00003800: 7374 2229 0a20 2020 2020 2020 2072 6574  st").        ret
-00003810: 7572 6e20 5472 7565 0a0a 2020 2020 6465  urn True..    de
-00003820: 6620 7072 696e 745f 636f 6e66 6967 2873  f print_config(s
-00003830: 656c 6629 3a0a 2020 2020 2020 2020 2727  elf):.        ''
-00003840: 2750 7269 6e74 2074 6865 2063 6f6e 6669  'Print the confi
-00003850: 6775 7261 7469 6f6e 2066 696c 6573 2727  guration files''
-00003860: 270a 0a20 2020 2020 2020 2069 6620 6f73  '..        if os
-00003870: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00003880: 662e 636f 6e66 6967 5f66 696c 6529 3a0a  f.config_file):.
-00003890: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000038a0: 7428 6627 5c6e 2a2a 2a20 4c4f 4341 4c20  t(f'\n*** LOCAL 
-000038b0: 434f 4e46 4947 5552 4154 494f 4e20 4154  CONFIGURATION AT
-000038c0: 3a20 7b73 656c 662e 636f 6e66 6967 5f66  : {self.config_f
-000038d0: 696c 657d 5c6e 2729 0a20 2020 2020 2020  ile}\n').       
-000038e0: 2020 2020 2077 6974 6820 6f70 656e 2873       with open(s
-000038f0: 656c 662e 636f 6e66 6967 5f66 696c 652c  elf.config_file,
-00003900: 2027 7227 2920 6173 2066 3a0a 2020 2020   'r') as f:.    
-00003910: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00003920: 7428 662e 7265 6164 2829 290a 0a20 2020  t(f.read())..   
-00003930: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00003940: 2e69 735f 7368 6172 6564 2061 6e64 206f  .is_shared and o
-00003950: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00003960: 6c66 2e73 6861 7265 645f 636f 6e66 6967  lf.shared_config
-00003970: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
-00003980: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-00003990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039a0: 2020 2066 272a 2a2a 2053 4841 5245 4420     f'*** SHARED 
-000039b0: 434f 4e46 4947 5552 4154 494f 4e20 4154  CONFIGURATION AT
-000039c0: 3a20 7b73 656c 662e 7368 6172 6564 5f63  : {self.shared_c
-000039d0: 6f6e 6669 675f 6669 6c65 7d5c 6e27 290a  onfig_file}\n').
-000039e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039f0: 7769 7468 206f 7065 6e28 7365 6c66 2e73  with open(self.s
-00003a00: 6861 7265 645f 636f 6e66 6967 5f66 696c  hared_config_fil
-00003a10: 652c 2027 7227 2920 6173 2066 3a0a 2020  e, 'r') as f:.  
-00003a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a30: 2020 7072 696e 7428 662e 7265 6164 2829    print(f.read()
-00003a40: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00003a50: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00003a60: 7428 6627 5c6e 2a2a 2a20 4e4f 2043 4f4e  t(f'\n*** NO CON
-00003a70: 4649 4755 5241 5449 4f4e 2046 4f55 4e44  FIGURATION FOUND
-00003a80: 202a 2a2a 2729 0a20 2020 2020 2020 2020   ***').         
-00003a90: 2020 2070 7269 6e74 2827 5c6e 596f 7520     print('\nYou 
-00003aa0: 6361 6e20 636f 6e66 6967 7572 6520 6672  can configure fr
-00003ab0: 6f73 7465 7220 7573 696e 6720 7468 6520  oster using the 
-00003ac0: 636f 6d6d 616e 643a 2729 0a20 2020 2020  command:').     
-00003ad0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-00003ae0: 2020 6672 6f73 7465 7220 636f 6e66 6967    froster config
-00003af0: 2729 0a0a 2020 2020 6465 6620 7365 745f  ')..    def set_
-00003b00: 656e 765f 7661 7273 2873 656c 662c 2070  env_vars(self, p
-00003b10: 726f 6669 6c65 293a 0a20 2020 2020 2020  rofile):.       
-00003b20: 2027 2727 5365 7420 7468 6520 656e 7669   '''Set the envi
-00003b30: 726f 6e6d 656e 7420 7661 7269 6162 6c65  ronment variable
-00003b40: 7320 666f 7220 7468 6520 4157 5320 7072  s for the AWS pr
-00003b50: 6f66 696c 6527 2727 0a0a 2020 2020 2020  ofile'''..      
-00003b60: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-00003b70: 2020 2020 2066 2754 4f44 4f3a 2046 756e       f'TODO: Fun
-00003b80: 6374 696f 6e20 7b69 6e73 7065 6374 2e63  ction {inspect.c
-00003b90: 7572 7265 6e74 6672 616d 6528 292e 665f  urrentframe().f_
-00003ba0: 636f 6465 2e63 6f5f 6e61 6d65 7d20 4920  code.co_name} I 
-00003bb0: 646f 206e 6f74 206b 6e6f 7720 6966 2077  do not know if w
-00003bc0: 6520 7265 616c 6c79 206e 6565 6420 746f  e really need to
-00003bd0: 2073 6574 2065 6e76 6972 6f6e 6d65 6e74   set environment
-00003be0: 2076 6172 6961 626c 6573 2074 6f20 6265   variables to be
-00003bf0: 2066 756e 6374 696f 6e61 6c27 290a 2020   functional').  
-00003c00: 2020 2020 2020 6578 6974 2831 290a 2020        exit(1).  
-00003c10: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-00003c20: 2043 6f6e 6669 6750 6172 7365 7220 6f62   ConfigParser ob
-00003c30: 6a65 6374 0a20 2020 2020 2020 2063 6f6e  ject.        con
-00003c40: 6669 6720 3d20 636f 6e66 6967 7061 7273  fig = configpars
-00003c50: 6572 2e43 6f6e 6669 6750 6172 7365 7228  er.ConfigParser(
-00003c60: 290a 0a20 2020 2020 2020 2023 2052 6561  )..        # Rea
-00003c70: 6420 7468 6520 6372 6564 656e 7469 616c  d the credential
-00003c80: 7320 6669 6c65 0a20 2020 2020 2020 2063  s file.        c
-00003c90: 6f6e 6669 672e 7265 6164 2873 656c 662e  onfig.read(self.
-00003ca0: 6177 735f 6372 6564 656e 7469 616c 735f  aws_credentials_
-00003cb0: 6669 6c65 290a 2020 2020 2020 2020 7365  file).        se
-00003cc0: 6c66 2e61 7773 5f72 6567 696f 6e20 3d20  lf.aws_region = 
-00003cd0: 7365 6c66 2e67 6574 5f61 7773 5f72 6567  self.get_aws_reg
-00003ce0: 696f 6e28 7072 6f66 696c 6529 0a0a 2020  ion(profile)..  
-00003cf0: 2020 2020 2020 6966 206e 6f74 2063 6f6e        if not con
-00003d00: 6669 672e 6861 735f 7365 6374 696f 6e28  fig.has_section(
-00003d10: 7072 6f66 696c 6529 3a0a 2020 2020 2020  profile):.      
-00003d20: 2020 2020 2020 6966 2073 656c 662e 6172        if self.ar
-00003d30: 6773 2e64 6562 7567 3a0a 2020 2020 2020  gs.debug:.      
-00003d40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00003d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003d60: 2020 2020 2066 277e 2f2e 6177 732f 6372       f'~/.aws/cr
-00003d70: 6564 656e 7469 616c 7320 6861 7320 6e6f  edentials has no
-00003d80: 2073 6563 7469 6f6e 2066 6f72 2070 726f   section for pro
-00003d90: 6669 6c65 207b 7072 6f66 696c 657d 2729  file {profile}')
-00003da0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003db0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00003dc0: 2020 6966 206e 6f74 2063 6f6e 6669 672e    if not config.
-00003dd0: 6861 735f 6f70 7469 6f6e 2870 726f 6669  has_option(profi
-00003de0: 6c65 2c20 2761 7773 5f61 6363 6573 735f  le, 'aws_access_
-00003df0: 6b65 795f 6964 2729 3a0a 2020 2020 2020  key_id'):.      
-00003e00: 2020 2020 2020 6966 2073 656c 662e 6172        if self.ar
-00003e10: 6773 2e64 6562 7567 3a0a 2020 2020 2020  gs.debug:.      
-00003e20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00003e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e40: 2020 2020 2066 277e 2f2e 6177 732f 6372       f'~/.aws/cr
-00003e50: 6564 656e 7469 616c 7320 6861 7320 6e6f  edentials has no
-00003e60: 2065 6e74 7279 2061 7773 5f61 6363 6573   entry aws_acces
-00003e70: 735f 6b65 795f 6964 2069 6e20 7365 6374  s_key_id in sect
-00003e80: 696f 6e2f 7072 6f66 696c 6520 7b70 726f  ion/profile {pro
-00003e90: 6669 6c65 7d27 290a 2020 2020 2020 2020  file}').        
-00003ea0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00003eb0: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-00003ec0: 7468 6520 4157 5320 6163 6365 7373 206b  the AWS access k
-00003ed0: 6579 2061 6e64 2073 6563 7265 7420 6b65  ey and secret ke
-00003ee0: 7920 6672 6f6d 2074 6865 2073 7065 6369  y from the speci
-00003ef0: 6669 6564 2070 726f 6669 6c65 0a20 2020  fied profile.   
-00003f00: 2020 2020 2061 7773 5f61 6363 6573 735f       aws_access_
-00003f10: 6b65 795f 6964 203d 2063 6f6e 6669 672e  key_id = config.
-00003f20: 6765 7428 7072 6f66 696c 652c 2027 6177  get(profile, 'aw
-00003f30: 735f 6163 6365 7373 5f6b 6579 5f69 6427  s_access_key_id'
-00003f40: 290a 2020 2020 2020 2020 6177 735f 7365  ).        aws_se
-00003f50: 6372 6574 5f61 6363 6573 735f 6b65 7920  cret_access_key 
-00003f60: 3d20 636f 6e66 6967 2e67 6574 2870 726f  = config.get(pro
-00003f70: 6669 6c65 2c20 2761 7773 5f73 6563 7265  file, 'aws_secre
-00003f80: 745f 6163 6365 7373 5f6b 6579 2729 0a0a  t_access_key')..
-00003f90: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
-00003fa0: 6520 656e 7669 726f 6e6d 656e 7420 7661  e environment va
-00003fb0: 7269 6162 6c65 7320 666f 7220 6372 6564  riables for cred
-00003fc0: 730a 2020 2020 2020 2020 6f73 2e65 6e76  s.        os.env
-00003fd0: 6972 6f6e 5b27 4157 535f 4143 4345 5353  iron['AWS_ACCESS
-00003fe0: 5f4b 4559 5f49 4427 5d20 3d20 6177 735f  _KEY_ID'] = aws_
-00003ff0: 6163 6365 7373 5f6b 6579 5f69 640a 2020  access_key_id.  
-00004000: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00004010: 5b27 4157 535f 5345 4352 4554 5f41 4343  ['AWS_SECRET_ACC
-00004020: 4553 535f 4b45 5927 5d20 3d20 6177 735f  ESS_KEY'] = aws_
-00004030: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
-00004040: 790a 2020 2020 2020 2020 6f73 2e65 6e76  y.        os.env
-00004050: 6972 6f6e 5b27 4157 535f 5052 4f46 494c  iron['AWS_PROFIL
-00004060: 4527 5d20 3d20 7072 6f66 696c 650a 2020  E'] = profile.  
-00004070: 2020 2020 2020 7365 6c66 2e65 6e76 726e        self.envrn
-00004080: 5b27 4157 535f 4143 4345 5353 5f4b 4559  ['AWS_ACCESS_KEY
-00004090: 5f49 4427 5d20 3d20 6177 735f 6163 6365  _ID'] = aws_acce
-000040a0: 7373 5f6b 6579 5f69 640a 2020 2020 2020  ss_key_id.      
-000040b0: 2020 7365 6c66 2e65 6e76 726e 5b27 4157    self.envrn['AW
-000040c0: 535f 5345 4352 4554 5f41 4343 4553 535f  S_SECRET_ACCESS_
-000040d0: 4b45 5927 5d20 3d20 6177 735f 7365 6372  KEY'] = aws_secr
-000040e0: 6574 5f61 6363 6573 735f 6b65 790a 2020  et_access_key.  
-000040f0: 2020 2020 2020 7365 6c66 2e65 6e76 726e        self.envrn
-00004100: 5b27 4157 535f 5052 4f46 494c 4527 5d20  ['AWS_PROFILE'] 
-00004110: 3d20 7072 6f66 696c 650a 2020 2020 2020  = profile.      
-00004120: 2020 7365 6c66 2e65 6e76 726e 5b27 5243    self.envrn['RC
-00004130: 4c4f 4e45 5f53 335f 4143 4345 5353 5f4b  LONE_S3_ACCESS_K
-00004140: 4559 5f49 4427 5d20 3d20 6177 735f 6163  EY_ID'] = aws_ac
-00004150: 6365 7373 5f6b 6579 5f69 640a 2020 2020  cess_key_id.    
-00004160: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
-00004170: 5243 4c4f 4e45 5f53 335f 5345 4352 4554  RCLONE_S3_SECRET
-00004180: 5f41 4343 4553 535f 4b45 5927 5d20 3d20  _ACCESS_KEY'] = 
-00004190: 6177 735f 7365 6372 6574 5f61 6363 6573  aws_secret_acces
-000041a0: 735f 6b65 790a 0a20 2020 2020 2020 2069  s_key..        i
-000041b0: 6620 7072 6f66 696c 6520 696e 205b 2764  f profile in ['d
-000041c0: 6566 6175 6c74 272c 2027 4157 5327 2c20  efault', 'AWS', 
-000041d0: 2761 7773 275d 3a0a 2020 2020 2020 2020  'aws']:.        
-000041e0: 2020 2020 2320 5365 7420 7468 6520 656e      # Set the en
-000041f0: 7669 726f 6e6d 656e 7420 7661 7269 6162  vironment variab
-00004200: 6c65 7320 666f 7220 4157 530a 2020 2020  les for AWS.    
-00004210: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
-00004220: 726e 5b27 5243 4c4f 4e45 5f53 335f 5052  rn['RCLONE_S3_PR
-00004230: 4f56 4944 4552 275d 203d 2027 4157 5327  OVIDER'] = 'AWS'
-00004240: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004250: 662e 656e 7672 6e5b 2752 434c 4f4e 455f  f.envrn['RCLONE_
-00004260: 5333 5f52 4547 494f 4e27 5d20 3d20 7365  S3_REGION'] = se
-00004270: 6c66 2e61 7773 5f72 6567 696f 6e0a 2020  lf.aws_region.  
-00004280: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
-00004290: 6e76 726e 5b27 5243 4c4f 4e45 5f53 335f  nvrn['RCLONE_S3_
-000042a0: 4c4f 4341 5449 4f4e 5f43 4f4e 5354 5241  LOCATION_CONSTRA
-000042b0: 494e 5427 5d20 3d20 7365 6c66 2e61 7773  INT'] = self.aws
-000042c0: 5f72 6567 696f 6e0a 2020 2020 2020 2020  _region.        
-000042d0: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
-000042e0: 5243 4c4f 4e45 5f53 335f 5354 4f52 4147  RCLONE_S3_STORAG
-000042f0: 455f 434c 4153 5327 5d20 3d20 7365 6c66  E_CLASS'] = self
-00004300: 2e72 6561 6428 0a20 2020 2020 2020 2020  .read(.         
-00004310: 2020 2020 2020 2027 6765 6e65 7261 6c27         'general'
-00004320: 2c20 2773 335f 7374 6f72 6167 655f 636c  , 's3_storage_cl
-00004330: 6173 7327 290a 2020 2020 2020 2020 2020  ass').          
-00004340: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5243    os.environ['RC
-00004350: 4c4f 4e45 5f53 335f 5354 4f52 4147 455f  LONE_S3_STORAGE_
-00004360: 434c 4153 5327 5d20 3d20 7365 6c66 2e72  CLASS'] = self.r
-00004370: 6561 6428 0a20 2020 2020 2020 2020 2020  ead(.           
-00004380: 2020 2020 2027 6765 6e65 7261 6c27 2c20       'general', 
-00004390: 2773 335f 7374 6f72 6167 655f 636c 6173  's3_storage_clas
-000043a0: 7327 290a 2020 2020 2020 2020 656c 7365  s').        else
-000043b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000043c0: 6620 3d20 7365 6c66 2e72 6561 6428 2770  f = self.read('p
-000043d0: 726f 6669 6c65 7327 2c20 7072 6f66 696c  rofiles', profil
-000043e0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-000043f0: 656c 662e 656e 7672 6e5b 2752 434c 4f4e  elf.envrn['RCLON
-00004400: 455f 5333 5f45 4e56 5f41 5554 4827 5d20  E_S3_ENV_AUTH'] 
-00004410: 3d20 2774 7275 6527 0a20 2020 2020 2020  = 'true'.       
-00004420: 2020 2020 2073 656c 662e 656e 7672 6e5b       self.envrn[
-00004430: 2752 434c 4f4e 455f 5333 5f50 524f 4649  'RCLONE_S3_PROFI
-00004440: 4c45 275d 203d 2070 726f 6669 6c65 0a20  LE'] = profile. 
-00004450: 2020 2020 2020 2020 2020 2023 2070 726f             # pro
-00004460: 6669 6c65 3d7b 276e 616d 6527 3a20 2727  file={'name': ''
-00004470: 2c20 2770 726f 7669 6465 7227 3a20 2727  , 'provider': ''
-00004480: 2c20 2773 746f 7261 6765 5f63 6c61 7373  , 'storage_class
-00004490: 273a 2027 277d 0a20 2020 2020 2020 2020  ': ''}.         
-000044a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000044b0: 2870 7266 2c20 6469 6374 293a 0a20 2020  (prf, dict):.   
-000044c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000044d0: 662e 656e 7672 6e5b 2752 434c 4f4e 455f  f.envrn['RCLONE_
-000044e0: 5333 5f50 524f 5649 4445 5227 5d20 3d20  S3_PROVIDER'] = 
-000044f0: 7072 665b 2770 726f 7669 6465 7227 5d0a  prf['provider'].
-00004500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004510: 2320 544f 444f 3a20 5468 6572 6520 6973  # TODO: There is
-00004520: 2061 2073 656c 662e 6765 745f 656e 6470   a self.get_endp
-00004530: 6f69 6e74 2829 2069 6e20 4157 5342 4f54  oint() in AWSBOT
-00004540: 4f20 636c 6173 730a 2020 2020 2020 2020  O class.        
-00004550: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
-00004560: 726e 5b27 5243 4c4f 4e45 5f53 335f 454e  rn['RCLONE_S3_EN
-00004570: 4450 4f49 4e54 275d 203d 2073 656c 662e  DPOINT'] = self.
-00004580: 5f67 6574 5f61 7773 5f73 335f 7365 7373  _get_aws_s3_sess
-00004590: 696f 6e5f 656e 6470 6f69 6e74 5f75 726c  ion_endpoint_url
-000045a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000045b0: 2020 2020 2020 7072 6f66 696c 6529 0a20        profile). 
-000045c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000045d0: 656c 662e 656e 7672 6e5b 2752 434c 4f4e  elf.envrn['RCLON
-000045e0: 455f 5333 5f52 4547 494f 4e27 5d20 3d20  E_S3_REGION'] = 
-000045f0: 7365 6c66 2e61 7773 5f72 6567 696f 6e0a  self.aws_region.
-00004600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004610: 7365 6c66 2e65 6e76 726e 5b27 5243 4c4f  self.envrn['RCLO
-00004620: 4e45 5f53 335f 4c4f 4341 5449 4f4e 5f43  NE_S3_LOCATION_C
-00004630: 4f4e 5354 5241 494e 5427 5d20 3d20 7365  ONSTRAINT'] = se
-00004640: 6c66 2e61 7773 5f72 6567 696f 6e0a 2020  lf.aws_region.  
-00004650: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004660: 6c66 2e65 6e76 726e 5b27 5243 4c4f 4e45  lf.envrn['RCLONE
-00004670: 5f53 335f 5354 4f52 4147 455f 434c 4153  _S3_STORAGE_CLAS
-00004680: 5327 5d20 3d20 7072 665b 2773 746f 7261  S'] = prf['stora
-00004690: 6765 5f63 6c61 7373 275d 0a20 2020 2020  ge_class'].     
-000046a0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-000046b0: 7669 726f 6e5b 2752 434c 4f4e 455f 5333  viron['RCLONE_S3
-000046c0: 5f53 544f 5241 4745 5f43 4c41 5353 275d  _STORAGE_CLASS']
-000046d0: 203d 2070 7266 5b27 7374 6f72 6167 655f   = prf['storage_
-000046e0: 636c 6173 7327 5d0a 0a20 2020 2020 2020  class']..       
-000046f0: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
-00004700: 2020 6465 6620 7365 745f 6177 7328 7365    def set_aws(se
-00004710: 6c66 2c20 6177 733a 2027 4157 5342 6f74  lf, aws: 'AWSBot
-00004720: 6f27 293a 0a0a 2020 2020 2020 2020 6966  o'):..        if
-00004730: 206e 6f74 2073 656c 662e 7573 6572 5f69   not self.user_i
-00004740: 6e69 743a 0a20 2020 2020 2020 2020 2020  nit:.           
-00004750: 2070 7269 6e74 2866 275c 6e55 7365 7220   print(f'\nUser 
-00004760: 636f 6e66 6967 7572 6174 696f 6e20 6973  configuration is
-00004770: 206d 6973 7369 6e67 2729 0a20 2020 2020   missing').     
-00004780: 2020 2020 2020 2070 7269 6e74 2827 596f         print('Yo
-00004790: 7520 6361 6e20 636f 6e66 6967 7572 6520  u can configure 
-000047a0: 7573 6572 2073 6574 7469 6e67 7320 7573  user settings us
-000047b0: 696e 6720 7468 6520 636f 6d6d 616e 643a  ing the command:
-000047c0: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-000047d0: 7269 6e74 2827 2020 2020 6672 6f73 7465  rint('    froste
-000047e0: 7220 636f 6e66 6967 202d 2d75 7365 725c  r config --user\
-000047f0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-00004800: 7379 732e 6578 6974 2830 290a 0a20 2020  sys.exit(0)..   
-00004810: 2020 2020 2070 7269 6e74 2866 275c 6e2a       print(f'\n*
-00004820: 2a2a 2041 5753 2043 4f4e 4649 4755 5241  ** AWS CONFIGURA
-00004830: 5449 4f4e 202a 2a2a 5c6e 2729 0a0a 2020  TION ***\n')..  
-00004840: 2020 2020 2020 2320 4765 7420 6c69 7374        # Get list
-00004850: 206f 6620 6375 7272 656e 7420 4157 5320   of current AWS 
-00004860: 7072 6f66 696c 6573 2075 6e64 6572 207e  profiles under ~
-00004870: 2f2e 6177 732f 6372 6564 656e 7469 616c  /.aws/credential
-00004880: 730a 2020 2020 2020 2020 6177 735f 7072  s.        aws_pr
-00004890: 6f66 696c 6573 203d 2061 7773 2e67 6574  ofiles = aws.get
-000048a0: 5f70 726f 6669 6c65 7328 290a 0a20 2020  _profiles()..   
-000048b0: 2020 2020 2023 2041 6464 2061 6e20 6f70       # Add an op
-000048c0: 7469 6f6e 2074 6f20 6372 6561 7465 2061  tion to create a
-000048d0: 206e 6577 2070 726f 6669 6c65 0a20 2020   new profile.   
-000048e0: 2020 2020 2061 7773 5f70 726f 6669 6c65       aws_profile
-000048f0: 732e 6170 7065 6e64 2827 2b20 4372 6561  s.append('+ Crea
-00004900: 7465 206e 6577 2070 726f 6669 6c65 2729  te new profile')
-00004910: 0a0a 2020 2020 2020 2020 2320 4173 6b20  ..        # Ask 
-00004920: 7573 6572 2074 6f20 6368 6f6f 7365 2061  user to choose a
-00004930: 6e20 6578 6973 7469 6e67 2061 7773 2070  n existing aws p
-00004940: 726f 6669 6c65 206f 7220 6372 6561 7465  rofile or create
-00004950: 2061 206e 6577 206f 6e65 0a20 2020 2020   a new one.     
-00004960: 2020 2061 7773 5f70 726f 6669 6c65 203d     aws_profile =
-00004970: 2069 6e71 7569 7265 722e 6c69 7374 5f69   inquirer.list_i
-00004980: 6e70 7574 2822 4368 6f6f 7365 2079 6f75  nput("Choose you
-00004990: 7220 6177 7320 7072 6f66 696c 6522 2c0a  r aws profile",.
-000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049c0: 2020 2020 2020 2020 2020 6368 6f69 6365            choice
-000049d0: 733d 6177 735f 7072 6f66 696c 6573 290a  s=aws_profiles).
-000049e0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-000049f0: 2069 6620 7573 6572 2077 616e 7473 2074   if user wants t
-00004a00: 6f20 6372 6561 7465 2061 206e 6577 2061  o create a new a
-00004a10: 7773 2070 726f 6669 6c65 0a20 2020 2020  ws profile.     
-00004a20: 2020 2069 6620 6177 735f 7072 6f66 696c     if aws_profil
-00004a30: 6520 3d3d 2027 2b20 4372 6561 7465 206e  e == '+ Create n
-00004a40: 6577 2070 726f 6669 6c65 273a 0a0a 2020  ew profile':..  
-00004a50: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-00004a60: 6e65 7720 7072 6f66 696c 6520 6e61 6d65  new profile name
-00004a70: 0a20 2020 2020 2020 2020 2020 2061 7773  .            aws
-00004a80: 5f6e 6577 5f70 726f 6669 6c65 5f6e 616d  _new_profile_nam
-00004a90: 6520 3d20 696e 7175 6972 6572 2e74 6578  e = inquirer.tex
-00004aa0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00004ab0: 2020 206d 6573 7361 6765 3d22 456e 7465     message="Ente
-00004ac0: 7220 6e65 7720 7072 6f66 696c 6520 6e61  r new profile na
-00004ad0: 6d65 222c 2076 616c 6964 6174 653d 7365  me", validate=se
-00004ae0: 6c66 2e5f 5f69 6e71 7569 7265 725f 6368  lf.__inquirer_ch
-00004af0: 6563 6b5f 7265 7175 6972 6564 290a 0a20  eck_required).. 
-00004b00: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00004b10: 6e65 7720 7072 6f66 696c 6520 6e61 6d65  new profile name
-00004b20: 2061 6c72 6561 6479 2065 7869 7374 732c   already exists,
-00004b30: 2074 6865 6e20 7072 6f6d 7074 2075 7365   then prompt use
-00004b40: 7220 6966 2077 6520 7368 6f75 6c64 206f  r if we should o
-00004b50: 7665 7277 7269 7465 2069 740a 2020 2020  verwrite it.    
-00004b60: 2020 2020 2020 2020 6966 2061 7773 5f6e          if aws_n
-00004b70: 6577 5f70 726f 6669 6c65 5f6e 616d 6520  ew_profile_name 
-00004b80: 696e 2061 7773 5f70 726f 6669 6c65 733a  in aws_profiles:
-00004b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ba0: 2069 735f 6f76 6572 7772 6974 6520 3d20   is_overwrite = 
-00004bb0: 696e 7175 6972 6572 2e63 6f6e 6669 726d  inquirer.confirm
-00004bc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00004bd0: 2020 2020 2020 6d65 7373 6167 653d 6627        message=f'
-00004be0: 5741 524e 494e 473a 2044 6f20 796f 7520  WARNING: Do you 
-00004bf0: 7761 6e74 2074 6f20 6f76 6572 7772 6974  want to overwrit
-00004c00: 6520 7072 6f66 696c 6520 7b61 7773 5f6e  e profile {aws_n
-00004c10: 6577 5f70 726f 6669 6c65 5f6e 616d 657d  ew_profile_name}
-00004c20: 3f27 2c20 6465 6661 756c 743d 4661 6c73  ?', default=Fals
-00004c30: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00004c40: 2020 2020 6966 206e 6f74 2069 735f 6f76      if not is_ov
-00004c50: 6572 7772 6974 653a 0a20 2020 2020 2020  erwrite:.       
-00004c60: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-00004c70: 6620 7573 6572 2064 6f65 7320 6e6f 7420  f user does not 
-00004c80: 7761 6e74 2074 6f20 6f76 6572 7772 6974  want to overwrit
-00004c90: 6520 7468 6520 7072 6f66 696c 652c 2074  e the profile, t
-00004ca0: 6865 6e20 7265 7475 726e 0a20 2020 2020  hen return.     
-00004cb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004cc0: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
-00004cd0: 2020 2023 2047 6574 2061 7773 2061 6363     # Get aws acc
-00004ce0: 6573 7320 6b65 7920 6964 0a20 2020 2020  ess key id.     
-00004cf0: 2020 2020 2020 2061 7773 5f61 6363 6573         aws_acces
-00004d00: 735f 6b65 795f 6964 203d 2069 6e71 7569  s_key_id = inqui
-00004d10: 7265 722e 7465 7874 280a 2020 2020 2020  rer.text(.      
-00004d20: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-00004d30: 653d 2241 5753 2041 6363 6573 7320 4b65  e="AWS Access Ke
-00004d40: 7920 4944 222c 2076 616c 6964 6174 653d  y ID", validate=
-00004d50: 7365 6c66 2e5f 5f69 6e71 7569 7265 725f  self.__inquirer_
-00004d60: 6368 6563 6b5f 7265 7175 6972 6564 290a  check_required).
-00004d70: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
-00004d80: 6574 2061 7773 2073 6563 7265 7420 6163  et aws secret ac
-00004d90: 6365 7373 206b 6579 0a20 2020 2020 2020  cess key.       
-00004da0: 2020 2020 2061 7773 5f73 6563 7265 745f       aws_secret_
-00004db0: 6163 6365 7373 5f6b 6579 203d 2069 6e71  access_key = inq
-00004dc0: 7569 7265 722e 7465 7874 280a 2020 2020  uirer.text(.    
-00004dd0: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-00004de0: 6167 653d 2241 5753 2053 6563 7265 7420  age="AWS Secret 
-00004df0: 4163 6365 7373 204b 6579 222c 2076 616c  Access Key", val
-00004e00: 6964 6174 653d 7365 6c66 2e5f 5f69 6e71  idate=self.__inq
-00004e10: 7569 7265 725f 6368 6563 6b5f 7265 7175  uirer_check_requ
-00004e20: 6972 6564 290a 0a20 2020 2020 2020 2020  ired)..         
-00004e30: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
-00004e40: 6520 7072 6f76 6964 6564 2061 7773 2063  e provided aws c
-00004e50: 7265 6465 6e74 6961 6c73 2061 7265 2076  redentials are v
-00004e60: 616c 6964 0a20 2020 2020 2020 2020 2020  alid.           
-00004e70: 2070 7269 6e74 2822 5c6e 4368 6563 6b69   print("\nChecki
-00004e80: 6e67 2041 5753 2063 7265 6465 6e74 6961  ng AWS credentia
-00004e90: 6c73 2e2e 2e22 290a 0a20 2020 2020 2020  ls...")..       
-00004ea0: 2020 2020 2069 6620 6177 732e 6368 6563       if aws.chec
-00004eb0: 6b5f 6372 6564 656e 7469 616c 7328 6177  k_credentials(aw
-00004ec0: 735f 6163 6365 7373 5f6b 6579 5f69 643d  s_access_key_id=
-00004ed0: 6177 735f 6163 6365 7373 5f6b 6579 5f69  aws_access_key_i
-00004ee0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00004ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f00: 2020 2020 2020 2020 6177 735f 7365 6372          aws_secr
-00004f10: 6574 5f61 6363 6573 735f 6b65 793d 6177  et_access_key=aw
-00004f20: 735f 7365 6372 6574 5f61 6363 6573 735f  s_secret_access_
-00004f30: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
-00004f40: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-00004f50: 202e 2e2e 4157 5320 6372 6564 656e 7469   ...AWS credenti
-00004f60: 616c 7320 6172 6520 7661 6c69 645c 6e27  als are valid\n'
-00004f70: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00004f80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004f90: 2020 2020 7072 696e 7428 2720 2020 202e      print('    .
-00004fa0: 2e2e 4157 5320 6372 6564 656e 7469 616c  ..AWS credential
-00004fb0: 7320 6172 6520 4e4f 5420 7661 6c69 645c  s are NOT valid\
-00004fc0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-00004fd0: 2020 2020 7072 696e 7428 275c 6e59 6f75      print('\nYou
-00004fe0: 2063 616e 2063 6f6e 6669 6775 7265 2061   can configure a
-00004ff0: 7773 2063 7265 6465 6e74 6961 6c73 2075  ws credentials u
-00005000: 7369 6e67 2074 6865 2063 6f6d 6d61 6e64  sing the command
-00005010: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-00005020: 2020 2020 7072 696e 7428 2720 2020 2066      print('    f
-00005030: 726f 7374 6572 2063 6f6e 6669 6720 2d2d  roster config --
-00005040: 6177 735c 6e27 290a 2020 2020 2020 2020  aws\n').        
-00005050: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00005060: 2830 290a 0a20 2020 2020 2020 2020 2020  (0)..           
-00005070: 2023 2047 6574 206c 6973 7420 6f66 2041   # Get list of A
-00005080: 5753 2072 6567 696f 6e73 0a20 2020 2020  WS regions.     
-00005090: 2020 2020 2020 2061 7773 5f72 6567 696f         aws_regio
-000050a0: 6e73 203d 2061 7773 2e67 6574 5f72 6567  ns = aws.get_reg
-000050b0: 696f 6e73 2829 0a0a 2020 2020 2020 2020  ions()..        
-000050c0: 2020 2020 2320 4173 6b20 7573 6572 2074      # Ask user t
-000050d0: 6f20 6368 6f6f 7365 2061 2072 6567 696f  o choose a regio
-000050e0: 6e0a 2020 2020 2020 2020 2020 2020 7265  n.            re
-000050f0: 6769 6f6e 203d 2069 6e71 7569 7265 722e  gion = inquirer.
-00005100: 6c69 7374 5f69 6e70 7574 2822 4368 6f6f  list_input("Choo
-00005110: 7365 2079 6f75 7220 7265 6769 6f6e 222c  se your region",
-00005120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005140: 2020 2020 2020 2020 2020 6368 6f69 6365            choice
-00005150: 733d 6177 735f 7265 6769 6f6e 7329 0a0a  s=aws_regions)..
-00005160: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-00005170: 6561 7465 206e 6577 2070 726f 6669 6c65  eate new profile
-00005180: 2069 6e20 7e2f 2e61 7773 2f63 7265 6465   in ~/.aws/crede
-00005190: 6e74 6961 6c73 0a20 2020 2020 2020 2020  ntials.         
-000051a0: 2020 2073 656c 662e 5f5f 7365 745f 6177     self.__set_aw
-000051b0: 735f 6372 6564 656e 7469 616c 7328 6177  s_credentials(aw
-000051c0: 735f 7072 6f66 696c 655f 6e61 6d65 3d61  s_profile_name=a
-000051d0: 7773 5f6e 6577 5f70 726f 6669 6c65 5f6e  ws_new_profile_n
-000051e0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-000051f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005200: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
-00005210: 6163 6365 7373 5f6b 6579 5f69 643d 6177  access_key_id=aw
-00005220: 735f 6163 6365 7373 5f6b 6579 5f69 642c  s_access_key_id,
-00005230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005250: 2020 2020 2020 2020 6177 735f 7365 6372          aws_secr
-00005260: 6574 5f61 6363 6573 735f 6b65 793d 6177  et_access_key=aw
-00005270: 735f 7365 6372 6574 5f61 6363 6573 735f  s_secret_access_
-00005280: 6b65 7929 0a0a 2020 2020 2020 2020 2020  key)..          
-00005290: 2020 2320 4372 6561 7465 206e 6577 2070    # Create new p
-000052a0: 726f 6669 6c65 2069 6e20 7e2f 2e61 7773  rofile in ~/.aws
-000052b0: 2f63 6f6e 6669 670a 2020 2020 2020 2020  /config.        
-000052c0: 2020 2020 7365 6c66 2e5f 5f73 6574 5f61      self.__set_a
-000052d0: 7773 5f63 6f6e 6669 6728 6177 735f 7072  ws_config(aws_pr
-000052e0: 6f66 696c 655f 6e61 6d65 3d61 7773 5f6e  ofile_name=aws_n
-000052f0: 6577 5f70 726f 6669 6c65 5f6e 616d 652c  ew_profile_name,
-00005300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005320: 2020 2072 6567 696f 6e3d 7265 6769 6f6e     region=region
-00005330: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00005340: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
-00005350: 5849 5354 494e 4720 5052 4f46 494c 4520  XISTING PROFILE 
-00005360: 434f 4e46 4947 5552 4154 494f 4e0a 0a20  CONFIGURATION.. 
-00005370: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00005380: 636b 2069 6620 7468 6520 7072 6f76 6964  ck if the provid
-00005390: 6564 2061 7773 2063 7265 6465 6e74 6961  ed aws credentia
-000053a0: 6c73 2061 7265 2076 616c 6964 0a20 2020  ls are valid.   
-000053b0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-000053c0: 5c6e 4368 6563 6b69 6e67 2041 5753 2063  \nChecking AWS c
-000053d0: 7265 6465 6e74 6961 6c73 2e2e 2e22 290a  redentials...").
-000053e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000053f0: 6177 732e 6368 6563 6b5f 6372 6564 656e  aws.check_creden
-00005400: 7469 616c 7328 6177 735f 7072 6f66 696c  tials(aws_profil
-00005410: 653d 6177 735f 7072 6f66 696c 6529 3a0a  e=aws_profile):.
-00005420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005430: 7072 696e 7428 2720 2020 202e 2e2e 4157  print('    ...AW
-00005440: 5320 6372 6564 656e 7469 616c 7320 6172  S credentials ar
-00005450: 6520 7661 6c69 645c 6e27 290a 2020 2020  e valid\n').    
-00005460: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00005470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00005480: 696e 7428 2720 2020 202e 2e2e 4157 5320  int('    ...AWS 
-00005490: 6372 6564 656e 7469 616c 7320 6172 6520  credentials are 
-000054a0: 4e4f 5420 7661 6c69 645c 6e27 290a 2020  NOT valid\n').  
-000054b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000054c0: 696e 7428 275c 6e43 6f6e 6669 6775 7265  int('\nConfigure
-000054d0: 206e 6577 2061 7773 2063 7265 6465 6e74   new aws credent
-000054e0: 6961 6c73 2075 7369 6e67 2074 6865 2063  ials using the c
-000054f0: 6f6d 6d61 6e64 3a27 290a 2020 2020 2020  ommand:').      
-00005500: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00005510: 2720 2020 2066 726f 7374 6572 2063 6f6e  '    froster con
-00005520: 6669 6720 2d2d 6177 735c 6e27 290a 2020  fig --aws\n').  
-00005530: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00005540: 732e 6578 6974 2830 290a 0a20 2020 2020  s.exit(0)..     
-00005550: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-00005560: 2020 2e2e 2e41 5753 2063 7265 6465 6e74    ...AWS credent
-00005570: 6961 6c73 2061 7265 2076 616c 6964 5c6e  ials are valid\n
-00005580: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-00005590: 2320 4368 6563 6b20 7468 6520 7365 6c65  # Check the sele
-000055a0: 7465 6374 6564 2070 726f 6669 6c65 2072  tected profile r
-000055b0: 6567 696f 6e0a 2020 2020 2020 2020 2020  egion.          
-000055c0: 2020 6177 735f 7072 6f66 696c 655f 7265    aws_profile_re
-000055d0: 6769 6f6e 203d 2073 656c 662e 5f5f 7365  gion = self.__se
-000055e0: 745f 6177 735f 6765 745f 636f 6e66 6967  t_aws_get_config
-000055f0: 5f72 6567 696f 6e28 0a20 2020 2020 2020  _region(.       
-00005600: 2020 2020 2020 2020 2061 7773 5f70 726f           aws_pro
-00005610: 6669 6c65 3d61 7773 5f70 726f 6669 6c65  file=aws_profile
-00005620: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00005630: 2047 6574 206c 6973 7420 6f66 2041 5753   Get list of AWS
-00005640: 2072 6567 696f 6e73 0a20 2020 2020 2020   regions.       
-00005650: 2020 2020 2061 7773 5f72 6567 696f 6e73       aws_regions
-00005660: 203d 2061 7773 2e67 6574 5f72 6567 696f   = aws.get_regio
-00005670: 6e73 2829 0a0a 2020 2020 2020 2020 2020  ns()..          
-00005680: 2020 2320 4173 6b20 7573 6572 2074 6f20    # Ask user to 
-00005690: 6368 6f6f 7365 2061 2072 6567 696f 6e0a  choose a region.
-000056a0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-000056b0: 6f6e 203d 2069 6e71 7569 7265 722e 6c69  on = inquirer.li
-000056c0: 7374 5f69 6e70 7574 2822 4368 6f6f 7365  st_input("Choose
-000056d0: 2079 6f75 7220 7265 6769 6f6e 222c 0a20   your region",. 
-000056e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005700: 2020 2020 2020 2020 6465 6661 756c 743d          default=
-00005710: 6177 735f 7072 6f66 696c 655f 7265 6769  aws_profile_regi
-00005720: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00005730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005740: 2020 2020 2020 2020 2020 2020 2063 686f               cho
-00005750: 6963 6573 3d61 7773 5f72 6567 696f 6e73  ices=aws_regions
-00005760: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00005770: 6620 7265 6769 6f6e 2021 3d20 6177 735f  f region != aws_
-00005780: 7072 6f66 696c 655f 7265 6769 6f6e 3a0a  profile_region:.
-00005790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057a0: 2320 5570 6461 7465 2072 6567 696f 6e20  # Update region 
-000057b0: 696e 2074 6865 2063 6f6e 6669 6720 6669  in the config fi
-000057c0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-000057d0: 2020 2073 656c 662e 5f5f 7365 745f 6177     self.__set_aw
-000057e0: 735f 636f 6e66 6967 2861 7773 5f70 726f  s_config(aws_pro
-000057f0: 6669 6c65 5f6e 616d 653d 6177 735f 7072  file_name=aws_pr
-00005800: 6f66 696c 652c 0a20 2020 2020 2020 2020  ofile,.         
+000030f0: 6627 7b69 6e73 7065 6374 2e63 7572 7265  f'{inspect.curre
+00003100: 6e74 6672 616d 6528 292e 665f 636f 6465  ntframe().f_code
+00003110: 2e63 6f5f 6e61 6d65 7d3a 2074 7269 6564  .co_name}: tried
+00003120: 2074 6f20 6669 7820 7065 726d 6973 7369   to fix permissi
+00003130: 6f6e 7320 6f66 2061 206e 6f6e 2d64 6972  ons of a non-dir
+00003140: 6563 746f 7279 2022 7b64 6972 6563 746f  ectory "{directo
+00003150: 7279 7d22 2729 0a0a 2020 2020 2020 2020  ry}"')..        
+00003160: 2020 2020 2320 4765 7420 7468 6520 6772      # Get the gr
+00003170: 6f75 7020 4944 206f 6620 7468 6520 6469  oup ID of the di
+00003180: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
+00003190: 2020 2020 6469 725f 7374 6174 203d 206f      dir_stat = o
+000031a0: 732e 7374 6174 2864 6972 6563 746f 7279  s.stat(directory
+000031b0: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
+000031c0: 725f 6769 6420 3d20 6469 725f 7374 6174  r_gid = dir_stat
+000031d0: 2e73 745f 6769 640a 0a20 2020 2020 2020  .st_gid..       
+000031e0: 2020 2020 2023 2043 6861 6e67 6520 7468       # Change th
+000031f0: 6520 7065 726d 6973 7369 6f6e 7320 6f66  e permissions of
+00003200: 2074 6865 2064 6972 6563 746f 7279 2074   the directory t
+00003210: 6f20 306f 3237 3735 0a20 2020 2020 2020  o 0o2775.       
+00003220: 2020 2020 206f 732e 6368 6d6f 6428 6469       os.chmod(di
+00003230: 7265 6374 6f72 792c 2030 6f32 3737 3529  rectory, 0o2775)
+00003240: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00003250: 4974 6572 6174 6520 6f76 6572 2061 6c6c  Iterate over all
+00003260: 2066 696c 6573 2061 6e64 2064 6972 6563   files and direc
+00003270: 746f 7269 6573 2069 6e20 7468 6520 6469  tories in the di
+00003280: 7265 6374 6f72 7920 616e 6420 6974 7320  rectory and its 
+00003290: 7375 6264 6972 6563 746f 7269 6573 0a20  subdirectories. 
+000032a0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+000032b0: 6f6f 742c 2064 6972 732c 2066 696c 6573  oot, dirs, files
+000032c0: 2069 6e20 6f73 2e77 616c 6b28 6469 7265   in os.walk(dire
+000032d0: 6374 6f72 7929 3a0a 2020 2020 2020 2020  ctory):.        
+000032e0: 2020 2020 2020 2020 666f 7220 6469 7220          for dir 
+000032f0: 696e 2064 6972 733a 0a20 2020 2020 2020  in dirs:.       
+00003300: 2020 2020 2020 2020 2020 2020 2064 6972               dir
+00003310: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+00003320: 6a6f 696e 2872 6f6f 742c 2064 6972 290a  join(root, dir).
+00003330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003340: 2020 2020 2320 4368 616e 6765 2074 6865      # Change the
+00003350: 2070 6572 6d69 7373 696f 6e73 206f 6620   permissions of 
+00003360: 7468 6520 7375 6264 6972 6563 746f 7279  the subdirectory
+00003370: 2074 6f20 306f 3237 3735 0a20 2020 2020   to 0o2775.     
+00003380: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00003390: 732e 6368 6d6f 6428 6469 725f 7061 7468  s.chmod(dir_path
+000033a0: 2c20 306f 3237 3735 290a 0a20 2020 2020  , 0o2775)..     
+000033b0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+000033c0: 696c 6520 696e 2066 696c 6573 3a0a 2020  ile in files:.  
+000033d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000033e0: 2020 7061 7468 203d 206f 732e 7061 7468    path = os.path
+000033f0: 2e6a 6f69 6e28 726f 6f74 2c20 6669 6c65  .join(root, file
+00003400: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00003410: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
+00003420: 2066 696c 6520 6578 7465 6e73 696f 6e0a   file extension.
+00003430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003440: 2020 2020 5f2c 2065 7874 656e 7369 6f6e      _, extension
+00003450: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
+00003460: 6578 7428 7061 7468 290a 0a20 2020 2020  ext(path)..     
+00003470: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00003480: 2049 6620 7468 6520 6669 6c65 2069 7320   If the file is 
+00003490: 6120 2e70 656d 2066 696c 650a 2020 2020  a .pem file.    
+000034a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034b0: 6966 2065 7874 656e 7369 6f6e 203d 3d20  if extension == 
+000034c0: 272e 7065 6d27 3a0a 2020 2020 2020 2020  '.pem':.        
+000034d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034e0: 2320 4368 616e 6765 2074 6865 2070 6572  # Change the per
+000034f0: 6d69 7373 696f 6e73 2074 6f20 3430 300a  missions to 400.
+00003500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003510: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
+00003520: 2870 6174 682c 2030 6f34 3030 290a 2020  (path, 0o400).  
+00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003560: 2320 4368 616e 6765 2074 6865 2070 6572  # Change the per
+00003570: 6d69 7373 696f 6e73 2074 6f20 3636 340a  missions to 664.
+00003580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003590: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
+000035a0: 2870 6174 682c 2030 6f36 3634 290a 0a20  (path, 0o664).. 
+000035b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035c0: 2020 2023 2043 6861 6e67 6520 7468 6520     # Change the 
+000035d0: 6772 6f75 7020 4944 2074 6f20 7468 6520  group ID to the 
+000035e0: 7361 6d65 2061 7320 7468 6520 6469 7265  same as the dire
+000035f0: 6374 6f72 790a 2020 2020 2020 2020 2020  ctory.          
+00003600: 2020 2020 2020 2020 2020 6f73 2e63 686f            os.cho
+00003610: 776e 2870 6174 682c 202d 312c 2064 6972  wn(path, -1, dir
+00003620: 5f67 6964 290a 0a20 2020 2020 2020 2065  _gid)..        e
+00003630: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00003640: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00003650: 2020 7072 696e 7428 6627 5c6e 4572 726f    print(f'\nErro
+00003660: 723a 207b 657d 272c 2066 696c 653d 7379  r: {e}', file=sy
+00003670: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
+00003680: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+00003690: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
+000036a0: 6f75 6c64 206e 6f74 2066 6978 2070 6572  ould not fix per
+000036b0: 6d69 7373 696f 6e73 206f 6620 7368 6172  missions of shar
+000036c0: 6564 2066 6f6c 6465 7220 227b 6469 7265  ed folder "{dire
+000036d0: 6374 6f72 797d 225c 6e27 2c20 6669 6c65  ctory}"\n', file
+000036e0: 3d73 7973 2e73 7464 6572 7229 0a0a 2020  =sys.stderr)..  
+000036f0: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
+00003700: 5f63 6865 636b 5f62 7563 6b65 745f 6e61  _check_bucket_na
+00003710: 6d65 2873 656c 662c 2061 6e73 7765 7273  me(self, answers
+00003720: 2c20 6375 7272 656e 7429 3a0a 0a20 2020  , current):..   
+00003730: 2020 2020 2069 6620 6e6f 7420 6375 7272       if not curr
+00003740: 656e 742e 7374 6172 7473 7769 7468 2822  ent.startswith("
+00003750: 6672 6f73 7465 722d 2229 3a0a 2020 2020  froster-"):.    
+00003760: 2020 2020 2020 2020 7261 6973 6520 696e          raise in
+00003770: 7175 6972 6572 2e65 7272 6f72 732e 5661  quirer.errors.Va
+00003780: 6c69 6461 7469 6f6e 4572 726f 7228 0a20  lidationError(. 
+00003790: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000037a0: 222c 2072 6561 736f 6e3d 2257 726f 6e67  ", reason="Wrong
+000037b0: 2062 7563 6b65 7420 6e61 6d65 2e20 452e   bucket name. E.
+000037c0: 672e 3a20 6672 6f73 7465 722d 2229 0a0a  g.: froster-")..
+000037d0: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
+000037e0: 656e 2863 7572 7265 6e74 2920 3e20 383a  en(current) > 8:
+000037f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00003800: 7365 2069 6e71 7569 7265 722e 6572 726f  se inquirer.erro
+00003810: 7273 2e56 616c 6964 6174 696f 6e45 7272  rs.ValidationErr
+00003820: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00003830: 2020 2020 2222 2c20 7265 6173 6f6e 3d22      "", reason="
+00003840: 4275 636b 6574 206e 616d 6520 746f 6f20  Bucket name too 
+00003850: 7368 6f72 742e 2045 2e67 2e3a 2066 726f  short. E.g.: fro
+00003860: 7374 6572 2d22 290a 0a20 2020 2020 2020  ster-")..       
+00003870: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
+00003880: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
+00003890: 5f63 6865 636b 5f65 6d61 696c 5f66 6f72  _check_email_for
+000038a0: 6d61 7428 7365 6c66 2c20 616e 7377 6572  mat(self, answer
+000038b0: 732c 2063 7572 7265 6e74 293a 0a20 2020  s, current):.   
+000038c0: 2020 2020 2070 6174 7465 726e 203d 2072       pattern = r
+000038d0: 275e 5b61 2d7a 412d 5a30 2d39 5f2e 2b2d  '^[a-zA-Z0-9_.+-
+000038e0: 5d2b 405b 612d 7a41 2d5a 302d 392d 5d2b  ]+@[a-zA-Z0-9-]+
+000038f0: 5c2e 5b61 2d7a 412d 5a30 2d39 2d2e 5d2b  \.[a-zA-Z0-9-.]+
+00003900: 2427 0a20 2020 2020 2020 2069 6620 7265  $'.        if re
+00003910: 2e6d 6174 6368 2870 6174 7465 726e 2c20  .match(pattern, 
+00003920: 6375 7272 656e 7429 2069 7320 4e6f 6e65  current) is None
+00003930: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00003940: 6973 6520 696e 7175 6972 6572 2e65 7272  ise inquirer.err
+00003950: 6f72 732e 5661 6c69 6461 7469 6f6e 4572  ors.ValidationEr
+00003960: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00003970: 2020 2020 2022 222c 2072 6561 736f 6e3d       "", reason=
+00003980: 2257 726f 6e67 2065 6d61 696c 2066 6f72  "Wrong email for
+00003990: 6d61 742e 2045 2e67 2e3a 2078 7878 4079  mat. E.g.: xxx@y
+000039a0: 7979 2e7a 7a7a 2229 0a20 2020 2020 2020  yy.zzz").       
+000039b0: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
+000039c0: 2020 6465 6620 5f5f 696e 7175 6972 6572    def __inquirer
+000039d0: 5f63 6865 636b 5f69 735f 6e75 6d62 6572  _check_is_number
+000039e0: 2873 656c 662c 2061 6e73 7765 7273 2c20  (self, answers, 
+000039f0: 6375 7272 656e 7429 3a0a 0a20 2020 2020  current):..     
+00003a00: 2020 2070 6174 7465 726e 203d 2072 225e     pattern = r"^
+00003a10: 5b30 2d39 5d2b 2422 0a20 2020 2020 2020  [0-9]+$".       
+00003a20: 2069 6620 7265 2e6d 6174 6368 2870 6174   if re.match(pat
+00003a30: 7465 726e 2c20 6375 7272 656e 7429 2069  tern, current) i
+00003a40: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003a50: 2020 2020 7261 6973 6520 696e 7175 6972      raise inquir
+00003a60: 6572 2e65 7272 6f72 732e 5661 6c69 6461  er.errors.Valida
+00003a70: 7469 6f6e 4572 726f 7228 0a20 2020 2020  tionError(.     
+00003a80: 2020 2020 2020 2020 2020 2022 222c 2072             "", r
+00003a90: 6561 736f 6e3d 224d 7573 7420 6265 2061  eason="Must be a
+00003aa0: 206e 756d 6265 7222 290a 2020 2020 2020   number").      
+00003ab0: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
+00003ac0: 2020 2064 6566 205f 5f69 6e71 7569 7265     def __inquire
+00003ad0: 725f 6368 6563 6b5f 7265 7175 6972 6564  r_check_required
+00003ae0: 2873 656c 662c 2061 6e73 7765 7273 2c20  (self, answers, 
+00003af0: 6375 7272 656e 7429 3a0a 2020 2020 2020  current):.      
+00003b00: 2020 6966 206e 6f74 2063 7572 7265 6e74    if not current
+00003b10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00003b20: 6973 6520 696e 7175 6972 6572 2e65 7272  ise inquirer.err
+00003b30: 6f72 732e 5661 6c69 6461 7469 6f6e 4572  ors.ValidationEr
+00003b40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00003b50: 2020 2020 2022 222c 2072 6561 736f 6e3d       "", reason=
+00003b60: 2246 6965 6c64 2069 7320 7265 7175 6972  "Field is requir
+00003b70: 6564 2229 0a20 2020 2020 2020 2072 6574  ed").        ret
+00003b80: 7572 6e20 5472 7565 0a0a 2020 2020 6465  urn True..    de
+00003b90: 6620 5f5f 696e 7175 6972 6572 5f63 6865  f __inquirer_che
+00003ba0: 636b 5f70 6174 685f 6578 6973 7473 2873  ck_path_exists(s
+00003bb0: 656c 662c 2061 6e73 7765 7273 2c20 6375  elf, answers, cu
+00003bc0: 7272 656e 7429 3a0a 2020 2020 2020 2020  rrent):.        
+00003bd0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00003be0: 7869 7374 7328 6f73 2e70 6174 682e 6578  xists(os.path.ex
+00003bf0: 7061 6e64 7573 6572 2863 7572 7265 6e74  panduser(current
+00003c00: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00003c10: 7261 6973 6520 696e 7175 6972 6572 2e65  raise inquirer.e
+00003c20: 7272 6f72 732e 5661 6c69 6461 7469 6f6e  rrors.Validation
+00003c30: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00003c40: 2020 2020 2020 2022 222c 2072 6561 736f         "", reaso
+00003c50: 6e3d 2250 6174 6820 646f 6573 206e 6f74  n="Path does not
+00003c60: 2065 7869 7374 2229 0a20 2020 2020 2020   exist").       
+00003c70: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
+00003c80: 2020 6465 6620 7072 696e 745f 636f 6e66    def print_conf
+00003c90: 6967 2873 656c 6629 3a0a 2020 2020 2020  ig(self):.      
+00003ca0: 2020 2727 2750 7269 6e74 2074 6865 2063    '''Print the c
+00003cb0: 6f6e 6669 6775 7261 7469 6f6e 2066 696c  onfiguration fil
+00003cc0: 6573 2727 270a 0a20 2020 2020 2020 2069  es'''..        i
+00003cd0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00003ce0: 2873 656c 662e 636f 6e66 6967 5f66 696c  (self.config_fil
+00003cf0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00003d00: 7072 696e 7428 6627 5c6e 2a2a 2a20 4c4f  print(f'\n*** LO
+00003d10: 4341 4c20 434f 4e46 4947 5552 4154 494f  CAL CONFIGURATIO
+00003d20: 4e20 4154 3a20 7b73 656c 662e 636f 6e66  N AT: {self.conf
+00003d30: 6967 5f66 696c 657d 5c6e 2729 0a20 2020  ig_file}\n').   
+00003d40: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+00003d50: 656e 2873 656c 662e 636f 6e66 6967 5f66  en(self.config_f
+00003d60: 696c 652c 2027 7227 2920 6173 2066 3a0a  ile, 'r') as f:.
+00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d80: 7072 696e 7428 662e 7265 6164 2829 290a  print(f.read()).
+00003d90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003da0: 7365 6c66 2e69 735f 7368 6172 6564 2061  self.is_shared a
+00003db0: 6e64 206f 732e 7061 7468 2e65 7869 7374  nd os.path.exist
+00003dc0: 7328 7365 6c66 2e73 6861 7265 645f 636f  s(self.shared_co
+00003dd0: 6e66 6967 5f66 696c 6529 3a0a 2020 2020  nfig_file):.    
+00003de0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00003df0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00003e00: 2020 2020 2020 2066 272a 2a2a 2053 4841         f'*** SHA
+00003e10: 5245 4420 434f 4e46 4947 5552 4154 494f  RED CONFIGURATIO
+00003e20: 4e20 4154 3a20 7b73 656c 662e 7368 6172  N AT: {self.shar
+00003e30: 6564 5f63 6f6e 6669 675f 6669 6c65 7d5c  ed_config_file}\
+00003e40: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+00003e50: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
+00003e60: 6c66 2e73 6861 7265 645f 636f 6e66 6967  lf.shared_config
+00003e70: 5f66 696c 652c 2027 7227 2920 6173 2066  _file, 'r') as f
+00003e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003e90: 2020 2020 2020 7072 696e 7428 662e 7265        print(f.re
+00003ea0: 6164 2829 290a 2020 2020 2020 2020 656c  ad()).        el
+00003eb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00003ec0: 7072 696e 7428 6627 5c6e 2a2a 2a20 4e4f  print(f'\n*** NO
+00003ed0: 2043 4f4e 4649 4755 5241 5449 4f4e 2046   CONFIGURATION F
+00003ee0: 4f55 4e44 202a 2a2a 2729 0a20 2020 2020  OUND ***').     
+00003ef0: 2020 2020 2020 2070 7269 6e74 2827 5c6e         print('\n
+00003f00: 596f 7520 6361 6e20 636f 6e66 6967 7572  You can configur
+00003f10: 6520 6672 6f73 7465 7220 7573 696e 6720  e froster using 
+00003f20: 7468 6520 636f 6d6d 616e 643a 2729 0a20  the command:'). 
+00003f30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00003f40: 2827 2020 2020 6672 6f73 7465 7220 636f  ('    froster co
+00003f50: 6e66 6967 2729 0a0a 2020 2020 6465 6620  nfig')..    def 
+00003f60: 7365 745f 656e 765f 7661 7273 2873 656c  set_env_vars(sel
+00003f70: 662c 2070 726f 6669 6c65 293a 0a20 2020  f, profile):.   
+00003f80: 2020 2020 2027 2727 5365 7420 7468 6520       '''Set the 
+00003f90: 656e 7669 726f 6e6d 656e 7420 7661 7269  environment vari
+00003fa0: 6162 6c65 7320 666f 7220 7468 6520 4157  ables for the AW
+00003fb0: 5320 7072 6f66 696c 6527 2727 0a0a 2020  S profile'''..  
+00003fc0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+00003fd0: 2020 2020 2020 2020 2066 2754 4f44 4f3a           f'TODO:
+00003fe0: 2046 756e 6374 696f 6e20 7b69 6e73 7065   Function {inspe
+00003ff0: 6374 2e63 7572 7265 6e74 6672 616d 6528  ct.currentframe(
+00004000: 292e 665f 636f 6465 2e63 6f5f 6e61 6d65  ).f_code.co_name
+00004010: 7d20 4920 646f 206e 6f74 206b 6e6f 7720  } I do not know 
+00004020: 6966 2077 6520 7265 616c 6c79 206e 6565  if we really nee
+00004030: 6420 746f 2073 6574 2065 6e76 6972 6f6e  d to set environ
+00004040: 6d65 6e74 2076 6172 6961 626c 6573 2074  ment variables t
+00004050: 6f20 6265 2066 756e 6374 696f 6e61 6c27  o be functional'
+00004060: 290a 2020 2020 2020 2020 6578 6974 2831  ).        exit(1
+00004070: 290a 2020 2020 2020 2020 2320 4372 6561  ).        # Crea
+00004080: 7465 2061 2043 6f6e 6669 6750 6172 7365  te a ConfigParse
+00004090: 7220 6f62 6a65 6374 0a20 2020 2020 2020  r object.       
+000040a0: 2063 6f6e 6669 6720 3d20 636f 6e66 6967   config = config
+000040b0: 7061 7273 6572 2e43 6f6e 6669 6750 6172  parser.ConfigPar
+000040c0: 7365 7228 290a 0a20 2020 2020 2020 2023  ser()..        #
+000040d0: 2052 6561 6420 7468 6520 6372 6564 656e   Read the creden
+000040e0: 7469 616c 7320 6669 6c65 0a20 2020 2020  tials file.     
+000040f0: 2020 2063 6f6e 6669 672e 7265 6164 2873     config.read(s
+00004100: 656c 662e 6177 735f 6372 6564 656e 7469  elf.aws_credenti
+00004110: 616c 735f 6669 6c65 290a 2020 2020 2020  als_file).      
+00004120: 2020 7365 6c66 2e61 7773 5f72 6567 696f    self.aws_regio
+00004130: 6e20 3d20 7365 6c66 2e67 6574 5f61 7773  n = self.get_aws
+00004140: 5f72 6567 696f 6e28 7072 6f66 696c 6529  _region(profile)
+00004150: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00004160: 2063 6f6e 6669 672e 6861 735f 7365 6374   config.has_sect
+00004170: 696f 6e28 7072 6f66 696c 6529 3a0a 2020  ion(profile):.  
+00004180: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00004190: 662e 6172 6773 2e64 6562 7567 3a0a 2020  f.args.debug:.  
+000041a0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000041b0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000041c0: 2020 2020 2020 2020 2066 277e 2f2e 6177           f'~/.aw
+000041d0: 732f 6372 6564 656e 7469 616c 7320 6861  s/credentials ha
+000041e0: 7320 6e6f 2073 6563 7469 6f6e 2066 6f72  s no section for
+000041f0: 2070 726f 6669 6c65 207b 7072 6f66 696c   profile {profil
+00004200: 657d 2729 0a20 2020 2020 2020 2020 2020  e}').           
+00004210: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00004220: 2020 2020 2020 6966 206e 6f74 2063 6f6e        if not con
+00004230: 6669 672e 6861 735f 6f70 7469 6f6e 2870  fig.has_option(p
+00004240: 726f 6669 6c65 2c20 2761 7773 5f61 6363  rofile, 'aws_acc
+00004250: 6573 735f 6b65 795f 6964 2729 3a0a 2020  ess_key_id'):.  
+00004260: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00004270: 662e 6172 6773 2e64 6562 7567 3a0a 2020  f.args.debug:.  
+00004280: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00004290: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000042a0: 2020 2020 2020 2020 2066 277e 2f2e 6177           f'~/.aw
+000042b0: 732f 6372 6564 656e 7469 616c 7320 6861  s/credentials ha
+000042c0: 7320 6e6f 2065 6e74 7279 2061 7773 5f61  s no entry aws_a
+000042d0: 6363 6573 735f 6b65 795f 6964 2069 6e20  ccess_key_id in 
+000042e0: 7365 6374 696f 6e2f 7072 6f66 696c 6520  section/profile 
+000042f0: 7b70 726f 6669 6c65 7d27 290a 2020 2020  {profile}').    
+00004300: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00004310: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
+00004320: 4765 7420 7468 6520 4157 5320 6163 6365  Get the AWS acce
+00004330: 7373 206b 6579 2061 6e64 2073 6563 7265  ss key and secre
+00004340: 7420 6b65 7920 6672 6f6d 2074 6865 2073  t key from the s
+00004350: 7065 6369 6669 6564 2070 726f 6669 6c65  pecified profile
+00004360: 0a20 2020 2020 2020 2061 7773 5f61 6363  .        aws_acc
+00004370: 6573 735f 6b65 795f 6964 203d 2063 6f6e  ess_key_id = con
+00004380: 6669 672e 6765 7428 7072 6f66 696c 652c  fig.get(profile,
+00004390: 2027 6177 735f 6163 6365 7373 5f6b 6579   'aws_access_key
+000043a0: 5f69 6427 290a 2020 2020 2020 2020 6177  _id').        aw
+000043b0: 735f 7365 6372 6574 5f61 6363 6573 735f  s_secret_access_
+000043c0: 6b65 7920 3d20 636f 6e66 6967 2e67 6574  key = config.get
+000043d0: 2870 726f 6669 6c65 2c20 2761 7773 5f73  (profile, 'aws_s
+000043e0: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
+000043f0: 2729 0a0a 2020 2020 2020 2020 2320 5365  ')..        # Se
+00004400: 7420 7468 6520 656e 7669 726f 6e6d 656e  t the environmen
+00004410: 7420 7661 7269 6162 6c65 7320 666f 7220  t variables for 
+00004420: 6372 6564 730a 2020 2020 2020 2020 6f73  creds.        os
+00004430: 2e65 6e76 6972 6f6e 5b27 4157 535f 4143  .environ['AWS_AC
+00004440: 4345 5353 5f4b 4559 5f49 4427 5d20 3d20  CESS_KEY_ID'] = 
+00004450: 6177 735f 6163 6365 7373 5f6b 6579 5f69  aws_access_key_i
+00004460: 640a 2020 2020 2020 2020 6f73 2e65 6e76  d.        os.env
+00004470: 6972 6f6e 5b27 4157 535f 5345 4352 4554  iron['AWS_SECRET
+00004480: 5f41 4343 4553 535f 4b45 5927 5d20 3d20  _ACCESS_KEY'] = 
+00004490: 6177 735f 7365 6372 6574 5f61 6363 6573  aws_secret_acces
+000044a0: 735f 6b65 790a 2020 2020 2020 2020 6f73  s_key.        os
+000044b0: 2e65 6e76 6972 6f6e 5b27 4157 535f 5052  .environ['AWS_PR
+000044c0: 4f46 494c 4527 5d20 3d20 7072 6f66 696c  OFILE'] = profil
+000044d0: 650a 2020 2020 2020 2020 7365 6c66 2e65  e.        self.e
+000044e0: 6e76 726e 5b27 4157 535f 4143 4345 5353  nvrn['AWS_ACCESS
+000044f0: 5f4b 4559 5f49 4427 5d20 3d20 6177 735f  _KEY_ID'] = aws_
+00004500: 6163 6365 7373 5f6b 6579 5f69 640a 2020  access_key_id.  
+00004510: 2020 2020 2020 7365 6c66 2e65 6e76 726e        self.envrn
+00004520: 5b27 4157 535f 5345 4352 4554 5f41 4343  ['AWS_SECRET_ACC
+00004530: 4553 535f 4b45 5927 5d20 3d20 6177 735f  ESS_KEY'] = aws_
+00004540: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
+00004550: 790a 2020 2020 2020 2020 7365 6c66 2e65  y.        self.e
+00004560: 6e76 726e 5b27 4157 535f 5052 4f46 494c  nvrn['AWS_PROFIL
+00004570: 4527 5d20 3d20 7072 6f66 696c 650a 2020  E'] = profile.  
+00004580: 2020 2020 2020 7365 6c66 2e65 6e76 726e        self.envrn
+00004590: 5b27 5243 4c4f 4e45 5f53 335f 4143 4345  ['RCLONE_S3_ACCE
+000045a0: 5353 5f4b 4559 5f49 4427 5d20 3d20 6177  SS_KEY_ID'] = aw
+000045b0: 735f 6163 6365 7373 5f6b 6579 5f69 640a  s_access_key_id.
+000045c0: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
+000045d0: 726e 5b27 5243 4c4f 4e45 5f53 335f 5345  rn['RCLONE_S3_SE
+000045e0: 4352 4554 5f41 4343 4553 535f 4b45 5927  CRET_ACCESS_KEY'
+000045f0: 5d20 3d20 6177 735f 7365 6372 6574 5f61  ] = aws_secret_a
+00004600: 6363 6573 735f 6b65 790a 0a20 2020 2020  ccess_key..     
+00004610: 2020 2069 6620 7072 6f66 696c 6520 696e     if profile in
+00004620: 205b 2764 6566 6175 6c74 272c 2027 4157   ['default', 'AW
+00004630: 5327 2c20 2761 7773 275d 3a0a 2020 2020  S', 'aws']:.    
+00004640: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
+00004650: 6520 656e 7669 726f 6e6d 656e 7420 7661  e environment va
+00004660: 7269 6162 6c65 7320 666f 7220 4157 530a  riables for AWS.
+00004670: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004680: 2e65 6e76 726e 5b27 5243 4c4f 4e45 5f53  .envrn['RCLONE_S
+00004690: 335f 5052 4f56 4944 4552 275d 203d 2027  3_PROVIDER'] = '
+000046a0: 4157 5327 0a20 2020 2020 2020 2020 2020  AWS'.           
+000046b0: 2073 656c 662e 656e 7672 6e5b 2752 434c   self.envrn['RCL
+000046c0: 4f4e 455f 5333 5f52 4547 494f 4e27 5d20  ONE_S3_REGION'] 
+000046d0: 3d20 7365 6c66 2e61 7773 5f72 6567 696f  = self.aws_regio
+000046e0: 6e0a 2020 2020 2020 2020 2020 2020 7365  n.            se
+000046f0: 6c66 2e65 6e76 726e 5b27 5243 4c4f 4e45  lf.envrn['RCLONE
+00004700: 5f53 335f 4c4f 4341 5449 4f4e 5f43 4f4e  _S3_LOCATION_CON
+00004710: 5354 5241 494e 5427 5d20 3d20 7365 6c66  STRAINT'] = self
+00004720: 2e61 7773 5f72 6567 696f 6e0a 2020 2020  .aws_region.    
+00004730: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
+00004740: 726e 5b27 5243 4c4f 4e45 5f53 335f 5354  rn['RCLONE_S3_ST
+00004750: 4f52 4147 455f 434c 4153 5327 5d20 3d20  ORAGE_CLASS'] = 
+00004760: 7365 6c66 2e72 6561 6428 0a20 2020 2020  self.read(.     
+00004770: 2020 2020 2020 2020 2020 2027 6765 6e65             'gene
+00004780: 7261 6c27 2c20 2773 335f 7374 6f72 6167  ral', 's3_storag
+00004790: 655f 636c 6173 7327 290a 2020 2020 2020  e_class').      
+000047a0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+000047b0: 5b27 5243 4c4f 4e45 5f53 335f 5354 4f52  ['RCLONE_S3_STOR
+000047c0: 4147 455f 434c 4153 5327 5d20 3d20 7365  AGE_CLASS'] = se
+000047d0: 6c66 2e72 6561 6428 0a20 2020 2020 2020  lf.read(.       
+000047e0: 2020 2020 2020 2020 2027 6765 6e65 7261           'genera
+000047f0: 6c27 2c20 2773 335f 7374 6f72 6167 655f  l', 's3_storage_
+00004800: 636c 6173 7327 290a 2020 2020 2020 2020  class').        
+00004810: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004820: 2020 7072 6620 3d20 7365 6c66 2e72 6561    prf = self.rea
+00004830: 6428 2770 726f 6669 6c65 7327 2c20 7072  d('profiles', pr
+00004840: 6f66 696c 6529 0a20 2020 2020 2020 2020  ofile).         
+00004850: 2020 2073 656c 662e 656e 7672 6e5b 2752     self.envrn['R
+00004860: 434c 4f4e 455f 5333 5f45 4e56 5f41 5554  CLONE_S3_ENV_AUT
+00004870: 4827 5d20 3d20 2774 7275 6527 0a20 2020  H'] = 'true'.   
+00004880: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
+00004890: 7672 6e5b 2752 434c 4f4e 455f 5333 5f50  vrn['RCLONE_S3_P
+000048a0: 524f 4649 4c45 275d 203d 2070 726f 6669  ROFILE'] = profi
+000048b0: 6c65 0a20 2020 2020 2020 2020 2020 2023  le.            #
+000048c0: 2070 726f 6669 6c65 3d7b 276e 616d 6527   profile={'name'
+000048d0: 3a20 2727 2c20 2770 726f 7669 6465 7227  : '', 'provider'
+000048e0: 3a20 2727 2c20 2773 746f 7261 6765 5f63  : '', 'storage_c
+000048f0: 6c61 7373 273a 2027 277d 0a20 2020 2020  lass': ''}.     
+00004900: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00004910: 616e 6365 2870 7266 2c20 6469 6374 293a  ance(prf, dict):
+00004920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004930: 2073 656c 662e 656e 7672 6e5b 2752 434c   self.envrn['RCL
+00004940: 4f4e 455f 5333 5f50 524f 5649 4445 5227  ONE_S3_PROVIDER'
+00004950: 5d20 3d20 7072 665b 2770 726f 7669 6465  ] = prf['provide
+00004960: 7227 5d0a 2020 2020 2020 2020 2020 2020  r'].            
+00004970: 2020 2020 2320 544f 444f 3a20 5468 6572      # TODO: Ther
+00004980: 6520 6973 2061 2073 656c 662e 6765 745f  e is a self.get_
+00004990: 656e 6470 6f69 6e74 2829 2069 6e20 4157  endpoint() in AW
+000049a0: 5342 4f54 4f20 636c 6173 730a 2020 2020  SBOTO class.    
+000049b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000049c0: 2e65 6e76 726e 5b27 5243 4c4f 4e45 5f53  .envrn['RCLONE_S
+000049d0: 335f 454e 4450 4f49 4e54 275d 203d 2073  3_ENDPOINT'] = s
+000049e0: 656c 662e 5f67 6574 5f61 7773 5f73 335f  elf._get_aws_s3_
+000049f0: 7365 7373 696f 6e5f 656e 6470 6f69 6e74  session_endpoint
+00004a00: 5f75 726c 280a 2020 2020 2020 2020 2020  _url(.          
+00004a10: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
+00004a20: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00004a30: 2020 2073 656c 662e 656e 7672 6e5b 2752     self.envrn['R
+00004a40: 434c 4f4e 455f 5333 5f52 4547 494f 4e27  CLONE_S3_REGION'
+00004a50: 5d20 3d20 7365 6c66 2e61 7773 5f72 6567  ] = self.aws_reg
+00004a60: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00004a70: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
+00004a80: 5243 4c4f 4e45 5f53 335f 4c4f 4341 5449  RCLONE_S3_LOCATI
+00004a90: 4f4e 5f43 4f4e 5354 5241 494e 5427 5d20  ON_CONSTRAINT'] 
+00004aa0: 3d20 7365 6c66 2e61 7773 5f72 6567 696f  = self.aws_regio
+00004ab0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00004ac0: 2020 7365 6c66 2e65 6e76 726e 5b27 5243    self.envrn['RC
+00004ad0: 4c4f 4e45 5f53 335f 5354 4f52 4147 455f  LONE_S3_STORAGE_
+00004ae0: 434c 4153 5327 5d20 3d20 7072 665b 2773  CLASS'] = prf['s
+00004af0: 746f 7261 6765 5f63 6c61 7373 275d 0a20  torage_class']. 
+00004b00: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004b10: 732e 656e 7669 726f 6e5b 2752 434c 4f4e  s.environ['RCLON
+00004b20: 455f 5333 5f53 544f 5241 4745 5f43 4c41  E_S3_STORAGE_CLA
+00004b30: 5353 275d 203d 2070 7266 5b27 7374 6f72  SS'] = prf['stor
+00004b40: 6167 655f 636c 6173 7327 5d0a 0a20 2020  age_class']..   
+00004b50: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00004b60: 0a0a 2020 2020 6465 6620 7365 745f 6177  ..    def set_aw
+00004b70: 7328 7365 6c66 2c20 6177 733a 2027 4157  s(self, aws: 'AW
+00004b80: 5342 6f74 6f27 293a 0a20 2020 2020 2020  SBoto'):.       
+00004b90: 2027 2727 5365 7420 7468 6520 4157 5320   '''Set the AWS 
+00004ba0: 636f 6e66 6967 7572 6174 696f 6e27 2727  configuration'''
+00004bb0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00004bc0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00004bd0: 6627 5c6e 2a2a 2a20 4157 5320 434f 4e46  f'\n*** AWS CONF
+00004be0: 4947 5552 4154 494f 4e20 2a2a 2a5c 6e27  IGURATION ***\n'
+00004bf0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00004c00: 2041 736b 2075 7365 7220 746f 2065 6e74   Ask user to ent
+00004c10: 6572 2074 6865 2070 6174 6820 746f 2061  er the path to a
+00004c20: 2061 7773 2063 7265 6465 6e74 6961 6c73   aws credentials
+00004c30: 2064 6972 6563 746f 7279 0a0a 2020 2020   directory..    
+00004c40: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00004c50: 7468 2e65 7869 7374 7328 6f73 2e70 6174  th.exists(os.pat
+00004c60: 682e 6a6f 696e 2873 656c 662e 686f 6d65  h.join(self.home
+00004c70: 5f64 6972 2c20 272e 6177 7327 2929 3a0a  _dir, '.aws')):.
+00004c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c90: 6465 6661 756c 745f 6177 735f 6469 7220  default_aws_dir 
+00004ca0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2873  = os.path.join(s
+00004cb0: 656c 662e 686f 6d65 5f64 6972 2c20 272e  elf.home_dir, '.
+00004cc0: 6177 7327 290a 2020 2020 2020 2020 2020  aws').          
+00004cd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00004ce0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00004cf0: 6177 735f 6469 7220 3d20 4e6f 6e65 0a0a  aws_dir = None..
+00004d00: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
+00004d10: 6469 725f 7175 6573 7469 6f6e 203d 205b  dir_question = [
+00004d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d30: 2069 6e71 7569 7265 722e 5061 7468 280a   inquirer.Path(.
+00004d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d50: 2020 2020 2761 7773 5f64 6972 272c 0a20      'aws_dir',. 
+00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d70: 2020 206d 6573 7361 6765 3d66 2745 6e74     message=f'Ent
+00004d80: 6572 2074 6865 2070 6174 6820 746f 2061  er the path to a
+00004d90: 7773 2063 7265 6465 6e74 6961 6c73 2064  ws credentials d
+00004da0: 6972 6563 746f 7279 2028 6465 6661 756c  irectory (defaul
+00004db0: 743a 207b 6465 6661 756c 745f 6177 735f  t: {default_aws_
+00004dc0: 6469 727d 2927 2c0a 2020 2020 2020 2020  dir})',.        
+00004dd0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00004de0: 756c 743d 6465 6661 756c 745f 6177 735f  ult=default_aws_
+00004df0: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
+00004e00: 2020 2020 2020 2020 2076 616c 6964 6174           validat
+00004e10: 653d 7365 6c66 2e5f 5f69 6e71 7569 7265  e=self.__inquire
+00004e20: 725f 6368 6563 6b5f 7061 7468 5f65 7869  r_check_path_exi
+00004e30: 7374 7329 0a20 2020 2020 2020 2020 2020  sts).           
+00004e40: 205d 0a0a 2020 2020 2020 2020 2020 2020   ]..            
+00004e50: 2320 4765 7420 7468 6520 616e 7377 6572  # Get the answer
+00004e60: 2066 726f 6d20 7468 6520 7573 6572 0a20   from the user. 
+00004e70: 2020 2020 2020 2020 2020 2061 7773 5f64             aws_d
+00004e80: 6972 5f61 6e73 7765 7220 3d20 696e 7175  ir_answer = inqu
+00004e90: 6972 6572 2e70 726f 6d70 7428 0a20 2020  irer.prompt(.   
+00004ea0: 2020 2020 2020 2020 2020 2020 2061 7773               aws
+00004eb0: 5f64 6972 5f71 7565 7374 696f 6e29 0a0a  _dir_question)..
+00004ec0: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+00004ed0: 7420 7468 6520 4157 5320 6469 7265 6374  t the AWS direct
+00004ee0: 6f72 790a 2020 2020 2020 2020 2020 2020  ory.            
+00004ef0: 6177 735f 6469 7220 3d20 6f73 2e70 6174  aws_dir = os.pat
+00004f00: 682e 6578 7061 6e64 7573 6572 2861 7773  h.expanduser(aws
+00004f10: 5f64 6972 5f61 6e73 7765 725b 2761 7773  _dir_answer['aws
+00004f20: 5f64 6972 275d 290a 0a20 2020 2020 2020  _dir'])..       
+00004f30: 2020 2020 2023 2053 6574 2074 6865 206e       # Set the n
+00004f40: 6577 2041 5753 2064 6972 6563 746f 7279  ew AWS directory
+00004f50: 2061 7420 4157 5320 426f 746f 330a 2020   at AWS Boto3.  
+00004f60: 2020 2020 2020 2020 2020 6177 732e 7365            aws.se
+00004f70: 745f 6177 735f 6469 7265 6374 6f72 7928  t_aws_directory(
+00004f80: 6177 735f 6469 7229 0a0a 2020 2020 2020  aws_dir)..      
+00004f90: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
+00004fa0: 6e65 7720 4157 5320 4469 7265 6374 6f72  new AWS Director
+00004fb0: 790a 2020 2020 2020 2020 2020 2020 7365  y.            se
+00004fc0: 6c66 2e61 7773 5f64 6972 203d 2061 7773  lf.aws_dir = aws
+00004fd0: 5f64 6972 0a0a 2020 2020 2020 2020 2020  _dir..          
+00004fe0: 2020 2320 5365 7420 7468 6520 6e65 7720    # Set the new 
+00004ff0: 4157 5320 636f 6e66 6967 2066 696c 650a  AWS config file.
+00005000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005010: 2e61 7773 5f63 6f6e 6669 675f 6669 6c65  .aws_config_file
+00005020: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00005030: 7365 6c66 2e61 7773 5f64 6972 2c20 2763  self.aws_dir, 'c
+00005040: 6f6e 6669 6727 290a 0a20 2020 2020 2020  onfig')..       
+00005050: 2020 2020 2023 2053 6574 2074 6865 206e       # Set the n
+00005060: 6577 2041 5753 2063 7265 6465 6e74 6961  ew AWS credentia
+00005070: 6c73 2066 696c 650a 2020 2020 2020 2020  ls file.        
+00005080: 2020 2020 7365 6c66 2e61 7773 5f63 7265      self.aws_cre
+00005090: 6465 6e74 6961 6c73 5f66 696c 6520 3d20  dentials_file = 
+000050a0: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+000050b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000050c0: 6c66 2e61 7773 5f64 6972 2c20 2763 7265  lf.aws_dir, 'cre
+000050d0: 6465 6e74 6961 6c73 2729 0a0a 2020 2020  dentials')..    
+000050e0: 2020 2020 2020 2020 2320 4765 7420 6c69          # Get li
+000050f0: 7374 206f 6620 6375 7272 656e 7420 4157  st of current AW
+00005100: 5320 7072 6f66 696c 6573 2075 6e64 6572  S profiles under
+00005110: 207b 2441 5753 5f44 4952 7d2f 6372 6564   {$AWS_DIR}/cred
+00005120: 656e 7469 616c 730a 2020 2020 2020 2020  entials.        
+00005130: 2020 2020 6177 735f 7072 6f66 696c 6573      aws_profiles
+00005140: 203d 2061 7773 2e67 6574 5f70 726f 6669   = aws.get_profi
+00005150: 6c65 7328 290a 0a20 2020 2020 2020 2020  les()..         
+00005160: 2020 2023 2041 6464 2061 6e20 6f70 7469     # Add an opti
+00005170: 6f6e 2074 6f20 6372 6561 7465 2061 206e  on to create a n
+00005180: 6577 2070 726f 6669 6c65 0a20 2020 2020  ew profile.     
+00005190: 2020 2020 2020 2061 7773 5f70 726f 6669         aws_profi
+000051a0: 6c65 732e 6170 7065 6e64 2827 2b20 4372  les.append('+ Cr
+000051b0: 6561 7465 206e 6577 2070 726f 6669 6c65  eate new profile
+000051c0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+000051d0: 2320 4173 6b20 7573 6572 2074 6f20 6368  # Ask user to ch
+000051e0: 6f6f 7365 2061 6e20 6578 6973 7469 6e67  oose an existing
+000051f0: 2061 7773 2070 726f 6669 6c65 206f 7220   aws profile or 
+00005200: 6372 6561 7465 2061 206e 6577 206f 6e65  create a new one
+00005210: 0a20 2020 2020 2020 2020 2020 2061 7773  .            aws
+00005220: 5f70 726f 6669 6c65 203d 2069 6e71 7569  _profile = inqui
+00005230: 7265 722e 6c69 7374 5f69 6e70 7574 2822  rer.list_input("
+00005240: 4368 6f6f 7365 2079 6f75 7220 6177 7320  Choose your aws 
+00005250: 7072 6f66 696c 6522 2c0a 2020 2020 2020  profile",.      
+00005260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005280: 2020 2020 2020 2020 6368 6f69 6365 733d          choices=
+00005290: 6177 735f 7072 6f66 696c 6573 290a 0a20  aws_profiles).. 
+000052a0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000052b0: 636b 2069 6620 7573 6572 2077 616e 7473  ck if user wants
+000052c0: 2074 6f20 6372 6561 7465 2061 206e 6577   to create a new
+000052d0: 2061 7773 2070 726f 6669 6c65 0a20 2020   aws profile.   
+000052e0: 2020 2020 2020 2020 2069 6620 6177 735f           if aws_
+000052f0: 7072 6f66 696c 6520 3d3d 2027 2b20 4372  profile == '+ Cr
+00005300: 6561 7465 206e 6577 2070 726f 6669 6c65  eate new profile
+00005310: 273a 0a0a 2020 2020 2020 2020 2020 2020  ':..            
+00005320: 2020 2020 2320 4765 7420 6e65 7720 7072      # Get new pr
+00005330: 6f66 696c 6520 6e61 6d65 0a20 2020 2020  ofile name.     
+00005340: 2020 2020 2020 2020 2020 2061 7773 5f6e             aws_n
+00005350: 6577 5f70 726f 6669 6c65 5f6e 616d 6520  ew_profile_name 
+00005360: 3d20 696e 7175 6972 6572 2e74 6578 7428  = inquirer.text(
+00005370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005380: 2020 2020 206d 6573 7361 6765 3d22 456e       message="En
+00005390: 7465 7220 6e65 7720 7072 6f66 696c 6520  ter new profile 
+000053a0: 6e61 6d65 222c 2076 616c 6964 6174 653d  name", validate=
+000053b0: 7365 6c66 2e5f 5f69 6e71 7569 7265 725f  self.__inquirer_
+000053c0: 6368 6563 6b5f 7265 7175 6972 6564 290a  check_required).
+000053d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053e0: 2023 2049 6620 6e65 7720 7072 6f66 696c   # If new profil
+000053f0: 6520 6e61 6d65 2061 6c72 6561 6479 2065  e name already e
+00005400: 7869 7374 732c 2074 6865 6e20 7072 6f6d  xists, then prom
+00005410: 7074 2075 7365 7220 6966 2077 6520 7368  pt user if we sh
+00005420: 6f75 6c64 206f 7665 7277 7269 7465 2069  ould overwrite i
+00005430: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00005440: 2020 6966 2061 7773 5f6e 6577 5f70 726f    if aws_new_pro
+00005450: 6669 6c65 5f6e 616d 6520 696e 2061 7773  file_name in aws
+00005460: 5f70 726f 6669 6c65 733a 0a20 2020 2020  _profiles:.     
+00005470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00005480: 735f 6f76 6572 7772 6974 6520 3d20 696e  s_overwrite = in
+00005490: 7175 6972 6572 2e63 6f6e 6669 726d 280a  quirer.confirm(.
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2020 2020 2020 2020 6d65 7373 6167 653d          message=
+000054c0: 6627 5741 524e 494e 473a 2044 6f20 796f  f'WARNING: Do yo
+000054d0: 7520 7761 6e74 2074 6f20 6f76 6572 7772  u want to overwr
+000054e0: 6974 6520 7072 6f66 696c 6520 7b61 7773  ite profile {aws
+000054f0: 5f6e 6577 5f70 726f 6669 6c65 5f6e 616d  _new_profile_nam
+00005500: 657d 3f27 2c20 6465 6661 756c 743d 4661  e}?', default=Fa
+00005510: 6c73 6529 0a0a 2020 2020 2020 2020 2020  lse)..          
+00005520: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00005530: 2069 735f 6f76 6572 7772 6974 653a 0a20   is_overwrite:. 
+00005540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005550: 2020 2020 2020 2023 2049 6620 7573 6572         # If user
+00005560: 2064 6f65 7320 6e6f 7420 7761 6e74 2074   does not want t
+00005570: 6f20 6f76 6572 7772 6974 6520 7468 6520  o overwrite the 
+00005580: 7072 6f66 696c 652c 2074 6865 6e20 7265  profile, then re
+00005590: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+000055a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000055b0: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
+000055c0: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
+000055d0: 2061 7773 2061 6363 6573 7320 6b65 7920   aws access key 
+000055e0: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+000055f0: 2020 2061 7773 5f61 6363 6573 735f 6b65     aws_access_ke
+00005600: 795f 6964 203d 2069 6e71 7569 7265 722e  y_id = inquirer.
+00005610: 7465 7874 280a 2020 2020 2020 2020 2020  text(.          
+00005620: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+00005630: 653d 2241 5753 2041 6363 6573 7320 4b65  e="AWS Access Ke
+00005640: 7920 4944 222c 2076 616c 6964 6174 653d  y ID", validate=
+00005650: 7365 6c66 2e5f 5f69 6e71 7569 7265 725f  self.__inquirer_
+00005660: 6368 6563 6b5f 7265 7175 6972 6564 290a  check_required).
+00005670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005680: 2023 2047 6574 2061 7773 2073 6563 7265   # Get aws secre
+00005690: 7420 6163 6365 7373 206b 6579 0a20 2020  t access key.   
+000056a0: 2020 2020 2020 2020 2020 2020 2061 7773               aws
+000056b0: 5f73 6563 7265 745f 6163 6365 7373 5f6b  _secret_access_k
+000056c0: 6579 203d 2069 6e71 7569 7265 722e 7465  ey = inquirer.te
+000056d0: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
+000056e0: 2020 2020 2020 2020 6d65 7373 6167 653d          message=
+000056f0: 2241 5753 2053 6563 7265 7420 4163 6365  "AWS Secret Acce
+00005700: 7373 204b 6579 222c 2076 616c 6964 6174  ss Key", validat
+00005710: 653d 7365 6c66 2e5f 5f69 6e71 7569 7265  e=self.__inquire
+00005720: 725f 6368 6563 6b5f 7265 7175 6972 6564  r_check_required
+00005730: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00005740: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
+00005750: 6520 7072 6f76 6964 6564 2061 7773 2063  e provided aws c
+00005760: 7265 6465 6e74 6961 6c73 2061 7265 2076  redentials are v
+00005770: 616c 6964 0a20 2020 2020 2020 2020 2020  alid.           
+00005780: 2020 2020 2070 7269 6e74 2822 5c6e 4368       print("\nCh
+00005790: 6563 6b69 6e67 2041 5753 2063 7265 6465  ecking AWS crede
+000057a0: 6e74 6961 6c73 2e2e 2e22 290a 0a20 2020  ntials...")..   
+000057b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000057c0: 6177 732e 6368 6563 6b5f 6372 6564 656e  aws.check_creden
+000057d0: 7469 616c 7328 6177 735f 6163 6365 7373  tials(aws_access
+000057e0: 5f6b 6579 5f69 643d 6177 735f 6163 6365  _key_id=aws_acce
+000057f0: 7373 5f6b 6579 5f69 642c 0a20 2020 2020  ss_key_id,.     
+00005800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00005810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005820: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-00005830: 696f 6e3d 7265 6769 6f6e 290a 0a20 2020  ion=region)..   
-00005840: 2020 2020 2023 2047 6574 2074 6865 2070       # Get the p
-00005850: 726f 6669 6c65 206e 616d 650a 2020 2020  rofile name.    
-00005860: 2020 2020 6966 2061 7773 5f70 726f 6669      if aws_profi
-00005870: 6c65 203d 3d20 272b 2043 7265 6174 6520  le == '+ Create 
-00005880: 6e65 7720 7072 6f66 696c 6527 3a0a 2020  new profile':.  
-00005890: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-000058a0: 655f 6e61 6d65 203d 2061 7773 5f6e 6577  e_name = aws_new
-000058b0: 5f70 726f 6669 6c65 5f6e 616d 650a 2020  _profile_name.  
-000058c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000058d0: 2020 2020 2020 2020 7072 6f66 696c 655f          profile_
-000058e0: 6e61 6d65 203d 2061 7773 5f70 726f 6669  name = aws_profi
-000058f0: 6c65 0a0a 2020 2020 2020 2020 2320 5374  le..        # St
-00005900: 6f72 6520 6177 7320 7072 6f66 696c 6520  ore aws profile 
-00005910: 696e 2074 6865 2063 6f6e 6669 6720 6669  in the config fi
-00005920: 6c65 0a20 2020 2020 2020 2073 656c 662e  le.        self.
-00005930: 5f5f 7365 745f 636f 6e66 6967 7572 6174  __set_configurat
-00005940: 696f 6e5f 656e 7472 7928 2741 5753 272c  ion_entry('AWS',
-00005950: 2027 6177 735f 7072 6f66 696c 6527 2c20   'aws_profile', 
-00005960: 7072 6f66 696c 655f 6e61 6d65 290a 0a20  profile_name).. 
-00005970: 2020 2020 2020 2023 2053 746f 7265 2061         # Store a
-00005980: 7773 2072 6567 696f 6e20 696e 2074 6865  ws region in the
-00005990: 2063 6f6e 6669 6720 6669 6c65 0a20 2020   config file.   
-000059a0: 2020 2020 2073 656c 662e 5f5f 7365 745f       self.__set_
-000059b0: 636f 6e66 6967 7572 6174 696f 6e5f 656e  configuration_en
-000059c0: 7472 7928 2741 5753 272c 2027 6177 735f  try('AWS', 'aws_
-000059d0: 7265 6769 6f6e 272c 2072 6567 696f 6e29  region', region)
-000059e0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-000059f0: 7468 6520 4157 5320 7072 6f66 696c 6520  the AWS profile 
-00005a00: 696e 2074 6865 2062 6f74 6f33 2073 6573  in the boto3 ses
-00005a10: 7369 6f6e 0a20 2020 2020 2020 2061 7773  sion.        aws
-00005a20: 2e73 6574 5f73 6573 7369 6f6e 2870 726f  .set_session(pro
-00005a30: 6669 6c65 5f6e 616d 652c 2072 6567 696f  file_name, regio
-00005a40: 6e29 0a0a 2020 2020 2020 2020 7072 696e  n)..        prin
-00005a50: 7428 6627 2a2a 2a20 4157 5320 434f 4e46  t(f'*** AWS CONF
-00005a60: 4947 5552 4154 494f 4e20 444f 4e45 202a  IGURATION DONE *
-00005a70: 2a2a 5c6e 2729 0a0a 2020 2020 6465 6620  **\n')..    def 
-00005a80: 5f5f 7365 745f 6177 735f 636f 6e66 6967  __set_aws_config
-00005a90: 2873 656c 662c 2061 7773 5f70 726f 6669  (self, aws_profi
-00005aa0: 6c65 5f6e 616d 652c 2072 6567 696f 6e29  le_name, region)
-00005ab0: 3a0a 2020 2020 2020 2020 2727 2720 5570  :.        ''' Up
-00005ac0: 6461 7465 2074 6865 2041 5753 2063 6f6e  date the AWS con
-00005ad0: 6669 6720 6f66 2074 6865 2067 6976 656e  fig of the given
-00005ae0: 2070 726f 6669 6c65 2727 270a 0a20 2020   profile'''..   
-00005af0: 2020 2020 2069 6620 6e6f 7420 6177 735f       if not aws_
-00005b00: 7072 6f66 696c 655f 6e61 6d65 3a0a 2020  profile_name:.  
-00005b10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005b20: 5661 6c75 6545 7272 6f72 2827 4e6f 2041  ValueError('No A
-00005b30: 5753 2070 726f 6669 6c65 2070 726f 7669  WS profile provi
-00005b40: 6465 6427 290a 0a20 2020 2020 2020 2069  ded')..        i
-00005b50: 6620 6e6f 7420 7265 6769 6f6e 3a0a 2020  f not region:.  
-00005b60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005b70: 5661 6c75 6545 7272 6f72 2827 4e6f 2072  ValueError('No r
-00005b80: 6567 696f 6e20 7072 6f76 6964 6564 2729  egion provided')
-00005b90: 0a0a 2020 2020 2020 2020 2320 4966 2069  ..        # If i
-00005ba0: 7420 646f 6573 206e 6f74 2065 7869 7374  t does not exist
-00005bb0: 2c20 6372 6561 7465 2061 7773 2064 6972  , create aws dir
-00005bc0: 6563 746f 7279 0a20 2020 2020 2020 206f  ectory.        o
-00005bd0: 732e 6d61 6b65 6469 7273 2873 656c 662e  s.makedirs(self.
-00005be0: 6177 735f 6469 722c 2065 7869 7374 5f6f  aws_dir, exist_o
-00005bf0: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
-00005c00: 3735 290a 0a20 2020 2020 2020 2023 2043  75)..        # C
-00005c10: 7265 6174 6520 6120 6177 7320 636f 6e66  reate a aws conf
-00005c20: 6967 2043 6f6e 6669 6750 6172 7365 7220  ig ConfigParser 
-00005c30: 6f62 6a65 6374 0a20 2020 2020 2020 2061  object.        a
-00005c40: 7773 5f63 6f6e 6669 6720 3d20 636f 6e66  ws_config = conf
-00005c50: 6967 7061 7273 6572 2e43 6f6e 6669 6750  igparser.ConfigP
-00005c60: 6172 7365 7228 290a 0a20 2020 2020 2020  arser()..       
-00005c70: 2023 2049 6620 6578 6973 7473 2c20 7265   # If exists, re
-00005c80: 6164 2074 6865 2061 7773 2063 6f6e 6669  ad the aws confi
-00005c90: 6720 6669 6c65 0a20 2020 2020 2020 2069  g file.        i
-00005ca0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00005cb0: 2873 656c 662e 6177 735f 636f 6e66 6967  (self.aws_config
-00005cc0: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
-00005cd0: 2020 2020 6177 735f 636f 6e66 6967 2e72      aws_config.r
-00005ce0: 6561 6428 7365 6c66 2e61 7773 5f63 6f6e  ead(self.aws_con
-00005cf0: 6669 675f 6669 6c65 290a 0a20 2020 2020  fig_file)..     
-00005d00: 2020 2023 2049 6620 6974 2064 6f65 7320     # If it does 
-00005d10: 6e6f 7420 6578 6973 742c 2063 7265 6174  not exist, creat
-00005d20: 6520 6120 6e65 7720 7072 6f66 696c 6520  e a new profile 
-00005d30: 696e 2074 6865 2061 7773 2063 6f6e 6669  in the aws confi
-00005d40: 6720 6669 6c65 0a20 2020 2020 2020 2069  g file.        i
-00005d50: 6620 6e6f 7420 6177 735f 636f 6e66 6967  f not aws_config
-00005d60: 2e68 6173 5f73 6563 7469 6f6e 2861 7773  .has_section(aws
-00005d70: 5f70 726f 6669 6c65 5f6e 616d 6529 3a0a  _profile_name):.
-00005d80: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
-00005d90: 636f 6e66 6967 2e61 6464 5f73 6563 7469  config.add_secti
-00005da0: 6f6e 2861 7773 5f70 726f 6669 6c65 5f6e  on(aws_profile_n
-00005db0: 616d 6529 0a0a 2020 2020 2020 2020 2320  ame)..        # 
-00005dc0: 5772 6974 6520 7468 6520 7072 6f66 696c  Write the profil
-00005dd0: 6520 7769 7468 2074 6865 206e 6577 2072  e with the new r
-00005de0: 6567 696f 6e0a 2020 2020 2020 2020 6177  egion.        aw
-00005df0: 735f 636f 6e66 6967 5b61 7773 5f70 726f  s_config[aws_pro
-00005e00: 6669 6c65 5f6e 616d 655d 5b27 7265 6769  file_name]['regi
-00005e10: 6f6e 275d 203d 2072 6567 696f 6e0a 0a20  on'] = region.. 
-00005e20: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
-00005e30: 6865 2070 726f 6669 6c65 2077 6974 6820  he profile with 
-00005e40: 7468 6520 6e65 7720 6f75 7470 7574 2066  the new output f
-00005e50: 6f72 6d61 740a 2020 2020 2020 2020 6177  ormat.        aw
-00005e60: 735f 636f 6e66 6967 5b61 7773 5f70 726f  s_config[aws_pro
-00005e70: 6669 6c65 5f6e 616d 655d 5b27 6f75 7470  file_name]['outp
-00005e80: 7574 275d 203d 2027 6a73 6f6e 270a 0a20  ut'] = 'json'.. 
-00005e90: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
-00005ea0: 6865 2063 6f6e 6669 6720 6f62 6a65 6374  he config object
-00005eb0: 2074 6f20 7468 6520 636f 6e66 6967 2066   to the config f
-00005ec0: 696c 650a 2020 2020 2020 2020 7769 7468  ile.        with
-00005ed0: 206f 7065 6e28 7365 6c66 2e61 7773 5f63   open(self.aws_c
-00005ee0: 6f6e 6669 675f 6669 6c65 2c20 2777 2729  onfig_file, 'w')
-00005ef0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-00005f00: 2020 2061 7773 5f63 6f6e 6669 672e 7772     aws_config.wr
-00005f10: 6974 6528 6629 0a0a 2020 2020 2020 2020  ite(f)..        
-00005f20: 2320 4173 7572 6520 7468 6520 7065 726d  # Asure the perm
-00005f30: 6973 7369 6f6e 7320 6f66 2074 6865 2063  issions of the c
-00005f40: 6f6e 6669 6720 6669 6c65 0a20 2020 2020  onfig file.     
-00005f50: 2020 206f 732e 6368 6d6f 6428 7365 6c66     os.chmod(self
-00005f60: 2e61 7773 5f63 6f6e 6669 675f 6669 6c65  .aws_config_file
-00005f70: 2c20 306f 3630 3029 0a0a 2020 2020 6465  , 0o600)..    de
-00005f80: 6620 5f5f 7365 745f 6177 735f 6372 6564  f __set_aws_cred
-00005f90: 656e 7469 616c 7328 7365 6c66 2c0a 2020  entials(self,.  
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fb0: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
-00005fc0: 7072 6f66 696c 655f 6e61 6d65 2c0a 2020  profile_name,.  
-00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fe0: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
-00005ff0: 6163 6365 7373 5f6b 6579 5f69 642c 0a20  access_key_id,. 
-00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006010: 2020 2020 2020 2020 2020 2020 2061 7773               aws
-00006020: 5f73 6563 7265 745f 6163 6365 7373 5f6b  _secret_access_k
-00006030: 6579 293a 0a0a 2020 2020 2020 2020 6966  ey):..        if
-00006040: 206e 6f74 2061 7773 5f70 726f 6669 6c65   not aws_profile
-00006050: 5f6e 616d 653a 0a20 2020 2020 2020 2020  _name:.         
-00006060: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00006070: 726f 7228 274e 6f20 4157 5320 7072 6f66  ror('No AWS prof
-00006080: 696c 6520 7072 6f76 6964 6564 2729 0a0a  ile provided')..
-00006090: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-000060a0: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
-000060b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000060c0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-000060d0: 4e6f 2041 5753 2061 6363 6573 7320 6b65  No AWS access ke
-000060e0: 7920 6964 2070 726f 7669 6465 6427 290a  y id provided').
-000060f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00006100: 6177 735f 7365 6372 6574 5f61 6363 6573  aws_secret_acces
-00006110: 735f 6b65 793a 0a20 2020 2020 2020 2020  s_key:.         
-00006120: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00006130: 726f 7228 274e 6f20 4157 5320 7365 6372  ror('No AWS secr
-00006140: 6574 2061 6363 6573 7320 6b65 7920 7072  et access key pr
-00006150: 6f76 6964 6564 2729 0a0a 2020 2020 2020  ovided')..      
-00006160: 2020 2320 4966 2069 7420 646f 6573 206e    # If it does n
-00006170: 6f74 2065 7869 7374 2c20 6372 6561 7465  ot exist, create
-00006180: 2061 7773 2064 6972 6563 746f 7279 0a20   aws directory. 
-00006190: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-000061a0: 7273 2873 656c 662e 6177 735f 6469 722c  rs(self.aws_dir,
-000061b0: 2065 7869 7374 5f6f 6b3d 5472 7565 2c20   exist_ok=True, 
-000061c0: 6d6f 6465 3d30 6f37 3735 290a 0a20 2020  mode=0o775)..   
-000061d0: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
-000061e0: 6177 7320 6372 6564 656e 7469 616c 7320  aws credentials 
-000061f0: 436f 6e66 6967 5061 7273 6572 206f 626a  ConfigParser obj
-00006200: 6563 740a 2020 2020 2020 2020 6177 735f  ect.        aws_
-00006210: 6372 6564 656e 7469 616c 7320 3d20 636f  credentials = co
-00006220: 6e66 6967 7061 7273 6572 2e43 6f6e 6669  nfigparser.Confi
-00006230: 6750 6172 7365 7228 290a 0a20 2020 2020  gParser()..     
-00006240: 2020 2023 2069 6620 6578 6973 7473 2c20     # if exists, 
-00006250: 7265 6164 2074 6865 2061 7773 2063 7265  read the aws cre
-00006260: 6465 6e74 6961 6c73 2066 696c 650a 2020  dentials file.  
-00006270: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00006280: 2e65 7869 7374 7328 7365 6c66 2e61 7773  .exists(self.aws
-00006290: 5f63 7265 6465 6e74 6961 6c73 5f66 696c  _credentials_fil
-000062a0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000062b0: 6177 735f 6372 6564 656e 7469 616c 732e  aws_credentials.
-000062c0: 7265 6164 2873 656c 662e 6177 735f 6372  read(self.aws_cr
-000062d0: 6564 656e 7469 616c 735f 6669 6c65 290a  edentials_file).
-000062e0: 0a20 2020 2020 2020 2023 2055 7064 6174  .        # Updat
-000062f0: 6520 7468 6520 7265 6769 6f6e 206f 6620  e the region of 
-00006300: 7468 6520 7072 6f66 696c 650a 2020 2020  the profile.    
-00006310: 2020 2020 6966 206e 6f74 2061 7773 5f63      if not aws_c
-00006320: 7265 6465 6e74 6961 6c73 2e68 6173 5f73  redentials.has_s
-00006330: 6563 7469 6f6e 2861 7773 5f70 726f 6669  ection(aws_profi
-00006340: 6c65 5f6e 616d 6529 3a0a 2020 2020 2020  le_name):.      
-00006350: 2020 2020 2020 6177 735f 6372 6564 656e        aws_creden
-00006360: 7469 616c 732e 6164 645f 7365 6374 696f  tials.add_sectio
-00006370: 6e28 6177 735f 7072 6f66 696c 655f 6e61  n(aws_profile_na
-00006380: 6d65 290a 0a20 2020 2020 2020 2023 2057  me)..        # W
-00006390: 7269 7465 2074 6865 2070 726f 6669 6c65  rite the profile
-000063a0: 2077 6974 6820 7468 6520 6e65 7720 6163   with the new ac
-000063b0: 6365 7373 206b 6579 2069 640a 2020 2020  cess key id.    
-000063c0: 2020 2020 6177 735f 6372 6564 656e 7469      aws_credenti
-000063d0: 616c 735b 6177 735f 7072 6f66 696c 655f  als[aws_profile_
-000063e0: 6e61 6d65 5d5b 2761 7773 5f61 6363 6573  name]['aws_acces
-000063f0: 735f 6b65 795f 6964 275d 203d 2061 7773  s_key_id'] = aws
-00006400: 5f61 6363 6573 735f 6b65 795f 6964 0a0a  _access_key_id..
-00006410: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00006420: 7468 6520 7072 6f66 696c 6520 7769 7468  the profile with
-00006430: 2074 6865 206e 6577 2073 6563 7265 7420   the new secret 
-00006440: 6163 6365 7373 206b 6579 0a20 2020 2020  access key.     
-00006450: 2020 2061 7773 5f63 7265 6465 6e74 6961     aws_credentia
-00006460: 6c73 5b61 7773 5f70 726f 6669 6c65 5f6e  ls[aws_profile_n
-00006470: 616d 655d 5b27 6177 735f 7365 6372 6574  ame]['aws_secret
-00006480: 5f61 6363 6573 735f 6b65 7927 5d20 3d20  _access_key'] = 
-00006490: 6177 735f 7365 6372 6574 5f61 6363 6573  aws_secret_acces
-000064a0: 735f 6b65 790a 0a20 2020 2020 2020 2023  s_key..        #
-000064b0: 2057 7269 7465 2074 6865 2063 6f6e 6669   Write the confi
-000064c0: 6720 6f62 6a65 6374 2074 6f20 7468 6520  g object to the 
-000064d0: 636f 6e66 6967 2066 696c 650a 2020 2020  config file.    
-000064e0: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
-000064f0: 6c66 2e61 7773 5f63 7265 6465 6e74 6961  lf.aws_credentia
-00006500: 6c73 5f66 696c 652c 2027 7727 2920 6173  ls_file, 'w') as
-00006510: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00006520: 6177 735f 6372 6564 656e 7469 616c 732e  aws_credentials.
-00006530: 7772 6974 6528 6629 0a0a 2020 2020 2020  write(f)..      
-00006540: 2020 2320 4173 7572 6520 7468 6520 7065    # Asure the pe
-00006550: 726d 6973 7369 6f6e 7320 6f66 2074 6865  rmissions of the
-00006560: 2063 7265 6465 6e74 6961 6c73 2066 696c   credentials fil
-00006570: 650a 2020 2020 2020 2020 6f73 2e63 686d  e.        os.chm
-00006580: 6f64 2873 656c 662e 6177 735f 6372 6564  od(self.aws_cred
-00006590: 656e 7469 616c 735f 6669 6c65 2c20 306f  entials_file, 0o
-000065a0: 3630 3029 0a0a 2020 2020 6465 6620 5f5f  600)..    def __
-000065b0: 7365 745f 6177 735f 6765 745f 636f 6e66  set_aws_get_conf
-000065c0: 6967 5f72 6567 696f 6e28 7365 6c66 2c20  ig_region(self, 
-000065d0: 6177 735f 7072 6f66 696c 6529 3a0a 0a20  aws_profile):.. 
-000065e0: 2020 2020 2020 2069 6620 6e6f 7420 6177         if not aw
-000065f0: 735f 7072 6f66 696c 653a 0a20 2020 2020  s_profile:.     
-00006600: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006610: 7565 4572 726f 7228 274e 6f20 4157 5320  ueError('No AWS 
-00006620: 7072 6f66 696c 6520 7072 6f76 6964 6564  profile provided
-00006630: 2729 0a0a 2020 2020 2020 2020 2320 4368  ')..        # Ch
-00006640: 6563 6b20 6966 2061 7773 2063 7265 6465  eck if aws crede
-00006650: 6e74 6961 6c73 2066 696c 6520 6578 6973  ntials file exis
-00006660: 7473 0a20 2020 2020 2020 2069 6620 6e6f  ts.        if no
-00006670: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00006680: 2873 656c 662e 6177 735f 636f 6e66 6967  (self.aws_config
-00006690: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
-000066a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000066b0: 7272 6f72 2827 4157 5320 636f 6e66 6967  rror('AWS config
-000066c0: 2066 696c 6520 646f 6573 206e 6f74 2065   file does not e
-000066d0: 7869 7374 2729 0a0a 2020 2020 2020 2020  xist')..        
-000066e0: 2320 4372 6561 7465 2061 2043 6f6e 6669  # Create a Confi
-000066f0: 6750 6172 7365 7220 6f62 6a65 6374 0a20  gParser object. 
-00006700: 2020 2020 2020 2063 6f6e 6669 6720 3d20         config = 
-00006710: 636f 6e66 6967 7061 7273 6572 2e43 6f6e  configparser.Con
-00006720: 6669 6750 6172 7365 7228 290a 0a20 2020  figParser()..   
-00006730: 2020 2020 2023 2052 6561 6420 7468 6520       # Read the 
-00006740: 6177 7320 636f 6e66 6967 2066 696c 650a  aws config file.
-00006750: 2020 2020 2020 2020 636f 6e66 6967 2e72          config.r
-00006760: 6561 6428 7365 6c66 2e61 7773 5f63 6f6e  ead(self.aws_con
-00006770: 6669 675f 6669 6c65 290a 0a20 2020 2020  fig_file)..     
-00006780: 2020 2069 6620 636f 6e66 6967 2e68 6173     if config.has
-00006790: 5f73 6563 7469 6f6e 2861 7773 5f70 726f  _section(aws_pro
-000067a0: 6669 6c65 2920 616e 6420 636f 6e66 6967  file) and config
-000067b0: 2e68 6173 5f6f 7074 696f 6e28 6177 735f  .has_option(aws_
-000067c0: 7072 6f66 696c 652c 2027 7265 6769 6f6e  profile, 'region
-000067d0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-000067e0: 7265 7475 726e 2063 6f6e 6669 672e 6765  return config.ge
-000067f0: 7428 6177 735f 7072 6f66 696c 652c 2027  t(aws_profile, '
-00006800: 7265 6769 6f6e 2729 0a0a 2020 2020 2020  region')..      
-00006810: 2020 7265 7475 726e 0a0a 2020 2020 6465    return..    de
-00006820: 6620 5f5f 7365 745f 636f 6e66 6967 7572  f __set_configur
-00006830: 6174 696f 6e5f 656e 7472 7928 7365 6c66  ation_entry(self
-00006840: 2c20 7365 6374 696f 6e2c 206b 6579 2c20  , section, key, 
-00006850: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
-00006860: 2727 2753 6574 2061 2063 6f6e 6669 6775  '''Set a configu
-00006870: 7261 7469 6f6e 2065 6e74 7279 2069 6e20  ration entry in 
-00006880: 7468 6520 636f 6e66 6967 2066 696c 6527  the config file'
-00006890: 2727 0a0a 2020 2020 2020 2020 2320 4372  ''..        # Cr
-000068a0: 6561 7465 2061 2043 6f6e 6669 6750 6172  eate a ConfigPar
-000068b0: 7365 7220 6f62 6a65 6374 0a20 2020 2020  ser object.     
-000068c0: 2020 2063 6f6e 6669 6720 3d20 636f 6e66     config = conf
-000068d0: 6967 7061 7273 6572 2e43 6f6e 6669 6750  igparser.ConfigP
-000068e0: 6172 7365 7228 290a 0a20 2020 2020 2020  arser()..       
-000068f0: 2023 2043 6865 636b 2077 6869 6368 2063   # Check which c
-00006900: 6f6e 6669 6720 6669 6c65 2074 6f20 7573  onfig file to us
-00006910: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
-00006920: 662e 6973 5f73 6861 7265 6420 616e 6420  f.is_shared and 
-00006930: 7365 6374 696f 6e20 696e 205b 274e 4948  section in ['NIH
-00006940: 272c 2027 5333 272c 2027 534c 5552 4d27  ', 'S3', 'SLURM'
-00006950: 2c20 2743 4c4f 5544 275d 3a0a 0a20 2020  , 'CLOUD']:..   
-00006960: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-00006970: 6520 7368 6172 6564 2063 6f6e 6669 6720  e shared config 
-00006980: 6469 7265 6374 6f72 7920 696e 2063 6173  directory in cas
-00006990: 6520 6974 2064 6f65 7320 6e6f 7420 6578  e it does not ex
-000069a0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-000069b0: 6f73 2e6d 616b 6564 6972 7328 7365 6c66  os.makedirs(self
-000069c0: 2e73 6861 7265 645f 6469 722c 2065 7869  .shared_dir, exi
-000069d0: 7374 5f6f 6b3d 5472 7565 2c20 6d6f 6465  st_ok=True, mode
-000069e0: 3d30 6f37 3735 290a 0a20 2020 2020 2020  =0o775)..       
-000069f0: 2020 2020 2023 2047 6574 2074 6865 2073       # Get the s
-00006a00: 6861 7265 6420 636f 6e66 6967 2066 696c  hared config fil
-00006a10: 650a 2020 2020 2020 2020 2020 2020 6669  e.            fi
-00006a20: 6c65 203d 2073 656c 662e 7368 6172 6564  le = self.shared
-00006a30: 5f63 6f6e 6669 675f 6669 6c65 0a20 2020  _config_file.   
-00006a40: 2020 2020 2065 6c73 653a 0a0a 2020 2020       else:..    
-00006a50: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00006a60: 2063 6f6e 6669 6720 6469 7265 6374 6f72   config director
-00006a70: 7920 696e 2063 6173 6520 6974 2064 6f65  y in case it doe
-00006a80: 7320 6e6f 7420 6578 6973 740a 2020 2020  s not exist.    
-00006a90: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00006aa0: 6972 7328 7365 6c66 2e63 6f6e 6669 675f  irs(self.config_
-00006ab0: 6469 722c 2065 7869 7374 5f6f 6b3d 5472  dir, exist_ok=Tr
-00006ac0: 7565 2c20 6d6f 6465 3d30 6f37 3735 290a  ue, mode=0o775).
-00006ad0: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
-00006ae0: 6574 2074 6865 2063 6f6e 6669 6720 6669  et the config fi
-00006af0: 6c65 0a20 2020 2020 2020 2020 2020 2066  le.            f
-00006b00: 696c 6520 3d20 7365 6c66 2e63 6f6e 6669  ile = self.confi
-00006b10: 675f 6669 6c65 0a0a 2020 2020 2020 2020  g_file..        
-00006b20: 2320 6966 2065 7869 7374 732c 2072 6561  # if exists, rea
-00006b30: 6420 7468 6520 636f 6e66 6967 2066 696c  d the config fil
-00006b40: 650a 2020 2020 2020 2020 6966 206f 732e  e.        if os.
-00006b50: 7061 7468 2e65 7869 7374 7328 6669 6c65  path.exists(file
-00006b60: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
-00006b70: 6f6e 6669 672e 7265 6164 2866 696c 6529  onfig.read(file)
-00006b80: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-00006b90: 7465 2074 6865 2073 6563 7469 6f6e 2069  te the section i
-00006ba0: 6620 6974 2064 6f65 7320 6e6f 7420 6578  f it does not ex
-00006bb0: 6973 740a 2020 2020 2020 2020 6966 206e  ist.        if n
-00006bc0: 6f74 2063 6f6e 6669 672e 6861 735f 7365  ot config.has_se
-00006bd0: 6374 696f 6e28 7365 6374 696f 6e29 3a0a  ction(section):.
-00006be0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00006bf0: 6967 2e61 6464 5f73 6563 7469 6f6e 2873  ig.add_section(s
-00006c00: 6563 7469 6f6e 290a 0a20 2020 2020 2020  ection)..       
-00006c10: 2023 2053 6574 2074 6865 2076 616c 7565   # Set the value
-00006c20: 0a20 2020 2020 2020 2063 6f6e 6669 675b  .        config[
-00006c30: 7365 6374 696f 6e5d 5b6b 6579 5d20 3d20  section][key] = 
-00006c40: 7661 6c75 650a 0a20 2020 2020 2020 2023  value..        #
-00006c50: 2057 7269 7465 2074 6865 2063 6f6e 6669   Write the confi
-00006c60: 6720 6f62 6a65 6374 2074 6f20 7468 6520  g object to the 
-00006c70: 636f 6e66 6967 2066 696c 650a 2020 2020  config file.    
-00006c80: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
-00006c90: 6c65 2c20 2777 2729 2061 7320 663a 0a20  le, 'w') as f:. 
-00006ca0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00006cb0: 672e 7772 6974 6528 6629 0a0a 2020 2020  g.write(f)..    
-00006cc0: 2020 2020 2320 5365 7420 7468 6520 7661      # Set the va
-00006cd0: 6c75 6520 696e 2074 6865 2063 6f6e 6669  lue in the confi
-00006ce0: 6720 6f62 6a65 6374 0a20 2020 2020 2020  g object.       
-00006cf0: 2073 6574 6174 7472 2873 656c 662c 206b   setattr(self, k
-00006d00: 6579 2c20 7661 6c75 6529 0a0a 2020 2020  ey, value)..    
-00006d10: 6465 6620 7365 735f 7665 7269 6679 5f72  def ses_verify_r
-00006d20: 6571 7565 7374 735f 7365 6e74 2873 656c  equests_sent(sel
-00006d30: 662c 2065 6d61 696c 5f6c 6973 7429 3a0a  f, email_list):.
-00006d40: 2020 2020 2020 2020 2727 2753 6574 2074          '''Set t
-00006d50: 6865 2073 6573 2076 6572 6966 7920 7265  he ses verify re
-00006d60: 7175 6573 7473 2073 656e 7420 656d 6169  quests sent emai
-00006d70: 6c20 6c69 7374 2069 6e20 636f 6e66 6967  l list in config
-00006d80: 7572 6174 696f 6e20 6669 6c65 2727 270a  uration file'''.
-00006d90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00006da0: 656d 6169 6c5f 6c69 7374 3a0a 2020 2020  email_list:.    
-00006db0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00006dc0: 6c75 6545 7272 6f72 2827 4e6f 2065 6d61  lueError('No ema
-00006dd0: 696c 206c 6973 7420 7072 6f76 6964 6564  il list provided
-00006de0: 2729 0a0a 2020 2020 2020 2020 2320 5772  ')..        # Wr
-00006df0: 6974 6520 7468 6520 636f 6e66 6967 206f  ite the config o
-00006e00: 626a 6563 7420 746f 2074 6865 2063 6f6e  bject to the con
-00006e10: 6669 6720 6669 6c65 0a20 2020 2020 2020  fig file.       
-00006e20: 2073 656c 662e 5f5f 7365 745f 636f 6e66   self.__set_conf
-00006e30: 6967 7572 6174 696f 6e5f 656e 7472 7928  iguration_entry(
-00006e40: 0a20 2020 2020 2020 2020 2020 2027 434c  .            'CL
-00006e50: 4f55 4c44 272c 2027 7365 735f 7665 7269  OULD', 'ses_veri
-00006e60: 6679 5f72 6571 7565 7374 735f 7365 6e74  fy_requests_sent
-00006e70: 272c 2065 6d61 696c 5f6c 6973 7429 0a0a  ', email_list)..
-00006e80: 2020 2020 6465 6620 7365 745f 6563 325f      def set_ec2_
-00006e90: 6c61 7374 5f69 6e73 7461 6e63 6528 7365  last_instance(se
-00006ea0: 6c66 2c20 696e 7374 616e 6365 293a 0a20  lf, instance):. 
-00006eb0: 2020 2020 2020 2027 2727 5365 7420 7468         '''Set th
-00006ec0: 6520 6c61 7374 2065 6332 2069 6e73 7461  e last ec2 insta
-00006ed0: 6e63 6520 696e 2063 6f6e 6669 6775 7261  nce in configura
-00006ee0: 7469 6f6e 2066 696c 6527 2727 0a0a 2020  tion file'''..  
-00006ef0: 2020 2020 2020 6966 206e 6f74 2069 6e73        if not ins
-00006f00: 7461 6e63 653a 0a20 2020 2020 2020 2020  tance:.         
-00006f10: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00006f20: 726f 7228 274e 6f20 696e 7374 616e 6365  ror('No instance
-00006f30: 2070 726f 7669 6465 6427 290a 0a20 2020   provided')..   
-00006f40: 2020 2020 2023 2057 7269 7465 2074 6865       # Write the
-00006f50: 2063 6f6e 6669 6720 6f62 6a65 6374 2074   config object t
-00006f60: 6f20 7468 6520 636f 6e66 6967 2066 696c  o the config fil
-00006f70: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00006f80: 5f73 6574 5f63 6f6e 6669 6775 7261 7469  _set_configurati
-00006f90: 6f6e 5f65 6e74 7279 2827 434c 4f55 4c44  on_entry('CLOULD
-00006fa0: 272c 2027 6563 325f 6c61 7374 5f69 6e73  ', 'ec2_last_ins
-00006fb0: 7461 6e63 6527 2c20 696e 7374 616e 6365  tance', instance
-00006fc0: 290a 0a20 2020 2064 6566 2073 6574 5f6e  )..    def set_n
-00006fd0: 6968 2873 656c 6629 3a0a 0a20 2020 2020  ih(self):..     
-00006fe0: 2020 2070 7269 6e74 2866 275c 6e2a 2a2a     print(f'\n***
-00006ff0: 204e 4948 2053 3320 434f 4e46 4947 5552   NIH S3 CONFIGUR
-00007000: 4154 494f 4e20 2a2a 2a5c 6e27 290a 0a20  ATION ***\n').. 
-00007010: 2020 2020 2020 2069 735f 6e69 6820 3d20         is_nih = 
-00007020: 696e 7175 6972 6572 2e63 6f6e 6669 726d  inquirer.confirm
-00007030: 280a 2020 2020 2020 2020 2020 2020 6d65  (.            me
-00007040: 7373 6167 653d 2244 6f20 796f 7520 7761  ssage="Do you wa
-00007050: 6e74 2074 6f20 7365 6172 6368 2061 6e64  nt to search and
-00007060: 206c 696e 6b20 4e49 4820 6c69 6665 2073   link NIH life s
-00007070: 6369 656e 6365 7320 6772 616e 7473 2077  ciences grants w
-00007080: 6974 6820 796f 7572 2061 7263 6869 7665  ith your archive
-00007090: 733f 222c 2064 6566 6175 6c74 3d46 616c  s?", default=Fal
-000070a0: 7365 290a 0a20 2020 2020 2020 2073 656c  se)..        sel
-000070b0: 662e 5f5f 7365 745f 636f 6e66 6967 7572  f.__set_configur
-000070c0: 6174 696f 6e5f 656e 7472 7928 274e 4948  ation_entry('NIH
-000070d0: 272c 2027 6973 5f6e 6968 272c 2073 7472  ', 'is_nih', str
-000070e0: 2869 735f 6e69 6829 290a 0a20 2020 2020  (is_nih))..     
-000070f0: 2020 2070 7269 6e74 2866 272a 2a2a 204e     print(f'*** N
-00007100: 4948 2053 3320 434f 4e46 4947 5552 4154  IH S3 CONFIGURAT
-00007110: 494f 4e20 444f 4e45 2a2a 2a5c 6e27 290a  ION DONE***\n').
-00007120: 0a20 2020 2064 6566 2073 6574 5f73 3328  .    def set_s3(
-00007130: 7365 6c66 2c20 6177 733a 2022 4157 5342  self, aws: "AWSB
-00007140: 6f74 6f22 293a 0a0a 2020 2020 2020 2020  oto"):..        
-00007150: 7072 696e 7428 6627 5c6e 2a2a 2a20 5333  print(f'\n*** S3
-00007160: 2043 4f4e 4649 4755 5241 5449 4f4e 202a   CONFIGURATION *
-00007170: 2a2a 5c6e 2729 0a0a 2020 2020 2020 2020  **\n')..        
-00007180: 7072 696e 7428 6627 4368 6563 6b69 6e67  print(f'Checking
-00007190: 2041 5753 2063 7265 6465 6e74 6961 6c73   AWS credentials
-000071a0: 2066 6f72 2070 726f 6669 6c65 2022 7b73   for profile "{s
-000071b0: 656c 662e 6177 735f 7072 6f66 696c 657d  elf.aws_profile}
-000071c0: 222e 2e2e 2729 0a20 2020 2020 2020 2069  "...').        i
-000071d0: 6620 6177 732e 6368 6563 6b5f 6372 6564  f aws.check_cred
-000071e0: 656e 7469 616c 7328 293a 0a20 2020 2020  entials():.     
-000071f0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-00007200: 2020 2e2e 2e41 5753 2063 7265 6465 6e74    ...AWS credent
-00007210: 6961 6c73 2061 7265 2076 616c 6964 5c6e  ials are valid\n
-00007220: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
-00007230: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00007240: 6e74 2827 2020 2020 2e2e 2e41 5753 2063  nt('    ...AWS c
-00007250: 7265 6465 6e74 6961 6c73 2061 7265 204e  redentials are N
-00007260: 4f54 2076 616c 6964 5c6e 2729 0a20 2020  OT valid\n').   
-00007270: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00007280: 5c6e 596f 7520 6361 6e20 636f 6e66 6967  \nYou can config
-00007290: 7572 6520 6177 7320 6372 6564 656e 7469  ure aws credenti
-000072a0: 616c 7320 7573 696e 6720 7468 6520 636f  als using the co
-000072b0: 6d6d 616e 643a 2729 0a20 2020 2020 2020  mmand:').       
-000072c0: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
-000072d0: 6672 6f73 7465 7220 636f 6e66 6967 202d  froster config -
-000072e0: 2d61 7773 2729 0a20 2020 2020 2020 2020  -aws').         
-000072f0: 2020 2070 7269 6e74 2866 275c 6e2a 2a2a     print(f'\n***
-00007300: 2053 3320 434f 4e46 4947 5552 4154 494f   S3 CONFIGURATIO
-00007310: 4e20 444f 4e45 202a 2a2a 5c6e 2729 0a20  N DONE ***\n'). 
-00007320: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00007330: 7869 7428 3029 0a0a 2020 2020 2020 2020  xit(0)..        
-00007340: 2320 4765 7420 6c69 7374 2066 726f 7374  # Get list frost
-00007350: 6572 2062 7563 6b65 7473 2066 6f72 2074  er buckets for t
-00007360: 6865 2067 6976 656e 2070 726f 6669 6c65  he given profile
-00007370: 0a20 2020 2020 2020 2073 335f 6275 636b  .        s3_buck
-00007380: 6574 7320 3d20 6177 732e 6765 745f 6275  ets = aws.get_bu
-00007390: 636b 6574 7328 290a 0a20 2020 2020 2020  ckets()..       
-000073a0: 2023 2041 6464 2061 6e20 6f70 7469 6f6e   # Add an option
-000073b0: 2074 6f20 6372 6561 7465 2061 206e 6577   to create a new
-000073c0: 2062 7563 6b65 740a 2020 2020 2020 2020   bucket.        
-000073d0: 7333 5f62 7563 6b65 7473 2e61 7070 656e  s3_buckets.appen
-000073e0: 6428 272b 2043 7265 6174 6520 6e65 7720  d('+ Create new 
-000073f0: 6275 636b 6574 2729 0a0a 2020 2020 2020  bucket')..      
-00007400: 2020 2320 4173 6b20 7573 6572 2074 6f20    # Ask user to 
-00007410: 6368 6f6f 7365 2061 6e20 6578 6973 7469  choose an existi
-00007420: 6e67 2061 7773 2073 3320 6275 636b 6574  ng aws s3 bucket
-00007430: 206f 7220 6372 6561 7465 2061 206e 6577   or create a new
-00007440: 206f 6e65 0a20 2020 2020 2020 2073 335f   one.        s3_
-00007450: 6275 636b 6574 203d 2069 6e71 7569 7265  bucket = inquire
-00007460: 722e 6c69 7374 5f69 6e70 7574 2822 4368  r.list_input("Ch
-00007470: 6f6f 7365 2079 6f75 7220 6177 7320 7333  oose your aws s3
-00007480: 2062 7563 6b65 7422 2c0a 2020 2020 2020   bucket",.      
-00007490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074b0: 2020 6465 6661 756c 743d 7365 6c66 2e62    default=self.b
-000074c0: 7563 6b65 745f 6e61 6d65 2c0a 2020 2020  ucket_name,.    
-000074d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074f0: 2020 2020 6368 6f69 6365 733d 7333 5f62      choices=s3_b
-00007500: 7563 6b65 7473 290a 0a20 2020 2020 2020  uckets)..       
-00007510: 2023 2043 6865 636b 2069 6620 7573 6572   # Check if user
-00007520: 2077 616e 7473 2074 6f20 6372 6561 7465   wants to create
-00007530: 2061 206e 6577 2061 7773 2073 3320 6275   a new aws s3 bu
-00007540: 636b 6574 0a20 2020 2020 2020 2069 6620  cket.        if 
-00007550: 7333 5f62 7563 6b65 7420 3d3d 2027 2b20  s3_bucket == '+ 
-00007560: 4372 6561 7465 206e 6577 2062 7563 6b65  Create new bucke
-00007570: 7427 3a0a 0a20 2020 2020 2020 2020 2020  t':..           
-00007580: 2023 2047 6574 206e 6577 2062 7563 6b65   # Get new bucke
-00007590: 7420 6e61 6d65 0a20 2020 2020 2020 2020  t name.         
-000075a0: 2020 206e 6577 5f62 7563 6b65 745f 6e61     new_bucket_na
-000075b0: 6d65 203d 2069 6e71 7569 7265 722e 7465  me = inquirer.te
-000075c0: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
-000075d0: 2020 2020 6d65 7373 6167 653d 2745 6e74      message='Ent
-000075e0: 6572 206e 6577 2062 7563 6b65 7420 6e61  er new bucket na
-000075f0: 6d65 2028 6974 206d 7573 7420 7374 6172  me (it must star
-00007600: 7420 7769 7468 2022 6672 6f73 7465 722d  t with "froster-
-00007610: 2229 272c 0a20 2020 2020 2020 2020 2020  ")',.           
-00007620: 2020 2020 2076 616c 6964 6174 653d 7365       validate=se
-00007630: 6c66 2e5f 5f69 6e71 7569 7265 725f 6368  lf.__inquirer_ch
-00007640: 6563 6b5f 6275 636b 6574 5f6e 616d 6529  eck_bucket_name)
-00007650: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00007660: 206e 6577 5f62 7563 6b65 745f 6e61 6d65   new_bucket_name
-00007670: 2069 6e20 7333 5f62 7563 6b65 7473 3a0a   in s3_buckets:.
-00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007690: 7072 696e 7428 6627 4275 636b 6574 207b  print(f'Bucket {
-000076a0: 6e65 775f 6275 636b 6574 5f6e 616d 657d  new_bucket_name}
-000076b0: 2061 6c72 6561 6479 2065 7869 7374 7327   already exists'
-000076c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000076d0: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
-000076e0: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
-000076f0: 6174 6520 6e65 7720 6275 636b 6574 0a20  ate new bucket. 
-00007700: 2020 2020 2020 2020 2020 2061 7773 2e63             aws.c
-00007710: 7265 6174 655f 6275 636b 6574 2862 7563  reate_bucket(buc
-00007720: 6b65 745f 6e61 6d65 3d6e 6577 5f62 7563  ket_name=new_buc
-00007730: 6b65 745f 6e61 6d65 290a 0a20 2020 2020  ket_name)..     
-00007740: 2020 2020 2020 2023 2053 746f 7265 206e         # Store n
-00007750: 6577 2061 7773 2073 3320 6275 636b 6574  ew aws s3 bucket
-00007760: 2069 6e20 7468 6520 636f 6e66 6967 206f   in the config o
-00007770: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
-00007780: 2020 7365 6c66 2e5f 5f73 6574 5f63 6f6e    self.__set_con
-00007790: 6669 6775 7261 7469 6f6e 5f65 6e74 7279  figuration_entry
-000077a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000077b0: 2020 2753 3327 2c20 2762 7563 6b65 745f    'S3', 'bucket_
-000077c0: 6e61 6d65 272c 206e 6577 5f62 7563 6b65  name', new_bucke
-000077d0: 745f 6e61 6d65 290a 2020 2020 2020 2020  t_name).        
-000077e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000077f0: 2020 2320 5374 6f72 6520 6177 7320 7333    # Store aws s3
-00007800: 2062 7563 6b65 7420 696e 2074 6865 2063   bucket in the c
-00007810: 6f6e 6669 6720 6f62 6a65 6374 0a20 2020  onfig object.   
-00007820: 2020 2020 2020 2020 2073 656c 662e 5f5f           self.__
-00007830: 7365 745f 636f 6e66 6967 7572 6174 696f  set_configuratio
-00007840: 6e5f 656e 7472 7928 2753 3327 2c20 2762  n_entry('S3', 'b
-00007850: 7563 6b65 745f 6e61 6d65 272c 2073 335f  ucket_name', s3_
-00007860: 6275 636b 6574 290a 0a20 2020 2020 2020  bucket)..       
-00007870: 2023 2047 6574 2074 6865 2061 7263 6869   # Get the archi
-00007880: 7665 2064 6972 6563 746f 7279 2069 6e20  ve directory in 
-00007890: 7468 6520 7365 6c65 6374 6564 2062 7563  the selected buc
-000078a0: 6b65 740a 2020 2020 2020 2020 6172 6368  ket.        arch
-000078b0: 6976 655f 6469 7220 3d20 696e 7175 6972  ive_dir = inquir
-000078c0: 6572 2e74 6578 7428 0a20 2020 2020 2020  er.text(.       
-000078d0: 2020 2020 206d 6573 7361 6765 3d27 456e       message='En
-000078e0: 7465 7220 7468 6520 6172 6368 6976 6520  ter the archive 
-000078f0: 6469 7265 6374 6f72 7920 6e61 6d65 2069  directory name i
-00007900: 6e73 6964 6520 796f 7572 2053 3320 6275  nside your S3 bu
-00007910: 636b 6574 272c 0a20 2020 2020 2020 2020  cket',.         
-00007920: 2020 2064 6566 6175 6c74 3d27 6672 6f73     default='fros
-00007930: 7465 7227 2c0a 2020 2020 2020 2020 2020  ter',.          
-00007940: 2020 7661 6c69 6461 7465 3d73 656c 662e    validate=self.
-00007950: 5f5f 696e 7175 6972 6572 5f63 6865 636b  __inquirer_check
-00007960: 5f72 6571 7569 7265 6429 0a0a 2020 2020  _required)..    
-00007970: 2020 2020 2320 5072 696e 7420 6e65 776c      # Print newl
-00007980: 696e 6520 6166 7465 7220 7468 6973 2070  ine after this p
-00007990: 726f 6d70 740a 2020 2020 2020 2020 7072  rompt.        pr
-000079a0: 696e 7428 290a 0a20 2020 2020 2020 2023  int()..        #
-000079b0: 2053 746f 7265 2061 7773 2073 3320 6172   Store aws s3 ar
-000079c0: 6368 6976 6520 6469 7220 696e 2074 6865  chive dir in the
-000079d0: 2063 6f6e 6669 6720 6f62 6a65 6374 0a20   config object. 
-000079e0: 2020 2020 2020 2073 656c 662e 5f5f 7365         self.__se
-000079f0: 745f 636f 6e66 6967 7572 6174 696f 6e5f  t_configuration_
-00007a00: 656e 7472 7928 2753 3327 2c20 2761 7263  entry('S3', 'arc
-00007a10: 6869 7665 5f64 6972 272c 2061 7263 6869  hive_dir', archi
-00007a20: 7665 5f64 6972 290a 0a20 2020 2020 2020  ve_dir)..       
-00007a30: 2023 2047 6574 2074 6865 2073 746f 7261   # Get the stora
-00007a40: 6765 2063 6c61 7373 2066 6f72 2074 6865  ge class for the
-00007a50: 2073 656c 6563 7465 6420 6275 636b 6574   selected bucket
-00007a60: 0a20 2020 2020 2020 2073 746f 7261 6765  .        storage
-00007a70: 5f63 6c61 7373 203d 2069 6e71 7569 7265  _class = inquire
-00007a80: 722e 6c69 7374 5f69 6e70 7574 2822 4368  r.list_input("Ch
-00007a90: 6f6f 7365 2074 6865 2041 5753 2053 3320  oose the AWS S3 
-00007aa0: 7374 6f72 6167 6520 636c 6173 7322 2c0a  storage class",.
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ad0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007ae0: 756c 743d 7365 6c66 2e73 746f 7261 6765  ult=self.storage
-00007af0: 5f63 6c61 7373 2c0a 2020 2020 2020 2020  _class,.        
-00007b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b20: 2020 2020 6368 6f69 6365 733d 7b27 4445      choices={'DE
-00007b30: 4550 5f41 5243 4849 5645 272c 2027 474c  EP_ARCHIVE', 'GL
-00007b40: 4143 4945 5227 2c20 2749 4e54 454c 4c49  ACIER', 'INTELLI
-00007b50: 4745 4e54 5f54 4945 5249 4e47 277d 290a  GENT_TIERING'}).
-00007b60: 0a20 2020 2020 2020 2023 2053 746f 7265  .        # Store
-00007b70: 2061 7773 2073 3320 7374 6f72 6167 6520   aws s3 storage 
-00007b80: 636c 6173 7320 696e 2074 6865 2063 6f6e  class in the con
-00007b90: 6669 6720 6f62 6a65 6374 0a20 2020 2020  fig object.     
-00007ba0: 2020 2073 656c 662e 5f5f 7365 745f 636f     self.__set_co
-00007bb0: 6e66 6967 7572 6174 696f 6e5f 656e 7472  nfiguration_entr
-00007bc0: 7928 2753 3327 2c20 2773 746f 7261 6765  y('S3', 'storage
-00007bd0: 5f63 6c61 7373 272c 2073 746f 7261 6765  _class', storage
-00007be0: 5f63 6c61 7373 290a 0a20 2020 2020 2020  _class)..       
-00007bf0: 2070 7269 6e74 2866 275c 6e2a 2a2a 2053   print(f'\n*** S
-00007c00: 3320 434f 4e46 4947 5552 4154 494f 4e20  3 CONFIGURATION 
-00007c10: 444f 4e45 202a 2a2a 5c6e 2729 0a0a 2020  DONE ***\n')..  
-00007c20: 2020 6465 6620 7365 745f 7368 6172 6564    def set_shared
-00007c30: 2873 656c 6629 3a0a 0a20 2020 2020 2020  (self):..       
-00007c40: 2070 7269 6e74 2866 275c 6e2a 2a2a 2053   print(f'\n*** S
-00007c50: 4841 5245 4420 434f 4e46 4947 5552 4154  HARED CONFIGURAT
-00007c60: 494f 4e20 2a2a 2a5c 6e27 290a 0a20 2020  ION ***\n')..   
-00007c70: 2020 2020 2069 735f 7368 6172 6564 203d       is_shared =
-00007c80: 2069 6e71 7569 7265 722e 636f 6e66 6972   inquirer.confir
-00007c90: 6d28 0a20 2020 2020 2020 2020 2020 206d  m(.            m
-00007ca0: 6573 7361 6765 3d22 446f 2079 6f75 2077  essage="Do you w
-00007cb0: 616e 7420 746f 2063 6f6c 6c61 626f 7261  ant to collabora
-00007cc0: 7465 2077 6974 6820 6f74 6865 7220 7573  te with other us
-00007cd0: 6572 7320 6f6e 2061 7263 6869 7665 2061  ers on archive a
-00007ce0: 6e64 2072 6573 746f 7265 3f22 2c20 6465  nd restore?", de
-00007cf0: 6661 756c 743d 4661 6c73 6529 0a0a 2020  fault=False)..  
-00007d00: 2020 2020 2020 2320 4966 2069 7420 6973        # If it is
-00007d10: 2061 2073 6861 7265 6420 636f 6e66 6967   a shared config
-00007d20: 7572 6174 696f 6e20 7765 206e 6565 6420  uration we need 
-00007d30: 746f 2061 736b 2074 6865 2075 7365 7220  to ask the user 
-00007d40: 666f 7220 7468 6520 7061 7468 2074 6f20  for the path to 
-00007d50: 7468 6520 7368 6172 6564 2063 6f6e 6669  the shared confi
-00007d60: 6720 6469 7265 6374 6f72 790a 2020 2020  g directory.    
-00007d70: 2020 2020 2320 616e 6420 6368 6563 6b20      # and check 
-00007d80: 6966 2077 6520 6e65 6564 2074 6f20 6d6f  if we need to mo
-00007d90: 7665 2063 6667 2e61 7263 6869 7665 5f6a  ve cfg.archive_j
-00007da0: 736f 6e5f 6669 6c65 5f6e 616d 6520 616e  son_file_name an
-00007db0: 6420 636f 6e66 6967 7572 6174 696f 6e20  d configuration 
-00007dc0: 746f 2074 6865 2073 6861 7265 6420 6469  to the shared di
-00007dd0: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
-00007de0: 6966 2069 735f 7368 6172 6564 3a0a 0a20  if is_shared:.. 
-00007df0: 2020 2020 2020 2020 2020 2023 2041 736b             # Ask
-00007e00: 2075 7365 7220 746f 2065 6e74 6572 2074   user to enter t
-00007e10: 6865 2070 6174 6820 746f 2061 2073 6861  he path to a sha
-00007e20: 7265 6420 636f 6e66 6967 2064 6972 6563  red config direc
-00007e30: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
-00007e40: 2023 2054 4f44 4f3a 206d 616b 6520 7468   # TODO: make th
-00007e50: 6973 2069 6e71 7569 7269 6e67 2069 6e20  is inquiring in 
-00007e60: 7368 6f72 7463 6875 7420 6d6f 6465 206f  shortchut mode o
-00007e70: 6e63 6520 7468 6973 2050 5220 6973 206d  nce this PR is m
-00007e80: 6572 6765 643a 2068 7474 7073 3a2f 2f67  erged: https://g
-00007e90: 6974 6875 622e 636f 6d2f 6d61 676d 6178  ithub.com/magmax
-00007ea0: 2f70 7974 686f 6e2d 696e 7175 6972 6572  /python-inquirer
-00007eb0: 2f70 756c 6c2f 3534 330a 2020 2020 2020  /pull/543.      
-00007ec0: 2020 2020 2020 7368 6172 6564 5f63 6f6e        shared_con
-00007ed0: 6669 675f 6469 725f 7175 6573 7469 6f6e  fig_dir_question
-00007ee0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00007ef0: 2020 2020 2069 6e71 7569 7265 722e 5061       inquirer.Pa
-00007f00: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-00007f10: 2020 2020 2020 2020 2773 6861 7265 645f          'shared_
-00007f20: 6469 7227 2c20 6d65 7373 6167 653d 2745  dir', message='E
-00007f30: 6e74 6572 2074 6865 2070 6174 6820 746f  nter the path to
-00007f40: 2061 2073 6861 7265 6420 636f 6e66 6967   a shared config
-00007f50: 2064 6972 6563 746f 7279 272c 2076 616c   directory', val
-00007f60: 6964 6174 653d 7365 6c66 2e5f 5f69 6e71  idate=self.__inq
-00007f70: 7569 7265 725f 6368 6563 6b5f 7061 7468  uirer_check_path
-00007f80: 5f65 7869 7374 7329 0a20 2020 2020 2020  _exists).       
-00007f90: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00007fa0: 2020 2020 2320 4765 7420 7468 6520 616e      # Get the an
-00007fb0: 7377 6572 2066 726f 6d20 7468 6520 7573  swer from the us
-00007fc0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-00007fd0: 6861 7265 645f 636f 6e66 6967 5f64 6972  hared_config_dir
-00007fe0: 5f61 6e73 7765 7220 3d20 696e 7175 6972  _answer = inquir
-00007ff0: 6572 2e70 726f 6d70 7428 0a20 2020 2020  er.prompt(.     
-00008000: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00008010: 645f 636f 6e66 6967 5f64 6972 5f71 7565  d_config_dir_que
-00008020: 7374 696f 6e29 0a20 2020 2020 2020 2020  stion).         
-00008030: 2020 2073 6861 7265 645f 636f 6e66 6967     shared_config
-00008040: 5f64 6972 203d 2073 6861 7265 645f 636f  _dir = shared_co
-00008050: 6e66 6967 5f64 6972 5f61 6e73 7765 725b  nfig_dir_answer[
-00008060: 2773 6861 7265 645f 6469 7227 5d0a 2020  'shared_dir'].  
-00008070: 2020 2020 2020 2020 2020 7368 6172 6564            shared
-00008080: 5f63 6f6e 6669 675f 6469 7220 3d20 6f73  _config_dir = os
-00008090: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
-000080a0: 2873 6861 7265 645f 636f 6e66 6967 5f64  (shared_config_d
-000080b0: 6972 290a 0a20 2020 2020 2020 2020 2020  ir)..           
-000080c0: 2023 2043 7265 6174 6520 7468 6520 6469   # Create the di
-000080d0: 7265 6374 6f72 7920 696e 2063 6173 6520  rectory in case 
-000080e0: 6974 2064 6f65 7320 6e6f 7420 6578 6973  it does not exis
-000080f0: 740a 2020 2020 2020 2020 2020 2020 6f73  t.            os
-00008100: 2e6d 616b 6564 6972 7328 7368 6172 6564  .makedirs(shared
-00008110: 5f63 6f6e 6669 675f 6469 722c 2065 7869  _config_dir, exi
-00008120: 7374 5f6f 6b3d 5472 7565 2c20 6d6f 6465  st_ok=True, mode
-00008130: 3d30 6f37 3735 290a 0a20 2020 2020 2020  =0o775)..       
-00008140: 2020 2020 2023 2041 736b 2074 6865 2075       # Ask the u
-00008150: 7365 7220 6966 2074 6865 7920 7761 6e74  ser if they want
-00008160: 2074 6f20 6d6f 7665 2074 6865 2066 726f   to move the fro
-00008170: 7374 6572 2d61 7263 6869 7665 732e 6a73  ster-archives.js
-00008180: 6f6e 2066 696c 6520 746f 2074 6865 2073  on file to the s
-00008190: 6861 7265 6420 6469 7265 6374 6f72 790a  hared directory.
-000081a0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-000081b0: 732e 7061 7468 2e69 7366 696c 6528 6f73  s.path.isfile(os
-000081c0: 2e70 6174 682e 6a6f 696e 2873 6861 7265  .path.join(share
-000081d0: 645f 636f 6e66 6967 5f64 6972 2c20 7365  d_config_dir, se
-000081e0: 6c66 2e61 7263 6869 7665 5f6a 736f 6e5f  lf.archive_json_
-000081f0: 6669 6c65 5f6e 616d 6529 293a 0a20 2020  file_name)):.   
-00008200: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-00008210: 6620 7468 6520 6672 6f73 7465 722d 6172  f the froster-ar
-00008220: 6368 6976 6573 2e6a 736f 6e20 6669 6c65  chives.json file
-00008230: 2069 7320 666f 756e 6420 696e 2074 6865   is found in the
-00008240: 2073 6861 7265 6420 636f 6e66 6967 2064   shared config d
-00008250: 6972 6563 746f 7279 2077 6520 6172 6520  irectory we are 
-00008260: 646f 6e65 2068 6572 650a 2020 2020 2020  done here.      
-00008270: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00008280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008290: 2020 2020 2066 225c 6e4e 4f54 453a 2074       f"\nNOTE: t
-000082a0: 6865 207b 7365 6c66 2e61 7263 6869 7665  he {self.archive
-000082b0: 5f6a 736f 6e5f 6669 6c65 5f6e 616d 657d  _json_file_name}
-000082c0: 2066 696c 6520 7761 7320 666f 756e 6420   file was found 
-000082d0: 696e 2074 6865 2073 6861 7265 6420 636f  in the shared co
-000082e0: 6e66 6967 2064 6972 6563 746f 7279 5c6e  nfig directory\n
-000082f0: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-00008300: 6c73 653a 0a0a 2020 2020 2020 2020 2020  lse:..          
-00008310: 2020 2020 2020 2320 4966 2074 6865 2066        # If the f
-00008320: 726f 7374 6572 2d61 7263 6869 7665 732e  roster-archives.
-00008330: 6a73 6f6e 2066 696c 6520 6973 2066 6f75  json file is fou
-00008340: 6e64 2069 6e20 7468 6520 6c6f 6361 6c20  nd in the local 
-00008350: 6469 7265 6374 6f72 7920 7765 2061 736b  directory we ask
-00008360: 2074 6865 2075 7365 7220 6966 2074 6865   the user if the
-00008370: 7920 7761 6e74 2074 6f20 6d6f 7665 2069  y want to move i
-00008380: 7420 746f 2074 6865 2073 6861 7265 6420  t to the shared 
-00008390: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-000083a0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-000083b0: 7061 7468 2e69 7366 696c 6528 6f73 2e70  path.isfile(os.p
-000083c0: 6174 682e 6a6f 696e 2873 656c 662e 6461  ath.join(self.da
-000083d0: 7461 5f64 6972 2c20 7365 6c66 2e61 7263  ta_dir, self.arc
-000083e0: 6869 7665 5f6a 736f 6e5f 6669 6c65 5f6e  hive_json_file_n
-000083f0: 616d 6529 293a 0a20 2020 2020 2020 2020  ame)):.         
-00008400: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00008410: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00008420: 2020 2020 2020 2020 2020 6622 5c6e 4e4f            f"\nNO
-00008430: 5445 3a20 7468 6520 7b73 656c 662e 6172  TE: the {self.ar
-00008440: 6368 6976 655f 6a73 6f6e 5f66 696c 655f  chive_json_file_
-00008450: 6e61 6d65 7d20 6669 6c65 2077 6173 2066  name} file was f
-00008460: 6f75 6e64 2069 6e20 7468 6520 6c6f 6361  ound in the loca
-00008470: 6c20 6469 7265 6374 6f72 795c 6e22 290a  l directory\n").
-00008480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008490: 2020 2020 2023 2041 736b 2075 7365 7220       # Ask user 
-000084a0: 6966 2074 6865 7920 7761 6e74 2074 6f20  if they want to 
-000084b0: 6d6f 7665 2074 6865 206c 6f63 616c 206c  move the local l
-000084c0: 6973 7420 6f66 2066 696c 6573 2061 6e64  ist of files and
-000084d0: 2064 6972 6563 746f 7269 6573 2074 6861   directories tha
-000084e0: 7420 7765 7265 2061 7263 6869 7665 6420  t were archived 
-000084f0: 746f 2074 6865 2073 6861 7265 6420 6469  to the shared di
-00008500: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
-00008510: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
-00008520: 6c5f 6672 6f73 7465 725f 6172 6368 6976  l_froster_archiv
-00008530: 6573 5f74 6f5f 7368 6172 6564 203d 2069  es_to_shared = i
-00008540: 6e71 7569 7265 722e 636f 6e66 6972 6d28  nquirer.confirm(
-00008550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008560: 2020 2020 2020 2020 206d 6573 7361 6765           message
-00008570: 3d22 446f 2079 6f75 2077 616e 7420 746f  ="Do you want to
-00008580: 206d 6f76 6520 7468 6520 6c6f 6361 6c20   move the local 
-00008590: 6c69 7374 206f 6620 6669 6c65 7320 616e  list of files an
-000085a0: 6420 6469 7265 6374 6f72 6965 7320 7468  d directories th
-000085b0: 6174 2077 6572 6520 6172 6368 6976 6564  at were archived
-000085c0: 2074 6f20 7468 6520 7368 6172 6564 2064   to the shared d
-000085d0: 6972 6563 746f 7279 3f22 2c20 6465 6661  irectory?", defa
-000085e0: 756c 743d 5472 7565 290a 0a20 2020 2020  ult=True)..     
-000085f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00008600: 204d 6f76 6520 7468 6520 6c6f 6361 6c20   Move the local 
-00008610: 6672 6f73 7465 7220 6172 6368 6976 6573  froster archives
-00008620: 2074 6f20 7368 6172 6564 2064 6972 6563   to shared direc
-00008630: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
-00008640: 2020 2020 2020 2020 2069 6620 6c6f 6361           if loca
-00008650: 6c5f 6672 6f73 7465 725f 6172 6368 6976  l_froster_archiv
-00008660: 6573 5f74 6f5f 7368 6172 6564 3a0a 2020  es_to_shared:.  
-00008670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008680: 2020 2020 2020 7368 7574 696c 2e63 6f70        shutil.cop
-00008690: 7928 6f73 2e70 6174 682e 6a6f 696e 280a  y(os.path.join(.
-000086a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000086c0: 2e64 6174 615f 6469 722c 2073 656c 662e  .data_dir, self.
-000086d0: 6172 6368 6976 655f 6a73 6f6e 5f66 696c  archive_json_fil
-000086e0: 655f 6e61 6d65 292c 2073 6861 7265 645f  e_name), shared_
-000086f0: 636f 6e66 6967 5f64 6972 290a 2020 2020  config_dir).    
-00008700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008710: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-00008720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008730: 2020 2020 2020 2066 225c 6e4e 4f54 453a         f"\nNOTE:
-00008740: 204c 6f63 616c 206c 6973 7420 6f66 2061   Local list of a
-00008750: 7263 6869 7665 6420 6669 6c65 7320 616e  rchived files an
-00008760: 6420 6469 7265 6374 6f72 6965 7320 7761  d directories wa
-00008770: 7320 6d6f 7665 6420 746f 207b 7368 6172  s moved to {shar
-00008780: 6564 5f63 6f6e 6669 675f 6469 727d 5c6e  ed_config_dir}\n
-00008790: 2229 0a0a 2020 2020 2020 2020 2320 5365  ")..        # Se
-000087a0: 7420 7468 6520 7368 6172 6564 2066 6c61  t the shared fla
-000087b0: 6720 696e 2074 6865 2063 6f6e 6669 6720  g in the config 
-000087c0: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
-000087d0: 662e 5f5f 7365 745f 636f 6e66 6967 7572  f.__set_configur
-000087e0: 6174 696f 6e5f 656e 7472 7928 2753 4841  ation_entry('SHA
-000087f0: 5245 4427 2c20 2769 735f 7368 6172 6564  RED', 'is_shared
-00008800: 272c 2073 7472 2869 735f 7368 6172 6564  ', str(is_shared
-00008810: 2929 0a0a 2020 2020 2020 2020 2320 5365  ))..        # Se
-00008820: 7420 7468 6520 7368 6172 6564 2064 6972  t the shared dir
-00008830: 6563 746f 7279 2069 6e20 7468 6520 636f  ectory in the co
-00008840: 6e66 6967 2066 696c 6520 616e 6420 6d6f  nfig file and mo
-00008850: 7665 2074 6865 2063 6f6e 6669 6720 6669  ve the config fi
-00008860: 6c65 2073 6861 7265 6420 7365 6374 696f  le shared sectio
-00008870: 6e73 2074 6f20 7468 6520 7368 6172 6564  ns to the shared
-00008880: 2063 6f6e 6669 6720 6669 6c65 0a20 2020   config file.   
-00008890: 2020 2020 2069 6620 6973 5f73 6861 7265       if is_share
-000088a0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-000088b0: 656c 662e 5f5f 7365 745f 636f 6e66 6967  elf.__set_config
-000088c0: 7572 6174 696f 6e5f 656e 7472 7928 0a20  uration_entry(. 
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000088e0: 5348 4152 4544 272c 2027 7368 6172 6564  SHARED', 'shared
-000088f0: 5f64 6972 272c 2073 6861 7265 645f 636f  _dir', shared_co
-00008900: 6e66 6967 5f64 6972 290a 2020 2020 2020  nfig_dir).      
-00008910: 2020 2020 2020 7365 6c66 2e5f 5f73 6574        self.__set
-00008920: 5f63 6f6e 6669 6775 7261 7469 6f6e 5f65  _configuration_e
-00008930: 6e74 7279 2827 5348 4152 4544 272c 2027  ntry('SHARED', '
-00008940: 7368 6172 6564 5f63 6f6e 6669 675f 6669  shared_config_fi
-00008950: 6c65 272c 206f 732e 7061 7468 2e6a 6f69  le', os.path.joi
-00008960: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00008970: 2020 2073 6861 7265 645f 636f 6e66 6967     shared_config
-00008980: 5f64 6972 2c20 7365 6c66 2e73 6861 7265  _dir, self.share
-00008990: 645f 636f 6e66 6967 5f66 696c 655f 6e61  d_config_file_na
-000089a0: 6d65 2929 0a20 2020 2020 2020 2020 2020  me)).           
-000089b0: 2073 656c 662e 5f5f 7365 745f 7368 6172   self.__set_shar
-000089c0: 6564 5f6d 6f76 655f 636f 6e66 6967 2829  ed_move_config()
-000089d0: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-000089e0: 6627 2a2a 2a20 5348 4152 4544 2043 4f4e  f'*** SHARED CON
-000089f0: 4649 4755 5241 5449 4f4e 2044 4f4e 4520  FIGURATION DONE 
-00008a00: 2a2a 2a5c 6e27 290a 0a20 2020 2064 6566  ***\n')..    def
-00008a10: 205f 5f73 6574 5f73 6861 7265 645f 6d6f   __set_shared_mo
-00008a20: 7665 5f63 6f6e 6669 6728 7365 6c66 293a  ve_config(self):
-00008a30: 0a20 2020 2020 2020 2027 2727 4d6f 7665  .        '''Move
-00008a40: 2074 6865 206c 6f63 616c 2063 6f6e 6669   the local confi
-00008a50: 6775 7261 7469 6f6e 2073 6563 7469 6f6e  guration section
-00008a60: 7320 746f 2074 6865 2073 6861 7265 6420  s to the shared 
-00008a70: 636f 6e66 6967 7572 6174 696f 6e20 6669  configuration fi
-00008a80: 6c65 2727 270a 0a20 2020 2020 2020 2023  le'''..        #
-00008a90: 2049 6620 7368 6172 6564 2063 6f6e 6669   If shared confi
-00008aa0: 6775 7261 7469 6f6e 2066 696c 6520 6578  guration file ex
-00008ab0: 6973 7473 2c20 6e6f 7468 696e 6720 746f  ists, nothing to
-00008ac0: 206d 6f76 650a 2020 2020 2020 2020 6966   move.        if
-00008ad0: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
-00008ae0: 7368 6172 6564 5f63 6f6e 6669 675f 6669  shared_config_fi
-00008af0: 6c65 2729 2061 6e64 206f 732e 7061 7468  le') and os.path
-00008b00: 2e69 7366 696c 6528 7365 6c66 2e73 6861  .isfile(self.sha
-00008b10: 7265 645f 636f 6e66 6967 5f66 696c 6529  red_config_file)
-00008b20: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00008b30: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-00008b40: 2020 2020 2066 224e 4f54 453a 2055 7369       f"NOTE: Usi
-00008b50: 6e67 2073 6861 7265 6420 636f 6e66 6967  ng shared config
-00008b60: 7572 6174 696f 6e20 6669 6c65 2066 6f75  uration file fou
-00008b70: 6e64 2069 6e20 7b73 656c 662e 7368 6172  nd in {self.shar
-00008b80: 6564 5f63 6f6e 6669 675f 6669 6c65 7d5c  ed_config_file}\
-00008b90: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00008ba0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-00008bb0: 2320 436c 6561 6e20 7570 2062 6f74 6820  # Clean up both 
-00008bc0: 636f 6e66 6967 7572 6174 696f 6e20 6669  configuration fi
-00008bd0: 6c65 730a 2020 2020 2020 2020 6c6f 6361  les.        loca
-00008be0: 6c5f 636f 6e66 6967 203d 2063 6f6e 6669  l_config = confi
-00008bf0: 6770 6172 7365 722e 436f 6e66 6967 5061  gparser.ConfigPa
-00008c00: 7273 6572 2829 0a20 2020 2020 2020 206c  rser().        l
-00008c10: 6f63 616c 5f63 6f6e 6669 672e 7265 6164  ocal_config.read
-00008c20: 2873 656c 662e 636f 6e66 6967 5f66 696c  (self.config_fil
-00008c30: 6529 0a0a 2020 2020 2020 2020 6966 206e  e)..        if n
-00008c40: 6f74 2027 4e49 4827 2069 6e20 6c6f 6361  ot 'NIH' in loca
-00008c50: 6c5f 636f 6e66 6967 2061 6e64 206e 6f74  l_config and not
-00008c60: 2027 5333 2720 696e 206c 6f63 616c 5f63   'S3' in local_c
-00008c70: 6f6e 6669 6720 616e 6420 6e6f 7420 2753  onfig and not 'S
-00008c80: 4c55 524d 2720 696e 206c 6f63 616c 5f63  LURM' in local_c
-00008c90: 6f6e 6669 673a 0a20 2020 2020 2020 2020  onfig:.         
-00008ca0: 2020 2023 204e 6f74 6869 6e67 2074 6f20     # Nothing to 
-00008cb0: 636f 7079 2066 726f 6d20 6c6f 6361 6c20  copy from local 
-00008cc0: 636f 6e66 6967 7572 6174 696f 6e20 746f  configuration to
-00008cd0: 2073 6861 7265 6420 636f 6e66 6967 7572   shared configur
-00008ce0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00008cf0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00008d00: 2020 6d6f 7665 5f63 6f6e 6669 675f 746f    move_config_to
-00008d10: 5f73 6861 7265 6420 3d20 696e 7175 6972  _shared = inquir
-00008d20: 6572 2e63 6f6e 6669 726d 280a 2020 2020  er.confirm(.    
-00008d30: 2020 2020 2020 2020 6d65 7373 6167 653d          message=
-00008d40: 2244 6f20 796f 7520 7761 6e74 2074 6f20  "Do you want to 
-00008d50: 6d6f 7665 2079 6f75 7220 6375 7272 656e  move your curren
-00008d60: 7420 636f 6e66 6967 7572 6174 696f 6e20  t configuration 
-00008d70: 746f 2074 6865 2073 6861 7265 6420 6469  to the shared di
-00008d80: 7265 6374 6f72 793f 222c 2064 6566 6175  rectory?", defau
-00008d90: 6c74 3d54 7275 6529 0a0a 2020 2020 2020  lt=True)..      
-00008da0: 2020 6966 206d 6f76 655f 636f 6e66 6967    if move_config
-00008db0: 5f74 6f5f 7368 6172 6564 3a0a 2020 2020  _to_shared:.    
-00008dc0: 2020 2020 2020 2020 7368 7574 696c 2e63          shutil.c
-00008dd0: 6f70 7928 7365 6c66 2e63 6f6e 6669 675f  opy(self.config_
-00008de0: 6669 6c65 2c20 7365 6c66 2e73 6861 7265  file, self.share
-00008df0: 645f 636f 6e66 6967 5f66 696c 6529 0a20  d_config_file). 
-00008e00: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00008e10: 2822 4e4f 5445 3a20 5368 6172 6564 2063  ("NOTE: Shared c
-00008e20: 6f6e 6669 6775 7261 7469 6f6e 2066 696c  onfiguration fil
-00008e30: 6520 7761 7320 6d6f 7665 6420 746f 2074  e was moved to t
-00008e40: 6865 2073 6861 7265 6420 6469 7265 6374  he shared direct
-00008e50: 6f72 795c 6e22 290a 0a20 2020 2020 2020  ory\n")..       
-00008e60: 2020 2020 2073 6861 7265 645f 636f 6e66       shared_conf
-00008e70: 6967 203d 2063 6f6e 6669 6770 6172 7365  ig = configparse
-00008e80: 722e 436f 6e66 6967 5061 7273 6572 2829  r.ConfigParser()
-00008e90: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-00008ea0: 7265 645f 636f 6e66 6967 2e72 6561 6428  red_config.read(
-00008eb0: 7365 6c66 2e73 6861 7265 645f 636f 6e66  self.shared_conf
-00008ec0: 6967 5f66 696c 6529 0a0a 2020 2020 2020  ig_file)..      
-00008ed0: 2020 2020 2020 2320 5265 6d6f 7665 2073        # Remove s
-00008ee0: 6563 7469 6f6e 7320 6672 6f6d 206c 6f63  ections from loc
-00008ef0: 616c 5f63 6f6e 6669 670a 2020 2020 2020  al_config.      
-00008f00: 2020 2020 2020 6966 2027 4e49 4827 2069        if 'NIH' i
-00008f10: 6e20 6c6f 6361 6c5f 636f 6e66 6967 3a0a  n local_config:.
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 6c6f 6361 6c5f 636f 6e66 6967 2e72 656d  local_config.rem
-00008f40: 6f76 655f 7365 6374 696f 6e28 274e 4948  ove_section('NIH
-00008f50: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-00008f60: 6620 2753 3327 2069 6e20 6c6f 6361 6c5f  f 'S3' in local_
-00008f70: 636f 6e66 6967 3a0a 2020 2020 2020 2020  config:.        
-00008f80: 2020 2020 2020 2020 6c6f 6361 6c5f 636f          local_co
-00008f90: 6e66 6967 2e72 656d 6f76 655f 7365 6374  nfig.remove_sect
-00008fa0: 696f 6e28 2753 3327 290a 2020 2020 2020  ion('S3').      
-00008fb0: 2020 2020 2020 6966 2027 534c 5552 4d27        if 'SLURM'
-00008fc0: 2069 6e20 6c6f 6361 6c5f 636f 6e66 6967   in local_config
-00008fd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008fe0: 2020 6c6f 6361 6c5f 636f 6e66 6967 2e72    local_config.r
-00008ff0: 656d 6f76 655f 7365 6374 696f 6e28 2753  emove_section('S
-00009000: 4c55 524d 2729 0a0a 2020 2020 2020 2020  LURM')..        
-00009010: 2020 2020 2320 5265 6d6f 7665 2073 6563      # Remove sec
-00009020: 7469 6f6e 7320 6672 6f6d 2073 6861 7265  tions from share
-00009030: 645f 636f 6e66 6967 0a20 2020 2020 2020  d_config.       
-00009040: 2020 2020 2069 6620 2755 5345 5227 2069       if 'USER' i
-00009050: 6e20 7368 6172 6564 5f63 6f6e 6669 673a  n shared_config:
-00009060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009070: 2073 6861 7265 645f 636f 6e66 6967 2e72   shared_config.r
-00009080: 656d 6f76 655f 7365 6374 696f 6e28 2755  emove_section('U
-00009090: 5345 5227 290a 2020 2020 2020 2020 2020  SER').          
-000090a0: 2020 6966 2027 4157 5327 2069 6e20 7368    if 'AWS' in sh
-000090b0: 6172 6564 5f63 6f6e 6669 673a 0a20 2020  ared_config:.   
-000090c0: 2020 2020 2020 2020 2020 2020 2073 6861               sha
-000090d0: 7265 645f 636f 6e66 6967 2e72 656d 6f76  red_config.remov
-000090e0: 655f 7365 6374 696f 6e28 2741 5753 2729  e_section('AWS')
-000090f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009100: 2753 4841 5245 4427 2069 6e20 7368 6172  'SHARED' in shar
-00009110: 6564 5f63 6f6e 6669 673a 0a20 2020 2020  ed_config:.     
-00009120: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00009130: 645f 636f 6e66 6967 2e72 656d 6f76 655f  d_config.remove_
-00009140: 7365 6374 696f 6e28 2753 4841 5245 4427  section('SHARED'
-00009150: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00009160: 2057 7269 7465 2074 6865 2073 6f75 7263   Write the sourc
-00009170: 6520 494e 4920 6669 6c65 0a20 2020 2020  e INI file.     
-00009180: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00009190: 2873 656c 662e 636f 6e66 6967 5f66 696c  (self.config_fil
-000091a0: 652c 2027 7727 2920 6173 2066 3a0a 2020  e, 'w') as f:.  
-000091b0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000091c0: 6361 6c5f 636f 6e66 6967 2e77 7269 7465  cal_config.write
-000091d0: 2866 290a 0a20 2020 2020 2020 2020 2020  (f)..           
-000091e0: 2023 2057 7269 7465 2074 6865 2073 6f75   # Write the sou
-000091f0: 7263 6520 494e 4920 6669 6c65 0a20 2020  rce INI file.   
-00009200: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00009210: 656e 2873 656c 662e 7368 6172 6564 5f63  en(self.shared_c
-00009220: 6f6e 6669 675f 6669 6c65 2c20 2777 2729  onfig_file, 'w')
-00009230: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-00009240: 2020 2020 2020 2073 6861 7265 645f 636f         shared_co
-00009250: 6e66 6967 2e77 7269 7465 2866 290a 0a20  nfig.write(f).. 
-00009260: 2020 2064 6566 2073 6574 5f75 7365 7228     def set_user(
-00009270: 7365 6c66 293a 0a0a 2020 2020 2020 2020  self):..        
-00009280: 7072 696e 7428 6627 5c6e 2a2a 2a20 5553  print(f'\n*** US
-00009290: 4552 2043 4f4e 4649 4755 5241 5449 4f4e  ER CONFIGURATION
-000092a0: 202a 2a2a 5c6e 2729 0a0a 2020 2020 2020   ***\n')..      
-000092b0: 2020 2320 4173 6b20 7468 6520 7573 6572    # Ask the user
-000092c0: 2066 6f72 2074 6865 6972 2066 756c 6c20   for their full 
-000092d0: 6e61 6d65 0a20 2020 2020 2020 2066 756c  name.        ful
-000092e0: 6c6e 616d 6520 3d20 696e 7175 6972 6572  lname = inquirer
-000092f0: 2e74 6578 7428 0a20 2020 2020 2020 2020  .text(.         
-00009300: 2020 206d 6573 7361 6765 3d22 456e 7465     message="Ente
-00009310: 7220 796f 7572 2066 756c 6c20 6e61 6d65  r your full name
-00009320: 222c 2076 616c 6964 6174 653d 7365 6c66  ", validate=self
-00009330: 2e5f 5f69 6e71 7569 7265 725f 6368 6563  .__inquirer_chec
-00009340: 6b5f 7265 7175 6972 6564 290a 0a20 2020  k_required)..   
-00009350: 2020 2020 2023 2050 7269 6e74 2066 6f72       # Print for
-00009360: 2061 206e 6577 206c 696e 6520 7768 656e   a new line when
-00009370: 2070 726f 6d70 7469 6e67 0a20 2020 2020   prompting.     
-00009380: 2020 2070 7269 6e74 2829 0a0a 2020 2020     print()..    
-00009390: 2020 2020 2320 5365 7420 7468 6520 7573      # Set the us
-000093a0: 6572 2773 2066 756c 6c20 6e61 6d65 2069  er's full name i
-000093b0: 6e20 7468 6520 636f 6e66 6967 2066 696c  n the config fil
-000093c0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-000093d0: 5f73 6574 5f63 6f6e 6669 6775 7261 7469  _set_configurati
-000093e0: 6f6e 5f65 6e74 7279 2827 5553 4552 272c  on_entry('USER',
-000093f0: 2027 6e61 6d65 272c 2066 756c 6c6e 616d   'name', fullnam
-00009400: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
-00009410: 6b20 7468 6520 7573 6572 2066 6f72 2074  k the user for t
-00009420: 6865 6972 2065 6d61 696c 0a20 2020 2020  heir email.     
-00009430: 2020 2065 6d61 696c 203d 2069 6e71 7569     email = inqui
-00009440: 7265 722e 7465 7874 286d 6573 7361 6765  rer.text(message
-00009450: 3d22 456e 7465 7220 796f 7572 2065 6d61  ="Enter your ema
-00009460: 696c 222c 0a20 2020 2020 2020 2020 2020  il",.           
-00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009480: 2020 2076 616c 6964 6174 653d 7365 6c66     validate=self
-00009490: 2e5f 5f69 6e71 7569 7265 725f 6368 6563  .__inquirer_chec
-000094a0: 6b5f 656d 6169 6c5f 666f 726d 6174 290a  k_email_format).
-000094b0: 0a20 2020 2020 2020 2023 2050 7269 6e74  .        # Print
-000094c0: 2066 6f72 2061 206e 6577 206c 696e 6520   for a new line 
-000094d0: 7768 656e 2070 726f 6d70 7469 6e67 0a20  when prompting. 
-000094e0: 2020 2020 2020 2070 7269 6e74 2829 0a0a         print()..
-000094f0: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
-00009500: 6520 7573 6572 2773 2065 6d61 696c 2069  e user's email i
-00009510: 6e20 7468 6520 636f 6e66 6967 2066 696c  n the config fil
-00009520: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00009530: 5f73 6574 5f63 6f6e 6669 6775 7261 7469  _set_configurati
-00009540: 6f6e 5f65 6e74 7279 2827 5553 4552 272c  on_entry('USER',
-00009550: 2027 656d 6169 6c27 2c20 656d 6169 6c29   'email', email)
-00009560: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00009570: 6627 2a2a 2a20 5553 4552 2043 4f4e 4649  f'*** USER CONFI
-00009580: 4755 5241 5449 4f4e 2044 4f4e 4520 2a2a  GURATION DONE **
-00009590: 2a5c 6e27 290a 0a20 2020 2064 6566 2073  *\n')..    def s
-000095a0: 6574 5f73 6c75 726d 2873 656c 662c 2061  et_slurm(self, a
-000095b0: 7267 7329 3a0a 0a20 2020 2020 2020 2069  rgs):..        i
-000095c0: 6620 7368 7574 696c 2e77 6869 6368 2827  f shutil.which('
-000095d0: 7363 6f6e 7472 6f6c 2729 2061 6e64 2073  scontrol') and s
-000095e0: 6875 7469 6c2e 7768 6963 6828 2773 6163  hutil.which('sac
-000095f0: 6374 6d67 7227 293a 0a0a 2020 2020 2020  ctmgr'):..      
-00009600: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
-00009610: 2a2a 2a20 534c 5552 4d20 434f 4e46 4947  *** SLURM CONFIG
-00009620: 5552 4154 494f 4e20 2a2a 2a5c 6e27 290a  URATION ***\n').
-00009630: 0a20 2020 2020 2020 2020 2020 2073 6c75  .            slu
-00009640: 726d 5f77 616c 6c74 696d 655f 6461 7973  rm_walltime_days
-00009650: 203d 2069 6e71 7569 7265 722e 7465 7874   = inquirer.text
-00009660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00009670: 2020 6d65 7373 6167 653d 2253 6574 2074    message="Set t
-00009680: 6865 2053 6c75 726d 202d 2d74 696d 6520  he Slurm --time 
-00009690: 2864 6179 7329 2066 6f72 2066 726f 7374  (days) for frost
-000096a0: 6572 206a 6f62 7320 2873 7567 6765 7374  er jobs (suggest
-000096b0: 6564 203d 2037 2922 2c20 7661 6c69 6461  ed = 7)", valida
-000096c0: 7465 3d73 656c 662e 5f5f 696e 7175 6972  te=self.__inquir
-000096d0: 6572 5f63 6865 636b 5f69 735f 656d 7074  er_check_is_empt
-000096e0: 795f 6f72 5f6e 756d 6265 7229 0a0a 2020  y_or_number)..  
-000096f0: 2020 2020 2020 2020 2020 736c 7572 6d5f            slurm_
-00009700: 7761 6c6c 7469 6d65 5f68 6f75 7273 203d  walltime_hours =
-00009710: 2069 6e71 7569 7265 722e 7465 7874 280a   inquirer.text(.
-00009720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009730: 6d65 7373 6167 653d 2253 6574 2074 6865  message="Set the
-00009740: 2053 6c75 726d 202d 2d74 696d 6520 2868   Slurm --time (h
-00009750: 6f75 7273 2920 666f 7220 6672 6f73 7465  ours) for froste
-00009760: 7220 6a6f 6273 2028 7375 6767 6573 7465  r jobs (suggeste
-00009770: 6420 3d20 3029 222c 2076 616c 6964 6174  d = 0)", validat
-00009780: 653d 7365 6c66 2e5f 5f69 6e71 7569 7265  e=self.__inquire
-00009790: 725f 6368 6563 6b5f 6973 5f65 6d70 7479  r_check_is_empty
-000097a0: 5f6f 725f 6e75 6d62 6572 290a 0a20 2020  _or_number)..   
-000097b0: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
-000097c0: 2054 6869 7320 636c 6173 7320 5f5f 696e   This class __in
-000097d0: 6974 5f5f 2073 686f 756c 6420 6e6f 7420  it__ should not 
-000097e0: 6265 2068 6572 652c 2069 7420 7368 6f75  be here, it shou
-000097f0: 6c64 2062 6520 696e 2074 6865 206d 6169  ld be in the mai
-00009800: 6e0a 2020 2020 2020 2020 2020 2020 7365  n.            se
-00009810: 203d 2053 6c75 726d 4573 7365 6e74 6961   = SlurmEssentia
-00009820: 6c73 2861 7267 732c 2073 656c 6629 0a0a  ls(args, self)..
-00009830: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-00009840: 7420 7468 6520 616c 6c6f 7765 6420 7061  t the allowed pa
-00009850: 7274 6974 696f 6e73 2061 6e64 2051 4f53  rtitions and QOS
-00009860: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00009870: 7473 203d 2073 652e 6765 745f 616c 6c6f  ts = se.get_allo
-00009880: 7765 645f 7061 7274 6974 696f 6e73 5f61  wed_partitions_a
-00009890: 6e64 5f71 6f73 2829 0a0a 2020 2020 2020  nd_qos()..      
-000098a0: 2020 2020 2020 2320 4173 6b20 7468 6520        # Ask the 
-000098b0: 7573 6572 2074 6f20 7365 6c65 6374 2074  user to select t
-000098c0: 6865 2053 6c75 726d 2070 6172 7469 7469  he Slurm partiti
-000098d0: 6f6e 2061 6e64 2051 4f53 0a20 2020 2020  on and QOS.     
-000098e0: 2020 2020 2020 2073 6c75 726d 5f70 6172         slurm_par
-000098f0: 7469 7469 6f6e 203d 2069 6e71 7569 7265  tition = inquire
-00009900: 722e 6c69 7374 5f69 6e70 7574 280a 2020  r.list_input(.  
-00009910: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00009920: 7373 6167 653d 6627 5365 6c65 6374 2074  ssage=f'Select t
-00009930: 6865 2053 6c75 726d 2070 6172 7469 7469  he Slurm partiti
-00009940: 6f6e 2066 6f72 206a 6f62 7320 7468 6174  on for jobs that
-00009950: 206c 6173 7420 7570 2074 6f20 7b73 6c75   last up to {slu
-00009960: 726d 5f77 616c 6c74 696d 655f 6461 7973  rm_walltime_days
-00009970: 7d20 6461 7973 2061 6e64 207b 736c 7572  } days and {slur
-00009980: 6d5f 7761 6c6c 7469 6d65 5f68 6f75 7273  m_walltime_hours
-00009990: 7d20 686f 7572 7327 2c0a 2020 2020 2020  } hours',.      
-000099a0: 2020 2020 2020 2020 2020 6368 6f69 6365            choice
-000099b0: 733d 6c69 7374 2870 6172 7473 2e6b 6579  s=list(parts.key
-000099c0: 7328 2929 290a 0a20 2020 2020 2020 2020  s()))..         
-000099d0: 2020 2023 2041 736b 2074 6865 2075 7365     # Ask the use
-000099e0: 7220 746f 2073 656c 6563 7420 7468 6520  r to select the 
-000099f0: 536c 7572 6d20 514f 530a 2020 2020 2020  Slurm QOS.      
-00009a00: 2020 2020 2020 736c 7572 6d5f 716f 7320        slurm_qos 
-00009a10: 3d20 696e 7175 6972 6572 2e6c 6973 745f  = inquirer.list_
-00009a20: 696e 7075 7428 0a20 2020 2020 2020 2020  input(.         
-00009a30: 2020 2020 2020 206d 6573 7361 6765 3d66         message=f
-00009a40: 2753 656c 6563 7420 7468 6520 536c 7572  'Select the Slur
-00009a50: 6d20 514f 5320 666f 7220 6a6f 6273 2074  m QOS for jobs t
-00009a60: 6861 7420 6c61 7374 2075 7020 746f 207b  hat last up to {
-00009a70: 736c 7572 6d5f 7761 6c6c 7469 6d65 5f64  slurm_walltime_d
-00009a80: 6179 737d 2064 6179 7320 616e 6420 7b73  ays} days and {s
-00009a90: 6c75 726d 5f77 616c 6c74 696d 655f 686f  lurm_walltime_ho
-00009aa0: 7572 737d 2068 6f75 7273 272c 0a20 2020  urs} hours',.   
-00009ab0: 2020 2020 2020 2020 2020 2020 2063 686f               cho
-00009ac0: 6963 6573 3d6c 6973 7428 7061 7274 735b  ices=list(parts[
-00009ad0: 736c 7572 6d5f 7061 7274 6974 696f 6e5d  slurm_partition]
-00009ae0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00009af0: 2320 5365 7420 7468 6520 536c 7572 6d20  # Set the Slurm 
-00009b00: 636f 6e66 6967 7572 6174 696f 6e20 696e  configuration in
-00009b10: 2074 6865 2063 6f6e 6669 6720 6669 6c65   the config file
-00009b20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009b30: 662e 5f5f 7365 745f 636f 6e66 6967 7572  f.__set_configur
-00009b40: 6174 696f 6e5f 656e 7472 7928 0a20 2020  ation_entry(.   
-00009b50: 2020 2020 2020 2020 2020 2020 2027 534c               'SL
-00009b60: 5552 4d27 2c20 2773 6c75 726d 5f77 616c  URM', 'slurm_wal
-00009b70: 6c74 696d 655f 6461 7973 272c 2073 6c75  ltime_days', slu
-00009b80: 726d 5f77 616c 6c74 696d 655f 6461 7973  rm_walltime_days
-00009b90: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00009ba0: 6c66 2e5f 5f73 6574 5f63 6f6e 6669 6775  lf.__set_configu
-00009bb0: 7261 7469 6f6e 5f65 6e74 7279 280a 2020  ration_entry(.  
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2753                'S
-00009bd0: 4c55 524d 272c 2027 736c 7572 6d5f 7761  LURM', 'slurm_wa
-00009be0: 6c6c 7469 6d65 5f68 6f75 7273 272c 2073  lltime_hours', s
-00009bf0: 6c75 726d 5f77 616c 6c74 696d 655f 686f  lurm_walltime_ho
-00009c00: 7572 7329 0a20 2020 2020 2020 2020 2020  urs).           
-00009c10: 2073 656c 662e 5f5f 7365 745f 636f 6e66   self.__set_conf
-00009c20: 6967 7572 6174 696f 6e5f 656e 7472 7928  iguration_entry(
-00009c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009c40: 2027 534c 5552 4d27 2c20 2773 6c75 726d   'SLURM', 'slurm
-00009c50: 5f70 6172 7469 7469 6f6e 272c 2073 6c75  _partition', slu
-00009c60: 726d 5f70 6172 7469 7469 6f6e 290a 2020  rm_partition).  
-00009c70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009c80: 5f73 6574 5f63 6f6e 6669 6775 7261 7469  _set_configurati
-00009c90: 6f6e 5f65 6e74 7279 2827 534c 5552 4d27  on_entry('SLURM'
-00009ca0: 2c20 2773 6c75 726d 5f71 6f73 272c 2073  , 'slurm_qos', s
-00009cb0: 6c75 726d 5f71 6f73 290a 0a20 2020 2020  lurm_qos)..     
-00009cc0: 2020 2020 2020 2023 2054 4f44 4f3a 2049         # TODO: I
-00009cd0: 7320 7468 6973 2073 6875 7469 6c20 7362  s this shutil sb
-00009ce0: 6174 6368 206e 6563 6573 7361 7279 3f0a  atch necessary?.
-00009cf0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00009d00: 6875 7469 6c2e 7768 6963 6828 2773 6261  hutil.which('sba
-00009d10: 7463 6827 293a 0a20 2020 2020 2020 2020  tch'):.         
-00009d20: 2020 2020 2020 2073 6c75 726d 5f6c 7363         slurm_lsc
-00009d30: 7261 7463 6820 3d20 696e 7175 6972 6572  ratch = inquirer
-00009d40: 2e74 6578 7428 0a20 2020 2020 2020 2020  .text(.         
-00009d50: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-00009d60: 6765 3d22 486f 7720 646f 2079 6f75 2072  ge="How do you r
-00009d70: 6571 7565 7374 206c 6f63 616c 2073 6372  equest local scr
-00009d80: 6174 6368 2066 726f 6d20 536c 7572 6d3f  atch from Slurm?
-00009d90: 2028 4f70 7469 6f6e 616c 3a20 7072 6573   (Optional: pres
-00009da0: 7320 656e 7465 7220 746f 2073 6b69 7029  s enter to skip)
-00009db0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00009dc0: 2020 206c 7363 7261 7463 685f 6d6b 6469     lscratch_mkdi
-00009dd0: 7220 3d20 696e 7175 6972 6572 2e74 6578  r = inquirer.tex
-00009de0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00009df0: 2020 2020 2020 206d 6573 7361 6765 3d22         message="
-00009e00: 4973 2074 6865 7265 2061 2075 7365 7220  Is there a user 
-00009e10: 7363 7269 7074 2074 6861 7420 7072 6f76  script that prov
-00009e20: 6973 696f 6e73 206c 6f63 616c 2073 6372  isions local scr
-00009e30: 6174 6368 3f20 284f 7074 696f 6e61 6c3a  atch? (Optional:
-00009e40: 2070 7265 7373 2065 6e74 6572 2074 6f20   press enter to 
-00009e50: 736b 6970 2922 290a 2020 2020 2020 2020  skip)").        
-00009e60: 2020 2020 2020 2020 6c73 6372 6174 6368          lscratch
-00009e70: 5f72 6d64 6972 203d 2069 6e71 7569 7265  _rmdir = inquire
-00009e80: 722e 7465 7874 280a 2020 2020 2020 2020  r.text(.        
-00009e90: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-00009ea0: 6167 653d 2249 7320 7468 6572 6520 6120  age="Is there a 
-00009eb0: 7573 6572 2073 6372 6970 7420 7468 6174  user script that
-00009ec0: 2074 6561 7273 2064 6f77 6e20 6c6f 6361   tears down loca
-00009ed0: 6c20 7363 7261 7463 6820 6174 2074 6865  l scratch at the
-00009ee0: 2065 6e64 3f20 284f 7074 696f 6e61 6c3a   end? (Optional:
-00009ef0: 2070 7265 7373 2065 6e74 6572 2074 6f20   press enter to 
-00009f00: 736b 6970 2922 290a 2020 2020 2020 2020  skip)").        
-00009f10: 2020 2020 2020 2020 6c73 6372 6174 6368          lscratch
-00009f20: 5f72 6f6f 7420 3d20 696e 7175 6972 6572  _root = inquirer
-00009f30: 2e74 6578 7428 0a20 2020 2020 2020 2020  .text(.         
-00009f40: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-00009f50: 6765 3d22 5768 6174 2069 7320 7468 6520  ge="What is the 
-00009f60: 6c6f 6361 6c20 7363 7261 7463 6820 726f  local scratch ro
-00009f70: 6f74 3f20 284f 7074 696f 6e61 6c3a 2070  ot? (Optional: p
-00009f80: 7265 7373 2065 6e74 6572 2074 6f20 736b  ress enter to sk
-00009f90: 6970 2922 290a 0a20 2020 2020 2020 2020  ip)")..         
-00009fa0: 2020 2020 2020 2073 656c 662e 5f5f 7365         self.__se
-00009fb0: 745f 636f 6e66 6967 7572 6174 696f 6e5f  t_configuration_
-00009fc0: 656e 7472 7928 0a20 2020 2020 2020 2020  entry(.         
-00009fd0: 2020 2020 2020 2020 2020 2027 534c 5552             'SLUR
-00009fe0: 4d27 2c20 2773 6c75 726d 5f6c 7363 7261  M', 'slurm_lscra
-00009ff0: 7463 6827 2c20 736c 7572 6d5f 6c73 6372  tch', slurm_lscr
-0000a000: 6174 6368 290a 2020 2020 2020 2020 2020  atch).          
-0000a010: 2020 2020 2020 7365 6c66 2e5f 5f73 6574        self.__set
-0000a020: 5f63 6f6e 6669 6775 7261 7469 6f6e 5f65  _configuration_e
-0000a030: 6e74 7279 280a 2020 2020 2020 2020 2020  ntry(.          
-0000a040: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
-0000a050: 272c 2027 6c73 6372 6174 6368 5f6d 6b64  ', 'lscratch_mkd
-0000a060: 6972 272c 206c 7363 7261 7463 685f 6d6b  ir', lscratch_mk
-0000a070: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
-0000a080: 2020 2020 2073 656c 662e 5f5f 7365 745f       self.__set_
-0000a090: 636f 6e66 6967 7572 6174 696f 6e5f 656e  configuration_en
-0000a0a0: 7472 7928 0a20 2020 2020 2020 2020 2020  try(.           
-0000a0b0: 2020 2020 2020 2020 2027 534c 5552 4d27           'SLURM'
-0000a0c0: 2c20 276c 7363 7261 7463 685f 726d 6469  , 'lscratch_rmdi
-0000a0d0: 7227 2c20 6c73 6372 6174 6368 5f72 6d64  r', lscratch_rmd
-0000a0e0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-0000a0f0: 2020 2020 7365 6c66 2e5f 5f73 6574 5f63      self.__set_c
-0000a100: 6f6e 6669 6775 7261 7469 6f6e 5f65 6e74  onfiguration_ent
-0000a110: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
-0000a120: 2020 2020 2020 2020 2753 4c55 524d 272c          'SLURM',
-0000a130: 2027 6c73 6372 6174 6368 5f72 6f6f 7427   'lscratch_root'
-0000a140: 2c20 6c73 6372 6174 6368 5f72 6f6f 7429  , lscratch_root)
-0000a150: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000a160: 696e 7428 6627 5c6e 2a2a 2a20 534c 5552  int(f'\n*** SLUR
-0000a170: 4d20 434f 4e46 4947 5552 4154 494f 4e20  M CONFIGURATION 
-0000a180: 444f 4e45 202a 2a2a 5c6e 2729 0a0a 2020  DONE ***\n')..  
-0000a190: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a1a0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-0000a1b0: 5c6e 2a2a 2a20 534c 5552 4d20 4e4f 5420  \n*** SLURM NOT 
-0000a1c0: 464f 554e 443a 204e 6f74 6869 6e67 2074  FOUND: Nothing t
-0000a1d0: 6f20 636f 6e66 6967 7572 6520 2a2a 2a5c  o configure ***\
-0000a1e0: 6e27 290a 0a0a 636c 6173 7320 4172 6368  n')...class Arch
-0000a1f0: 6976 6572 3a0a 0a20 2020 2064 6566 205f  iver:..    def _
-0000a200: 5f69 6e69 745f 5f28 7365 6c66 2c20 6172  _init__(self, ar
-0000a210: 6773 3a20 6172 6770 6172 7365 2e4e 616d  gs: argparse.Nam
-0000a220: 6573 7061 6365 2c20 6366 673a 2043 6f6e  espace, cfg: Con
-0000a230: 6669 674d 616e 6167 6572 293a 0a20 2020  figManager):.   
-0000a240: 2020 2020 2073 656c 662e 6172 6773 203d       self.args =
-0000a250: 2061 7267 730a 0a20 2020 2020 2020 2073   args..        s
-0000a260: 656c 662e 6366 6720 3d20 6366 670a 0a20  elf.cfg = cfg.. 
-0000a270: 2020 2020 2020 2073 656c 662e 6172 6368         self.arch
-0000a280: 6976 655f 6a73 6f6e 203d 2063 6667 2e61  ive_json = cfg.a
-0000a290: 7263 6869 7665 5f6a 736f 6e0a 0a20 2020  rchive_json..   
-0000a2a0: 2020 2020 2078 203d 2063 6667 2e6d 6178       x = cfg.max
-0000a2b0: 5f73 6d61 6c6c 5f66 696c 655f 7369 7a65  _small_file_size
-0000a2c0: 5f6b 6962 0a20 2020 2020 2020 2073 656c  _kib.        sel
-0000a2d0: 662e 7468 7265 7368 6f6c 644b 4220 3d20  f.thresholdKB = 
-0000a2e0: 696e 7428 7829 2069 6620 7820 656c 7365  int(x) if x else
-0000a2f0: 2031 3032 340a 0a20 2020 2020 2020 2078   1024..        x
-0000a300: 203d 2063 6667 2e6d 696e 5f69 6e64 6578   = cfg.min_index
-0000a310: 5f66 6f6c 6465 725f 7369 7a65 5f67 6962  _folder_size_gib
-0000a320: 0a20 2020 2020 2020 2073 656c 662e 7468  .        self.th
-0000a330: 7265 7368 6f6c 6447 4220 3d20 696e 7428  resholdGB = int(
-0000a340: 7829 2069 6620 7820 656c 7365 2031 300a  x) if x else 10.
-0000a350: 0a20 2020 2020 2020 2078 203d 2063 6667  .        x = cfg
-0000a360: 2e6d 696e 5f69 6e64 6578 5f66 6f6c 6465  .min_index_folde
-0000a370: 725f 7369 7a65 5f61 7667 5f6d 6962 0a20  r_size_avg_mib. 
-0000a380: 2020 2020 2020 2073 656c 662e 7468 7265         self.thre
-0000a390: 7368 6f6c 644d 4220 3d20 696e 7428 7829  sholdMB = int(x)
-0000a3a0: 2069 6620 7820 656c 7365 2031 300a 0a20   if x else 10.. 
-0000a3b0: 2020 2020 2020 2078 203d 2063 6667 2e6d         x = cfg.m
-0000a3c0: 6178 5f68 6f74 7370 6f74 735f 6469 7370  ax_hotspots_disp
-0000a3d0: 6c61 795f 656e 7472 6965 730a 2020 2020  lay_entries.    
-0000a3e0: 2020 2020 676c 6f62 616c 204d 4158 484f      global MAXHO
-0000a3f0: 5453 504f 5453 0a20 2020 2020 2020 204d  TSPOTS.        M
-0000a400: 4158 484f 5453 504f 5453 203d 2069 6e74  AXHOTSPOTS = int
-0000a410: 2878 2920 6966 2078 2065 6c73 6520 3530  (x) if x else 50
-0000a420: 3030 0a0a 2020 2020 2020 2020 7365 6c66  00..        self
-0000a430: 2e73 6d61 6c6c 6669 6c65 735f 7461 725f  .smallfiles_tar_
-0000a440: 6669 6c65 6e61 6d65 203d 2027 4672 6f73  filename = 'Fros
-0000a450: 7465 722e 736d 616c 6c66 696c 6573 2e74  ter.smallfiles.t
-0000a460: 6172 270a 2020 2020 2020 2020 7365 6c66  ar'.        self
-0000a470: 2e61 6c6c 6669 6c65 735f 6373 765f 6669  .allfiles_csv_fi
-0000a480: 6c65 6e61 6d65 203d 2027 4672 6f73 7465  lename = 'Froste
-0000a490: 722e 616c 6c66 696c 6573 2e63 7376 270a  r.allfiles.csv'.
-0000a4a0: 2020 2020 2020 2020 7365 6c66 2e6d 6435          self.md5
-0000a4b0: 7375 6d5f 6669 6c65 6e61 6d65 203d 2027  sum_filename = '
-0000a4c0: 2e66 726f 7374 6572 2e6d 6435 7375 6d27  .froster.md5sum'
-0000a4d0: 0a20 2020 2020 2020 2073 656c 662e 6d64  .        self.md
-0000a4e0: 3573 756d 5f72 6573 746f 7265 645f 6669  5sum_restored_fi
-0000a4f0: 6c65 6e61 6d65 203d 2027 2e66 726f 7374  lename = '.frost
-0000a500: 6572 2d72 6573 746f 7265 642e 6d64 3573  er-restored.md5s
-0000a510: 756d 270a 2020 2020 2020 2020 7365 6c66  um'.        self
-0000a520: 2e77 6865 7265 5f64 6964 5f74 6865 5f66  .where_did_the_f
-0000a530: 696c 6573 5f67 6f5f 6669 6c65 6e61 6d65  iles_go_filename
-0000a540: 203d 2027 5768 6572 652d 6469 642d 7468   = 'Where-did-th
-0000a550: 652d 6669 6c65 732d 676f 2e74 7874 270a  e-files-go.txt'.
-0000a560: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
-0000a570: 726d 6574 6166 696c 6573 203d 205b 7365  rmetafiles = [se
-0000a580: 6c66 2e61 6c6c 6669 6c65 735f 6373 765f  lf.allfiles_csv_
-0000a590: 6669 6c65 6e61 6d65 2c0a 2020 2020 2020  filename,.      
-0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5b0: 2020 2020 2020 2073 656c 662e 736d 616c         self.smal
-0000a5c0: 6c66 696c 6573 5f74 6172 5f66 696c 656e  lfiles_tar_filen
-0000a5d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0000a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5f0: 2020 7365 6c66 2e6d 6435 7375 6d5f 6669    self.md5sum_fi
-0000a600: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a620: 2020 2020 2073 656c 662e 6d64 3573 756d       self.md5sum
-0000a630: 5f72 6573 746f 7265 645f 6669 6c65 6e61  _restored_filena
-0000a640: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a660: 2073 656c 662e 7768 6572 655f 6469 645f   self.where_did_
-0000a670: 7468 655f 6669 6c65 735f 676f 5f66 696c  the_files_go_fil
-0000a680: 656e 616d 655d 0a0a 2020 2020 2020 2020  ename]..        
-0000a690: 7365 6c66 2e67 7261 6e74 7320 3d20 5b5d  self.grants = []
-0000a6a0: 0a0a 2020 2020 6465 6620 5f69 6e64 6578  ..    def _index
-0000a6b0: 5f6c 6f63 616c 6c79 2873 656c 662c 2066  _locally(self, f
-0000a6c0: 6f6c 6465 7229 3a0a 2020 2020 2020 2020  older):.        
-0000a6d0: 2727 2749 6e64 6578 2074 6865 2067 6976  '''Index the giv
-0000a6e0: 656e 2066 6f6c 6465 7220 666f 7220 6172  en folder for ar
-0000a6f0: 6368 6976 696e 6727 2727 0a0a 2020 2020  chiving'''..    
-0000a700: 2020 2020 2320 6d6f 7665 2064 6f77 6e20      # move down 
-0000a710: 746f 2063 6c61 7373 0a20 2020 2020 2020  to class.       
-0000a720: 2064 6179 7361 6765 6420 3d20 5b35 3437   daysaged = [547
-0000a730: 352c 2033 3635 302c 2031 3832 352c 2031  5, 3650, 1825, 1
-0000a740: 3039 352c 2037 3330 2c20 3336 352c 2039  095, 730, 365, 9
-0000a750: 302c 2033 305d 0a20 2020 2020 2020 2054  0, 30].        T
-0000a760: 6942 203d 2031 3039 3935 3131 3632 3737  iB = 10995116277
-0000a770: 3736 0a20 2020 2020 2020 2023 2047 6942  76.        # GiB
-0000a780: 3d31 3037 3337 3431 3832 340a 2020 2020  =1073741824.    
-0000a790: 2020 2020 2320 4d69 423d 3130 3438 3537      # MiB=104857
-0000a7a0: 360a 0a20 2020 2020 2020 2023 2049 6620  6..        # If 
-0000a7b0: 7077 616c 6b63 6f70 7920 6c6f 6361 7469  pwalkcopy locati
-0000a7c0: 6f6e 2070 726f 7669 6465 642c 2072 756e  on provided, run
-0000a7d0: 2070 7761 6c6b 2061 6e64 2063 6f70 7920   pwalk and copy 
-0000a7e0: 7468 6520 6f75 7470 7574 2074 6f20 7468  the output to th
-0000a7f0: 6520 7370 6563 6966 6965 6420 6c6f 6361  e specified loca
-0000a800: 7469 6f6e 2065 7665 7279 2074 696d 650a  tion every time.
-0000a810: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000a820: 6172 6773 2e70 7761 6c6b 636f 7079 3a0a  args.pwalkcopy:.
-0000a830: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000a840: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000a850: 2020 2066 275c 6e49 6e64 6578 696e 6720     f'\nIndexing 
-0000a860: 666f 6c64 6572 2022 7b66 6f6c 6465 727d  folder "{folder}
-0000a870: 2220 616e 6420 636f 7079 696e 6720 6f75  " and copying ou
-0000a880: 7470 7574 2074 6f20 7b73 656c 662e 6172  tput to {self.ar
-0000a890: 6773 2e70 7761 6c6b 636f 7079 7d2e 2e2e  gs.pwalkcopy}...
-0000a8a0: 272c 2066 6c75 7368 3d54 7275 6529 0a20  ', flush=True). 
-0000a8b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a8c0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0000a8d0: 275c 6e49 6e64 6578 696e 6720 666f 6c64  '\nIndexing fold
-0000a8e0: 6572 2022 7b66 6f6c 6465 727d 222e 2e2e  er "{folder}"...
-0000a8f0: 272c 2066 6c75 7368 3d54 7275 6529 0a0a  ', flush=True)..
-0000a900: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-0000a910: 7420 7468 6520 7061 7468 2074 6f20 7468  t the path to th
-0000a920: 6520 686f 7473 706f 7473 2043 5356 2066  e hotspots CSV f
-0000a930: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-0000a940: 666f 6c64 6572 5f68 6f74 7370 6f74 203d  folder_hotspot =
-0000a950: 2073 656c 662e 6765 745f 686f 7473 706f   self.get_hotspo
-0000a960: 7473 5f70 6174 6828 666f 6c64 6572 290a  ts_path(folder).
-0000a970: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0000a980: 6620 7468 6520 666f 6c64 6572 2069 7320  f the folder is 
-0000a990: 616c 7265 6164 7920 696e 6465 7865 6420  already indexed 
-0000a9a0: 646f 6e27 7420 7275 6e20 7077 616c 6b20  don't run pwalk 
-0000a9b0: 6167 6169 6e0a 2020 2020 2020 2020 2020  again.          
-0000a9c0: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-0000a9d0: 696c 6528 666f 6c64 6572 5f68 6f74 7370  ile(folder_hotsp
-0000a9e0: 6f74 293a 0a20 2020 2020 2020 2020 2020  ot):.           
-0000a9f0: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa10: 6627 2020 2020 2e2e 2e66 6f6c 6465 7220  f'    ...folder 
-0000aa20: 616c 7265 6164 7920 696e 6465 7865 6420  already indexed 
-0000aa30: 6174 207b 666f 6c64 6572 5f68 6f74 7370  at {folder_hotsp
-0000aa40: 6f74 7d5c 6e27 290a 2020 2020 2020 2020  ot}\n').        
-0000aa50: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0000aa60: 2020 2020 2020 2020 2320 5275 6e20 7077          # Run pw
-0000aa70: 616c 6b20 6f6e 2067 6976 656e 2066 6f6c  alk on given fol
-0000aa80: 6465 720a 2020 2020 2020 2020 7769 7468  der.        with
-0000aa90: 2074 656d 7066 696c 652e 4e61 6d65 6454   tempfile.NamedT
-0000aaa0: 656d 706f 7261 7279 4669 6c65 2829 2061  emporaryFile() a
-0000aab0: 7320 7077 616c 6b5f 6f75 7470 7574 3a0a  s pwalk_output:.
-0000aac0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000aad0: 2074 656d 7066 696c 652e 4e61 6d65 6454   tempfile.NamedT
-0000aae0: 656d 706f 7261 7279 4669 6c65 2829 2061  emporaryFile() a
-0000aaf0: 7320 7077 616c 6b5f 6f75 7470 7574 5f66  s pwalk_output_f
-0000ab00: 6f6c 6465 7273 3a0a 2020 2020 2020 2020  olders:.        
-0000ab10: 2020 2020 2020 2020 7769 7468 2074 656d          with tem
-0000ab20: 7066 696c 652e 4e61 6d65 6454 656d 706f  pfile.NamedTempo
-0000ab30: 7261 7279 4669 6c65 2829 2061 7320 7077  raryFile() as pw
-0000ab40: 616c 6b5f 6f75 7470 7574 5f66 6f6c 6465  alk_output_folde
-0000ab50: 7273 5f63 6f6e 7665 7274 6564 3a0a 0a20  rs_converted:.. 
-0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab70: 2020 2023 2042 7569 6c64 2074 6865 2070     # Build the p
-0000ab80: 7761 6c6b 2063 6f6d 6d61 6e64 0a20 2020  walk command.   
-0000ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aba0: 2070 7761 6c6b 5f62 696e 203d 206f 732e   pwalk_bin = os.
-0000abb0: 7061 7468 2e6a 6f69 6e28 7379 732e 7072  path.join(sys.pr
-0000abc0: 6566 6978 2c20 2762 696e 272c 2027 7077  efix, 'bin', 'pw
-0000abd0: 616c 6b27 290a 2020 2020 2020 2020 2020  alk').          
-0000abe0: 2020 2020 2020 2020 2020 7077 616c 6b63            pwalkc
-0000abf0: 6d64 203d 2066 277b 7077 616c 6b5f 6269  md = f'{pwalk_bi
-0000ac00: 6e7d 202d 2d4e 6f53 6e61 7020 2d2d 6f6e  n} --NoSnap --on
-0000ac10: 652d 6669 6c65 2d73 7973 7465 6d20 2d2d  e-file-system --
-0000ac20: 6865 6164 6572 270a 2020 2020 2020 2020  header'.        
-0000ac30: 2020 2020 2020 2020 2020 2020 6d79 636d              mycm
-0000ac40: 6420 3d20 6627 7b70 7761 6c6b 636d 647d  d = f'{pwalkcmd}
-0000ac50: 2022 7b66 6f6c 6465 727d 2220 3e20 7b70   "{folder}" > {p
-0000ac60: 7761 6c6b 5f6f 7574 7075 742e 6e61 6d65  walk_output.name
-0000ac70: 7d27 0a0a 2020 2020 2020 2020 2020 2020  }'..            
-0000ac80: 2020 2020 2020 2020 2320 5275 6e20 7468          # Run th
-0000ac90: 6520 7077 616c 6b20 636f 6d6d 616e 640a  e pwalk command.
-0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acb0: 2020 2020 7265 7420 3d20 7375 6270 726f      ret = subpro
-0000acc0: 6365 7373 2e72 756e 286d 7963 6d64 2c20  cess.run(mycmd, 
-0000acd0: 7368 656c 6c3d 5472 7565 2c0a 2020 2020  shell=True,.    
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad00: 2020 2020 2073 7464 6f75 743d 7375 6270       stdout=subp
-0000ad10: 726f 6365 7373 2e50 4950 452c 2073 7464  rocess.PIPE, std
-0000ad20: 6572 723d 7375 6270 726f 6365 7373 2e50  err=subprocess.P
-0000ad30: 4950 4529 0a0a 2020 2020 2020 2020 2020  IPE)..          
-0000ad40: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-0000ad50: 6b20 6966 2074 6865 2070 7761 6c6b 2063  k if the pwalk c
-0000ad60: 6f6d 6d61 6e64 2077 6173 2073 7563 6365  ommand was succe
-0000ad70: 7373 6675 6c0a 2020 2020 2020 2020 2020  ssful.          
-0000ad80: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-0000ad90: 2e72 6574 7572 6e63 6f64 6520 213d 2030  .returncode != 0
-0000ada0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000adb0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000adc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000add0: 2020 2020 2020 2020 2020 2020 2066 225c               f"\
-0000ade0: 6e45 7272 6f72 3a20 636f 6d6d 616e 6420  nError: command 
-0000adf0: 7b6d 7963 6d64 7d20 6661 696c 6564 2077  {mycmd} failed w
-0000ae00: 6974 6820 7265 7475 726e 636f 6465 207b  ith returncode {
-0000ae10: 7265 742e 7265 7475 726e 636f 6465 7d5c  ret.returncode}\
-0000ae20: 6e22 2c20 6669 6c65 3d73 7973 2e73 7464  n", file=sys.std
-0000ae30: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-0000ae40: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0000ae50: 2e65 7869 7428 3129 0a0a 2020 2020 2020  .exit(1)..      
-0000ae60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000ae70: 4966 2070 7761 6c6b 636f 7079 206c 6f63  If pwalkcopy loc
-0000ae80: 6174 696f 6e20 7072 6f76 6964 6564 2c20  ation provided, 
-0000ae90: 7468 656e 2063 6f70 7920 7468 6520 7077  then copy the pw
-0000aea0: 616c 6b20 6f75 7470 7574 2066 696c 6520  alk output file 
-0000aeb0: 746f 2074 6865 2073 7065 6369 6669 6564  to the specified
-0000aec0: 206c 6f63 6174 696f 6e0a 2020 2020 2020   location.      
-0000aed0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000aee0: 2073 656c 662e 6172 6773 2e70 7761 6c6b   self.args.pwalk
-0000aef0: 636f 7079 3a0a 0a20 2020 2020 2020 2020  copy:..         
-0000af00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000af10: 6f70 795f 6669 6c65 6e61 6d65 203d 2066  opy_filename = f
-0000af20: 6f6c 6465 722e 7265 706c 6163 6528 272f  older.replace('/
-0000af30: 272c 2027 2b27 2920 2b20 272e 6373 7627  ', '+') + '.csv'
-0000af40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af50: 2020 2020 2020 2020 2063 6f70 795f 6669           copy_fi
-0000af60: 6c65 5f70 6174 6820 3d20 6f73 2e70 6174  le_path = os.pat
-0000af70: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
-0000af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af90: 2020 2020 7365 6c66 2e61 7267 732e 7077      self.args.pw
-0000afa0: 616c 6b63 6f70 792c 2063 6f70 795f 6669  alkcopy, copy_fi
-0000afb0: 6c65 6e61 6d65 290a 0a20 2020 2020 2020  lename)..       
-0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afd0: 2023 2042 7569 6c64 2074 6865 2063 6f70   # Build the cop
-0000afe0: 7920 636f 6d6d 616e 640a 2020 2020 2020  y command.      
-0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 2020 6d79 636d 6420 3d20 6627 6963 6f6e    mycmd = f'icon
-0000b010: 7620 2d66 2049 534f 2d38 3835 392d 3120  v -f ISO-8859-1 
-0000b020: 2d74 2055 5446 2d38 207b 7077 616c 6b5f  -t UTF-8 {pwalk_
-0000b030: 6f75 7470 7574 2e6e 616d 657d 202d 6f20  output.name} -o 
-0000b040: 7b63 6f70 795f 6669 6c65 5f70 6174 687d  {copy_file_path}
-0000b050: 270a 0a20 2020 2020 2020 2020 2020 2020  '..             
-0000b060: 2020 2020 2020 2020 2020 2023 2052 756e             # Run
-0000b070: 2074 6865 2063 6f70 7920 636f 6d6d 616e   the copy comman
-0000b080: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000b090: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000b0a0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
-0000b0b0: 6e28 6d79 636d 642c 2073 6865 6c6c 3d54  n(mycmd, shell=T
-0000b0c0: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
-0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000b0e0: 4368 6563 6b20 6966 2074 6865 2063 6f70  Check if the cop
-0000b0f0: 7920 636f 6d6d 616e 6420 7761 7320 7375  y command was su
-0000b100: 6363 6573 7366 756c 0a20 2020 2020 2020  ccessful.       
-0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b120: 2069 6620 7265 7375 6c74 2e72 6574 7572   if result.retur
-0000b130: 6e63 6f64 6520 213d 2030 3a0a 2020 2020  ncode != 0:.    
-0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b150: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b170: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b180: 225c 6e45 7272 6f72 3a20 636f 6d6d 616e  "\nError: comman
-0000b190: 6420 7b6d 7963 6d64 7d20 6661 696c 6564  d {mycmd} failed
-0000b1a0: 2077 6974 6820 7265 7475 726e 636f 6465   with returncode
-0000b1b0: 207b 7265 7375 6c74 2e72 6574 7572 6e63   {result.returnc
-0000b1c0: 6f64 657d 5c6e 222c 2066 696c 653d 7379  ode}\n", file=sy
-0000b1d0: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-0000b200: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000b210: 2020 2020 2020 2023 2042 7569 6c64 2074         # Build t
-0000b220: 6865 2066 696c 6573 2072 656d 6f76 696e  he files removin
-0000b230: 6720 636f 6d6d 616e 640a 2020 2020 2020  g command.      
-0000b240: 2020 2020 2020 2020 2020 2020 2020 6d79                my
-0000b250: 636d 6420 3d20 6627 6772 6570 202d 7620  cmd = f'grep -v 
-0000b260: 222c 2d31 2c30 2422 2022 7b70 7761 6c6b  ",-1,0$" "{pwalk
-0000b270: 5f6f 7574 7075 742e 6e61 6d65 7d22 203e  _output.name}" >
-0000b280: 207b 7077 616c 6b5f 6f75 7470 7574 5f66   {pwalk_output_f
-0000b290: 6f6c 6465 7273 2e6e 616d 657d 270a 0a20  olders.name}'.. 
-0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2b0: 2020 2023 2052 756e 2074 6865 2066 696c     # Run the fil
-0000b2c0: 6573 2072 656d 6f76 696e 6720 636f 6d6d  es removing comm
-0000b2d0: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-0000b2e0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000b2f0: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
-0000b300: 6d79 636d 642c 2073 6865 6c6c 3d54 7275  mycmd, shell=Tru
-0000b310: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0000b320: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0000b330: 6966 2074 6865 2066 696c 6573 2072 656d  if the files rem
-0000b340: 6f76 696e 6720 636f 6d6d 616e 6420 7761  oving command wa
-0000b350: 7320 7375 6363 6573 7366 756c 0a20 2020  s successful.   
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 2069 6620 7265 7375 6c74 2e72 6574 7572   if result.retur
-0000b380: 6e63 6f64 6520 213d 2030 3a0a 2020 2020  ncode != 0:.    
-0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3a0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3c0: 2020 2020 2020 2066 225c 6e45 7272 6f72         f"\nError
-0000b3d0: 3a20 636f 6d6d 616e 6420 7b6d 7963 6d64  : command {mycmd
-0000b3e0: 7d20 6661 696c 6564 2077 6974 6820 7265  } failed with re
-0000b3f0: 7475 726e 636f 6465 207b 7265 7375 6c74  turncode {result
-0000b400: 2e72 6574 7572 6e63 6f64 657d 5c6e 222c  .returncode}\n",
-0000b410: 2066 696c 653d 7379 732e 7374 6465 7272   file=sys.stderr
-0000b420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b430: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-0000b440: 6974 2831 290a 0a20 2020 2020 2020 2020  it(1)..         
-0000b450: 2020 2020 2020 2020 2020 2023 2057 4f52             # WOR
-0000b460: 4b41 524f 554e 443a 2043 6f6e 7665 7274  KAROUND: Convert
-0000b470: 696e 6720 6669 6c65 2066 726f 6d20 4953  ing file from IS
-0000b480: 4f2d 3838 3539 2d31 2074 6f20 7574 662d  O-8859-1 to utf-
-0000b490: 3820 746f 2061 766f 6964 2044 7563 6b44  8 to avoid DuckD
-0000b4a0: 4220 696d 706f 7274 2065 7272 6f72 0a20  B import error. 
-0000b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4c0: 2020 2023 2070 7761 6c6b 2064 6f65 7320     # pwalk does 
-0000b4d0: 616c 7265 6164 7920 6f75 7470 7574 2055  already output U
-0000b4e0: 5446 2d38 2c20 7765 6972 642c 2070 726f  TF-8, weird, pro
-0000b4f0: 6261 626c 7920 6475 636b 6462 2065 7272  bably duckdb err
-0000b500: 6f72 0a0a 2020 2020 2020 2020 2020 2020  or..            
-0000b510: 2020 2020 2020 2020 2320 4275 696c 6420          # Build 
-0000b520: 7468 6520 6669 6c65 2063 6f6e 7665 7273  the file convers
-0000b530: 696f 6e20 636f 6d6d 616e 640a 2020 2020  ion command.    
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 6d79 636d 6420 3d20 6627 6963 6f6e 7620  mycmd = f'iconv 
-0000b560: 2d66 2049 534f 2d38 3835 392d 3120 2d74  -f ISO-8859-1 -t
-0000b570: 2055 5446 2d38 207b 7077 616c 6b5f 6f75   UTF-8 {pwalk_ou
-0000b580: 7470 7574 5f66 6f6c 6465 7273 2e6e 616d  tput_folders.nam
-0000b590: 657d 202d 6f20 7b70 7761 6c6b 5f6f 7574  e} -o {pwalk_out
-0000b5a0: 7075 745f 666f 6c64 6572 735f 636f 6e76  put_folders_conv
-0000b5b0: 6572 7465 642e 6e61 6d65 7d27 0a0a 2020  erted.name}'..  
-0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5d0: 2020 2320 5275 6e20 7468 6520 6669 6c65    # Run the file
-0000b5e0: 2063 6f6e 7665 7273 696f 6e20 636f 6d6d   conversion comm
-0000b5f0: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-0000b600: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000b610: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
-0000b620: 6d79 636d 642c 2073 6865 6c6c 3d54 7275  mycmd, shell=Tru
-0000b630: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0000b640: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0000b650: 6966 2074 6865 2066 696c 6520 636f 6e76  if the file conv
-0000b660: 6572 7369 6f6e 2063 6f6d 6d61 6e64 2077  ersion command w
-0000b670: 6173 2073 7563 6365 7373 6675 6c0a 2020  as successful.  
-0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b690: 2020 6966 2072 6573 756c 742e 7265 7475    if result.retu
-0000b6a0: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
-0000b6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6c0: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 2020 2020 6622 5c6e 4572 726f          f"\nErro
-0000b6f0: 723a 2063 6f6d 6d61 6e64 207b 6d79 636d  r: command {mycm
-0000b700: 647d 2066 6169 6c65 6420 7769 7468 2072  d} failed with r
-0000b710: 6574 7572 6e63 6f64 6520 7b72 6573 756c  eturncode {resul
-0000b720: 742e 7265 7475 726e 636f 6465 7d5c 6e22  t.returncode}\n"
-0000b730: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
-0000b740: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-0000b750: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0000b760: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
-0000b770: 2020 2020 2020 2020 2020 2020 2320 4275              # Bu
-0000b780: 696c 6420 7468 6520 5351 4c20 7175 6572  ild the SQL quer
-0000b790: 7920 6f6e 2074 6865 2043 5356 2066 696c  y on the CSV fil
-0000b7a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000b7b0: 2020 2020 2020 7371 6c5f 7175 6572 7920        sql_query 
-0000b7c0: 3d20 6622 2222 5345 4c45 4354 2055 4944  = f"""SELECT UID
-0000b7d0: 2061 7320 5573 6572 2c0a 2020 2020 2020   as User,.      
-0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7f0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0000b800: 5f61 7469 6d65 2061 7320 4163 6344 2c20  _atime as AccD, 
-0000b810: 7374 5f6d 7469 6d65 2061 7320 4d6f 6444  st_mtime as ModD
-0000b820: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b840: 2020 2020 2020 7077 5f64 6972 7375 6d2f        pw_dirsum/
-0000b850: 3130 3733 3734 3138 3234 2061 7320 4769  1073741824 as Gi
-0000b860: 422c 0a20 2020 2020 2020 2020 2020 2020  B,.             
+00005820: 2020 2020 6177 735f 7365 6372 6574 5f61      aws_secret_a
+00005830: 6363 6573 735f 6b65 793d 6177 735f 7365  ccess_key=aws_se
+00005840: 6372 6574 5f61 6363 6573 735f 6b65 7929  cret_access_key)
+00005850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005860: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+00005870: 202e 2e2e 4157 5320 6372 6564 656e 7469   ...AWS credenti
+00005880: 616c 7320 6172 6520 7661 6c69 645c 6e27  als are valid\n'
+00005890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000058a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000058b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000058c0: 7428 2720 2020 202e 2e2e 4157 5320 6372  t('    ...AWS cr
+000058d0: 6564 656e 7469 616c 7320 6172 6520 4e4f  edentials are NO
+000058e0: 5420 7661 6c69 645c 6e27 290a 2020 2020  T valid\n').    
+000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005900: 7072 696e 7428 275c 6e59 6f75 2063 616e  print('\nYou can
+00005910: 2063 6f6e 6669 6775 7265 2061 7773 2063   configure aws c
+00005920: 7265 6465 6e74 6961 6c73 2075 7369 6e67  redentials using
+00005930: 2074 6865 2063 6f6d 6d61 6e64 3a27 290a   the command:').
+00005940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005950: 2020 2020 7072 696e 7428 2720 2020 2066      print('    f
+00005960: 726f 7374 6572 2063 6f6e 6669 6720 2d2d  roster config --
+00005970: 6177 735c 6e27 290a 2020 2020 2020 2020  aws\n').        
+00005980: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00005990: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+000059a0: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+000059b0: 6c69 7374 206f 6620 4157 5320 7265 6769  list of AWS regi
+000059c0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+000059d0: 2020 2020 6177 735f 7265 6769 6f6e 7320      aws_regions 
+000059e0: 3d20 6177 732e 6765 745f 7265 6769 6f6e  = aws.get_region
+000059f0: 7328 290a 0a20 2020 2020 2020 2020 2020  s()..           
+00005a00: 2020 2020 2023 2041 736b 2075 7365 7220       # Ask user 
+00005a10: 746f 2063 686f 6f73 6520 6120 7265 6769  to choose a regi
+00005a20: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00005a30: 2020 2072 6567 696f 6e20 3d20 696e 7175     region = inqu
+00005a40: 6972 6572 2e6c 6973 745f 696e 7075 7428  irer.list_input(
+00005a50: 2243 686f 6f73 6520 796f 7572 2072 6567  "Choose your reg
+00005a60: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a90: 2020 2063 686f 6963 6573 3d61 7773 5f72     choices=aws_r
+00005aa0: 6567 696f 6e73 290a 0a20 2020 2020 2020  egions)..       
+00005ab0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00005ac0: 5c6e 4368 6563 6b69 6e67 2072 6567 696f  \nChecking regio
+00005ad0: 6e2e 2e2e 2229 0a20 2020 2020 2020 2020  n...").         
+00005ae0: 2020 2020 2020 2069 6620 6177 732e 6368         if aws.ch
+00005af0: 6563 6b5f 6372 6564 656e 7469 616c 7328  eck_credentials(
+00005b00: 6177 735f 6163 6365 7373 5f6b 6579 5f69  aws_access_key_i
+00005b10: 643d 6177 735f 6163 6365 7373 5f6b 6579  d=aws_access_key
+00005b20: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2020 2020 2020 2020 2020 2020 6177                aw
+00005b50: 735f 7365 6372 6574 5f61 6363 6573 735f  s_secret_access_
+00005b60: 6b65 793d 6177 735f 7365 6372 6574 5f61  key=aws_secret_a
+00005b70: 6363 6573 735f 6b65 792c 0a20 2020 2020  ccess_key,.     
+00005b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ba0: 2020 2020 6177 735f 7265 6769 6f6e 5f6e      aws_region_n
+00005bb0: 616d 653d 7265 6769 6f6e 293a 0a20 2020  ame=region):.   
+00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bd0: 2070 7269 6e74 2827 2020 2020 2e2e 2e72   print('    ...r
+00005be0: 6567 696f 6e20 6973 2076 616c 6964 5c6e  egion is valid\n
+00005bf0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00005c00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00005c10: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00005c20: 6e74 2827 2020 2020 2e2e 2e72 6567 696f  nt('    ...regio
+00005c30: 6e20 6973 204e 4f54 2076 616c 6964 5c6e  n is NOT valid\n
+00005c40: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00005c50: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00005c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c70: 2020 2020 2020 275c 6e59 6f75 2063 616e        '\nYou can
+00005c80: 2063 6f6e 6669 6775 7265 2061 7773 2063   configure aws c
+00005c90: 7265 6465 6e74 6961 6c73 2061 6e64 2072  redentials and r
+00005ca0: 6567 696f 6e20 7573 696e 6720 7468 6520  egion using the 
+00005cb0: 636f 6d6d 616e 643a 2729 0a20 2020 2020  command:').     
+00005cc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00005cd0: 7269 6e74 2827 2020 2020 6672 6f73 7465  rint('    froste
+00005ce0: 7220 636f 6e66 6967 202d 2d61 7773 5c6e  r config --aws\n
+00005cf0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00005d00: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00005d10: 6c73 650a 0a20 2020 2020 2020 2020 2020  lse..           
+00005d20: 2020 2020 2023 2043 7265 6174 6520 6e65       # Create ne
+00005d30: 7720 7072 6f66 696c 6520 696e 207e 2f2e  w profile in ~/.
+00005d40: 6177 732f 6372 6564 656e 7469 616c 730a  aws/credentials.
+00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d60: 7365 6c66 2e5f 5f73 6574 5f61 7773 5f63  self.__set_aws_c
+00005d70: 7265 6465 6e74 6961 6c73 2861 7773 5f70  redentials(aws_p
+00005d80: 726f 6669 6c65 5f6e 616d 653d 6177 735f  rofile_name=aws_
+00005d90: 6e65 775f 7072 6f66 696c 655f 6e61 6d65  new_profile_name
+00005da0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 2020 2020 2020 2020 2061 7773               aws
+00005dd0: 5f61 6363 6573 735f 6b65 795f 6964 3d61  _access_key_id=a
+00005de0: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
+00005df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e10: 2020 2020 2020 2020 2020 2020 2061 7773               aws
+00005e20: 5f73 6563 7265 745f 6163 6365 7373 5f6b  _secret_access_k
+00005e30: 6579 3d61 7773 5f73 6563 7265 745f 6163  ey=aws_secret_ac
+00005e40: 6365 7373 5f6b 6579 290a 0a20 2020 2020  cess_key)..     
+00005e50: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
+00005e60: 6174 6520 6e65 7720 7072 6f66 696c 6520  ate new profile 
+00005e70: 696e 207e 2f2e 6177 732f 636f 6e66 6967  in ~/.aws/config
+00005e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005e90: 2073 656c 662e 5f5f 7365 745f 6177 735f   self.__set_aws_
+00005ea0: 636f 6e66 6967 2861 7773 5f70 726f 6669  config(aws_profi
+00005eb0: 6c65 5f6e 616d 653d 6177 735f 6e65 775f  le_name=aws_new_
+00005ec0: 7072 6f66 696c 655f 6e61 6d65 2c0a 2020  profile_name,.  
+00005ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ef0: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
+00005f00: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
+00005f10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005f20: 2020 2020 2020 2320 4558 4953 5449 4e47        # EXISTING
+00005f30: 2050 524f 4649 4c45 2043 4f4e 4649 4755   PROFILE CONFIGU
+00005f40: 5241 5449 4f4e 0a0a 2020 2020 2020 2020  RATION..        
+00005f50: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00005f60: 6966 2074 6865 2070 726f 7669 6465 6420  if the provided 
+00005f70: 6177 7320 6372 6564 656e 7469 616c 7320  aws credentials 
+00005f80: 6172 6520 7661 6c69 640a 2020 2020 2020  are valid.      
+00005f90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00005fa0: 225c 6e43 6865 636b 696e 6720 4157 5320  "\nChecking AWS 
+00005fb0: 6372 6564 656e 7469 616c 732e 2e2e 2229  credentials...")
+00005fc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005fd0: 2020 6966 2061 7773 2e63 6865 636b 5f63    if aws.check_c
+00005fe0: 7265 6465 6e74 6961 6c73 2861 7773 5f70  redentials(aws_p
+00005ff0: 726f 6669 6c65 3d61 7773 5f70 726f 6669  rofile=aws_profi
+00006000: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00006010: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00006020: 2020 2020 2e2e 2e41 5753 2063 7265 6465      ...AWS crede
+00006030: 6e74 6961 6c73 2061 7265 2076 616c 6964  ntials are valid
+00006040: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+00006050: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00006060: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006070: 7269 6e74 2827 2020 2020 2e2e 2e41 5753  rint('    ...AWS
+00006080: 2063 7265 6465 6e74 6961 6c73 2061 7265   credentials are
+00006090: 204e 4f54 2076 616c 6964 5c6e 2729 0a20   NOT valid\n'). 
+000060a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060b0: 2020 2070 7269 6e74 2827 5c6e 436f 6e66     print('\nConf
+000060c0: 6967 7572 6520 6e65 7720 6177 7320 6372  igure new aws cr
+000060d0: 6564 656e 7469 616c 7320 7573 696e 6720  edentials using 
+000060e0: 7468 6520 636f 6d6d 616e 643a 2729 0a20  the command:'). 
+000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006100: 2020 2070 7269 6e74 2827 2020 2020 6672     print('    fr
+00006110: 6f73 7465 7220 636f 6e66 6967 202d 2d61  oster config --a
+00006120: 7773 5c6e 2729 0a20 2020 2020 2020 2020  ws\n').         
+00006130: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006140: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
+00006150: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00006160: 2074 6865 2073 656c 6574 6563 7465 6420   the seletected 
+00006170: 7072 6f66 696c 6520 7265 6769 6f6e 0a20  profile region. 
+00006180: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00006190: 7773 5f70 726f 6669 6c65 5f72 6567 696f  ws_profile_regio
+000061a0: 6e20 3d20 7365 6c66 2e5f 5f73 6574 5f61  n = self.__set_a
+000061b0: 7773 5f67 6574 5f63 6f6e 6669 675f 7265  ws_get_config_re
+000061c0: 6769 6f6e 280a 2020 2020 2020 2020 2020  gion(.          
+000061d0: 2020 2020 2020 2020 2020 6177 735f 7072            aws_pr
+000061e0: 6f66 696c 653d 6177 735f 7072 6f66 696c  ofile=aws_profil
+000061f0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00006200: 2020 2020 2320 4765 7420 6c69 7374 206f      # Get list o
+00006210: 6620 4157 5320 7265 6769 6f6e 730a 2020  f AWS regions.  
+00006220: 2020 2020 2020 2020 2020 2020 2020 6177                aw
+00006230: 735f 7265 6769 6f6e 7320 3d20 6177 732e  s_regions = aws.
+00006240: 6765 745f 7265 6769 6f6e 7328 290a 0a20  get_regions().. 
+00006250: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00006260: 2041 736b 2075 7365 7220 746f 2063 686f   Ask user to cho
+00006270: 6f73 6520 6120 7265 6769 6f6e 0a20 2020  ose a region.   
+00006280: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+00006290: 696f 6e20 3d20 696e 7175 6972 6572 2e6c  ion = inquirer.l
+000062a0: 6973 745f 696e 7075 7428 2243 686f 6f73  ist_input("Choos
+000062b0: 6520 796f 7572 2072 6567 696f 6e22 2c0a  e your region",.
+000062c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062e0: 2020 2020 2020 2020 2020 2020 2064 6566               def
+000062f0: 6175 6c74 3d61 7773 5f70 726f 6669 6c65  ault=aws_profile
+00006300: 5f72 6567 696f 6e2c 0a20 2020 2020 2020  _region,.       
+00006310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006330: 2020 2020 2020 6368 6f69 6365 733d 6177        choices=aw
+00006340: 735f 7265 6769 6f6e 7329 0a0a 2020 2020  s_regions)..    
+00006350: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00006360: 7428 225c 6e43 6865 636b 696e 6720 7265  t("\nChecking re
+00006370: 6769 6f6e 2e2e 2e22 290a 2020 2020 2020  gion...").      
+00006380: 2020 2020 2020 2020 2020 6966 2061 7773            if aws
+00006390: 2e63 6865 636b 5f63 7265 6465 6e74 6961  .check_credentia
+000063a0: 6c73 2861 7773 5f70 726f 6669 6c65 3d61  ls(aws_profile=a
+000063b0: 7773 5f70 726f 6669 6c65 2c0a 2020 2020  ws_profile,.    
+000063c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 2020 2020 2061 7773 5f72 6567 696f 6e5f       aws_region_
+000063f0: 6e61 6d65 3d72 6567 696f 6e29 3a0a 2020  name=region):.  
+00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006410: 2020 7072 696e 7428 2720 2020 202e 2e2e    print('    ...
+00006420: 7265 6769 6f6e 2069 7320 7661 6c69 645c  region is valid\
+00006430: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+00006440: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006450: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00006460: 696e 7428 2720 2020 202e 2e2e 7265 6769  int('    ...regi
+00006470: 6f6e 2069 7320 4e4f 5420 7661 6c69 645c  on is NOT valid\
+00006480: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+00006490: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+000064a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064b0: 2020 2020 2020 2027 5c6e 596f 7520 6361         '\nYou ca
+000064c0: 6e20 636f 6e66 6967 7572 6520 6177 7320  n configure aws 
+000064d0: 6372 6564 656e 7469 616c 7320 616e 6420  credentials and 
+000064e0: 7265 6769 6f6e 2075 7369 6e67 2074 6865  region using the
+000064f0: 2063 6f6d 6d61 6e64 3a27 290a 2020 2020   command:').    
+00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006510: 7072 696e 7428 2720 2020 2066 726f 7374  print('    frost
+00006520: 6572 2063 6f6e 6669 6720 2d2d 6177 735c  er config --aws\
+00006530: 6e27 290a 0a20 2020 2020 2020 2020 2020  n')..           
+00006540: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00006550: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00006560: 2020 2020 2020 2069 6620 7265 6769 6f6e         if region
+00006570: 2021 3d20 6177 735f 7072 6f66 696c 655f   != aws_profile_
+00006580: 7265 6769 6f6e 3a0a 2020 2020 2020 2020  region:.        
+00006590: 2020 2020 2020 2020 2020 2020 2320 5570              # Up
+000065a0: 6461 7465 2072 6567 696f 6e20 696e 2074  date region in t
+000065b0: 6865 2063 6f6e 6669 6720 6669 6c65 0a20  he config file. 
+000065c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065d0: 2020 2073 656c 662e 5f5f 7365 745f 6177     self.__set_aw
+000065e0: 735f 636f 6e66 6967 2861 7773 5f70 726f  s_config(aws_pro
+000065f0: 6669 6c65 5f6e 616d 653d 6177 735f 7072  file_name=aws_pr
+00006600: 6f66 696c 652c 0a20 2020 2020 2020 2020  ofile,.         
+00006610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006630: 2072 6567 696f 6e3d 7265 6769 6f6e 290a   region=region).
+00006640: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
+00006650: 6574 2074 6865 2070 726f 6669 6c65 206e  et the profile n
+00006660: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+00006670: 6966 2061 7773 5f70 726f 6669 6c65 203d  if aws_profile =
+00006680: 3d20 272b 2043 7265 6174 6520 6e65 7720  = '+ Create new 
+00006690: 7072 6f66 696c 6527 3a0a 2020 2020 2020  profile':.      
+000066a0: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
+000066b0: 655f 6e61 6d65 203d 2061 7773 5f6e 6577  e_name = aws_new
+000066c0: 5f70 726f 6669 6c65 5f6e 616d 650a 2020  _profile_name.  
+000066d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000066e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066f0: 7072 6f66 696c 655f 6e61 6d65 203d 2061  profile_name = a
+00006700: 7773 5f70 726f 6669 6c65 0a0a 2020 2020  ws_profile..    
+00006710: 2020 2020 2020 2020 2320 5374 6f72 6520          # Store 
+00006720: 6177 7320 6469 7220 696e 2074 6865 2063  aws dir in the c
+00006730: 6f6e 6669 6720 6669 6c65 0a20 2020 2020  onfig file.     
+00006740: 2020 2020 2020 2073 656c 662e 5f5f 7365         self.__se
+00006750: 745f 636f 6e66 6967 7572 6174 696f 6e5f  t_configuration_
+00006760: 656e 7472 7928 2741 5753 272c 2027 6177  entry('AWS', 'aw
+00006770: 735f 6469 7227 2c20 6177 735f 6469 7229  s_dir', aws_dir)
+00006780: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00006790: 5374 6f72 6520 6177 7320 7072 6f66 696c  Store aws profil
+000067a0: 6520 696e 2074 6865 2063 6f6e 6669 6720  e in the config 
+000067b0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+000067c0: 2073 656c 662e 5f5f 7365 745f 636f 6e66   self.__set_conf
+000067d0: 6967 7572 6174 696f 6e5f 656e 7472 7928  iguration_entry(
+000067e0: 2741 5753 272c 2027 6177 735f 7072 6f66  'AWS', 'aws_prof
+000067f0: 696c 6527 2c20 7072 6f66 696c 655f 6e61  ile', profile_na
+00006800: 6d65 290a 0a20 2020 2020 2020 2020 2020  me)..           
+00006810: 2023 2053 746f 7265 2061 7773 2072 6567   # Store aws reg
+00006820: 696f 6e20 696e 2074 6865 2063 6f6e 6669  ion in the confi
+00006830: 6720 6669 6c65 0a20 2020 2020 2020 2020  g file.         
+00006840: 2020 2073 656c 662e 5f5f 7365 745f 636f     self.__set_co
+00006850: 6e66 6967 7572 6174 696f 6e5f 656e 7472  nfiguration_entr
+00006860: 7928 2741 5753 272c 2027 6177 735f 7265  y('AWS', 'aws_re
+00006870: 6769 6f6e 272c 2072 6567 696f 6e29 0a0a  gion', region)..
+00006880: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
+00006890: 7420 7468 6520 4157 5320 7072 6f66 696c  t the AWS profil
+000068a0: 6520 696e 2074 6865 2062 6f74 6f33 2073  e in the boto3 s
+000068b0: 6573 7369 6f6e 0a20 2020 2020 2020 2020  ession.         
+000068c0: 2020 2061 7773 2e73 6574 5f73 6573 7369     aws.set_sessi
+000068d0: 6f6e 2870 726f 6669 6c65 5f6e 616d 652c  on(profile_name,
+000068e0: 2072 6567 696f 6e29 0a0a 2020 2020 2020   region)..      
+000068f0: 2020 2020 2020 2320 5365 7420 6177 7320        # Set aws 
+00006900: 696e 6974 2066 6c61 670a 2020 2020 2020  init flag.      
+00006910: 2020 2020 2020 7365 6c66 2e61 7773 5f69        self.aws_i
+00006920: 6e69 7420 3d20 5472 7565 0a0a 2020 2020  nit = True..    
+00006930: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00006940: 2a2a 2a20 4157 5320 434f 4e46 4947 5552  *** AWS CONFIGUR
+00006950: 4154 494f 4e20 444f 4e45 202a 2a2a 5c6e  ATION DONE ***\n
+00006960: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+00006970: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00006980: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00006990: 2020 2020 2020 2020 7072 696e 745f 6572          print_er
+000069a0: 726f 7228 290a 2020 2020 2020 2020 2020  ror().          
+000069b0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+000069c0: 2020 2020 6465 6620 5f5f 7365 745f 6177      def __set_aw
+000069d0: 735f 636f 6e66 6967 2873 656c 662c 2061  s_config(self, a
+000069e0: 7773 5f70 726f 6669 6c65 5f6e 616d 652c  ws_profile_name,
+000069f0: 2072 6567 696f 6e29 3a0a 2020 2020 2020   region):.      
+00006a00: 2020 2727 2720 5570 6461 7465 2074 6865    ''' Update the
+00006a10: 2041 5753 2063 6f6e 6669 6720 6f66 2074   AWS config of t
+00006a20: 6865 2067 6976 656e 2070 726f 6669 6c65  he given profile
+00006a30: 2727 270a 0a20 2020 2020 2020 2069 6620  '''..        if 
+00006a40: 6e6f 7420 6177 735f 7072 6f66 696c 655f  not aws_profile_
+00006a50: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+00006a60: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006a70: 6f72 2827 4e6f 2041 5753 2070 726f 6669  or('No AWS profi
+00006a80: 6c65 2070 726f 7669 6465 6427 290a 0a20  le provided').. 
+00006a90: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+00006aa0: 6769 6f6e 3a0a 2020 2020 2020 2020 2020  gion:.          
+00006ab0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006ac0: 6f72 2827 4e6f 2072 6567 696f 6e20 7072  or('No region pr
+00006ad0: 6f76 6964 6564 2729 0a0a 2020 2020 2020  ovided')..      
+00006ae0: 2020 2320 4966 2069 7420 646f 6573 206e    # If it does n
+00006af0: 6f74 2065 7869 7374 2c20 6372 6561 7465  ot exist, create
+00006b00: 2061 7773 2064 6972 6563 746f 7279 0a20   aws directory. 
+00006b10: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+00006b20: 7273 2873 656c 662e 6177 735f 6469 722c  rs(self.aws_dir,
+00006b30: 2065 7869 7374 5f6f 6b3d 5472 7565 2c20   exist_ok=True, 
+00006b40: 6d6f 6465 3d30 6f37 3735 290a 0a20 2020  mode=0o775)..   
+00006b50: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+00006b60: 6177 7320 636f 6e66 6967 2043 6f6e 6669  aws config Confi
+00006b70: 6750 6172 7365 7220 6f62 6a65 6374 0a20  gParser object. 
+00006b80: 2020 2020 2020 2061 7773 5f63 6f6e 6669         aws_confi
+00006b90: 6720 3d20 636f 6e66 6967 7061 7273 6572  g = configparser
+00006ba0: 2e43 6f6e 6669 6750 6172 7365 7228 290a  .ConfigParser().
+00006bb0: 0a20 2020 2020 2020 2023 2049 6620 6578  .        # If ex
+00006bc0: 6973 7473 2c20 7265 6164 2074 6865 2061  ists, read the a
+00006bd0: 7773 2063 6f6e 6669 6720 6669 6c65 0a20  ws config file. 
+00006be0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00006bf0: 682e 6578 6973 7473 2873 656c 662e 6177  h.exists(self.aw
+00006c00: 735f 636f 6e66 6967 5f66 696c 6529 3a0a  s_config_file):.
+00006c10: 2020 2020 2020 2020 2020 2020 6177 735f              aws_
+00006c20: 636f 6e66 6967 2e72 6561 6428 7365 6c66  config.read(self
+00006c30: 2e61 7773 5f63 6f6e 6669 675f 6669 6c65  .aws_config_file
+00006c40: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+00006c50: 6974 2064 6f65 7320 6e6f 7420 6578 6973  it does not exis
+00006c60: 742c 2063 7265 6174 6520 6120 6e65 7720  t, create a new 
+00006c70: 7072 6f66 696c 6520 696e 2074 6865 2061  profile in the a
+00006c80: 7773 2063 6f6e 6669 6720 6669 6c65 0a20  ws config file. 
+00006c90: 2020 2020 2020 2069 6620 6e6f 7420 6177         if not aw
+00006ca0: 735f 636f 6e66 6967 2e68 6173 5f73 6563  s_config.has_sec
+00006cb0: 7469 6f6e 2861 7773 5f70 726f 6669 6c65  tion(aws_profile
+00006cc0: 5f6e 616d 6529 3a0a 2020 2020 2020 2020  _name):.        
+00006cd0: 2020 2020 6177 735f 636f 6e66 6967 2e61      aws_config.a
+00006ce0: 6464 5f73 6563 7469 6f6e 2861 7773 5f70  dd_section(aws_p
+00006cf0: 726f 6669 6c65 5f6e 616d 6529 0a0a 2020  rofile_name)..  
+00006d00: 2020 2020 2020 2320 5772 6974 6520 7468        # Write th
+00006d10: 6520 7072 6f66 696c 6520 7769 7468 2074  e profile with t
+00006d20: 6865 206e 6577 2072 6567 696f 6e0a 2020  he new region.  
+00006d30: 2020 2020 2020 6177 735f 636f 6e66 6967        aws_config
+00006d40: 5b61 7773 5f70 726f 6669 6c65 5f6e 616d  [aws_profile_nam
+00006d50: 655d 5b27 7265 6769 6f6e 275d 203d 2072  e]['region'] = r
+00006d60: 6567 696f 6e0a 0a20 2020 2020 2020 2023  egion..        #
+00006d70: 2057 7269 7465 2074 6865 2070 726f 6669   Write the profi
+00006d80: 6c65 2077 6974 6820 7468 6520 6e65 7720  le with the new 
+00006d90: 6f75 7470 7574 2066 6f72 6d61 740a 2020  output format.  
+00006da0: 2020 2020 2020 6177 735f 636f 6e66 6967        aws_config
+00006db0: 5b61 7773 5f70 726f 6669 6c65 5f6e 616d  [aws_profile_nam
+00006dc0: 655d 5b27 6f75 7470 7574 275d 203d 2027  e]['output'] = '
+00006dd0: 6a73 6f6e 270a 0a20 2020 2020 2020 2023  json'..        #
+00006de0: 2057 7269 7465 2074 6865 2063 6f6e 6669   Write the confi
+00006df0: 6720 6f62 6a65 6374 2074 6f20 7468 6520  g object to the 
+00006e00: 636f 6e66 6967 2066 696c 650a 2020 2020  config file.    
+00006e10: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
+00006e20: 6c66 2e61 7773 5f63 6f6e 6669 675f 6669  lf.aws_config_fi
+00006e30: 6c65 2c20 2777 2729 2061 7320 663a 0a20  le, 'w') as f:. 
+00006e40: 2020 2020 2020 2020 2020 2061 7773 5f63             aws_c
+00006e50: 6f6e 6669 672e 7772 6974 6528 6629 0a0a  onfig.write(f)..
+00006e60: 2020 2020 2020 2020 2320 4173 7572 6520          # Asure 
+00006e70: 7468 6520 7065 726d 6973 7369 6f6e 7320  the permissions 
+00006e80: 6f66 2074 6865 2063 6f6e 6669 6720 6669  of the config fi
+00006e90: 6c65 0a20 2020 2020 2020 206f 732e 6368  le.        os.ch
+00006ea0: 6d6f 6428 7365 6c66 2e61 7773 5f63 6f6e  mod(self.aws_con
+00006eb0: 6669 675f 6669 6c65 2c20 306f 3630 3029  fig_file, 0o600)
+00006ec0: 0a0a 2020 2020 6465 6620 5f5f 7365 745f  ..    def __set_
+00006ed0: 6177 735f 6372 6564 656e 7469 616c 7328  aws_credentials(
+00006ee0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f00: 2020 2020 6177 735f 7072 6f66 696c 655f      aws_profile_
+00006f10: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00006f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f30: 2020 2020 6177 735f 6163 6365 7373 5f6b      aws_access_k
+00006f40: 6579 5f69 642c 0a20 2020 2020 2020 2020  ey_id,.         
+00006f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f60: 2020 2020 2061 7773 5f73 6563 7265 745f       aws_secret_
+00006f70: 6163 6365 7373 5f6b 6579 293a 0a0a 2020  access_key):..  
+00006f80: 2020 2020 2020 6966 206e 6f74 2061 7773        if not aws
+00006f90: 5f70 726f 6669 6c65 5f6e 616d 653a 0a20  _profile_name:. 
+00006fa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00006fb0: 2056 616c 7565 4572 726f 7228 274e 6f20   ValueError('No 
+00006fc0: 4157 5320 7072 6f66 696c 6520 7072 6f76  AWS profile prov
+00006fd0: 6964 6564 2729 0a0a 2020 2020 2020 2020  ided')..        
+00006fe0: 6966 206e 6f74 2061 7773 5f61 6363 6573  if not aws_acces
+00006ff0: 735f 6b65 795f 6964 3a0a 2020 2020 2020  s_key_id:.      
+00007000: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00007010: 6545 7272 6f72 2827 4e6f 2041 5753 2061  eError('No AWS a
+00007020: 6363 6573 7320 6b65 7920 6964 2070 726f  ccess key id pro
+00007030: 7669 6465 6427 290a 0a20 2020 2020 2020  vided')..       
+00007040: 2069 6620 6e6f 7420 6177 735f 7365 6372   if not aws_secr
+00007050: 6574 5f61 6363 6573 735f 6b65 793a 0a20  et_access_key:. 
+00007060: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00007070: 2056 616c 7565 4572 726f 7228 274e 6f20   ValueError('No 
+00007080: 4157 5320 7365 6372 6574 2061 6363 6573  AWS secret acces
+00007090: 7320 6b65 7920 7072 6f76 6964 6564 2729  s key provided')
+000070a0: 0a0a 2020 2020 2020 2020 2320 4966 2069  ..        # If i
+000070b0: 7420 646f 6573 206e 6f74 2065 7869 7374  t does not exist
+000070c0: 2c20 6372 6561 7465 2061 7773 2064 6972  , create aws dir
+000070d0: 6563 746f 7279 0a20 2020 2020 2020 206f  ectory.        o
+000070e0: 732e 6d61 6b65 6469 7273 2873 656c 662e  s.makedirs(self.
+000070f0: 6177 735f 6469 722c 2065 7869 7374 5f6f  aws_dir, exist_o
+00007100: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
+00007110: 3735 290a 0a20 2020 2020 2020 2023 2043  75)..        # C
+00007120: 7265 6174 6520 6120 6177 7320 6372 6564  reate a aws cred
+00007130: 656e 7469 616c 7320 436f 6e66 6967 5061  entials ConfigPa
+00007140: 7273 6572 206f 626a 6563 740a 2020 2020  rser object.    
+00007150: 2020 2020 6177 735f 6372 6564 656e 7469      aws_credenti
+00007160: 616c 7320 3d20 636f 6e66 6967 7061 7273  als = configpars
+00007170: 6572 2e43 6f6e 6669 6750 6172 7365 7228  er.ConfigParser(
+00007180: 290a 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
+00007190: 6578 6973 7473 2c20 7265 6164 2074 6865  exists, read the
+000071a0: 2061 7773 2063 7265 6465 6e74 6961 6c73   aws credentials
+000071b0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
+000071c0: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
+000071d0: 6177 735f 6372 6564 656e 7469 616c 735f  aws_credentials_
+000071e0: 6669 6c65 2729 2061 6e64 206f 732e 7061  file') and os.pa
+000071f0: 7468 2e65 7869 7374 7328 7365 6c66 2e61  th.exists(self.a
+00007200: 7773 5f63 7265 6465 6e74 6961 6c73 5f66  ws_credentials_f
+00007210: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+00007220: 2020 6177 735f 6372 6564 656e 7469 616c    aws_credential
+00007230: 732e 7265 6164 2873 656c 662e 6177 735f  s.read(self.aws_
+00007240: 6372 6564 656e 7469 616c 735f 6669 6c65  credentials_file
+00007250: 290a 0a20 2020 2020 2020 2023 2055 7064  )..        # Upd
+00007260: 6174 6520 7468 6520 7265 6769 6f6e 206f  ate the region o
+00007270: 6620 7468 6520 7072 6f66 696c 650a 2020  f the profile.  
+00007280: 2020 2020 2020 6966 206e 6f74 2061 7773        if not aws
+00007290: 5f63 7265 6465 6e74 6961 6c73 2e68 6173  _credentials.has
+000072a0: 5f73 6563 7469 6f6e 2861 7773 5f70 726f  _section(aws_pro
+000072b0: 6669 6c65 5f6e 616d 6529 3a0a 2020 2020  file_name):.    
+000072c0: 2020 2020 2020 2020 6177 735f 6372 6564          aws_cred
+000072d0: 656e 7469 616c 732e 6164 645f 7365 6374  entials.add_sect
+000072e0: 696f 6e28 6177 735f 7072 6f66 696c 655f  ion(aws_profile_
+000072f0: 6e61 6d65 290a 0a20 2020 2020 2020 2023  name)..        #
+00007300: 2057 7269 7465 2074 6865 2070 726f 6669   Write the profi
+00007310: 6c65 2077 6974 6820 7468 6520 6e65 7720  le with the new 
+00007320: 6163 6365 7373 206b 6579 2069 640a 2020  access key id.  
+00007330: 2020 2020 2020 6177 735f 6372 6564 656e        aws_creden
+00007340: 7469 616c 735b 6177 735f 7072 6f66 696c  tials[aws_profil
+00007350: 655f 6e61 6d65 5d5b 2761 7773 5f61 6363  e_name]['aws_acc
+00007360: 6573 735f 6b65 795f 6964 275d 203d 2061  ess_key_id'] = a
+00007370: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
+00007380: 0a0a 2020 2020 2020 2020 2320 5772 6974  ..        # Writ
+00007390: 6520 7468 6520 7072 6f66 696c 6520 7769  e the profile wi
+000073a0: 7468 2074 6865 206e 6577 2073 6563 7265  th the new secre
+000073b0: 7420 6163 6365 7373 206b 6579 0a20 2020  t access key.   
+000073c0: 2020 2020 2061 7773 5f63 7265 6465 6e74       aws_credent
+000073d0: 6961 6c73 5b61 7773 5f70 726f 6669 6c65  ials[aws_profile
+000073e0: 5f6e 616d 655d 5b27 6177 735f 7365 6372  _name]['aws_secr
+000073f0: 6574 5f61 6363 6573 735f 6b65 7927 5d20  et_access_key'] 
+00007400: 3d20 6177 735f 7365 6372 6574 5f61 6363  = aws_secret_acc
+00007410: 6573 735f 6b65 790a 0a20 2020 2020 2020  ess_key..       
+00007420: 2023 2057 7269 7465 2074 6865 2063 6f6e   # Write the con
+00007430: 6669 6720 6f62 6a65 6374 2074 6f20 7468  fig object to th
+00007440: 6520 636f 6e66 6967 2066 696c 650a 2020  e config file.  
+00007450: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00007460: 7365 6c66 2e61 7773 5f63 7265 6465 6e74  self.aws_credent
+00007470: 6961 6c73 5f66 696c 652c 2027 7727 2920  ials_file, 'w') 
+00007480: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00007490: 2020 6177 735f 6372 6564 656e 7469 616c    aws_credential
+000074a0: 732e 7772 6974 6528 6629 0a0a 2020 2020  s.write(f)..    
+000074b0: 2020 2020 2320 4173 7572 6520 7468 6520      # Asure the 
+000074c0: 7065 726d 6973 7369 6f6e 7320 6f66 2074  permissions of t
+000074d0: 6865 2063 7265 6465 6e74 6961 6c73 2066  he credentials f
+000074e0: 696c 650a 2020 2020 2020 2020 6f73 2e63  ile.        os.c
+000074f0: 686d 6f64 2873 656c 662e 6177 735f 6372  hmod(self.aws_cr
+00007500: 6564 656e 7469 616c 735f 6669 6c65 2c20  edentials_file, 
+00007510: 306f 3630 3029 0a0a 2020 2020 6465 6620  0o600)..    def 
+00007520: 5f5f 7365 745f 6177 735f 6765 745f 636f  __set_aws_get_co
+00007530: 6e66 6967 5f72 6567 696f 6e28 7365 6c66  nfig_region(self
+00007540: 2c20 6177 735f 7072 6f66 696c 6529 3a0a  , aws_profile):.
+00007550: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00007560: 6177 735f 7072 6f66 696c 653a 0a20 2020  aws_profile:.   
+00007570: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00007580: 616c 7565 4572 726f 7228 274e 6f20 4157  alueError('No AW
+00007590: 5320 7072 6f66 696c 6520 7072 6f76 6964  S profile provid
+000075a0: 6564 2729 0a0a 2020 2020 2020 2020 2320  ed')..        # 
+000075b0: 4368 6563 6b20 6966 2061 7773 2063 7265  Check if aws cre
+000075c0: 6465 6e74 6961 6c73 2066 696c 6520 6578  dentials file ex
+000075d0: 6973 7473 0a20 2020 2020 2020 2069 6620  ists.        if 
+000075e0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+000075f0: 7473 2873 656c 662e 6177 735f 636f 6e66  ts(self.aws_conf
+00007600: 6967 5f66 696c 6529 3a0a 2020 2020 2020  ig_file):.      
+00007610: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00007620: 6545 7272 6f72 2827 4157 5320 636f 6e66  eError('AWS conf
+00007630: 6967 2066 696c 6520 646f 6573 206e 6f74  ig file does not
+00007640: 2065 7869 7374 2729 0a0a 2020 2020 2020   exist')..      
+00007650: 2020 2320 4372 6561 7465 2061 2043 6f6e    # Create a Con
+00007660: 6669 6750 6172 7365 7220 6f62 6a65 6374  figParser object
+00007670: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
+00007680: 3d20 636f 6e66 6967 7061 7273 6572 2e43  = configparser.C
+00007690: 6f6e 6669 6750 6172 7365 7228 290a 0a20  onfigParser().. 
+000076a0: 2020 2020 2020 2023 2052 6561 6420 7468         # Read th
+000076b0: 6520 6177 7320 636f 6e66 6967 2066 696c  e aws config fil
+000076c0: 650a 2020 2020 2020 2020 6966 2068 6173  e.        if has
+000076d0: 6174 7472 2873 656c 662c 2027 6177 735f  attr(self, 'aws_
+000076e0: 636f 6e66 6967 5f66 696c 6527 2920 616e  config_file') an
+000076f0: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
+00007700: 2873 656c 662e 6177 735f 636f 6e66 6967  (self.aws_config
+00007710: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
+00007720: 2020 2020 636f 6e66 6967 2e72 6561 6428      config.read(
+00007730: 7365 6c66 2e61 7773 5f63 6f6e 6669 675f  self.aws_config_
+00007740: 6669 6c65 290a 0a20 2020 2020 2020 2069  file)..        i
+00007750: 6620 636f 6e66 6967 2e68 6173 5f73 6563  f config.has_sec
+00007760: 7469 6f6e 2861 7773 5f70 726f 6669 6c65  tion(aws_profile
+00007770: 2920 616e 6420 636f 6e66 6967 2e68 6173  ) and config.has
+00007780: 5f6f 7074 696f 6e28 6177 735f 7072 6f66  _option(aws_prof
+00007790: 696c 652c 2027 7265 6769 6f6e 2729 3a0a  ile, 'region'):.
+000077a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000077b0: 726e 2063 6f6e 6669 672e 6765 7428 6177  rn config.get(aw
+000077c0: 735f 7072 6f66 696c 652c 2027 7265 6769  s_profile, 'regi
+000077d0: 6f6e 2729 0a0a 2020 2020 2020 2020 7265  on')..        re
+000077e0: 7475 726e 0a0a 2020 2020 6465 6620 5f5f  turn..    def __
+000077f0: 7365 745f 636f 6e66 6967 7572 6174 696f  set_configuratio
+00007800: 6e5f 656e 7472 7928 7365 6c66 2c20 7365  n_entry(self, se
+00007810: 6374 696f 6e2c 206b 6579 2c20 7661 6c75  ction, key, valu
+00007820: 6529 3a0a 2020 2020 2020 2020 2727 2753  e):.        '''S
+00007830: 6574 2061 2063 6f6e 6669 6775 7261 7469  et a configurati
+00007840: 6f6e 2065 6e74 7279 2069 6e20 7468 6520  on entry in the 
+00007850: 636f 6e66 6967 2066 696c 6527 2727 0a0a  config file'''..
+00007860: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+00007870: 2061 2043 6f6e 6669 6750 6172 7365 7220   a ConfigParser 
+00007880: 6f62 6a65 6374 0a20 2020 2020 2020 2063  object.        c
+00007890: 6f6e 6669 6720 3d20 636f 6e66 6967 7061  onfig = configpa
+000078a0: 7273 6572 2e43 6f6e 6669 6750 6172 7365  rser.ConfigParse
+000078b0: 7228 290a 0a20 2020 2020 2020 2023 2043  r()..        # C
+000078c0: 6865 636b 2077 6869 6368 2063 6f6e 6669  heck which confi
+000078d0: 6720 6669 6c65 2074 6f20 7573 650a 2020  g file to use.  
+000078e0: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+000078f0: 5f73 6861 7265 6420 616e 6420 7365 6374  _shared and sect
+00007900: 696f 6e20 696e 205b 274e 4948 272c 2027  ion in ['NIH', '
+00007910: 5333 272c 2027 534c 5552 4d27 2c20 2743  S3', 'SLURM', 'C
+00007920: 4c4f 5544 275d 3a0a 0a20 2020 2020 2020  LOUD']:..       
+00007930: 2020 2020 2023 2043 7265 6174 6520 7368       # Create sh
+00007940: 6172 6564 2063 6f6e 6669 6720 6469 7265  ared config dire
+00007950: 6374 6f72 7920 696e 2063 6173 6520 6974  ctory in case it
+00007960: 2064 6f65 7320 6e6f 7420 6578 6973 740a   does not exist.
+00007970: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00007980: 616b 6564 6972 7328 7365 6c66 2e73 6861  akedirs(self.sha
+00007990: 7265 645f 6469 722c 2065 7869 7374 5f6f  red_dir, exist_o
+000079a0: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
+000079b0: 3735 290a 0a20 2020 2020 2020 2020 2020  75)..           
+000079c0: 2023 2047 6574 2074 6865 2073 6861 7265   # Get the share
+000079d0: 6420 636f 6e66 6967 2066 696c 650a 2020  d config file.  
+000079e0: 2020 2020 2020 2020 2020 6669 6c65 203d            file =
+000079f0: 2073 656c 662e 7368 6172 6564 5f63 6f6e   self.shared_con
+00007a00: 6669 675f 6669 6c65 0a20 2020 2020 2020  fig_file.       
+00007a10: 2065 6c73 653a 0a0a 2020 2020 2020 2020   else:..        
+00007a20: 2020 2020 2320 4372 6561 7465 2063 6f6e      # Create con
+00007a30: 6669 6720 6469 7265 6374 6f72 7920 696e  fig directory in
+00007a40: 2063 6173 6520 6974 2064 6f65 7320 6e6f   case it does no
+00007a50: 7420 6578 6973 740a 2020 2020 2020 2020  t exist.        
+00007a60: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00007a70: 7365 6c66 2e63 6f6e 6669 675f 6469 722c  self.config_dir,
+00007a80: 2065 7869 7374 5f6f 6b3d 5472 7565 2c20   exist_ok=True, 
+00007a90: 6d6f 6465 3d30 6f37 3735 290a 0a20 2020  mode=0o775)..   
+00007aa0: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
+00007ab0: 6865 2063 6f6e 6669 6720 6669 6c65 0a20  he config file. 
+00007ac0: 2020 2020 2020 2020 2020 2066 696c 6520             file 
+00007ad0: 3d20 7365 6c66 2e63 6f6e 6669 675f 6669  = self.config_fi
+00007ae0: 6c65 0a0a 2020 2020 2020 2020 2320 6966  le..        # if
+00007af0: 2065 7869 7374 732c 2072 6561 6420 7468   exists, read th
+00007b00: 6520 636f 6e66 6967 2066 696c 650a 2020  e config file.  
+00007b10: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00007b20: 2e65 7869 7374 7328 6669 6c65 293a 0a20  .exists(file):. 
+00007b30: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00007b40: 672e 7265 6164 2866 696c 6529 0a0a 2020  g.read(file)..  
+00007b50: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
+00007b60: 6865 2073 6563 7469 6f6e 2069 6620 6974  he section if it
+00007b70: 2064 6f65 7320 6e6f 7420 6578 6973 740a   does not exist.
+00007b80: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+00007b90: 6f6e 6669 672e 6861 735f 7365 6374 696f  onfig.has_sectio
+00007ba0: 6e28 7365 6374 696f 6e29 3a0a 2020 2020  n(section):.    
+00007bb0: 2020 2020 2020 2020 636f 6e66 6967 2e61          config.a
+00007bc0: 6464 5f73 6563 7469 6f6e 2873 6563 7469  dd_section(secti
+00007bd0: 6f6e 290a 0a20 2020 2020 2020 2023 2053  on)..        # S
+00007be0: 6574 2074 6865 2076 616c 7565 0a20 2020  et the value.   
+00007bf0: 2020 2020 2063 6f6e 6669 675b 7365 6374       config[sect
+00007c00: 696f 6e5d 5b6b 6579 5d20 3d20 7374 7228  ion][key] = str(
+00007c10: 7661 6c75 6529 0a0a 2020 2020 2020 2020  value)..        
+00007c20: 2320 5772 6974 6520 7468 6520 636f 6e66  # Write the conf
+00007c30: 6967 206f 626a 6563 7420 746f 2074 6865  ig object to the
+00007c40: 2063 6f6e 6669 6720 6669 6c65 0a20 2020   config file.   
+00007c50: 2020 2020 2077 6974 6820 6f70 656e 2866       with open(f
+00007c60: 696c 652c 2027 7727 2920 6173 2066 3a0a  ile, 'w') as f:.
+00007c70: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00007c80: 6967 2e77 7269 7465 2866 290a 0a20 2020  ig.write(f)..   
+00007c90: 2020 2020 2023 2053 6574 2074 6865 2076       # Set the v
+00007ca0: 616c 7565 2069 6e20 7468 6520 636f 6e66  alue in the conf
+00007cb0: 6967 206f 626a 6563 740a 2020 2020 2020  ig object.      
+00007cc0: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
+00007cd0: 6b65 792c 2076 616c 7565 290a 0a20 2020  key, value)..   
+00007ce0: 2064 6566 2073 6573 5f76 6572 6966 795f   def ses_verify_
+00007cf0: 7265 7175 6573 7473 5f73 656e 7428 7365  requests_sent(se
+00007d00: 6c66 2c20 656d 6169 6c5f 6c69 7374 293a  lf, email_list):
+00007d10: 0a20 2020 2020 2020 2027 2727 5365 7420  .        '''Set 
+00007d20: 7468 6520 7365 7320 7665 7269 6679 2072  the ses verify r
+00007d30: 6571 7565 7374 7320 7365 6e74 2065 6d61  equests sent ema
+00007d40: 696c 206c 6973 7420 696e 2063 6f6e 6669  il list in confi
+00007d50: 6775 7261 7469 6f6e 2066 696c 6527 2727  guration file'''
+00007d60: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00007d70: 2065 6d61 696c 5f6c 6973 743a 0a20 2020   email_list:.   
+00007d80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00007d90: 616c 7565 4572 726f 7228 274e 6f20 656d  alueError('No em
+00007da0: 6169 6c20 6c69 7374 2070 726f 7669 6465  ail list provide
+00007db0: 6427 290a 0a20 2020 2020 2020 2023 2057  d')..        # W
+00007dc0: 7269 7465 2074 6865 2063 6f6e 6669 6720  rite the config 
+00007dd0: 6f62 6a65 6374 2074 6f20 7468 6520 636f  object to the co
+00007de0: 6e66 6967 2066 696c 650a 2020 2020 2020  nfig file.      
+00007df0: 2020 7365 6c66 2e5f 5f73 6574 5f63 6f6e    self.__set_con
+00007e00: 6669 6775 7261 7469 6f6e 5f65 6e74 7279  figuration_entry
+00007e10: 280a 2020 2020 2020 2020 2020 2020 2743  (.            'C
+00007e20: 4c4f 554c 4427 2c20 2773 6573 5f76 6572  LOULD', 'ses_ver
+00007e30: 6966 795f 7265 7175 6573 7473 5f73 656e  ify_requests_sen
+00007e40: 7427 2c20 656d 6169 6c5f 6c69 7374 290a  t', email_list).
+00007e50: 0a20 2020 2064 6566 2073 6574 5f65 6332  .    def set_ec2
+00007e60: 5f6c 6173 745f 696e 7374 616e 6365 2873  _last_instance(s
+00007e70: 656c 662c 2069 6e73 7461 6e63 6529 3a0a  elf, instance):.
+00007e80: 2020 2020 2020 2020 2727 2753 6574 2074          '''Set t
+00007e90: 6865 206c 6173 7420 6563 3220 696e 7374  he last ec2 inst
+00007ea0: 616e 6365 2069 6e20 636f 6e66 6967 7572  ance in configur
+00007eb0: 6174 696f 6e20 6669 6c65 2727 270a 0a20  ation file'''.. 
+00007ec0: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
+00007ed0: 7374 616e 6365 3a0a 2020 2020 2020 2020  stance:.        
+00007ee0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00007ef0: 7272 6f72 2827 4e6f 2069 6e73 7461 6e63  rror('No instanc
+00007f00: 6520 7072 6f76 6964 6564 2729 0a0a 2020  e provided')..  
+00007f10: 2020 2020 2020 2320 5772 6974 6520 7468        # Write th
+00007f20: 6520 636f 6e66 6967 206f 626a 6563 7420  e config object 
+00007f30: 746f 2074 6865 2063 6f6e 6669 6720 6669  to the config fi
+00007f40: 6c65 0a20 2020 2020 2020 2073 656c 662e  le.        self.
+00007f50: 5f5f 7365 745f 636f 6e66 6967 7572 6174  __set_configurat
+00007f60: 696f 6e5f 656e 7472 7928 2743 4c4f 554c  ion_entry('CLOUL
+00007f70: 4427 2c20 2765 6332 5f6c 6173 745f 696e  D', 'ec2_last_in
+00007f80: 7374 616e 6365 272c 2069 6e73 7461 6e63  stance', instanc
+00007f90: 6529 0a0a 2020 2020 6465 6620 7365 745f  e)..    def set_
+00007fa0: 6e69 6828 7365 6c66 293a 0a20 2020 2020  nih(self):.     
+00007fb0: 2020 2027 2727 5365 7420 7468 6520 4e49     '''Set the NI
+00007fc0: 4820 636f 6e66 6967 7572 6174 696f 6e27  H configuration'
+00007fd0: 2727 0a0a 2020 2020 2020 2020 7472 793a  ''..        try:
+00007fe0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00007ff0: 6e74 2866 275c 6e2a 2a2a 204e 4948 2053  nt(f'\n*** NIH S
+00008000: 3320 434f 4e46 4947 5552 4154 494f 4e20  3 CONFIGURATION 
+00008010: 2a2a 2a5c 6e27 290a 0a20 2020 2020 2020  ***\n')..       
+00008020: 2020 2020 2069 735f 6e69 6820 3d20 696e       is_nih = in
+00008030: 7175 6972 6572 2e63 6f6e 6669 726d 280a  quirer.confirm(.
+00008040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008050: 6d65 7373 6167 653d 2244 6f20 796f 7520  message="Do you 
+00008060: 7761 6e74 2074 6f20 7365 6172 6368 2061  want to search a
+00008070: 6e64 206c 696e 6b20 4e49 4820 6c69 6665  nd link NIH life
+00008080: 2073 6369 656e 6365 7320 6772 616e 7473   sciences grants
+00008090: 2077 6974 6820 796f 7572 2061 7263 6869   with your archi
+000080a0: 7665 733f 222c 2064 6566 6175 6c74 3d46  ves?", default=F
+000080b0: 616c 7365 290a 0a20 2020 2020 2020 2020  alse)..         
+000080c0: 2020 2073 656c 662e 5f5f 7365 745f 636f     self.__set_co
+000080d0: 6e66 6967 7572 6174 696f 6e5f 656e 7472  nfiguration_entr
+000080e0: 7928 274e 4948 272c 2027 6973 5f6e 6968  y('NIH', 'is_nih
+000080f0: 272c 2069 735f 6e69 6829 0a0a 2020 2020  ', is_nih)..    
+00008100: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00008110: 2a2a 2a20 4e49 4820 5333 2043 4f4e 4649  *** NIH S3 CONFI
+00008120: 4755 5241 5449 4f4e 2044 4f4e 452a 2a2a  GURATION DONE***
+00008130: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
+00008140: 2020 2320 5365 7420 7468 6520 6e69 6820    # Set the nih 
+00008150: 696e 6974 2066 6c61 670a 2020 2020 2020  init flag.      
+00008160: 2020 2020 2020 7365 6c66 2e6e 6968 5f69        self.nih_i
+00008170: 6e69 7420 3d20 5472 7565 0a0a 2020 2020  nit = True..    
+00008180: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00008190: 7275 650a 0a20 2020 2020 2020 2065 7863  rue..        exc
+000081a0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+000081b0: 2070 7269 6e74 5f65 7272 6f72 2829 0a20   print_error(). 
+000081c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000081d0: 6e20 4661 6c73 650a 0a20 2020 2064 6566  n False..    def
+000081e0: 2073 6574 5f73 3328 7365 6c66 2c20 6177   set_s3(self, aw
+000081f0: 733a 2022 4157 5342 6f74 6f22 293a 0a20  s: "AWSBoto"):. 
+00008200: 2020 2020 2020 2027 2727 5365 7420 7468         '''Set th
+00008210: 6520 5333 2063 6f6e 6669 6775 7261 7469  e S3 configurati
+00008220: 6f6e 2727 270a 0a20 2020 2020 2020 2074  on'''..        t
+00008230: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00008240: 7072 696e 7428 6627 5c6e 2a2a 2a20 5333  print(f'\n*** S3
+00008250: 2043 4f4e 4649 4755 5241 5449 4f4e 202a   CONFIGURATION *
+00008260: 2a2a 5c6e 2729 0a0a 2020 2020 2020 2020  **\n')..        
+00008270: 2020 2020 2320 4368 6563 6b20 6966 2061      # Check if a
+00008280: 7773 2063 6f6e 6669 6775 7261 7469 6f6e  ws configuration
+00008290: 2069 7320 636f 6d70 6c65 7465 0a20 2020   is complete.   
+000082a0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000082b0: 7365 6c66 2e61 7773 5f69 6e69 743a 0a20  self.aws_init:. 
+000082c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000082d0: 7269 6e74 2866 2741 5753 2063 6f6e 6669  rint(f'AWS confi
+000082e0: 6775 7261 7469 6f6e 2069 7320 6d69 7373  guration is miss
+000082f0: 696e 6727 290a 2020 2020 2020 2020 2020  ing').          
+00008300: 2020 2020 2020 7072 696e 7428 2759 6f75        print('You
+00008310: 2063 616e 2063 6f6e 6669 6775 7265 2061   can configure a
+00008320: 7773 2073 6574 7469 6e67 7320 7573 696e  ws settings usin
+00008330: 6720 7468 6520 636f 6d6d 616e 643a 2729  g the command:')
+00008340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008350: 2070 7269 6e74 2827 2020 2020 6672 6f73   print('    fros
+00008360: 7465 7220 636f 6e66 6967 202d 2d61 7773  ter config --aws
+00008370: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00008380: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00008390: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000083a0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000083b0: 2020 2020 6627 4368 6563 6b69 6e67 2041      f'Checking A
+000083c0: 5753 2063 7265 6465 6e74 6961 6c73 2066  WS credentials f
+000083d0: 6f72 2070 726f 6669 6c65 2022 7b73 656c  or profile "{sel
+000083e0: 662e 6177 735f 7072 6f66 696c 657d 222e  f.aws_profile}".
+000083f0: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
+00008400: 2069 6620 6177 732e 6368 6563 6b5f 6372   if aws.check_cr
+00008410: 6564 656e 7469 616c 7328 6177 735f 7072  edentials(aws_pr
+00008420: 6f66 696c 653d 7365 6c66 2e61 7773 5f70  ofile=self.aws_p
+00008430: 726f 6669 6c65 293a 0a20 2020 2020 2020  rofile):.       
+00008440: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00008450: 2020 2020 2e2e 2e41 5753 2063 7265 6465      ...AWS crede
+00008460: 6e74 6961 6c73 2061 7265 2076 616c 6964  ntials are valid
+00008470: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+00008480: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00008490: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+000084a0: 2020 2e2e 2e41 5753 2063 7265 6465 6e74    ...AWS credent
+000084b0: 6961 6c73 2061 7265 204e 4f54 2076 616c  ials are NOT val
+000084c0: 6964 5c6e 2729 0a20 2020 2020 2020 2020  id\n').         
+000084d0: 2020 2020 2020 2070 7269 6e74 2827 5c6e         print('\n
+000084e0: 596f 7520 6361 6e20 636f 6e66 6967 7572  You can configur
+000084f0: 6520 6177 7320 6372 6564 656e 7469 616c  e aws credential
+00008500: 7320 7573 696e 6720 7468 6520 636f 6d6d  s using the comm
+00008510: 616e 643a 2729 0a20 2020 2020 2020 2020  and:').         
+00008520: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+00008530: 2020 6672 6f73 7465 7220 636f 6e66 6967    froster config
+00008540: 202d 2d61 7773 2729 0a20 2020 2020 2020   --aws').       
+00008550: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00008560: 275c 6e2a 2a2a 2053 3320 434f 4e46 4947  '\n*** S3 CONFIG
+00008570: 5552 4154 494f 4e20 444f 4e45 202a 2a2a  URATION DONE ***
+00008580: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+00008590: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000085a0: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
+000085b0: 2047 6574 206c 6973 7420 6672 6f73 7465   Get list froste
+000085c0: 7220 6275 636b 6574 7320 666f 7220 7468  r buckets for th
+000085d0: 6520 6769 7665 6e20 7072 6f66 696c 650a  e given profile.
+000085e0: 2020 2020 2020 2020 2020 2020 7333 5f62              s3_b
+000085f0: 7563 6b65 7473 203d 2061 7773 2e67 6574  uckets = aws.get
+00008600: 5f62 7563 6b65 7473 2829 0a0a 2020 2020  _buckets()..    
+00008610: 2020 2020 2020 2020 2320 4164 6420 616e          # Add an
+00008620: 206f 7074 696f 6e20 746f 2063 7265 6174   option to creat
+00008630: 6520 6120 6e65 7720 6275 636b 6574 0a20  e a new bucket. 
+00008640: 2020 2020 2020 2020 2020 2073 335f 6275             s3_bu
+00008650: 636b 6574 732e 6170 7065 6e64 2827 2b20  ckets.append('+ 
+00008660: 4372 6561 7465 206e 6577 2062 7563 6b65  Create new bucke
+00008670: 7427 290a 0a20 2020 2020 2020 2020 2020  t')..           
+00008680: 2064 6566 6175 6c74 5f62 7563 6b65 7420   default_bucket 
+00008690: 3d20 7365 6c66 2e62 7563 6b65 745f 6e61  = self.bucket_na
+000086a0: 6d65 2069 6620 6861 7361 7474 7228 0a20  me if hasattr(. 
+000086b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000086c0: 656c 662c 2027 6275 636b 6574 5f6e 616d  elf, 'bucket_nam
+000086d0: 6527 2920 656c 7365 204e 6f6e 650a 0a20  e') else None.. 
+000086e0: 2020 2020 2020 2020 2020 2023 2041 736b             # Ask
+000086f0: 2075 7365 7220 746f 2063 686f 6f73 6520   user to choose 
+00008700: 616e 2065 7869 7374 696e 6720 6177 7320  an existing aws 
+00008710: 7333 2062 7563 6b65 7420 6f72 2063 7265  s3 bucket or cre
+00008720: 6174 6520 6120 6e65 7720 6f6e 650a 2020  ate a new one.  
+00008730: 2020 2020 2020 2020 2020 7333 5f62 7563            s3_buc
+00008740: 6b65 7420 3d20 696e 7175 6972 6572 2e6c  ket = inquirer.l
+00008750: 6973 745f 696e 7075 7428 2243 686f 6f73  ist_input("Choos
+00008760: 6520 796f 7572 2061 7773 2073 3320 6275  e your aws s3 bu
+00008770: 636b 6574 222c 0a20 2020 2020 2020 2020  cket",.         
+00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087a0: 2020 2064 6566 6175 6c74 3d64 6566 6175     default=defau
+000087b0: 6c74 5f62 7563 6b65 742c 0a20 2020 2020  lt_bucket,.     
+000087c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087e0: 2020 2020 2020 2063 686f 6963 6573 3d73         choices=s
+000087f0: 335f 6275 636b 6574 7329 0a0a 2020 2020  3_buckets)..    
+00008800: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00008810: 6966 2075 7365 7220 7761 6e74 7320 746f  if user wants to
+00008820: 2063 7265 6174 6520 6120 6e65 7720 6177   create a new aw
+00008830: 7320 7333 2062 7563 6b65 740a 2020 2020  s s3 bucket.    
+00008840: 2020 2020 2020 2020 6966 2073 335f 6275          if s3_bu
+00008850: 636b 6574 203d 3d20 272b 2043 7265 6174  cket == '+ Creat
+00008860: 6520 6e65 7720 6275 636b 6574 273a 0a0a  e new bucket':..
+00008870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008880: 2320 4765 7420 6e65 7720 6275 636b 6574  # Get new bucket
+00008890: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
+000088a0: 2020 2020 2020 6e65 775f 6275 636b 6574        new_bucket
+000088b0: 5f6e 616d 6520 3d20 696e 7175 6972 6572  _name = inquirer
+000088c0: 2e74 6578 7428 0a20 2020 2020 2020 2020  .text(.         
+000088d0: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+000088e0: 6765 3d27 456e 7465 7220 6e65 7720 6275  ge='Enter new bu
+000088f0: 636b 6574 206e 616d 6520 2869 7420 6d75  cket name (it mu
+00008900: 7374 2073 7461 7274 2077 6974 6820 2266  st start with "f
+00008910: 726f 7374 6572 2d22 2927 2c0a 2020 2020  roster-")',.    
+00008920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008930: 7661 6c69 6461 7465 3d73 656c 662e 5f5f  validate=self.__
+00008940: 696e 7175 6972 6572 5f63 6865 636b 5f62  inquirer_check_b
+00008950: 7563 6b65 745f 6e61 6d65 290a 0a20 2020  ucket_name)..   
+00008960: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00008970: 6e65 775f 6275 636b 6574 5f6e 616d 6520  new_bucket_name 
+00008980: 696e 2073 335f 6275 636b 6574 733a 0a20  in s3_buckets:. 
+00008990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089a0: 2020 2070 7269 6e74 2866 2742 7563 6b65     print(f'Bucke
+000089b0: 7420 7b6e 6577 5f62 7563 6b65 745f 6e61  t {new_bucket_na
+000089c0: 6d65 7d20 616c 7265 6164 7920 6578 6973  me} already exis
+000089d0: 7473 2729 0a20 2020 2020 2020 2020 2020  ts').           
+000089e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000089f0: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00008a00: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00008a10: 6e65 7720 6275 636b 6574 0a20 2020 2020  new bucket.     
+00008a20: 2020 2020 2020 2020 2020 2061 7773 2e63             aws.c
+00008a30: 7265 6174 655f 6275 636b 6574 2862 7563  reate_bucket(buc
+00008a40: 6b65 745f 6e61 6d65 3d6e 6577 5f62 7563  ket_name=new_buc
+00008a50: 6b65 745f 6e61 6d65 2c0a 2020 2020 2020  ket_name,.      
+00008a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a70: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00008a80: 6f6e 3d73 656c 662e 6177 735f 7265 6769  on=self.aws_regi
+00008a90: 6f6e 290a 0a20 2020 2020 2020 2020 2020  on)..           
+00008aa0: 2020 2020 2023 2053 746f 7265 206e 6577       # Store new
+00008ab0: 2061 7773 2073 3320 6275 636b 6574 2069   aws s3 bucket i
+00008ac0: 6e20 7468 6520 636f 6e66 6967 206f 626a  n the config obj
+00008ad0: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00008ae0: 2020 2020 7365 6c66 2e5f 5f73 6574 5f63      self.__set_c
+00008af0: 6f6e 6669 6775 7261 7469 6f6e 5f65 6e74  onfiguration_ent
+00008b00: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
+00008b10: 2020 2020 2020 2020 2753 3327 2c20 2762          'S3', 'b
+00008b20: 7563 6b65 745f 6e61 6d65 272c 206e 6577  ucket_name', new
+00008b30: 5f62 7563 6b65 745f 6e61 6d65 290a 2020  _bucket_name).  
+00008b40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00008b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b60: 2320 5374 6f72 6520 6177 7320 7333 2062  # Store aws s3 b
+00008b70: 7563 6b65 7420 696e 2074 6865 2063 6f6e  ucket in the con
+00008b80: 6669 6720 6f62 6a65 6374 0a20 2020 2020  fig object.     
+00008b90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008ba0: 5f5f 7365 745f 636f 6e66 6967 7572 6174  __set_configurat
+00008bb0: 696f 6e5f 656e 7472 7928 2753 3327 2c20  ion_entry('S3', 
+00008bc0: 2762 7563 6b65 745f 6e61 6d65 272c 2073  'bucket_name', s
+00008bd0: 335f 6275 636b 6574 290a 0a20 2020 2020  3_bucket)..     
+00008be0: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
+00008bf0: 2061 7263 6869 7665 2064 6972 6563 746f   archive directo
+00008c00: 7279 2069 6e20 7468 6520 7365 6c65 6374  ry in the select
+00008c10: 6564 2062 7563 6b65 740a 2020 2020 2020  ed bucket.      
+00008c20: 2020 2020 2020 6172 6368 6976 655f 6469        archive_di
+00008c30: 7220 3d20 696e 7175 6972 6572 2e74 6578  r = inquirer.tex
+00008c40: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00008c50: 2020 206d 6573 7361 6765 3d27 456e 7465     message='Ente
+00008c60: 7220 7468 6520 6469 7265 6374 6f72 7920  r the directory 
+00008c70: 6e61 6d65 2069 6e73 6964 6520 5333 2062  name inside S3 b
+00008c80: 7563 6b65 7420 2864 6566 6175 6c74 3d20  ucket (default= 
+00008c90: 2266 726f 7374 6572 2229 272c 0a20 2020  "froster")',.   
+00008ca0: 2020 2020 2020 2020 2020 2020 2064 6566               def
+00008cb0: 6175 6c74 3d27 6672 6f73 7465 7227 2c0a  ault='froster',.
+00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cd0: 7661 6c69 6461 7465 3d73 656c 662e 5f5f  validate=self.__
+00008ce0: 696e 7175 6972 6572 5f63 6865 636b 5f72  inquirer_check_r
+00008cf0: 6571 7569 7265 6429 0a0a 2020 2020 2020  equired)..      
+00008d00: 2020 2020 2020 2320 5072 696e 7420 6e65        # Print ne
+00008d10: 776c 696e 6520 6166 7465 7220 7468 6973  wline after this
+00008d20: 2070 726f 6d70 740a 2020 2020 2020 2020   prompt.        
+00008d30: 2020 2020 7072 696e 7428 290a 0a20 2020      print()..   
+00008d40: 2020 2020 2020 2020 2023 2053 746f 7265           # Store
+00008d50: 2061 7773 2073 3320 6172 6368 6976 6520   aws s3 archive 
+00008d60: 6469 7220 696e 2074 6865 2063 6f6e 6669  dir in the confi
+00008d70: 6720 6f62 6a65 6374 0a20 2020 2020 2020  g object.       
+00008d80: 2020 2020 2073 656c 662e 5f5f 7365 745f       self.__set_
+00008d90: 636f 6e66 6967 7572 6174 696f 6e5f 656e  configuration_en
+00008da0: 7472 7928 2753 3327 2c20 2761 7263 6869  try('S3', 'archi
+00008db0: 7665 5f64 6972 272c 2061 7263 6869 7665  ve_dir', archive
+00008dc0: 5f64 6972 290a 0a20 2020 2020 2020 2020  _dir)..         
+00008dd0: 2020 2023 2047 6574 2074 6865 2073 746f     # Get the sto
+00008de0: 7261 6765 2063 6c61 7373 2066 6f72 2074  rage class for t
+00008df0: 6865 2073 656c 6563 7465 6420 6275 636b  he selected buck
+00008e00: 6574 0a20 2020 2020 2020 2020 2020 2069  et.            i
+00008e10: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
+00008e20: 2773 746f 7261 6765 5f63 6c61 7373 2729  'storage_class')
+00008e30: 2061 6e64 2073 656c 662e 7374 6f72 6167   and self.storag
+00008e40: 655f 636c 6173 7320 6973 206e 6f74 204e  e_class is not N
+00008e50: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00008e60: 2020 2020 2064 6566 6175 6c74 5f73 746f       default_sto
+00008e70: 7261 6765 5f63 6c61 7373 203d 2073 656c  rage_class = sel
+00008e80: 662e 7374 6f72 6167 655f 636c 6173 730a  f.storage_class.
+00008e90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00008ea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008eb0: 2020 6465 6661 756c 745f 7374 6f72 6167    default_storag
+00008ec0: 655f 636c 6173 7320 3d20 2744 4545 505f  e_class = 'DEEP_
+00008ed0: 4152 4348 4956 4527 0a0a 2020 2020 2020  ARCHIVE'..      
+00008ee0: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
+00008ef0: 7374 6f72 6167 6520 636c 6173 7320 666f  storage class fo
+00008f00: 7220 7468 6520 7365 6c65 6374 6564 2062  r the selected b
+00008f10: 7563 6b65 740a 2020 2020 2020 2020 2020  ucket.          
+00008f20: 2020 7374 6f72 6167 655f 636c 6173 7320    storage_class 
+00008f30: 3d20 696e 7175 6972 6572 2e6c 6973 745f  = inquirer.list_
+00008f40: 696e 7075 7428 2243 686f 6f73 6520 7468  input("Choose th
+00008f50: 6520 4157 5320 5333 2073 746f 7261 6765  e AWS S3 storage
+00008f60: 2063 6c61 7373 222c 0a20 2020 2020 2020   class",.       
+00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f90: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008fa0: 3d64 6566 6175 6c74 5f73 746f 7261 6765  =default_storage
+00008fb0: 5f63 6c61 7373 2c0a 2020 2020 2020 2020  _class,.        
+00008fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fe0: 2020 2020 2020 2020 6368 6f69 6365 733d          choices=
+00008ff0: 7b27 4445 4550 5f41 5243 4849 5645 272c  {'DEEP_ARCHIVE',
+00009000: 2027 474c 4143 4945 5227 2c20 2749 4e54   'GLACIER', 'INT
+00009010: 454c 4c49 4745 4e54 5f54 4945 5249 4e47  ELLIGENT_TIERING
+00009020: 277d 290a 0a20 2020 2020 2020 2020 2020  '})..           
+00009030: 2023 2053 746f 7265 2061 7773 2073 3320   # Store aws s3 
+00009040: 7374 6f72 6167 6520 636c 6173 7320 696e  storage class in
+00009050: 2074 6865 2063 6f6e 6669 6720 6f62 6a65   the config obje
+00009060: 6374 0a20 2020 2020 2020 2020 2020 2073  ct.            s
+00009070: 656c 662e 5f5f 7365 745f 636f 6e66 6967  elf.__set_config
+00009080: 7572 6174 696f 6e5f 656e 7472 7928 0a20  uration_entry(. 
+00009090: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000090a0: 5333 272c 2027 7374 6f72 6167 655f 636c  S3', 'storage_cl
+000090b0: 6173 7327 2c20 7374 6f72 6167 655f 636c  ass', storage_cl
+000090c0: 6173 7329 0a0a 2020 2020 2020 2020 2020  ass)..          
+000090d0: 2020 2320 5365 7420 7468 6520 7333 2069    # Set the s3 i
+000090e0: 6e69 7420 666c 6167 0a20 2020 2020 2020  nit flag.       
+000090f0: 2020 2020 2073 656c 662e 7333 5f69 6e69       self.s3_ini
+00009100: 7420 3d20 5472 7565 0a0a 2020 2020 2020  t = True..      
+00009110: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
+00009120: 2a2a 2a20 5333 2043 4f4e 4649 4755 5241  *** S3 CONFIGURA
+00009130: 5449 4f4e 2044 4f4e 4520 2a2a 2a5c 6e27  TION DONE ***\n'
+00009140: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00009150: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+00009160: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00009170: 2020 2020 2020 2020 7072 696e 745f 6572          print_er
+00009180: 726f 7228 290a 2020 2020 2020 2020 2020  ror().          
+00009190: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+000091a0: 2020 2020 6465 6620 7365 745f 7368 6172      def set_shar
+000091b0: 6564 2873 656c 6629 3a0a 2020 2020 2020  ed(self):.      
+000091c0: 2020 2727 2753 6574 2074 6865 2073 6861    '''Set the sha
+000091d0: 7265 6420 636f 6e66 6967 7572 6174 696f  red configuratio
+000091e0: 6e27 2727 0a0a 2020 2020 2020 2020 7472  n'''..        tr
+000091f0: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
+00009200: 7269 6e74 2866 275c 6e2a 2a2a 2053 4841  rint(f'\n*** SHA
+00009210: 5245 4420 434f 4e46 4947 5552 4154 494f  RED CONFIGURATIO
+00009220: 4e20 2a2a 2a5c 6e27 290a 0a20 2020 2020  N ***\n')..     
+00009230: 2020 2020 2020 2069 735f 7368 6172 6564         is_shared
+00009240: 203d 2069 6e71 7569 7265 722e 636f 6e66   = inquirer.conf
+00009250: 6972 6d28 0a20 2020 2020 2020 2020 2020  irm(.           
+00009260: 2020 2020 206d 6573 7361 6765 3d22 446f       message="Do
+00009270: 2079 6f75 2077 616e 7420 746f 2063 6f6c   you want to col
+00009280: 6c61 626f 7261 7465 2077 6974 6820 6f74  laborate with ot
+00009290: 6865 7220 7573 6572 7320 6f6e 2061 7263  her users on arc
+000092a0: 6869 7665 2061 6e64 2072 6573 746f 7265  hive and restore
+000092b0: 3f22 2c20 6465 6661 756c 743d 4661 6c73  ?", default=Fals
+000092c0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+000092d0: 2320 4966 2069 7420 6973 2061 2073 6861  # If it is a sha
+000092e0: 7265 6420 636f 6e66 6967 7572 6174 696f  red configuratio
+000092f0: 6e20 7765 206e 6565 6420 746f 2061 736b  n we need to ask
+00009300: 2074 6865 2075 7365 7220 666f 7220 7468   the user for th
+00009310: 6520 7061 7468 2074 6f20 7468 6520 7368  e path to the sh
+00009320: 6172 6564 2063 6f6e 6669 6720 6469 7265  ared config dire
+00009330: 6374 6f72 790a 2020 2020 2020 2020 2020  ctory.          
+00009340: 2020 2320 616e 6420 6368 6563 6b20 6966    # and check if
+00009350: 2077 6520 6e65 6564 2074 6f20 6d6f 7665   we need to move
+00009360: 2063 6667 2e61 7263 6869 7665 5f6a 736f   cfg.archive_jso
+00009370: 6e5f 6669 6c65 5f6e 616d 6520 616e 6420  n_file_name and 
+00009380: 636f 6e66 6967 7572 6174 696f 6e20 746f  configuration to
+00009390: 2074 6865 2073 6861 7265 6420 6469 7265   the shared dire
+000093a0: 6374 6f72 790a 2020 2020 2020 2020 2020  ctory.          
+000093b0: 2020 6966 2069 735f 7368 6172 6564 3a0a    if is_shared:.
+000093c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000093d0: 2023 2041 736b 2075 7365 7220 746f 2065   # Ask user to e
+000093e0: 6e74 6572 2074 6865 2070 6174 6820 746f  nter the path to
+000093f0: 2061 2073 6861 7265 6420 636f 6e66 6967   a shared config
+00009400: 2064 6972 6563 746f 7279 0a20 2020 2020   directory.     
+00009410: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
+00009420: 4f3a 206d 616b 6520 7468 6973 2069 6e71  O: make this inq
+00009430: 7569 7269 6e67 2069 6e20 7368 6f72 7463  uiring in shortc
+00009440: 6875 7420 6d6f 6465 206f 6e63 6520 7468  hut mode once th
+00009450: 6973 2050 5220 6973 206d 6572 6765 643a  is PR is merged:
+00009460: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+00009470: 636f 6d2f 6d61 676d 6178 2f70 7974 686f  com/magmax/pytho
+00009480: 6e2d 696e 7175 6972 6572 2f70 756c 6c2f  n-inquirer/pull/
+00009490: 3534 330a 2020 2020 2020 2020 2020 2020  543.            
+000094a0: 2020 2020 7368 6172 6564 5f63 6f6e 6669      shared_confi
+000094b0: 675f 6469 725f 7175 6573 7469 6f6e 203d  g_dir_question =
+000094c0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+000094d0: 2020 2020 2020 2069 6e71 7569 7265 722e         inquirer.
+000094e0: 5061 7468 280a 2020 2020 2020 2020 2020  Path(.          
+000094f0: 2020 2020 2020 2020 2020 2020 2020 2773                's
+00009500: 6861 7265 645f 6469 7227 2c20 6d65 7373  hared_dir', mess
+00009510: 6167 653d 2745 6e74 6572 2074 6865 2070  age='Enter the p
+00009520: 6174 6820 746f 2061 2073 6861 7265 6420  ath to a shared 
+00009530: 636f 6e66 6967 2064 6972 6563 746f 7279  config directory
+00009540: 272c 2076 616c 6964 6174 653d 7365 6c66  ', validate=self
+00009550: 2e5f 5f69 6e71 7569 7265 725f 6368 6563  .__inquirer_chec
+00009560: 6b5f 7061 7468 5f65 7869 7374 7329 0a20  k_path_exists). 
+00009570: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00009580: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009590: 2020 2320 4765 7420 7468 6520 616e 7377    # Get the answ
+000095a0: 6572 2066 726f 6d20 7468 6520 7573 6572  er from the user
+000095b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000095c0: 2073 6861 7265 645f 636f 6e66 6967 5f64   shared_config_d
+000095d0: 6972 5f61 6e73 7765 7220 3d20 696e 7175  ir_answer = inqu
+000095e0: 6972 6572 2e70 726f 6d70 7428 0a20 2020  irer.prompt(.   
+000095f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009600: 2073 6861 7265 645f 636f 6e66 6967 5f64   shared_config_d
+00009610: 6972 5f71 7565 7374 696f 6e29 0a20 2020  ir_question).   
+00009620: 2020 2020 2020 2020 2020 2020 2073 6861               sha
+00009630: 7265 645f 636f 6e66 6967 5f64 6972 203d  red_config_dir =
+00009640: 2073 6861 7265 645f 636f 6e66 6967 5f64   shared_config_d
+00009650: 6972 5f61 6e73 7765 725b 2773 6861 7265  ir_answer['share
+00009660: 645f 6469 7227 5d0a 2020 2020 2020 2020  d_dir'].        
+00009670: 2020 2020 2020 2020 7368 6172 6564 5f63          shared_c
+00009680: 6f6e 6669 675f 6469 7220 3d20 6f73 2e70  onfig_dir = os.p
+00009690: 6174 682e 6578 7061 6e64 7573 6572 2873  ath.expanduser(s
+000096a0: 6861 7265 645f 636f 6e66 6967 5f64 6972  hared_config_dir
+000096b0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000096c0: 2020 2023 2043 7265 6174 6520 7468 6520     # Create the 
+000096d0: 6469 7265 6374 6f72 7920 696e 2063 6173  directory in cas
+000096e0: 6520 6974 2064 6f65 7320 6e6f 7420 6578  e it does not ex
+000096f0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00009700: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00009710: 7368 6172 6564 5f63 6f6e 6669 675f 6469  shared_config_di
+00009720: 722c 2065 7869 7374 5f6f 6b3d 5472 7565  r, exist_ok=True
+00009730: 2c20 6d6f 6465 3d30 6f37 3735 290a 0a20  , mode=0o775).. 
+00009740: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009750: 2041 736b 2074 6865 2075 7365 7220 6966   Ask the user if
+00009760: 2074 6865 7920 7761 6e74 2074 6f20 6d6f   they want to mo
+00009770: 7665 2074 6865 2066 726f 7374 6572 2d61  ve the froster-a
+00009780: 7263 6869 7665 732e 6a73 6f6e 2066 696c  rchives.json fil
+00009790: 6520 746f 2074 6865 2073 6861 7265 6420  e to the shared 
+000097a0: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
+000097b0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+000097c0: 7061 7468 2e69 7366 696c 6528 6f73 2e70  path.isfile(os.p
+000097d0: 6174 682e 6a6f 696e 2873 6861 7265 645f  ath.join(shared_
+000097e0: 636f 6e66 6967 5f64 6972 2c20 7365 6c66  config_dir, self
+000097f0: 2e61 7263 6869 7665 5f6a 736f 6e5f 6669  .archive_json_fi
+00009800: 6c65 5f6e 616d 6529 293a 0a20 2020 2020  le_name)):.     
+00009810: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009820: 2049 6620 7468 6520 6672 6f73 7465 722d   If the froster-
+00009830: 6172 6368 6976 6573 2e6a 736f 6e20 6669  archives.json fi
+00009840: 6c65 2069 7320 666f 756e 6420 696e 2074  le is found in t
+00009850: 6865 2073 6861 7265 6420 636f 6e66 6967  he shared config
+00009860: 2064 6972 6563 746f 7279 2077 6520 6172   directory we ar
+00009870: 6520 646f 6e65 2068 6572 650a 2020 2020  e done here.    
+00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009890: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+000098a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000098b0: 225c 6e4e 4f54 453a 2074 6865 207b 7365  "\nNOTE: the {se
+000098c0: 6c66 2e61 7263 6869 7665 5f6a 736f 6e5f  lf.archive_json_
+000098d0: 6669 6c65 5f6e 616d 657d 2066 696c 6520  file_name} file 
+000098e0: 7761 7320 666f 756e 6420 696e 2074 6865  was found in the
+000098f0: 2073 6861 7265 6420 636f 6e66 6967 2064   shared config d
+00009900: 6972 6563 746f 7279 5c6e 2229 0a20 2020  irectory\n").   
+00009910: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00009920: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00009930: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+00009940: 2066 726f 7374 6572 2d61 7263 6869 7665   froster-archive
+00009950: 732e 6a73 6f6e 2066 696c 6520 6973 2066  s.json file is f
+00009960: 6f75 6e64 2069 6e20 7468 6520 6c6f 6361  ound in the loca
+00009970: 6c20 6469 7265 6374 6f72 7920 7765 2061  l directory we a
+00009980: 736b 2074 6865 2075 7365 7220 6966 2074  sk the user if t
+00009990: 6865 7920 7761 6e74 2074 6f20 6d6f 7665  hey want to move
+000099a0: 2069 7420 746f 2074 6865 2073 6861 7265   it to the share
+000099b0: 6420 6469 7265 6374 6f72 790a 2020 2020  d directory.    
+000099c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099d0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+000099e0: 6528 6f73 2e70 6174 682e 6a6f 696e 2873  e(os.path.join(s
+000099f0: 656c 662e 6461 7461 5f64 6972 2c20 7365  elf.data_dir, se
+00009a00: 6c66 2e61 7263 6869 7665 5f6a 736f 6e5f  lf.archive_json_
+00009a10: 6669 6c65 5f6e 616d 6529 293a 0a20 2020  file_name)):.   
+00009a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a30: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+00009a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a50: 2020 2020 2020 2020 6622 5c6e 4e4f 5445          f"\nNOTE
+00009a60: 3a20 7468 6520 7b73 656c 662e 6172 6368  : the {self.arch
+00009a70: 6976 655f 6a73 6f6e 5f66 696c 655f 6e61  ive_json_file_na
+00009a80: 6d65 7d20 6669 6c65 2077 6173 2066 6f75  me} file was fou
+00009a90: 6e64 2069 6e20 7468 6520 6c6f 6361 6c20  nd in the local 
+00009aa0: 6469 7265 6374 6f72 795c 6e22 290a 0a20  directory\n").. 
+00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ac0: 2020 2020 2020 2023 2041 736b 2075 7365         # Ask use
+00009ad0: 7220 6966 2074 6865 7920 7761 6e74 2074  r if they want t
+00009ae0: 6f20 6d6f 7665 2074 6865 206c 6f63 616c  o move the local
+00009af0: 206c 6973 7420 6f66 2066 696c 6573 2061   list of files a
+00009b00: 6e64 2064 6972 6563 746f 7269 6573 2074  nd directories t
+00009b10: 6861 7420 7765 7265 2061 7263 6869 7665  hat were archive
+00009b20: 6420 746f 2074 6865 2073 6861 7265 6420  d to the shared 
+00009b30: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b50: 2020 6c6f 6361 6c5f 6672 6f73 7465 725f    local_froster_
+00009b60: 6172 6368 6976 6573 5f74 6f5f 7368 6172  archives_to_shar
+00009b70: 6564 203d 2069 6e71 7569 7265 722e 636f  ed = inquirer.co
+00009b80: 6e66 6972 6d28 0a20 2020 2020 2020 2020  nfirm(.         
+00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ba0: 2020 206d 6573 7361 6765 3d22 446f 2079     message="Do y
+00009bb0: 6f75 2077 616e 7420 746f 206d 6f76 6520  ou want to move 
+00009bc0: 7468 6520 6c6f 6361 6c20 6c69 7374 206f  the local list o
+00009bd0: 6620 6669 6c65 7320 616e 6420 6469 7265  f files and dire
+00009be0: 6374 6f72 6965 7320 7468 6174 2077 6572  ctories that wer
+00009bf0: 6520 6172 6368 6976 6564 2074 6f20 7468  e archived to th
+00009c00: 6520 7368 6172 6564 2064 6972 6563 746f  e shared directo
+00009c10: 7279 3f22 2c20 6465 6661 756c 743d 5472  ry?", default=Tr
+00009c20: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
+00009c30: 2020 2020 2020 2020 2020 2020 2023 204d               # M
+00009c40: 6f76 6520 7468 6520 6c6f 6361 6c20 6672  ove the local fr
+00009c50: 6f73 7465 7220 6172 6368 6976 6573 2074  oster archives t
+00009c60: 6f20 7368 6172 6564 2064 6972 6563 746f  o shared directo
+00009c70: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+00009c80: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
+00009c90: 6361 6c5f 6672 6f73 7465 725f 6172 6368  cal_froster_arch
+00009ca0: 6976 6573 5f74 6f5f 7368 6172 6564 3a0a  ives_to_shared:.
+00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cc0: 2020 2020 2020 2020 2020 2020 7368 7574              shut
+00009cd0: 696c 2e63 6f70 7928 6f73 2e70 6174 682e  il.copy(os.path.
+00009ce0: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d00: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
+00009d10: 6469 722c 2073 656c 662e 6172 6368 6976  dir, self.archiv
+00009d20: 655f 6a73 6f6e 5f66 696c 655f 6e61 6d65  e_json_file_name
+00009d30: 292c 2073 6861 7265 645f 636f 6e66 6967  ), shared_config
+00009d40: 5f64 6972 290a 2020 2020 2020 2020 2020  _dir).          
+00009d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d60: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+00009d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d80: 2020 2020 2020 2020 2066 225c 6e4e 4f54           f"\nNOT
+00009d90: 453a 204c 6f63 616c 206c 6973 7420 6f66  E: Local list of
+00009da0: 2061 7263 6869 7665 6420 6669 6c65 7320   archived files 
+00009db0: 616e 6420 6469 7265 6374 6f72 6965 7320  and directories 
+00009dc0: 7761 7320 6d6f 7665 6420 746f 207b 7368  was moved to {sh
+00009dd0: 6172 6564 5f63 6f6e 6669 675f 6469 727d  ared_config_dir}
+00009de0: 5c6e 2229 0a0a 2020 2020 2020 2020 2020  \n")..          
+00009df0: 2020 2320 5365 7420 7468 6520 7368 6172    # Set the shar
+00009e00: 6564 2066 6c61 6720 696e 2074 6865 2063  ed flag in the c
+00009e10: 6f6e 6669 6720 6669 6c65 0a20 2020 2020  onfig file.     
+00009e20: 2020 2020 2020 2073 656c 662e 5f5f 7365         self.__se
+00009e30: 745f 636f 6e66 6967 7572 6174 696f 6e5f  t_configuration_
+00009e40: 656e 7472 7928 2753 4841 5245 4427 2c20  entry('SHARED', 
+00009e50: 2769 735f 7368 6172 6564 272c 2069 735f  'is_shared', is_
+00009e60: 7368 6172 6564 290a 0a20 2020 2020 2020  shared)..       
+00009e70: 2020 2020 2023 2053 6574 2074 6865 2073       # Set the s
+00009e80: 6861 7265 6420 6469 7265 6374 6f72 7920  hared directory 
+00009e90: 696e 2074 6865 2063 6f6e 6669 6720 6669  in the config fi
+00009ea0: 6c65 2061 6e64 206d 6f76 6520 7468 6520  le and move the 
+00009eb0: 636f 6e66 6967 2066 696c 6520 7368 6172  config file shar
+00009ec0: 6564 2073 6563 7469 6f6e 7320 746f 2074  ed sections to t
+00009ed0: 6865 2073 6861 7265 6420 636f 6e66 6967  he shared config
+00009ee0: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00009ef0: 2020 6966 2069 735f 7368 6172 6564 3a0a    if is_shared:.
+00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f10: 7365 6c66 2e5f 5f73 6574 5f63 6f6e 6669  self.__set_confi
+00009f20: 6775 7261 7469 6f6e 5f65 6e74 7279 280a  guration_entry(.
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f40: 2020 2020 2753 4841 5245 4427 2c20 2773      'SHARED', 's
+00009f50: 6861 7265 645f 6469 7227 2c20 7368 6172  hared_dir', shar
+00009f60: 6564 5f63 6f6e 6669 675f 6469 7229 0a20  ed_config_dir). 
+00009f70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009f80: 656c 662e 5f5f 7365 745f 636f 6e66 6967  elf.__set_config
+00009f90: 7572 6174 696f 6e5f 656e 7472 7928 2753  uration_entry('S
+00009fa0: 4841 5245 4427 2c20 2773 6861 7265 645f  HARED', 'shared_
+00009fb0: 636f 6e66 6967 5f66 696c 6527 2c20 6f73  config_file', os
+00009fc0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fe0: 7368 6172 6564 5f63 6f6e 6669 675f 6469  shared_config_di
+00009ff0: 722c 2073 656c 662e 7368 6172 6564 5f63  r, self.shared_c
+0000a000: 6f6e 6669 675f 6669 6c65 5f6e 616d 6529  onfig_file_name)
+0000a010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a020: 2020 7365 6c66 2e5f 5f73 6574 5f73 6861    self.__set_sha
+0000a030: 7265 645f 6d6f 7665 5f63 6f6e 6669 6728  red_move_config(
+0000a040: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000a050: 2020 2073 656c 662e 6973 5f73 6861 7265     self.is_share
+0000a060: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0000a070: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a090: 6973 5f73 6861 7265 6420 3d20 4661 6c73  is_shared = Fals
+0000a0a0: 650a 0a20 2020 2020 2020 2020 2020 2070  e..            p
+0000a0b0: 7269 6e74 2866 272a 2a2a 2053 4841 5245  rint(f'*** SHARE
+0000a0c0: 4420 434f 4e46 4947 5552 4154 494f 4e20  D CONFIGURATION 
+0000a0d0: 444f 4e45 202a 2a2a 5c6e 2729 0a0a 2020  DONE ***\n')..  
+0000a0e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000a0f0: 2054 7275 650a 0a20 2020 2020 2020 2065   True..        e
+0000a100: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+0000a110: 2020 2070 7269 6e74 5f65 7272 6f72 2829     print_error()
+0000a120: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a130: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
+0000a140: 6566 205f 5f73 6574 5f73 6861 7265 645f  ef __set_shared_
+0000a150: 6d6f 7665 5f63 6f6e 6669 6728 7365 6c66  move_config(self
+0000a160: 293a 0a20 2020 2020 2020 2027 2727 4d6f  ):.        '''Mo
+0000a170: 7665 2074 6865 206c 6f63 616c 2063 6f6e  ve the local con
+0000a180: 6669 6775 7261 7469 6f6e 2073 6563 7469  figuration secti
+0000a190: 6f6e 7320 746f 2074 6865 2073 6861 7265  ons to the share
+0000a1a0: 6420 636f 6e66 6967 7572 6174 696f 6e20  d configuration 
+0000a1b0: 6669 6c65 2727 270a 0a20 2020 2020 2020  file'''..       
+0000a1c0: 2023 2049 6620 7368 6172 6564 2063 6f6e   # If shared con
+0000a1d0: 6669 6775 7261 7469 6f6e 2066 696c 6520  figuration file 
+0000a1e0: 6578 6973 7473 2c20 6e6f 7468 696e 6720  exists, nothing 
+0000a1f0: 746f 206d 6f76 650a 2020 2020 2020 2020  to move.        
+0000a200: 6966 2068 6173 6174 7472 2873 656c 662c  if hasattr(self,
+0000a210: 2027 7368 6172 6564 5f63 6f6e 6669 675f   'shared_config_
+0000a220: 6669 6c65 2729 2061 6e64 206f 732e 7061  file') and os.pa
+0000a230: 7468 2e69 7366 696c 6528 7365 6c66 2e73  th.isfile(self.s
+0000a240: 6861 7265 645f 636f 6e66 6967 5f66 696c  hared_config_fil
+0000a250: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000a260: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0000a270: 2020 2020 2020 2066 224e 4f54 453a 2055         f"NOTE: U
+0000a280: 7369 6e67 2073 6861 7265 6420 636f 6e66  sing shared conf
+0000a290: 6967 7572 6174 696f 6e20 6669 6c65 2066  iguration file f
+0000a2a0: 6f75 6e64 2069 6e20 7b73 656c 662e 7368  ound in {self.sh
+0000a2b0: 6172 6564 5f63 6f6e 6669 675f 6669 6c65  ared_config_file
+0000a2c0: 7d5c 6e22 290a 2020 2020 2020 2020 2020  }\n").          
+0000a2d0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0000a2e0: 2020 2320 436c 6561 6e20 7570 2062 6f74    # Clean up bot
+0000a2f0: 6820 636f 6e66 6967 7572 6174 696f 6e20  h configuration 
+0000a300: 6669 6c65 730a 2020 2020 2020 2020 6c6f  files.        lo
+0000a310: 6361 6c5f 636f 6e66 6967 203d 2063 6f6e  cal_config = con
+0000a320: 6669 6770 6172 7365 722e 436f 6e66 6967  figparser.Config
+0000a330: 5061 7273 6572 2829 0a20 2020 2020 2020  Parser().       
+0000a340: 206c 6f63 616c 5f63 6f6e 6669 672e 7265   local_config.re
+0000a350: 6164 2873 656c 662e 636f 6e66 6967 5f66  ad(self.config_f
+0000a360: 696c 6529 0a0a 2020 2020 2020 2020 6966  ile)..        if
+0000a370: 206e 6f74 2027 4e49 4827 2069 6e20 6c6f   not 'NIH' in lo
+0000a380: 6361 6c5f 636f 6e66 6967 2061 6e64 206e  cal_config and n
+0000a390: 6f74 2027 5333 2720 696e 206c 6f63 616c  ot 'S3' in local
+0000a3a0: 5f63 6f6e 6669 6720 616e 6420 6e6f 7420  _config and not 
+0000a3b0: 2753 4c55 524d 2720 696e 206c 6f63 616c  'SLURM' in local
+0000a3c0: 5f63 6f6e 6669 673a 0a20 2020 2020 2020  _config:.       
+0000a3d0: 2020 2020 2023 204e 6f74 6869 6e67 2074       # Nothing t
+0000a3e0: 6f20 636f 7079 2066 726f 6d20 6c6f 6361  o copy from loca
+0000a3f0: 6c20 636f 6e66 6967 7572 6174 696f 6e20  l configuration 
+0000a400: 746f 2073 6861 7265 6420 636f 6e66 6967  to shared config
+0000a410: 7572 6174 696f 6e0a 2020 2020 2020 2020  uration.        
+0000a420: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0000a430: 2020 2020 6d6f 7665 5f63 6f6e 6669 675f      move_config_
+0000a440: 746f 5f73 6861 7265 6420 3d20 696e 7175  to_shared = inqu
+0000a450: 6972 6572 2e63 6f6e 6669 726d 280a 2020  irer.confirm(.  
+0000a460: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+0000a470: 653d 2244 6f20 796f 7520 7761 6e74 2074  e="Do you want t
+0000a480: 6f20 6d6f 7665 2079 6f75 7220 6375 7272  o move your curr
+0000a490: 656e 7420 636f 6e66 6967 7572 6174 696f  ent configuratio
+0000a4a0: 6e20 746f 2074 6865 2073 6861 7265 6420  n to the shared 
+0000a4b0: 6469 7265 6374 6f72 793f 222c 2064 6566  directory?", def
+0000a4c0: 6175 6c74 3d54 7275 6529 0a0a 2020 2020  ault=True)..    
+0000a4d0: 2020 2020 6966 206d 6f76 655f 636f 6e66      if move_conf
+0000a4e0: 6967 5f74 6f5f 7368 6172 6564 3a0a 2020  ig_to_shared:.  
+0000a4f0: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
+0000a500: 2e63 6f70 7928 7365 6c66 2e63 6f6e 6669  .copy(self.confi
+0000a510: 675f 6669 6c65 2c20 7365 6c66 2e73 6861  g_file, self.sha
+0000a520: 7265 645f 636f 6e66 6967 5f66 696c 6529  red_config_file)
+0000a530: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000a540: 6e74 2822 4e4f 5445 3a20 5368 6172 6564  nt("NOTE: Shared
+0000a550: 2063 6f6e 6669 6775 7261 7469 6f6e 2066   configuration f
+0000a560: 696c 6520 7761 7320 6d6f 7665 6420 746f  ile was moved to
+0000a570: 2074 6865 2073 6861 7265 6420 6469 7265   the shared dire
+0000a580: 6374 6f72 795c 6e22 290a 0a20 2020 2020  ctory\n")..     
+0000a590: 2020 2020 2020 2073 6861 7265 645f 636f         shared_co
+0000a5a0: 6e66 6967 203d 2063 6f6e 6669 6770 6172  nfig = configpar
+0000a5b0: 7365 722e 436f 6e66 6967 5061 7273 6572  ser.ConfigParser
+0000a5c0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+0000a5d0: 6861 7265 645f 636f 6e66 6967 2e72 6561  hared_config.rea
+0000a5e0: 6428 7365 6c66 2e73 6861 7265 645f 636f  d(self.shared_co
+0000a5f0: 6e66 6967 5f66 696c 6529 0a0a 2020 2020  nfig_file)..    
+0000a600: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+0000a610: 2073 6563 7469 6f6e 7320 6672 6f6d 206c   sections from l
+0000a620: 6f63 616c 5f63 6f6e 6669 670a 2020 2020  ocal_config.    
+0000a630: 2020 2020 2020 2020 6966 2027 4e49 4827          if 'NIH'
+0000a640: 2069 6e20 6c6f 6361 6c5f 636f 6e66 6967   in local_config
+0000a650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a660: 2020 6c6f 6361 6c5f 636f 6e66 6967 2e72    local_config.r
+0000a670: 656d 6f76 655f 7365 6374 696f 6e28 274e  emove_section('N
+0000a680: 4948 2729 0a20 2020 2020 2020 2020 2020  IH').           
+0000a690: 2069 6620 2753 3327 2069 6e20 6c6f 6361   if 'S3' in loca
+0000a6a0: 6c5f 636f 6e66 6967 3a0a 2020 2020 2020  l_config:.      
+0000a6b0: 2020 2020 2020 2020 2020 6c6f 6361 6c5f            local_
+0000a6c0: 636f 6e66 6967 2e72 656d 6f76 655f 7365  config.remove_se
+0000a6d0: 6374 696f 6e28 2753 3327 290a 2020 2020  ction('S3').    
+0000a6e0: 2020 2020 2020 2020 6966 2027 534c 5552          if 'SLUR
+0000a6f0: 4d27 2069 6e20 6c6f 6361 6c5f 636f 6e66  M' in local_conf
+0000a700: 6967 3a0a 2020 2020 2020 2020 2020 2020  ig:.            
+0000a710: 2020 2020 6c6f 6361 6c5f 636f 6e66 6967      local_config
+0000a720: 2e72 656d 6f76 655f 7365 6374 696f 6e28  .remove_section(
+0000a730: 2753 4c55 524d 2729 0a0a 2020 2020 2020  'SLURM')..      
+0000a740: 2020 2020 2020 2320 5265 6d6f 7665 2073        # Remove s
+0000a750: 6563 7469 6f6e 7320 6672 6f6d 2073 6861  ections from sha
+0000a760: 7265 645f 636f 6e66 6967 0a20 2020 2020  red_config.     
+0000a770: 2020 2020 2020 2069 6620 2755 5345 5227         if 'USER'
+0000a780: 2069 6e20 7368 6172 6564 5f63 6f6e 6669   in shared_confi
+0000a790: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+0000a7a0: 2020 2073 6861 7265 645f 636f 6e66 6967     shared_config
+0000a7b0: 2e72 656d 6f76 655f 7365 6374 696f 6e28  .remove_section(
+0000a7c0: 2755 5345 5227 290a 2020 2020 2020 2020  'USER').        
+0000a7d0: 2020 2020 6966 2027 4157 5327 2069 6e20      if 'AWS' in 
+0000a7e0: 7368 6172 6564 5f63 6f6e 6669 673a 0a20  shared_config:. 
+0000a7f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000a800: 6861 7265 645f 636f 6e66 6967 2e72 656d  hared_config.rem
+0000a810: 6f76 655f 7365 6374 696f 6e28 2741 5753  ove_section('AWS
+0000a820: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+0000a830: 6620 2753 4841 5245 4427 2069 6e20 7368  f 'SHARED' in sh
+0000a840: 6172 6564 5f63 6f6e 6669 673a 0a20 2020  ared_config:.   
+0000a850: 2020 2020 2020 2020 2020 2020 2073 6861               sha
+0000a860: 7265 645f 636f 6e66 6967 2e72 656d 6f76  red_config.remov
+0000a870: 655f 7365 6374 696f 6e28 2753 4841 5245  e_section('SHARE
+0000a880: 4427 290a 0a20 2020 2020 2020 2020 2020  D')..           
+0000a890: 2023 2057 7269 7465 2074 6865 2073 6f75   # Write the sou
+0000a8a0: 7263 6520 494e 4920 6669 6c65 0a20 2020  rce INI file.   
+0000a8b0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0000a8c0: 656e 2873 656c 662e 636f 6e66 6967 5f66  en(self.config_f
+0000a8d0: 696c 652c 2027 7727 2920 6173 2066 3a0a  ile, 'w') as f:.
+0000a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8f0: 6c6f 6361 6c5f 636f 6e66 6967 2e77 7269  local_config.wri
+0000a900: 7465 2866 290a 0a20 2020 2020 2020 2020  te(f)..         
+0000a910: 2020 2023 2057 7269 7465 2074 6865 2073     # Write the s
+0000a920: 6f75 7263 6520 494e 4920 6669 6c65 0a20  ource INI file. 
+0000a930: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000a940: 6f70 656e 2873 656c 662e 7368 6172 6564  open(self.shared
+0000a950: 5f63 6f6e 6669 675f 6669 6c65 2c20 2777  _config_file, 'w
+0000a960: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+0000a970: 2020 2020 2020 2020 2073 6861 7265 645f           shared_
+0000a980: 636f 6e66 6967 2e77 7269 7465 2866 290a  config.write(f).
+0000a990: 0a20 2020 2064 6566 2073 6574 5f75 7365  .    def set_use
+0000a9a0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+0000a9b0: 2027 2727 5365 7420 7468 6520 7573 6572   '''Set the user
+0000a9c0: 2063 6f6e 6669 6775 7261 7469 6f6e 2727   configuration''
+0000a9d0: 270a 0a20 2020 2020 2020 2074 7279 3a0a  '..        try:.
+0000a9e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000a9f0: 7428 6627 5c6e 2a2a 2a20 5553 4552 2043  t(f'\n*** USER C
+0000aa00: 4f4e 4649 4755 5241 5449 4f4e 202a 2a2a  ONFIGURATION ***
+0000aa10: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
+0000aa20: 2020 2320 4173 6b20 7468 6520 7573 6572    # Ask the user
+0000aa30: 2066 6f72 2074 6865 6972 2066 756c 6c20   for their full 
+0000aa40: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+0000aa50: 2066 756c 6c6e 616d 6520 3d20 696e 7175   fullname = inqu
+0000aa60: 6972 6572 2e74 6578 7428 0a20 2020 2020  irer.text(.     
+0000aa70: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+0000aa80: 6765 3d22 456e 7465 7220 796f 7572 2066  ge="Enter your f
+0000aa90: 756c 6c20 6e61 6d65 222c 2076 616c 6964  ull name", valid
+0000aaa0: 6174 653d 7365 6c66 2e5f 5f69 6e71 7569  ate=self.__inqui
+0000aab0: 7265 725f 6368 6563 6b5f 7265 7175 6972  rer_check_requir
+0000aac0: 6564 290a 0a20 2020 2020 2020 2020 2020  ed)..           
+0000aad0: 2023 2050 7269 6e74 2066 6f72 2061 206e   # Print for a n
+0000aae0: 6577 206c 696e 6520 7768 656e 2070 726f  ew line when pro
+0000aaf0: 6d70 7469 6e67 0a20 2020 2020 2020 2020  mpting.         
+0000ab00: 2020 2070 7269 6e74 2829 0a0a 2020 2020     print()..    
+0000ab10: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
+0000ab20: 6520 7573 6572 2773 2066 756c 6c20 6e61  e user's full na
+0000ab30: 6d65 2069 6e20 7468 6520 636f 6e66 6967  me in the config
+0000ab40: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+0000ab50: 2020 7365 6c66 2e5f 5f73 6574 5f63 6f6e    self.__set_con
+0000ab60: 6669 6775 7261 7469 6f6e 5f65 6e74 7279  figuration_entry
+0000ab70: 2827 5553 4552 272c 2027 6e61 6d65 272c  ('USER', 'name',
+0000ab80: 2066 756c 6c6e 616d 6529 0a0a 2020 2020   fullname)..    
+0000ab90: 2020 2020 2020 2020 2320 4173 6b20 7468          # Ask th
+0000aba0: 6520 7573 6572 2066 6f72 2074 6865 6972  e user for their
+0000abb0: 2065 6d61 696c 0a20 2020 2020 2020 2020   email.         
+0000abc0: 2020 2065 6d61 696c 203d 2069 6e71 7569     email = inqui
+0000abd0: 7265 722e 7465 7874 286d 6573 7361 6765  rer.text(message
+0000abe0: 3d22 456e 7465 7220 796f 7572 2065 6d61  ="Enter your ema
+0000abf0: 696c 222c 0a20 2020 2020 2020 2020 2020  il",.           
+0000ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac10: 2020 2020 2020 2076 616c 6964 6174 653d         validate=
+0000ac20: 7365 6c66 2e5f 5f69 6e71 7569 7265 725f  self.__inquirer_
+0000ac30: 6368 6563 6b5f 656d 6169 6c5f 666f 726d  check_email_form
+0000ac40: 6174 290a 0a20 2020 2020 2020 2020 2020  at)..           
+0000ac50: 2023 2050 7269 6e74 2066 6f72 2061 206e   # Print for a n
+0000ac60: 6577 206c 696e 6520 7768 656e 2070 726f  ew line when pro
+0000ac70: 6d70 7469 6e67 0a20 2020 2020 2020 2020  mpting.         
+0000ac80: 2020 2070 7269 6e74 2829 0a0a 2020 2020     print()..    
+0000ac90: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
+0000aca0: 6520 7573 6572 2773 2065 6d61 696c 2069  e user's email i
+0000acb0: 6e20 7468 6520 636f 6e66 6967 2066 696c  n the config fil
+0000acc0: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+0000acd0: 6c66 2e5f 5f73 6574 5f63 6f6e 6669 6775  lf.__set_configu
+0000ace0: 7261 7469 6f6e 5f65 6e74 7279 2827 5553  ration_entry('US
+0000acf0: 4552 272c 2027 656d 6169 6c27 2c20 656d  ER', 'email', em
+0000ad00: 6169 6c29 0a0a 2020 2020 2020 2020 2020  ail)..          
+0000ad10: 2020 2320 5365 7420 7468 6520 7573 6572    # Set the user
+0000ad20: 2069 6e69 7420 666c 6167 0a20 2020 2020   init flag.     
+0000ad30: 2020 2020 2020 2073 656c 662e 7573 6572         self.user
+0000ad40: 5f69 6e69 7420 3d20 5472 7565 0a0a 2020  _init = True..  
+0000ad50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000ad60: 6627 2a2a 2a20 5553 4552 2043 4f4e 4649  f'*** USER CONFI
+0000ad70: 4755 5241 5449 4f4e 2044 4f4e 4520 2a2a  GURATION DONE **
+0000ad80: 2a5c 6e27 290a 0a20 2020 2020 2020 2020  *\n')..         
+0000ad90: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+0000ada0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0000adb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000adc0: 5f65 7272 6f72 2829 0a20 2020 2020 2020  _error().       
+0000add0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000ade0: 650a 0a20 2020 2064 6566 2073 6574 5f73  e..    def set_s
+0000adf0: 6c75 726d 2873 656c 662c 2061 7267 7329  lurm(self, args)
+0000ae00: 3a0a 2020 2020 2020 2020 2727 2753 6574  :.        '''Set
+0000ae10: 2074 6865 2053 6c75 726d 2063 6f6e 6669   the Slurm confi
+0000ae20: 6775 7261 7469 6f6e 2727 270a 0a20 2020  guration'''..   
+0000ae30: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000ae40: 2020 2020 2020 6966 2073 6875 7469 6c2e        if shutil.
+0000ae50: 7768 6963 6828 2773 636f 6e74 726f 6c27  which('scontrol'
+0000ae60: 2920 616e 6420 7368 7574 696c 2e77 6869  ) and shutil.whi
+0000ae70: 6368 2827 7361 6363 746d 6772 2729 3a0a  ch('sacctmgr'):.
+0000ae80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae90: 2070 7269 6e74 2866 275c 6e2a 2a2a 2053   print(f'\n*** S
+0000aea0: 4c55 524d 2043 4f4e 4649 4755 5241 5449  LURM CONFIGURATI
+0000aeb0: 4f4e 202a 2a2a 5c6e 2729 0a0a 2020 2020  ON ***\n')..    
+0000aec0: 2020 2020 2020 2020 2020 2020 736c 7572              slur
+0000aed0: 6d5f 7761 6c6c 7469 6d65 5f64 6179 7320  m_walltime_days 
+0000aee0: 3d20 696e 7175 6972 6572 2e74 6578 7428  = inquirer.text(
+0000aef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000af00: 2020 2020 206d 6573 7361 6765 3d22 5365       message="Se
+0000af10: 7420 7468 6520 536c 7572 6d20 2d2d 7469  t the Slurm --ti
+0000af20: 6d65 2028 6461 7973 2920 666f 7220 6672  me (days) for fr
+0000af30: 6f73 7465 7220 6a6f 6273 2028 6465 6661  oster jobs (defa
+0000af40: 756c 7420 3d20 3729 222c 0a20 2020 2020  ult = 7)",.     
+0000af50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000af60: 6566 6175 6c74 3d37 2c0a 2020 2020 2020  efault=7,.      
+0000af70: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000af80: 6c69 6461 7465 3d73 656c 662e 5f5f 696e  lidate=self.__in
+0000af90: 7175 6972 6572 5f63 6865 636b 5f69 735f  quirer_check_is_
+0000afa0: 6e75 6d62 6572 290a 0a20 2020 2020 2020  number)..       
+0000afb0: 2020 2020 2020 2020 2073 6c75 726d 5f77           slurm_w
+0000afc0: 616c 6c74 696d 655f 686f 7572 7320 3d20  alltime_hours = 
+0000afd0: 696e 7175 6972 6572 2e74 6578 7428 0a20  inquirer.text(. 
+0000afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aff0: 2020 206d 6573 7361 6765 3d22 5365 7420     message="Set 
+0000b000: 7468 6520 536c 7572 6d20 2d2d 7469 6d65  the Slurm --time
+0000b010: 2028 686f 7572 7329 2066 6f72 2066 726f   (hours) for fro
+0000b020: 7374 6572 206a 6f62 7320 2864 6566 6175  ster jobs (defau
+0000b030: 6c74 203d 2030 2922 2c0a 2020 2020 2020  lt = 0)",.      
+0000b040: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000b050: 6661 756c 743d 302c 0a20 2020 2020 2020  fault=0,.       
+0000b060: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000b070: 6964 6174 653d 7365 6c66 2e5f 5f69 6e71  idate=self.__inq
+0000b080: 7569 7265 725f 6368 6563 6b5f 6973 5f6e  uirer_check_is_n
+0000b090: 756d 6265 7229 0a0a 2020 2020 2020 2020  umber)..        
+0000b0a0: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
+0000b0b0: 5468 6973 2063 6c61 7373 205f 5f69 6e69  This class __ini
+0000b0c0: 745f 5f20 7368 6f75 6c64 206e 6f74 2062  t__ should not b
+0000b0d0: 6520 6865 7265 2c20 6974 2073 686f 756c  e here, it shoul
+0000b0e0: 6420 6265 2069 6e20 7468 6520 6d61 696e  d be in the main
+0000b0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b100: 2073 6520 3d20 536c 7572 6d45 7373 656e   se = SlurmEssen
+0000b110: 7469 616c 7328 6172 6773 2c20 7365 6c66  tials(args, self
+0000b120: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000b130: 2020 2023 2047 6574 2074 6865 2061 6c6c     # Get the all
+0000b140: 6f77 6564 2070 6172 7469 7469 6f6e 7320  owed partitions 
+0000b150: 616e 6420 514f 530a 2020 2020 2020 2020  and QOS.        
+0000b160: 2020 2020 2020 2020 7061 7274 7320 3d20          parts = 
+0000b170: 7365 2e67 6574 5f61 6c6c 6f77 6564 5f70  se.get_allowed_p
+0000b180: 6172 7469 7469 6f6e 735f 616e 645f 716f  artitions_and_qo
+0000b190: 7328 290a 0a20 2020 2020 2020 2020 2020  s()..           
+0000b1a0: 2020 2020 2069 6620 7061 7274 7320 6973       if parts is
+0000b1b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000b1d0: 2041 736b 2074 6865 2075 7365 7220 746f   Ask the user to
+0000b1e0: 2073 656c 6563 7420 7468 6520 536c 7572   select the Slur
+0000b1f0: 6d20 7061 7274 6974 696f 6e20 616e 6420  m partition and 
+0000b200: 514f 530a 2020 2020 2020 2020 2020 2020  QOS.            
+0000b210: 2020 2020 2020 2020 736c 7572 6d5f 7061          slurm_pa
+0000b220: 7274 6974 696f 6e20 3d20 696e 7175 6972  rtition = inquir
+0000b230: 6572 2e6c 6973 745f 696e 7075 7428 0a20  er.list_input(. 
+0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b250: 2020 2020 2020 206d 6573 7361 6765 3d66         message=f
+0000b260: 2753 656c 6563 7420 7468 6520 536c 7572  'Select the Slur
+0000b270: 6d20 7061 7274 6974 696f 6e20 666f 7220  m partition for 
+0000b280: 6a6f 6273 2074 6861 7420 6c61 7374 2075  jobs that last u
+0000b290: 7020 746f 207b 736c 7572 6d5f 7761 6c6c  p to {slurm_wall
+0000b2a0: 7469 6d65 5f64 6179 737d 2064 6179 7320  time_days} days 
+0000b2b0: 616e 6420 7b73 6c75 726d 5f77 616c 6c74  and {slurm_wallt
+0000b2c0: 696d 655f 686f 7572 737d 2068 6f75 7273  ime_hours} hours
+0000b2d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000b2e0: 2020 2020 2020 2020 2020 2063 686f 6963             choic
+0000b2f0: 6573 3d6c 6973 7428 7061 7274 732e 6b65  es=list(parts.ke
+0000b300: 7973 2829 2929 0a0a 2020 2020 2020 2020  ys()))..        
+0000b310: 2020 2020 2020 2020 2020 2020 2320 4173              # As
+0000b320: 6b20 7468 6520 7573 6572 2074 6f20 7365  k the user to se
+0000b330: 6c65 6374 2074 6865 2053 6c75 726d 2051  lect the Slurm Q
+0000b340: 4f53 0a20 2020 2020 2020 2020 2020 2020  OS.             
+0000b350: 2020 2020 2020 2073 6c75 726d 5f71 6f73         slurm_qos
+0000b360: 203d 2069 6e71 7569 7265 722e 6c69 7374   = inquirer.list
+0000b370: 5f69 6e70 7574 280a 2020 2020 2020 2020  _input(.        
+0000b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b390: 6d65 7373 6167 653d 6627 5365 6c65 6374  message=f'Select
+0000b3a0: 2074 6865 2053 6c75 726d 2051 4f53 2066   the Slurm QOS f
+0000b3b0: 6f72 206a 6f62 7320 7468 6174 206c 6173  or jobs that las
+0000b3c0: 7420 7570 2074 6f20 7b73 6c75 726d 5f77  t up to {slurm_w
+0000b3d0: 616c 6c74 696d 655f 6461 7973 7d20 6461  alltime_days} da
+0000b3e0: 7973 2061 6e64 207b 736c 7572 6d5f 7761  ys and {slurm_wa
+0000b3f0: 6c6c 7469 6d65 5f68 6f75 7273 7d20 686f  lltime_hours} ho
+0000b400: 7572 7327 2c0a 2020 2020 2020 2020 2020  urs',.          
+0000b410: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0000b420: 6f69 6365 733d 6c69 7374 2870 6172 7473  oices=list(parts
+0000b430: 5b73 6c75 726d 5f70 6172 7469 7469 6f6e  [slurm_partition
+0000b440: 5d29 290a 0a20 2020 2020 2020 2020 2020  ]))..           
+0000b450: 2020 2020 2023 2053 6574 2074 6865 2053       # Set the S
+0000b460: 6c75 726d 2063 6f6e 6669 6775 7261 7469  lurm configurati
+0000b470: 6f6e 2069 6e20 7468 6520 636f 6e66 6967  on in the config
+0000b480: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+0000b490: 2020 2020 2020 7365 6c66 2e5f 5f73 6574        self.__set
+0000b4a0: 5f63 6f6e 6669 6775 7261 7469 6f6e 5f65  _configuration_e
+0000b4b0: 6e74 7279 280a 2020 2020 2020 2020 2020  ntry(.          
+0000b4c0: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
+0000b4d0: 272c 2027 736c 7572 6d5f 7761 6c6c 7469  ', 'slurm_wallti
+0000b4e0: 6d65 5f64 6179 7327 2c20 736c 7572 6d5f  me_days', slurm_
+0000b4f0: 7761 6c6c 7469 6d65 5f64 6179 7329 0a20  walltime_days). 
+0000b500: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b510: 656c 662e 5f5f 7365 745f 636f 6e66 6967  elf.__set_config
+0000b520: 7572 6174 696f 6e5f 656e 7472 7928 0a20  uration_entry(. 
+0000b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b540: 2020 2027 534c 5552 4d27 2c20 2773 6c75     'SLURM', 'slu
+0000b550: 726d 5f77 616c 6c74 696d 655f 686f 7572  rm_walltime_hour
+0000b560: 7327 2c20 736c 7572 6d5f 7761 6c6c 7469  s', slurm_wallti
+0000b570: 6d65 5f68 6f75 7273 290a 2020 2020 2020  me_hours).      
+0000b580: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000b590: 5f73 6574 5f63 6f6e 6669 6775 7261 7469  _set_configurati
+0000b5a0: 6f6e 5f65 6e74 7279 280a 2020 2020 2020  on_entry(.      
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2753                'S
+0000b5c0: 4c55 524d 272c 2027 736c 7572 6d5f 7061  LURM', 'slurm_pa
+0000b5d0: 7274 6974 696f 6e27 2c20 736c 7572 6d5f  rtition', slurm_
+0000b5e0: 7061 7274 6974 696f 6e29 0a20 2020 2020  partition).     
+0000b5f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b600: 5f5f 7365 745f 636f 6e66 6967 7572 6174  __set_configurat
+0000b610: 696f 6e5f 656e 7472 7928 2753 4c55 524d  ion_entry('SLURM
+0000b620: 272c 2027 736c 7572 6d5f 716f 7327 2c20  ', 'slurm_qos', 
+0000b630: 736c 7572 6d5f 716f 7329 0a0a 2020 2020  slurm_qos)..    
+0000b640: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000b650: 6875 7469 6c2e 7768 6963 6828 2773 6261  hutil.which('sba
+0000b660: 7463 6827 293a 0a20 2020 2020 2020 2020  tch'):.         
+0000b670: 2020 2020 2020 2020 2020 2073 6c75 726d             slurm
+0000b680: 5f6c 7363 7261 7463 6820 3d20 696e 7175  _lscratch = inqu
+0000b690: 6972 6572 2e74 6578 7428 0a20 2020 2020  irer.text(.     
+0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6b0: 2020 206d 6573 7361 6765 3d22 486f 7720     message="How 
+0000b6c0: 646f 2079 6f75 2072 6571 7565 7374 206c  do you request l
+0000b6d0: 6f63 616c 2073 6372 6174 6368 2066 726f  ocal scratch fro
+0000b6e0: 6d20 536c 7572 6d3f 2028 4f70 7469 6f6e  m Slurm? (Option
+0000b6f0: 616c 3a20 7072 6573 7320 656e 7465 7220  al: press enter 
+0000b700: 746f 2073 6b69 7029 2229 0a20 2020 2020  to skip)").     
+0000b710: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000b720: 7363 7261 7463 685f 6d6b 6469 7220 3d20  scratch_mkdir = 
+0000b730: 696e 7175 6972 6572 2e74 6578 7428 0a20  inquirer.text(. 
+0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b750: 2020 2020 2020 206d 6573 7361 6765 3d22         message="
+0000b760: 4973 2074 6865 7265 2061 2075 7365 7220  Is there a user 
+0000b770: 7363 7269 7074 2074 6861 7420 7072 6f76  script that prov
+0000b780: 6973 696f 6e73 206c 6f63 616c 2073 6372  isions local scr
+0000b790: 6174 6368 3f20 284f 7074 696f 6e61 6c3a  atch? (Optional:
+0000b7a0: 2070 7265 7373 2065 6e74 6572 2074 6f20   press enter to 
+0000b7b0: 736b 6970 2922 290a 2020 2020 2020 2020  skip)").        
+0000b7c0: 2020 2020 2020 2020 2020 2020 6c73 6372              lscr
+0000b7d0: 6174 6368 5f72 6d64 6972 203d 2069 6e71  atch_rmdir = inq
+0000b7e0: 7569 7265 722e 7465 7874 280a 2020 2020  uirer.text(.    
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 6d65 7373 6167 653d 2249 7320      message="Is 
+0000b810: 7468 6572 6520 6120 7573 6572 2073 6372  there a user scr
+0000b820: 6970 7420 7468 6174 2074 6561 7273 2064  ipt that tears d
+0000b830: 6f77 6e20 6c6f 6361 6c20 7363 7261 7463  own local scratc
+0000b840: 6820 6174 2074 6865 2065 6e64 3f20 284f  h at the end? (O
+0000b850: 7074 696f 6e61 6c3a 2070 7265 7373 2065  ptional: press e
+0000b860: 6e74 6572 2074 6f20 736b 6970 2922 290a  nter to skip)").
 0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b880: 2020 2020 2020 2070 775f 6469 7273 756d         pw_dirsum
-0000b890: 2f31 3034 3835 3736 2f70 775f 6663 6f75  /1048576/pw_fcou
-0000b8a0: 6e74 2061 7320 4d69 4241 7667 2c0a 2020  nt as MiBAvg,.  
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 2020 6669 6c65 6e61 6d65 2061 7320 466f    filename as Fo
-0000b8e0: 6c64 6572 2c20 4749 4420 6173 2047 726f  lder, GID as Gro
-0000b8f0: 7570 2c0a 2020 2020 2020 2020 2020 2020  up,.            
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b910: 2020 2020 2020 2020 7077 5f64 6972 7375          pw_dirsu
-0000b920: 6d2f 3130 3939 3531 3136 3237 3737 3620  m/1099511627776 
-0000b930: 6173 2054 6942 2c0a 2020 2020 2020 2020  as TiB,.        
+0000b880: 2020 2020 6c73 6372 6174 6368 5f72 6f6f      lscratch_roo
+0000b890: 7420 3d20 696e 7175 6972 6572 2e74 6578  t = inquirer.tex
+0000b8a0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0000b8b0: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+0000b8c0: 6765 3d22 5768 6174 2069 7320 7468 6520  ge="What is the 
+0000b8d0: 6c6f 6361 6c20 7363 7261 7463 6820 726f  local scratch ro
+0000b8e0: 6f74 3f20 284f 7074 696f 6e61 6c3a 2070  ot? (Optional: p
+0000b8f0: 7265 7373 2065 6e74 6572 2074 6f20 736b  ress enter to sk
+0000b900: 6970 2922 290a 0a20 2020 2020 2020 2020  ip)")..         
+0000b910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b920: 5f5f 7365 745f 636f 6e66 6967 7572 6174  __set_configurat
+0000b930: 696f 6e5f 656e 7472 7928 0a20 2020 2020  ion_entry(.     
 0000b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b950: 2020 2020 2020 2020 2020 2020 7077 5f66              pw_f
-0000b960: 636f 756e 7420 6173 2046 696c 6543 6f75  count as FileCou
-0000b970: 6e74 2c20 7077 5f64 6972 7375 6d20 6173  nt, pw_dirsum as
-0000b980: 2044 6972 5369 7a65 0a20 2020 2020 2020   DirSize.       
-0000b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9a0: 2020 2020 2020 2020 2046 524f 4d20 7265           FROM re
-0000b9b0: 6164 5f63 7376 5f61 7574 6f28 277b 7077  ad_csv_auto('{pw
-0000b9c0: 616c 6b5f 6f75 7470 7574 5f66 6f6c 6465  alk_output_folde
-0000b9d0: 7273 5f63 6f6e 7665 7274 6564 2e6e 616d  rs_converted.nam
-0000b9e0: 657d 272c 0a20 2020 2020 2020 2020 2020  e}',.           
-0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba00: 2020 2020 2020 2020 2020 2020 2069 676e               ign
-0000ba10: 6f72 655f 6572 726f 7273 3d31 290a 2020  ore_errors=1).  
-0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba30: 2020 2020 2020 2020 2020 2020 2020 5748                WH
-0000ba40: 4552 4520 7077 5f66 636f 756e 7420 3e20  ERE pw_fcount > 
-0000ba50: 2d31 2041 4e44 2070 775f 6469 7273 756d  -1 AND pw_dirsum
-0000ba60: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
+0000b950: 2020 2027 534c 5552 4d27 2c20 2773 6c75     'SLURM', 'slu
+0000b960: 726d 5f6c 7363 7261 7463 6827 2c20 736c  rm_lscratch', sl
+0000b970: 7572 6d5f 6c73 6372 6174 6368 290a 2020  urm_lscratch).  
+0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b990: 2020 7365 6c66 2e5f 5f73 6574 5f63 6f6e    self.__set_con
+0000b9a0: 6669 6775 7261 7469 6f6e 5f65 6e74 7279  figuration_entry
+0000b9b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000b9c0: 2020 2020 2020 2020 2020 2753 4c55 524d            'SLURM
+0000b9d0: 272c 2027 6c73 6372 6174 6368 5f6d 6b64  ', 'lscratch_mkd
+0000b9e0: 6972 272c 206c 7363 7261 7463 685f 6d6b  ir', lscratch_mk
+0000b9f0: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
+0000ba00: 2020 2020 2020 2020 2073 656c 662e 5f5f           self.__
+0000ba10: 7365 745f 636f 6e66 6967 7572 6174 696f  set_configuratio
+0000ba20: 6e5f 656e 7472 7928 0a20 2020 2020 2020  n_entry(.       
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba40: 2027 534c 5552 4d27 2c20 276c 7363 7261   'SLURM', 'lscra
+0000ba50: 7463 685f 726d 6469 7227 2c20 6c73 6372  tch_rmdir', lscr
+0000ba60: 6174 6368 5f72 6d64 6972 290a 2020 2020  atch_rmdir).    
 0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba80: 2020 2020 204f 5244 4552 2042 5920 7077       ORDER BY pw
-0000ba90: 5f64 6972 7375 6d20 4465 7363 0a20 2020  _dirsum Desc.   
+0000ba80: 7365 6c66 2e5f 5f73 6574 5f63 6f6e 6669  self.__set_confi
+0000ba90: 6775 7261 7469 6f6e 5f65 6e74 7279 280a  guration_entry(.
 0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 2020 2020 2020 2020 2022 2222 2020 2320           """  # 
-0000bac0: 7077 5f64 6972 7375 6d20 3e20 3130 3733  pw_dirsum > 1073
-0000bad0: 3734 3138 3234 0a0a 2020 2020 2020 2020  741824..        
-0000bae0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-0000baf0: 6e6e 6563 7420 746f 2061 6e20 696e 2d6d  nnect to an in-m
-0000bb00: 656d 6f72 7920 4475 636b 4442 2069 6e73  emory DuckDB ins
-0000bb10: 7461 6e63 650a 2020 2020 2020 2020 2020  tance.          
-0000bb20: 2020 2020 2020 2020 2020 6475 636b 6462            duckdb
-0000bb30: 5f63 6f6e 6e65 6374 696f 6e20 3d20 6475  _connection = du
-0000bb40: 636b 6462 2e63 6f6e 6e65 6374 2827 3a6d  ckdb.connect(':m
-0000bb50: 656d 6f72 793a 2729 0a0a 2020 2020 2020  emory:')..      
-0000bb60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000bb70: 5365 7420 7468 6520 6e75 6d62 6572 206f  Set the number o
-0000bb80: 6620 7468 7265 6164 7320 746f 2075 7365  f threads to use
-0000bb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bba0: 2020 2020 2064 7563 6b64 625f 636f 6e6e       duckdb_conn
-0000bbb0: 6563 7469 6f6e 2e65 7865 6375 7465 280a  ection.execute(.
-0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbd0: 2020 2020 2020 2020 6627 5052 4147 4d41          f'PRAGMA
-0000bbe0: 2074 6872 6561 6473 3d7b 7365 6c66 2e61   threads={self.a
-0000bbf0: 7267 732e 636f 7265 737d 3b27 290a 0a20  rgs.cores};').. 
-0000bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc10: 2020 2023 2045 7865 6375 7465 2074 6865     # Execute the
-0000bc20: 2053 514c 2071 7565 7279 0a20 2020 2020   SQL query.     
-0000bc30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000bc40: 6f77 7320 3d20 6475 636b 6462 5f63 6f6e  ows = duckdb_con
-0000bc50: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
-0000bc60: 7371 6c5f 7175 6572 7929 2e66 6574 6368  sql_query).fetch
-0000bc70: 616c 6c28 290a 0a20 2020 2020 2020 2020  all()..         
-0000bc80: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-0000bc90: 2074 6865 2063 6f6c 756d 6e20 6e61 6d65   the column name
-0000bca0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0000bcb0: 2020 2020 2020 6865 6164 6572 203d 2064        header = d
-0000bcc0: 7563 6b64 625f 636f 6e6e 6563 7469 6f6e  uckdb_connection
-0000bcd0: 2e65 7865 6375 7465 2873 716c 5f71 7565  .execute(sql_que
-0000bce0: 7279 292e 6465 7363 7269 7074 696f 6e0a  ry).description.
-0000bcf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bd00: 2020 2020 2023 2043 6c6f 7365 2074 6865       # Close the
-0000bd10: 2044 7563 6b44 4220 636f 6e6e 6563 7469   DuckDB connecti
-0000bd20: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0000bd30: 2020 2020 2020 2064 7563 6b64 625f 636f         duckdb_co
-0000bd40: 6e6e 6563 7469 6f6e 2e63 6c6f 7365 2829  nnection.close()
-0000bd50: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-0000bd60: 7570 2076 6172 6961 626c 6573 2066 6f72  up variables for
-0000bd70: 2074 6865 2068 6f74 7370 6f74 730a 2020   the hotspots.  
-0000bd80: 2020 2020 2020 746f 7461 6c62 7974 6573        totalbytes
-0000bd90: 203d 2030 0a20 2020 2020 2020 206e 756d   = 0.        num
-0000bda0: 686f 7473 706f 7473 203d 2030 0a20 2020  hotspots = 0.   
-0000bdb0: 2020 2020 2061 6765 6462 7974 6573 203d       agedbytes =
-0000bdc0: 205b 305d 202a 206c 656e 2864 6179 7361   [0] * len(daysa
-0000bdd0: 6765 6429 0a0a 2020 2020 2020 2020 2320  ged)..        # 
-0000bde0: 4765 7420 7468 6520 7061 7468 2074 6f20  Get the path to 
-0000bdf0: 7468 6520 686f 7473 706f 7473 2043 5356  the hotspots CSV
-0000be00: 2066 696c 650a 2020 2020 2020 2020 6d79   file.        my
-0000be10: 6373 7620 3d20 7365 6c66 2e67 6574 5f68  csv = self.get_h
-0000be20: 6f74 7370 6f74 735f 7061 7468 2866 6f6c  otspots_path(fol
-0000be30: 6465 7229 0a0a 2020 2020 2020 2020 2320  der)..        # 
-0000be40: 5772 6974 6520 7468 6520 686f 7473 706f  Write the hotspo
-0000be50: 7473 2074 6f20 7468 6520 4353 5620 6669  ts to the CSV fi
-0000be60: 6c65 0a20 2020 2020 2020 2077 6974 6820  le.        with 
-0000be70: 6f70 656e 286d 7963 7376 2c20 2777 2729  open(mycsv, 'w')
-0000be80: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0000be90: 2020 2077 7269 7465 7220 3d20 6373 762e     writer = csv.
-0000bea0: 7772 6974 6572 2866 2c20 6469 616c 6563  writer(f, dialec
-0000beb0: 743d 2765 7863 656c 2729 0a20 2020 2020  t='excel').     
-0000bec0: 2020 2020 2020 2077 7269 7465 722e 7772         writer.wr
-0000bed0: 6974 6572 6f77 285b 636f 6c5b 305d 2066  iterow([col[0] f
-0000bee0: 6f72 2063 6f6c 2069 6e20 6865 6164 6572  or col in header
-0000bef0: 5d29 0a20 2020 2020 2020 2020 2020 2023  ]).            #
-0000bf00: 2030 3a55 7372 2c31 3a41 6363 442c 323a   0:Usr,1:AccD,2:
-0000bf10: 4d6f 6444 2c33 3a47 6942 2c34 3a4d 6942  ModD,3:GiB,4:MiB
-0000bf20: 4176 672c 353a 466f 6c64 6572 2c36 3a47  Avg,5:Folder,6:G
-0000bf30: 7270 2c37 3a54 6942 2c38 3a46 696c 6543  rp,7:TiB,8:FileC
-0000bf40: 6f75 6e74 2c39 3a44 6972 5369 7a65 0a20  ount,9:DirSize. 
-0000bf50: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-0000bf60: 2069 6e20 726f 7773 3a0a 2020 2020 2020   in rows:.      
-0000bf70: 2020 2020 2020 2020 2020 726f 7720 3d20            row = 
-0000bf80: 6c69 7374 2872 290a 2020 2020 2020 2020  list(r).        
-0000bf90: 2020 2020 2020 2020 6966 2072 6f77 5b33          if row[3
-0000bfa0: 5d20 3e3d 2073 656c 662e 7468 7265 7368  ] >= self.thresh
-0000bfb0: 6f6c 6447 4220 616e 6420 726f 775b 345d  oldGB and row[4]
-0000bfc0: 203e 3d20 7365 6c66 2e74 6872 6573 686f   >= self.thresho
-0000bfd0: 6c64 4d42 3a0a 2020 2020 2020 2020 2020  ldMB:.          
-0000bfe0: 2020 2020 2020 2020 2020 6174 696d 6520            atime 
-0000bff0: 3d20 7365 6c66 2e5f 6765 745f 6e65 7765  = self._get_newe
-0000c000: 7374 5f66 696c 655f 6174 696d 6528 726f  st_file_atime(ro
-0000c010: 775b 355d 2c20 726f 775b 315d 290a 2020  w[5], row[1]).  
-0000c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c030: 2020 6d74 696d 6520 3d20 7365 6c66 2e5f    mtime = self._
-0000c040: 6765 745f 6e65 7765 7374 5f66 696c 655f  get_newest_file_
-0000c050: 6d74 696d 6528 726f 775b 355d 2c20 726f  mtime(row[5], ro
-0000c060: 775b 325d 290a 2020 2020 2020 2020 2020  w[2]).          
-0000c070: 2020 2020 2020 2020 2020 726f 775b 305d            row[0]
-0000c080: 203d 2073 656c 662e 7569 6432 7573 6572   = self.uid2user
-0000c090: 2872 6f77 5b30 5d29 0a20 2020 2020 2020  (row[0]).       
-0000c0a0: 2020 2020 2020 2020 2020 2020 2072 6f77               row
-0000c0b0: 5b31 5d20 3d20 7365 6c66 2e64 6179 7361  [1] = self.daysa
-0000c0c0: 676f 2861 7469 6d65 290a 2020 2020 2020  go(atime).      
-0000c0d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-0000c0e0: 775b 325d 203d 2073 656c 662e 6461 7973  w[2] = self.days
-0000c0f0: 6167 6f28 6d74 696d 6529 0a20 2020 2020  ago(mtime).     
-0000c100: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c110: 6f77 5b33 5d20 3d20 696e 7428 726f 775b  ow[3] = int(row[
-0000c120: 335d 290a 2020 2020 2020 2020 2020 2020  3]).            
-0000c130: 2020 2020 2020 2020 726f 775b 345d 203d          row[4] =
-0000c140: 2069 6e74 2872 6f77 5b34 5d29 0a20 2020   int(row[4]).   
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 2072 6f77 5b36 5d20 3d20 7365 6c66 2e67   row[6] = self.g
-0000c170: 6964 3267 726f 7570 2872 6f77 5b36 5d29  id2group(row[6])
-0000c180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c190: 2020 2020 2072 6f77 5b37 5d20 3d20 696e       row[7] = in
-0000c1a0: 7428 726f 775b 375d 290a 2020 2020 2020  t(row[7]).      
-0000c1b0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-0000c1c0: 6974 6572 2e77 7269 7465 726f 7728 726f  iter.writerow(ro
-0000c1d0: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
-0000c1e0: 2020 2020 2020 206e 756d 686f 7473 706f         numhotspo
-0000c1f0: 7473 202b 3d20 310a 2020 2020 2020 2020  ts += 1.        
-0000c200: 2020 2020 2020 2020 2020 2020 746f 7461              tota
-0000c210: 6c62 7974 6573 202b 3d20 726f 775b 395d  lbytes += row[9]
-0000c220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c230: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0000c240: 6e67 6528 302c 206c 656e 2864 6179 7361  nge(0, len(daysa
-0000c250: 6765 6429 293a 0a20 2020 2020 2020 2020  ged)):.         
-0000c260: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c270: 6620 726f 775b 315d 203e 2064 6179 7361  f row[1] > daysa
-0000c280: 6765 645b 695d 3a0a 2020 2020 2020 2020  ged[i]:.        
-0000c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2a0: 2020 2020 6966 2069 203d 3d20 303a 0a20      if i == 0:. 
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c2d0: 2049 7320 7468 6973 2072 6561 6c6c 7920   Is this really 
-0000c2e0: 3135 2079 6561 7273 203f 0a20 2020 2020  15 years ?.     
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c300: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000c310: 6462 6728 0a20 2020 2020 2020 2020 2020  dbg(.           
-0000c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c330: 2020 2020 2020 2020 2066 2720 207b 726f           f'  {ro
-0000c340: 775b 355d 7d20 6861 7320 6e6f 7420 6265  w[5]} has not be
-0000c350: 656e 2061 6363 6573 7365 6420 666f 7220  en accessed for 
-0000c360: 7b72 6f77 5b31 5d7d 2064 6179 732e 2028  {row[1]} days. (
-0000c370: 6174 696d 6520 3d20 7b61 7469 6d65 7d29  atime = {atime})
-0000c380: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000c3a0: 6765 6462 7974 6573 5b69 5d20 2b3d 2072  gedbytes[i] += r
-0000c3b0: 6f77 5b39 5d0a 0a20 2020 2020 2020 2070  ow[9]..        p
-0000c3c0: 7269 6e74 2866 2720 2020 202e 2e2e 696e  rint(f'    ...in
-0000c3d0: 6465 7869 6e67 2064 6f6e 652e 2729 0a0a  dexing done.')..
-0000c3e0: 2020 2020 2020 2020 7072 696e 7428 7465          print(te
-0000c3f0: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
-0000c400: 2727 0a20 2020 2020 2020 2020 2020 2048  ''.            H
-0000c410: 6f74 7370 6f74 7320 6669 6c65 3a20 7b6d  otspots file: {m
-0000c420: 7963 7376 7d0a 2020 2020 2020 2020 2020  ycsv}.          
-0000c430: 2020 2020 2020 7769 7468 207b 6e75 6d68        with {numh
-0000c440: 6f74 7370 6f74 737d 2068 6f74 7370 6f74  otspots} hotspot
-0000c450: 7320 3e3d 207b 7365 6c66 2e74 6872 6573  s >= {self.thres
-0000c460: 686f 6c64 4742 7d20 4769 420a 2020 2020  holdGB} GiB.    
-0000c470: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000c480: 2061 2074 6f74 616c 2064 6973 6b20 7573   a total disk us
-0000c490: 6520 6f66 207b 726f 756e 6428 746f 7461  e of {round(tota
-0000c4a0: 6c62 7974 6573 2f54 6942 2c33 297d 2054  lbytes/TiB,3)} T
-0000c4b0: 6942 0a20 2020 2020 2020 2020 2020 2027  iB.            '
-0000c4c0: 2727 2929 0a0a 2020 2020 2020 2020 7072  ''))..        pr
-0000c4d0: 696e 7428 6627 546f 7461 6c20 666f 6c64  int(f'Total fold
-0000c4e0: 6572 7320 7072 6f63 6573 7365 643a 207b  ers processed: {
-0000c4f0: 6c65 6e28 726f 7773 297d 2729 0a0a 2020  len(rows)}')..  
-0000c500: 2020 2020 2020 6c61 7374 6167 6564 6279        lastagedby
-0000c510: 7465 7320 3d20 300a 2020 2020 2020 2020  tes = 0.        
-0000c520: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-0000c530: 2c20 6c65 6e28 6461 7973 6167 6564 2929  , len(daysaged))
-0000c540: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000c550: 2061 6765 6462 7974 6573 5b69 5d20 3e20   agedbytes[i] > 
-0000c560: 3020 616e 6420 6167 6564 6279 7465 735b  0 and agedbytes[
-0000c570: 695d 2021 3d20 6c61 7374 6167 6564 6279  i] != lastagedby
-0000c580: 7465 733a 0a20 2020 2020 2020 2020 2020  tes:.           
-0000c590: 2020 2020 2023 2064 6564 656e 7465 6420       # dedented 
-0000c5a0: 6d75 6c74 692d 6c69 6e65 2072 656d 6f76  multi-line remov
-0000c5b0: 696e 6720 5c6e 0a20 2020 2020 2020 2020  ing \n.         
-0000c5c0: 2020 2020 2020 2070 7269 6e74 2874 6578         print(tex
-0000c5d0: 7477 7261 702e 6465 6465 6e74 2866 2727  twrap.dedent(f''
-0000c5e0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000c5f0: 2020 7b72 6f75 6e64 2861 6765 6462 7974    {round(agedbyt
-0000c600: 6573 5b69 5d2f 5469 422c 3329 7d20 5469  es[i]/TiB,3)} Ti
-0000c610: 4220 6861 7665 206e 6f74 2062 6565 6e20  B have not been 
-0000c620: 6163 6365 7373 6564 0a20 2020 2020 2020  accessed.       
-0000c630: 2020 2020 2020 2020 2066 6f72 207b 6461           for {da
-0000c640: 7973 6167 6564 5b69 5d7d 2064 6179 7320  ysaged[i]} days 
-0000c650: 286f 7220 7b72 6f75 6e64 2864 6179 7361  (or {round(daysa
-0000c660: 6765 645b 695d 2f33 3635 2c31 297d 2079  ged[i]/365,1)} y
-0000c670: 6561 7273 290a 2020 2020 2020 2020 2020  ears).          
-0000c680: 2020 2020 2020 2727 2729 2e72 6570 6c61        ''').repla
-0000c690: 6365 2827 5c6e 272c 2027 2729 290a 2020  ce('\n', '')).  
-0000c6a0: 2020 2020 2020 2020 2020 6c61 7374 6167            lastag
-0000c6b0: 6564 6279 7465 7320 3d20 6167 6564 6279  edbytes = agedby
-0000c6c0: 7465 735b 695d 0a0a 2020 2020 2020 2020  tes[i]..        
-0000c6d0: 2320 4f75 7470 7574 2064 6563 6f72 6174  # Output decorat
-0000c6e0: 696f 6e20 7072 696e 740a 2020 2020 2020  ion print.      
-0000c6f0: 2020 7072 696e 7428 290a 0a20 2020 2064    print()..    d
-0000c700: 6566 205f 696e 6465 785f 736c 7572 6d28  ef _index_slurm(
-0000c710: 7365 6c66 2c20 666f 6c64 6572 7329 3a0a  self, folders):.
-0000c720: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-0000c730: 5265 7669 6577 2073 6c75 726d 2069 6d70  Review slurm imp
-0000c740: 6c65 6d65 6e74 6174 696f 6e20 7265 6761  lementation rega
-0000c750: 7264 696e 6720 6e65 7720 6368 616e 6765  rding new change
-0000c760: 730a 2020 2020 2020 2020 7365 203d 2053  s.        se = S
-0000c770: 6c75 726d 4573 7365 6e74 6961 6c73 2873  lurmEssentials(s
-0000c780: 656c 662e 6172 6773 2c20 7365 6c66 2e63  elf.args, self.c
-0000c790: 6667 290a 2020 2020 2020 2020 6c61 6265  fg).        labe
-0000c7a0: 6c20 3d20 7365 6c66 2e5f 6765 745f 686f  l = self._get_ho
-0000c7b0: 7473 706f 7473 5f66 696c 6528 666f 6c64  tspots_file(fold
-0000c7c0: 6572 735b 305d 292e 7265 706c 6163 6528  ers[0]).replace(
-0000c7d0: 272e 6373 7627 2c20 2727 290a 2020 2020  '.csv', '').    
-0000c7e0: 2020 2020 6c61 6265 6c20 3d20 6c61 6265      label = labe
-0000c7f0: 6c2e 7265 706c 6163 6528 2720 272c 2027  l.replace(' ', '
-0000c800: 5f27 290a 2020 2020 2020 2020 7368 6f72  _').        shor
-0000c810: 746c 6162 656c 203d 206f 732e 7061 7468  tlabel = os.path
-0000c820: 2e62 6173 656e 616d 6528 666f 6c64 6572  .basename(folder
-0000c830: 735b 305d 290a 0a20 2020 2020 2020 2073  s[0])..        s
-0000c840: 652e 6164 645f 6c69 6e65 2866 2723 5342  e.add_line(f'#SB
-0000c850: 4154 4348 202d 2d6a 6f62 2d6e 616d 653d  ATCH --job-name=
-0000c860: 6672 6f73 7465 723a 696e 6465 783a 7b73  froster:index:{s
-0000c870: 686f 7274 6c61 6265 6c7d 2729 0a20 2020  hortlabel}').   
-0000c880: 2020 2020 2073 652e 6164 645f 6c69 6e65       se.add_line
-0000c890: 2866 2723 5342 4154 4348 202d 2d63 7075  (f'#SBATCH --cpu
-0000c8a0: 732d 7065 722d 7461 736b 3d7b 7365 6c66  s-per-task={self
-0000c8b0: 2e61 7267 732e 636f 7265 737d 2729 0a20  .args.cores}'). 
-0000c8c0: 2020 2020 2020 2073 652e 6164 645f 6c69         se.add_li
-0000c8d0: 6e65 2866 2723 5342 4154 4348 202d 2d6d  ne(f'#SBATCH --m
-0000c8e0: 656d 3d36 3447 2729 0a20 2020 2020 2020  em=64G').       
-0000c8f0: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-0000c900: 5342 4154 4348 202d 2d6f 7574 7075 743d  SBATCH --output=
-0000c910: 6672 6f73 7465 722d 696e 6465 782d 7b6c  froster-index-{l
-0000c920: 6162 656c 7d2d 254a 2e6f 7574 2729 0a20  abel}-%J.out'). 
-0000c930: 2020 2020 2020 2073 652e 6164 645f 6c69         se.add_li
-0000c940: 6e65 2866 2723 5342 4154 4348 202d 2d6d  ne(f'#SBATCH --m
-0000c950: 6169 6c2d 7479 7065 3d46 4149 4c2c 5245  ail-type=FAIL,RE
-0000c960: 5155 4555 452c 454e 4427 290a 2020 2020  QUEUE,END').    
-0000c970: 2020 2020 7365 2e61 6464 5f6c 696e 6528      se.add_line(
-0000c980: 6627 2353 4241 5443 4820 2d2d 6d61 696c  f'#SBATCH --mail
-0000c990: 2d75 7365 723d 7b73 656c 662e 6366 672e  -user={self.cfg.
-0000c9a0: 656d 6169 6c7d 2729 0a20 2020 2020 2020  email}').       
-0000c9b0: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-0000c9c0: 5342 4154 4348 202d 2d74 696d 653d 7b73  SBATCH --time={s
-0000c9d0: 652e 7761 6c6c 7469 6d65 7d27 290a 2020  e.walltime}').  
-0000c9e0: 2020 2020 2020 6966 2073 652e 7061 7274        if se.part
-0000c9f0: 6974 696f 6e3a 0a20 2020 2020 2020 2020  ition:.         
-0000ca00: 2020 2073 652e 6164 645f 6c69 6e65 2866     se.add_line(f
-0000ca10: 2723 5342 4154 4348 202d 2d70 6172 7469  '#SBATCH --parti
-0000ca20: 7469 6f6e 3d7b 7365 2e70 6172 7469 7469  tion={se.partiti
-0000ca30: 6f6e 7d27 290a 2020 2020 2020 2020 6966  on}').        if
-0000ca40: 2073 652e 716f 733a 0a20 2020 2020 2020   se.qos:.       
-0000ca50: 2020 2020 2073 652e 6164 645f 6c69 6e65       se.add_line
-0000ca60: 2866 2723 5342 4154 4348 202d 2d71 6f73  (f'#SBATCH --qos
-0000ca70: 3d7b 7365 2e71 6f73 7d27 290a 2020 2020  ={se.qos}').    
-0000ca80: 2020 2020 2320 7365 2e61 6464 5f6c 696e      # se.add_lin
-0000ca90: 6528 6627 6d6c 2070 7974 686f 6e27 290a  e(f'ml python').
-0000caa0: 2020 2020 2020 2020 636d 646c 696e 6520          cmdline 
-0000cab0: 3d20 2220 222e 6a6f 696e 286d 6170 2873  = " ".join(map(s
-0000cac0: 686c 6578 2e71 756f 7465 2c20 7379 732e  hlex.quote, sys.
-0000cad0: 6172 6776 2929 2020 2320 6f72 6967 696e  argv))  # origin
-0000cae0: 616c 2063 6d64 6c69 6e65 0a20 2020 2020  al cmdline.     
-0000caf0: 2020 2063 6d64 6c69 6e65 203d 2063 6d64     cmdline = cmd
-0000cb00: 6c69 6e65 2e72 6570 6c61 6365 2827 2f66  line.replace('/f
-0000cb10: 726f 7374 6572 2e70 7920 272c 2027 2f66  roster.py ', '/f
-0000cb20: 726f 7374 6572 2027 290a 2020 2020 2020  roster ').      
-0000cb30: 2020 6966 2073 656c 662e 6172 6773 2e64    if self.args.d
-0000cb40: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
-0000cb50: 2020 7072 696e 7428 6627 436f 6d6d 616e    print(f'Comman
-0000cb60: 6420 6c69 6e65 2070 6173 7365 6420 746f  d line passed to
-0000cb70: 2053 6c75 726d 3a5c 6e7b 636d 646c 696e   Slurm:\n{cmdlin
-0000cb80: 657d 2729 0a20 2020 2020 2020 2073 652e  e}').        se.
-0000cb90: 6164 645f 6c69 6e65 2863 6d64 6c69 6e65  add_line(cmdline
-0000cba0: 290a 2020 2020 2020 2020 6a6f 6269 6420  ).        jobid 
-0000cbb0: 3d20 7365 2e73 6261 7463 6828 290a 2020  = se.sbatch().  
-0000cbc0: 2020 2020 2020 7072 696e 7428 6627 5375        print(f'Su
-0000cbd0: 626d 6974 7465 6420 6672 6f73 7465 7220  bmitted froster 
-0000cbe0: 696e 6465 7869 6e67 206a 6f62 3a20 7b6a  indexing job: {j
-0000cbf0: 6f62 6964 7d27 290a 2020 2020 2020 2020  obid}').        
-0000cc00: 7072 696e 7428 6627 4368 6563 6b20 4a6f  print(f'Check Jo
-0000cc10: 6220 4f75 7470 7574 3a27 290a 2020 2020  b Output:').    
-0000cc20: 2020 2020 7072 696e 7428 6627 2074 6169      print(f' tai
-0000cc30: 6c20 2d66 2066 726f 7374 6572 2d69 6e64  l -f froster-ind
-0000cc40: 6578 2d7b 6c61 6265 6c7d 2d7b 6a6f 6269  ex-{label}-{jobi
-0000cc50: 647d 2e6f 7574 2729 0a0a 2020 2020 6465  d}.out')..    de
-0000cc60: 6620 696e 6465 7828 7365 6c66 2c20 666f  f index(self, fo
-0000cc70: 6c64 6572 7329 3a0a 2020 2020 2020 2020  lders):.        
-0000cc80: 2727 2749 6e64 6578 2074 6865 2067 6976  '''Index the giv
-0000cc90: 656e 2066 6f6c 6465 7273 2066 6f72 2061  en folders for a
-0000cca0: 7263 6869 7669 6e67 2727 270a 0a20 2020  rchiving'''..   
-0000ccb0: 2020 2020 2023 2069 6620 736c 7572 6d20       # if slurm 
-0000ccc0: 6e6f 7420 6176 6169 6c61 626c 652c 206f  not available, o
-0000ccd0: 7220 6e6f 736c 7572 6d20 666c 6167 2073  r noslurm flag s
-0000cce0: 6574 206f 7220 736c 7572 6d20 6973 2061  et or slurm is a
-0000ccf0: 6c72 6561 6479 2072 756e 6e69 6e67 2061  lready running a
-0000cd00: 206a 6f62 2c20 7468 656e 2072 756e 2074   job, then run t
-0000cd10: 6865 2069 6e64 6578 696e 6720 6c6f 6361  he indexing loca
-0000cd20: 6c6c 790a 2020 2020 2020 2020 6966 206e  lly.        if n
-0000cd30: 6f74 2073 6875 7469 6c2e 7768 6963 6828  ot shutil.which(
-0000cd40: 2773 6261 7463 6827 2920 6f72 2073 656c  'sbatch') or sel
-0000cd50: 662e 6172 6773 2e6e 6f73 6c75 726d 206f  f.args.noslurm o
-0000cd60: 7220 6f73 2e67 6574 656e 7628 2753 4c55  r os.getenv('SLU
-0000cd70: 524d 5f4a 4f42 5f49 4427 293a 0a20 2020  RM_JOB_ID'):.   
-0000cd80: 2020 2020 2020 2020 2066 6f72 2066 6f6c           for fol
-0000cd90: 6465 7220 696e 2066 6f6c 6465 7273 3a0a  der in folders:.
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdb0: 7365 6c66 2e5f 696e 6465 785f 6c6f 6361  self._index_loca
-0000cdc0: 6c6c 7928 666f 6c64 6572 290a 2020 2020  lly(folder).    
-0000cdd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000cde0: 2020 2020 2020 7365 6c66 2e5f 696e 6465        self._inde
-0000cdf0: 785f 736c 7572 6d28 666f 6c64 6572 7329  x_slurm(folders)
-0000ce00: 0a0a 2020 2020 6465 6620 6172 6368 6976  ..    def archiv
-0000ce10: 655f 7365 6c65 6374 5f68 6f74 7370 6f74  e_select_hotspot
-0000ce20: 7328 7365 6c66 293a 0a0a 2020 2020 2020  s(self):..      
-0000ce30: 2020 2320 4765 7420 7468 6520 686f 7473    # Get the hots
-0000ce40: 706f 7473 2064 6972 6563 746f 7279 0a20  pots directory. 
-0000ce50: 2020 2020 2020 2068 6f74 7370 6f74 735f         hotspots_
-0000ce60: 6469 7220 3d20 7365 6c66 2e63 6667 2e73  dir = self.cfg.s
-0000ce70: 6861 7265 645f 686f 7473 706f 7473 5f64  hared_hotspots_d
-0000ce80: 6972 2069 6620 7365 6c66 2e63 6667 2e69  ir if self.cfg.i
-0000ce90: 735f 7368 6172 6564 2065 6c73 6520 7365  s_shared else se
-0000cea0: 6c66 2e63 6667 2e68 6f74 7370 6f74 735f  lf.cfg.hotspots_
-0000ceb0: 6469 720a 0a20 2020 2020 2020 2023 2043  dir..        # C
-0000cec0: 6865 636b 2069 6620 7468 6520 486f 7473  heck if the Hots
-0000ced0: 706f 7473 2064 6972 6563 746f 7279 2065  pots directory e
-0000cee0: 7869 7374 730a 2020 2020 2020 2020 6966  xists.        if
-0000cef0: 206e 6f74 2068 6f74 7370 6f74 735f 6469   not hotspots_di
-0000cf00: 7220 6f72 206e 6f74 206f 732e 7061 7468  r or not os.path
-0000cf10: 2e65 7869 7374 7328 686f 7473 706f 7473  .exists(hotspots
-0000cf20: 5f64 6972 293a 0a20 2020 2020 2020 2020  _dir):.         
-0000cf30: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0000cf40: 2020 2020 2020 2020 2020 275c 6e4e 6f20            '\nNo 
-0000cf50: 666f 6c64 6572 7320 746f 2061 7263 6869  folders to archi
-0000cf60: 7665 2069 6e20 6172 6775 6d65 6e74 7320  ve in arguments 
-0000cf70: 616e 6420 6e6f 2048 6f74 7370 6f74 7320  and no Hotspots 
-0000cf80: 4353 5620 6669 6c65 7320 666f 756e 642e  CSV files found.
-0000cf90: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-0000cfa0: 7072 696e 7428 275c 6e46 6f72 2061 7263  print('\nFor arc
-0000cfb0: 6869 7665 2061 2073 7065 6369 6669 6320  hive a specific 
-0000cfc0: 666f 6c64 6572 2072 756e 3a27 290a 2020  folder run:').  
-0000cfd0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000cfe0: 2720 2020 2066 726f 7374 6572 2061 7263  '    froster arc
-0000cff0: 6869 7665 2022 2f79 6f75 722f 666f 6c64  hive "/your/fold
-0000d000: 6572 2f74 6f2f 6172 6368 6976 6522 2729  er/to/archive"')
-0000d010: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000d020: 696e 7428 275c 6e20 466f 7220 696e 6465  int('\n For inde
-0000d030: 7820 6120 666f 6c64 6572 2061 2066 696e  x a folder a fin
-0000d040: 6420 686f 7473 706f 7473 2072 756e 3a27  d hotspots run:'
-0000d050: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0000d060: 696e 7428 2720 2020 2066 726f 7374 6572  int('    froster
-0000d070: 2069 6e64 6578 2022 2f79 6f75 722f 666f   index "/your/fo
-0000d080: 6c64 6572 2f74 6f2f 696e 6465 7822 5c6e  lder/to/index"\n
-0000d090: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-0000d0a0: 7973 2e65 7869 7428 3029 0a0a 2020 2020  ys.exit(0)..    
-0000d0b0: 2020 2020 2320 4765 7420 616c 6c20 7468      # Get all th
-0000d0c0: 6520 686f 7473 706f 7420 4353 5620 6669  e hotspot CSV fi
-0000d0d0: 6c65 7320 696e 2074 6865 2068 6f74 7370  les in the hotsp
-0000d0e0: 6f74 7320 6469 7265 6374 6f72 790a 2020  ots directory.  
-0000d0f0: 2020 2020 2020 686f 7473 706f 7473 5f66        hotspots_f
-0000d100: 696c 6573 203d 205b 6620 666f 7220 6620  iles = [f for f 
-0000d110: 696e 206f 732e 6c69 7374 6469 7228 0a20  in os.listdir(. 
-0000d120: 2020 2020 2020 2020 2020 2068 6f74 7370             hotsp
-0000d130: 6f74 735f 6469 7229 2069 6620 666e 6d61  ots_dir) if fnma
-0000d140: 7463 682e 666e 6d61 7463 6828 662c 2027  tch.fnmatch(f, '
-0000d150: 2a2e 6373 7627 295d 0a0a 2020 2020 2020  *.csv')]..      
-0000d160: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
-0000d170: 7265 2061 7265 2043 5356 2066 696c 6573  re are CSV files
-0000d180: 2c20 6966 2064 6f6e 2774 2074 6865 7265  , if don't there
-0000d190: 2061 7265 206e 6f20 666f 6c64 6572 7320   are no folders 
-0000d1a0: 746f 2061 7263 6869 7665 0a20 2020 2020  to archive.     
-0000d1b0: 2020 2069 6620 6e6f 7420 686f 7473 706f     if not hotspo
-0000d1c0: 7473 5f66 696c 6573 3a0a 2020 2020 2020  ts_files:.      
-0000d1d0: 2020 2020 2020 7072 696e 7428 275c 6e4e        print('\nN
-0000d1e0: 6f20 686f 7470 6f73 7473 2066 6f75 6e64  o hotposts found
-0000d1f0: 2e20 5c6e 2729 0a0a 2020 2020 2020 2020  . \n')..        
-0000d200: 2020 2020 7072 696e 7428 6627 596f 7520      print(f'You 
-0000d210: 6361 6e20 7365 6172 6368 2066 6f72 2068  can search for h
-0000d220: 6f74 7370 6f74 2062 7920 696e 6465 7869  otspot by indexi
-0000d230: 6e67 2066 6f6c 6465 7273 2075 7369 6e67  ng folders using
-0000d240: 2063 6f6d 6d61 6e64 3a27 290a 2020 2020   command:').    
-0000d250: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0000d260: 2020 2066 726f 7374 6572 2069 6e64 6578     froster index
-0000d270: 2022 2f79 6f75 722f 666f 6c64 6572 2f74   "/your/folder/t
-0000d280: 6f2f 696e 6465 7822 5c6e 2729 0a0a 2020  o/index"\n')..  
-0000d290: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000d2a0: 2746 6f72 2061 7263 6869 7665 2061 2073  'For archive a s
-0000d2b0: 7065 6369 6669 6320 666f 6c64 6572 2072  pecific folder r
-0000d2c0: 756e 3a27 290a 2020 2020 2020 2020 2020  un:').          
-0000d2d0: 2020 7072 696e 7428 2720 2020 2066 726f    print('    fro
-0000d2e0: 7374 6572 2061 7263 6869 7665 2022 2f79  ster archive "/y
-0000d2f0: 6f75 722f 666f 6c64 6572 2f74 6f2f 6172  our/folder/to/ar
-0000d300: 6368 6976 6522 5c6e 2729 0a20 2020 2020  chive"\n').     
-0000d310: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-0000d320: 3029 0a0a 2020 2020 2020 2020 2320 536f  0)..        # So
-0000d330: 7274 2074 6865 2043 5356 2066 696c 6573  rt the CSV files
-0000d340: 2062 7920 7468 6569 7220 6d6f 6469 6669   by their modifi
-0000d350: 6361 7469 6f6e 2074 696d 6520 696e 2064  cation time in d
-0000d360: 6573 6365 6e64 696e 6720 6f72 6465 7220  escending order 
-0000d370: 286e 6577 6573 7420 6669 7273 7429 0a20  (newest first). 
-0000d380: 2020 2020 2020 2068 6f74 7370 6f74 735f         hotspots_
-0000d390: 6669 6c65 732e 736f 7274 286b 6579 3d6c  files.sort(key=l
-0000d3a0: 616d 6264 6120 783a 206f 732e 7061 7468  ambda x: os.path
-0000d3b0: 2e67 6574 6d74 696d 6528 0a20 2020 2020  .getmtime(.     
-0000d3c0: 2020 2020 2020 206f 732e 7061 7468 2e6a         os.path.j
-0000d3d0: 6f69 6e28 686f 7473 706f 7473 5f64 6972  oin(hotspots_dir
-0000d3e0: 2c20 7829 292c 2072 6576 6572 7365 3d54  , x)), reverse=T
-0000d3f0: 7275 6529 0a0a 2020 2020 2020 2020 2320  rue)..        # 
-0000d400: 4173 6b20 7468 6520 7573 6572 2074 6f20  Ask the user to 
-0000d410: 7365 6c65 6374 2061 2048 6f74 7370 6f74  select a Hotspot
-0000d420: 2066 696c 650a 2020 2020 2020 2020 7265   file.        re
-0000d430: 7420 3d20 5465 7874 7561 6c53 7472 696e  t = TextualStrin
-0000d440: 674c 6973 7453 656c 6563 746f 7228 0a20  gListSelector(. 
-0000d450: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0000d460: 3d22 5365 6c65 6374 2061 2048 6f74 7370  ="Select a Hotsp
-0000d470: 6f74 2066 696c 6522 2c20 6974 656d 733d  ot file", items=
-0000d480: 686f 7473 706f 7473 5f66 696c 6573 292e  hotspots_files).
-0000d490: 7275 6e28 290a 0a20 2020 2020 2020 2023  run()..        #
-0000d4a0: 204e 6f20 6669 6c65 2073 656c 6563 7465   No file selecte
-0000d4b0: 640a 2020 2020 2020 2020 6966 206e 6f74  d.        if not
-0000d4c0: 2072 6574 3a0a 2020 2020 2020 2020 2020   ret:.          
-0000d4d0: 2020 7379 732e 6578 6974 2830 290a 0a20    sys.exit(0).. 
-0000d4e0: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
-0000d4f0: 2073 656c 6563 7465 6420 4353 5620 6669   selected CSV fi
-0000d500: 6c65 0a20 2020 2020 2020 2068 6f74 7370  le.        hotsp
-0000d510: 6f74 5f73 656c 6563 7465 6420 3d20 6f73  ot_selected = os
-0000d520: 2e70 6174 682e 6a6f 696e 2868 6f74 7370  .path.join(hotsp
-0000d530: 6f74 735f 6469 722c 2072 6574 5b30 5d29  ots_dir, ret[0])
-0000d540: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-0000d550: 7468 6520 666f 6c64 6572 7320 746f 2061  the folders to a
-0000d560: 7263 6869 7665 2066 726f 6d20 7468 6520  rchive from the 
-0000d570: 7365 6c65 6374 6564 2048 6f74 7370 6f74  selected Hotspot
-0000d580: 2066 696c 650a 2020 2020 2020 2020 666f   file.        fo
-0000d590: 6c64 6572 735f 746f 5f61 7263 6869 7665  lders_to_archive
-0000d5a0: 203d 2073 656c 662e 6765 745f 686f 7473   = self.get_hots
-0000d5b0: 706f 745f 666f 6c64 6572 7328 686f 7473  pot_folders(hots
-0000d5c0: 706f 745f 7365 6c65 6374 6564 290a 0a20  pot_selected).. 
-0000d5d0: 2020 2020 2020 2023 2041 7263 6869 7669         # Archivi
-0000d5e0: 6e67 206f 7074 696f 6e73 0a20 2020 2020  ng options.     
-0000d5f0: 2020 2061 7263 6869 7669 6e67 5f6f 7074     archiving_opt
-0000d600: 696f 6e73 203d 205b 2741 7263 6869 7665  ions = ['Archive
-0000d610: 2061 6c6c 2068 6f74 7370 6f74 7327 2c0a   all hotspots',.
-0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 2020 2020 2020 2020 2020 2020 2027 4172               'Ar
-0000d640: 6368 6976 6520 6f6e 6520 686f 7473 706f  chive one hotspo
-0000d650: 7427 2c20 2743 616e 6365 6c27 5d0a 0a20  t', 'Cancel'].. 
-0000d660: 2020 2020 2020 2023 2041 736b 2074 6865         # Ask the
-0000d670: 2075 7365 7220 686f 7720 746f 2070 726f   user how to pro
-0000d680: 6365 6564 2077 6974 6820 7468 6520 6172  ceed with the ar
-0000d690: 6368 6976 696e 6720 7072 6f63 6573 730a  chiving process.
-0000d6a0: 2020 2020 2020 2020 6172 6368 6976 655f          archive_
-0000d6b0: 7072 6f63 6564 7572 6520 3d20 696e 7175  procedure = inqu
-0000d6c0: 6972 6572 2e6c 6973 745f 696e 7075 7428  irer.list_input(
-0000d6d0: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
-0000d6e0: 7361 6765 3d66 2248 6f77 2073 686f 756c  sage=f"How shoul
-0000d6f0: 6420 7765 2070 726f 6365 6564 2077 6974  d we proceed wit
-0000d700: 6820 7468 6520 6172 6368 6976 696e 6720  h the archiving 
-0000d710: 7072 6f63 6573 733f 222c 0a20 2020 2020  process?",.     
-0000d720: 2020 2020 2020 2063 686f 6963 6573 3d61         choices=a
-0000d730: 7263 6869 7669 6e67 5f6f 7074 696f 6e73  rchiving_options
-0000d740: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
-0000d750: 6661 756c 743d 2743 616e 6365 6c27 290a  fault='Cancel').
-0000d760: 0a20 2020 2020 2020 2069 6620 6172 6368  .        if arch
-0000d770: 6976 655f 7072 6f63 6564 7572 6520 3d3d  ive_procedure ==
-0000d780: 2027 4172 6368 6976 6520 616c 6c20 686f   'Archive all ho
-0000d790: 7473 706f 7473 273a 0a20 2020 2020 2020  tspots':.       
-0000d7a0: 2020 2020 2023 2044 6f20 6e6f 7468 696e       # Do nothin
-0000d7b0: 672c 2077 6520 616c 7265 6164 7920 6861  g, we already ha
-0000d7c0: 7665 2074 6865 2066 6f6c 6465 7273 206c  ve the folders l
-0000d7d0: 6973 7420 746f 2061 7263 6869 7665 0a20  ist to archive. 
-0000d7e0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-0000d7f0: 0a20 2020 2020 2020 2065 6c69 6620 6172  .        elif ar
-0000d800: 6368 6976 655f 7072 6f63 6564 7572 6520  chive_procedure 
-0000d810: 3d3d 2027 4172 6368 6976 6520 6f6e 6520  == 'Archive one 
-0000d820: 686f 7473 706f 7427 3a0a 2020 2020 2020  hotspot':.      
-0000d830: 2020 2020 2020 7265 7420 3d20 5465 7874        ret = Text
-0000d840: 7561 6c53 7472 696e 674c 6973 7453 656c  ualStringListSel
-0000d850: 6563 746f 7228 0a20 2020 2020 2020 2020  ector(.         
-0000d860: 2020 2020 2020 2074 6974 6c65 3d22 5365         title="Se
-0000d870: 6c65 6374 2068 6f74 7370 6f74 2074 6f20  lect hotspot to 
-0000d880: 6172 6368 6976 6520 222c 2069 7465 6d73  archive ", items
-0000d890: 3d66 6f6c 6465 7273 5f74 6f5f 6172 6368  =folders_to_arch
-0000d8a0: 6976 6529 2e72 756e 2829 0a20 2020 2020  ive).run().     
-0000d8b0: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-0000d8c0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0000d8d0: 2020 2023 204e 6f20 6669 6c65 2073 656c     # No file sel
-0000d8e0: 6563 7465 640a 2020 2020 2020 2020 2020  ected.          
-0000d8f0: 2020 2020 2020 7379 732e 6578 6974 2830        sys.exit(0
-0000d900: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000d910: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d920: 2020 2020 666f 6c64 6572 735f 746f 5f61      folders_to_a
-0000d930: 7263 6869 7665 203d 205b 7265 745b 305d  rchive = [ret[0]
-0000d940: 5d0a 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
-0000d950: 6172 6368 6976 655f 7072 6f63 6564 7572  archive_procedur
-0000d960: 6520 3d3d 2027 4361 6e63 656c 273a 0a20  e == 'Cancel':. 
-0000d970: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0000d980: 7869 7428 3029 0a0a 2020 2020 2020 2020  xit(0)..        
-0000d990: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d9a0: 2020 2320 5765 2073 686f 756c 6420 6e65    # We should ne
-0000d9b0: 7665 7220 656e 6420 7570 2068 6572 650a  ver end up here.
+0000bab0: 2020 2020 2020 2020 2753 4c55 524d 272c          'SLURM',
+0000bac0: 2027 6c73 6372 6174 6368 5f72 6f6f 7427   'lscratch_root'
+0000bad0: 2c20 6c73 6372 6174 6368 5f72 6f6f 7429  , lscratch_root)
+0000bae0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000baf0: 2020 7072 696e 7428 6627 5c6e 2a2a 2a20    print(f'\n*** 
+0000bb00: 534c 5552 4d20 434f 4e46 4947 5552 4154  SLURM CONFIGURAT
+0000bb10: 494f 4e20 444f 4e45 202a 2a2a 5c6e 2729  ION DONE ***\n')
+0000bb20: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000bb30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000bb40: 2020 2020 7072 696e 7428 6627 5c6e 2a2a      print(f'\n**
+0000bb50: 2a20 534c 5552 4d20 4e4f 5420 464f 554e  * SLURM NOT FOUN
+0000bb60: 443a 204e 6f74 6869 6e67 2074 6f20 636f  D: Nothing to co
+0000bb70: 6e66 6967 7572 6520 2a2a 2a5c 6e27 290a  nfigure ***\n').
+0000bb80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000bb90: 7572 6e20 5472 7565 0a0a 2020 2020 2020  urn True..      
+0000bba0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0000bbb0: 2020 2020 2020 7072 696e 745f 6572 726f        print_erro
+0000bbc0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0000bbd0: 7265 7475 726e 2046 616c 7365 0a0a 0a63  return False...c
+0000bbe0: 6c61 7373 2041 5753 426f 746f 3a0a 2020  lass AWSBoto:.  
+0000bbf0: 2020 2727 2741 5753 2068 616e 646c 6572    '''AWS handler
+0000bc00: 2063 6c61 7373 2e20 5468 6973 2063 6c61   class. This cla
+0000bc10: 7373 2069 7320 7573 6564 2074 6f20 696e  ss is used to in
+0000bc20: 7465 7261 6374 2077 6974 6820 4157 5320  teract with AWS 
+0000bc30: 7365 7276 6963 6573 2e27 2727 0a20 2020  services.'''.   
+0000bc40: 2023 2054 4f44 4f3a 2061 7263 6820 6d75   # TODO: arch mu
+0000bc50: 7374 2062 6520 6465 6669 6e65 6420 6173  st be defined as
+0000bc60: 2061 6e20 636c 6173 7320 4172 6368 6976   an class Archiv
+0000bc70: 6520 696e 7374 616e 6365 0a0a 2020 2020  e instance..    
+0000bc80: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0000bc90: 662c 2061 7267 732c 2063 6667 3a20 436f  f, args, cfg: Co
+0000bca0: 6e66 6967 4d61 6e61 6765 722c 2061 7263  nfigManager, arc
+0000bcb0: 6829 3a0a 2020 2020 2020 2020 7365 6c66  h):.        self
+0000bcc0: 2e61 7267 7320 3d20 6172 6773 0a20 2020  .args = args.   
+0000bcd0: 2020 2020 2073 656c 662e 6366 6720 3d20       self.cfg = 
+0000bce0: 6366 670a 2020 2020 2020 2020 7365 6c66  cfg.        self
+0000bcf0: 2e61 7263 6820 3d20 6172 6368 0a0a 2020  .arch = arch..  
+0000bd00: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0000bd10: 2873 656c 662e 6366 672c 2027 6177 735f  (self.cfg, 'aws_
+0000bd20: 6469 7227 293a 0a20 2020 2020 2020 2020  dir'):.         
+0000bd30: 2020 2073 656c 662e 7365 745f 6177 735f     self.set_aws_
+0000bd40: 6469 7265 6374 6f72 7928 7365 6c66 2e63  directory(self.c
+0000bd50: 6667 2e61 7773 5f64 6972 290a 0a20 2020  fg.aws_dir)..   
+0000bd60: 2064 6566 2073 6574 5f61 7773 5f64 6972   def set_aws_dir
+0000bd70: 6563 746f 7279 2873 656c 662c 2061 7773  ectory(self, aws
+0000bd80: 5f64 6972 293a 0a20 2020 2020 2020 2023  _dir):.        #
+0000bd90: 2053 7065 6369 6679 2074 6865 2070 6174   Specify the pat
+0000bda0: 6873 2074 6f20 7468 6520 636f 6e66 6967  hs to the config
+0000bdb0: 2061 6e64 2063 7265 6465 6e74 6961 6c73   and credentials
+0000bdc0: 2066 696c 6573 0a20 2020 2020 2020 206f   files.        o
+0000bdd0: 732e 656e 7669 726f 6e5b 2741 5753 5f43  s.environ['AWS_C
+0000bde0: 4f4e 4649 475f 4649 4c45 275d 203d 206f  ONFIG_FILE'] = o
+0000bdf0: 732e 7061 7468 2e6a 6f69 6e28 6177 735f  s.path.join(aws_
+0000be00: 6469 722c 2027 636f 6e66 6967 2729 0a20  dir, 'config'). 
+0000be10: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
+0000be20: 6e5b 2741 5753 5f53 4841 5245 445f 4352  n['AWS_SHARED_CR
+0000be30: 4544 454e 5449 414c 535f 4649 4c45 275d  EDENTIALS_FILE']
+0000be40: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0000be50: 0a20 2020 2020 2020 2020 2020 2061 7773  .            aws
+0000be60: 5f64 6972 2c20 2763 7265 6465 6e74 6961  _dir, 'credentia
+0000be70: 6c73 2729 0a0a 2020 2020 6465 6620 5f63  ls')..    def _c
+0000be80: 6865 636b 5f73 6573 7369 6f6e 2873 656c  heck_session(sel
+0000be90: 6629 3a0a 2020 2020 2020 2020 2727 2743  f):.        '''C
+0000bea0: 6865 636b 2069 6620 7468 6520 6375 7272  heck if the curr
+0000beb0: 656e 7420 7365 7373 696f 6e20 6973 2076  ent session is v
+0000bec0: 616c 6964 2727 270a 2020 2020 2020 2020  alid'''.        
+0000bed0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000bee0: 2069 6620 6e6f 7420 7365 6c66 2e63 6667   if not self.cfg
+0000bef0: 2e61 7773 5f69 6e69 743a 0a20 2020 2020  .aws_init:.     
+0000bf00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bf10: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
+0000bf20: 2020 2020 2069 6620 7365 6c66 2e63 6865       if self.che
+0000bf30: 636b 5f63 7265 6465 6e74 6961 6c73 2861  ck_credentials(a
+0000bf40: 7773 5f70 726f 6669 6c65 3d73 656c 662e  ws_profile=self.
+0000bf50: 6366 672e 6177 735f 7072 6f66 696c 6529  cfg.aws_profile)
+0000bf60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bf70: 2020 7365 6c66 2e73 6574 5f73 6573 7369    self.set_sessi
+0000bf80: 6f6e 2870 726f 6669 6c65 5f6e 616d 653d  on(profile_name=
+0000bf90: 7365 6c66 2e63 6667 2e61 7773 5f70 726f  self.cfg.aws_pro
+0000bfa0: 6669 6c65 2c0a 2020 2020 2020 2020 2020  file,.          
+0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfc0: 2020 2020 2020 2072 6567 696f 6e3d 7365         region=se
+0000bfd0: 6c66 2e63 6667 2e61 7773 5f72 6567 696f  lf.cfg.aws_regio
+0000bfe0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+0000bff0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+0000c000: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000c010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c020: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000c030: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0000c040: 2020 2020 2020 2020 2020 7072 696e 745f            print_
+0000c050: 6572 726f 7228 290a 2020 2020 2020 2020  error().        
+0000c060: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000c070: 0a0a 2020 2020 6465 6620 6368 6563 6b5f  ..    def check_
+0000c080: 6275 636b 6574 5f61 6363 6573 7328 7365  bucket_access(se
+0000c090: 6c66 2c20 6275 636b 6574 5f6e 616d 652c  lf, bucket_name,
+0000c0a0: 2072 6561 6477 7269 7465 3d46 616c 7365   readwrite=False
+0000c0b0: 293a 0a20 2020 2020 2020 2027 2727 4368  ):.        '''Ch
+0000c0c0: 6563 6b20 6966 2074 6865 2075 7365 7220  eck if the user 
+0000c0d0: 6861 7320 6163 6365 7373 2074 6f20 7468  has access to th
+0000c0e0: 6520 6769 7665 6e20 6275 636b 6574 2727  e given bucket''
+0000c0f0: 270a 0a20 2020 2020 2020 2069 6620 6e6f  '..        if no
+0000c100: 7420 6275 636b 6574 5f6e 616d 653a 0a20  t bucket_name:. 
+0000c110: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c120: 2056 616c 7565 4572 726f 7228 274e 6f20   ValueError('No 
+0000c130: 6275 636b 6574 206e 616d 6520 7072 6f76  bucket name prov
+0000c140: 6964 6564 2729 0a0a 2020 2020 2020 2020  ided')..        
+0000c150: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000c160: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
+0000c170: 7365 7373 696f 6e20 6973 2076 616c 6964  session is valid
+0000c180: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c190: 6e6f 7420 7365 6c66 2e5f 6368 6563 6b5f  not self._check_
+0000c1a0: 7365 7373 696f 6e28 293a 0a20 2020 2020  session():.     
+0000c1b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000c1c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c1d0: 2020 2020 2020 6622 5c6e 4572 726f 723a        f"\nError:
+0000c1e0: 2041 5753 2063 7265 6465 6e74 6961 6c73   AWS credentials
+0000c1f0: 2061 7265 206e 6f74 2076 616c 6964 2066   are not valid f
+0000c200: 6f72 2070 726f 6669 6c65 207b 7365 6c66  or profile {self
+0000c210: 2e63 6667 2e61 7773 5f70 726f 6669 6c65  .cfg.aws_profile
+0000c220: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000c230: 2020 2020 7072 696e 7428 2272 756e 2027      print("run '
+0000c240: 6672 6f73 7465 7220 636f 6e66 6967 202d  froster config -
+0000c250: 2d61 7773 2720 746f 2066 6978 2074 6869  -aws' to fix thi
+0000c260: 732e 5c6e 2229 0a20 2020 2020 2020 2020  s.\n").         
+0000c270: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+0000c280: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+0000c290: 2320 4765 7420 7468 6520 6275 636b 6574  # Get the bucket
+0000c2a0: 2041 6363 6573 7320 436f 6e74 726f 6c20   Access Control 
+0000c2b0: 4c69 7374 2028 4143 4c29 0a20 2020 2020  List (ACL).     
+0000c2c0: 2020 2020 2020 2062 7563 6b65 745f 696e         bucket_in
+0000c2d0: 666f 203d 2073 656c 662e 7333 5f63 6c69  fo = self.s3_cli
+0000c2e0: 656e 742e 6765 745f 6275 636b 6574 5f61  ent.get_bucket_a
+0000c2f0: 636c 2842 7563 6b65 743d 6275 636b 6574  cl(Bucket=bucket
+0000c300: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
+0000c310: 2020 2020 2320 4163 6365 7373 2074 6865      # Access the
+0000c320: 2027 5065 726d 6973 7369 6f6e 2720 6b65   'Permission' ke
+0000c330: 790a 2020 2020 2020 2020 2020 2020 7065  y.            pe
+0000c340: 726d 6973 7369 6f6e 203d 2062 7563 6b65  rmission = bucke
+0000c350: 745f 696e 666f 5b27 4772 616e 7473 275d  t_info['Grants']
+0000c360: 5b30 5d5b 2750 6572 6d69 7373 696f 6e27  [0]['Permission'
+0000c370: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+0000c380: 6620 7265 6164 7772 6974 653a 0a20 2020  f readwrite:.   
+0000c390: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000c3a0: 7572 6e20 2870 6572 6d69 7373 696f 6e20  urn (permission 
+0000c3b0: 3d3d 2027 4655 4c4c 5f43 4f4e 5452 4f4c  == 'FULL_CONTROL
+0000c3c0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+0000c3d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c3e0: 2020 2020 2072 6574 7572 6e20 2870 6572       return (per
+0000c3f0: 6d69 7373 696f 6e20 3d3d 2027 5245 4144  mission == 'READ
+0000c400: 2729 0a0a 2020 2020 2020 2020 6578 6365  ')..        exce
+0000c410: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0000c420: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000c430: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000c440: 2020 2020 2023 2065 7863 6570 7420 626f       # except bo
+0000c450: 746f 636f 7265 2e65 7863 6570 7469 6f6e  tocore.exception
+0000c460: 732e 436c 6965 6e74 4572 726f 7220 6173  s.ClientError as
+0000c470: 2065 3a0a 2020 2020 2020 2020 2320 2020   e:.        #   
+0000c480: 2020 6572 726f 725f 636f 6465 203d 2065    error_code = e
+0000c490: 2e72 6573 706f 6e73 655b 2745 7272 6f72  .response['Error
+0000c4a0: 275d 5b27 436f 6465 275d 0a20 2020 2020  ']['Code'].     
+0000c4b0: 2020 2023 2020 2020 2069 6620 6572 726f     #     if erro
+0000c4c0: 725f 636f 6465 203d 3d20 2734 3033 273a  r_code == '403':
+0000c4d0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000c4e0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0000c4f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000c500: 6622 4572 726f 723a 2041 6363 6573 7320  f"Error: Access 
+0000c510: 6465 6e69 6564 2074 6f20 6275 636b 6574  denied to bucket
+0000c520: 207b 6275 636b 6574 5f6e 616d 657d 2066   {bucket_name} f
+0000c530: 6f72 2070 726f 6669 6c65 207b 7365 6c66  or profile {self
+0000c540: 2e61 7773 5f70 726f 6669 6c65 7d2e 2043  .aws_profile}. C
+0000c550: 6865 636b 2079 6f75 7220 7065 726d 6973  heck your permis
+0000c560: 7369 6f6e 732e 2229 0a20 2020 2020 2020  sions.").       
+0000c570: 2023 2020 2020 2065 6c69 6620 6572 726f   #     elif erro
+0000c580: 725f 636f 6465 203d 3d20 2734 3034 273a  r_code == '404':
+0000c590: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000c5a0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0000c5b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000c5c0: 6622 4572 726f 723a 2042 7563 6b65 7420  f"Error: Bucket 
+0000c5d0: 7b62 7563 6b65 745f 6e61 6d65 7d20 646f  {bucket_name} do
+0000c5e0: 6573 206e 6f74 2065 7869 7374 2069 6e20  es not exist in 
+0000c5f0: 7072 6f66 696c 6520 7b73 656c 662e 6177  profile {self.aw
+0000c600: 735f 7072 6f66 696c 657d 2e22 290a 2020  s_profile}.").  
+0000c610: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0000c620: 7072 696e 7428 2272 756e 2027 6672 6f73  print("run 'fros
+0000c630: 7465 7220 636f 6e66 6967 2720 746f 2063  ter config' to c
+0000c640: 7265 6174 6520 7468 6973 2062 7563 6b65  reate this bucke
+0000c650: 742e 2229 0a20 2020 2020 2020 2023 2020  t.").        #  
+0000c660: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000c670: 2023 2020 2020 2020 2020 2070 7269 6e74   #         print
+0000c680: 280a 2020 2020 2020 2020 2320 2020 2020  (.        #     
+0000c690: 2020 2020 2020 2020 6622 4572 726f 7220          f"Error 
+0000c6a0: 6163 6365 7373 696e 6720 6275 636b 6574  accessing bucket
+0000c6b0: 207b 6275 636b 6574 5f6e 616d 657d 2069   {bucket_name} i
+0000c6c0: 6e20 7072 6f66 696c 6520 7b73 656c 662e  n profile {self.
+0000c6d0: 6177 735f 7072 6f66 696c 657d 3a20 7b65  aws_profile}: {e
+0000c6e0: 7d22 290a 2020 2020 2020 2020 2320 2020  }").        #   
+0000c6f0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0000c700: 2020 2020 2020 2023 2065 7863 6570 7420         # except 
+0000c710: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0000c720: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
+0000c730: 696e 7428 0a20 2020 2020 2020 2023 2020  int(.        #  
+0000c740: 2020 2020 2020 2066 2241 6e20 756e 6578         f"An unex
+0000c750: 7065 6374 6564 2065 7272 6f72 2069 6e20  pected error in 
+0000c760: 6675 6e63 7469 6f6e 2063 6865 636b 5f62  function check_b
+0000c770: 7563 6b65 745f 6163 6365 7373 2066 6f72  ucket_access for
+0000c780: 2070 726f 6669 6c65 207b 7365 6c66 2e61   profile {self.a
+0000c790: 7773 5f70 726f 6669 6c65 7d3a 207b 657d  ws_profile}: {e}
+0000c7a0: 2229 0a20 2020 2020 2020 2023 2020 2020  ").        #    
+0000c7b0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+0000c7c0: 2020 2020 2020 2023 2069 6620 6e6f 7420         # if not 
+0000c7d0: 7265 6164 7772 6974 653a 0a20 2020 2020  readwrite:.     
+0000c7e0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+0000c7f0: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+0000c800: 2320 5465 7374 2077 7269 7465 2061 6363  # Test write acc
+0000c810: 6573 7320 6279 2075 706c 6f61 6469 6e67  ess by uploading
+0000c820: 2061 2073 6d61 6c6c 2074 6573 7420 6669   a small test fi
+0000c830: 6c65 0a20 2020 2020 2020 2023 2074 7279  le.        # try
+0000c840: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
+0000c850: 7465 7374 5f6f 626a 6563 745f 6b65 7920  test_object_key 
+0000c860: 3d20 2274 6573 745f 7772 6974 655f 6163  = "test_write_ac
+0000c870: 6365 7373 2e74 7874 220a 2020 2020 2020  cess.txt".      
+0000c880: 2020 2320 2020 2020 7333 2e70 7574 5f6f    #     s3.put_o
+0000c890: 626a 6563 7428 4275 636b 6574 3d62 7563  bject(Bucket=buc
+0000c8a0: 6b65 745f 6e61 6d65 2c20 4b65 793d 7465  ket_name, Key=te
+0000c8b0: 7374 5f6f 626a 6563 745f 6b65 792c 0a20  st_object_key,. 
+0000c8c0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000c8d0: 2020 2020 2020 2020 2020 2042 6f64 793d             Body=
+0000c8e0: 2254 6573 7420 7772 6974 6520 6163 6365  "Test write acce
+0000c8f0: 7373 2229 0a20 2020 2020 2020 2023 2020  ss").        #  
+0000c900: 2020 2023 2070 7269 6e74 2866 2253 7563     # print(f"Suc
+0000c910: 6365 7373 6675 6c6c 7920 7772 6f74 6520  cessfully wrote 
+0000c920: 7465 7374 2074 6f20 7b62 7563 6b65 745f  test to {bucket_
+0000c930: 6e61 6d65 7d22 290a 0a20 2020 2020 2020  name}")..       
+0000c940: 2023 2020 2020 2023 2043 6c65 616e 2075   #     # Clean u
+0000c950: 7020 6279 2064 656c 6574 696e 6720 7468  p by deleting th
+0000c960: 6520 7465 7374 206f 626a 6563 740a 2020  e test object.  
+0000c970: 2020 2020 2020 2320 2020 2020 7333 2e64        #     s3.d
+0000c980: 656c 6574 655f 6f62 6a65 6374 2842 7563  elete_object(Buc
+0000c990: 6b65 743d 6275 636b 6574 5f6e 616d 652c  ket=bucket_name,
+0000c9a0: 204b 6579 3d74 6573 745f 6f62 6a65 6374   Key=test_object
+0000c9b0: 5f6b 6579 290a 2020 2020 2020 2020 2320  _key).        # 
+0000c9c0: 2020 2020 2320 7072 696e 7428 6622 5375      # print(f"Su
+0000c9d0: 6363 6573 7366 756c 6c79 2064 656c 6574  ccessfully delet
+0000c9e0: 6564 2074 6573 7420 6f62 6a65 6374 2066  ed test object f
+0000c9f0: 726f 6d20 7b62 7563 6b65 745f 6e61 6d65  rom {bucket_name
+0000ca00: 7d22 290a 2020 2020 2020 2020 2320 2020  }").        #   
+0000ca10: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000ca20: 2020 2020 2020 2320 6578 6365 7074 2062        # except b
+0000ca30: 6f74 6f63 6f72 652e 6578 6365 7074 696f  otocore.exceptio
+0000ca40: 6e73 2e43 6c69 656e 7445 7272 6f72 2061  ns.ClientError a
+0000ca50: 7320 653a 0a20 2020 2020 2020 2023 2020  s e:.        #  
+0000ca60: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0000ca70: 2020 2320 2020 2020 2020 2020 6622 4572    #         f"Er
+0000ca80: 726f 723a 2063 616e 6e6f 7420 7772 6974  ror: cannot writ
+0000ca90: 6520 746f 2062 7563 6b65 7420 7b62 7563  e to bucket {buc
+0000caa0: 6b65 745f 6e61 6d65 7d20 696e 2070 726f  ket_name} in pro
+0000cab0: 6669 6c65 207b 7365 6c66 2e61 7773 5f70  file {self.aws_p
+0000cac0: 726f 6669 6c65 7d3a 207b 657d 2229 0a20  rofile}: {e}"). 
+0000cad0: 2020 2020 2020 2023 2020 2020 2072 6574         #     ret
+0000cae0: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
+0000caf0: 6566 2063 6865 636b 5f63 7265 6465 6e74  ef check_credent
+0000cb00: 6961 6c73 2873 656c 662c 0a20 2020 2020  ials(self,.     
+0000cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb20: 2020 2020 2061 7773 5f70 726f 6669 6c65       aws_profile
+0000cb30: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb50: 2061 7773 5f61 6363 6573 735f 6b65 795f   aws_access_key_
+0000cb60: 6964 3d4e 6f6e 652c 0a20 2020 2020 2020  id=None,.       
+0000cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb80: 2020 2061 7773 5f73 6563 7265 745f 6163     aws_secret_ac
+0000cb90: 6365 7373 5f6b 6579 3d4e 6f6e 652c 0a20  cess_key=None,. 
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbb0: 2020 2020 2020 2020 2061 7773 5f72 6567           aws_reg
+0000cbc0: 696f 6e5f 6e61 6d65 3d4e 6f6e 6529 3a0a  ion_name=None):.
+0000cbd0: 2020 2020 2020 2020 2727 2720 4157 5320          ''' AWS 
+0000cbe0: 6372 6564 656e 7469 616c 2063 6865 636b  credential check
+0000cbf0: 6572 0a0a 2020 2020 2020 2020 4368 6563  er..        Chec
+0000cc00: 6b20 6966 2074 6865 2070 726f 7669 6465  k if the provide
+0000cc10: 6420 4157 5320 6372 6564 656e 7469 616c  d AWS credential
+0000cc20: 7320 6f72 2070 726f 7669 6465 2041 5753  s or provide AWS
+0000cc30: 2070 726f 6669 6c65 2061 7265 2076 616c   profile are val
+0000cc40: 6964 2e0a 2020 2020 2020 2020 4966 206e  id..        If n
+0000cc50: 6f74 6869 6e67 2069 7320 7072 6f76 6964  othing is provid
+0000cc60: 6564 2c20 7468 6520 6375 7272 656e 7420  ed, the current 
+0000cc70: 7365 7373 696f 6e20 6973 2063 6865 636b  session is check
+0000cc80: 6564 2e27 2727 0a0a 2020 2020 2020 2020  ed.'''..        
+0000cc90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000cca0: 2069 6620 6177 735f 6163 6365 7373 5f6b   if aws_access_k
+0000ccb0: 6579 5f69 6420 616e 6420 6177 735f 7365  ey_id and aws_se
+0000ccc0: 6372 6574 5f61 6363 6573 735f 6b65 793a  cret_access_key:
+0000ccd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cce0: 2023 2042 7569 6c64 2061 206e 6577 2053   # Build a new S
+0000ccf0: 5453 2063 6c69 656e 7420 7769 7468 2074  TS client with t
+0000cd00: 6865 2070 726f 7669 6465 6420 6372 6564  he provided cred
+0000cd10: 656e 7469 616c 730a 2020 2020 2020 2020  entials.        
+0000cd20: 2020 2020 2020 2020 7374 7320 3d20 626f          sts = bo
+0000cd30: 746f 332e 5365 7373 696f 6e28 6177 735f  to3.Session(aws_
+0000cd40: 6163 6365 7373 5f6b 6579 5f69 643d 6177  access_key_id=aw
+0000cd50: 735f 6163 6365 7373 5f6b 6579 5f69 642c  s_access_key_id,
+0000cd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd80: 2020 2020 2061 7773 5f73 6563 7265 745f       aws_secret_
+0000cd90: 6163 6365 7373 5f6b 6579 3d61 7773 5f73  access_key=aws_s
+0000cda0: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
+0000cdb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cdd0: 2020 2020 2020 7265 6769 6f6e 5f6e 616d        region_nam
+0000cde0: 653d 6177 735f 7265 6769 6f6e 5f6e 616d  e=aws_region_nam
+0000cdf0: 6529 2e63 6c69 656e 7428 2773 7473 2729  e).client('sts')
+0000ce00: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000ce10: 6966 2061 7773 5f70 726f 6669 6c65 3a0a  if aws_profile:.
+0000ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce30: 2320 4275 696c 6420 6120 6e65 7720 5354  # Build a new ST
+0000ce40: 5320 636c 6965 6e74 2077 6974 6820 7468  S client with th
+0000ce50: 6520 7072 6f76 6964 6564 2070 726f 6669  e provided profi
+0000ce60: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+0000ce70: 2020 2073 7473 203d 2062 6f74 6f33 2e53     sts = boto3.S
+0000ce80: 6573 7369 6f6e 2870 726f 6669 6c65 5f6e  ession(profile_n
+0000ce90: 616d 653d 6177 735f 7072 6f66 696c 652c  ame=aws_profile,
+0000cea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cec0: 2020 2020 2072 6567 696f 6e5f 6e61 6d65       region_name
+0000ced0: 3d61 7773 5f72 6567 696f 6e5f 6e61 6d65  =aws_region_name
+0000cee0: 292e 636c 6965 6e74 2827 7374 7327 290a  ).client('sts').
+0000cef0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000cf00: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
+0000cf10: 2773 335f 636c 6965 6e74 2729 3a0a 2020  's3_client'):.  
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cf30: 4765 7420 7468 6520 6375 7272 656e 7420  Get the current 
+0000cf40: 7374 735f 636c 6965 6e74 0a20 2020 2020  sts_client.     
+0000cf50: 2020 2020 2020 2020 2020 2073 7473 203d             sts =
+0000cf60: 2073 656c 662e 7374 735f 636c 6965 6e74   self.sts_client
+0000cf70: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000cf80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000cf90: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000cfa0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000cfb0: 2020 2020 2020 2020 2020 224e 6f20 4157            "No AW
+0000cfc0: 5320 6372 6564 656e 7469 616c 7320 6e6f  S credentials no
+0000cfd0: 7220 7072 6f66 696c 6520 7072 6f76 6964  r profile provid
+0000cfe0: 6564 2061 6e64 2063 7572 7265 6e74 2041  ed and current A
+0000cff0: 5753 2073 6573 7369 6f6e 206e 6f74 2073  WS session not s
+0000d000: 6574 2e22 290a 0a20 2020 2020 2020 2020  et.")..         
+0000d010: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+0000d020: 7765 2063 616e 2067 6574 2074 6865 2063  we can get the c
+0000d030: 616c 6c65 7220 6964 656e 7469 7479 0a20  aller identity. 
+0000d040: 2020 2020 2020 2020 2020 2073 7473 2e67             sts.g
+0000d050: 6574 5f63 616c 6c65 725f 6964 656e 7469  et_caller_identi
+0000d060: 7479 2829 0a0a 2020 2020 2020 2020 2020  ty()..          
+0000d070: 2020 2320 436c 6f73 6520 7468 6520 7365    # Close the se
+0000d080: 7373 696f 6e0a 2020 2020 2020 2020 2020  ssion.          
+0000d090: 2020 7374 732e 636c 6f73 6528 290a 0a20    sts.close().. 
+0000d0a0: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
+0000d0b0: 6465 6e74 6961 6c73 2061 7265 2076 616c  dentials are val
+0000d0c0: 6964 0a20 2020 2020 2020 2020 2020 2072  id.            r
+0000d0d0: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+0000d0e0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0000d0f0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+0000d100: 2020 2020 2020 2023 2043 7265 6465 6e74         # Credent
+0000d110: 6961 6c73 2061 7265 206e 6f74 2076 616c  ials are not val
+0000d120: 6964 0a20 2020 2020 2020 2020 2020 2072  id.            r
+0000d130: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000d140: 2020 2020 2023 2054 4f44 4f3a 2072 6577       # TODO: rew
+0000d150: 6f72 6b20 6572 726f 7220 6368 6563 6b73  ork error checks
+0000d160: 0a0a 2020 2020 2020 2020 2320 6578 6365  ..        # exce
+0000d170: 7074 2062 6f74 6f33 2e65 7863 6570 7469  pt boto3.excepti
+0000d180: 6f6e 732e 436c 6965 6e74 4572 726f 723a  ons.ClientError:
+0000d190: 0a20 2020 2020 2020 2023 2020 2020 2070  .        #     p
+0000d1a0: 7269 6e74 2822 4572 726f 723a 2055 6e61  rint("Error: Una
+0000d1b0: 626c 6520 746f 2072 6574 7269 6576 6520  ble to retrieve 
+0000d1c0: 4157 5320 7265 6769 6f6e 7320 666f 7220  AWS regions for 
+0000d1d0: 7468 6520 6769 7665 6e20 6372 6564 656e  the given creden
+0000d1e0: 7469 616c 732e 2229 0a20 2020 2020 2020  tials.").       
+0000d1f0: 2023 2020 2020 2065 7869 7428 3129 0a0a   #     exit(1)..
+0000d200: 2020 2020 2020 2020 2320 6578 6365 7074          # except
+0000d210: 2062 6f74 6f33 2e65 7863 6570 7469 6f6e   boto3.exception
+0000d220: 732e 4e6f 4372 6564 656e 7469 616c 7345  s.NoCredentialsE
+0000d230: 7272 6f72 3a0a 2020 2020 2020 2020 2320  rror:.        # 
+0000d240: 2020 2020 7072 696e 7428 224e 6f20 4157      print("No AW
+0000d250: 5320 6372 6564 656e 7469 616c 7320 666f  S credentials fo
+0000d260: 756e 6422 290a 2020 2020 2020 2020 2320  und").        # 
+0000d270: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000d280: 0a0a 2020 2020 2020 2020 2320 6578 6365  ..        # exce
+0000d290: 7074 2062 6f74 6f33 2e65 7863 6570 7469  pt boto3.excepti
+0000d2a0: 6f6e 732e 456e 6470 6f69 6e74 436f 6e6e  ons.EndpointConn
+0000d2b0: 6563 7469 6f6e 4572 726f 723a 0a20 2020  ectionError:.   
+0000d2c0: 2020 2020 2023 2020 2020 2070 7269 6e74       #     print
+0000d2d0: 2822 556e 6162 6c65 2074 6f20 636f 6e6e  ("Unable to conn
+0000d2e0: 6563 7420 746f 2074 6865 2041 5753 2053  ect to the AWS S
+0000d2f0: 3320 656e 6470 6f69 6e74 2e22 290a 2020  3 endpoint.").  
+0000d300: 2020 2020 2020 2320 2020 2020 7265 7475        #     retu
+0000d310: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+0000d320: 2020 2320 6578 6365 7074 2062 6f74 6f33    # except boto3
+0000d330: 2e65 7863 6570 7469 6f6e 732e 436c 6965  .exceptions.Clie
+0000d340: 6e74 4572 726f 7220 6173 2065 3a0a 2020  ntError as e:.  
+0000d350: 2020 2020 2020 2320 2020 2020 6572 726f        #     erro
+0000d360: 725f 636f 6465 203d 2065 2e72 6573 706f  r_code = e.respo
+0000d370: 6e73 652e 6765 7428 2745 7272 6f72 272c  nse.get('Error',
+0000d380: 207b 7d29 2e67 6574 2827 436f 6465 2729   {}).get('Code')
+0000d390: 0a0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+0000d3a0: 6966 2065 7272 6f72 5f63 6f64 6520 3d3d  if error_code ==
+0000d3b0: 2027 5265 7175 6573 7454 696d 6554 6f6f   'RequestTimeToo
+0000d3c0: 536b 6577 6564 273a 0a20 2020 2020 2020  Skewed':.       
+0000d3d0: 2023 2020 2020 2020 2020 2070 7269 6e74   #         print
+0000d3e0: 280a 2020 2020 2020 2020 2320 2020 2020  (.        #     
+0000d3f0: 2020 2020 2020 2020 6622 5468 6520 7469          f"The ti
+0000d400: 6d65 2064 6966 6665 7265 6e63 6520 6265  me difference be
+0000d410: 7477 6565 6e20 5333 2073 746f 7261 6765  tween S3 storage
+0000d420: 2061 6e64 2079 6f75 7220 636f 6d70 7574   and your comput
+0000d430: 6572 2069 7320 746f 6f20 6869 6768 3a5c  er is too high:\
+0000d440: 6e7b 657d 2229 0a20 2020 2020 2020 2023  n{e}").        #
+0000d450: 2020 2020 2065 6c69 6620 6572 726f 725f       elif error_
+0000d460: 636f 6465 203d 3d20 2749 6e76 616c 6964  code == 'Invalid
+0000d470: 4163 6365 7373 4b65 7949 6427 3a0a 2020  AccessKeyId':.  
+0000d480: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0000d490: 7072 696e 7428 0a20 2020 2020 2020 2023  print(.        #
+0000d4a0: 2020 2020 2020 2020 2020 2020 2066 2245               f"E
+0000d4b0: 7272 6f72 3a20 496e 7661 6c69 6420 4157  rror: Invalid AW
+0000d4c0: 5320 4163 6365 7373 204b 6579 2049 443a  S Access Key ID:
+0000d4d0: 5c6e 7b65 7d22 290a 2020 2020 2020 2020  \n{e}").        
+0000d4e0: 2320 2020 2020 2020 2020 7072 696e 7428  #         print(
+0000d4f0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000d500: 2020 2020 2020 2066 2246 6978 2079 6f75         f"Fix you
+0000d510: 7220 6372 6564 656e 7469 616c 7320 696e  r credentials in
+0000d520: 207e 2f2e 6177 732f 6372 6564 656e 7469   ~/.aws/credenti
+0000d530: 616c 7322 290a 2020 2020 2020 2020 2320  als").        # 
+0000d540: 2020 2020 656c 6966 2065 7272 6f72 5f63      elif error_c
+0000d550: 6f64 6520 3d3d 2027 5369 676e 6174 7572  ode == 'Signatur
+0000d560: 6544 6f65 734e 6f74 4d61 7463 6827 3a0a  eDoesNotMatch':.
+0000d570: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000d580: 2020 6966 2022 5369 676e 6174 7572 6520    if "Signature 
+0000d590: 6578 7069 7265 6422 2069 6e20 7374 7228  expired" in str(
+0000d5a0: 6529 3a0a 2020 2020 2020 2020 2320 2020  e):.        #   
+0000d5b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000d5c0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000d5d0: 2020 2020 2020 2020 2020 2066 2245 7272             f"Err
+0000d5e0: 6f72 3a20 5369 676e 6174 7572 6520 6578  or: Signature ex
+0000d5f0: 7069 7265 642e 2054 6865 2073 7973 7465  pired. The syste
+0000d600: 6d20 7469 6d65 206f 6620 796f 7572 2063  m time of your c
+0000d610: 6f6d 7075 7465 7220 6973 206c 696b 656c  omputer is likel
+0000d620: 7920 7772 6f6e 673a 5c6e 7b65 7d22 290a  y wrong:\n{e}").
+0000d630: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000d640: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000d650: 7365 0a20 2020 2020 2020 2023 2020 2020  se.        #    
+0000d660: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000d670: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000d680: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+0000d690: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000d6a0: 2020 6622 4572 726f 723a 2049 6e76 616c    f"Error: Inval
+0000d6b0: 6964 2041 5753 2053 6563 7265 7420 4163  id AWS Secret Ac
+0000d6c0: 6365 7373 204b 6579 3a5c 6e7b 657d 2229  cess Key:\n{e}")
+0000d6d0: 0a20 2020 2020 2020 2023 2020 2020 2065  .        #     e
+0000d6e0: 6c69 6620 6572 726f 725f 636f 6465 203d  lif error_code =
+0000d6f0: 3d20 2749 6e76 616c 6964 436c 6965 6e74  = 'InvalidClient
+0000d700: 546f 6b65 6e49 6427 3a0a 2020 2020 2020  TokenId':.      
+0000d710: 2020 2320 2020 2020 2020 2020 7072 696e    #         prin
+0000d720: 7428 6622 4572 726f 723a 2049 6e76 616c  t(f"Error: Inval
+0000d730: 6964 2041 5753 2041 6363 6573 7320 4b65  id AWS Access Ke
+0000d740: 7920 4944 206f 7220 5365 6372 6574 2041  y ID or Secret A
+0000d750: 6363 6573 7320 4b65 7920 2122 290a 2020  ccess Key !").  
+0000d760: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0000d770: 7072 696e 7428 0a20 2020 2020 2020 2023  print(.        #
+0000d780: 2020 2020 2020 2020 2020 2020 2066 2246               f"F
+0000d790: 6978 2079 6f75 7220 6372 6564 656e 7469  ix your credenti
+0000d7a0: 616c 7320 696e 207e 2f2e 6177 732f 6372  als in ~/.aws/cr
+0000d7b0: 6564 656e 7469 616c 7322 290a 2020 2020  edentials").    
+0000d7c0: 2020 2020 2320 2020 2020 656c 7365 3a0a      #     else:.
+0000d7d0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000d7e0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0000d7f0: 2023 2020 2020 2020 2020 2020 2020 2066   #             f
+0000d800: 2245 7272 6f72 2076 616c 6964 6174 696e  "Error validatin
+0000d810: 6720 6372 6564 656e 7469 616c 733a 207b  g credentials: {
+0000d820: 657d 2229 0a20 2020 2020 2020 2023 2020  e}").        #  
+0000d830: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0000d840: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0000d850: 2020 2020 6622 4669 7820 796f 7572 2063      f"Fix your c
+0000d860: 7265 6465 6e74 6961 6c73 2069 6e20 7e2f  redentials in ~/
+0000d870: 2e61 7773 2f63 7265 6465 6e74 6961 6c73  .aws/credentials
+0000d880: 2229 0a20 2020 2020 2020 2023 2020 2020  ").        #    
+0000d890: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000d8a0: 2020 2020 2020 2320 6578 6365 7074 2045        # except E
+0000d8b0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0000d8c0: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
+0000d8d0: 6e74 280a 2020 2020 2020 2020 2320 2020  nt(.        #   
+0000d8e0: 2020 2020 2020 6622 556e 6578 7065 6374        f"Unexpect
+0000d8f0: 6564 2065 7272 6f72 2063 6865 636b 696e  ed error checkin
+0000d900: 6720 7333 2063 7265 6465 6e74 6961 6c73  g s3 credentials
+0000d910: 3a20 7b65 7d22 290a 2020 2020 2020 2020  : {e}").        
+0000d920: 2320 2020 2020 7265 7475 726e 2046 616c  #     return Fal
+0000d930: 7365 0a0a 2020 2020 6465 6620 6372 6561  se..    def crea
+0000d940: 7465 5f62 7563 6b65 7428 7365 6c66 2c20  te_bucket(self, 
+0000d950: 6275 636b 6574 5f6e 616d 652c 2072 6567  bucket_name, reg
+0000d960: 696f 6e29 3a0a 2020 2020 2020 2020 2727  ion):.        ''
+0000d970: 2743 7265 6174 6520 6120 6e65 7720 5333  'Create a new S3
+0000d980: 2062 7563 6b65 7420 7769 7468 2074 6865   bucket with the
+0000d990: 2070 726f 7669 6465 6420 6e61 6d65 2e27   provided name.'
+0000d9a0: 2727 0a0a 2020 2020 2020 2020 6966 206e  ''..        if n
+0000d9b0: 6f74 2062 7563 6b65 745f 6e61 6d65 3a0a  ot bucket_name:.
 0000d9c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d9d0: 6520 5661 6c75 6545 7272 6f72 2822 496e  e ValueError("In
-0000d9e0: 7661 6c69 6420 6f70 7469 6f6e 2073 656c  valid option sel
-0000d9f0: 6563 7465 642e 2229 0a0a 2020 2020 2020  ected.")..      
-0000da00: 2020 2320 4172 6368 6976 6520 7468 6520    # Archive the 
-0000da10: 7365 6c65 6374 6564 2066 6f6c 6465 7273  selected folders
-0000da20: 0a20 2020 2020 2020 2073 656c 662e 6172  .        self.ar
-0000da30: 6368 6976 6528 666f 6c64 6572 735f 746f  chive(folders_to
-0000da40: 5f61 7263 6869 7665 290a 0a20 2020 2064  _archive)..    d
-0000da50: 6566 205f 6973 5f72 6563 7572 7369 7665  ef _is_recursive
-0000da60: 5f63 6f6c 6c69 7369 6f6e 2873 656c 662c  _collision(self,
-0000da70: 2066 6f6c 6465 7273 293a 0a20 2020 2020   folders):.     
-0000da80: 2020 2027 2727 4368 6563 6b20 6966 2074     '''Check if t
-0000da90: 6865 7265 2069 7320 6120 636f 6c6c 6973  here is a collis
-0000daa0: 696f 6e20 6265 7477 6565 6e20 666f 6c64  ion between fold
-0000dab0: 6572 7320 616e 6420 7265 6375 7273 6976  ers and recursiv
-0000dac0: 6520 666c 6167 2727 270a 2020 2020 2020  e flag'''.      
-0000dad0: 2020 6973 5f63 6f6c 6c69 7369 6f6e 203d    is_collision =
-0000dae0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-0000daf0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000db00: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0000db10: 6c65 6e28 666f 6c64 6572 7329 293a 0a20  len(folders)):. 
-0000db20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000db30: 6f72 206a 2069 6e20 7261 6e67 6528 6920  or j in range(i 
-0000db40: 2b20 312c 206c 656e 2866 6f6c 6465 7273  + 1, len(folders
-0000db50: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000db60: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0000db70: 6966 2066 6f6c 6465 7273 5b6a 5d20 6973  if folders[j] is
-0000db80: 2061 2073 7562 6469 7265 6374 6f72 7920   a subdirectory 
-0000db90: 6f66 2066 6f6c 6465 7273 5b69 5d0a 2020  of folders[i].  
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbb0: 2020 6966 206f 732e 7061 7468 2e63 6f6d    if os.path.com
-0000dbc0: 6d6f 6e70 6174 6828 5b66 6f6c 6465 7273  monpath([folders
-0000dbd0: 5b69 5d2c 2066 6f6c 6465 7273 5b6a 5d5d  [i], folders[j]]
-0000dbe0: 2920 3d3d 2066 6f6c 6465 7273 5b69 5d3a  ) == folders[i]:
-0000dbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc00: 2020 2020 2020 2020 2069 735f 636f 6c6c           is_coll
-0000dc10: 6973 696f 6e20 3d20 5472 7565 0a20 2020  ision = True.   
-0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc30: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-0000dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc50: 2020 2020 2020 2020 6627 4572 726f 723a          f'Error:
-0000dc60: 2046 6f6c 6465 7220 7b66 6f6c 6465 7273   Folder {folders
-0000dc70: 5b6a 5d7d 2069 7320 6120 7375 6264 6972  [j]} is a subdir
-0000dc80: 6563 746f 7279 206f 6620 666f 6c64 6572  ectory of folder
-0000dc90: 207b 666f 6c64 6572 735b 695d 7d2e 5c6e   {folders[i]}.\n
-0000dca0: 272c 2066 696c 653d 7379 732e 7374 6465  ', file=sys.stde
-0000dcb0: 7272 290a 0a20 2020 2020 2020 2020 2020  rr)..           
-0000dcc0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-0000dcd0: 2069 6620 666f 6c64 6572 735b 695d 2069   if folders[i] i
-0000dce0: 7320 6120 7375 6264 6972 6563 746f 7279  s a subdirectory
-0000dcf0: 206f 6620 666f 6c64 6572 735b 6a5d 0a20   of folders[j]. 
-0000dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd10: 2020 2065 6c69 6620 6f73 2e70 6174 682e     elif os.path.
-0000dd20: 636f 6d6d 6f6e 7061 7468 285b 666f 6c64  commonpath([fold
-0000dd30: 6572 735b 695d 2c20 666f 6c64 6572 735b  ers[i], folders[
-0000dd40: 6a5d 5d29 203d 3d20 666f 6c64 6572 735b  j]]) == folders[
-0000dd50: 6a5d 3a0a 2020 2020 2020 2020 2020 2020  j]:.            
-0000dd60: 2020 2020 2020 2020 2020 2020 6973 5f63              is_c
-0000dd70: 6f6c 6c69 7369 6f6e 203d 2054 7275 650a  ollision = True.
-0000dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd90: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddb0: 2020 2020 2020 2020 2020 2066 2745 7272             f'Err
-0000ddc0: 6f72 3a20 466f 6c64 6572 207b 666f 6c64  or: Folder {fold
-0000ddd0: 6572 735b 695d 7d20 6973 2061 2073 7562  ers[i]} is a sub
-0000dde0: 6469 7265 6374 6f72 7920 6f66 2066 6f6c  directory of fol
-0000ddf0: 6465 7220 7b66 6f6c 6465 7273 5b6a 5d7d  der {folders[j]}
-0000de00: 2e5c 6e27 290a 2020 2020 2020 2020 6578  .\n').        ex
-0000de10: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0000de20: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000de30: 2070 7269 6e74 5f65 7272 6f72 2829 0a20   print_error(). 
-0000de40: 2020 2020 2020 2020 2020 2069 735f 636f             is_co
-0000de50: 6c6c 6973 696f 6e20 3d20 5472 7565 0a0a  llision = True..
-0000de60: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000de70: 735f 636f 6c6c 6973 696f 6e0a 0a20 2020  s_collision..   
-0000de80: 2064 6566 205f 6172 6368 6976 655f 736c   def _archive_sl
-0000de90: 7572 6d28 7365 6c66 2c20 666f 6c64 6572  urm(self, folder
-0000dea0: 732c 2069 735f 7265 6375 7273 6976 652c  s, is_recursive,
-0000deb0: 206e 6968 293a 0a20 2020 2020 2020 2073   nih):.        s
-0000dec0: 6520 3d20 536c 7572 6d45 7373 656e 7469  e = SlurmEssenti
-0000ded0: 616c 7328 7365 6c66 2e61 7267 732c 2073  als(self.args, s
-0000dee0: 656c 662e 6366 6729 0a20 2020 2020 2020  elf.cfg).       
-0000def0: 206c 6162 656c 203d 2066 6f6c 6465 7273   label = folders
-0000df00: 5b30 5d2e 7265 706c 6163 6528 272f 272c  [0].replace('/',
-0000df10: 2027 2b27 290a 2020 2020 2020 2020 6c61   '+').        la
-0000df20: 6265 6c20 3d20 6c61 6265 6c2e 7265 706c  bel = label.repl
-0000df30: 6163 6528 2720 272c 2027 5f27 290a 2020  ace(' ', '_').  
-0000df40: 2020 2020 2020 7368 6f72 746c 6162 656c        shortlabel
-0000df50: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-0000df60: 616d 6528 666f 6c64 6572 735b 305d 290a  ame(folders[0]).
-0000df70: 2020 2020 2020 2020 6d79 6a6f 626e 616d          myjobnam
-0000df80: 6520 3d20 6627 6672 6f73 7465 723a 6172  e = f'froster:ar
-0000df90: 6368 6976 653a 7b73 686f 7274 6c61 6265  chive:{shortlabe
-0000dfa0: 6c7d 270a 2020 2020 2020 2020 656d 6169  l}'.        emai
-0000dfb0: 6c20 3d20 7365 6c66 2e63 6667 2e65 6d61  l = self.cfg.ema
-0000dfc0: 696c 0a20 2020 2020 2020 2073 652e 6164  il.        se.ad
-0000dfd0: 645f 6c69 6e65 2866 2723 5342 4154 4348  d_line(f'#SBATCH
-0000dfe0: 202d 2d6a 6f62 2d6e 616d 653d 7b6d 796a   --job-name={myj
-0000dff0: 6f62 6e61 6d65 7d27 290a 2020 2020 2020  obname}').      
-0000e000: 2020 7365 2e61 6464 5f6c 696e 6528 6627    se.add_line(f'
-0000e010: 2353 4241 5443 4820 2d2d 6370 7573 2d70  #SBATCH --cpus-p
-0000e020: 6572 2d74 6173 6b3d 7b73 656c 662e 6172  er-task={self.ar
-0000e030: 6773 2e63 6f72 6573 7d27 290a 2020 2020  gs.cores}').    
-0000e040: 2020 2020 7365 2e61 6464 5f6c 696e 6528      se.add_line(
-0000e050: 6627 2353 4241 5443 4820 2d2d 6d65 6d3d  f'#SBATCH --mem=
-0000e060: 3634 4727 290a 2020 2020 2020 2020 7365  64G').        se
-0000e070: 2e61 6464 5f6c 696e 6528 6627 2353 4241  .add_line(f'#SBA
-0000e080: 5443 4820 2d2d 7265 7175 6575 6527 290a  TCH --requeue').
-0000e090: 2020 2020 2020 2020 7365 2e61 6464 5f6c          se.add_l
-0000e0a0: 696e 6528 6627 2353 4241 5443 4820 2d2d  ine(f'#SBATCH --
-0000e0b0: 6f75 7470 7574 3d66 726f 7374 6572 2d61  output=froster-a
-0000e0c0: 7263 6869 7665 2d7b 6c61 6265 6c7d 2d25  rchive-{label}-%
-0000e0d0: 4a2e 6f75 7427 290a 2020 2020 2020 2020  J.out').        
-0000e0e0: 7365 2e61 6464 5f6c 696e 6528 6627 2353  se.add_line(f'#S
-0000e0f0: 4241 5443 4820 2d2d 6d61 696c 2d74 7970  BATCH --mail-typ
-0000e100: 653d 4641 494c 2c52 4551 5545 5545 2c45  e=FAIL,REQUEUE,E
-0000e110: 4e44 2729 0a20 2020 2020 2020 2073 652e  ND').        se.
-0000e120: 6164 645f 6c69 6e65 2866 2723 5342 4154  add_line(f'#SBAT
-0000e130: 4348 202d 2d6d 6169 6c2d 7573 6572 3d7b  CH --mail-user={
-0000e140: 656d 6169 6c7d 2729 0a20 2020 2020 2020  email}').       
-0000e150: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-0000e160: 5342 4154 4348 202d 2d74 696d 653d 7b73  SBATCH --time={s
-0000e170: 652e 7761 6c6c 7469 6d65 7d27 290a 2020  e.walltime}').  
-0000e180: 2020 2020 2020 6966 2073 652e 7061 7274        if se.part
-0000e190: 6974 696f 6e3a 0a20 2020 2020 2020 2020  ition:.         
-0000e1a0: 2020 2073 652e 6164 645f 6c69 6e65 2866     se.add_line(f
-0000e1b0: 2723 5342 4154 4348 202d 2d70 6172 7469  '#SBATCH --parti
-0000e1c0: 7469 6f6e 3d7b 7365 2e70 6172 7469 7469  tion={se.partiti
-0000e1d0: 6f6e 7d27 290a 2020 2020 2020 2020 6966  on}').        if
-0000e1e0: 2073 652e 716f 733a 0a20 2020 2020 2020   se.qos:.       
-0000e1f0: 2020 2020 2073 652e 6164 645f 6c69 6e65       se.add_line
-0000e200: 2866 2723 5342 4154 4348 202d 2d71 6f73  (f'#SBATCH --qos
-0000e210: 3d7b 7365 2e71 6f73 7d27 290a 2020 2020  ={se.qos}').    
-0000e220: 2020 2020 636d 646c 696e 6520 3d20 2220      cmdline = " 
-0000e230: 222e 6a6f 696e 286d 6170 2873 686c 6578  ".join(map(shlex
-0000e240: 2e71 756f 7465 2c20 7379 732e 6172 6776  .quote, sys.argv
-0000e250: 2929 2020 2320 6f72 6967 696e 616c 2063  ))  # original c
-0000e260: 6d64 6c69 6e65 0a20 2020 2020 2020 2069  mdline.        i
-0000e270: 6620 6e6f 7420 222d 2d70 726f 6669 6c65  f not "--profile
-0000e280: 2220 696e 2063 6d64 6c69 6e65 2061 6e64  " in cmdline and
-0000e290: 2073 656c 662e 6172 6773 2e61 7773 5f70   self.args.aws_p
-0000e2a0: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
-0000e2b0: 2020 2020 636d 646c 696e 6520 3d20 636d      cmdline = cm
-0000e2c0: 646c 696e 652e 7265 706c 6163 6528 0a20  dline.replace(. 
-0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000e2e0: 2f66 726f 7374 6572 2e70 7920 272c 2066  /froster.py ', f
-0000e2f0: 272f 6672 6f73 7465 7220 2d2d 7072 6f66  '/froster --prof
-0000e300: 696c 6520 7b73 656c 662e 6172 6773 2e61  ile {self.args.a
-0000e310: 7773 5f70 726f 6669 6c65 7d20 2729 0a20  ws_profile} '). 
-0000e320: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000e330: 2020 2020 2020 2020 2063 6d64 6c69 6e65           cmdline
-0000e340: 203d 2063 6d64 6c69 6e65 2e72 6570 6c61   = cmdline.repla
-0000e350: 6365 2827 2f66 726f 7374 6572 2e70 7920  ce('/froster.py 
-0000e360: 272c 2027 2f66 726f 7374 6572 2027 290a  ', '/froster ').
-0000e370: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
-0000e380: 6f6c 6465 7273 5b30 5d20 696e 2063 6d64  olders[0] in cmd
-0000e390: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-0000e3a0: 2020 666f 6c64 6572 7320 3d20 2722 2022    folders = '" "
-0000e3b0: 272e 6a6f 696e 2866 6f6c 6465 7273 290a  '.join(folders).
-0000e3c0: 2020 2020 2020 2020 2020 2020 636d 646c              cmdl
-0000e3d0: 696e 6520 3d20 6627 7b63 6d64 6c69 6e65  ine = f'{cmdline
-0000e3e0: 7d20 227b 666f 6c64 6572 737d 2227 0a20  } "{folders}"'. 
-0000e3f0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-0000e400: 7267 732e 6465 6275 673a 0a20 2020 2020  rgs.debug:.     
-0000e410: 2020 2020 2020 2070 7269 6e74 2866 2743         print(f'C
-0000e420: 6f6d 6d61 6e64 206c 696e 6520 7061 7373  ommand line pass
-0000e430: 6564 2074 6f20 536c 7572 6d3a 5c6e 7b63  ed to Slurm:\n{c
-0000e440: 6d64 6c69 6e65 7d27 290a 2020 2020 2020  mdline}').      
-0000e450: 2020 7365 2e61 6464 5f6c 696e 6528 636d    se.add_line(cm
-0000e460: 646c 696e 6529 0a20 2020 2020 2020 206a  dline).        j
-0000e470: 6f62 6964 203d 2073 652e 7362 6174 6368  obid = se.sbatch
-0000e480: 2829 0a20 2020 2020 2020 2070 7269 6e74  ().        print
-0000e490: 2866 2753 7562 6d69 7474 6564 2066 726f  (f'Submitted fro
-0000e4a0: 7374 6572 2061 7263 6869 7669 6e67 206a  ster archiving j
-0000e4b0: 6f62 3a20 7b6a 6f62 6964 7d27 290a 2020  ob: {jobid}').  
-0000e4c0: 2020 2020 2020 7072 696e 7428 6627 4368        print(f'Ch
-0000e4d0: 6563 6b20 4a6f 6220 4f75 7470 7574 3a27  eck Job Output:'
-0000e4e0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0000e4f0: 6627 2074 6169 6c20 2d66 2066 726f 7374  f' tail -f frost
-0000e500: 6572 2d61 7263 6869 7665 2d7b 6c61 6265  er-archive-{labe
-0000e510: 6c7d 2d7b 6a6f 6269 647d 2e6f 7574 2729  l}-{jobid}.out')
-0000e520: 0a0a 2020 2020 6465 6620 6172 6368 6976  ..    def archiv
-0000e530: 655f 6c6f 6361 6c6c 7928 7365 6c66 2c20  e_locally(self, 
-0000e540: 666f 6c64 6572 5f74 6f5f 6172 6368 6976  folder_to_archiv
-0000e550: 652c 2069 735f 7265 6375 7273 6976 652c  e, is_recursive,
-0000e560: 206e 6968 2c20 6973 5f73 7562 666f 6c64   nih, is_subfold
-0000e570: 6572 2c20 6973 5f74 6172 2c20 6973 5f66  er, is_tar, is_f
-0000e580: 6f72 6365 293a 0a20 2020 2020 2020 2027  orce):.        '
-0000e590: 2727 4172 6368 6976 6520 7468 6520 6769  ''Archive the gi
-0000e5a0: 7665 6e20 666f 6c64 6572 2727 270a 0a20  ven folder'''.. 
-0000e5b0: 2020 2020 2020 2023 2053 6574 2077 6f72         # Set wor
-0000e5c0: 6b66 6c6f 7720 6578 6563 7574 696f 6e20  kflow execution 
-0000e5d0: 666c 6167 730a 2020 2020 2020 2020 6973  flags.        is
-0000e5e0: 5f66 6f6c 6465 725f 7461 7272 6564 203d  _folder_tarred =
-0000e5f0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-0000e600: 735f 666f 6c64 6572 5f61 7263 6869 7665  s_folder_archive
-0000e610: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-0000e620: 2020 6973 5f66 726f 7374 6572 5f61 6c6c    is_froster_all
-0000e630: 6669 6c65 735f 6765 6e65 7261 7465 6420  files_generated 
-0000e640: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0000e650: 6973 5f63 6865 636b 7375 6d5f 6765 6e65  is_checksum_gene
-0000e660: 7261 7465 6420 3d20 4661 6c73 650a 2020  rated = False.  
-0000e670: 2020 2020 2020 6973 5f63 6865 636b 7375        is_checksu
-0000e680: 6d5f 636f 7272 6563 7420 3d20 4661 6c73  m_correct = Fals
-0000e690: 650a 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
-0000e6a0: 2020 2020 2020 2020 2020 2020 7333 5f64              s3_d
-0000e6b0: 6573 7420 3d20 6f73 2e70 6174 682e 6a6f  est = os.path.jo
-0000e6c0: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-0000e6d0: 2020 2020 6627 3a73 333a 7b73 656c 662e      f':s3:{self.
-0000e6e0: 6366 672e 6275 636b 6574 5f6e 616d 657d  cfg.bucket_name}
-0000e6f0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000e700: 2020 2073 656c 662e 6366 672e 6172 6368     self.cfg.arch
-0000e710: 6976 655f 6469 722c 0a20 2020 2020 2020  ive_dir,.       
-0000e720: 2020 2020 2020 2020 2066 6f6c 6465 725f           folder_
-0000e730: 746f 5f61 7263 6869 7665 2e6c 7374 7269  to_archive.lstri
-0000e740: 7028 6f73 2e70 6174 682e 7365 7029 290a  p(os.path.sep)).
-0000e750: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0000e760: 4f44 4f3a 2076 6d61 6368 6164 6f3a 2072  ODO: vmachado: r
-0000e770: 6576 6965 7720 7468 6973 2063 6f64 650a  eview this code.
-0000e780: 2020 2020 2020 2020 2020 2020 6672 6f73              fros
-0000e790: 7465 725f 6d64 3573 756d 5f65 7869 7374  ter_md5sum_exist
-0000e7a0: 7320 3d20 6f73 2e70 6174 682e 6973 6669  s = os.path.isfi
-0000e7b0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000e7c0: 2020 2020 6f73 2e70 6174 682e 6a6f 696e      os.path.join
-0000e7d0: 2866 6f6c 6465 725f 746f 5f61 7263 6869  (folder_to_archi
-0000e7e0: 7665 2c20 222e 6672 6f73 7465 722e 6d64  ve, ".froster.md
-0000e7f0: 3573 756d 2229 290a 2020 2020 2020 2020  5sum")).        
-0000e800: 2020 2020 666f 6c64 6572 5f61 6c72 6561      folder_alrea
-0000e810: 6479 5f61 7263 6869 7665 6420 3d20 7365  dy_archived = se
-0000e820: 6c66 2e5f 6973 5f66 6f6c 6465 725f 6172  lf._is_folder_ar
-0000e830: 6368 6976 6564 280a 2020 2020 2020 2020  chived(.        
-0000e840: 2020 2020 2020 2020 666f 6c64 6572 5f74          folder_t
-0000e850: 6f5f 6172 6368 6976 652e 7273 7472 6970  o_archive.rstrip
-0000e860: 286f 732e 7061 7468 2e73 6570 2929 0a0a  (os.path.sep))..
-0000e870: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000e880: 6f6c 6465 725f 616c 7265 6164 795f 6172  older_already_ar
-0000e890: 6368 6976 6564 3a0a 2020 2020 2020 2020  chived:.        
-0000e8a0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-0000e8b0: 5c6e 466f 6c64 6572 207b 666f 6c64 6572  \nFolder {folder
-0000e8c0: 5f74 6f5f 6172 6368 6976 657d 2069 7320  _to_archive} is 
-0000e8d0: 616c 7265 6164 7920 6172 6368 6976 6564  already archived
-0000e8e0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-0000e8f0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0000e900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e910: 275c 6e50 6c65 6173 6520 7265 6665 7220  '\nPlease refer 
-0000e920: 746f 2074 6865 2066 726f 7374 6572 2064  to the froster d
-0000e930: 6f63 756d 656e 7461 7469 6f6e 2061 7420  ocumentation at 
-0000e940: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0000e950: 6f6d 2f64 6972 6b70 6574 6572 7365 6e2f  om/dirkpetersen/
-0000e960: 6672 6f73 7465 722f 5c6e 2729 0a20 2020  froster/\n').   
-0000e970: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0000e980: 2e65 7869 7428 3029 0a0a 2020 2020 2020  .exit(0)..      
-0000e990: 2020 2020 2020 6966 2066 726f 7374 6572        if froster
-0000e9a0: 5f6d 6435 7375 6d5f 6578 6973 7473 3a0a  _md5sum_exists:.
-0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9c0: 6966 2069 735f 666f 7263 653a 0a20 2020  if is_force:.   
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 2073 656c 662e 7265 7365 745f 666f 6c64   self.reset_fold
-0000e9f0: 6572 2866 6f6c 6465 725f 746f 5f61 7263  er(folder_to_arc
-0000ea00: 6869 7665 290a 2020 2020 2020 2020 2020  hive).          
-0000ea10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ea50: 275c 6e54 6865 2068 6173 6866 696c 6520  '\nThe hashfile 
-0000ea60: 222e 6672 6f73 7465 722e 6d64 3573 756d  ".froster.md5sum
-0000ea70: 2220 616c 7265 6164 7920 6578 6973 7473  " already exists
-0000ea80: 2069 6e20 7b66 6f6c 6465 725f 746f 5f61   in {folder_to_a
-0000ea90: 7263 6869 7665 7d20 6672 6f6d 2061 2070  rchive} from a p
-0000eaa0: 7265 7669 6f75 7320 6172 6368 6976 696e  revious archivin
-0000eab0: 6720 7072 6f63 6573 732e 2729 0a20 2020  g process.').   
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0000eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eaf0: 6627 5c6e 4966 2079 6f75 2077 616e 7420  f'\nIf you want 
-0000eb00: 746f 2066 6f72 6365 2074 6865 2061 7263  to force the arc
-0000eb10: 6869 7669 6e67 2070 726f 6365 7373 2061  hiving process a
-0000eb20: 6761 696e 206f 6e20 7468 6973 2066 6f6c  gain on this fol
-0000eb30: 6465 722c 2070 6c65 6173 6520 7573 2074  der, please us t
-0000eb40: 6865 202d 6620 6f72 202d 2d66 6f72 6365  he -f or --force
-0000eb50: 2066 6c61 675c 6e27 290a 2020 2020 2020   flag\n').      
-0000eb60: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0000eb70: 732e 6578 6974 2831 290a 0a20 2020 2020  s.exit(1)..     
-0000eb80: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-0000eb90: 6620 7468 6520 666f 6c64 6572 2069 7320  f the folder is 
-0000eba0: 656d 7074 790a 2020 2020 2020 2020 2020  empty.          
-0000ebb0: 2020 7769 7468 206f 732e 7363 616e 6469    with os.scandi
-0000ebc0: 7228 666f 6c64 6572 5f74 6f5f 6172 6368  r(folder_to_arch
-0000ebd0: 6976 6529 2061 7320 656e 7472 6965 733a  ive) as entries:
-0000ebe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ebf0: 2069 6620 6e6f 7420 616e 7928 5472 7565   if not any(True
-0000ec00: 2066 6f72 205f 2069 6e20 656e 7472 6965   for _ in entrie
-0000ec10: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000ec20: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2020 2066 275c 6e46 6f6c 6465         f'\nFolde
-0000ec50: 7220 7b66 6f6c 6465 725f 746f 5f61 7263  r {folder_to_arc
-0000ec60: 6869 7665 7d20 6973 2065 6d70 7479 2c20  hive} is empty, 
-0000ec70: 736b 6970 7069 6e67 2e5c 6e27 290a 2020  skipping.\n').  
-0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec90: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0000eca0: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
-0000ecb0: 4152 4348 4956 494e 4720 7b66 6f6c 6465  ARCHIVING {folde
-0000ecc0: 725f 746f 5f61 7263 6869 7665 7d27 290a  r_to_archive}').
-0000ecd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000ece0: 6973 5f74 6172 3a0a 2020 2020 2020 2020  is_tar:.        
-0000ecf0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-0000ed00: 5c6e 2020 2020 4765 6e65 7261 7469 6e67  \n    Generating
-0000ed10: 2046 726f 7374 6572 2e61 6c6c 6669 6c65   Froster.allfile
-0000ed20: 732e 6373 7620 616e 6420 7461 7220 736d  s.csv and tar sm
-0000ed30: 616c 6c20 6669 6c65 732e 2e2e 2729 0a20  all files...'). 
-0000ed40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000ed50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed60: 2070 7269 6e74 2866 275c 6e20 2020 2047   print(f'\n    G
-0000ed70: 656e 6572 6174 696e 6720 4672 6f73 7465  enerating Froste
-0000ed80: 722e 616c 6c66 696c 6573 2e63 7376 2e2e  r.allfiles.csv..
-0000ed90: 2e27 290a 0a20 2020 2020 2020 2020 2020  .')..           
-0000eda0: 2023 2047 656e 6572 6174 6520 4672 6f73   # Generate Fros
-0000edb0: 7465 722e 616c 6c66 696c 6573 2e63 7376  ter.allfiles.csv
-0000edc0: 2061 6e64 2069 6620 6973 5f74 6172 2074   and if is_tar t
-0000edd0: 6172 2073 6d61 6c6c 2066 696c 6573 0a20  ar small files. 
-0000ede0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000edf0: 6c66 2e5f 6765 6e5f 616c 6c66 696c 6573  lf._gen_allfiles
-0000ee00: 5f61 6e64 5f74 6172 2866 6f6c 6465 725f  _and_tar(folder_
-0000ee10: 746f 5f61 7263 6869 7665 2c20 7365 6c66  to_archive, self
-0000ee20: 2e74 6872 6573 686f 6c64 4b42 2c20 6973  .thresholdKB, is
-0000ee30: 5f74 6172 293a 0a20 2020 2020 2020 2020  _tar):.         
-0000ee40: 2020 2020 2020 2069 735f 6672 6f73 7465         is_froste
-0000ee50: 725f 616c 6c66 696c 6573 5f67 656e 6572  r_allfiles_gener
-0000ee60: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
-0000ee70: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000ee80: 7428 6627 2020 2020 2020 2020 2e2e 2e64  t(f'        ...d
-0000ee90: 6f6e 6527 290a 2020 2020 2020 2020 2020  one').          
-0000eea0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000eeb0: 2020 2020 2020 2020 2320 536f 6d65 7468          # Someth
-0000eec0: 696e 6720 6661 696c 6564 2c20 6578 6974  ing failed, exit
-0000eed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eee0: 2070 7269 6e74 2866 2720 2020 2020 2020   print(f'       
-0000eef0: 202e 2e2e 4641 494c 4544 5c6e 2729 0a20   ...FAILED\n'). 
-0000ef00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ef10: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
-0000ef20: 2020 2023 2047 656e 6572 6174 6520 6d64     # Generate md
-0000ef30: 3520 6368 6563 6b73 756d 7320 666f 7220  5 checksums for 
-0000ef40: 616c 6c20 6669 6c65 7320 696e 2074 6865  all files in the
-0000ef50: 2066 6f6c 6465 720a 2020 2020 2020 2020   folder.        
-0000ef60: 2020 2020 7072 696e 7428 6627 5c6e 2020      print(f'\n  
-0000ef70: 2020 4765 6e65 7261 7469 6e67 2063 6865    Generating che
-0000ef80: 636b 7375 6d73 2e2e 2e27 290a 2020 2020  cksums...').    
-0000ef90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000efa0: 5f67 656e 5f6d 6435 7375 6d73 2866 6f6c  _gen_md5sums(fol
-0000efb0: 6465 725f 746f 5f61 7263 6869 7665 2c20  der_to_archive, 
-0000efc0: 7365 6c66 2e6d 6435 7375 6d5f 6669 6c65  self.md5sum_file
-0000efd0: 6e61 6d65 293a 0a20 2020 2020 2020 2020  name):.         
-0000efe0: 2020 2020 2020 2069 735f 6368 6563 6b73         is_checks
-0000eff0: 756d 5f67 656e 6572 6174 6564 203d 2054  um_generated = T
-0000f000: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000f010: 2020 2020 7072 696e 7428 2720 2020 2020      print('     
-0000f020: 2020 202e 2e2e 646f 6e65 2729 0a20 2020     ...done').   
-0000f030: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f050: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
-0000f060: 2020 2023 2047 6574 2074 6865 2070 6174     # Get the pat
-0000f070: 6820 746f 2074 6865 2068 6173 6866 696c  h to the hashfil
-0000f080: 650a 2020 2020 2020 2020 2020 2020 6861  e.            ha
-0000f090: 7368 6669 6c65 203d 206f 732e 7061 7468  shfile = os.path
-0000f0a0: 2e6a 6f69 6e28 666f 6c64 6572 5f74 6f5f  .join(folder_to_
-0000f0b0: 6172 6368 6976 652c 2073 656c 662e 6d64  archive, self.md
-0000f0c0: 3573 756d 5f66 696c 656e 616d 6529 0a0a  5sum_filename)..
-0000f0d0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-0000f0e0: 6561 7465 2061 6e20 5263 6c6f 6e65 206f  eate an Rclone o
-0000f0f0: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
-0000f100: 2020 7263 6c6f 6e65 203d 2052 636c 6f6e    rclone = Rclon
-0000f110: 6528 7365 6c66 2e61 7267 732c 2073 656c  e(self.args, sel
-0000f120: 662e 6366 6729 0a0a 2020 2020 2020 2020  f.cfg)..        
-0000f130: 2020 2020 2320 4172 6368 6976 6520 7468      # Archive th
-0000f140: 6520 666f 6c64 6572 2074 6f20 5333 0a20  e folder to S3. 
-0000f150: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000f160: 2866 275c 6e20 2020 2055 706c 6f61 6469  (f'\n    Uploadi
-0000f170: 6e67 2066 696c 6573 2e2e 2e27 290a 2020  ng files...').  
-0000f180: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0000f190: 7263 6c6f 6e65 2e63 6f70 7928 666f 6c64  rclone.copy(fold
-0000f1a0: 6572 5f74 6f5f 6172 6368 6976 652c 2073  er_to_archive, s
-0000f1b0: 335f 6465 7374 2c20 272d 2d6d 6178 2d64  3_dest, '--max-d
-0000f1c0: 6570 7468 272c 2027 3127 2c20 272d 2d6c  epth', '1', '--l
-0000f1d0: 696e 6b73 272c 0a20 2020 2020 2020 2020  inks',.         
-0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1f0: 2020 2020 2027 2d2d 6578 636c 7564 6527       '--exclude'
-0000f200: 2c20 7365 6c66 2e6d 6435 7375 6d5f 6669  , self.md5sum_fi
-0000f210: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-0000f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f230: 2020 2020 2020 272d 2d65 7863 6c75 6465        '--exclude
-0000f240: 272c 2073 656c 662e 6d64 3573 756d 5f72  ', self.md5sum_r
-0000f250: 6573 746f 7265 645f 6669 6c65 6e61 6d65  estored_filename
-0000f260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f280: 272d 2d65 7863 6c75 6465 272c 2073 656c  '--exclude', sel
-0000f290: 662e 616c 6c66 696c 6573 5f63 7376 5f66  f.allfiles_csv_f
-0000f2a0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2c0: 2020 2020 2020 2027 2d2d 6578 636c 7564         '--exclud
-0000f2d0: 6527 2c20 7365 6c66 2e77 6865 7265 5f64  e', self.where_d
-0000f2e0: 6964 5f74 6865 5f66 696c 6573 5f67 6f5f  id_the_files_go_
-0000f2f0: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
-0000f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f310: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000f320: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000f330: 2074 6865 2066 6f6c 6465 7220 7761 7320   the folder was 
-0000f340: 6172 6368 6976 6564 2073 7563 6365 7373  archived success
-0000f350: 6675 6c6c 790a 2020 2020 2020 2020 2020  fully.          
-0000f360: 2020 6966 2072 6574 3a0a 2020 2020 2020    if ret:.      
-0000f370: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000f380: 2720 2020 2020 2020 202e 2e2e 646f 6e65  '        ...done
-0000f390: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0000f3a0: 2020 2069 735f 666f 6c64 6572 5f61 7263     is_folder_arc
-0000f3b0: 6869 7665 6420 3d20 5472 7565 0a20 2020  hived = True.   
-0000f3c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000f3e0: 7269 6e74 2827 2020 2020 2020 2020 2e2e  rint('        ..
-0000f3f0: 2e46 4149 4c45 445c 6e27 290a 2020 2020  .FAILED\n').    
-0000f400: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000f410: 726e 0a0a 2020 2020 2020 2020 2020 2020  rn..            
-0000f420: 2320 4765 7420 7468 6520 7061 7468 2074  # Get the path t
-0000f430: 6f20 7468 6520 616c 6c66 696c 6573 2043  o the allfiles C
-0000f440: 5356 2066 696c 650a 2020 2020 2020 2020  SV file.        
-0000f450: 2020 2020 616c 6c66 696c 6573 5f73 6f75      allfiles_sou
-0000f460: 7263 6520 3d20 6f73 2e70 6174 682e 6a6f  rce = os.path.jo
-0000f470: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-0000f480: 2020 2020 666f 6c64 6572 5f74 6f5f 6172      folder_to_ar
-0000f490: 6368 6976 652c 2073 656c 662e 616c 6c66  chive, self.allf
-0000f4a0: 696c 6573 5f63 7376 5f66 696c 656e 616d  iles_csv_filenam
-0000f4b0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0000f4c0: 7072 696e 7428 6627 5c6e 2020 2020 5570  print(f'\n    Up
-0000f4d0: 6c6f 6164 696e 6720 4672 6f73 7465 722e  loading Froster.
-0000f4e0: 616c 6c66 696c 6573 2e63 7376 2066 696c  allfiles.csv fil
-0000f4f0: 652e 2e2e 2729 0a0a 2020 2020 2020 2020  e...')..        
-0000f500: 2020 2020 2320 4368 616e 6765 2074 6865      # Change the
-0000f510: 2073 746f 7261 6765 2063 6c61 7373 2074   storage class t
-0000f520: 6f20 494e 5445 4c4c 4947 454e 545f 5449  o INTELLIGENT_TI
-0000f530: 4552 494e 470a 2020 2020 2020 2020 2020  ERING.          
-0000f540: 2020 7263 6c6f 6e65 2e65 6e76 726e 5b27    rclone.envrn['
-0000f550: 5243 4c4f 4e45 5f53 335f 5354 4f52 4147  RCLONE_S3_STORAG
-0000f560: 455f 434c 4153 5327 5d20 3d20 2749 4e54  E_CLASS'] = 'INT
-0000f570: 454c 4c49 4745 4e54 5f54 4945 5249 4e47  ELLIGENT_TIERING
-0000f580: 270a 0a20 2020 2020 2020 2020 2020 2023  '..            #
-0000f590: 2041 7263 6869 7665 2074 6865 2061 6c6c   Archive the all
-0000f5a0: 6669 6c65 7320 4353 5620 6669 6c65 2074  files CSV file t
-0000f5b0: 6f20 5333 2049 4e54 454c 4c49 4745 4e54  o S3 INTELLIGENT
-0000f5c0: 5f54 4945 5249 4e47 0a20 2020 2020 2020  _TIERING.       
-0000f5d0: 2020 2020 2072 6574 203d 2072 636c 6f6e       ret = rclon
-0000f5e0: 652e 636f 7079 2861 6c6c 6669 6c65 735f  e.copy(allfiles_
-0000f5f0: 736f 7572 6365 2c20 7333 5f64 6573 742c  source, s3_dest,
-0000f600: 2027 2d2d 6d61 782d 6465 7074 6827 2c20   '--max-depth', 
-0000f610: 2731 272c 2027 2d2d 6c69 6e6b 7327 2c0a  '1', '--links',.
-0000f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f630: 2020 2020 2020 2020 2020 2020 2020 272d                '-
-0000f640: 2d65 7863 6c75 6465 272c 2073 656c 662e  -exclude', self.
-0000f650: 6d64 3573 756d 5f66 696c 656e 616d 652c  md5sum_filename,
-0000f660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f670: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000f680: 2d2d 6578 636c 7564 6527 2c20 7365 6c66  --exclude', self
-0000f690: 2e6d 6435 7375 6d5f 7265 7374 6f72 6564  .md5sum_restored
-0000f6a0: 5f66 696c 656e 616d 652c 0a20 2020 2020  _filename,.     
+0000d9d0: 6520 5661 6c75 6545 7272 6f72 2822 4275  e ValueError("Bu
+0000d9e0: 636b 6574 206e 616d 6520 6e6f 7420 7072  cket name not pr
+0000d9f0: 6f76 6964 6564 2229 0a0a 2020 2020 2020  ovided")..      
+0000da00: 2020 7472 793a 0a0a 2020 2020 2020 2020    try:..        
+0000da10: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+0000da20: 6865 2073 6573 7369 6f6e 2069 7320 7661  he session is va
+0000da30: 6c69 640a 2020 2020 2020 2020 2020 2020  lid.            
+0000da40: 6966 206e 6f74 2073 656c 662e 5f63 6865  if not self._che
+0000da50: 636b 5f73 6573 7369 6f6e 2829 3a0a 2020  ck_session():.  
+0000da60: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000da70: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0000da80: 2020 2020 2020 2020 2066 225c 6e45 7272           f"\nErr
+0000da90: 6f72 3a20 4157 5320 6372 6564 656e 7469  or: AWS credenti
+0000daa0: 616c 7320 6172 6520 6e6f 7420 7661 6c69  als are not vali
+0000dab0: 6420 666f 7220 7072 6f66 696c 6520 7b73  d for profile {s
+0000dac0: 656c 662e 6366 672e 6177 735f 7072 6f66  elf.cfg.aws_prof
+0000dad0: 696c 657d 2229 0a20 2020 2020 2020 2020  ile}").         
+0000dae0: 2020 2020 2020 2070 7269 6e74 2822 7275         print("ru
+0000daf0: 6e20 2766 726f 7374 6572 2063 6f6e 6669  n 'froster confi
+0000db00: 6720 2d2d 6177 7327 2074 6f20 6669 7820  g --aws' to fix 
+0000db10: 7468 6973 2e5c 6e22 290a 2020 2020 2020  this.\n").      
+0000db20: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0000db30: 6974 2831 290a 0a20 2020 2020 2020 2020  it(1)..         
+0000db40: 2020 2070 7269 6e74 2866 275c 6e43 7265     print(f'\nCre
+0000db50: 6174 696e 6720 6275 636b 6574 207b 6275  ating bucket {bu
+0000db60: 636b 6574 5f6e 616d 657d 2e2e 2e27 290a  cket_name}...').
+0000db70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000db80: 662e 7333 5f63 6c69 656e 742e 6372 6561  f.s3_client.crea
+0000db90: 7465 5f62 7563 6b65 7428 4275 636b 6574  te_bucket(Bucket
+0000dba0: 3d62 7563 6b65 745f 6e61 6d65 2c0a 2020  =bucket_name,.  
+0000dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbd0: 2020 2020 2020 2043 7265 6174 6542 7563         CreateBuc
+0000dbe0: 6b65 7443 6f6e 6669 6775 7261 7469 6f6e  ketConfiguration
+0000dbf0: 3d7b 274c 6f63 6174 696f 6e43 6f6e 7374  ={'LocationConst
+0000dc00: 7261 696e 7427 3a20 7265 6769 6f6e 7d29  raint': region})
+0000dc10: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000dc20: 6e74 2866 2720 2020 202e 2e2e 6275 636b  nt(f'    ...buck
+0000dc30: 6574 2063 7265 6174 6564 5c6e 2729 0a0a  et created\n')..
+0000dc40: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000dc50: 7428 6627 5c6e 4170 706c 7969 6e67 2041  t(f'\nApplying A
+0000dc60: 4553 3235 3620 656e 6372 7970 7469 6f6e  ES256 encryption
+0000dc70: 2074 6f20 6275 636b 6574 207b 6275 636b   to bucket {buck
+0000dc80: 6574 5f6e 616d 657d 2e2e 2e27 290a 2020  et_name}...').  
+0000dc90: 2020 2020 2020 2020 2020 656e 6372 7970            encryp
+0000dca0: 7469 6f6e 5f63 6f6e 6669 6775 7261 7469  tion_configurati
+0000dcb0: 6f6e 203d 207b 0a20 2020 2020 2020 2020  on = {.         
+0000dcc0: 2020 2020 2020 2027 5275 6c65 7327 3a20         'Rules': 
+0000dcd0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0000dce0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+0000dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd00: 2741 7070 6c79 5365 7276 6572 5369 6465  'ApplyServerSide
+0000dd10: 456e 6372 7970 7469 6f6e 4279 4465 6661  EncryptionByDefa
+0000dd20: 756c 7427 3a20 7b0a 2020 2020 2020 2020  ult': {.        
+0000dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd40: 2020 2020 2753 5345 416c 676f 7269 7468      'SSEAlgorith
+0000dd50: 6d27 3a20 2741 4553 3235 3627 0a20 2020  m': 'AES256'.   
+0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd70: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0000dd80: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+0000dd90: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+0000dda0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+0000ddb0: 2020 2020 2020 2020 2073 656c 662e 7333           self.s3
+0000ddc0: 5f63 6c69 656e 742e 7075 745f 6275 636b  _client.put_buck
+0000ddd0: 6574 5f65 6e63 7279 7074 696f 6e28 0a20  et_encryption(. 
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2042                 B
+0000ddf0: 7563 6b65 743d 6275 636b 6574 5f6e 616d  ucket=bucket_nam
+0000de00: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000de10: 2020 2053 6572 7665 7253 6964 6545 6e63     ServerSideEnc
+0000de20: 7279 7074 696f 6e43 6f6e 6669 6775 7261  ryptionConfigura
+0000de30: 7469 6f6e 3d65 6e63 7279 7074 696f 6e5f  tion=encryption_
+0000de40: 636f 6e66 6967 7572 6174 696f 6e0a 2020  configuration.  
+0000de50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000de60: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+0000de70: 2020 2020 2e2e 2e65 6e63 7279 7074 696f      ...encryptio
+0000de80: 6e20 6170 706c 6965 642e 5c6e 2729 0a0a  n applied.\n')..
+0000de90: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0000dea0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0000deb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000dec0: 2866 2745 7272 6f72 2063 7265 6174 696e  (f'Error creatin
+0000ded0: 6720 6275 636b 6574 207b 6275 636b 6574  g bucket {bucket
+0000dee0: 5f6e 616d 657d 3a20 7b65 7d27 290a 2020  _name}: {e}').  
+0000def0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0000df00: 6974 2831 290a 0a20 2020 2020 2020 2023  it(1)..        #
+0000df10: 2054 4f44 4f3a 2065 7870 616e 6420 6572   TODO: expand er
+0000df20: 726f 7220 636f 6465 730a 0a20 2020 2020  ror codes..     
+0000df30: 2020 2023 2065 7863 6570 7420 626f 746f     # except boto
+0000df40: 636f 7265 2e65 7863 6570 7469 6f6e 732e  core.exceptions.
+0000df50: 426f 746f 436f 7265 4572 726f 7220 6173  BotoCoreError as
+0000df60: 2065 3a0a 2020 2020 2020 2020 2320 2020   e:.        #   
+0000df70: 2020 7072 696e 7428 6622 426f 746f 436f    print(f"BotoCo
+0000df80: 7265 4572 726f 723a 207b 657d 2229 0a20  reError: {e}"). 
+0000df90: 2020 2020 2020 2023 2065 7863 6570 7420         # except 
+0000dfa0: 626f 746f 636f 7265 2e65 7863 6570 7469  botocore.excepti
+0000dfb0: 6f6e 732e 436c 6965 6e74 4572 726f 7220  ons.ClientError 
+0000dfc0: 6173 2065 3a0a 2020 2020 2020 2020 2320  as e:.        # 
+0000dfd0: 2020 2020 6572 726f 725f 636f 6465 203d      error_code =
+0000dfe0: 2065 2e72 6573 706f 6e73 655b 2745 7272   e.response['Err
+0000dff0: 6f72 275d 5b27 436f 6465 275d 0a20 2020  or']['Code'].   
+0000e000: 2020 2020 2023 2020 2020 2069 6620 6572       #     if er
+0000e010: 726f 725f 636f 6465 203d 3d20 2749 6e76  ror_code == 'Inv
+0000e020: 616c 6964 4275 636b 6574 4e61 6d65 273a  alidBucketName':
+0000e030: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000e040: 2020 2070 7269 6e74 2866 2245 7272 6f72     print(f"Error
+0000e050: 3a20 496e 7661 6c69 6420 6275 636b 6574  : Invalid bucket
+0000e060: 206e 616d 6520 277b 6275 636b 6574 5f6e   name '{bucket_n
+0000e070: 616d 657d 275c 6e7b 657d 2229 0a20 2020  ame}'\n{e}").   
+0000e080: 2020 2020 2023 2020 2020 2065 6c69 6620       #     elif 
+0000e090: 6572 726f 725f 636f 6465 203d 3d20 2742  error_code == 'B
+0000e0a0: 7563 6b65 7441 6c72 6561 6479 4578 6973  ucketAlreadyExis
+0000e0b0: 7473 273a 0a20 2020 2020 2020 2023 2020  ts':.        #  
+0000e0c0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000e0d0: 2020 2020 2320 2020 2020 2020 2020 2320      #         # 
+0000e0e0: 7072 696e 7428 6622 4572 726f 723a 2042  print(f"Error: B
+0000e0f0: 7563 6b65 7420 277b 6275 636b 6574 5f6e  ucket '{bucket_n
+0000e100: 616d 657d 2720 616c 7265 6164 7920 6578  ame}' already ex
+0000e110: 6973 7473 2e22 290a 2020 2020 2020 2020  ists.").        
+0000e120: 2320 2020 2020 656c 6966 2065 7272 6f72  #     elif error
+0000e130: 5f63 6f64 6520 3d3d 2027 4275 636b 6574  _code == 'Bucket
+0000e140: 416c 7265 6164 794f 776e 6564 4279 596f  AlreadyOwnedByYo
+0000e150: 7527 3a0a 2020 2020 2020 2020 2320 2020  u':.        #   
+0000e160: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0000e170: 2020 2023 2020 2020 2020 2020 2023 2070     #         # p
+0000e180: 7269 6e74 2866 2245 7272 6f72 3a20 596f  rint(f"Error: Yo
+0000e190: 7520 616c 7265 6164 7920 6f77 6e20 6120  u already own a 
+0000e1a0: 6275 636b 6574 206e 616d 6564 2027 7b62  bucket named '{b
+0000e1b0: 7563 6b65 745f 6e61 6d65 7d27 2e22 290a  ucket_name}'.").
+0000e1c0: 2020 2020 2020 2020 2320 2020 2020 656c          #     el
+0000e1d0: 6966 2065 7272 6f72 5f63 6f64 6520 3d3d  if error_code ==
+0000e1e0: 2027 496e 7661 6c69 6441 6363 6573 734b   'InvalidAccessK
+0000e1f0: 6579 4964 273a 0a20 2020 2020 2020 2023  eyId':.        #
+0000e200: 2020 2020 2020 2020 2023 2070 6173 730a           # pass.
+0000e210: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000e220: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0000e230: 2023 2020 2020 2020 2020 2020 2020 2022   #             "
+0000e240: 4572 726f 723a 2049 6e76 616c 6964 4163  Error: InvalidAc
+0000e250: 6365 7373 4b65 7949 642e 2054 6865 2041  cessKeyId. The A
+0000e260: 5753 2041 6363 6573 7320 4b65 7920 4964  WS Access Key Id
+0000e270: 2079 6f75 2070 726f 7669 6465 6420 646f   you provided do
+0000e280: 6573 206e 6f74 2065 7869 7374 2069 6e20  es not exist in 
+0000e290: 6f75 7220 7265 636f 7264 7322 290a 2020  our records").  
+0000e2a0: 2020 2020 2020 2320 2020 2020 656c 6966        #     elif
+0000e2b0: 2065 7272 6f72 5f63 6f64 6520 3d3d 2027   error_code == '
+0000e2c0: 5369 676e 6174 7572 6544 6f65 734e 6f74  SignatureDoesNot
+0000e2d0: 4d61 7463 6827 3a0a 2020 2020 2020 2020  Match':.        
+0000e2e0: 2320 2020 2020 2020 2020 7061 7373 0a20  #         pass. 
+0000e2f0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000e300: 2023 2070 7269 6e74 2822 4572 726f 723a   # print("Error:
+0000e310: 2049 6e76 616c 6964 2041 5753 2053 6563   Invalid AWS Sec
+0000e320: 7265 7420 4163 6365 7373 204b 6579 2e22  ret Access Key."
+0000e330: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
+0000e340: 656c 6966 2065 7272 6f72 5f63 6f64 6520  elif error_code 
+0000e350: 3d3d 2027 4163 6365 7373 4465 6e69 6564  == 'AccessDenied
+0000e360: 273a 0a20 2020 2020 2020 2023 2020 2020  ':.        #    
+0000e370: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0000e380: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000e390: 2020 2245 7272 6f72 3a20 4163 6365 7373    "Error: Access
+0000e3a0: 2064 656e 6965 642e 2043 6865 636b 2079   denied. Check y
+0000e3b0: 6f75 7220 6163 636f 756e 7420 7065 726d  our account perm
+0000e3c0: 6973 7369 6f6e 7320 666f 7220 6372 6561  issions for crea
+0000e3d0: 7469 6e67 2053 3320 6275 636b 6574 7322  ting S3 buckets"
+0000e3e0: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
+0000e3f0: 656c 6966 2065 7272 6f72 5f63 6f64 6520  elif error_code 
+0000e400: 3d3d 2027 496c 6c65 6761 6c4c 6f63 6174  == 'IllegalLocat
+0000e410: 696f 6e43 6f6e 7374 7261 696e 7445 7863  ionConstraintExc
+0000e420: 6570 7469 6f6e 273a 0a20 2020 2020 2020  eption':.       
+0000e430: 2023 2020 2020 2020 2020 2070 7269 6e74   #         print
+0000e440: 2866 2245 7272 6f72 3a20 5468 6520 7370  (f"Error: The sp
+0000e450: 6563 6966 6965 6420 7265 6769 6f6e 2027  ecified region '
+0000e460: 7b72 6567 696f 6e7d 2720 6973 206e 6f74  {region}' is not
+0000e470: 2076 616c 6964 2e22 290a 2020 2020 2020   valid.").      
+0000e480: 2020 2320 2020 2020 656c 7365 3a0a 2020    #     else:.  
+0000e490: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0000e4a0: 7072 696e 7428 6622 436c 6965 6e74 4572  print(f"ClientEr
+0000e4b0: 726f 723a 207b 657d 2229 0a20 2020 2020  ror: {e}").     
+0000e4c0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+0000e4d0: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
+0000e4e0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0000e4f0: 2061 7320 653a 0a20 2020 2020 2020 2023   as e:.        #
+0000e500: 2020 2020 2070 7269 6e74 2866 2241 6e20       print(f"An 
+0000e510: 756e 6578 7065 6374 6564 2065 7272 6f72  unexpected error
+0000e520: 206f 6363 7572 7265 643a 207b 657d 2229   occurred: {e}")
+0000e530: 0a20 2020 2020 2020 2023 2020 2020 2072  .        #     r
+0000e540: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000e550: 2020 2020 2023 2065 6e63 7279 7074 696f       # encryptio
+0000e560: 6e5f 636f 6e66 6967 7572 6174 696f 6e20  n_configuration 
+0000e570: 3d20 7b0a 2020 2020 2020 2020 2320 2020  = {.        #   
+0000e580: 2020 2752 756c 6573 273a 205b 0a20 2020    'Rules': [.   
+0000e590: 2020 2020 2023 2020 2020 2020 2020 207b       #         {
+0000e5a0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000e5b0: 2020 2020 2020 2027 4170 706c 7953 6572         'ApplySer
+0000e5c0: 7665 7253 6964 6545 6e63 7279 7074 696f  verSideEncryptio
+0000e5d0: 6e42 7944 6566 6175 6c74 273a 207b 0a20  nByDefault': {. 
+0000e5e0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000e5f0: 2020 2020 2020 2020 2027 5353 4541 6c67           'SSEAlg
+0000e600: 6f72 6974 686d 273a 2027 4145 5332 3536  orithm': 'AES256
+0000e610: 270a 2020 2020 2020 2020 2320 2020 2020  '.        #     
+0000e620: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0000e630: 2020 2320 2020 2020 2020 2020 7d0a 2020    #         }.  
+0000e640: 2020 2020 2020 2320 2020 2020 5d0a 2020        #     ].  
+0000e650: 2020 2020 2020 2320 7d0a 2020 2020 2020        # }.      
+0000e660: 2020 2320 7472 793a 0a20 2020 2020 2020    # try:.       
+0000e670: 2023 2020 2020 2072 6573 706f 6e73 6520   #     response 
+0000e680: 3d20 7333 5f63 6c69 656e 742e 7075 745f  = s3_client.put_
+0000e690: 6275 636b 6574 5f65 6e63 7279 7074 696f  bucket_encryptio
+0000e6a0: 6e28 0a20 2020 2020 2020 2023 2020 2020  n(.        #    
+0000e6b0: 2020 2020 2042 7563 6b65 743d 6275 636b       Bucket=buck
+0000e6c0: 6574 5f6e 616d 652c 0a20 2020 2020 2020  et_name,.       
+0000e6d0: 2023 2020 2020 2020 2020 2053 6572 7665   #         Serve
+0000e6e0: 7253 6964 6545 6e63 7279 7074 696f 6e43  rSideEncryptionC
+0000e6f0: 6f6e 6669 6775 7261 7469 6f6e 3d65 6e63  onfiguration=enc
+0000e700: 7279 7074 696f 6e5f 636f 6e66 6967 7572  ryption_configur
+0000e710: 6174 696f 6e0a 2020 2020 2020 2020 2320  ation.        # 
+0000e720: 2020 2020 290a 2020 2020 2020 2020 2320      ).        # 
+0000e730: 2020 2020 7072 696e 7428 6622 4170 706c      print(f"Appl
+0000e740: 6965 6420 4145 5332 3536 2065 6e63 7279  ied AES256 encry
+0000e750: 7074 696f 6e20 746f 2053 3320 6275 636b  ption to S3 buck
+0000e760: 6574 2027 7b62 7563 6b65 745f 6e61 6d65  et '{bucket_name
+0000e770: 7d27 2229 0a20 2020 2020 2020 2023 2065  }'").        # e
+0000e780: 7863 6570 7420 626f 746f 636f 7265 2e65  xcept botocore.e
+0000e790: 7863 6570 7469 6f6e 732e 436c 6965 6e74  xceptions.Client
+0000e7a0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000e7b0: 2020 2020 2320 2020 2020 6572 726f 725f      #     error_
+0000e7c0: 636f 6465 203d 2065 2e72 6573 706f 6e73  code = e.respons
+0000e7d0: 655b 2745 7272 6f72 275d 5b27 436f 6465  e['Error']['Code
+0000e7e0: 275d 0a20 2020 2020 2020 2023 2020 2020  '].        #    
+0000e7f0: 2069 6620 6572 726f 725f 636f 6465 203d   if error_code =
+0000e800: 3d20 2749 6e76 616c 6964 4275 636b 6574  = 'InvalidBucket
+0000e810: 4e61 6d65 273a 0a20 2020 2020 2020 2023  Name':.        #
+0000e820: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0000e830: 2245 7272 6f72 3a20 496e 7661 6c69 6420  "Error: Invalid 
+0000e840: 6275 636b 6574 206e 616d 6520 277b 6275  bucket name '{bu
+0000e850: 636b 6574 5f6e 616d 657d 275c 6e7b 657d  cket_name}'\n{e}
+0000e860: 2229 0a20 2020 2020 2020 2023 2020 2020  ").        #    
+0000e870: 2065 6c69 6620 6572 726f 725f 636f 6465   elif error_code
+0000e880: 203d 3d20 2741 6363 6573 7344 656e 6965   == 'AccessDenie
+0000e890: 6427 3a0a 2020 2020 2020 2020 2320 2020  d':.        #   
+0000e8a0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0000e8b0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+0000e8c0: 2020 2022 4572 726f 723a 2041 6363 6573     "Error: Acces
+0000e8d0: 7320 6465 6e69 6564 2e20 4368 6563 6b20  s denied. Check 
+0000e8e0: 796f 7572 2061 6363 6f75 6e74 2070 6572  your account per
+0000e8f0: 6d69 7373 696f 6e73 2066 6f72 2063 7265  missions for cre
+0000e900: 6174 696e 6720 5333 2062 7563 6b65 7473  ating S3 buckets
+0000e910: 2229 0a20 2020 2020 2020 2023 2020 2020  ").        #    
+0000e920: 2065 6c69 6620 6572 726f 725f 636f 6465   elif error_code
+0000e930: 203d 3d20 2749 6c6c 6567 616c 4c6f 6361   == 'IllegalLoca
+0000e940: 7469 6f6e 436f 6e73 7472 6169 6e74 4578  tionConstraintEx
+0000e950: 6365 7074 696f 6e27 3a0a 2020 2020 2020  ception':.      
+0000e960: 2020 2320 2020 2020 2020 2020 7072 696e    #         prin
+0000e970: 7428 6622 4572 726f 723a 2054 6865 2073  t(f"Error: The s
+0000e980: 7065 6369 6669 6564 2072 6567 696f 6e20  pecified region 
+0000e990: 277b 7265 6769 6f6e 7d27 2069 7320 6e6f  '{region}' is no
+0000e9a0: 7420 7661 6c69 642e 2229 0a20 2020 2020  t valid.").     
+0000e9b0: 2020 2023 2020 2020 2065 6c69 6620 6572     #     elif er
+0000e9c0: 726f 725f 636f 6465 203d 3d20 2749 6e76  ror_code == 'Inv
+0000e9d0: 616c 6964 4c6f 6361 7469 6f6e 436f 6e73  alidLocationCons
+0000e9e0: 7472 6169 6e74 273a 0a20 2020 2020 2020  traint':.       
+0000e9f0: 2023 2020 2020 2020 2020 2069 6620 6e6f   #         if no
+0000ea00: 7420 6570 5f75 726c 3a0a 2020 2020 2020  t ep_url:.      
+0000ea10: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000ea20: 2320 646f 206e 6f74 2073 686f 7720 7468  # do not show th
+0000ea30: 6973 2065 7272 6f72 2077 6974 6820 6e6f  is error with no
+0000ea40: 6e20 4157 5320 656e 6470 6f69 6e74 730a  n AWS endpoints.
+0000ea50: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000ea60: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0000ea70: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+0000ea80: 2020 2020 2020 2066 2245 7272 6f72 3a20         f"Error: 
+0000ea90: 5468 6520 7370 6563 6966 6965 6420 6c6f  The specified lo
+0000eaa0: 6361 7469 6f6e 2d63 6f6e 7374 7261 696e  cation-constrain
+0000eab0: 7420 277b 7265 6769 6f6e 7d27 2069 7320  t '{region}' is 
+0000eac0: 6e6f 7420 7661 6c69 6422 290a 2020 2020  not valid").    
+0000ead0: 2020 2020 2320 2020 2020 656c 7365 3a0a      #     else:.
+0000eae0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000eaf0: 2020 7072 696e 7428 6622 436c 6965 6e74    print(f"Client
+0000eb00: 4572 726f 723a 207b 657d 2229 0a20 2020  Error: {e}").   
+0000eb10: 2020 2020 2023 2065 7863 6570 7420 4578       # except Ex
+0000eb20: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+0000eb30: 2020 2020 2020 2320 2020 2020 7072 696e        #     prin
+0000eb40: 7428 6622 416e 2075 6e65 7870 6563 7465  t(f"An unexpecte
+0000eb50: 6420 6572 726f 7220 6f63 6375 7272 6564  d error occurred
+0000eb60: 2069 6e20 6372 6561 7465 5f62 7563 6b65   in create_bucke
+0000eb70: 743a 207b 657d 2229 0a20 2020 2020 2020  t: {e}").       
+0000eb80: 2023 2020 2020 2072 6574 7572 6e20 4661   #     return Fa
+0000eb90: 6c73 650a 2020 2020 2020 2020 2320 7265  lse.        # re
+0000eba0: 7475 726e 2054 7275 650a 0a20 2020 2064  turn True..    d
+0000ebb0: 6566 2067 6574 5f62 7563 6b65 7473 2873  ef get_buckets(s
+0000ebc0: 656c 6629 3a0a 2020 2020 2020 2020 2727  elf):.        ''
+0000ebd0: 2720 4765 7420 6120 6c69 7374 206f 6620  ' Get a list of 
+0000ebe0: 616c 6c20 7468 6520 6672 6f73 7465 7220  all the froster 
+0000ebf0: 6275 636b 6574 7320 696e 2074 6865 2063  buckets in the c
+0000ec00: 7572 7265 6e74 2073 6573 7369 6f6e 2727  urrent session''
+0000ec10: 270a 0a20 2020 2020 2020 2074 7279 3a0a  '..        try:.
+0000ec20: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0000ec30: 6865 636b 2069 6620 7468 6520 7365 7373  heck if the sess
+0000ec40: 696f 6e20 6973 2076 616c 6964 0a20 2020  ion is valid.   
+0000ec50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000ec60: 7365 6c66 2e5f 6368 6563 6b5f 7365 7373  self._check_sess
+0000ec70: 696f 6e28 293a 0a20 2020 2020 2020 2020  ion():.         
+0000ec80: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eca0: 2020 6622 5c6e 4572 726f 723a 2041 5753    f"\nError: AWS
+0000ecb0: 2063 7265 6465 6e74 6961 6c73 2061 7265   credentials are
+0000ecc0: 206e 6f74 2076 616c 6964 2066 6f72 2070   not valid for p
+0000ecd0: 726f 6669 6c65 207b 7365 6c66 2e63 6667  rofile {self.cfg
+0000ece0: 2e61 7773 5f70 726f 6669 6c65 7d22 290a  .aws_profile}").
+0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed00: 7072 696e 7428 2272 756e 2027 6672 6f73  print("run 'fros
+0000ed10: 7465 7220 636f 6e66 6967 202d 2d61 7773  ter config --aws
+0000ed20: 2720 746f 2066 6978 2074 6869 732e 5c6e  ' to fix this.\n
+0000ed30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000ed40: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
+0000ed50: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+0000ed60: 7420 616c 6c20 7468 6520 6275 636b 6574  t all the bucket
+0000ed70: 730a 2020 2020 2020 2020 2020 2020 6578  s.            ex
+0000ed80: 6973 7469 6e67 5f62 7563 6b65 7473 203d  isting_buckets =
+0000ed90: 2073 656c 662e 7333 5f63 6c69 656e 742e   self.s3_client.
+0000eda0: 6c69 7374 5f62 7563 6b65 7473 2829 0a0a  list_buckets()..
+0000edb0: 2020 2020 2020 2020 2020 2020 2320 4578              # Ex
+0000edc0: 7472 6163 7420 7468 6520 6275 636b 6574  tract the bucket
+0000edd0: 206e 616d 6573 0a20 2020 2020 2020 2020   names.         
+0000ede0: 2020 2062 7563 6b65 745f 6c69 7374 203d     bucket_list =
+0000edf0: 205b 6275 636b 6574 5b27 4e61 6d65 275d   [bucket['Name']
+0000ee00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000ee20: 6275 636b 6574 2069 6e20 6578 6973 7469  bucket in existi
+0000ee30: 6e67 5f62 7563 6b65 7473 5b27 4275 636b  ng_buckets['Buck
+0000ee40: 6574 7327 5d5d 0a0a 2020 2020 2020 2020  ets']]..        
+0000ee50: 2020 2020 2320 4669 6c74 6572 2074 6865      # Filter the
+0000ee60: 2062 7563 6b65 7420 6e61 6d65 7320 616e   bucket names an
+0000ee70: 6420 7265 7472 6965 7665 206f 6e6c 7920  d retrieve only 
+0000ee80: 6672 6f73 7465 722d 2a20 6275 636b 6574  froster-* bucket
+0000ee90: 730a 2020 2020 2020 2020 2020 2020 6672  s.            fr
+0000eea0: 6f73 7465 725f 6275 636b 6574 5f6c 6973  oster_bucket_lis
+0000eeb0: 7420 3d20 5b0a 2020 2020 2020 2020 2020  t = [.          
+0000eec0: 2020 2020 2020 7820 666f 7220 7820 696e        x for x in
+0000eed0: 2062 7563 6b65 745f 6c69 7374 2069 6620   bucket_list if 
+0000eee0: 782e 7374 6172 7473 7769 7468 2827 6672  x.startswith('fr
+0000eef0: 6f73 7465 722d 2729 5d0a 0a20 2020 2020  oster-')]..     
+0000ef00: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+0000ef10: 7468 6520 6c69 7374 206f 6620 6672 6f73  the list of fros
+0000ef20: 7465 7220 6275 636b 6574 730a 2020 2020  ter buckets.    
+0000ef30: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0000ef40: 726f 7374 6572 5f62 7563 6b65 745f 6c69  roster_bucket_li
+0000ef50: 7374 0a0a 2020 2020 2020 2020 2320 544f  st..        # TO
+0000ef60: 444f 3a20 4578 7061 6e64 2065 7863 6570  DO: Expand excep
+0000ef70: 7469 6f6e 2068 616e 646c 696e 670a 2020  tion handling.  
+0000ef80: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000ef90: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0000efa0: 2020 2020 2020 2020 2070 7269 6e74 5f65           print_e
+0000efb0: 7272 6f72 2829 0a20 2020 2020 2020 2020  rror().         
+0000efc0: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
+0000efd0: 2020 2020 6465 6620 6765 745f 656e 6470      def get_endp
+0000efe0: 6f69 6e74 2873 656c 6629 3a0a 2020 2020  oint(self):.    
+0000eff0: 2020 2020 2727 2720 4765 7420 7468 6520      ''' Get the 
+0000f000: 656e 6470 6f69 6e74 2055 524c 206f 6620  endpoint URL of 
+0000f010: 7468 6520 6375 7272 656e 7420 7365 7373  the current sess
+0000f020: 696f 6e27 2727 0a20 2020 2020 2020 2074  ion'''.        t
+0000f030: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000f040: 2320 4368 6563 6b20 6966 2074 6865 2073  # Check if the s
+0000f050: 6573 7369 6f6e 2069 7320 7661 6c69 640a  ession is valid.
+0000f060: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000f070: 6f74 2073 656c 662e 5f63 6865 636b 5f73  ot self._check_s
+0000f080: 6573 7369 6f6e 2829 3a0a 2020 2020 2020  ession():.      
+0000f090: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f0b0: 2020 2020 2066 225c 6e45 7272 6f72 3a20       f"\nError: 
+0000f0c0: 4157 5320 6372 6564 656e 7469 616c 7320  AWS credentials 
+0000f0d0: 6172 6520 6e6f 7420 7661 6c69 6420 666f  are not valid fo
+0000f0e0: 7220 7072 6f66 696c 6520 7b73 656c 662e  r profile {self.
+0000f0f0: 6366 672e 6177 735f 7072 6f66 696c 657d  cfg.aws_profile}
+0000f100: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000f110: 2020 2070 7269 6e74 2822 7275 6e20 2766     print("run 'f
+0000f120: 726f 7374 6572 2063 6f6e 6669 6720 2d2d  roster config --
+0000f130: 6177 7327 2074 6f20 6669 7820 7468 6973  aws' to fix this
+0000f140: 2e5c 6e22 290a 2020 2020 2020 2020 2020  .\n").          
+0000f150: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+0000f160: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000f170: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
+0000f180: 2773 335f 636c 6965 6e74 2729 3a0a 2020  's3_client'):.  
+0000f190: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000f1a0: 7475 726e 2073 656c 662e 7333 5f63 6c69  turn self.s3_cli
+0000f1b0: 656e 742e 6d65 7461 2e65 6e64 706f 696e  ent.meta.endpoin
+0000f1c0: 745f 7572 6c0a 2020 2020 2020 2020 2020  t_url.          
+0000f1d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f1e0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000f1f0: 6f6e 650a 2020 2020 2020 2020 6578 6365  one.        exce
+0000f200: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0000f210: 7072 696e 745f 6572 726f 7228 290a 0a20  print_error().. 
+0000f220: 2020 2064 6566 2067 6574 5f68 6f73 746e     def get_hostn
+0000f230: 616d 6528 7365 6c66 293a 0a20 2020 2020  ame(self):.     
+0000f240: 2020 2027 2727 2047 6574 2074 6865 2068     ''' Get the h
+0000f250: 6f73 746e 616d 6520 6f66 2074 6865 2063  ostname of the c
+0000f260: 7572 7265 6e74 2073 6573 7369 6f6e 2727  urrent session''
+0000f270: 270a 0a20 2020 2020 2020 2074 7279 3a0a  '..        try:.
+0000f280: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0000f290: 6865 636b 2069 6620 7468 6520 7365 7373  heck if the sess
+0000f2a0: 696f 6e20 6973 2076 616c 6964 0a20 2020  ion is valid.   
+0000f2b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000f2c0: 7365 6c66 2e5f 6368 6563 6b5f 7365 7373  self._check_sess
+0000f2d0: 696f 6e28 293a 0a20 2020 2020 2020 2020  ion():.         
+0000f2e0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f300: 2020 6622 5c6e 4572 726f 723a 2041 5753    f"\nError: AWS
+0000f310: 2063 7265 6465 6e74 6961 6c73 2061 7265   credentials are
+0000f320: 206e 6f74 2076 616c 6964 2066 6f72 2070   not valid for p
+0000f330: 726f 6669 6c65 207b 7365 6c66 2e63 6667  rofile {self.cfg
+0000f340: 2e61 7773 5f70 726f 6669 6c65 7d22 290a  .aws_profile}").
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 7072 696e 7428 2272 756e 2027 6672 6f73  print("run 'fros
+0000f370: 7465 7220 636f 6e66 6967 202d 2d61 7773  ter config --aws
+0000f380: 2720 746f 2066 6978 2074 6869 732e 5c6e  ' to fix this.\n
+0000f390: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000f3a0: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
+0000f3b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0000f3c0: 6861 7361 7474 7228 7365 6c66 2c20 2773  hasattr(self, 's
+0000f3d0: 335f 636c 6965 6e74 2729 293a 0a20 2020  3_client')):.   
+0000f3e0: 2020 2020 2020 2020 2020 2020 2065 7020               ep 
+0000f3f0: 3d20 7365 6c66 2e73 335f 636c 6965 6e74  = self.s3_client
+0000f400: 2e6d 6574 612e 656e 6470 6f69 6e74 5f75  .meta.endpoint_u
+0000f410: 726c 0a20 2020 2020 2020 2020 2020 2020  rl.             
+0000f420: 2020 2072 6574 7572 6e20 7572 6c6c 6962     return urllib
+0000f430: 2e70 6172 7365 2e75 726c 7061 7273 6528  .parse.urlparse(
+0000f440: 6570 292e 686f 7374 6e61 6d65 0a20 2020  ep).hostname.   
+0000f450: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000f470: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+0000f480: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+0000f490: 2020 2020 2020 2070 7269 6e74 5f65 7272         print_err
+0000f4a0: 6f72 2829 0a0a 2020 2020 6465 6620 6765  or()..    def ge
+0000f4b0: 745f 7072 6f66 696c 6573 2873 656c 6629  t_profiles(self)
+0000f4c0: 3a0a 2020 2020 2020 2020 2727 2720 4765  :.        ''' Ge
+0000f4d0: 7420 6120 6c69 7374 206f 6620 6176 6169  t a list of avai
+0000f4e0: 6c61 626c 6520 4157 5320 7072 6f66 696c  lable AWS profil
+0000f4f0: 6573 2727 270a 2020 2020 2020 2020 7472  es'''.        tr
+0000f500: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+0000f510: 7265 7475 726e 2062 6f74 6f33 2e53 6573  return boto3.Ses
+0000f520: 7369 6f6e 2829 2e61 7661 696c 6162 6c65  sion().available
+0000f530: 5f70 726f 6669 6c65 730a 2020 2020 2020  _profiles.      
+0000f540: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0000f550: 2020 2020 2020 7072 696e 745f 6572 726f        print_erro
+0000f560: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0000f570: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+0000f580: 2064 6566 2067 6574 5f72 6567 696f 6e73   def get_regions
+0000f590: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000f5a0: 2727 2747 6574 2074 6865 2072 6567 696f  '''Get the regio
+0000f5b0: 6e73 2066 6f72 2074 6865 2063 7572 7265  ns for the curre
+0000f5c0: 6e74 2073 6573 7369 6f6e 206f 7220 6765  nt session or ge
+0000f5d0: 7420 6465 6661 756c 7420 7265 6769 6f6e  t default region
+0000f5e0: 732e 2727 270a 0a20 2020 2020 2020 2074  s.'''..        t
+0000f5f0: 7279 3a0a 0a20 2020 2020 2020 2020 2020  ry:..           
+0000f600: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
+0000f610: 7365 7373 696f 6e20 6973 2076 616c 6964  session is valid
+0000f620: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f630: 662e 5f63 6865 636b 5f73 6573 7369 6f6e  f._check_session
+0000f640: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0000f650: 7265 6769 6f6e 7320 3d20 7365 6c66 2e65  regions = self.e
+0000f660: 6332 5f63 6c69 656e 742e 6465 7363 7269  c2_client.descri
+0000f670: 6265 5f72 6567 696f 6e73 2829 0a20 2020  be_regions().   
+0000f680: 2020 2020 2020 2020 2072 6567 696f 6e5f           region_
+0000f690: 6e61 6d65 7320 3d20 5b72 6567 696f 6e5b  names = [region[
+0000f6a0: 2752 6567 696f 6e4e 616d 6527 5d0a 2020  'RegionName'].  
 0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6c0: 2020 2020 2020 2020 2027 2d2d 6578 636c           '--excl
-0000f6d0: 7564 6527 2c20 7365 6c66 2e61 6c6c 6669  ude', self.allfi
-0000f6e0: 6c65 735f 6373 765f 6669 6c65 6e61 6d65  les_csv_filename
-0000f6f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f710: 272d 2d65 7863 6c75 6465 272c 2073 656c  '--exclude', sel
-0000f720: 662e 7768 6572 655f 6469 645f 7468 655f  f.where_did_the_
-0000f730: 6669 6c65 735f 676f 5f66 696c 656e 616d  files_go_filenam
-0000f740: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f760: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000f770: 2043 6861 6e67 6520 7468 6520 7374 6f72   Change the stor
-0000f780: 6167 6520 636c 6173 7320 6261 636b 2074  age class back t
-0000f790: 6f20 7468 6520 7573 6572 2070 7265 6665  o the user prefe
-0000f7a0: 7265 6e63 650a 2020 2020 2020 2020 2020  rence.          
-0000f7b0: 2020 7263 6c6f 6e65 2e65 6e76 726e 5b27    rclone.envrn['
-0000f7c0: 5243 4c4f 4e45 5f53 335f 5354 4f52 4147  RCLONE_S3_STORAG
-0000f7d0: 455f 434c 4153 5327 5d20 3d20 7365 6c66  E_CLASS'] = self
-0000f7e0: 2e63 6667 2e73 746f 7261 6765 5f63 6c61  .cfg.storage_cla
-0000f7f0: 7373 0a0a 2020 2020 2020 2020 2020 2020  ss..            
-0000f800: 6966 2072 6574 3a0a 2020 2020 2020 2020  if ret:.        
-0000f810: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0000f820: 2020 2020 2020 202e 2e2e 646f 6e65 2729         ...done')
-0000f830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f840: 2069 735f 666f 6c64 6572 5f61 7263 6869   is_folder_archi
-0000f850: 7665 6420 3d20 5472 7565 0a20 2020 2020  ved = True.     
-0000f860: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f870: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000f880: 6e74 2827 2020 2020 2020 2020 2e2e 2e46  nt('        ...F
-0000f890: 4149 4c45 445c 6e27 290a 2020 2020 2020  AILED\n').      
-0000f8a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000f8b0: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000f8c0: 696e 7428 6627 5c6e 2020 2020 5665 7269  int(f'\n    Veri
-0000f8d0: 6679 696e 6720 6368 6563 6b73 756d 732e  fying checksums.
-0000f8e0: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
-0000f8f0: 2072 6574 203d 2072 636c 6f6e 652e 6368   ret = rclone.ch
-0000f900: 6563 6b73 756d 2868 6173 6866 696c 652c  ecksum(hashfile,
-0000f910: 2073 335f 6465 7374 2c20 272d 2d6d 6178   s3_dest, '--max
-0000f920: 2d64 6570 7468 272c 2027 3127 290a 0a20  -depth', '1').. 
-0000f930: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-0000f940: 636b 2069 6620 7468 6520 6368 6563 6b73  ck if the checks
-0000f950: 756d 7320 6172 6520 636f 7272 6563 740a  ums are correct.
-0000f960: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0000f970: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-0000f980: 2020 2020 7072 696e 7428 2720 2020 202e      print('    .
-0000f990: 2e2e 646f 6e65 2729 0a20 2020 2020 2020  ..done').       
-0000f9a0: 2020 2020 2020 2020 2069 735f 6368 6563           is_chec
-0000f9b0: 6b73 756d 5f63 6f72 7265 6374 203d 2054  ksum_correct = T
-0000f9c0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000f9d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000f9e0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-0000f9f0: 202e 2e2e 4641 494c 4544 5c6e 2729 0a20   ...FAILED\n'). 
-0000fa00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fa10: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
-0000fa20: 2020 2023 2041 6464 2074 6865 206d 6574     # Add the met
-0000fa30: 6164 6174 6120 746f 2074 6865 2061 7263  adata to the arc
-0000fa40: 6869 7665 204a 534f 4e20 6669 6c65 204f  hive JSON file O
-0000fa50: 4e4c 5920 6966 2074 6869 7320 6973 206e  NLY if this is n
-0000fa60: 6f74 2061 2073 7562 666f 6c64 6572 0a20  ot a subfolder. 
-0000fa70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000fa80: 7420 6973 5f73 7562 666f 6c64 6572 3a0a  t is_subfolder:.
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000faa0: 2320 4765 7420 6375 7272 656e 7420 7469  # Get current ti
-0000fab0: 6d65 7374 616d 700a 2020 2020 2020 2020  mestamp.        
-0000fac0: 2020 2020 2020 2020 7469 6d65 7374 616d          timestam
-0000fad0: 7020 3d20 6461 7465 7469 6d65 2e64 6174  p = datetime.dat
-0000fae0: 6574 696d 652e 6e6f 7728 292e 6973 6f66  etime.now().isof
-0000faf0: 6f72 6d61 7428 290a 0a20 2020 2020 2020  ormat()..       
-0000fb00: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
-0000fb10: 6865 2061 7263 6869 7665 206d 6f64 650a  he archive mode.
-0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb30: 6966 2069 735f 7265 6375 7273 6976 653a  if is_recursive:
-0000fb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb50: 2020 2020 2061 7263 6869 7665 5f6d 6f64       archive_mod
-0000fb60: 6520 3d20 2252 6563 7572 7369 7665 220a  e = "Recursive".
-0000fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000fb90: 2020 2020 2020 2020 2020 6172 6368 6976            archiv
-0000fba0: 655f 6d6f 6465 203d 2022 5369 6e67 6c65  e_mode = "Single
-0000fbb0: 220a 0a20 2020 2020 2020 2020 2020 2020  "..             
-0000fbc0: 2020 2023 2047 656e 6572 6174 6520 7468     # Generate th
-0000fbd0: 6520 6d65 7461 6461 7461 2064 6963 7469  e metadata dicti
-0000fbe0: 6f6e 6172 790a 2020 2020 2020 2020 2020  onary.          
-0000fbf0: 2020 2020 2020 6e65 775f 656e 7472 7920        new_entry 
-0000fc00: 3d20 7b27 6c6f 6361 6c5f 666f 6c64 6572  = {'local_folder
-0000fc10: 273a 2066 6f6c 6465 725f 746f 5f61 7263  ': folder_to_arc
-0000fc20: 6869 7665 2c0a 2020 2020 2020 2020 2020  hive,.          
-0000fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc40: 2020 2027 6172 6368 6976 655f 666f 6c64     'archive_fold
-0000fc50: 6572 273a 2073 335f 6465 7374 2c0a 2020  er': s3_dest,.  
-0000fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc70: 2020 2020 2020 2020 2020 2027 7333 5f73             's3_s
-0000fc80: 746f 7261 6765 5f63 6c61 7373 273a 2073  torage_class': s
-0000fc90: 656c 662e 6366 672e 7374 6f72 6167 655f  elf.cfg.storage_
-0000fca0: 636c 6173 732c 0a20 2020 2020 2020 2020  class,.         
-0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcc0: 2020 2020 2770 726f 6669 6c65 273a 2073      'profile': s
-0000fcd0: 656c 662e 6366 672e 6177 735f 7072 6f66  elf.cfg.aws_prof
-0000fce0: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd00: 2020 2761 7263 6869 7665 5f6d 6f64 6527    'archive_mode'
-0000fd10: 3a20 6172 6368 6976 655f 6d6f 6465 2c0a  : archive_mode,.
-0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd30: 2020 2020 2020 2020 2020 2020 2027 7469               'ti
-0000fd40: 6d65 7374 616d 7027 3a20 7469 6d65 7374  mestamp': timest
-0000fd50: 616d 702c 0a20 2020 2020 2020 2020 2020  amp,.           
-0000fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd70: 2020 2774 696d 6573 7461 6d70 5f61 7263    'timestamp_arc
-0000fd80: 6869 7665 273a 2074 696d 6573 7461 6d70  hive': timestamp
-0000fd90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fda0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000fdb0: 7573 6572 273a 2067 6574 7061 7373 2e67  user': getpass.g
-0000fdc0: 6574 7573 6572 2829 0a20 2020 2020 2020  etuser().       
-0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fde0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0000fdf0: 2020 2020 2020 2020 2023 2041 6464 204e           # Add N
-0000fe00: 4948 2069 6e66 6f72 6d61 7469 6f6e 2074  IH information t
-0000fe10: 6f20 7468 6520 6d65 7461 6461 7461 2064  o the metadata d
-0000fe20: 6963 7469 6f6e 6172 790a 2020 2020 2020  ictionary.      
-0000fe30: 2020 2020 2020 2020 2020 6966 206e 6968            if nih
-0000fe40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fe50: 2020 2020 2020 6e65 775f 656e 7472 795b        new_entry[
-0000fe60: 276e 6968 5f70 726f 6a65 6374 275d 203d  'nih_project'] =
-0000fe70: 206e 6968 5b30 5d0a 2020 2020 2020 2020   nih[0].        
-0000fe80: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000fe90: 656e 7472 795b 276e 6968 5f70 726f 6a65  entry['nih_proje
-0000fea0: 6374 5f75 726c 275d 203d 206e 6968 5b36  ct_url'] = nih[6
-0000feb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000fec0: 2020 2020 2020 6e65 775f 656e 7472 795b        new_entry[
-0000fed0: 276e 6968 5f70 726f 6a65 6374 5f70 6927  'nih_project_pi'
-0000fee0: 5d20 3d20 6e69 685b 335d 0a0a 2020 2020  ] = nih[3]..    
-0000fef0: 2020 2020 2020 2020 2020 2020 2320 5772              # Wr
-0000ff00: 6974 6520 7468 6520 6d65 7461 6461 7461  ite the metadata
-0000ff10: 2074 6f20 7468 6520 6172 6368 6976 6520   to the archive 
-0000ff20: 4a53 4f4e 2066 696c 650a 2020 2020 2020  JSON file.      
-0000ff30: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000ff40: 6172 6368 6976 655f 6a73 6f6e 5f61 6464  archive_json_add
-0000ff50: 5f65 6e74 7279 286b 6579 3d66 6f6c 6465  _entry(key=folde
-0000ff60: 725f 746f 5f61 7263 6869 7665 2e72 7374  r_to_archive.rst
-0000ff70: 7269 7028 6f73 2e70 6174 682e 7365 7029  rip(os.path.sep)
-0000ff80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffa0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000ffb0: 616c 7565 3d6e 6577 5f65 6e74 7279 290a  alue=new_entry).
-0000ffc0: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-0000ffd0: 7269 6e74 2074 6865 2066 696e 616c 206d  rint the final m
-0000ffe0: 6573 7361 6765 0a20 2020 2020 2020 2020  essage.         
-0000fff0: 2020 2070 7269 6e74 2866 275c 6e41 5243     print(f'\nARC
-00010000: 4849 5649 4e47 2053 5543 4345 5353 4655  HIVING SUCCESSFU
-00010010: 4c4c 5920 434f 4d50 4c45 5445 445c 6e27  LLY COMPLETED\n'
-00010020: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00010030: 696e 7428 6627 5c6e 2020 2020 4c4f 4341  int(f'\n    LOCA
-00010040: 4c20 534f 5552 4345 3a20 2020 2020 2020  L SOURCE:       
-00010050: 227b 666f 6c64 6572 5f74 6f5f 6172 6368  "{folder_to_arch
-00010060: 6976 657d 2227 290a 2020 2020 2020 2020  ive}"').        
-00010070: 2020 2020 7072 696e 7428 6627 2020 2020      print(f'    
-00010080: 4157 5320 5333 2044 4553 5449 4e41 5449  AWS S3 DESTINATI
-00010090: 4f4e 3a20 227b 7333 5f64 6573 747d 225c  ON: "{s3_dest}"\
-000100a0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-000100b0: 7072 696e 7428 6627 2020 2020 416c 6c20  print(f'    All 
-000100c0: 6669 6c65 7320 7765 7265 2063 6f72 7265  files were corre
-000100d0: 6374 6c79 2075 706c 6f61 6465 6420 746f  ctly uploaded to
-000100e0: 2041 5753 2053 3320 6275 636b 6574 2061   AWS S3 bucket a
-000100f0: 6e64 2064 6f75 626c 652d 6368 6563 6b65  nd double-checke
-00010100: 6420 7769 7468 206d 6435 7375 6d20 6368  d with md5sum ch
-00010110: 6563 6b73 756d 2e5c 6e27 290a 0a20 2020  ecksum.\n')..   
-00010120: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00010130: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00010140: 2020 2070 7269 6e74 5f65 7272 6f72 2829     print_error()
-00010150: 0a0a 2020 2020 6465 6620 6172 6368 6976  ..    def archiv
-00010160: 6528 7365 6c66 2c20 666f 6c64 6572 7329  e(self, folders)
-00010170: 3a0a 2020 2020 2020 2020 2727 2741 7263  :.        '''Arc
-00010180: 6869 7665 2074 6865 2067 6976 656e 2066  hive the given f
-00010190: 6f6c 6465 7273 2727 270a 0a20 2020 2020  olders'''..     
-000101a0: 2020 2023 2043 6c65 616e 2074 6865 2070     # Clean the p
-000101b0: 726f 7669 6465 6420 7061 7468 730a 2020  rovided paths.  
-000101c0: 2020 2020 2020 666f 6c64 6572 7320 3d20        folders = 
-000101d0: 636c 6561 6e5f 7061 7468 7328 666f 6c64  clean_paths(fold
-000101e0: 6572 7329 0a0a 2020 2020 2020 2020 2320  ers)..        # 
-000101f0: 5365 7420 666c 6167 730a 2020 2020 2020  Set flags.      
-00010200: 2020 6973 5f72 6563 7572 7369 7665 203d    is_recursive =
-00010210: 2073 656c 662e 6172 6773 2e72 6563 7572   self.args.recur
-00010220: 7369 7665 0a20 2020 2020 2020 2069 735f  sive.        is_
-00010230: 6e69 6820 3d20 7365 6c66 2e63 6667 2e69  nih = self.cfg.i
-00010240: 735f 6e69 6820 6f72 2073 656c 662e 6172  s_nih or self.ar
-00010250: 6773 2e6e 6968 0a20 2020 2020 2020 2069  gs.nih.        i
-00010260: 735f 736c 7572 6d20 3d20 7368 7574 696c  s_slurm = shutil
-00010270: 2e77 6869 6368 280a 2020 2020 2020 2020  .which(.        
-00010280: 2020 2020 2773 6261 7463 6827 2920 616e      'sbatch') an
-00010290: 6420 6e6f 7420 7365 6c66 2e61 7267 732e  d not self.args.
-000102a0: 6e6f 736c 7572 6d20 616e 6420 6e6f 7420  noslurm and not 
-000102b0: 6f73 2e67 6574 656e 7628 2753 4c55 524d  os.getenv('SLURM
-000102c0: 5f4a 4f42 5f49 4427 290a 2020 2020 2020  _JOB_ID').      
-000102d0: 2020 6973 5f74 6172 203d 206e 6f74 2073    is_tar = not s
-000102e0: 656c 662e 6172 6773 2e6e 6f74 6172 0a20  elf.args.notar. 
-000102f0: 2020 2020 2020 2069 735f 666f 7263 6520         is_force 
-00010300: 3d20 7365 6c66 2e61 7267 732e 666f 7263  = self.args.forc
-00010310: 650a 0a20 2020 2020 2020 2023 2043 6865  e..        # Che
-00010320: 636b 2069 6620 7468 6572 6520 6973 2061  ck if there is a
-00010330: 2063 6f6e 666c 6963 7420 6265 7477 6565   conflict betwee
-00010340: 6e20 666f 6c64 6572 7320 616e 6420 7265  n folders and re
-00010350: 6375 7273 6976 6520 666c 6167 2c0a 2020  cursive flag,.  
-00010360: 2020 2020 2020 2320 692e 652e 2072 6563        # i.e. rec
-00010370: 7572 7369 7665 2066 6c61 6720 6973 2073  ursive flag is s
-00010380: 6574 2061 6e64 2061 2066 6f6c 6465 7220  et and a folder 
-00010390: 6973 2061 2073 7562 6469 7265 6374 6f72  is a subdirector
-000103a0: 7920 6f66 2061 6e6f 7468 6572 206f 6e65  y of another one
-000103b0: 0a20 2020 2020 2020 2069 6620 6973 5f72  .        if is_r
-000103c0: 6563 7572 7369 7665 3a0a 2020 2020 2020  ecursive:.      
-000103d0: 2020 2020 2020 6966 2073 656c 662e 5f69        if self._i
-000103e0: 735f 7265 6375 7273 6976 655f 636f 6c6c  s_recursive_coll
-000103f0: 6973 696f 6e28 666f 6c64 6572 7329 3a0a  ision(folders):.
-00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010410: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00010420: 2020 2020 2020 2020 2020 2066 275c 6e45             f'\nE
-00010430: 7272 6f72 3a20 596f 7520 6361 6e6e 6f74  rror: You cannot
-00010440: 2061 7263 6869 7665 2066 6f6c 6465 7273   archive folders
-00010450: 2072 6563 7572 7369 7665 6c79 2069 6620   recursively if 
-00010460: 7468 6572 6520 6973 2061 2064 6570 656e  there is a depen
-00010470: 6465 6e63 7920 6265 7477 6565 6e20 7468  dency between th
-00010480: 656d 2e5c 6e27 290a 2020 2020 2020 2020  em.\n').        
-00010490: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-000104a0: 2831 290a 0a20 2020 2020 2020 2023 2043  (1)..        # C
-000104b0: 6865 636b 2069 6620 7765 2063 616e 2072  heck if we can r
-000104c0: 6561 6420 2620 7772 6974 6520 616c 6c20  ead & write all 
-000104d0: 6669 6c65 7320 616e 6420 666f 6c64 6572  files and folder
-000104e0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-000104f0: 2073 656c 662e 5f69 735f 636f 7272 6563   self._is_correc
-00010500: 745f 6669 6c65 735f 666f 6c64 6572 735f  t_files_folders_
-00010510: 7065 726d 6973 7369 6f6e 7328 666f 6c64  permissions(fold
-00010520: 6572 732c 2069 735f 7265 6375 7273 6976  ers, is_recursiv
-00010530: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00010540: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00010550: 2020 2020 2020 2027 5c6e 4572 726f 723a         '\nError:
-00010560: 2043 616e 6e6f 7420 7265 6164 206f 7220   Cannot read or 
-00010570: 7772 6974 6520 746f 2061 6c6c 2066 696c  write to all fil
-00010580: 6573 2061 6e64 2066 6f6c 6465 7273 2e5c  es and folders.\
-00010590: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
-000105a0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-000105b0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-000105c0: 2020 2020 2020 2020 6627 596f 7520 6361          f'You ca
-000105d0: 6e20 6368 6563 6b20 7468 6520 7065 726d  n check the perm
-000105e0: 6973 7369 6f6e 7320 6f66 2074 6865 2066  issions of the f
-000105f0: 696c 6573 2061 6e64 2066 6f6c 6465 7273  iles and folders
-00010600: 2075 7369 6e67 2074 6865 2063 6f6d 6d61   using the comma
-00010610: 6e64 3a27 2c20 6669 6c65 3d73 7973 2e73  nd:', file=sys.s
-00010620: 7464 6572 7229 0a20 2020 2020 2020 2020  tderr).         
-00010630: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00010640: 2020 2020 2020 2020 2020 6627 2020 2020            f'    
-00010650: 6672 6f73 7465 7220 6172 6368 6976 6520  froster archive 
-00010660: 2d2d 7065 726d 6973 7369 6f6e 7320 222f  --permissions "/
-00010670: 796f 7572 2f66 6f6c 6465 722f 746f 2f61  your/folder/to/a
-00010680: 7263 6869 7665 225c 6e27 2c20 6669 6c65  rchive"\n', file
-00010690: 3d73 7973 2e73 7464 6572 7229 0a20 2020  =sys.stderr).   
-000106a0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-000106b0: 7428 3129 0a0a 2020 2020 2020 2020 6e69  t(1)..        ni
-000106c0: 6820 3d20 2727 0a0a 2020 2020 2020 2020  h = ''..        
-000106d0: 6966 2069 735f 6e69 683a 0a20 2020 2020  if is_nih:.     
-000106e0: 2020 2020 2020 2061 7070 203d 2054 6162         app = Tab
-000106f0: 6c65 4e49 4847 7261 6e74 7328 290a 2020  leNIHGrants().  
-00010700: 2020 2020 2020 2020 2020 6e69 6820 3d20            nih = 
-00010710: 6170 702e 7275 6e28 290a 0a20 2020 2020  app.run()..     
-00010720: 2020 2069 6620 6973 5f73 6c75 726d 3a0a     if is_slurm:.
-00010730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010740: 2e5f 6172 6368 6976 655f 736c 7572 6d28  ._archive_slurm(
-00010750: 666f 6c64 6572 732c 2069 735f 7265 6375  folders, is_recu
-00010760: 7273 6976 652c 206e 6968 290a 2020 2020  rsive, nih).    
-00010770: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00010780: 2020 2020 2020 666f 7220 666f 6c64 6572        for folder
-00010790: 2069 6e20 666f 6c64 6572 733a 0a20 2020   in folders:.   
-000107a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000107b0: 6973 5f72 6563 7572 7369 7665 3a0a 2020  is_recursive:.  
-000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107d0: 2020 666f 7220 726f 6f74 2c20 6469 7273    for root, dirs
-000107e0: 2c20 6669 6c65 7320 696e 2073 656c 662e  , files in self.
-000107f0: 5f77 616c 6b65 7228 666f 6c64 6572 293a  _walker(folder):
-00010800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010810: 2020 2020 2020 2020 2069 6620 666f 6c64           if fold
-00010820: 6572 203d 3d20 726f 6f74 3a0a 2020 2020  er == root:.    
-00010830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010840: 2020 2020 2020 2020 6973 5f73 7562 666f          is_subfo
-00010850: 6c64 6572 203d 2046 616c 7365 0a20 2020  lder = False.   
-00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010870: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010890: 2020 2020 2020 2069 735f 7375 6266 6f6c         is_subfol
-000108a0: 6465 7220 3d20 5472 7565 0a0a 2020 2020  der = True..    
-000108b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108c0: 2020 2020 7365 6c66 2e61 7263 6869 7665      self.archive
-000108d0: 5f6c 6f63 616c 6c79 280a 2020 2020 2020  _locally(.      
-000108e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108f0: 2020 2020 2020 726f 6f74 2c20 6973 5f72        root, is_r
-00010900: 6563 7572 7369 7665 2c20 6e69 682c 2069  ecursive, nih, i
-00010910: 735f 7375 6266 6f6c 6465 722c 2069 735f  s_subfolder, is_
-00010920: 7461 722c 2069 735f 666f 7263 6529 0a0a  tar, is_force)..
-00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010950: 2020 2020 2020 2020 2020 6973 5f73 7562            is_sub
-00010960: 666f 6c64 6572 203d 2046 616c 7365 0a20  folder = False. 
-00010970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010980: 2020 2073 656c 662e 6172 6368 6976 655f     self.archive_
-00010990: 6c6f 6361 6c6c 7928 0a20 2020 2020 2020  locally(.       
-000109a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109b0: 2066 6f6c 6465 722c 2069 735f 7265 6375   folder, is_recu
-000109c0: 7273 6976 652c 206e 6968 2c20 6973 5f73  rsive, nih, is_s
-000109d0: 7562 666f 6c64 6572 2c20 6973 5f74 6172  ubfolder, is_tar
-000109e0: 2c20 6973 5f66 6f72 6365 290a 0a20 2020  , is_force)..   
-000109f0: 2064 6566 2067 6574 5f68 6f74 7370 6f74   def get_hotspot
-00010a00: 5f66 6f6c 6465 7273 2873 656c 662c 2068  _folders(self, h
-00010a10: 6f74 7370 6f74 5f66 696c 6529 3a0a 0a20  otspot_file):.. 
-00010a20: 2020 2020 2020 2061 6765 666c 6420 3d20         agefld = 
-00010a30: 2741 6363 4427 0a0a 2020 2020 2020 2020  'AccD'..        
-00010a40: 6966 2073 656c 662e 6172 6773 2e61 6765  if self.args.age
-00010a50: 6d74 696d 653a 0a20 2020 2020 2020 2020  mtime:.         
-00010a60: 2020 2061 6765 666c 6420 3d20 274d 6f64     agefld = 'Mod
-00010a70: 4427 0a0a 2020 2020 2020 2020 2320 496e  D'..        # In
-00010a80: 6974 6961 6c69 7a65 2061 2063 6f6e 6e65  itialize a conne
-00010a90: 6374 696f 6e20 746f 2061 6e20 696e 2d6d  ction to an in-m
-00010aa0: 656d 6f72 7920 6461 7461 6261 7365 0a20  emory database. 
-00010ab0: 2020 2020 2020 2064 7563 6b64 625f 636f         duckdb_co
-00010ac0: 6e6e 6563 7469 6f6e 203d 2064 7563 6b64  nnection = duckd
-00010ad0: 622e 636f 6e6e 6563 7428 0a20 2020 2020  b.connect(.     
-00010ae0: 2020 2020 2020 2064 6174 6162 6173 653d         database=
-00010af0: 273a 6d65 6d6f 7279 3a27 2c20 7265 6164  ':memory:', read
-00010b00: 5f6f 6e6c 793d 4661 6c73 6529 0a0a 2020  _only=False)..  
-00010b10: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
-00010b20: 6e75 6d62 6572 206f 6620 7468 7265 6164  number of thread
-00010b30: 7320 746f 2075 7365 0a20 2020 2020 2020  s to use.       
-00010b40: 2064 7563 6b64 625f 636f 6e6e 6563 7469   duckdb_connecti
-00010b50: 6f6e 2e65 7865 6375 7465 2866 2750 5241  on.execute(f'PRA
-00010b60: 474d 4120 7468 7265 6164 733d 7b73 656c  GMA threads={sel
-00010b70: 662e 6172 6773 2e63 6f72 6573 7d3b 2729  f.args.cores};')
-00010b80: 0a0a 2020 2020 2020 2020 2320 5265 6769  ..        # Regi
-00010b90: 7374 6572 2043 5356 2066 696c 6520 6173  ster CSV file as
-00010ba0: 2061 2076 6972 7475 616c 2074 6162 6c65   a virtual table
-00010bb0: 0a20 2020 2020 2020 2064 7563 6b64 625f  .        duckdb_
-00010bc0: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
-00010bd0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-00010be0: 6622 4352 4541 5445 2054 4142 4c45 2068  f"CREATE TABLE h
-00010bf0: 7320 4153 2053 454c 4543 5420 2a20 4652  s AS SELECT * FR
-00010c00: 4f4d 2072 6561 645f 6373 765f 6175 746f  OM read_csv_auto
-00010c10: 2827 7b68 6f74 7370 6f74 5f66 696c 657d  ('{hotspot_file}
-00010c20: 2729 2229 0a0a 2020 2020 2020 2020 2320  ')")..        # 
-00010c30: 5275 6e20 5351 4c20 7175 6572 6965 7320  Run SQL queries 
-00010c40: 6f6e 2074 6869 7320 7669 7274 7561 6c20  on this virtual 
-00010c50: 7461 626c 650a 2020 2020 2020 2020 2320  table.        # 
-00010c60: 4669 6c74 6572 2062 7920 6769 7665 6e20  Filter by given 
-00010c70: 6167 6520 616e 6420 7369 7a65 2e20 5468  age and size. Th
-00010c80: 6520 6465 6661 756c 7420 7661 6c75 6520  e default value 
-00010c90: 666f 7220 616c 6c20 6973 2030 0a20 2020  for all is 0.   
-00010ca0: 2020 2020 2069 6620 7365 6c66 2e61 7267       if self.arg
-00010cb0: 732e 6f6c 6465 7220 3e20 303a 0a20 2020  s.older > 0:.   
-00010cc0: 2020 2020 2020 2020 2072 6f77 7320 3d20           rows = 
-00010cd0: 6475 636b 6462 5f63 6f6e 6e65 6374 696f  duckdb_connectio
-00010ce0: 6e2e 6578 6563 7574 6528 0a20 2020 2020  n.execute(.     
-00010cf0: 2020 2020 2020 2020 2020 2066 2253 454c             f"SEL
-00010d00: 4543 5420 2a20 4652 4f4d 2068 7320 5748  ECT * FROM hs WH
-00010d10: 4552 4520 7b61 6765 666c 647d 203e 3d20  ERE {agefld} >= 
-00010d20: 7b73 656c 662e 6172 6773 2e6f 6c64 6572  {self.args.older
-00010d30: 7d20 616e 6420 4769 4220 3e3d 207b 7365  } and GiB >= {se
-00010d40: 6c66 2e61 7267 732e 6c61 7267 6572 7d20  lf.args.larger} 
-00010d50: 2229 2e66 6574 6368 616c 6c28 290a 0a20  ").fetchall().. 
-00010d60: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00010d70: 2e61 7267 732e 6e65 7765 7220 3e20 303a  .args.newer > 0:
-00010d80: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-00010d90: 7320 3d20 6475 636b 6462 5f63 6f6e 6e65  s = duckdb_conne
-00010da0: 6374 696f 6e2e 6578 6563 7574 6528 0a20  ction.execute(. 
-00010db0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010dc0: 2253 454c 4543 5420 2a20 4652 4f4d 2068  "SELECT * FROM h
-00010dd0: 7320 5748 4552 4520 7b61 6765 666c 647d  s WHERE {agefld}
-00010de0: 203c 3d20 7b73 656c 662e 6172 6773 2e6e   <= {self.args.n
-00010df0: 6577 6572 7d20 616e 6420 4769 4220 3e3d  ewer} and GiB >=
-00010e00: 207b 7365 6c66 2e61 7267 732e 6c61 7267   {self.args.larg
-00010e10: 6572 7d20 2229 2e66 6574 6368 616c 6c28  er} ").fetchall(
-00010e20: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00010e30: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-00010e40: 7320 3d20 6475 636b 6462 5f63 6f6e 6e65  s = duckdb_conne
-00010e50: 6374 696f 6e2e 6578 6563 7574 6528 0a20  ction.execute(. 
-00010e60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010e70: 2253 454c 4543 5420 2a20 4652 4f4d 2068  "SELECT * FROM h
-00010e80: 7320 5748 4552 4520 4769 4220 3e3d 207b  s WHERE GiB >= {
-00010e90: 7365 6c66 2e61 7267 732e 6c61 7267 6572  self.args.larger
-00010ea0: 7d20 2229 2e66 6574 6368 616c 6c28 290a  } ").fetchall().
-00010eb0: 0a20 2020 2020 2020 2023 2043 6c6f 7365  .        # Close
-00010ec0: 2074 6865 2044 7563 6b44 4220 636f 6e6e   the DuckDB conn
-00010ed0: 6563 7469 6f6e 0a20 2020 2020 2020 2064  ection.        d
-00010ee0: 7563 6b64 625f 636f 6e6e 6563 7469 6f6e  uckdb_connection
-00010ef0: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
-00010f00: 2020 666f 6c64 6572 735f 746f 5f61 7263    folders_to_arc
-00010f10: 6869 7665 203d 205b 2869 7465 6d5b 355d  hive = [(item[5]
-00010f20: 2c20 6974 656d 5b33 5d29 0a20 2020 2020  , item[3]).     
-00010f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f40: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
-00010f50: 6d20 696e 2072 6f77 735d 2020 2320 496e  m in rows]  # In
-00010f60: 636c 7564 6520 7369 7a65 2069 6e20 7468  clude size in th
-00010f70: 6520 7475 706c 650a 0a20 2020 2020 2020  e tuple..       
-00010f80: 2070 7269 6e74 2866 2748 6f74 7370 6f74   print(f'Hotspot
-00010f90: 7320 6669 6c65 3a20 7b68 6f74 7370 6f74  s file: {hotspot
-00010fa0: 5f66 696c 657d 2729 0a20 2020 2020 2020  _file}').       
-00010fb0: 2070 7269 6e74 2866 275c 6e46 6f6c 6465   print(f'\nFolde
-00010fc0: 7273 2074 6f20 6172 6368 6976 653a 5c6e  rs to archive:\n
-00010fd0: 2729 0a20 2020 2020 2020 2066 6f72 2066  ').        for f
-00010fe0: 6f6c 6465 722c 2073 697a 6520 696e 2066  older, size in f
-00010ff0: 6f6c 6465 7273 5f74 6f5f 6172 6368 6976  olders_to_archiv
-00011000: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00011010: 7269 6e74 2866 2720 207b 666f 6c64 6572  rint(f'  {folder
-00011020: 7d20 2d20 5369 7a65 3a20 7b73 697a 657d  } - Size: {size}
-00011030: 2047 6942 2729 0a0a 2020 2020 2020 2020   GiB')..        
-00011040: 746f 7461 6c73 7061 6365 203d 2073 756d  totalspace = sum
-00011050: 2869 7465 6d5b 335d 2066 6f72 2069 7465  (item[3] for ite
-00011060: 6d20 696e 2072 6f77 7329 0a20 2020 2020  m in rows).     
-00011070: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00011080: 2020 2020 2020 6627 5c6e 546f 7461 6c20        f'\nTotal 
-00011090: 7370 6163 6520 746f 2061 7263 6869 7665  space to archive
-000110a0: 3a20 7b66 6f72 6d61 7428 726f 756e 6428  : {format(round(
-000110b0: 746f 7461 6c73 7061 6365 2c20 3329 2c22  totalspace, 3),"
-000110c0: 2c22 297d 2047 6942 5c6e 2729 0a0a 2020  ,")} GiB\n')..  
-000110d0: 2020 2020 2020 2320 5265 7475 726e 206f        # Return o
-000110e0: 6e6c 7920 7468 6520 666f 6c64 6572 730a  nly the folders.
-000110f0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00011100: 666f 6c64 6572 2066 6f72 2066 6f6c 6465  folder for folde
-00011110: 722c 2073 697a 6520 696e 2066 6f6c 6465  r, size in folde
-00011120: 7273 5f74 6f5f 6172 6368 6976 655d 0a0a  rs_to_archive]..
-00011130: 2020 2020 6465 6620 5f63 6865 636b 5f70      def _check_p
-00011140: 6174 685f 7065 726d 6973 7369 6f6e 7328  ath_permissions(
-00011150: 7365 6c66 2c20 7061 7468 293a 0a20 2020  self, path):.   
-00011160: 2020 2020 2027 2727 4368 6563 6b20 6966       '''Check if
-00011170: 2074 6865 2075 7365 7220 6861 7320 7265   the user has re
-00011180: 6164 2061 6e64 2077 7269 7465 2070 6572  ad and write per
-00011190: 6d69 7373 696f 6e73 2074 6f20 7468 6520  missions to the 
-000111a0: 6769 7665 6e20 7061 7468 2727 270a 0a20  given path'''.. 
-000111b0: 2020 2020 2020 2023 2049 6620 7061 7468         # If path
-000111c0: 2069 7320 656d 7074 792c 2072 6574 7572   is empty, retur
-000111d0: 6e20 5472 7565 0a20 2020 2020 2020 2069  n True.        i
-000111e0: 6620 6e6f 7420 7061 7468 3a0a 2020 2020  f not path:.    
-000111f0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00011200: 7275 650a 0a20 2020 2020 2020 2023 2047  rue..        # G
-00011210: 6574 2070 6174 6820 7065 726d 6973 7369  et path permissi
-00011220: 6f6e 730a 2020 2020 2020 2020 6361 6e5f  ons.        can_
-00011230: 7265 6164 203d 206f 732e 6163 6365 7373  read = os.access
-00011240: 2870 6174 682c 206f 732e 525f 4f4b 290a  (path, os.R_OK).
-00011250: 2020 2020 2020 2020 6361 6e5f 7772 6974          can_writ
-00011260: 6520 3d20 6f73 2e61 6363 6573 7328 7061  e = os.access(pa
-00011270: 7468 2c20 6f73 2e57 5f4f 4b29 0a0a 2020  th, os.W_OK)..  
-00011280: 2020 2020 2020 2320 5072 696e 7420 6572        # Print er
-00011290: 726f 7220 6d65 7373 6167 6573 2069 6620  ror messages if 
-000112a0: 7468 6520 7573 6572 2064 6f65 7320 6e6f  the user does no
-000112b0: 7420 6861 7665 2072 6561 6420 6f72 2077  t have read or w
-000112c0: 7269 7465 2070 6572 6d69 7373 696f 6e73  rite permissions
-000112d0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000112e0: 6361 6e5f 7265 6164 3a0a 2020 2020 2020  can_read:.      
-000112f0: 2020 2020 2020 7072 696e 7428 6622 4361        print(f"Ca
-00011300: 6e6e 6f74 2072 6561 643a 207b 7061 7468  nnot read: {path
-00011310: 7d22 2c20 6669 6c65 3d73 7973 2e73 7464  }", file=sys.std
-00011320: 6572 7229 0a20 2020 2020 2020 2069 6620  err).        if 
-00011330: 6e6f 7420 6361 6e5f 7772 6974 653a 0a20  not can_write:. 
-00011340: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00011350: 2866 2243 616e 6e6f 7420 7772 6974 653a  (f"Cannot write:
-00011360: 207b 7061 7468 7d22 2c20 6669 6c65 3d73   {path}", file=s
-00011370: 7973 2e73 7464 6572 7229 0a0a 2020 2020  ys.stderr)..    
-00011380: 2020 2020 2320 5265 7475 726e 2054 7275      # Return Tru
-00011390: 6520 6966 2074 6865 2075 7365 7220 6861  e if the user ha
-000113a0: 7320 7265 6164 2061 6e64 2077 7269 7465  s read and write
-000113b0: 2070 6572 6d69 7373 696f 6e73 2c20 6f74   permissions, ot
-000113c0: 6865 7277 6973 6520 7265 7475 726e 2046  herwise return F
-000113d0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-000113e0: 7572 6e20 6361 6e5f 7265 6164 2061 6e64  urn can_read and
-000113f0: 2063 616e 5f77 7269 7465 0a0a 2020 2020   can_write..    
-00011400: 6465 6620 5f69 735f 636f 7272 6563 745f  def _is_correct_
-00011410: 6669 6c65 735f 666f 6c64 6572 735f 7065  files_folders_pe
-00011420: 726d 6973 7369 6f6e 7328 7365 6c66 2c20  rmissions(self, 
-00011430: 666f 6c64 6572 732c 2069 735f 7265 6375  folders, is_recu
-00011440: 7273 6976 653d 4661 6c73 6529 3a0a 2020  rsive=False):.  
-00011450: 2020 2020 2020 2727 2743 6865 636b 2069        '''Check i
-00011460: 6620 7468 6520 7573 6572 2068 6173 2072  f the user has r
-00011470: 6561 6420 616e 6420 7772 6974 6520 7065  ead and write pe
-00011480: 726d 6973 7369 6f6e 7320 746f 2074 6865  rmissions to the
-00011490: 2067 6976 656e 2066 6f6c 6465 7273 2727   given folders''
-000114a0: 270a 0a20 2020 2020 2020 2063 6f72 7265  '..        corre
-000114b0: 6374 5f70 6572 6d69 7373 696f 6e73 203d  ct_permissions =
-000114c0: 2054 7275 650a 0a20 2020 2020 2020 2074   True..        t
-000114d0: 7279 3a0a 0a20 2020 2020 2020 2020 2020  ry:..           
-000114e0: 2066 6f72 2066 6f6c 6465 7220 696e 2066   for folder in f
-000114f0: 6f6c 6465 7273 3a0a 0a20 2020 2020 2020  olders:..       
-00011500: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011510: 6f73 2e70 6174 682e 6973 6469 7228 666f  os.path.isdir(fo
-00011520: 6c64 6572 293a 0a20 2020 2020 2020 2020  lder):.         
-00011530: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00011540: 2866 2245 7272 6f72 3a20 7b66 6f6c 6465  (f"Error: {folde
-00011550: 727d 2069 7320 6e6f 7420 6120 6469 7265  r} is not a dire
-00011560: 6374 6f72 792e 222c 0a20 2020 2020 2020  ctory.",.       
-00011570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011580: 2020 2066 696c 653d 7379 732e 7374 6465     file=sys.stde
-00011590: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
-000115a0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-000115b0: 2831 290a 0a20 2020 2020 2020 2020 2020  (1)..           
-000115c0: 2020 2020 2069 6620 6973 5f72 6563 7572       if is_recur
-000115d0: 7369 7665 3a0a 0a20 2020 2020 2020 2020  sive:..         
-000115e0: 2020 2020 2020 2020 2020 2023 2052 6563             # Rec
-000115f0: 7572 7369 7665 2066 6c61 6720 7365 742c  ursive flag set,
-00011600: 2075 7369 6e67 206f 732e 7761 6c6b 2074   using os.walk t
-00011610: 6f20 6765 7420 616c 6c20 6669 6c65 7320  o get all files 
-00011620: 616e 6420 666f 6c64 6572 730a 0a20 2020  and folders..   
-00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011640: 2066 6f72 2072 6f6f 742c 2064 6972 732c   for root, dirs,
-00011650: 2066 696c 6573 2069 6e20 6f73 2e77 616c   files in os.wal
-00011660: 6b28 666f 6c64 6572 2c20 746f 7064 6f77  k(folder, topdow
-00011670: 6e3d 5472 7565 293a 0a0a 2020 2020 2020  n=True):..      
-00011680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011690: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
-000116a0: 2075 7365 7220 6861 7320 7265 6164 2061   user has read a
-000116b0: 6e64 2077 7269 7465 2070 6572 6d69 7373  nd write permiss
-000116c0: 696f 6e73 2074 6f20 7468 6520 726f 6f74  ions to the root
-000116d0: 2066 6f6c 6465 720a 2020 2020 2020 2020   folder.        
-000116e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116f0: 6966 206e 6f74 2073 656c 662e 5f63 6865  if not self._che
-00011700: 636b 5f70 6174 685f 7065 726d 6973 7369  ck_path_permissi
-00011710: 6f6e 7328 726f 6f74 293a 0a20 2020 2020  ons(root):.     
-00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011730: 2020 2020 2020 2063 6f72 7265 6374 5f70         correct_p
-00011740: 6572 6d69 7373 696f 6e73 203d 2046 616c  ermissions = Fal
-00011750: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-00011760: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-00011770: 6563 6b20 6966 2074 6865 2075 7365 7220  eck if the user 
-00011780: 6861 7320 7265 6164 2061 6e64 2077 7269  has read and wri
-00011790: 7465 2070 6572 6d69 7373 696f 6e73 2074  te permissions t
-000117a0: 6f20 616c 6c20 7375 6266 6f6c 6465 7273  o all subfolders
-000117b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000117c0: 2020 2020 2020 2020 2066 6f72 2064 2069           for d i
-000117d0: 6e20 6469 7273 3a0a 2020 2020 2020 2020  n dirs:.        
-000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117f0: 2020 2020 645f 7061 7468 203d 206f 732e      d_path = os.
-00011800: 7061 7468 2e6a 6f69 6e28 726f 6f74 2c20  path.join(root, 
-00011810: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-00011820: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011830: 6620 6e6f 7420 7365 6c66 2e5f 6368 6563  f not self._chec
-00011840: 6b5f 7061 7468 5f70 6572 6d69 7373 696f  k_path_permissio
-00011850: 6e73 2864 5f70 6174 6829 3a0a 2020 2020  ns(d_path):.    
-00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011870: 2020 2020 2020 2020 2020 2020 636f 7272              corr
-00011880: 6563 745f 7065 726d 6973 7369 6f6e 7320  ect_permissions 
-00011890: 3d20 4661 6c73 650a 0a20 2020 2020 2020  = False..       
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
-000118c0: 7573 6572 2068 6173 2072 6561 6420 616e  user has read an
-000118d0: 6420 7772 6974 6520 7065 726d 6973 7369  d write permissi
-000118e0: 6f6e 7320 746f 2061 6c6c 2066 696c 6573  ons to all files
-000118f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011900: 2020 2020 2020 2020 2066 6f72 2066 2069           for f i
-00011910: 6e20 6669 6c65 733a 0a20 2020 2020 2020  n files:.       
-00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011930: 2020 2020 2066 5f70 6174 6820 3d20 6f73       f_path = os
-00011940: 2e70 6174 682e 6a6f 696e 2872 6f6f 742c  .path.join(root,
-00011950: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011970: 6966 206e 6f74 2073 656c 662e 5f63 6865  if not self._che
-00011980: 636b 5f70 6174 685f 7065 726d 6973 7369  ck_path_permissi
-00011990: 6f6e 7328 665f 7061 7468 293a 0a20 2020  ons(f_path):.   
-000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119b0: 2020 2020 2020 2020 2020 2020 2063 6f72               cor
-000119c0: 7265 6374 5f70 6572 6d69 7373 696f 6e73  rect_permissions
-000119d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000119e0: 2020 2020 2020 2020 2065 6c73 653a 0a0a           else:..
-000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a00: 2020 2020 2320 5265 6375 7273 6976 6520      # Recursive 
-00011a10: 666c 6167 206e 6f74 2073 6574 2c20 7573  flag not set, us
-00011a20: 696e 6720 6f73 2e6c 6973 7464 6972 2074  ing os.listdir t
-00011a30: 6f20 6765 7420 616e 6420 6368 6563 6b20  o get and check 
-00011a40: 616c 6c20 6669 6c65 730a 2020 2020 2020  all files.      
-00011a50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00011a60: 7220 6620 696e 206f 732e 6c69 7374 6469  r f in os.listdi
-00011a70: 7228 666f 6c64 6572 293a 0a20 2020 2020  r(folder):.     
+0000f6c0: 2020 2020 2020 2020 2020 666f 7220 7265            for re
+0000f6d0: 6769 6f6e 2069 6e20 7265 6769 6f6e 735b  gion in regions[
+0000f6e0: 2752 6567 696f 6e73 275d 5d0a 2020 2020  'Regions']].    
+0000f6f0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000f700: 6567 696f 6e5f 6e61 6d65 730a 0a20 2020  egion_names..   
+0000f710: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0000f720: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+0000f730: 2020 2020 2020 2020 2320 4966 2063 7572          # If cur
+0000f740: 7265 6e74 2073 6573 7369 6f6e 2064 6f65  rent session doe
+0000f750: 7320 6e6f 7420 6861 7665 2061 2072 6567  s not have a reg
+0000f760: 696f 6e2c 2072 6574 7572 6e20 6465 6661  ion, return defa
+0000f770: 756c 7420 7265 6769 6f6e 730a 2020 2020  ult regions.    
+0000f780: 2020 2020 2020 2020 7320 3d20 626f 746f          s = boto
+0000f790: 332e 5365 7373 696f 6e28 290a 2020 2020  3.Session().    
+0000f7a0: 2020 2020 2020 2020 6479 6e61 6d6f 6462          dynamodb
+0000f7b0: 5f72 6567 696f 6e73 203d 2073 2e67 6574  _regions = s.get
+0000f7c0: 5f61 7661 696c 6162 6c65 5f72 6567 696f  _available_regio
+0000f7d0: 6e73 2827 6479 6e61 6d6f 6462 2729 0a20  ns('dynamodb'). 
+0000f7e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f7f0: 6e20 6479 6e61 6d6f 6462 5f72 6567 696f  n dynamodb_regio
+0000f800: 6e73 0a0a 2020 2020 2020 2020 2320 7072  ns..        # pr
+0000f810: 696e 7428 7265 6769 6f6e 7329 0a20 2020  int(regions).   
+0000f820: 2020 2020 2023 2072 6567 696f 6e73 203d       # regions =
+0000f830: 205b 6920 666f 7220 6920 696e 2072 6567   [i for i in reg
+0000f840: 696f 6e73 2069 6620 6e6f 7420 692e 7374  ions if not i.st
+0000f850: 6172 7473 7769 7468 2827 6170 2d27 295d  artswith('ap-')]
+0000f860: 0a20 2020 2020 2020 2023 2072 6574 7572  .        # retur
+0000f870: 6e20 736f 7274 6564 2872 6567 696f 6e73  n sorted(regions
+0000f880: 2c20 7265 7665 7273 653d 5472 7565 290a  , reverse=True).
+0000f890: 0a20 2020 2020 2020 2023 2069 6620 7072  .        # if pr
+0000f8a0: 6f76 6964 6572 203d 3d20 2741 5753 273a  ovider == 'AWS':
+0000f8b0: 0a20 2020 2020 2020 2023 2020 2020 2074  .        #     t
+0000f8c0: 7279 3a0a 2020 2020 2020 2020 2320 2020  ry:.        #   
+0000f8d0: 2020 2020 2020 7365 7373 696f 6e20 3d20        session = 
+0000f8e0: 626f 746f 332e 5365 7373 696f 6e28 0a20  boto3.Session(. 
+0000f8f0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000f900: 2020 2020 2070 726f 6669 6c65 5f6e 616d       profile_nam
+0000f910: 653d 7072 6f66 696c 6529 2069 6620 7072  e=profile) if pr
+0000f920: 6f66 696c 6520 656c 7365 2062 6f74 6f33  ofile else boto3
+0000f930: 2e53 6573 7369 6f6e 2829 0a20 2020 2020  .Session().     
+0000f940: 2020 2023 2020 2020 2020 2020 2072 6567     #         reg
+0000f950: 696f 6e73 203d 2073 6573 7369 6f6e 2e67  ions = session.g
+0000f960: 6574 5f61 7661 696c 6162 6c65 5f72 6567  et_available_reg
+0000f970: 696f 6e73 2827 6563 3227 290a 2020 2020  ions('ec2').    
+0000f980: 2020 2020 2320 2020 2020 2020 2020 2320      #         # 
+0000f990: 6d61 6b65 2074 6865 206c 6973 7420 6120  make the list a 
+0000f9a0: 6c69 7474 6c65 2073 686f 7274 6572 0a20  little shorter. 
+0000f9b0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000f9c0: 2072 6567 696f 6e73 203d 205b 6920 666f   regions = [i fo
+0000f9d0: 7220 6920 696e 2072 6567 696f 6e73 2069  r i in regions i
+0000f9e0: 6620 6e6f 7420 692e 7374 6172 7473 7769  f not i.startswi
+0000f9f0: 7468 2827 6170 2d27 295d 0a20 2020 2020  th('ap-')].     
+0000fa00: 2020 2023 2020 2020 2020 2020 2072 6574     #         ret
+0000fa10: 7572 6e20 736f 7274 6564 2872 6567 696f  urn sorted(regio
+0000fa20: 6e73 2c20 7265 7665 7273 653d 5472 7565  ns, reverse=True
+0000fa30: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
+0000fa40: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0000fa50: 2320 2020 2020 2020 2020 7265 7475 726e  #         return
+0000fa60: 205b 2775 732d 7765 7374 2d32 272c 2027   ['us-west-2', '
+0000fa70: 7573 2d77 6573 742d 3127 2c20 2775 732d  us-west-1', 'us-
+0000fa80: 6561 7374 2d31 272c 2027 275d 0a20 2020  east-1', ''].   
+0000fa90: 2020 2020 2023 2065 6c69 6620 7072 6f76       # elif prov
+0000faa0: 6964 6572 203d 3d20 2747 4353 273a 0a20  ider == 'GCS':. 
+0000fab0: 2020 2020 2020 2023 2020 2020 2072 6574         #     ret
+0000fac0: 7572 6e20 5b27 7573 2d77 6573 7431 272c  urn ['us-west1',
+0000fad0: 2027 7573 2d65 6173 7431 272c 2027 275d   'us-east1', '']
+0000fae0: 0a20 2020 2020 2020 2023 2065 6c69 6620  .        # elif 
+0000faf0: 7072 6f76 6964 6572 203d 3d20 2757 6173  provider == 'Was
+0000fb00: 6162 6927 3a0a 2020 2020 2020 2020 2320  abi':.        # 
+0000fb10: 2020 2020 7265 7475 726e 205b 2775 732d      return ['us-
+0000fb20: 7765 7374 2d31 272c 2027 7573 2d65 6173  west-1', 'us-eas
+0000fb30: 742d 3127 2c20 2727 5d0a 2020 2020 2020  t-1', ''].      
+0000fb40: 2020 2320 656c 6966 2070 726f 7669 6465    # elif provide
+0000fb50: 7220 3d3d 2027 4944 7269 7665 273a 0a20  r == 'IDrive':. 
+0000fb60: 2020 2020 2020 2023 2020 2020 2072 6574         #     ret
+0000fb70: 7572 6e20 5b27 7573 2d6f 7227 2c20 2775  urn ['us-or', 'u
+0000fb80: 732d 7661 272c 2027 7573 2d6c 6127 2c20  s-va', 'us-la', 
+0000fb90: 2727 5d0a 2020 2020 2020 2020 2320 656c  ''].        # el
+0000fba0: 6966 2070 726f 7669 6465 7220 3d3d 2027  if provider == '
+0000fbb0: 4365 7068 273a 0a20 2020 2020 2020 2023  Ceph':.        #
+0000fbc0: 2020 2020 2072 6574 7572 6e20 5b27 6465       return ['de
+0000fbd0: 6661 756c 742d 706c 6163 656d 656e 7427  fault-placement'
+0000fbe0: 2c20 2775 732d 6561 7374 2d31 272c 2027  , 'us-east-1', '
+0000fbf0: 275d 0a0a 2020 2020 6465 6620 6c69 7374  ']..    def list
+0000fc00: 5f6f 626a 6563 7473 5f69 6e5f 6275 636b  _objects_in_buck
+0000fc10: 6574 2873 656c 662c 2062 7563 6b65 745f  et(self, bucket_
+0000fc20: 6e61 6d65 293a 0a20 2020 2020 2020 2069  name):.        i
+0000fc30: 6620 6e6f 7420 6275 636b 6574 5f6e 616d  f not bucket_nam
+0000fc40: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000fc50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000fc60: 274e 6f20 6275 636b 6574 206e 616d 6520  'No bucket name 
+0000fc70: 7072 6f76 6964 6564 2729 0a0a 2020 2020  provided')..    
+0000fc80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000fc90: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+0000fca0: 7468 6520 7365 7373 696f 6e20 6973 2076  the session is v
+0000fcb0: 616c 6964 0a20 2020 2020 2020 2020 2020  alid.           
+0000fcc0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6368   if not self._ch
+0000fcd0: 6563 6b5f 7365 7373 696f 6e28 293a 0a20  eck_session():. 
+0000fce0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000fcf0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+0000fd00: 2020 2020 2020 2020 2020 6622 5c6e 4572            f"\nEr
+0000fd10: 726f 723a 2041 5753 2063 7265 6465 6e74  ror: AWS credent
+0000fd20: 6961 6c73 2061 7265 206e 6f74 2076 616c  ials are not val
+0000fd30: 6964 2066 6f72 2070 726f 6669 6c65 207b  id for profile {
+0000fd40: 7365 6c66 2e63 6667 2e61 7773 5f70 726f  self.cfg.aws_pro
+0000fd50: 6669 6c65 7d22 290a 2020 2020 2020 2020  file}").        
+0000fd60: 2020 2020 2020 2020 7072 696e 7428 2272          print("r
+0000fd70: 756e 2027 6672 6f73 7465 7220 636f 6e66  un 'froster conf
+0000fd80: 6967 202d 2d61 7773 2720 746f 2066 6978  ig --aws' to fix
+0000fd90: 2074 6869 732e 5c6e 2229 0a20 2020 2020   this.\n").     
+0000fda0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0000fdb0: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
+0000fdc0: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+0000fdd0: 656c 662e 7333 5f63 6c69 656e 742e 6c69  elf.s3_client.li
+0000fde0: 7374 5f6f 626a 6563 7473 5f76 3228 4275  st_objects_v2(Bu
+0000fdf0: 636b 6574 3d62 7563 6b65 745f 6e61 6d65  cket=bucket_name
+0000fe00: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000fe10: 6574 7572 6e20 7265 7370 6f6e 7365 2e67  eturn response.g
+0000fe20: 6574 2827 436f 6e74 656e 7473 272c 205b  et('Contents', [
+0000fe30: 5d29 0a20 2020 2020 2020 2065 7863 6570  ]).        excep
+0000fe40: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+0000fe50: 7269 6e74 5f65 7272 6f72 2829 0a20 2020  rint_error().   
+0000fe60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fe70: 5b5d 0a0a 2020 2020 6465 6620 7365 745f  []..    def set_
+0000fe80: 7365 7373 696f 6e28 7365 6c66 2c20 7072  session(self, pr
+0000fe90: 6f66 696c 655f 6e61 6d65 2c20 7265 6769  ofile_name, regi
+0000fea0: 6f6e 293a 0a20 2020 2020 2020 2027 2727  on):.        '''
+0000feb0: 2053 6574 2074 6865 2041 5753 2070 726f   Set the AWS pro
+0000fec0: 6669 6c65 2066 6f72 2074 6865 2063 7572  file for the cur
+0000fed0: 7265 6e74 2073 6573 7369 6f6e 2727 270a  rent session'''.
+0000fee0: 0a20 2020 2020 2020 2074 7279 3a0a 0a20  .        try:.. 
+0000fef0: 2020 2020 2020 2020 2020 2023 2049 6e69             # Ini
+0000ff00: 7469 616c 697a 6520 6120 426f 746f 3320  tialize a Boto3 
+0000ff10: 7365 7373 696f 6e20 7573 696e 6720 7468  session using th
+0000ff20: 6520 636f 6e66 6967 7572 6564 2070 726f  e configured pro
+0000ff30: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+0000ff40: 2073 6573 7369 6f6e 203d 2062 6f74 6f33   session = boto3
+0000ff50: 2e53 6573 7369 6f6e 280a 2020 2020 2020  .Session(.      
+0000ff60: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
+0000ff70: 655f 6e61 6d65 3d70 726f 6669 6c65 5f6e  e_name=profile_n
+0000ff80: 616d 652c 2072 6567 696f 6e5f 6e61 6d65  ame, region_name
+0000ff90: 3d72 6567 696f 6e29 0a0a 2020 2020 2020  =region)..      
+0000ffa0: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+0000ffb0: 7a65 2074 6865 2041 5753 2063 6c69 656e  ze the AWS clien
+0000ffc0: 7473 0a20 2020 2020 2020 2020 2020 2073  ts.            s
+0000ffd0: 656c 662e 6365 5f63 6c69 656e 7420 3d20  elf.ce_client = 
+0000ffe0: 7365 7373 696f 6e2e 636c 6965 6e74 2827  session.client('
+0000fff0: 6365 2729 0a20 2020 2020 2020 2020 2020  ce').           
+00010000: 2073 656c 662e 6563 325f 636c 6965 6e74   self.ec2_client
+00010010: 203d 2073 6573 7369 6f6e 2e63 6c69 656e   = session.clien
+00010020: 7428 2765 6332 2729 0a20 2020 2020 2020  t('ec2').       
+00010030: 2020 2020 2073 656c 662e 6961 6d5f 636c       self.iam_cl
+00010040: 6965 6e74 203d 2073 6573 7369 6f6e 2e63  ient = session.c
+00010050: 6c69 656e 7428 2769 616d 2729 0a20 2020  lient('iam').   
+00010060: 2020 2020 2020 2020 2073 656c 662e 7333           self.s3
+00010070: 5f63 6c69 656e 7420 3d20 7365 7373 696f  _client = sessio
+00010080: 6e2e 636c 6965 6e74 2827 7333 2729 0a20  n.client('s3'). 
+00010090: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000100a0: 7365 735f 636c 6965 6e74 203d 2073 6573  ses_client = ses
+000100b0: 7369 6f6e 2e63 6c69 656e 7428 2773 6573  sion.client('ses
+000100c0: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+000100d0: 656c 662e 7374 735f 636c 6965 6e74 203d  elf.sts_client =
+000100e0: 2073 6573 7369 6f6e 2e63 6c69 656e 7428   session.client(
+000100f0: 2773 7473 2729 0a0a 2020 2020 2020 2020  'sts')..        
+00010100: 2020 2020 2320 544f 444f 3a20 5468 6973      # TODO: This
+00010110: 2069 7320 666f 7220 5f65 6332 5f63 7265   is for _ec2_cre
+00010120: 6174 655f 696e 7374 616e 6365 2066 756e  ate_instance fun
+00010130: 6374 696f 6e2e 2052 6576 6965 7720 6966  ction. Review if
+00010140: 2077 6520 7265 616c 6c79 206e 6565 6465   we really neede
+00010150: 640a 2020 2020 2020 2020 2020 2020 7365  d.            se
+00010160: 6c66 2e73 6573 7369 6f6e 203d 2073 6573  lf.session = ses
+00010170: 7369 6f6e 0a0a 2020 2020 2020 2020 6578  sion..        ex
+00010180: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+00010190: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000101a0: 2070 6173 730a 0a20 2020 2064 6566 2063   pass..    def c
+000101b0: 6c6f 7365 5f73 6573 7369 6f6e 2873 656c  lose_session(sel
+000101c0: 6629 3a0a 2020 2020 2020 2020 6966 2068  f):.        if h
+000101d0: 6173 6174 7472 2873 656c 662c 2027 6365  asattr(self, 'ce
+000101e0: 5f63 6c69 656e 7427 293a 0a20 2020 2020  _client'):.     
+000101f0: 2020 2020 2020 2073 656c 662e 6365 5f63         self.ce_c
+00010200: 6c69 656e 742e 636c 6f73 6528 290a 2020  lient.close().  
+00010210: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+00010220: 6c66 2e63 655f 636c 6965 6e74 0a20 2020  lf.ce_client.   
+00010230: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00010240: 7365 6c66 2c20 2765 6332 5f63 6c69 656e  self, 'ec2_clien
+00010250: 7427 293a 0a20 2020 2020 2020 2020 2020  t'):.           
+00010260: 2073 656c 662e 6563 325f 636c 6965 6e74   self.ec2_client
+00010270: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+00010280: 2020 2020 2064 656c 2073 656c 662e 6563       del self.ec
+00010290: 325f 636c 6965 6e74 0a20 2020 2020 2020  2_client.       
+000102a0: 2069 6620 6861 7361 7474 7228 7365 6c66   if hasattr(self
+000102b0: 2c20 2769 616d 5f63 6c69 656e 7427 293a  , 'iam_client'):
+000102c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000102d0: 662e 6961 6d5f 636c 6965 6e74 2e63 6c6f  f.iam_client.clo
+000102e0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+000102f0: 2064 656c 2073 656c 662e 6961 6d5f 636c   del self.iam_cl
+00010300: 6965 6e74 0a20 2020 2020 2020 2069 6620  ient.        if 
+00010310: 6861 7361 7474 7228 7365 6c66 2c20 2773  hasattr(self, 's
+00010320: 335f 636c 6965 6e74 2729 3a0a 2020 2020  3_client'):.    
+00010330: 2020 2020 2020 2020 7365 6c66 2e73 335f          self.s3_
+00010340: 636c 6965 6e74 2e63 6c6f 7365 2829 0a20  client.close(). 
+00010350: 2020 2020 2020 2020 2020 2064 656c 2073             del s
+00010360: 656c 662e 7333 5f63 6c69 656e 740a 2020  elf.s3_client.  
+00010370: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+00010380: 2873 656c 662c 2027 7365 735f 636c 6965  (self, 'ses_clie
+00010390: 6e74 2729 3a0a 2020 2020 2020 2020 2020  nt'):.          
+000103a0: 2020 7365 6c66 2e73 6573 5f63 6c69 656e    self.ses_clien
+000103b0: 742e 636c 6f73 6528 290a 2020 2020 2020  t.close().      
+000103c0: 2020 2020 2020 6465 6c20 7365 6c66 2e73        del self.s
+000103d0: 6573 5f63 6c69 656e 740a 2020 2020 2020  es_client.      
+000103e0: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+000103f0: 662c 2027 7374 735f 636c 6965 6e74 2729  f, 'sts_client')
+00010400: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00010410: 6c66 2e73 7473 5f63 6c69 656e 742e 636c  lf.sts_client.cl
+00010420: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00010430: 2020 6465 6c20 7365 6c66 2e73 7473 5f63    del self.sts_c
+00010440: 6c69 656e 740a 0a20 2020 2064 6566 2067  lient..    def g
+00010450: 6574 5f74 696d 655f 7a6f 6e65 2873 656c  et_time_zone(sel
+00010460: 6629 3a0a 2020 2020 2020 2020 2727 2747  f):.        '''G
+00010470: 6574 2074 6865 2063 7572 7265 6e74 2074  et the current t
+00010480: 696d 6520 7a6f 6e65 2073 7472 696e 6720  ime zone string 
+00010490: 6672 6f6d 2074 6865 2073 7973 7465 6d27  from the system'
+000104a0: 2727 0a0a 2020 2020 2020 2020 7472 793a  ''..        try:
+000104b0: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+000104c0: 6573 6f6c 7665 2074 6865 202f 6574 632f  esolve the /etc/
+000104d0: 6c6f 6361 6c74 696d 6520 7379 6d6c 696e  localtime symlin
+000104e0: 6b0a 2020 2020 2020 2020 2020 2020 7469  k.            ti
+000104f0: 6d65 7a6f 6e65 5f70 6174 6820 3d20 6f73  mezone_path = os
+00010500: 2e70 6174 682e 7265 616c 7061 7468 2822  .path.realpath("
+00010510: 2f65 7463 2f6c 6f63 616c 7469 6d65 2229  /etc/localtime")
+00010520: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00010530: 4578 7472 6163 7420 7468 6520 7469 6d65  Extract the time
+00010540: 207a 6f6e 6520 7374 7269 6e67 2062 7920   zone string by 
+00010550: 7374 7269 7070 696e 6720 6f66 6620 7468  stripping off th
+00010560: 6520 7072 6566 6978 206f 6620 7468 6520  e prefix of the 
+00010570: 7a6f 6e65 696e 666f 2070 6174 680a 2020  zoneinfo path.  
+00010580: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00010590: 745f 747a 5f73 7472 203d 2074 696d 657a  t_tz_str = timez
+000105a0: 6f6e 655f 7061 7468 2e73 706c 6974 2822  one_path.split("
+000105b0: 7a6f 6e65 696e 666f 2f22 295b 2d31 5d0a  zoneinfo/")[-1].
+000105c0: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+000105d0: 6574 7572 6e20 7468 6520 7469 6d65 207a  eturn the time z
+000105e0: 6f6e 6520 7374 7269 6e67 0a20 2020 2020  one string.     
+000105f0: 2020 2020 2020 2072 6574 7572 6e20 6375         return cu
+00010600: 7272 656e 745f 747a 5f73 7472 0a0a 2020  rrent_tz_str..  
+00010610: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00010620: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+00010630: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00010640: 2745 7272 6f72 3a20 7b65 7d2e 2055 7369  'Error: {e}. Usi
+00010650: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
+00010660: 2022 416d 6572 6963 612f 4c6f 735f 416e   "America/Los_An
+00010670: 6765 6c65 7322 2729 0a20 2020 2020 2020  geles"').       
+00010680: 2020 2020 2072 6574 7572 6e20 2827 416d       return ('Am
+00010690: 6572 6963 612f 4c6f 735f 416e 6765 6c65  erica/Los_Angele
+000106a0: 7327 290a 0a23 2323 2323 2323 2323 2323  s')..###########
+000106b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000106c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000106d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000106e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000106f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010700: 2323 2323 2323 2323 230a 0a20 2020 2064  #########..    d
+00010710: 6566 2063 6865 636b 5f62 7563 6b65 745f  ef check_bucket_
+00010720: 6163 6365 7373 5f66 6f6c 6465 7273 2873  access_folders(s
+00010730: 656c 662c 2066 6f6c 6465 7273 293a 0a20  elf, folders):. 
+00010740: 2020 2020 2020 2023 2054 4f44 4f3a 2066         # TODO: f
+00010750: 756e 6374 696f 6e20 7065 6e64 696e 7420  unction pendint 
+00010760: 746f 2072 6576 6965 770a 2020 2020 2020  to review.      
+00010770: 2020 7072 696e 7428 6627 544f 444f 3a20    print(f'TODO: 
+00010780: 6675 6e63 7469 6f6e 207b 696e 7370 6563  function {inspec
+00010790: 742e 7374 6163 6b28 295b 305d 5b33 5d7d  t.stack()[0][3]}
+000107a0: 2070 656e 6469 6e67 2074 6f20 7265 7669   pending to revi
+000107b0: 6577 2729 0a20 2020 2020 2020 2065 7869  ew').        exi
+000107c0: 7428 3129 0a0a 2020 2020 2020 2020 2320  t(1)..        # 
+000107d0: 6368 6563 6b20 616c 6c20 7468 6520 6275  check all the bu
+000107e0: 636b 6574 7320 7468 6174 2068 6176 6520  ckets that have 
+000107f0: 6265 656e 2075 7365 6420 666f 7220 6172  been used for ar
+00010800: 6368 6976 696e 670a 2020 2020 2020 2020  chiving.        
+00010810: 7375 6666 6963 6965 6e74 203d 2054 7275  sufficient = Tru
+00010820: 650a 2020 2020 2020 2020 6d79 6163 6365  e.        myacce
+00010830: 7373 203d 2027 7265 6164 270a 2020 2020  ss = 'read'.    
+00010840: 2020 2020 6275 636b 6574 7320 3d20 5b5d      buckets = []
+00010850: 0a20 2020 2020 2020 2066 6f72 2066 6f6c  .        for fol
+00010860: 6465 7220 696e 2066 6f6c 6465 7273 3a0a  der in folders:.
+00010870: 2020 2020 2020 2020 2020 2020 6275 636b              buck
+00010880: 6574 2c20 2a5f 203d 2073 656c 662e 6172  et, *_ = self.ar
+00010890: 6368 2e61 7263 6869 7665 5f67 6574 5f62  ch.archive_get_b
+000108a0: 7563 6b65 745f 696e 666f 2866 6f6c 6465  ucket_info(folde
+000108b0: 7229 0a0a 2020 2020 2020 2020 2020 2020  r)..            
+000108c0: 6966 2062 7563 6b65 743a 0a20 2020 2020  if bucket:.     
+000108d0: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
+000108e0: 7473 2e61 7070 656e 6428 6275 636b 6574  ts.append(bucket
+000108f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00010900: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010910: 2020 2020 7072 696e 7428 6627 4572 726f      print(f'Erro
+00010920: 723a 204e 6f20 6172 6368 6976 6520 636f  r: No archive co
+00010930: 6e66 6967 2066 6f75 6e64 2066 6f72 2066  nfig found for f
+00010940: 6f6c 6465 7220 7b66 6f6c 6465 727d 2729  older {folder}')
+00010950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010960: 2073 7566 6669 6369 656e 7420 3d20 4661   sufficient = Fa
+00010970: 6c73 650a 2020 2020 2020 2020 6275 636b  lse.        buck
+00010980: 6574 7320 3d20 6c69 7374 2873 6574 2862  ets = list(set(b
+00010990: 7563 6b65 7473 2929 2020 2320 7265 6d6f  uckets))  # remo
+000109a0: 7665 2064 7570 730a 2020 2020 2020 2020  ve dups.        
+000109b0: 666f 7220 6275 636b 6574 2069 6e20 6275  for bucket in bu
+000109c0: 636b 6574 733a 0a20 2020 2020 2020 2020  ckets:.         
+000109d0: 2020 2069 6620 6e6f 7420 7365 6c66 2e63     if not self.c
+000109e0: 6865 636b 5f62 7563 6b65 745f 6163 6365  heck_bucket_acce
+000109f0: 7373 2862 7563 6b65 7429 3a0a 2020 2020  ss(bucket):.    
+00010a00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00010a10: 7428 6627 2059 6f75 2068 6176 6520 6e6f  t(f' You have no
+00010a20: 207b 6d79 6163 6365 7373 7d20 6163 6365   {myaccess} acce
+00010a30: 7373 2074 6f20 6275 636b 6574 2022 7b62  ss to bucket "{b
+00010a40: 7563 6b65 747d 2220 2127 290a 2020 2020  ucket}" !').    
+00010a50: 2020 2020 2020 2020 2020 2020 7375 6666              suff
+00010a60: 6963 6965 6e74 203d 2046 616c 7365 0a20  icient = False. 
+00010a70: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+00010a80: 6666 6963 6965 6e74 0a0a 2020 2020 6465  fficient..    de
+00010a90: 6620 676c 6163 6965 725f 7265 7374 6f72  f glacier_restor
+00010aa0: 6528 7365 6c66 2c20 6275 636b 6574 2c20  e(self, bucket, 
+00010ab0: 7072 6566 6978 2c20 6b65 6570 5f64 6179  prefix, keep_day
+00010ac0: 733d 3330 2c20 7265 745f 6f70 743d 2242  s=30, ret_opt="B
+00010ad0: 756c 6b22 293a 0a0a 2020 2020 2020 2020  ulk"):..        
+00010ae0: 2320 4368 6563 6b20 6966 2074 6865 2073  # Check if the s
+00010af0: 6573 7369 6f6e 2069 7320 7661 6c69 640a  ession is valid.
+00010b00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00010b10: 656c 662e 5f63 6865 636b 5f73 6573 7369  elf._check_sessi
+00010b20: 6f6e 2829 3a0a 2020 2020 2020 2020 2020  on():.          
+00010b30: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+00010b40: 2020 2020 2020 2020 2066 225c 6e45 7272           f"\nErr
+00010b50: 6f72 3a20 4157 5320 6372 6564 656e 7469  or: AWS credenti
+00010b60: 616c 7320 6172 6520 6e6f 7420 7661 6c69  als are not vali
+00010b70: 6420 666f 7220 7072 6f66 696c 6520 7b73  d for profile {s
+00010b80: 656c 662e 6366 672e 6177 735f 7072 6f66  elf.cfg.aws_prof
+00010b90: 696c 657d 2229 0a20 2020 2020 2020 2020  ile}").         
+00010ba0: 2020 2070 7269 6e74 2822 7275 6e20 2766     print("run 'f
+00010bb0: 726f 7374 6572 2063 6f6e 6669 6720 2d2d  roster config --
+00010bc0: 6177 7327 2074 6f20 6669 7820 7468 6973  aws' to fix this
+00010bd0: 2e5c 6e22 290a 2020 2020 2020 2020 2020  .\n").          
+00010be0: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+00010bf0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00010c00: 2020 2020 2020 2020 7061 6769 6e61 746f          paginato
+00010c10: 7220 3d20 7365 6c66 2e73 335f 636c 6965  r = self.s3_clie
+00010c20: 6e74 2e67 6574 5f70 6167 696e 6174 6f72  nt.get_paginator
+00010c30: 2827 6c69 7374 5f6f 626a 6563 7473 5f76  ('list_objects_v
+00010c40: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
+00010c50: 7061 6765 7320 3d20 7061 6769 6e61 746f  pages = paginato
+00010c60: 722e 7061 6769 6e61 7465 2842 7563 6b65  r.paginate(Bucke
+00010c70: 743d 6275 636b 6574 2c20 5072 6566 6978  t=bucket, Prefix
+00010c80: 3d70 7265 6669 7829 0a0a 2020 2020 2020  =prefix)..      
+00010c90: 2020 6578 6365 7074 2062 6f74 6f63 6f72    except botocor
+00010ca0: 652e 6578 6365 7074 696f 6e73 2e43 6c69  e.exceptions.Cli
+00010cb0: 656e 7445 7272 6f72 2061 7320 653a 0a20  entError as e:. 
+00010cc0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00010cd0: 5f63 6f64 6520 3d20 652e 7265 7370 6f6e  _code = e.respon
+00010ce0: 7365 5b27 4572 726f 7227 5d5b 2743 6f64  se['Error']['Cod
+00010cf0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00010d00: 6966 2065 7272 6f72 5f63 6f64 6520 3d3d  if error_code ==
+00010d10: 2027 4163 6365 7373 4465 6e69 6564 273a   'AccessDenied':
+00010d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010d30: 2070 7269 6e74 2866 2241 6363 6573 7320   print(f"Access 
+00010d40: 6465 6e69 6564 2066 6f72 2062 7563 6b65  denied for bucke
+00010d50: 7420 277b 6275 636b 6574 7d27 222c 2066  t '{bucket}'", f
+00010d60: 696c 653d 7379 732e 7374 6465 7272 290a  ile=sys.stderr).
+00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d80: 7072 696e 7428 2743 6865 636b 2079 6f75  print('Check you
+00010d90: 7220 7065 726d 6973 7369 6f6e 7320 616e  r permissions an
+00010da0: 642f 6f72 2063 7265 6465 6e74 6961 6c73  d/or credentials
+00010db0: 2e27 2c20 6669 6c65 3d73 7973 2e73 7464  .', file=sys.std
+00010dc0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+00010dd0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010de0: 2020 2020 2020 2070 7269 6e74 5f65 7272         print_err
+00010df0: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
+00010e00: 2072 6574 7572 6e20 5b5d 2c20 5b5d 2c20   return [], [], 
+00010e10: 5b5d 2c20 5b5d 0a0a 2020 2020 2020 2020  [], []..        
+00010e20: 2320 496e 6974 6961 6c69 7a65 206c 6973  # Initialize lis
+00010e30: 7473 2074 6f20 7374 6f72 6520 7468 6520  ts to store the 
+00010e40: 6b65 7973 0a20 2020 2020 2020 2074 7269  keys.        tri
+00010e50: 6767 6572 6564 5f6b 6579 7320 3d20 5b5d  ggered_keys = []
+00010e60: 0a20 2020 2020 2020 2072 6573 746f 7269  .        restori
+00010e70: 6e67 5f6b 6579 7320 3d20 5b5d 0a20 2020  ng_keys = [].   
+00010e80: 2020 2020 2072 6573 746f 7265 645f 6b65       restored_ke
+00010e90: 7973 203d 205b 5d0a 2020 2020 2020 2020  ys = [].        
+00010ea0: 6e6f 745f 676c 6163 6965 725f 6b65 7973  not_glacier_keys
+00010eb0: 203d 205b 5d0a 0a20 2020 2020 2020 2066   = []..        f
+00010ec0: 6f72 2070 6167 6520 696e 2070 6167 6573  or page in pages
+00010ed0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00010ee0: 206e 6f74 2027 436f 6e74 656e 7473 2720   not 'Contents' 
+00010ef0: 696e 2070 6167 653a 0a20 2020 2020 2020  in page:.       
+00010f00: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00010f10: 650a 0a20 2020 2020 2020 2020 2020 2066  e..            f
+00010f20: 6f72 206f 626a 6563 7420 696e 2070 6167  or object in pag
+00010f30: 655b 2743 6f6e 7465 6e74 7327 5d3a 0a20  e['Contents']:. 
+00010f40: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00010f50: 626a 6563 745f 6b65 7920 3d20 6f62 6a65  bject_key = obje
+00010f60: 6374 5b27 4b65 7927 5d0a 0a20 2020 2020  ct['Key']..     
+00010f70: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00010f80: 636b 2069 6620 7468 6572 6520 6172 6520  ck if there are 
+00010f90: 6164 6469 7469 6f6e 616c 2073 6c61 7368  additional slash
+00010fa0: 6573 2061 6674 6572 2074 6865 2070 7265  es after the pre
+00010fb0: 6669 782c 0a20 2020 2020 2020 2020 2020  fix,.           
+00010fc0: 2020 2020 2023 2069 6e64 6963 6174 696e       # indicatin
+00010fd0: 6720 7468 6174 2074 6865 206f 626a 6563  g that the objec
+00010fe0: 7420 6973 2069 6e20 6120 7375 6266 6f6c  t is in a subfol
+00010ff0: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
+00011000: 2020 2020 2072 656d 6169 6e69 6e67 5f70       remaining_p
+00011010: 6174 6820 3d20 6f62 6a65 6374 5f6b 6579  ath = object_key
+00011020: 5b6c 656e 2870 7265 6669 7829 3a5d 0a20  [len(prefix):]. 
+00011030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011040: 6620 272f 2720 696e 2072 656d 6169 6e69  f '/' in remaini
+00011050: 6e67 5f70 6174 683a 0a20 2020 2020 2020  ng_path:.       
+00011060: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00011070: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+00011080: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
+00011090: 7365 6c66 2e73 335f 636c 6965 6e74 2e68  self.s3_client.h
+000110a0: 6561 645f 6f62 6a65 6374 280a 2020 2020  ead_object(.    
+000110b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110c0: 4275 636b 6574 3d62 7563 6b65 742c 204b  Bucket=bucket, K
+000110d0: 6579 3d6f 626a 6563 745f 6b65 7929 0a0a  ey=object_key)..
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 6966 2027 5374 6f72 6167 6543 6c61 7373  if 'StorageClass
+00011100: 2720 696e 2068 6561 6465 723a 0a20 2020  ' in header:.   
+00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011120: 2069 6620 6e6f 7420 6865 6164 6572 5b27   if not header['
+00011130: 5374 6f72 6167 6543 6c61 7373 275d 2069  StorageClass'] i
+00011140: 6e20 7b27 474c 4143 4945 5227 2c20 2744  n {'GLACIER', 'D
+00011150: 4545 505f 4152 4348 4956 4527 7d3a 0a20  EEP_ARCHIVE'}:. 
+00011160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011170: 2020 2020 2020 206e 6f74 5f67 6c61 6369         not_glaci
+00011180: 6572 5f6b 6579 732e 6170 7065 6e64 286f  er_keys.append(o
+00011190: 626a 6563 745f 6b65 7929 0a20 2020 2020  bject_key).     
+000111a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111b0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+000111c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000111d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000111e0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011200: 6966 2027 5265 7374 6f72 6527 2069 6e20  if 'Restore' in 
+00011210: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+00011220: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00011230: 6f6e 676f 696e 672d 7265 7175 6573 743d  ongoing-request=
+00011240: 2274 7275 6522 2720 696e 2068 6561 6465  "true"' in heade
+00011250: 725b 2752 6573 746f 7265 275d 3a0a 2020  r['Restore']:.  
+00011260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011270: 2020 2020 2020 7265 7374 6f72 696e 675f        restoring_
+00011280: 6b65 7973 2e61 7070 656e 6428 6f62 6a65  keys.append(obje
+00011290: 6374 5f6b 6579 290a 2020 2020 2020 2020  ct_key).        
+000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112b0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+000112c0: 2020 2020 2020 2020 2020 6966 2027 5265            if 'Re
+000112d0: 7374 6f72 6527 2069 6e20 6865 6164 6572  store' in header
+000112e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000112f0: 2020 2020 2020 6966 2027 6f6e 676f 696e        if 'ongoin
+00011300: 672d 7265 7175 6573 743d 2266 616c 7365  g-request="false
+00011310: 2227 2069 6e20 6865 6164 6572 5b27 5265  "' in header['Re
+00011320: 7374 6f72 6527 5d3a 0a20 2020 2020 2020  store']:.       
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2072 6573 746f 7265 645f 6b65 7973 2e61   restored_keys.a
+00011350: 7070 656e 6428 6f62 6a65 6374 5f6b 6579  ppend(object_key
+00011360: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011370: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00011380: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+00011390: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000113a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000113b0: 662e 7333 5f63 6c69 656e 742e 7265 7374  f.s3_client.rest
+000113c0: 6f72 655f 6f62 6a65 6374 280a 2020 2020  ore_object(.    
+000113d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113e0: 2020 2020 4275 636b 6574 3d62 7563 6b65      Bucket=bucke
+000113f0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00011400: 2020 2020 2020 2020 2020 204b 6579 3d6f             Key=o
+00011410: 626a 6563 745f 6b65 792c 0a20 2020 2020  bject_key,.     
+00011420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011430: 2020 2052 6573 746f 7265 5265 7175 6573     RestoreReques
+00011440: 743d 7b0a 2020 2020 2020 2020 2020 2020  t={.            
+00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011460: 2744 6179 7327 3a20 6b65 6570 5f64 6179  'Days': keep_day
+00011470: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00011480: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00011490: 476c 6163 6965 724a 6f62 5061 7261 6d65  GlacierJobParame
+000114a0: 7465 7273 273a 207b 0a20 2020 2020 2020  ters': {.       
+000114b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114c0: 2020 2020 2020 2020 2027 5469 6572 273a           'Tier':
+000114d0: 2072 6574 5f6f 7074 0a20 2020 2020 2020   ret_opt.       
+000114e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114f0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00011500: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00011510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011520: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00011530: 2020 2020 2020 2020 2020 2074 7269 6767             trigg
+00011540: 6572 6564 5f6b 6579 732e 6170 7065 6e64  ered_keys.append
+00011550: 286f 626a 6563 745f 6b65 7929 0a0a 2020  (object_key)..  
+00011560: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00011570: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00011580: 2020 2020 2020 2020 2020 7072 696e 745f            print_
+00011590: 6572 726f 7228 290a 2020 2020 2020 2020  error().        
+000115a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000115b0: 7428 6627 5265 7374 6f72 6520 7265 7175  t(f'Restore requ
+000115c0: 6573 7420 666f 7220 7b6f 626a 6563 745f  est for {object_
+000115d0: 6b65 797d 2066 6169 6c65 642e 2729 0a20  key} failed.'). 
+000115e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115f0: 2020 2072 6574 7572 6e20 5b5d 2c20 5b5d     return [], []
+00011600: 2c20 5b5d 2c20 5b5d 0a0a 2020 2020 2020  , [], []..      
+00011610: 2020 7265 7475 726e 2074 7269 6767 6572    return trigger
+00011620: 6564 5f6b 6579 732c 2072 6573 746f 7269  ed_keys, restori
+00011630: 6e67 5f6b 6579 732c 2072 6573 746f 7265  ng_keys, restore
+00011640: 645f 6b65 7973 2c20 6e6f 745f 676c 6163  d_keys, not_glac
+00011650: 6965 725f 6b65 7973 0a0a 2020 2020 6465  ier_keys..    de
+00011660: 6620 5f67 6574 5f73 335f 6461 7461 5f73  f _get_s3_data_s
+00011670: 697a 6528 7365 6c66 2c20 666f 6c64 6572  ize(self, folder
+00011680: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
+00011690: 2020 2020 2020 2020 4765 7420 7468 6520          Get the 
+000116a0: 7369 7a65 206f 6620 6461 7461 2069 6e20  size of data in 
+000116b0: 4769 4220 6167 6772 6567 6174 6564 2066  GiB aggregated f
+000116c0: 726f 6d20 6d75 6c74 6970 6c65 0a20 2020  rom multiple.   
+000116d0: 2020 2020 2053 3320 6275 636b 6574 7320       S3 buckets 
+000116e0: 6672 6f6d 2066 726f 7374 6572 2061 7263  from froster arc
+000116f0: 6869 7665 7320 6964 656e 7469 6669 6564  hives identified
+00011700: 2062 7920 610a 2020 2020 2020 2020 6c69   by a.        li
+00011710: 7374 206f 6620 666f 6c64 6572 730a 0a20  st of folders.. 
+00011720: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00011730: 5369 7a65 206f 6620 7468 6520 6461 7461  Size of the data
+00011740: 2069 6e20 4769 422e 0a20 2020 2020 2020   in GiB..       
+00011750: 2022 2222 0a20 2020 2020 2020 2023 2049   """.        # I
+00011760: 6e69 7469 616c 697a 6520 746f 7461 6c20  nitialize total 
+00011770: 7369 7a65 0a20 2020 2020 2020 2074 6f74  size.        tot
+00011780: 616c 5f73 697a 655f 6279 7465 7320 3d20  al_size_bytes = 
+00011790: 300a 0a20 2020 2020 2020 2023 2062 7563  0..        # buc
+000117a0: 6b65 745f 6e61 6d65 2c20 7072 6566 6978  ket_name, prefix
+000117b0: 2c20 7265 6375 7273 6976 653d 4661 6c73  , recursive=Fals
+000117c0: 650a 2020 2020 2020 2020 666f 7220 666c  e.        for fl
+000117d0: 6420 696e 2066 6f6c 6465 7273 3a0a 2020  d in folders:.  
+000117e0: 2020 2020 2020 2020 2020 6275 632c 2070            buc, p
+000117f0: 7265 2c20 7265 6375 722c 205f 203d 2073  re, recur, _ = s
+00011800: 656c 662e 6172 6368 2e61 7263 6869 7665  elf.arch.archive
+00011810: 5f67 6574 5f62 7563 6b65 745f 696e 666f  _get_bucket_info
+00011820: 2866 6c64 290a 2020 2020 2020 2020 2020  (fld).          
+00011830: 2020 6966 206e 6f74 2062 7563 3a0a 2020    if not buc:.  
+00011840: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00011850: 696e 7428 6627 4572 726f 723a 204e 6f20  int(f'Error: No 
+00011860: 6172 6368 6976 6520 636f 6e66 6967 2066  archive config f
+00011870: 6f75 6e64 2066 6f72 2066 6f6c 6465 7220  ound for folder 
+00011880: 7b66 6c64 7d27 290a 2020 2020 2020 2020  {fld}').        
+00011890: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+000118a0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+000118b0: 6574 7572 6e73 2062 7563 6b65 7428 7374  eturns bucket(st
+000118c0: 7229 2c20 7072 6566 6978 2873 7472 292c  r), prefix(str),
+000118d0: 2072 6563 7572 7369 7665 2862 6f6f 6c29   recursive(bool)
+000118e0: 2c20 676c 6163 6965 7228 626f 6f6c 290a  , glacier(bool).
+000118f0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
+00011900: 6520 7061 6769 6e61 746f 7220 746f 2068  e paginator to h
+00011910: 616e 646c 6520 6275 636b 6574 7320 7769  andle buckets wi
+00011920: 7468 206c 6172 6765 206e 756d 6265 7220  th large number 
+00011930: 6f66 206f 626a 6563 7473 0a20 2020 2020  of objects.     
+00011940: 2020 2020 2020 2070 6167 696e 6174 6f72         paginator
+00011950: 203d 2073 656c 662e 7333 5f63 6c69 656e   = self.s3_clien
+00011960: 742e 6765 745f 7061 6769 6e61 746f 7228  t.get_paginator(
+00011970: 276c 6973 745f 6f62 6a65 6374 735f 7632  'list_objects_v2
+00011980: 2729 0a20 2020 2020 2020 2020 2020 2066  ').            f
+00011990: 6f72 2070 6167 6520 696e 2070 6167 696e  or page in pagin
+000119a0: 6174 6f72 2e70 6167 696e 6174 6528 4275  ator.paginate(Bu
+000119b0: 636b 6574 3d62 7563 2c20 5072 6566 6978  cket=buc, Prefix
+000119c0: 3d70 7265 293a 0a20 2020 2020 2020 2020  =pre):.         
+000119d0: 2020 2020 2020 2069 6620 2243 6f6e 7465         if "Conte
+000119e0: 6e74 7322 2069 6e20 7061 6765 3a20 2023  nts" in page:  #
+000119f0: 2045 6e73 7572 6520 7468 6572 6520 6172   Ensure there ar
+00011a00: 6520 6f62 6a65 6374 7320 756e 6465 7220  e objects under 
+00011a10: 7468 6520 7370 6563 6966 6965 6420 7072  the specified pr
+00011a20: 6566 6978 0a20 2020 2020 2020 2020 2020  efix.           
+00011a30: 2020 2020 2020 2020 2066 6f72 206f 626a           for obj
+00011a40: 2069 6e20 7061 6765 5b27 436f 6e74 656e   in page['Conten
+00011a50: 7473 275d 3a0a 2020 2020 2020 2020 2020  ts']:.          
+00011a60: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+00011a70: 7920 3d20 6f62 6a5b 274b 6579 275d 0a20  y = obj['Key']. 
 00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a90: 2020 2066 696c 655f 7061 7468 203d 206f     file_path = o
-00011aa0: 732e 7061 7468 2e6a 6f69 6e28 666f 6c64  s.path.join(fold
-00011ab0: 6572 2c20 6629 0a20 2020 2020 2020 2020  er, f).         
-00011ac0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011ad0: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
-00011ae0: 2866 696c 655f 7061 7468 293a 0a20 2020  (file_path):.   
-00011af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011b10: 7365 6c66 2e5f 6368 6563 6b5f 7061 7468  self._check_path
-00011b20: 5f70 6572 6d69 7373 696f 6e73 2866 696c  _permissions(fil
-00011b30: 655f 7061 7468 293a 0a20 2020 2020 2020  e_path):.       
-00011b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b50: 2020 2020 2020 2020 2063 6f72 7265 6374           correct
-00011b60: 5f70 6572 6d69 7373 696f 6e73 203d 2046  _permissions = F
-00011b70: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
-00011b80: 2020 7265 7475 726e 2063 6f72 7265 6374    return correct
-00011b90: 5f70 6572 6d69 7373 696f 6e73 0a0a 2020  _permissions..  
-00011ba0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00011bb0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00011bc0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00011bd0: 0a0a 2020 2020 6465 6620 6765 745f 7573  ..    def get_us
-00011be0: 6572 5f68 6f74 7370 6f74 2873 656c 662c  er_hotspot(self,
-00011bf0: 2068 6f74 7370 6f74 5f63 7376 293a 0a20   hotspot_csv):. 
-00011c00: 2020 2020 2020 2027 2727 5265 6475 6365         '''Reduce
-00011c10: 2061 2068 6f74 7370 6f74 7320 6669 6c65   a hotspots file
-00011c20: 2074 6f20 7468 6520 666f 6c64 6572 7320   to the folders 
-00011c30: 7468 6174 2074 6865 2075 7365 7220 6861  that the user ha
-00011c40: 7320 7772 6974 6520 6163 6365 7373 2074  s write access t
-00011c50: 6f27 2727 0a20 2020 2020 2020 2074 7279  o'''.        try
-00011c60: 3a0a 2020 2020 2020 2020 2020 2020 6873  :.            hs
-00011c70: 6469 722c 2068 7366 696c 6520 3d20 6f73  dir, hsfile = os
-00011c80: 2e70 6174 682e 7370 6c69 7428 686f 7473  .path.split(hots
-00011c90: 706f 745f 6373 7629 0a20 2020 2020 2020  pot_csv).       
-00011ca0: 2020 2020 2068 7364 6972 7573 6572 203d       hsdiruser =
-00011cb0: 206f 732e 7061 7468 2e6a 6f69 6e28 6873   os.path.join(hs
-00011cc0: 6469 722c 2073 656c 662e 6366 672e 7768  dir, self.cfg.wh
-00011cd0: 6f61 6d69 290a 2020 2020 2020 2020 2020  oami).          
-00011ce0: 2020 6f73 2e6d 616b 6564 6972 7328 6873    os.makedirs(hs
-00011cf0: 6469 7275 7365 722c 2065 7869 7374 5f6f  diruser, exist_o
-00011d00: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
-00011d10: 3735 290a 2020 2020 2020 2020 2020 2020  75).            
-00011d20: 7573 6572 5f63 7376 203d 206f 732e 7061  user_csv = os.pa
-00011d30: 7468 2e6a 6f69 6e28 6873 6469 7275 7365  th.join(hsdiruse
-00011d40: 722c 2068 7366 696c 6529 0a20 2020 2020  r, hsfile).     
-00011d50: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00011d60: 682e 6578 6973 7473 2875 7365 725f 6373  h.exists(user_cs
-00011d70: 7629 3a0a 2020 2020 2020 2020 2020 2020  v):.            
-00011d80: 2020 2020 6966 206f 732e 7061 7468 2e67      if os.path.g
-00011d90: 6574 6d74 696d 6528 7573 6572 5f63 7376  etmtime(user_csv
-00011da0: 2920 3e20 6f73 2e70 6174 682e 6765 746d  ) > os.path.getm
-00011db0: 7469 6d65 2868 6f74 7370 6f74 5f63 7376  time(hotspot_csv
-00011dc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00011dd0: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-00011de0: 2246 696c 6520 7b75 7365 725f 6373 767d  "File {user_csv}
-00011df0: 2061 6c72 6561 6479 2065 7869 7374 7320   already exists 
-00011e00: 616e 6420 6973 206e 6577 6572 2074 6861  and is newer tha
-00011e10: 6e20 7b68 6f74 7370 6f74 5f63 7376 7d2e  n {hotspot_csv}.
-00011e20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011e30: 2020 2020 2020 2072 6574 7572 6e20 7573         return us
-00011e40: 6572 5f63 7376 0a20 2020 2020 2020 2020  er_csv.         
-00011e50: 2020 2070 7269 6e74 2827 4669 6c74 6572     print('Filter
-00011e60: 696e 6720 686f 7473 706f 7473 2066 6f72  ing hotspots for
-00011e70: 2066 6f6c 6465 7273 2077 6974 6820 7772   folders with wr
-00011e80: 6974 6520 7065 726d 6973 7369 6f6e 7320  ite permissions 
-00011e90: 2e2e 2e27 290a 2020 2020 2020 2020 2020  ...').          
-00011ea0: 2020 7772 6974 6162 6c65 5f66 6f6c 6465    writable_folde
-00011eb0: 7273 203d 205b 5d0a 2020 2020 2020 2020  rs = [].        
-00011ec0: 2020 2020 7769 7468 206f 7065 6e28 686f      with open(ho
-00011ed0: 7473 706f 745f 6373 762c 206d 6f64 653d  tspot_csv, mode=
-00011ee0: 2772 272c 206e 6577 6c69 6e65 3d27 2729  'r', newline='')
-00011ef0: 2061 7320 6669 6c65 3a0a 2020 2020 2020   as file:.      
-00011f00: 2020 2020 2020 2020 2020 7265 6164 6572            reader
-00011f10: 203d 2063 7376 2e44 6963 7452 6561 6465   = csv.DictReade
-00011f20: 7228 6669 6c65 290a 2020 2020 2020 2020  r(file).        
-00011f30: 2020 2020 2020 2020 6d79 6c65 6e20 3d20          mylen = 
-00011f40: 7375 6d28 3120 666f 7220 726f 7720 696e  sum(1 for row in
-00011f50: 2072 6561 6465 7229 0a20 2020 2020 2020   reader).       
-00011f60: 2020 2020 2020 2020 2066 696c 652e 7365           file.se
-00011f70: 656b 2830 290a 2020 2020 2020 2020 2020  ek(0).          
-00011f80: 2020 2020 2020 7265 6164 6572 203d 2063        reader = c
-00011f90: 7376 2e44 6963 7452 6561 6465 7228 6669  sv.DictReader(fi
-00011fa0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00011fb0: 2020 2020 7072 6f67 7265 7373 203d 2073      progress = s
-00011fc0: 656c 662e 5f63 7265 6174 655f 7072 6f67  elf._create_prog
-00011fd0: 7265 7373 5f62 6172 286d 796c 656e 2b31  ress_bar(mylen+1
-00011fe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011ff0: 2020 666f 7220 726f 7720 696e 2072 6561    for row in rea
-00012000: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00012010: 2020 2020 2020 2020 2072 6574 203d 2073           ret = s
-00012020: 656c 662e 7465 7374 5f77 7269 7465 2872  elf.test_write(r
-00012030: 6f77 5b27 466f 6c64 6572 275d 290a 2020  ow['Folder']).  
-00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012050: 2020 6966 2072 6574 2021 3d20 3133 2061    if ret != 13 a
-00012060: 6e64 2072 6574 2021 3d20 323a 0a20 2020  nd ret != 2:.   
-00012070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012080: 2020 2020 2077 7269 7461 626c 655f 666f       writable_fo
-00012090: 6c64 6572 732e 6170 7065 6e64 2872 6f77  lders.append(row
-000120a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000120b0: 2020 2020 2020 7072 6f67 7265 7373 2872        progress(r
-000120c0: 6561 6465 722e 6c69 6e65 5f6e 756d 290a  eader.line_num).
-000120d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000120e0: 206f 7065 6e28 7573 6572 5f63 7376 2c20   open(user_csv, 
-000120f0: 6d6f 6465 3d27 7727 2c20 6e65 776c 696e  mode='w', newlin
-00012100: 653d 2727 2920 6173 2066 696c 653a 0a20  e='') as file:. 
-00012110: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00012120: 7269 7465 7220 3d20 6373 762e 4469 6374  riter = csv.Dict
-00012130: 5772 6974 6572 2866 696c 652c 2066 6965  Writer(file, fie
-00012140: 6c64 6e61 6d65 733d 7265 6164 6572 2e66  ldnames=reader.f
-00012150: 6965 6c64 6e61 6d65 7329 0a20 2020 2020  ieldnames).     
-00012160: 2020 2020 2020 2020 2020 2077 7269 7465             write
-00012170: 722e 7772 6974 6568 6561 6465 7228 290a  r.writeheader().
-00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012190: 7772 6974 6572 2e77 7269 7465 726f 7773  writer.writerows
-000121a0: 2877 7269 7461 626c 655f 666f 6c64 6572  (writable_folder
-000121b0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-000121c0: 6574 7572 6e20 7573 6572 5f63 7376 0a20  eturn user_csv. 
-000121d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-000121e0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-000121f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00012200: 6622 5c6e 4572 726f 7220 696e 2067 6574  f"\nError in get
-00012210: 5f75 7365 725f 686f 7473 706f 743a 207b  _user_hotspot: {
-00012220: 657d 5c6e 2229 0a20 2020 2020 2020 2020  e}\n").         
-00012230: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
-00012240: 2020 2020 6465 6620 5f63 7265 6174 655f      def _create_
-00012250: 7072 6f67 7265 7373 5f62 6172 2873 656c  progress_bar(sel
-00012260: 662c 206d 6178 5f76 616c 7565 293a 0a20  f, max_value):. 
-00012270: 2020 2020 2020 2064 6566 2073 686f 775f         def show_
-00012280: 7072 6f67 7265 7373 5f62 6172 2869 7465  progress_bar(ite
-00012290: 7261 7469 6f6e 293a 0a20 2020 2020 2020  ration):.       
-000122a0: 2020 2020 2070 6572 6365 6e74 203d 2028       percent = (
-000122b0: 227b 303a 2e31 667d 2229 2e66 6f72 6d61  "{0:.1f}").forma
-000122c0: 7428 3130 3020 2a20 2869 7465 7261 7469  t(100 * (iterati
-000122d0: 6f6e 202f 2066 6c6f 6174 286d 6178 5f76  on / float(max_v
-000122e0: 616c 7565 2929 290a 2020 2020 2020 2020  alue))).        
-000122f0: 2020 2020 6c65 6e67 7468 203d 2035 3020      length = 50 
-00012300: 2023 2061 646a 7573 7420 6173 206e 6565   # adjust as nee
-00012310: 6465 6420 666f 7220 7468 6520 6261 7220  ded for the bar 
-00012320: 6c65 6e67 7468 0a20 2020 2020 2020 2020  length.         
-00012330: 2020 2066 696c 6c65 645f 6c65 6e67 7468     filled_length
-00012340: 203d 2069 6e74 286c 656e 6774 6820 2a20   = int(length * 
-00012350: 6974 6572 6174 696f 6e20 2f2f 206d 6178  iteration // max
-00012360: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
-00012370: 2020 2020 6261 7220 3d20 22e2 9688 2220      bar = "..." 
-00012380: 2a20 6669 6c6c 6564 5f6c 656e 6774 6820  * filled_length 
-00012390: 2b20 272d 2720 2a20 286c 656e 6774 6820  + '-' * (length 
-000123a0: 2d20 6669 6c6c 6564 5f6c 656e 6774 6829  - filled_length)
-000123b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000123c0: 7379 732e 7374 6469 6e2e 6973 6174 7479  sys.stdin.isatty
-000123d0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000123e0: 2020 2020 7072 696e 7428 6627 5c72 7c7b      print(f'\r|{
-000123f0: 6261 727d 7c20 7b70 6572 6365 6e74 7d25  bar}| {percent}%
-00012400: 272c 2065 6e64 3d27 5c72 2729 0a20 2020  ', end='\r').   
-00012410: 2020 2020 2020 2020 2069 6620 6974 6572           if iter
-00012420: 6174 696f 6e20 3d3d 206d 6178 5f76 616c  ation == max_val
-00012430: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00012440: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-00012450: 2020 2020 7265 7475 726e 2073 686f 775f      return show_
-00012460: 7072 6f67 7265 7373 5f62 6172 0a0a 2020  progress_bar..  
-00012470: 2020 6465 6620 7072 696e 745f 7061 7468    def print_path
-00012480: 735f 7277 5f69 6e66 6f28 7365 6c66 2c20  s_rw_info(self, 
-00012490: 7061 7468 7329 3a0a 0a20 2020 2020 2020  paths):..       
-000124a0: 2069 6620 6e6f 7420 7061 7468 733a 0a20   if not paths:. 
-000124b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000124c0: 2827 5c6e 4572 726f 723a 204e 6f20 6669  ('\nError: No fi
-000124d0: 6c65 2070 6174 6873 2070 726f 7669 6465  le paths provide
-000124e0: 642e 5c6e 272c 2066 696c 653d 7379 732e  d.\n', file=sys.
-000124f0: 7374 6465 7272 290a 2020 2020 2020 2020  stderr).        
-00012500: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00012510: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
-00012520: 7061 7468 733a 0a0a 2020 2020 2020 2020  paths:..        
-00012530: 2020 2020 2320 4368 6563 6b20 6966 2066      # Check if f
-00012540: 696c 6520 6578 6973 7473 0a20 2020 2020  ile exists.     
-00012550: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00012560: 2e70 6174 682e 6578 6973 7473 2870 6174  .path.exists(pat
-00012570: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00012580: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00012590: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-000125a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000125b0: 2047 6574 7469 6e67 2074 6865 2073 7461   Getting the sta
-000125c0: 7475 7320 6f66 2074 6865 2066 696c 650a  tus of the file.
-000125d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125e0: 6669 6c65 5f73 7461 7420 3d20 6f73 2e6c  file_stat = os.l
-000125f0: 7374 6174 2870 6174 6829 0a0a 2020 2020  stat(path)..    
-00012600: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-00012610: 7474 696e 6720 7468 6520 6375 7272 656e  tting the curren
-00012620: 7420 7573 6572 2061 6e64 2067 726f 7570  t user and group
-00012630: 2049 4473 0a20 2020 2020 2020 2020 2020   IDs.           
-00012640: 2020 2020 2063 7572 7265 6e74 5f75 6964       current_uid
-00012650: 203d 206f 732e 6765 7475 6964 2829 0a20   = os.getuid(). 
-00012660: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00012670: 7572 7265 6e74 5f67 6964 203d 206f 732e  urrent_gid = os.
-00012680: 6765 7467 6964 2829 0a0a 2020 2020 2020  getgid()..      
-00012690: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-000126a0: 6b69 6e67 2069 6620 7468 6520 7573 6572  king if the user
-000126b0: 2069 7320 7468 6520 6f77 6e65 720a 2020   is the owner.  
-000126c0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-000126d0: 5f6f 776e 6572 203d 2066 696c 655f 7374  _owner = file_st
-000126e0: 6174 2e73 745f 7569 6420 3d3d 2063 7572  at.st_uid == cur
-000126f0: 7265 6e74 5f75 6964 0a0a 2020 2020 2020  rent_uid..      
-00012700: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00012710: 6b69 6e67 2069 6620 7468 6520 7573 6572  king if the user
-00012720: 2069 7320 696e 2074 6865 2066 696c 6527   is in the file'
-00012730: 7320 6772 6f75 700a 2020 2020 2020 2020  s group.        
-00012740: 2020 2020 2020 2020 6973 5f67 726f 7570          is_group
-00012750: 5f6d 656d 6265 7220 3d20 6669 6c65 5f73  _member = file_s
-00012760: 7461 742e 7374 5f67 6964 203d 3d20 6375  tat.st_gid == cu
-00012770: 7272 656e 745f 6769 6420 6f72 205c 0a20  rrent_gid or \. 
+00011a90: 2020 2020 2020 2069 6620 7265 6375 7220         if recur 
+00011aa0: 6f72 2028 6b65 792e 636f 756e 7428 272f  or (key.count('/
+00011ab0: 2729 203d 3d20 7072 652e 636f 756e 7428  ') == pre.count(
+00011ac0: 272f 2729 2061 6e64 206b 6579 2e73 7461  '/') and key.sta
+00011ad0: 7274 7377 6974 6828 7072 6529 293a 0a20  rtswith(pre)):. 
+00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011af0: 2020 2020 2020 2020 2020 2074 6f74 616c             total
+00011b00: 5f73 697a 655f 6279 7465 7320 2b3d 206f  _size_bytes += o
+00011b10: 626a 5b27 5369 7a65 275d 0a0a 2020 2020  bj['Size']..    
+00011b20: 2020 2020 746f 7461 6c5f 7369 7a65 5f67      total_size_g
+00011b30: 6962 203d 2074 6f74 616c 5f73 697a 655f  ib = total_size_
+00011b40: 6279 7465 7320 2f20 2831 3032 3420 2a2a  bytes / (1024 **
+00011b50: 2033 2920 2023 2043 6f6e 7665 7274 2062   3)  # Convert b
+00011b60: 7974 6573 2074 6f20 4769 420a 2020 2020  ytes to GiB.    
+00011b70: 2020 2020 7265 7475 726e 2074 6f74 616c      return total
+00011b80: 5f73 697a 655f 6769 620a 0a20 2020 2064  _size_gib..    d
+00011b90: 6566 2077 6169 745f 666f 725f 7373 685f  ef wait_for_ssh_
+00011ba0: 7265 6164 7928 7365 6c66 2c20 686f 7374  ready(self, host
+00011bb0: 6e61 6d65 2c20 706f 7274 3d32 322c 2074  name, port=22, t
+00011bc0: 696d 656f 7574 3d36 3029 3a0a 2020 2020  imeout=60):.    
+00011bd0: 2020 2020 7374 6172 745f 7469 6d65 203d      start_time =
+00011be0: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
+00011bf0: 2020 2020 2077 6869 6c65 2074 696d 652e       while time.
+00011c00: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
+00011c10: 696d 6520 3c20 7469 6d65 6f75 743a 0a20  ime < timeout:. 
+00011c20: 2020 2020 2020 2020 2020 2073 203d 2073             s = s
+00011c30: 6f63 6b65 742e 736f 636b 6574 2873 6f63  ocket.socket(soc
+00011c40: 6b65 742e 4146 5f49 4e45 542c 2073 6f63  ket.AF_INET, soc
+00011c50: 6b65 742e 534f 434b 5f53 5452 4541 4d29  ket.SOCK_STREAM)
+00011c60: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
+00011c70: 6574 7469 6d65 6f75 7428 3329 2020 2320  ettimeout(3)  # 
+00011c80: 5365 7420 6120 7469 6d65 6f75 7420 6f6e  Set a timeout on
+00011c90: 2074 6865 2073 6f63 6b65 7420 6f70 6572   the socket oper
+00011ca0: 6174 696f 6e73 0a20 2020 2020 2020 2020  ations.         
+00011cb0: 2020 2072 6573 756c 7420 3d20 732e 636f     result = s.co
+00011cc0: 6e6e 6563 745f 6578 2828 686f 7374 6e61  nnect_ex((hostna
+00011cd0: 6d65 2c20 706f 7274 2929 0a20 2020 2020  me, port)).     
+00011ce0: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
+00011cf0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00011d00: 2020 2020 2020 2073 2e63 6c6f 7365 2829         s.close()
+00011d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d20: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00011d30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00011d50: 696d 652e 736c 6565 7028 3529 2020 2320  ime.sleep(5)  # 
+00011d60: 5761 6974 2066 6f72 2035 2073 6563 6f6e  Wait for 5 secon
+00011d70: 6473 2062 6566 6f72 6520 7265 7472 7969  ds before retryi
+00011d80: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+00011d90: 2020 2073 2e63 6c6f 7365 2829 0a20 2020     s.close().   
+00011da0: 2020 2020 2070 7269 6e74 2822 5469 6d65       print("Time
+00011db0: 6f75 7420 7265 6163 6865 6420 7769 7468  out reached with
+00011dc0: 6f75 7420 5353 4820 7365 7276 6572 2062  out SSH server b
+00011dd0: 6569 6e67 2072 6561 6479 2e22 290a 2020  eing ready.").  
+00011de0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00011df0: 7365 0a0a 2020 2020 6465 6620 6563 325f  se..    def ec2_
+00011e00: 6465 706c 6f79 2873 656c 662c 2066 6f6c  deploy(self, fol
+00011e10: 6465 7273 2c20 7333 7369 7a65 3d4e 6f74  ders, s3size=Not
+00011e20: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+00011e30: 293a 0a0a 2020 2020 2020 2020 6966 2073  ):..        if s
+00011e40: 3373 697a 6520 213d 2030 3a0a 2020 2020  3size != 0:.    
+00011e50: 2020 2020 2020 2020 7333 7369 7a65 203d          s3size =
+00011e60: 2073 656c 662e 5f67 6574 5f73 335f 6461   self._get_s3_da
+00011e70: 7461 5f73 697a 6528 666f 6c64 6572 7329  ta_size(folders)
+00011e80: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+00011e90: 2254 6f74 616c 2064 6174 6120 696e 2061  "Total data in a
+00011ea0: 6c6c 2066 6f6c 6465 7273 3a20 7b73 3373  ll folders: {s3s
+00011eb0: 697a 653a 2e32 667d 2047 6942 2229 0a20  ize:.2f} GiB"). 
+00011ec0: 2020 2020 2020 2070 726f 6620 3d20 7365         prof = se
+00011ed0: 6c66 2e5f 6563 325f 6372 6561 7465 5f69  lf._ec2_create_i
+00011ee0: 616d 5f70 6f6c 6963 795f 726f 6c65 735f  am_policy_roles_
+00011ef0: 6563 3270 726f 6669 6c65 2829 0a20 2020  ec2profile().   
+00011f00: 2020 2020 2069 6964 2c20 6970 203d 2073       iid, ip = s
+00011f10: 656c 662e 5f65 6332 5f63 7265 6174 655f  elf._ec2_create_
+00011f20: 696e 7374 616e 6365 2873 3373 697a 652c  instance(s3size,
+00011f30: 2070 726f 6629 0a20 2020 2020 2020 2070   prof).        p
+00011f40: 7269 6e74 2827 2057 6169 7469 6e67 2066  rint(' Waiting f
+00011f50: 6f72 2073 7368 2068 6f73 7420 746f 2062  or ssh host to b
+00011f60: 6563 6f6d 6520 7265 6164 7920 2e2e 2e27  ecome ready ...'
+00011f70: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00011f80: 2073 656c 662e 7761 6974 5f66 6f72 5f73   self.wait_for_s
+00011f90: 7368 5f72 6561 6479 2869 7029 3a0a 2020  sh_ready(ip):.  
+00011fa0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011fb0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+00011fc0: 626f 6f74 7374 7261 705f 7265 7374 6f72  bootstrap_restor
+00011fd0: 6520 3d20 7365 6c66 2e5f 6563 325f 7573  e = self._ec2_us
+00011fe0: 6572 5f73 7061 6365 5f73 6372 6970 7428  er_space_script(
+00011ff0: 6969 6429 0a0a 2020 2020 2020 2020 2320  iid)..        # 
+00012000: 7061 7274 2032 2c20 7072 6570 2072 6573  part 2, prep res
+00012010: 746f 7269 6e67 202e 2e2e 2e2e 0a20 2020  toring ......   
+00012020: 2020 2020 2066 6f72 2066 6f6c 6465 7220       for folder 
+00012030: 696e 2073 656c 662e 6172 6773 2e66 6f6c  in self.args.fol
+00012040: 6465 7273 3a0a 2020 2020 2020 2020 2020  ders:.          
+00012050: 2020 7265 666f 6c64 6572 203d 206f 732e    refolder = os.
+00012060: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
+00012070: 682e 7365 702c 2027 7265 7374 6f72 6564  h.sep, 'restored
+00012080: 272c 2066 6f6c 6465 725b 313a 5d29 0a20  ', folder[1:]). 
+00012090: 2020 2020 2020 2020 2020 2062 6f6f 7473             boots
+000120a0: 7472 6170 5f72 6573 746f 7265 202b 3d20  trap_restore += 
+000120b0: 6627 5c6e 6d6b 6469 7220 2d70 2022 7b72  f'\nmkdir -p "{r
+000120c0: 6566 6f6c 6465 727d 2227 0a20 2020 2020  efolder}"'.     
+000120d0: 2020 2020 2020 2062 6f6f 7473 7472 6170         bootstrap
+000120e0: 5f72 6573 746f 7265 202b 3d20 6627 5c6e  _restore += f'\n
+000120f0: 6c6e 202d 7320 227b 7265 666f 6c64 6572  ln -s "{refolder
+00012100: 7d22 207e 2f72 6573 746f 7265 642d 2428  }" ~/restored-$(
+00012110: 6261 7365 6e61 6d65 2022 7b66 6f6c 6465  basename "{folde
+00012120: 727d 2229 270a 2020 2020 2020 2020 2020  r}")'.          
+00012130: 2020 626f 6f74 7374 7261 705f 7265 7374    bootstrap_rest
+00012140: 6f72 6520 2b3d 2066 275c 6e73 7564 6f20  ore += f'\nsudo 
+00012150: 6d6b 6469 7220 2d70 2024 2864 6972 6e61  mkdir -p $(dirna
+00012160: 6d65 2022 7b66 6f6c 6465 727d 2229 270a  me "{folder}")'.
+00012170: 2020 2020 2020 2020 2020 2020 626f 6f74              boot
+00012180: 7374 7261 705f 7265 7374 6f72 6520 2b3d  strap_restore +=
+00012190: 2066 275c 6e73 7564 6f20 6368 6f77 6e20   f'\nsudo chown 
+000121a0: 6563 322d 7573 6572 2024 2864 6972 6e61  ec2-user $(dirna
+000121b0: 6d65 2022 7b66 6f6c 6465 727d 2229 270a  me "{folder}")'.
+000121c0: 2020 2020 2020 2020 2020 2020 626f 6f74              boot
+000121d0: 7374 7261 705f 7265 7374 6f72 6520 2b3d  strap_restore +=
+000121e0: 2066 275c 6e6c 6e20 2d73 2022 7b72 6566   f'\nln -s "{ref
+000121f0: 6f6c 6465 727d 2220 227b 666f 6c64 6572  older}" "{folder
+00012200: 7d22 270a 0a20 2020 2020 2020 2023 2074  }"'..        # t
+00012210: 6869 7320 626c 6f63 6b20 6d61 7920 6e65  his block may ne
+00012220: 6564 2074 6f20 6265 206d 6f76 6564 2074  ed to be moved t
+00012230: 6f20 6120 6675 6e63 7469 6f6e 0a20 2020  o a function.   
+00012240: 2020 2020 2061 7267 6c20 3d20 5b27 2d2d       argl = ['--
+00012250: 6177 7327 2c20 272d 6127 5d0a 2020 2020  aws', '-a'].    
+00012260: 2020 2020 636d 646c 6973 7420 3d20 5b69      cmdlist = [i
+00012270: 7465 6d20 666f 7220 6974 656d 2069 6e20  tem for item in 
+00012280: 7379 732e 6172 6776 2069 6620 6974 656d  sys.argv if item
+00012290: 206e 6f74 2069 6e20 6172 676c 5d0a 2020   not in argl].  
+000122a0: 2020 2020 2020 6172 676c 203d 205b 272d        argl = ['-
+000122b0: 2d69 6e73 7461 6e63 652d 7479 7065 272c  -instance-type',
+000122c0: 2027 2d69 275d 2020 2320 6966 2066 6f75   '-i']  # if fou
+000122d0: 6e64 2072 656d 6f76 6520 6f70 7469 6f6e  nd remove option
+000122e0: 2061 6e64 206e 6578 7420 6172 670a 2020   and next arg.  
+000122f0: 2020 2020 2020 636d 646c 6973 7420 3d20        cmdlist = 
+00012300: 5b78 2066 6f72 2069 2c20 7820 696e 2065  [x for i, x in e
+00012310: 6e75 6d65 7261 7465 2863 6d64 6c69 7374  numerate(cmdlist
+00012320: 2920 6966 2078 0a20 2020 2020 2020 2020  ) if x.         
+00012330: 2020 2020 2020 2020 2020 6e6f 7420 696e            not in
+00012340: 2061 7267 6c20 616e 6420 2869 203d 3d20   argl and (i == 
+00012350: 3020 6f72 2063 6d64 6c69 7374 5b69 2d31  0 or cmdlist[i-1
+00012360: 5d20 6e6f 7420 696e 2061 7267 6c29 5d0a  ] not in argl)].
+00012370: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
+00012380: 2d2d 7072 6f66 696c 6527 2069 6e20 636d  --profile' in cm
+00012390: 646c 6973 7420 616e 6420 7365 6c66 2e61  dlist and self.a
+000123a0: 7267 732e 6177 735f 7072 6f66 696c 653a  rgs.aws_profile:
+000123b0: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+000123c0: 6c69 7374 2e69 6e73 6572 7428 312c 2027  list.insert(1, '
+000123d0: 2d2d 7072 6f66 696c 6527 290a 2020 2020  --profile').    
+000123e0: 2020 2020 2020 2020 636d 646c 6973 742e          cmdlist.
+000123f0: 696e 7365 7274 2832 2c20 7365 6c66 2e61  insert(2, self.a
+00012400: 7267 732e 6177 735f 7072 6f66 696c 6529  rgs.aws_profile)
+00012410: 0a20 2020 2020 2020 2063 6d64 6c69 6e65  .        cmdline
+00012420: 203d 2027 6672 6f73 7465 7220 2720 2b20   = 'froster ' + 
+00012430: 5c0a 2020 2020 2020 2020 2020 2020 2220  \.            " 
+00012440: 222e 6a6f 696e 286d 6170 2873 686c 6578  ".join(map(shlex
+00012450: 2e71 756f 7465 2c20 636d 646c 6973 745b  .quote, cmdlist[
+00012460: 313a 5d29 2920 2023 206f 7269 6769 6e61  1:]))  # origina
+00012470: 6c20 636d 646c 696e 650a 2020 2020 2020  l cmdline.      
+00012480: 2020 6966 206e 6f74 2073 656c 662e 6172    if not self.ar
+00012490: 6773 2e66 6f6c 6465 7273 5b30 5d20 696e  gs.folders[0] in
+000124a0: 2063 6d64 6c69 6e65 3a0a 2020 2020 2020   cmdline:.      
+000124b0: 2020 2020 2020 666f 6c64 6572 7320 3d20        folders = 
+000124c0: 2722 2022 272e 6a6f 696e 2873 656c 662e  '" "'.join(self.
+000124d0: 6172 6773 2e66 6f6c 6465 7273 290a 2020  args.folders).  
+000124e0: 2020 2020 2020 2020 2020 636d 646c 696e            cmdlin
+000124f0: 6520 3d20 6627 7b63 6d64 6c69 6e65 7d20  e = f'{cmdline} 
+00012500: 227b 666f 6c64 6572 737d 2227 0a20 2020  "{folders}"'.   
+00012510: 2020 2020 2023 2065 6e64 2062 6c6f 636b       # end block
+00012520: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00012530: 6622 2077 696c 6c20 6578 6563 7574 6520  f" will execute 
+00012540: 277b 636d 646c 696e 657d 2720 6f6e 207b  '{cmdline}' on {
+00012550: 6970 7d20 2e2e 2e20 2229 0a20 2020 2020  ip} ... ").     
+00012560: 2020 2062 6f6f 7473 7472 6170 5f72 6573     bootstrap_res
+00012570: 746f 7265 202b 3d20 275c 6e27 202b 2063  tore += '\n' + c
+00012580: 6d64 6c69 6e65 0a20 2020 2020 2020 2023  mdline.        #
+00012590: 206f 6e63 6520 7265 7472 6965 7665 6420   once retrieved 
+000125a0: 6672 6f6d 2047 6c61 6369 6572 2077 6520  from Glacier we 
+000125b0: 6e65 6564 2074 6f20 7265 7374 6f72 6520  need to restore 
+000125c0: 7468 6973 2035 2061 6e64 2031 3220 686f  this 5 and 12 ho
+000125d0: 7572 7320 6672 6f6d 206e 6f77 0a20 2020  urs from now.   
+000125e0: 2020 2020 2062 6f6f 7473 7472 6170 5f72       bootstrap_r
+000125f0: 6573 746f 7265 202b 3d20 275c 6e27 202b  estore += '\n' +
+00012600: 2066 2265 6368 6f20 277b 636d 646c 696e   f"echo '{cmdlin
+00012610: 657d 2720 7c20 6174 206e 6f77 202b 2035  e}' | at now + 5
+00012620: 2068 6f75 7273 220a 2020 2020 2020 2020   hours".        
+00012630: 626f 6f74 7374 7261 705f 7265 7374 6f72  bootstrap_restor
+00012640: 6520 2b3d 2027 5c6e 2720 2b20 6622 6563  e += '\n' + f"ec
+00012650: 686f 2027 7b63 6d64 6c69 6e65 7d27 207c  ho '{cmdline}' |
+00012660: 2061 7420 6e6f 7720 2b20 3132 2068 6f75   at now + 12 hou
+00012670: 7273 220a 2020 2020 2020 2020 7265 7420  rs".        ret 
+00012680: 3d20 7365 6c66 2e73 7368 5f75 706c 6f61  = self.ssh_uploa
+00012690: 6428 2765 6332 2d75 7365 7227 2c20 6970  d('ec2-user', ip
+000126a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126c0: 626f 6f74 7374 7261 705f 7265 7374 6f72  bootstrap_restor
+000126d0: 652c 2022 626f 6f74 7374 7261 702e 7368  e, "bootstrap.sh
+000126e0: 222c 2069 735f 7374 7269 6e67 3d54 7275  ", is_string=Tru
+000126f0: 6529 0a20 2020 2020 2020 2069 6620 7265  e).        if re
+00012700: 742e 7374 646f 7574 206f 7220 7265 742e  t.stdout or ret.
+00012710: 7374 6465 7272 3a0a 2020 2020 2020 2020  stderr:.        
+00012720: 2020 2020 7072 696e 7428 7265 742e 7374      print(ret.st
+00012730: 646f 7574 2c20 7265 742e 7374 6465 7272  dout, ret.stderr
+00012740: 290a 2020 2020 2020 2020 7265 7420 3d20  ).        ret = 
+00012750: 7365 6c66 2e73 7368 5f65 7865 6375 7465  self.ssh_execute
+00012760: 2827 6563 322d 7573 6572 272c 2069 702c  ('ec2-user', ip,
+00012770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00012780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012790: 2020 2061 6e79 2867 7270 2e67 6574 6772     any(grp.getgr
-000127a0: 6769 6428 6729 2e67 725f 6769 6420 3d3d  gid(g).gr_gid ==
-000127b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000127c0: 2020 2020 2020 2020 2066 696c 655f 7374           file_st
-000127d0: 6174 2e73 745f 6769 6420 666f 7220 6720  at.st_gid for g 
-000127e0: 696e 206f 732e 6765 7467 726f 7570 7328  in os.getgroups(
-000127f0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00012800: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00012810: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00012820: 2020 2020 2020 2070 7269 6e74 5f65 7272         print_err
-00012830: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
-00012840: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00012850: 2020 2020 2020 2020 2023 2045 7874 7261           # Extra
-00012860: 6374 696e 6720 7065 726d 6973 7369 6f6e  cting permission
-00012870: 2062 6974 730a 2020 2020 2020 2020 2020   bits.          
-00012880: 2020 7065 726d 6973 7369 6f6e 7320 3d20    permissions = 
-00012890: 6669 6c65 5f73 7461 742e 7374 5f6d 6f64  file_stat.st_mod
-000128a0: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
-000128b0: 2043 6865 636b 696e 6720 666f 7220 6f77   Checking for ow
-000128c0: 6e65 7220 7265 6164 2070 6572 6d69 7373  ner read permiss
-000128d0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-000128e0: 6861 735f 6f77 6e65 725f 7265 6164 5f70  has_owner_read_p
-000128f0: 6572 6d69 7373 696f 6e20 3d20 626f 6f6c  ermission = bool
-00012900: 2870 6572 6d69 7373 696f 6e73 2026 2073  (permissions & s
-00012910: 7461 742e 535f 4952 5553 5229 0a0a 2020  tat.S_IRUSR)..  
-00012920: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00012930: 6b69 6e67 2066 6f72 2067 726f 7570 2072  king for group r
-00012940: 6561 6420 7065 726d 6973 7369 6f6e 0a20  ead permission. 
-00012950: 2020 2020 2020 2020 2020 2068 6173 5f67             has_g
-00012960: 726f 7570 5f72 6561 645f 7065 726d 6973  roup_read_permis
-00012970: 7369 6f6e 203d 2062 6f6f 6c28 7065 726d  sion = bool(perm
-00012980: 6973 7369 6f6e 7320 2620 7374 6174 2e53  issions & stat.S
-00012990: 5f49 5247 5250 290a 0a20 2020 2020 2020  _IRGRP)..       
-000129a0: 2020 2020 2023 2043 6865 636b 696e 6720       # Checking 
-000129b0: 666f 7220 2734 3434 2720 2872 6561 6420  for '444' (read 
-000129c0: 7065 726d 6973 7369 6f6e 2066 6f72 2065  permission for e
-000129d0: 7665 7279 6f6e 6529 0a20 2020 2020 2020  veryone).       
-000129e0: 2020 2020 2069 735f 3434 3420 3d20 7065       is_444 = pe
-000129f0: 726d 6973 7369 6f6e 7320 2620 306f 3434  rmissions & 0o44
-00012a00: 3420 3d3d 2030 6f34 3434 0a0a 2020 2020  4 == 0o444..    
-00012a10: 2020 2020 2020 2020 2320 4465 7465 726d          # Determ
-00012a20: 696e 696e 6720 6966 2074 6865 2075 7365  ining if the use
-00012a30: 7220 6361 6e20 7265 6164 2074 6865 2066  r can read the f
-00012a40: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-00012a50: 6361 6e5f 7265 6164 203d 2028 6973 5f6f  can_read = (is_o
-00012a60: 776e 6572 2061 6e64 2068 6173 5f6f 776e  wner and has_own
-00012a70: 6572 5f72 6561 645f 7065 726d 6973 7369  er_read_permissi
-00012a80: 6f6e 2920 6f72 205c 0a20 2020 2020 2020  on) or \.       
-00012a90: 2020 2020 2020 2020 2028 6973 5f67 726f           (is_gro
-00012aa0: 7570 5f6d 656d 6265 7220 616e 6420 6861  up_member and ha
-00012ab0: 735f 6772 6f75 705f 7265 6164 5f70 6572  s_group_read_per
-00012ac0: 6d69 7373 696f 6e29 206f 7220 5c0a 2020  mission) or \.  
-00012ad0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00012ae0: 5f34 3434 0a0a 2020 2020 2020 2020 2020  _444..          
-00012af0: 2020 2320 4368 6563 6b69 6e67 2066 6f72    # Checking for
-00012b00: 206f 776e 6572 2077 7269 7465 2070 6572   owner write per
-00012b10: 6d69 7373 696f 6e0a 2020 2020 2020 2020  mission.        
-00012b20: 2020 2020 6861 735f 6f77 6e65 725f 7772      has_owner_wr
-00012b30: 6974 655f 7065 726d 6973 7369 6f6e 203d  ite_permission =
-00012b40: 2062 6f6f 6c28 7065 726d 6973 7369 6f6e   bool(permission
-00012b50: 7320 2620 7374 6174 2e53 5f49 5755 5352  s & stat.S_IWUSR
-00012b60: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00012b70: 2043 6865 636b 696e 6720 666f 7220 6772   Checking for gr
-00012b80: 6f75 7020 7772 6974 6520 7065 726d 6973  oup write permis
-00012b90: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
-00012ba0: 2068 6173 5f67 726f 7570 5f77 7269 7465   has_group_write
-00012bb0: 5f70 6572 6d69 7373 696f 6e20 3d20 626f  _permission = bo
-00012bc0: 6f6c 2870 6572 6d69 7373 696f 6e73 2026  ol(permissions &
-00012bd0: 2073 7461 742e 535f 4957 4752 5029 0a0a   stat.S_IWGRP)..
-00012be0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-00012bf0: 6563 6b69 6e67 2066 6f72 2027 3636 3627  ecking for '666'
-00012c00: 206f 7220 2737 3737 2720 7065 726d 6973   or '777' permis
-00012c10: 7369 6f6e 730a 2020 2020 2020 2020 2020  sions.          
-00012c20: 2020 6973 5f36 3636 5f6f 725f 3737 3720    is_666_or_777 
-00012c30: 3d20 7065 726d 6973 7369 6f6e 7320 2620  = permissions & 
-00012c40: 306f 3636 3620 3d3d 2030 6f36 3636 206f  0o666 == 0o666 o
-00012c50: 7220 7065 726d 6973 7369 6f6e 7320 2620  r permissions & 
-00012c60: 306f 3737 3720 3d3d 2030 6f37 3737 0a0a  0o777 == 0o777..
-00012c70: 2020 2020 2020 2020 2020 2020 2320 4465              # De
-00012c80: 7465 726d 696e 696e 6720 6966 2074 6865  termining if the
-00012c90: 2075 7365 7220 6361 6e20 6465 6c65 7465   user can delete
-00012ca0: 2074 6865 2066 696c 650a 2020 2020 2020   the file.      
-00012cb0: 2020 2020 2020 6361 6e5f 7772 6974 6520        can_write 
-00012cc0: 3d20 2869 735f 6f77 6e65 7220 616e 6420  = (is_owner and 
-00012cd0: 6861 735f 6f77 6e65 725f 7772 6974 655f  has_owner_write_
-00012ce0: 7065 726d 6973 7369 6f6e 2920 6f72 205c  permission) or \
-00012cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d00: 2020 2020 2020 2020 2028 6973 5f67 726f           (is_gro
-00012d10: 7570 5f6d 656d 6265 7220 616e 6420 6861  up_member and ha
-00012d20: 735f 6772 6f75 705f 7772 6974 655f 7065  s_group_write_pe
-00012d30: 726d 6973 7369 6f6e 2920 6f72 205c 0a20  rmission) or \. 
-00012d40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012d50: 735f 3636 365f 6f72 5f37 3737 0a0a 2020  s_666_or_777..  
-00012d60: 2020 2020 2020 2020 2020 2320 5072 696e            # Prin
-00012d70: 7469 6e67 2074 6865 2066 696c 6527 7320  ting the file's 
-00012d80: 7065 726d 6973 7369 6f6e 730a 2020 2020  permissions.    
-00012d90: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-00012da0: 5c6e 4669 6c65 3a20 7b70 6174 687d 2729  \nFile: {path}')
-00012db0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00012dc0: 6e74 2866 275c 6e69 735f 6f77 6e65 723a  nt(f'\nis_owner:
-00012dd0: 207b 6973 5f6f 776e 6572 7d27 290a 2020   {is_owner}').  
-00012de0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00012df0: 6627 6861 735f 6f77 6e65 725f 7265 6164  f'has_owner_read
-00012e00: 5f70 6572 6d69 7373 696f 6e3a 207b 6861  _permission: {ha
-00012e10: 735f 6f77 6e65 725f 7265 6164 5f70 6572  s_owner_read_per
-00012e20: 6d69 7373 696f 6e7d 2729 0a20 2020 2020  mission}').     
-00012e30: 2020 2020 2020 2070 7269 6e74 2866 2768         print(f'h
-00012e40: 6173 5f6f 776e 6572 5f77 7269 7465 5f70  as_owner_write_p
-00012e50: 6572 6d69 7373 696f 6e3a 207b 6861 735f  ermission: {has_
-00012e60: 6f77 6e65 725f 7772 6974 655f 7065 726d  owner_write_perm
-00012e70: 6973 7369 6f6e 7d27 290a 2020 2020 2020  ission}').      
-00012e80: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
-00012e90: 6973 5f67 726f 7570 5f6d 656d 6265 723a  is_group_member:
-00012ea0: 207b 6973 5f67 726f 7570 5f6d 656d 6265   {is_group_membe
-00012eb0: 727d 2729 0a20 2020 2020 2020 2020 2020  r}').           
-00012ec0: 2070 7269 6e74 2866 2768 6173 5f67 726f   print(f'has_gro
-00012ed0: 7570 5f72 6561 645f 7065 726d 6973 7369  up_read_permissi
-00012ee0: 6f6e 3a20 7b68 6173 5f67 726f 7570 5f72  on: {has_group_r
-00012ef0: 6561 645f 7065 726d 6973 7369 6f6e 7d27  ead_permission}'
-00012f00: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00012f10: 696e 7428 6627 6861 735f 6772 6f75 705f  int(f'has_group_
-00012f20: 7772 6974 655f 7065 726d 6973 7369 6f6e  write_permission
-00012f30: 3a20 7b68 6173 5f67 726f 7570 5f77 7269  : {has_group_wri
-00012f40: 7465 5f70 6572 6d69 7373 696f 6e7d 2729  te_permission}')
-00012f50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00012f60: 6e74 2866 275c 6e69 735f 3434 343a 207b  nt(f'\nis_444: {
-00012f70: 6973 5f34 3434 7d27 290a 2020 2020 2020  is_444}').      
-00012f80: 2020 2020 2020 7072 696e 7428 6627 6973        print(f'is
-00012f90: 5f36 3636 5f6f 725f 3737 373a 207b 6973  _666_or_777: {is
-00012fa0: 5f36 3636 5f6f 725f 3737 377d 2729 0a20  _666_or_777}'). 
-00012fb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012fc0: 2866 275c 6e63 616e 5f72 6561 643a 207b  (f'\ncan_read: {
-00012fd0: 6361 6e5f 7265 6164 7d27 290a 2020 2020  can_read}').    
-00012fe0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-00012ff0: 6361 6e5f 7772 6974 653a 207b 6361 6e5f  can_write: {can_
-00013000: 7772 6974 657d 5c6e 2729 0a0a 2020 2020  write}\n')..    
-00013010: 6465 6620 5f67 656e 5f6d 6435 7375 6d73  def _gen_md5sums
-00013020: 2873 656c 662c 2064 6972 6563 746f 7279  (self, directory
-00013030: 2c20 6861 7368 5f66 696c 6529 3a0a 2020  , hash_file):.  
-00013040: 2020 2020 2020 2727 2747 656e 6572 6174        '''Generat
-00013050: 6520 6d64 3573 756d 7320 666f 7220 616c  e md5sums for al
-00013060: 6c20 6669 6c65 7320 696e 2074 6865 2064  l files in the d
-00013070: 6972 6563 746f 7279 2061 6e64 2077 7269  irectory and wri
-00013080: 7465 2074 6865 6d20 746f 2061 2068 6173  te them to a has
-00013090: 6820 6669 6c65 2727 270a 0a20 2020 2020  h file'''..     
-000130a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000130b0: 2020 2020 666f 7220 726f 6f74 2c20 6469      for root, di
-000130c0: 7273 2c20 6669 6c65 7320 696e 2073 656c  rs, files in sel
-000130d0: 662e 5f77 616c 6b65 7228 6469 7265 6374  f._walker(direct
-000130e0: 6f72 7929 3a0a 0a20 2020 2020 2020 2020  ory):..         
-000130f0: 2020 2020 2020 2023 2057 6520 6f6e 6c79         # We only
-00013100: 2077 616e 7420 746f 2067 656e 6572 6174   want to generat
-00013110: 6520 7468 6520 6861 7368 2066 696c 6520  e the hash file 
-00013120: 696e 2074 6865 2072 6f6f 7420 6469 7265  in the root dire
-00013130: 6374 6f72 792e 2041 766f 6964 2072 6563  ctory. Avoid rec
-00013140: 7572 7369 6f6e 0a20 2020 2020 2020 2020  ursion.         
-00013150: 2020 2020 2020 2069 6620 726f 6f74 2021         if root !
-00013160: 3d20 6469 7265 6374 6f72 793a 0a20 2020  = directory:.   
-00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013180: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-00013190: 2020 2020 2020 2020 2320 4275 696c 6420          # Build 
-000131a0: 7468 6520 7061 7468 2074 6f20 7468 6520  the path to the 
-000131b0: 6861 7368 2066 696c 650a 2020 2020 2020  hash file.      
-000131c0: 2020 2020 2020 2020 2020 6861 7368 7061            hashpa
-000131d0: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-000131e0: 6e28 726f 6f74 2c20 6861 7368 5f66 696c  n(root, hash_fil
-000131f0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00013200: 2020 2020 2320 5365 7420 7468 6520 6e75      # Set the nu
-00013210: 6d62 6572 206f 6620 776f 726b 6572 730a  mber of workers.
-00013220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013230: 6d61 785f 776f 726b 6572 7320 3d20 6d61  max_workers = ma
-00013240: 7828 342c 2069 6e74 2873 656c 662e 6172  x(4, int(self.ar
-00013250: 6773 2e63 6f72 6573 2929 0a0a 2020 2020  gs.cores))..    
-00013260: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00013270: 206f 7065 6e28 6861 7368 7061 7468 2c20   open(hashpath, 
-00013280: 2277 2229 2061 7320 6f75 745f 663a 0a20  "w") as out_f:. 
-00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132a0: 2020 2077 6974 6820 636f 6e63 7572 7265     with concurre
-000132b0: 6e74 2e66 7574 7572 6573 2e54 6872 6561  nt.futures.Threa
-000132c0: 6450 6f6f 6c45 7865 6375 746f 7228 6d61  dPoolExecutor(ma
-000132d0: 785f 776f 726b 6572 733d 6d61 785f 776f  x_workers=max_wo
-000132e0: 726b 6572 7329 2061 7320 6578 6563 7574  rkers) as execut
-000132f0: 6f72 3a0a 0a20 2020 2020 2020 2020 2020  or:..           
-00013300: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-00013310: 6b73 203d 207b 7d0a 0a20 2020 2020 2020  ks = {}..       
-00013320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013330: 2066 6f72 2066 696c 6520 696e 2066 696c   for file in fil
-00013340: 6573 3a0a 0a20 2020 2020 2020 2020 2020  es:..           
-00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013360: 2023 2047 6574 2074 6865 2066 696c 6520   # Get the file 
-00013370: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
-00013380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013390: 2066 696c 655f 7061 7468 203d 206f 732e   file_path = os.
-000133a0: 7061 7468 2e6a 6f69 6e28 726f 6f74 2c20  path.join(root, 
-000133b0: 6669 6c65 290a 0a20 2020 2020 2020 2020  file)..         
-000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133d0: 2020 2023 2053 6b69 7020 6672 6f73 7465     # Skip froste
-000133e0: 7220 6669 6c65 730a 2020 2020 2020 2020  r files.        
-000133f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013400: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
-00013410: 7366 696c 6528 6669 6c65 5f70 6174 6829  sfile(file_path)
-00013420: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-00013430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013440: 2020 2020 2020 2020 2020 2066 696c 6520             file 
-00013450: 213d 2068 6173 685f 6669 6c65 2061 6e64  != hash_file and
-00013460: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00013470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013480: 2020 2020 2020 2066 696c 6520 213d 2073         file != s
-00013490: 656c 662e 7768 6572 655f 6469 645f 7468  elf.where_did_th
-000134a0: 655f 6669 6c65 735f 676f 5f66 696c 656e  e_files_go_filen
-000134b0: 616d 6520 616e 6420 5c0a 2020 2020 2020  ame and \.      
-000134c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000134e0: 6c65 2021 3d20 7365 6c66 2e6d 6435 7375  le != self.md5su
-000134f0: 6d5f 6669 6c65 6e61 6d65 2061 6e64 205c  m_filename and \
-00013500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013520: 2020 2020 2066 696c 6520 213d 2073 656c       file != sel
-00013530: 662e 6d64 3573 756d 5f72 6573 746f 7265  f.md5sum_restore
-00013540: 645f 6669 6c65 6e61 6d65 3a0a 0a20 2020  d_filename:..   
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-00013570: 6b20 3d20 6578 6563 7574 6f72 2e73 7562  k = executor.sub
-00013580: 6d69 7428 7365 6c66 2e6d 6435 7375 6d2c  mit(self.md5sum,
-00013590: 2066 696c 655f 7061 7468 290a 0a20 2020   file_path)..   
-000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135b0: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-000135c0: 6b73 5b74 6173 6b5d 203d 2066 696c 655f  ks[task] = file_
-000135d0: 7061 7468 0a0a 2020 2020 2020 2020 2020  path..          
-000135e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000135f0: 7220 6675 7475 7265 2069 6e20 636f 6e63  r future in conc
-00013600: 7572 7265 6e74 2e66 7574 7572 6573 2e61  urrent.futures.a
-00013610: 735f 636f 6d70 6c65 7465 6428 7461 736b  s_completed(task
-00013620: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00013630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013640: 6669 6c65 203d 206f 732e 7061 7468 2e62  file = os.path.b
-00013650: 6173 656e 616d 6528 7461 736b 735b 6675  asename(tasks[fu
-00013660: 7475 7265 5d29 0a20 2020 2020 2020 2020  ture]).         
+00012790: 276e 6f68 7570 2062 6173 6820 626f 6f74  'nohup bash boot
+000127a0: 7374 7261 702e 7368 203c 202f 6465 762f  strap.sh < /dev/
+000127b0: 6e75 6c6c 203e 2062 6f6f 7473 7472 6170  null > bootstrap
+000127c0: 2e6f 7574 2032 3e26 3120 2627 290a 2020  .out 2>&1 &').  
+000127d0: 2020 2020 2020 6966 2072 6574 2e73 7464        if ret.std
+000127e0: 6f75 7420 6f72 2072 6574 2e73 7464 6572  out or ret.stder
+000127f0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+00012800: 7269 6e74 2872 6574 2e73 7464 6f75 742c  rint(ret.stdout,
+00012810: 2072 6574 2e73 7464 6572 7229 0a20 2020   ret.stderr).   
+00012820: 2020 2020 2070 7269 6e74 2827 2045 7865       print(' Exe
+00012830: 6375 7465 6420 626f 6f74 7374 7261 7020  cuted bootstrap 
+00012840: 616e 6420 7265 7374 6f72 6520 7363 7269  and restore scri
+00012850: 7074 202e 2e2e 2079 6f75 206d 6179 2068  pt ... you may h
+00012860: 6176 6520 746f 2077 6169 7420 6120 7768  ave to wait a wh
+00012870: 696c 6520 2e2e 2e27 290a 2020 2020 2020  ile ...').      
+00012880: 2020 7072 696e 7428 2720 6275 7420 796f    print(' but yo
+00012890: 7520 6361 6e20 616c 7265 6164 7920 6c6f  u can already lo
+000128a0: 6769 6e20 7573 696e 6720 2266 726f 7374  gin using "frost
+000128b0: 6572 2073 7368 2227 290a 0a20 2020 2020  er ssh"')..     
+000128c0: 2020 206f 732e 7379 7374 656d 2866 2765     os.system(f'e
+000128d0: 6368 6f20 226c 7320 2d6c 207b 7365 6c66  cho "ls -l {self
+000128e0: 2e61 7267 732e 666f 6c64 6572 735b 305d  .args.folders[0]
+000128f0: 7d22 203e 3e20 7e2f 2e62 6173 685f 6869  }" >> ~/.bash_hi
+00012900: 7374 6f72 7927 290a 2020 2020 2020 2020  story').        
+00012910: 7265 7420 3d20 7365 6c66 2e73 7368 5f75  ret = self.ssh_u
+00012920: 706c 6f61 6428 2765 6332 2d75 7365 7227  pload('ec2-user'
+00012930: 2c20 6970 2c0a 2020 2020 2020 2020 2020  , ip,.          
+00012940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012950: 2020 2020 227e 2f2e 6261 7368 5f68 6973      "~/.bash_his
+00012960: 746f 7279 222c 2022 2e62 6173 685f 6869  tory", ".bash_hi
+00012970: 7374 6f72 7922 290a 2020 2020 2020 2020  story").        
+00012980: 6966 2072 6574 2e73 7464 6f75 7420 6f72  if ret.stdout or
+00012990: 2072 6574 2e73 7464 6572 723a 0a20 2020   ret.stderr:.   
+000129a0: 2020 2020 2020 2020 2070 7269 6e74 2872           print(r
+000129b0: 6574 2e73 7464 6f75 742c 2072 6574 2e73  et.stdout, ret.s
+000129c0: 7464 6572 7229 0a0a 2020 2020 2020 2020  tderr)..        
+000129d0: 7265 7420 3d20 7365 6c66 2e73 7368 5f75  ret = self.ssh_u
+000129e0: 706c 6f61 6428 0a20 2020 2020 2020 2020  pload(.         
+000129f0: 2020 2027 6563 322d 7573 6572 272c 2069     'ec2-user', i
+00012a00: 702c 2073 656c 662e 6366 672e 6172 6368  p, self.cfg.arch
+00012a10: 6976 655f 6a73 6f6e 2c20 227e 2f2e 636f  ive_json, "~/.co
+00012a20: 6e66 6967 2f66 726f 7374 6572 2f22 290a  nfig/froster/").
+00012a30: 2020 2020 2020 2020 6966 2072 6574 2e73          if ret.s
+00012a40: 7464 6f75 7420 6f72 2072 6574 2e73 7464  tdout or ret.std
+00012a50: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
+00012a60: 2070 7269 6e74 2872 6574 2e73 7464 6f75   print(ret.stdou
+00012a70: 742c 2072 6574 2e73 7464 6572 7229 0a0a  t, ret.stderr)..
+00012a80: 2020 2020 2020 2020 7365 6c66 2e73 656e          self.sen
+00012a90: 645f 656d 6169 6c5f 7365 7328 7365 6c66  d_email_ses(self
+00012aa0: 2e63 6667 2e65 6d61 696c 2c20 7365 6c66  .cfg.email, self
+00012ab0: 2e63 6667 2e65 6d61 696c 2c20 2746 726f  .cfg.email, 'Fro
+00012ac0: 7374 6572 2072 6573 746f 7265 206f 6e20  ster restore on 
+00012ad0: 4543 3227 2c0a 2020 2020 2020 2020 2020  EC2',.          
+00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012af0: 2020 6627 7468 6973 2063 6f6d 6d61 6e64    f'this command
+00012b00: 206c 696e 6520 7761 7320 6578 6563 7574   line was execut
+00012b10: 6564 206f 6e20 686f 7374 207b 6970 7d3a  ed on host {ip}:
+00012b20: 5c6e 7b63 6d64 6c69 6e65 7d27 290a 0a20  \n{cmdline}').. 
+00012b30: 2020 2064 6566 205f 6563 325f 6372 6561     def _ec2_crea
+00012b40: 7465 5f6f 725f 6765 745f 6961 6d5f 706f  te_or_get_iam_po
+00012b50: 6c69 6379 2873 656c 662c 2070 6f6c 5f6e  licy(self, pol_n
+00012b60: 616d 652c 2070 6f6c 5f64 6f63 293a 0a0a  ame, pol_doc):..
+00012b70: 2020 2020 2020 2020 706f 6c69 6379 5f61          policy_a
+00012b80: 726e 203d 204e 6f6e 650a 2020 2020 2020  rn = None.      
+00012b90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00012ba0: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
+00012bb0: 6c66 2e69 616d 5f63 6c69 656e 742e 6372  lf.iam_client.cr
+00012bc0: 6561 7465 5f70 6f6c 6963 7928 0a20 2020  eate_policy(.   
+00012bd0: 2020 2020 2020 2020 2020 2020 2050 6f6c               Pol
+00012be0: 6963 794e 616d 653d 706f 6c5f 6e61 6d65  icyName=pol_name
+00012bf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012c00: 2020 506f 6c69 6379 446f 6375 6d65 6e74    PolicyDocument
+00012c10: 3d6a 736f 6e2e 6475 6d70 7328 706f 6c5f  =json.dumps(pol_
+00012c20: 646f 6329 0a20 2020 2020 2020 2020 2020  doc).           
+00012c30: 2029 0a20 2020 2020 2020 2020 2020 2070   ).            p
+00012c40: 6f6c 6963 795f 6172 6e20 3d20 7265 7370  olicy_arn = resp
+00012c50: 6f6e 7365 5b27 506f 6c69 6379 275d 5b27  onse['Policy']['
+00012c60: 4172 6e27 5d0a 2020 2020 2020 2020 2020  Arn'].          
+00012c70: 2020 7072 696e 7428 6622 506f 6c69 6379    print(f"Policy
+00012c80: 2063 7265 6174 6564 2077 6974 6820 4152   created with AR
+00012c90: 4e3a 207b 706f 6c69 6379 5f61 726e 7d22  N: {policy_arn}"
+00012ca0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00012cb0: 2073 656c 662e 6961 6d5f 636c 6965 6e74   self.iam_client
+00012cc0: 2e65 7863 6570 7469 6f6e 732e 456e 7469  .exceptions.Enti
+00012cd0: 7479 416c 7265 6164 7945 7869 7374 7345  tyAlreadyExistsE
+00012ce0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00012cf0: 2020 2020 2020 2020 2020 2070 6f6c 6963             polic
+00012d00: 6965 7320 3d20 7365 6c66 2e69 616d 5f63  ies = self.iam_c
+00012d10: 6c69 656e 742e 6c69 7374 5f70 6f6c 6963  lient.list_polic
+00012d20: 6965 7328 5363 6f70 653d 274c 6f63 616c  ies(Scope='Local
+00012d30: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
+00012d40: 2053 636f 7065 3d27 4c6f 6361 6c27 2066   Scope='Local' f
+00012d50: 6f72 2063 7573 746f 6d65 722d 6d61 6e61  or customer-mana
+00012d60: 6765 6420 706f 6c69 6369 6573 2c0a 2020  ged policies,.  
+00012d70: 2020 2020 2020 2020 2020 2320 2741 5753            # 'AWS
+00012d80: 2720 666f 7220 4157 532d 6d61 6e61 6765  ' for AWS-manage
+00012d90: 6420 706f 6c69 6369 6573 0a20 2020 2020  d policies.     
+00012da0: 2020 2020 2020 2066 6f72 2070 6f6c 6963         for polic
+00012db0: 7920 696e 2070 6f6c 6963 6965 735b 2750  y in policies['P
+00012dc0: 6f6c 6963 6965 7327 5d3a 0a20 2020 2020  olicies']:.     
+00012dd0: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+00012de0: 6c69 6379 5b27 506f 6c69 6379 4e61 6d65  licy['PolicyName
+00012df0: 275d 203d 3d20 706f 6c5f 6e61 6d65 3a0a  '] == pol_name:.
+00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e10: 2020 2020 706f 6c69 6379 5f61 726e 203d      policy_arn =
+00012e20: 2070 6f6c 6963 795b 2741 726e 275d 0a20   policy['Arn']. 
+00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e40: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00012e50: 2020 2020 2070 7269 6e74 2866 2750 6f6c       print(f'Pol
+00012e60: 6963 7920 7b70 6f6c 5f6e 616d 657d 2061  icy {pol_name} a
+00012e70: 6c72 6561 6479 2065 7869 7374 7327 290a  lready exists').
+00012e80: 2020 2020 2020 2020 6578 6365 7074 2062          except b
+00012e90: 6f74 6f63 6f72 652e 6578 6365 7074 696f  otocore.exceptio
+00012ea0: 6e73 2e43 6c69 656e 7445 7272 6f72 2061  ns.ClientError a
+00012eb0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00012ec0: 2065 7272 6f72 5f63 6f64 6520 3d20 652e   error_code = e.
+00012ed0: 7265 7370 6f6e 7365 5b27 4572 726f 7227  response['Error'
+00012ee0: 5d5b 2743 6f64 6527 5d0a 2020 2020 2020  ]['Code'].      
+00012ef0: 2020 2020 2020 6966 2065 7272 6f72 5f63        if error_c
+00012f00: 6f64 6520 3d3d 2027 4163 6365 7373 4465  ode == 'AccessDe
+00012f10: 6e69 6564 273a 0a20 2020 2020 2020 2020  nied':.         
+00012f20: 2020 2020 2020 2070 7269 6e74 6462 6728         printdbg(
+00012f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f40: 2020 2020 2066 2741 6363 6573 7320 6465       f'Access de
+00012f50: 6e69 6564 2120 506c 6561 7365 2063 6865  nied! Please che
+00012f60: 636b 2079 6f75 7220 4941 4d20 7065 726d  ck your IAM perm
+00012f70: 6973 7369 6f6e 732e 205c 6e20 2020 4572  issions. \n   Er
+00012f80: 726f 723a 207b 657d 2729 0a20 2020 2020  ror: {e}').     
+00012f90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012fa0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00012fb0: 6e74 2866 2743 6c69 656e 7420 4572 726f  nt(f'Client Erro
+00012fc0: 723a 207b 657d 2729 0a20 2020 2020 2020  r: {e}').       
+00012fd0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00012fe0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00012ff0: 2020 2020 7072 696e 7428 274f 7468 6572      print('Other
+00013000: 2045 7272 6f72 3a27 2c20 6529 0a20 2020   Error:', e).   
+00013010: 2020 2020 2072 6574 7572 6e20 706f 6c69       return poli
+00013020: 6379 5f61 726e 0a0a 2020 2020 6465 6620  cy_arn..    def 
+00013030: 5f65 6332 5f63 7265 6174 655f 6672 6f73  _ec2_create_fros
+00013040: 7465 725f 6961 6d5f 706f 6c69 6379 2873  ter_iam_policy(s
+00013050: 656c 6629 3a0a 0a20 2020 2020 2020 2023  elf):..        #
+00013060: 2044 6566 696e 6520 706f 6c69 6379 206e   Define policy n
+00013070: 616d 6520 616e 6420 706f 6c69 6379 2064  ame and policy d
+00013080: 6f63 756d 656e 740a 2020 2020 2020 2020  ocument.        
+00013090: 706f 6c69 6379 5f6e 616d 6520 3d20 2746  policy_name = 'F
+000130a0: 726f 7374 6572 4543 3244 6573 6372 6962  rosterEC2Describ
+000130b0: 6550 6f6c 6963 7927 0a20 2020 2020 2020  ePolicy'.       
+000130c0: 2070 6f6c 6963 795f 646f 6375 6d65 6e74   policy_document
+000130d0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+000130e0: 2022 5665 7273 696f 6e22 3a20 2232 3031   "Version": "201
+000130f0: 322d 3130 2d31 3722 2c0a 2020 2020 2020  2-10-17",.      
+00013100: 2020 2020 2020 2253 7461 7465 6d65 6e74        "Statement
+00013110: 223a 205b 0a20 2020 2020 2020 2020 2020  ": [.           
+00013120: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00013130: 2020 2020 2020 2020 2020 2022 4566 6665             "Effe
+00013140: 6374 223a 2022 416c 6c6f 7722 2c0a 2020  ct": "Allow",.  
+00013150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013160: 2020 2241 6374 696f 6e22 3a20 2265 6332    "Action": "ec2
+00013170: 3a44 6573 6372 6962 652a 222c 0a20 2020  :Describe*",.   
+00013180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013190: 2022 5265 736f 7572 6365 223a 2022 2a22   "Resource": "*"
+000131a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000131b0: 207d 0a20 2020 2020 2020 2020 2020 205d   }.            ]
+000131c0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000131d0: 2020 2020 2320 4765 7420 6375 7272 656e      # Get curren
+000131e0: 7420 4941 4d20 7573 6572 2773 2064 6574  t IAM user's det
+000131f0: 6169 6c73 0a20 2020 2020 2020 2075 7365  ails.        use
+00013200: 7220 3d20 7365 6c66 2e69 616d 5f63 6c69  r = self.iam_cli
+00013210: 656e 742e 6765 745f 7573 6572 2829 0a20  ent.get_user(). 
+00013220: 2020 2020 2020 2075 7365 725f 6e61 6d65         user_name
+00013230: 203d 2075 7365 725b 2755 7365 7227 5d5b   = user['User'][
+00013240: 2755 7365 724e 616d 6527 5d0a 0a20 2020  'UserName']..   
+00013250: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+00013260: 706f 6c69 6379 2061 6c72 6561 6479 2065  policy already e
+00013270: 7869 7374 7320 666f 7220 7468 6520 7573  xists for the us
+00013280: 6572 0a20 2020 2020 2020 2065 7869 7374  er.        exist
+00013290: 696e 675f 706f 6c69 6369 6573 203d 2073  ing_policies = s
+000132a0: 656c 662e 6961 6d5f 636c 6965 6e74 2e6c  elf.iam_client.l
+000132b0: 6973 745f 7573 6572 5f70 6f6c 6963 6965  ist_user_policie
+000132c0: 7328 0a20 2020 2020 2020 2020 2020 2055  s(.            U
+000132d0: 7365 724e 616d 653d 7573 6572 5f6e 616d  serName=user_nam
+000132e0: 6529 0a20 2020 2020 2020 2069 6620 706f  e).        if po
+000132f0: 6c69 6379 5f6e 616d 6520 696e 2065 7869  licy_name in exi
+00013300: 7374 696e 675f 706f 6c69 6369 6573 5b27  sting_policies['
+00013310: 506f 6c69 6379 4e61 6d65 7327 5d3a 0a20  PolicyNames']:. 
+00013320: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00013330: 2866 227b 706f 6c69 6379 5f6e 616d 657d  (f"{policy_name}
+00013340: 2061 6c72 6561 6479 2065 7869 7374 7320   already exists 
+00013350: 666f 7220 7573 6572 207b 7573 6572 5f6e  for user {user_n
+00013360: 616d 657d 2e22 290a 2020 2020 2020 2020  ame}.").        
+00013370: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00013380: 2020 2020 2320 4372 6561 7465 2070 6f6c      # Create pol
+00013390: 6963 7920 666f 7220 7573 6572 0a20 2020  icy for user.   
+000133a0: 2020 2020 2073 656c 662e 6961 6d5f 636c       self.iam_cl
+000133b0: 6965 6e74 2e70 7574 5f75 7365 725f 706f  ient.put_user_po
+000133c0: 6c69 6379 280a 2020 2020 2020 2020 2020  licy(.          
+000133d0: 2020 5573 6572 4e61 6d65 3d75 7365 725f    UserName=user_
+000133e0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+000133f0: 2020 506f 6c69 6379 4e61 6d65 3d70 6f6c    PolicyName=pol
+00013400: 6963 795f 6e61 6d65 2c0a 2020 2020 2020  icy_name,.      
+00013410: 2020 2020 2020 506f 6c69 6379 446f 6375        PolicyDocu
+00013420: 6d65 6e74 3d6a 736f 6e2e 6475 6d70 7328  ment=json.dumps(
+00013430: 706f 6c69 6379 5f64 6f63 756d 656e 7429  policy_document)
+00013440: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00013450: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00013460: 2020 2020 2020 2066 2250 6f6c 6963 7920         f"Policy 
+00013470: 7b70 6f6c 6963 795f 6e61 6d65 7d20 6174  {policy_name} at
+00013480: 7461 6368 6564 2073 7563 6365 7373 6675  tached successfu
+00013490: 6c6c 7920 746f 2075 7365 7220 7b75 7365  lly to user {use
+000134a0: 725f 6e61 6d65 7d2e 2229 0a0a 2020 2020  r_name}.")..    
+000134b0: 6465 6620 5f65 6332 5f63 7265 6174 655f  def _ec2_create_
+000134c0: 6961 6d5f 706f 6c69 6379 5f72 6f6c 6573  iam_policy_roles
+000134d0: 5f65 6332 7072 6f66 696c 6528 7365 6c66  _ec2profile(self
+000134e0: 293a 0a20 2020 2020 2020 2023 2063 7265  ):.        # cre
+000134f0: 6174 6520 616c 6c20 7468 6520 4941 4d20  ate all the IAM 
+00013500: 7265 7175 6972 656d 656e 7420 746f 2061  requirement to a
+00013510: 6c6c 6f77 2061 6e20 6563 3220 696e 7374  llow an ec2 inst
+00013520: 616e 6365 2074 6f0a 2020 2020 2020 2020  ance to.        
+00013530: 2320 312e 2073 656c 6620 6465 7374 7275  # 1. self destru
+00013540: 6374 2c20 322e 206d 6f6e 6974 6f72 2063  ct, 2. monitor c
+00013550: 6f73 7420 7769 7468 2043 4520 616e 6420  ost with CE and 
+00013560: 332e 2073 656e 6420 656d 6169 6c73 2076  3. send emails v
+00013570: 6961 2053 4553 0a0a 2020 2020 2020 2320  ia SES..      # 
+00013580: 5374 6570 2030 3a20 4372 6561 7465 2049  Step 0: Create I
+00013590: 414d 2073 656c 6620 6465 7374 7275 6374  AM self destruct
+000135a0: 2061 6e64 2045 4332 2072 6561 6420 706f   and EC2 read po
+000135b0: 6c69 6379 0a20 2020 2020 2020 2070 6f6c  licy.        pol
+000135c0: 6963 795f 646f 6375 6d65 6e74 203d 207b  icy_document = {
+000135d0: 0a20 2020 2020 2020 2020 2020 2022 5665  .            "Ve
+000135e0: 7273 696f 6e22 3a20 2232 3031 322d 3130  rsion": "2012-10
+000135f0: 2d31 3722 2c0a 2020 2020 2020 2020 2020  -17",.          
+00013600: 2020 2253 7461 7465 6d65 6e74 223a 205b    "Statement": [
+00013610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013620: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00013630: 2020 2020 2020 2022 4566 6665 6374 223a         "Effect":
+00013640: 2022 416c 6c6f 7722 2c0a 2020 2020 2020   "Allow",.      
+00013650: 2020 2020 2020 2020 2020 2020 2020 2241                "A
+00013660: 6374 696f 6e22 3a20 5b0a 2020 2020 2020  ction": [.      
 00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 2020 206d 6435 203d 2066 7574 7572 652e     md5 = future.
-00013690: 7265 7375 6c74 2829 0a20 2020 2020 2020  result().       
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2020 2020 206f 7574 5f66 2e77 7269 7465       out_f.write
-000136c0: 2866 227b 6d64 357d 2020 7b66 696c 657d  (f"{md5}  {file}
-000136d0: 5c6e 2229 0a0a 2020 2020 2020 2020 2020  \n")..          
-000136e0: 2020 2020 2020 2320 4368 6563 6b20 7765        # Check we
-000136f0: 2067 656e 6572 6174 6564 2074 6865 2068   generated the h
-00013700: 6173 6820 6669 6c65 0a20 2020 2020 2020  ash file.       
-00013710: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-00013720: 6174 682e 6765 7473 697a 6528 6861 7368  ath.getsize(hash
-00013730: 7061 7468 2920 3d3d 2030 3a0a 2020 2020  path) == 0:.    
-00013740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013750: 6f73 2e72 656d 6f76 6528 6861 7368 7061  os.remove(hashpa
-00013760: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-00013770: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00013780: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00013790: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000137b0: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-000137c0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-000137d0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-000137e0: 2020 7072 696e 745f 6572 726f 7228 290a    print_error().
-000137f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013800: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-00013810: 6620 5f67 656e 5f61 6c6c 6669 6c65 735f  f _gen_allfiles_
-00013820: 616e 645f 7461 7228 7365 6c66 2c20 6469  and_tar(self, di
-00013830: 7265 6374 6f72 792c 2073 6d61 6c6c 7369  rectory, smallsi
-00013840: 7a65 3d31 3032 342c 2069 735f 7461 723d  ze=1024, is_tar=
-00013850: 5472 7565 293a 0a20 2020 2020 2020 2027  True):.        '
-00013860: 2727 5461 7220 736d 616c 6c20 6669 6c65  ''Tar small file
-00013870: 7320 696e 2061 2064 6972 6563 746f 7279  s in a directory
-00013880: 2727 270a 0a20 2020 2020 2020 2074 7279  '''..        try
-00013890: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-000138a0: 725f 7061 7468 203d 206f 732e 7061 7468  r_path = os.path
-000138b0: 2e6a 6f69 6e28 6469 7265 6374 6f72 792c  .join(directory,
-000138c0: 2073 656c 662e 736d 616c 6c66 696c 6573   self.smallfiles
-000138d0: 5f74 6172 5f66 696c 656e 616d 6529 0a20  _tar_filename). 
-000138e0: 2020 2020 2020 2020 2020 2063 7376 5f70             csv_p
-000138f0: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
-00013900: 696e 2864 6972 6563 746f 7279 2c20 7365  in(directory, se
-00013910: 6c66 2e61 6c6c 6669 6c65 735f 6373 765f  lf.allfiles_csv_
-00013920: 6669 6c65 6e61 6d65 290a 0a20 2020 2020  filename)..     
-00013930: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00013940: 682e 6578 6973 7473 2874 6172 5f70 6174  h.exists(tar_pat
-00013950: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00013960: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-00013970: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00013980: 2072 6f6f 742c 2064 6972 732c 2066 696c   root, dirs, fil
-00013990: 6573 2069 6e20 7365 6c66 2e5f 7761 6c6b  es in self._walk
-000139a0: 6572 2864 6972 6563 746f 7279 293a 0a0a  er(directory):..
-000139b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139c0: 2320 5765 206f 6e6c 7920 7761 6e74 2074  # We only want t
-000139d0: 6f20 7461 7220 7468 6520 6669 6c65 7320  o tar the files 
-000139e0: 696e 2074 6865 2072 6f6f 7420 6469 7265  in the root dire
-000139f0: 6374 6f72 792e 2041 766f 6964 2072 6563  ctory. Avoid rec
-00013a00: 7572 7369 6f6e 2e0a 2020 2020 2020 2020  ursion..        
-00013a10: 2020 2020 2020 2020 6966 2072 6f6f 7420          if root 
-00013a20: 213d 2064 6972 6563 746f 7279 3a0a 2020  != directory:.  
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-00013a50: 2020 2020 2020 2020 2023 2046 6c61 6720           # Flag 
-00013a60: 746f 2063 6865 636b 2069 6620 616e 7920  to check if any 
-00013a70: 6669 6c65 7320 7765 7265 2074 6172 7265  files were tarre
-00013a80: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00013a90: 2020 6469 6474 6172 203d 2046 616c 7365    didtar = False
-00013aa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013ab0: 2020 2320 4372 6561 7465 2074 6172 2066    # Create tar f
-00013ac0: 696c 6520 616e 6420 6373 7620 6669 6c65  ile and csv file
-00013ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ae0: 2077 6974 6820 7461 7266 696c 652e 6f70   with tarfile.op
-00013af0: 656e 2874 6172 5f70 6174 682c 2022 7722  en(tar_path, "w"
-00013b00: 2920 6173 2074 6172 5f66 696c 652c 206f  ) as tar_file, o
-00013b10: 7065 6e28 6373 765f 7061 7468 2c20 2777  pen(csv_path, 'w
-00013b20: 272c 206e 6577 6c69 6e65 3d27 2729 2061  ', newline='') a
-00013b30: 7320 6373 765f 6669 6c65 3a0a 0a20 2020  s csv_file:..   
-00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 2023 2043 7265 6174 6520 6373 7620 7772   # Create csv wr
-00013b60: 6974 6572 0a20 2020 2020 2020 2020 2020  iter.           
-00013b70: 2020 2020 2020 2020 2077 7269 7465 7220           writer 
-00013b80: 3d20 6373 762e 7772 6974 6572 2863 7376  = csv.writer(csv
-00013b90: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
-00013ba0: 2020 2020 2020 2020 2020 2020 2320 5772              # Wr
-00013bb0: 6974 6520 7468 6520 6865 6164 6572 0a20  ite the header. 
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2077 7269 7465 722e 7772 6974 6572     writer.writer
-00013be0: 6f77 285b 2246 696c 6522 2c20 2253 697a  ow(["File", "Siz
-00013bf0: 6528 6279 7465 7329 222c 2022 4461 7465  e(bytes)", "Date
-00013c00: 2d4d 6f64 6966 6965 6422 2c0a 2020 2020  -Modified",.    
-00013c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c30: 2244 6174 652d 4163 6365 7373 6564 222c  "Date-Accessed",
-00013c40: 2022 4f77 6e65 7222 2c20 2247 726f 7570   "Owner", "Group
-00013c50: 222c 2022 5065 726d 6973 7369 6f6e 7322  ", "Permissions"
-00013c60: 2c20 2254 6172 7265 6422 5d29 0a0a 2020  , "Tarred"])..  
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 666f 7220 6669 6c65 2069 6e20 6669    for file in fi
-00013c90: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00013ca0: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-00013cb0: 6574 2074 6865 2066 696c 6520 7061 7468  et the file path
-00013cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013cd0: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-00013ce0: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-00013cf0: 6e28 726f 6f74 2c20 6669 6c65 290a 0a20  n(root, file).. 
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 2020 2020 2023 2053 6b69 7020 7468         # Skip th
-00013d20: 6520 6373 7620 6669 6c65 0a20 2020 2020  e csv file.     
-00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d40: 2020 2069 6620 6669 6c65 5f70 6174 6820     if file_path 
-00013d50: 3d3d 2063 7376 5f70 6174 683a 0a20 2020  == csv_path:.   
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00013d80: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00013d90: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00013da0: 636b 2069 6620 6669 6c65 2069 7320 6c61  ck if file is la
-00013db0: 7267 6572 2074 6861 6e20 5820 4d42 0a20  rger than X MB. 
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dd0: 2020 2020 2020 2073 697a 652c 206d 7469         size, mti
-00013de0: 6d65 2c20 6174 696d 6520 3d20 7365 6c66  me, atime = self
-00013df0: 2e5f 6765 745f 6669 6c65 5f73 7461 7473  ._get_file_stats
-00013e00: 2866 696c 655f 7061 7468 290a 0a20 2020  (file_path)..   
-00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e20: 2020 2020 2023 2047 6574 206c 6173 7420       # Get last 
-00013e30: 6d6f 6469 6669 6564 2064 6174 650a 2020  modified date.  
-00013e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e50: 2020 2020 2020 6d64 6174 6520 3d20 6461        mdate = da
-00013e60: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-00013e70: 6672 6f6d 7469 6d65 7374 616d 7028 0a20  fromtimestamp(. 
-00013e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e90: 2020 2020 2020 2020 2020 206d 7469 6d65             mtime
-00013ea0: 292e 7374 7266 7469 6d65 2827 2559 2d25  ).strftime('%Y-%
-00013eb0: 6d2d 2564 2025 483a 254d 3a25 5327 290a  m-%d %H:%M:%S').
-00013ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ed0: 2020 2020 2020 2020 2023 2047 6574 206c           # Get l
-00013ee0: 6173 7420 6163 6365 7373 6564 2064 6174  ast accessed dat
-00013ef0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00013f00: 2020 2020 2020 2020 2020 6164 6174 6520            adate 
-00013f10: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
-00013f20: 696d 652e 6672 6f6d 7469 6d65 7374 616d  ime.fromtimestam
-00013f30: 7028 0a20 2020 2020 2020 2020 2020 2020  p(.             
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00013f50: 7469 6d65 292e 7374 7266 7469 6d65 2827  time).strftime('
-00013f60: 2559 2d25 6d2d 2564 2025 483a 254d 3a25  %Y-%m-%d %H:%M:%
-00013f70: 5327 290a 0a20 2020 2020 2020 2020 2020  S')..           
-00013f80: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-00013f90: 6574 206f 776e 6572 7368 6970 0a20 2020  et ownership.   
-00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fb0: 2020 2020 206f 776e 6572 203d 2073 656c       owner = sel
-00013fc0: 662e 7569 6432 7573 6572 286f 732e 6c73  f.uid2user(os.ls
-00013fd0: 7461 7428 6669 6c65 5f70 6174 6829 2e73  tat(file_path).s
-00013fe0: 745f 7569 6429 0a20 2020 2020 2020 2020  t_uid).         
-00013ff0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00014000: 726f 7570 203d 2073 656c 662e 6769 6432  roup = self.gid2
-00014010: 6772 6f75 7028 6f73 2e6c 7374 6174 2866  group(os.lstat(f
-00014020: 696c 655f 7061 7468 292e 7374 5f67 6964  ile_path).st_gid
-00014030: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00014040: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-00014050: 2070 6572 6d69 7373 696f 6e73 0a20 2020   permissions.   
-00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014070: 2020 2020 2070 6572 6d69 7373 696f 6e73       permissions
-00014080: 203d 206f 6374 286f 732e 6c73 7461 7428   = oct(os.lstat(
-00014090: 6669 6c65 5f70 6174 6829 2e73 745f 6d6f  file_path).st_mo
-000140a0: 6465 290a 0a20 2020 2020 2020 2020 2020  de)..           
-000140b0: 2020 2020 2020 2020 2020 2020 2023 2053               # S
-000140c0: 6574 2074 6172 7265 6420 746f 204e 6f0a  et tarred to No.
-000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140e0: 2020 2020 2020 2020 7461 7272 6564 203d          tarred =
-000140f0: 2022 4e6f 220a 0a20 2020 2020 2020 2020   "No"..         
-00014100: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00014110: 2054 6172 2074 6865 2066 696c 6520 6966   Tar the file if
-00014120: 2069 7427 7320 736d 616c 6c65 7220 7468   it's smaller th
-00014130: 616e 2074 6865 2073 7065 6369 6669 6564  an the specified
-00014140: 2073 697a 650a 2020 2020 2020 2020 2020   size.          
-00014150: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014160: 2069 735f 7461 7220 616e 6420 7369 7a65   is_tar and size
-00014170: 203c 2073 6d61 6c6c 7369 7a65 2a31 3032   < smallsize*102
-00014180: 343a 0a20 2020 2020 2020 2020 2020 2020  4:.             
-00014190: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000141a0: 2061 6464 2074 6f20 7461 7220 6669 6c65   add to tar file
-000141b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000141c0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
-000141d0: 5f66 696c 652e 6164 6428 6669 6c65 5f70  _file.add(file_p
-000141e0: 6174 682c 2061 7263 6e61 6d65 3d66 696c  ath, arcname=fil
-000141f0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014210: 2320 5365 7420 6469 6474 6172 2074 6f20  # Set didtar to 
-00014220: 5472 7565 2c20 736f 2077 6520 6b6e 6f77  True, so we know
-00014230: 2077 6520 7461 7272 6564 2061 2066 696c   we tarred a fil
-00014240: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00014250: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00014260: 6474 6172 203d 2054 7275 650a 0a20 2020  dtar = True..   
-00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014280: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
-00014290: 6520 6f72 6967 696e 616c 2066 696c 650a  e original file.
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-000142c0: 656d 6f76 6528 6669 6c65 5f70 6174 6829  emove(file_path)
-000142d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000142e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000142f0: 5365 7420 7461 7272 6564 2074 6f20 5965  Set tarred to Ye
-00014300: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00014310: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-00014320: 7272 6564 203d 2022 5965 7322 0a0a 2020  rred = "Yes"..  
-00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014340: 2020 2020 2020 2320 5772 6974 6520 6669        # Write fi
-00014350: 6c65 2069 6e66 6f20 746f 2074 6865 2063  le info to the c
-00014360: 7376 2066 696c 650a 2020 2020 2020 2020  sv file.        
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 7772 6974 6572 2e77 7269 7465 726f 7728  writer.writerow(
-00014390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000143a0: 2020 2020 2020 2020 2020 2020 205b 6669               [fi
-000143b0: 6c65 2c20 7369 7a65 2c20 6d64 6174 652c  le, size, mdate,
-000143c0: 2061 6461 7465 2c20 6f77 6e65 722c 2067   adate, owner, g
-000143d0: 726f 7570 2c20 7065 726d 6973 7369 6f6e  roup, permission
-000143e0: 732c 2074 6172 7265 645d 290a 0a20 2020  s, tarred])..   
-000143f0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00014400: 6865 636b 2069 6620 7765 2074 6172 7265  heck if we tarre
-00014410: 6420 616e 7920 6669 6c65 730a 2020 2020  d any files.    
-00014420: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00014430: 6f74 2064 6964 7461 723a 0a20 2020 2020  ot didtar:.     
-00014440: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00014450: 2052 656d 6f76 6520 7468 6520 7461 7220   Remove the tar 
-00014460: 6669 6c65 2069 6620 6974 2773 2065 6d70  file if it's emp
-00014470: 7479 0a20 2020 2020 2020 2020 2020 2020  ty.             
-00014480: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00014490: 2874 6172 5f70 6174 6829 0a0a 2020 2020  (tar_path)..    
-000144a0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-000144b0: 7275 650a 0a20 2020 2020 2020 2065 7863  rue..        exc
-000144c0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-000144d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000144e0: 6966 2073 656c 662e 6172 6773 2e64 6562  if self.args.deb
-000144f0: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
-00014500: 2020 2020 7072 696e 745f 6572 726f 7228      print_error(
-00014510: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00014520: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-00014530: 6465 6620 5f75 6e74 6172 5f66 696c 6573  def _untar_files
-00014540: 2873 656c 662c 2064 6972 6563 746f 7279  (self, directory
-00014550: 2c20 7265 6375 7273 6976 653d 4661 6c73  , recursive=Fals
-00014560: 6529 3a0a 2020 2020 2020 2020 666f 7220  e):.        for 
-00014570: 726f 6f74 2c20 6469 7273 2c20 6669 6c65  root, dirs, file
-00014580: 7320 696e 2073 656c 662e 5f77 616c 6b65  s in self._walke
-00014590: 7228 6469 7265 6374 6f72 7929 3a0a 2020  r(directory):.  
-000145a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000145b0: 2072 6563 7572 7369 7665 2061 6e64 2072   recursive and r
-000145c0: 6f6f 7420 213d 2064 6972 6563 746f 7279  oot != directory
-000145d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000145e0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-000145f0: 2020 2020 7461 725f 7061 7468 203d 206f      tar_path = o
-00014600: 732e 7061 7468 2e6a 6f69 6e28 726f 6f74  s.path.join(root
-00014610: 2c20 2746 726f 7374 6572 2e73 6d61 6c6c  , 'Froster.small
-00014620: 6669 6c65 732e 7461 7227 290a 2020 2020  files.tar').    
-00014630: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00014640: 732e 7061 7468 2e65 7869 7374 7328 7461  s.path.exists(ta
-00014650: 725f 7061 7468 293a 0a20 2020 2020 2020  r_path):.       
-00014660: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
-00014670: 2827 7b74 6172 5f70 6174 687d 2064 6f65  ('{tar_path} doe
-00014680: 7320 6e6f 7420 6578 6973 742c 2073 6b69  s not exist, ski
-00014690: 7070 696e 6720 666f 6c64 6572 207b 726f  pping folder {ro
-000146a0: 6f74 7d27 290a 2020 2020 2020 2020 2020  ot}').          
-000146b0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-000146c0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000146d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146e0: 7072 696e 7428 6627 2020 556e 7461 7272  print(f'  Untarr
-000146f0: 696e 6720 4672 6f73 7465 722e 736d 616c  ing Froster.smal
-00014700: 6c66 696c 6573 2e74 6172 202e 2e2e 2027  lfiles.tar ... '
-00014710: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
-00014720: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-00014730: 6172 6669 6c65 2e6f 7065 6e28 7461 725f  arfile.open(tar_
-00014740: 7061 7468 2c20 2272 2229 2061 7320 7461  path, "r") as ta
-00014750: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00014760: 2020 2020 2020 2074 6172 2e65 7874 7261         tar.extra
-00014770: 6374 616c 6c28 7061 7468 3d72 6f6f 7429  ctall(path=root)
-00014780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014790: 206f 732e 7265 6d6f 7665 2874 6172 5f70   os.remove(tar_p
-000147a0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-000147b0: 2020 2020 2070 7269 6e74 2827 446f 6e65       print('Done
-000147c0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-000147d0: 6578 6365 7074 2050 6572 6d69 7373 696f  except Permissio
-000147e0: 6e45 7272 6f72 2061 7320 653a 0a20 2020  nError as e:.   
-000147f0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00014800: 6865 636b 2069 6620 6572 726f 7220 6e75  heck if error nu
-00014810: 6d62 6572 2069 7320 3133 2028 5065 726d  mber is 13 (Perm
-00014820: 6973 7369 6f6e 2064 656e 6965 6429 0a20  ission denied). 
-00014830: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014840: 6620 652e 6572 726e 6f20 3d3d 2031 333a  f e.errno == 13:
-00014850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014860: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-00014870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014880: 2020 2020 2250 6572 6d69 7373 696f 6e20      "Permission 
-00014890: 6465 6e69 6564 2e20 506c 6561 7365 2065  denied. Please e
-000148a0: 6e73 7572 6520 796f 7520 6861 7665 2074  nsure you have t
-000148b0: 6865 206e 6563 6573 7361 7279 2070 6572  he necessary per
-000148c0: 6d69 7373 696f 6e73 2074 6f20 6163 6365  missions to acce
-000148d0: 7373 2074 6865 2066 696c 6520 6f72 2064  ss the file or d
-000148e0: 6972 6563 746f 7279 2e22 290a 2020 2020  irectory.").    
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 7265 7475 726e 2031 330a 2020 2020 2020  return 13.      
-00014910: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014930: 2020 2020 7072 696e 7428 6622 416e 2075      print(f"An u
-00014940: 6e65 7870 6563 7465 6420 5065 726d 6973  nexpected Permis
-00014950: 7369 6f6e 4572 726f 7220 6f63 6375 7272  sionError occurr
-00014960: 6564 3a5c 6e7b 657d 222c 2066 696c 653d  ed:\n{e}", file=
-00014970: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
-00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014990: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-000149a0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000149b0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 7072 696e 7428 6622 416e 2075 6e65 7870  print(f"An unexp
-000149e0: 6563 7465 6420 6572 726f 7220 6f63 6375  ected error occu
-000149f0: 7272 6564 3a5c 6e7b 657d 222c 2066 696c  rred:\n{e}", fil
-00014a00: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
-00014a10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014a20: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00014a30: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
-00014a40: 2020 2020 6465 6620 7265 7365 745f 666f      def reset_fo
-00014a50: 6c64 6572 2873 656c 662c 2064 6972 6563  lder(self, direc
-00014a60: 746f 7279 2c20 7265 6375 7273 6976 653d  tory, recursive=
-00014a70: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00014a80: 2727 2752 656d 6f76 6520 616c 6c20 6672  '''Remove all fr
-00014a90: 6f73 7465 7220 6172 7469 6661 6374 7320  oster artifacts 
-00014aa0: 6672 6f6d 2061 2066 6f6c 6465 7220 616e  from a folder an
-00014ab0: 6420 756e 7461 7220 736d 616c 6c20 6669  d untar small fi
-00014ac0: 6c65 7327 2727 0a0a 2020 2020 2020 2020  les'''..        
-00014ad0: 666f 7220 726f 6f74 2c20 6469 7273 2c20  for root, dirs, 
-00014ae0: 6669 6c65 7320 696e 2073 656c 662e 5f77  files in self._w
-00014af0: 616c 6b65 7228 6469 7265 6374 6f72 7929  alker(directory)
-00014b00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00014b10: 206e 6f74 2072 6563 7572 7369 7665 2061   not recursive a
-00014b20: 6e64 2072 6f6f 7420 213d 2064 6972 6563  nd root != direc
-00014b30: 746f 7279 3a0a 2020 2020 2020 2020 2020  tory:.          
-00014b40: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00014b50: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00014b60: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00014b70: 6e74 2866 275c 6e52 6573 6574 7469 6e67  nt(f'\nResetting
-00014b80: 2066 6f6c 6465 7220 7b72 6f6f 747d 2e2e   folder {root}..
-00014b90: 2e27 290a 0a20 2020 2020 2020 2020 2020  .')..           
-00014ba0: 2020 2020 2069 6620 7365 6c66 2e5f 6973       if self._is
-00014bb0: 5f66 6f6c 6465 725f 6172 6368 6976 6564  _folder_archived
-00014bc0: 2872 6f6f 742e 7273 7472 6970 286f 732e  (root.rstrip(os.
-00014bd0: 7061 7468 2e73 6570 2929 3a0a 2020 2020  path.sep)):.    
-00014be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bf0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00014c00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00014c10: 2720 2020 202e 2e2e 666f 6c64 6572 207b  '    ...folder {
-00014c20: 726f 6f74 7d20 6973 2061 7263 6869 7665  root} is archive
-00014c30: 642c 206e 6f74 6869 6e67 2074 6f20 7265  d, nothing to re
-00014c40: 7365 745c 6e27 290a 2020 2020 2020 2020  set\n').        
-00014c50: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00014c60: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-00014c70: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
-00014c80: 7061 7468 2074 6f20 7468 6520 7461 7220  path to the tar 
-00014c90: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00014ca0: 2020 2020 2074 6172 5f70 6174 6820 3d20       tar_path = 
-00014cb0: 6f73 2e70 6174 682e 6a6f 696e 2872 6f6f  os.path.join(roo
-00014cc0: 742c 2073 656c 662e 736d 616c 6c66 696c  t, self.smallfil
-00014cd0: 6573 5f74 6172 5f66 696c 656e 616d 6529  es_tar_filename)
-00014ce0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014cf0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00014d00: 7374 7328 7461 725f 7061 7468 293a 0a20  sts(tar_path):. 
-00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d20: 2020 2070 7269 6e74 2827 2020 2020 556e     print('    Un
-00014d30: 7461 7272 696e 6720 4672 6f73 7465 722e  tarring Froster.
-00014d40: 736d 616c 6c66 696c 6573 2e74 6172 2e2e  smallfiles.tar..
-00014d50: 2e20 272c 2065 6e64 3d27 2729 0a20 2020  . ', end='').   
-00014d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d70: 2077 6974 6820 7461 7266 696c 652e 6f70   with tarfile.op
-00014d80: 656e 2874 6172 5f70 6174 682c 2022 7222  en(tar_path, "r"
-00014d90: 2920 6173 2074 6172 3a0a 2020 2020 2020  ) as tar:.      
-00014da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014db0: 2020 7461 722e 6578 7472 6163 7461 6c6c    tar.extractall
-00014dc0: 2870 6174 683d 726f 6f74 290a 2020 2020  (path=root).    
-00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014de0: 7072 696e 7428 2764 6f6e 652e 2729 0a0a  print('done.')..
-00014df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e00: 666f 7220 6669 6c65 2069 6e20 7365 6c66  for file in self
-00014e10: 2e64 6972 6d65 7461 6669 6c65 733a 0a20  .dirmetafiles:. 
-00014e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e30: 2020 2064 656c 6669 6c65 203d 206f 732e     delfile = os.
-00014e40: 7061 7468 2e6a 6f69 6e28 726f 6f74 2c20  path.join(root, 
-00014e50: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-00014e60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00014e70: 6627 2020 2020 5265 6d6f 7669 6e67 207b  f'    Removing {
-00014e80: 6669 6c65 7d2e 2e2e 2027 2c20 656e 643d  file}... ', end=
-00014e90: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
-00014ea0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00014eb0: 7468 2e65 7869 7374 7328 6465 6c66 696c  th.exists(delfil
-00014ec0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00014ed0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00014ee0: 656d 6f76 6528 6465 6c66 696c 6529 0a20  emove(delfile). 
+00013680: 2020 2265 6332 3a44 6573 6372 6962 652a    "ec2:Describe*
+00013690: 222c 2020 2020 2023 2042 6173 6963 2045  ",     # Basic E
+000136a0: 4332 2072 6561 6420 7065 726d 6973 7369  C2 read permissi
+000136b0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+000136c0: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+000136d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000136e0: 5265 736f 7572 6365 223a 2022 2a22 0a20  Resource": "*". 
+000136f0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00013700: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013710: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00013720: 2020 2020 2020 2020 2245 6666 6563 7422          "Effect"
+00013730: 3a20 2241 6c6c 6f77 222c 0a20 2020 2020  : "Allow",.     
+00013740: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013750: 4163 7469 6f6e 223a 2022 6563 323a 5465  Action": "ec2:Te
+00013760: 726d 696e 6174 6549 6e73 7461 6e63 6573  rminateInstances
+00013770: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00013780: 2020 2020 2020 2022 5265 736f 7572 6365         "Resource
+00013790: 223a 2022 2a22 2c0a 2020 2020 2020 2020  ": "*",.        
+000137a0: 2020 2020 2020 2020 2020 2020 2243 6f6e              "Con
+000137b0: 6469 7469 6f6e 223a 207b 0a20 2020 2020  dition": {.     
+000137c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137d0: 2020 2022 5374 7269 6e67 4571 7561 6c73     "StringEquals
+000137e0: 223a 207b 0a20 2020 2020 2020 2020 2020  ": {.           
+000137f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013800: 2022 6563 323a 5265 736f 7572 6365 5461   "ec2:ResourceTa
+00013810: 672f 4e61 6d65 223a 2022 4672 6f73 7465  g/Name": "Froste
+00013820: 7253 656c 6644 6573 7472 7563 7422 0a20  rSelfDestruct". 
+00013830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013840: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00013850: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00013860: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00013870: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013880: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00013890: 2020 2020 2020 2020 2245 6666 6563 7422          "Effect"
+000138a0: 3a20 2241 6c6c 6f77 222c 0a20 2020 2020  : "Allow",.     
+000138b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000138c0: 4163 7469 6f6e 223a 205b 0a20 2020 2020  Action": [.     
+000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138e0: 2020 2022 6365 3a47 6574 436f 7374 416e     "ce:GetCostAn
+000138f0: 6455 7361 6765 220a 2020 2020 2020 2020  dUsage".        
+00013900: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013920: 2020 2022 5265 736f 7572 6365 223a 2022     "Resource": "
+00013930: 2a22 0a20 2020 2020 2020 2020 2020 2020  *".             
+00013940: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00013950: 205d 0a20 2020 2020 2020 207d 0a20 2020   ].        }.   
+00013960: 2020 2020 2070 6f6c 6963 795f 6e61 6d65       policy_name
+00013970: 203d 2027 4672 6f73 7465 7253 656c 6644   = 'FrosterSelfD
+00013980: 6573 7472 7563 7450 6f6c 6963 7927 0a0a  estructPolicy'..
+00013990: 2020 2020 2020 2020 6465 7374 7275 6374          destruct
+000139a0: 5f70 6f6c 6963 795f 6172 6e20 3d20 7365  _policy_arn = se
+000139b0: 6c66 2e5f 6563 325f 6372 6561 7465 5f6f  lf._ec2_create_o
+000139c0: 725f 6765 745f 6961 6d5f 706f 6c69 6379  r_get_iam_policy
+000139d0: 280a 2020 2020 2020 2020 2020 2020 706f  (.            po
+000139e0: 6c69 6379 5f6e 616d 652c 2070 6f6c 6963  licy_name, polic
+000139f0: 795f 646f 6375 6d65 6e74 290a 0a20 2020  y_document)..   
+00013a00: 2020 2020 2023 2031 2e20 4372 6561 7465       # 1. Create
+00013a10: 2061 6e20 4941 4d20 726f 6c65 0a20 2020   an IAM role.   
+00013a20: 2020 2020 2074 7275 7374 5f70 6f6c 6963       trust_polic
+00013a30: 7920 3d20 7b0a 2020 2020 2020 2020 2020  y = {.          
+00013a40: 2020 2256 6572 7369 6f6e 223a 2022 3230    "Version": "20
+00013a50: 3132 2d31 302d 3137 222c 0a20 2020 2020  12-10-17",.     
+00013a60: 2020 2020 2020 2022 5374 6174 656d 656e         "Statemen
+00013a70: 7422 3a20 5b0a 2020 2020 2020 2020 2020  t": [.          
+00013a80: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+00013a90: 2020 2020 2020 2020 2020 2020 2245 6666              "Eff
+00013aa0: 6563 7422 3a20 2241 6c6c 6f77 222c 0a20  ect": "Allow",. 
+00013ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ac0: 2020 2022 5072 696e 6369 7061 6c22 3a20     "Principal": 
+00013ad0: 7b22 5365 7276 6963 6522 3a20 2265 6332  {"Service": "ec2
+00013ae0: 2e61 6d61 7a6f 6e61 7773 2e63 6f6d 227d  .amazonaws.com"}
+00013af0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013b00: 2020 2020 2020 2241 6374 696f 6e22 3a20        "Action": 
+00013b10: 2273 7473 3a41 7373 756d 6552 6f6c 6522  "sts:AssumeRole"
+00013b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013b30: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+00013b40: 5d0a 2020 2020 2020 2020 7d0a 0a20 2020  ].        }..   
+00013b50: 2020 2020 2072 6f6c 655f 6e61 6d65 203d       role_name =
+00013b60: 2022 4672 6f73 7465 7245 4332 526f 6c65   "FrosterEC2Role
+00013b70: 220a 2020 2020 2020 2020 7472 793a 0a20  ".        try:. 
+00013b80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013b90: 6961 6d5f 636c 6965 6e74 2e63 7265 6174  iam_client.creat
+00013ba0: 655f 726f 6c65 280a 2020 2020 2020 2020  e_role(.        
+00013bb0: 2020 2020 2020 2020 526f 6c65 4e61 6d65          RoleName
+00013bc0: 3d72 6f6c 655f 6e61 6d65 2c0a 2020 2020  =role_name,.    
+00013bd0: 2020 2020 2020 2020 2020 2020 4173 7375              Assu
+00013be0: 6d65 526f 6c65 506f 6c69 6379 446f 6375  meRolePolicyDocu
+00013bf0: 6d65 6e74 3d6a 736f 6e2e 6475 6d70 7328  ment=json.dumps(
+00013c00: 7472 7573 745f 706f 6c69 6379 292c 0a20  trust_policy),. 
+00013c10: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+00013c20: 6573 6372 6970 7469 6f6e 3d27 4672 6f73  escription='Fros
+00013c30: 7465 7220 726f 6c65 2061 6c6c 6f77 7320  ter role allows 
+00013c40: 4269 6c6c 696e 672c 2053 4553 2061 6e64  Billing, SES and
+00013c50: 2054 6572 6d69 6e61 7465 270a 2020 2020   Terminate'.    
+00013c60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013c70: 2020 6578 6365 7074 2073 656c 662e 6961    except self.ia
+00013c80: 6d5f 636c 6965 6e74 2e65 7863 6570 7469  m_client.excepti
+00013c90: 6f6e 732e 456e 7469 7479 416c 7265 6164  ons.EntityAlread
+00013ca0: 7945 7869 7374 7345 7863 6570 7469 6f6e  yExistsException
+00013cb0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00013cc0: 696e 7428 6627 526f 6c65 207b 726f 6c65  int(f'Role {role
+00013cd0: 5f6e 616d 657d 2061 6c72 6561 6479 2065  _name} already e
+00013ce0: 7869 7374 732e 2729 0a20 2020 2020 2020  xists.').       
+00013cf0: 2065 7863 6570 7420 626f 746f 636f 7265   except botocore
+00013d00: 2e65 7863 6570 7469 6f6e 732e 436c 6965  .exceptions.Clie
+00013d10: 6e74 4572 726f 7220 6173 2065 3a0a 2020  ntError as e:.  
+00013d20: 2020 2020 2020 2020 2020 6572 726f 725f            error_
+00013d30: 636f 6465 203d 2065 2e72 6573 706f 6e73  code = e.respons
+00013d40: 655b 2745 7272 6f72 275d 5b27 436f 6465  e['Error']['Code
+00013d50: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+00013d60: 6620 6572 726f 725f 636f 6465 203d 3d20  f error_code == 
+00013d70: 2741 6363 6573 7344 656e 6965 6427 3a0a  'AccessDenied':.
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 7072 696e 7464 6267 280a 2020 2020 2020  printdbg(.      
+00013da0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00013db0: 4163 6365 7373 2064 656e 6965 6421 2050  Access denied! P
+00013dc0: 6c65 6173 6520 6368 6563 6b20 796f 7572  lease check your
+00013dd0: 2049 414d 2070 6572 6d69 7373 696f 6e73   IAM permissions
+00013de0: 2e20 5c6e 2020 2045 7272 6f72 3a20 7b65  . \n   Error: {e
+00013df0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+00013e00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013e10: 2020 2020 2020 7072 696e 7428 6627 436c        print(f'Cl
+00013e20: 6965 6e74 2045 7272 6f72 3a20 7b65 7d27  ient Error: {e}'
+00013e30: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00013e40: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00013e50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00013e60: 6e74 2827 4f74 6865 7220 4572 726f 723a  nt('Other Error:
+00013e70: 272c 2065 290a 0a20 2020 2020 2020 2023  ', e)..        #
+00013e80: 2032 2e20 4174 7461 6368 2070 6572 6d69   2. Attach permi
+00013e90: 7373 696f 6e73 2070 6f6c 6963 6965 7320  ssions policies 
+00013ea0: 746f 2074 6865 2049 414d 2072 6f6c 650a  to the IAM role.
+00013eb0: 2020 2020 2020 2020 636f 7374 5f65 7870          cost_exp
+00013ec0: 6c6f 7265 725f 706f 6c69 6379 203d 2022  lorer_policy = "
+00013ed0: 6172 6e3a 6177 733a 6961 6d3a 3a61 7773  arn:aws:iam::aws
+00013ee0: 3a70 6f6c 6963 792f 4157 5342 696c 6c69  :policy/AWSBilli
+00013ef0: 6e67 5265 6164 4f6e 6c79 4163 6365 7373  ngReadOnlyAccess
+00013f00: 220a 2020 2020 2020 2020 7365 735f 706f  ".        ses_po
+00013f10: 6c69 6379 203d 2022 6172 6e3a 6177 733a  licy = "arn:aws:
+00013f20: 6961 6d3a 3a61 7773 3a70 6f6c 6963 792f  iam::aws:policy/
+00013f30: 416d 617a 6f6e 5345 5346 756c 6c41 6363  AmazonSESFullAcc
+00013f40: 6573 7322 0a0a 2020 2020 2020 2020 7472  ess"..        tr
+00013f50: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+00013f60: 7365 6c66 2e69 616d 5f63 6c69 656e 742e  self.iam_client.
+00013f70: 6174 7461 6368 5f72 6f6c 655f 706f 6c69  attach_role_poli
+00013f80: 6379 280a 2020 2020 2020 2020 2020 2020  cy(.            
+00013f90: 2020 2020 526f 6c65 4e61 6d65 3d72 6f6c      RoleName=rol
+00013fa0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+00013fb0: 2020 2020 2020 2020 506f 6c69 6379 4172          PolicyAr
+00013fc0: 6e3d 636f 7374 5f65 7870 6c6f 7265 725f  n=cost_explorer_
+00013fd0: 706f 6c69 6379 0a20 2020 2020 2020 2020  policy.         
+00013fe0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00013ff0: 2020 7365 6c66 2e69 616d 5f63 6c69 656e    self.iam_clien
+00014000: 742e 6174 7461 6368 5f72 6f6c 655f 706f  t.attach_role_po
+00014010: 6c69 6379 280a 2020 2020 2020 2020 2020  licy(.          
+00014020: 2020 2020 2020 526f 6c65 4e61 6d65 3d72        RoleName=r
+00014030: 6f6c 655f 6e61 6d65 2c0a 2020 2020 2020  ole_name,.      
+00014040: 2020 2020 2020 2020 2020 506f 6c69 6379            Policy
+00014050: 4172 6e3d 7365 735f 706f 6c69 6379 0a20  Arn=ses_policy. 
+00014060: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00014070: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00014080: 616d 5f63 6c69 656e 742e 6174 7461 6368  am_client.attach
+00014090: 5f72 6f6c 655f 706f 6c69 6379 280a 2020  _role_policy(.  
+000140a0: 2020 2020 2020 2020 2020 2020 2020 526f                Ro
+000140b0: 6c65 4e61 6d65 3d72 6f6c 655f 6e61 6d65  leName=role_name
+000140c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000140d0: 2020 506f 6c69 6379 4172 6e3d 6465 7374    PolicyArn=dest
+000140e0: 7275 6374 5f70 6f6c 6963 795f 6172 6e0a  ruct_policy_arn.
+000140f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00014100: 2020 2020 2020 6578 6365 7074 2073 656c        except sel
+00014110: 662e 6961 6d5f 636c 6965 6e74 2e65 7863  f.iam_client.exc
+00014120: 6570 7469 6f6e 732e 506f 6c69 6379 4e6f  eptions.PolicyNo
+00014130: 7441 7474 6163 6861 626c 6545 7863 6570  tAttachableExcep
+00014140: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00014150: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00014160: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00014170: 506f 6c69 6379 207b 652e 706f 6c69 6379  Policy {e.policy
+00014180: 5f61 726e 7d20 6973 206e 6f74 2061 7474  _arn} is not att
+00014190: 6163 6861 626c 652e 2050 6c65 6173 6520  achable. Please 
+000141a0: 6368 6563 6b20 796f 7572 2070 6572 6d69  check your permi
+000141b0: 7373 696f 6e73 2e22 290a 2020 2020 2020  ssions.").      
+000141c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000141d0: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
+000141e0: 7420 626f 746f 636f 7265 2e65 7863 6570  t botocore.excep
+000141f0: 7469 6f6e 732e 436c 6965 6e74 4572 726f  tions.ClientErro
+00014200: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+00014210: 2020 2020 6572 726f 725f 636f 6465 203d      error_code =
+00014220: 2065 2e72 6573 706f 6e73 655b 2745 7272   e.response['Err
+00014230: 6f72 275d 5b27 436f 6465 275d 0a20 2020  or']['Code'].   
+00014240: 2020 2020 2020 2020 2069 6620 6572 726f           if erro
+00014250: 725f 636f 6465 203d 3d20 2741 6363 6573  r_code == 'Acces
+00014260: 7344 656e 6965 6427 3a0a 2020 2020 2020  sDenied':.      
+00014270: 2020 2020 2020 2020 2020 7072 696e 7464            printd
+00014280: 6267 280a 2020 2020 2020 2020 2020 2020  bg(.            
+00014290: 2020 2020 2020 2020 6627 4163 6365 7373          f'Access
+000142a0: 2064 656e 6965 6421 2050 6c65 6173 6520   denied! Please 
+000142b0: 6368 6563 6b20 796f 7572 2049 414d 2070  check your IAM p
+000142c0: 6572 6d69 7373 696f 6e73 2e20 5c6e 2020  ermissions. \n  
+000142d0: 2045 7272 6f72 3a20 7b65 7d27 290a 2020   Error: {e}').  
+000142e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 7072 696e 7428 6627 436c 6965 6e74 2045  print(f'Client E
+00014310: 7272 6f72 3a20 7b65 7d27 290a 2020 2020  rror: {e}').    
+00014320: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00014330: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00014340: 2020 2020 2020 2070 7269 6e74 2827 4f74         print('Ot
+00014350: 6865 7220 4572 726f 723a 272c 2065 290a  her Error:', e).
+00014360: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014370: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00014380: 2023 2033 2e20 4372 6561 7465 2061 6e20   # 3. Create an 
+00014390: 696e 7374 616e 6365 2070 726f 6669 6c65  instance profile
+000143a0: 2061 6e64 2061 7373 6f63 6961 7465 2069   and associate i
+000143b0: 7420 7769 7468 2074 6865 2072 6f6c 650a  t with the role.
+000143c0: 2020 2020 2020 2020 696e 7374 616e 6365          instance
+000143d0: 5f70 726f 6669 6c65 5f6e 616d 6520 3d20  _profile_name = 
+000143e0: 2246 726f 7374 6572 4543 3250 726f 6669  "FrosterEC2Profi
+000143f0: 6c65 220a 2020 2020 2020 2020 7472 793a  le".        try:
+00014400: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014410: 662e 6961 6d5f 636c 6965 6e74 2e63 7265  f.iam_client.cre
+00014420: 6174 655f 696e 7374 616e 6365 5f70 726f  ate_instance_pro
+00014430: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
+00014440: 2020 2020 2020 496e 7374 616e 6365 5072        InstancePr
+00014450: 6f66 696c 654e 616d 653d 696e 7374 616e  ofileName=instan
+00014460: 6365 5f70 726f 6669 6c65 5f6e 616d 650a  ce_profile_name.
+00014470: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00014480: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00014490: 616d 5f63 6c69 656e 742e 6164 645f 726f  am_client.add_ro
+000144a0: 6c65 5f74 6f5f 696e 7374 616e 6365 5f70  le_to_instance_p
+000144b0: 726f 6669 6c65 280a 2020 2020 2020 2020  rofile(.        
+000144c0: 2020 2020 2020 2020 496e 7374 616e 6365          Instance
+000144d0: 5072 6f66 696c 654e 616d 653d 696e 7374  ProfileName=inst
+000144e0: 616e 6365 5f70 726f 6669 6c65 5f6e 616d  ance_profile_nam
+000144f0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00014500: 2020 2052 6f6c 654e 616d 653d 726f 6c65     RoleName=role
+00014510: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
+00014520: 2020 290a 2020 2020 2020 2020 6578 6365    ).        exce
+00014530: 7074 2073 656c 662e 6961 6d5f 636c 6965  pt self.iam_clie
+00014540: 6e74 2e65 7863 6570 7469 6f6e 732e 456e  nt.exceptions.En
+00014550: 7469 7479 416c 7265 6164 7945 7869 7374  tityAlreadyExist
+00014560: 7345 7863 6570 7469 6f6e 3a0a 2020 2020  sException:.    
+00014570: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00014580: 5072 6f66 696c 6520 7b69 6e73 7461 6e63  Profile {instanc
+00014590: 655f 7072 6f66 696c 655f 6e61 6d65 7d20  e_profile_name} 
+000145a0: 616c 7265 6164 7920 6578 6973 7473 2e27  already exists.'
+000145b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000145c0: 7475 726e 2069 6e73 7461 6e63 655f 7072  turn instance_pr
+000145d0: 6f66 696c 655f 6e61 6d65 0a20 2020 2020  ofile_name.     
+000145e0: 2020 2065 7863 6570 7420 626f 746f 636f     except botoco
+000145f0: 7265 2e65 7863 6570 7469 6f6e 732e 436c  re.exceptions.Cl
+00014600: 6965 6e74 4572 726f 7220 6173 2065 3a0a  ientError as e:.
+00014610: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00014620: 725f 636f 6465 203d 2065 2e72 6573 706f  r_code = e.respo
+00014630: 6e73 655b 2745 7272 6f72 275d 5b27 436f  nse['Error']['Co
+00014640: 6465 275d 0a20 2020 2020 2020 2020 2020  de'].           
+00014650: 2069 6620 6572 726f 725f 636f 6465 203d   if error_code =
+00014660: 3d20 2741 6363 6573 7344 656e 6965 6427  = 'AccessDenied'
+00014670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014680: 2020 7072 696e 7464 6267 280a 2020 2020    printdbg(.    
+00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146a0: 6627 4163 6365 7373 2064 656e 6965 6421  f'Access denied!
+000146b0: 2050 6c65 6173 6520 6368 6563 6b20 796f   Please check yo
+000146c0: 7572 2049 414d 2070 6572 6d69 7373 696f  ur IAM permissio
+000146d0: 6e73 2e20 5c6e 2020 2045 7272 6f72 3a20  ns. \n   Error: 
+000146e0: 7b65 7d27 290a 2020 2020 2020 2020 2020  {e}').          
+000146f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00014700: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00014710: 436c 6965 6e74 2045 7272 6f72 3a20 7b65  Client Error: {e
+00014720: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+00014730: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+00014740: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00014750: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00014760: 2020 2020 2020 2070 7269 6e74 2827 4f74         print('Ot
+00014770: 6865 7220 4572 726f 723a 272c 2065 290a  her Error:', e).
+00014780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014790: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
+000147a0: 2023 2047 6976 6520 4157 5320 6120 6d6f   # Give AWS a mo
+000147b0: 6d65 6e74 2074 6f20 7072 6f70 6167 6174  ment to propagat
+000147c0: 6520 7468 6520 6368 616e 6765 730a 2020  e the changes.  
+000147d0: 2020 2020 2020 7072 696e 7428 2777 6169        print('wai
+000147e0: 7420 666f 7220 3135 2073 6563 202e 2e2e  t for 15 sec ...
+000147f0: 2729 0a20 2020 2020 2020 2074 696d 652e  ').        time.
+00014800: 736c 6565 7028 3135 2920 2023 2057 6169  sleep(15)  # Wai
+00014810: 7420 666f 7220 3135 2073 6563 6f6e 6473  t for 15 seconds
+00014820: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00014830: 2069 6e73 7461 6e63 655f 7072 6f66 696c   instance_profil
+00014840: 655f 6e61 6d65 0a0a 2020 2020 6465 6620  e_name..    def 
+00014850: 5f65 6332 5f63 7265 6174 655f 616e 645f  _ec2_create_and_
+00014860: 6174 7461 6368 5f73 6563 7572 6974 795f  attach_security_
+00014870: 6772 6f75 7028 7365 6c66 2c20 696e 7374  group(self, inst
+00014880: 616e 6365 5f69 6429 3a0a 0a20 2020 2020  ance_id):..     
+00014890: 2020 2065 6332 5f72 6573 6f75 7263 6520     ec2_resource 
+000148a0: 3d20 7365 6c66 2e73 6573 7369 6f6e 2e72  = self.session.r
+000148b0: 6573 6f75 7263 6528 2765 6332 2729 0a20  esource('ec2'). 
+000148c0: 2020 2020 2020 2067 726f 7570 5f6e 616d         group_nam
+000148d0: 6520 3d20 2753 5348 2d48 5454 502d 4943  e = 'SSH-HTTP-IC
+000148e0: 4d50 270a 0a20 2020 2020 2020 2023 2043  MP'..        # C
+000148f0: 6865 636b 2069 6620 7365 6375 7269 7479  heck if security
+00014900: 2067 726f 7570 2061 6c72 6561 6479 2065   group already e
+00014910: 7869 7374 730a 2020 2020 2020 2020 7365  xists.        se
+00014920: 6375 7269 7479 5f67 726f 7570 7320 3d20  curity_groups = 
+00014930: 7365 6c66 2e65 6332 5f63 6c69 656e 742e  self.ec2_client.
+00014940: 6465 7363 7269 6265 5f73 6563 7572 6974  describe_securit
+00014950: 795f 6772 6f75 7073 280a 2020 2020 2020  y_groups(.      
+00014960: 2020 2020 2020 4669 6c74 6572 733d 5b7b        Filters=[{
+00014970: 274e 616d 6527 3a20 2767 726f 7570 2d6e  'Name': 'group-n
+00014980: 616d 6527 2c20 2756 616c 7565 7327 3a20  ame', 'Values': 
+00014990: 5b67 726f 7570 5f6e 616d 655d 7d5d 290a  [group_name]}]).
+000149a0: 2020 2020 2020 2020 6966 2073 6563 7572          if secur
+000149b0: 6974 795f 6772 6f75 7073 5b27 5365 6375  ity_groups['Secu
+000149c0: 7269 7479 4772 6f75 7073 275d 3a0a 2020  rityGroups']:.  
+000149d0: 2020 2020 2020 2020 2020 7365 6375 7269            securi
+000149e0: 7479 5f67 726f 7570 5f69 6420 3d20 7365  ty_group_id = se
+000149f0: 6375 7269 7479 5f67 726f 7570 735b 2753  curity_groups['S
+00014a00: 6563 7572 6974 7947 726f 7570 7327 5d5b  ecurityGroups'][
+00014a10: 305d 5b27 4772 6f75 7049 6427 5d0a 2020  0]['GroupId'].  
+00014a20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014a30: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+00014a40: 2073 6563 7572 6974 7920 6772 6f75 700a   security group.
+00014a50: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+00014a60: 6f6e 7365 203d 2073 656c 662e 6563 325f  onse = self.ec2_
+00014a70: 636c 6965 6e74 2e63 7265 6174 655f 7365  client.create_se
+00014a80: 6375 7269 7479 5f67 726f 7570 280a 2020  curity_group(.  
+00014a90: 2020 2020 2020 2020 2020 2020 2020 4772                Gr
+00014aa0: 6f75 704e 616d 653d 6772 6f75 705f 6e61  oupName=group_na
+00014ab0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00014ac0: 2020 2020 4465 7363 7269 7074 696f 6e3d      Description=
+00014ad0: 2741 6c6c 6f77 7320 5353 4820 616e 6420  'Allows SSH and 
+00014ae0: 4943 4d50 2069 6e62 6f75 6e64 2074 7261  ICMP inbound tra
+00014af0: 6666 6963 270a 2020 2020 2020 2020 2020  ffic'.          
+00014b00: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00014b10: 7365 6375 7269 7479 5f67 726f 7570 5f69  security_group_i
+00014b20: 6420 3d20 7265 7370 6f6e 7365 5b27 4772  d = response['Gr
+00014b30: 6f75 7049 6427 5d0a 0a20 2020 2020 2020  oupId']..       
+00014b40: 2020 2020 2023 2041 6c6c 6f77 2070 6f72       # Allow por
+00014b50: 7473 2032 322c 2038 302c 2034 3433 2c20  ts 22, 80, 443, 
+00014b60: 3830 3030 2d39 3030 302c 2049 434d 500a  8000-9000, ICMP.
+00014b70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014b80: 2e65 6332 5f63 6c69 656e 742e 6175 7468  .ec2_client.auth
+00014b90: 6f72 697a 655f 7365 6375 7269 7479 5f67  orize_security_g
+00014ba0: 726f 7570 5f69 6e67 7265 7373 280a 2020  roup_ingress(.  
+00014bb0: 2020 2020 2020 2020 2020 2020 2020 4772                Gr
+00014bc0: 6f75 7049 643d 7365 6375 7269 7479 5f67  oupId=security_g
+00014bd0: 726f 7570 5f69 642c 0a20 2020 2020 2020  roup_id,.       
+00014be0: 2020 2020 2020 2020 2049 7050 6572 6d69           IpPermi
+00014bf0: 7373 696f 6e73 3d5b 0a20 2020 2020 2020  ssions=[.       
+00014c00: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+00014c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c20: 2020 2020 2020 2027 4970 5072 6f74 6f63         'IpProtoc
+00014c30: 6f6c 273a 2027 7463 7027 2c0a 2020 2020  ol': 'tcp',.    
+00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c50: 2020 2020 2746 726f 6d50 6f72 7427 3a20      'FromPort': 
+00014c60: 3232 2c0a 2020 2020 2020 2020 2020 2020  22,.            
+00014c70: 2020 2020 2020 2020 2020 2020 2754 6f50              'ToP
+00014c80: 6f72 7427 3a20 3232 2c0a 2020 2020 2020  ort': 22,.      
+00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ca0: 2020 2749 7052 616e 6765 7327 3a20 5b7b    'IpRanges': [{
+00014cb0: 2743 6964 7249 7027 3a20 2730 2e30 2e30  'CidrIp': '0.0.0
+00014cc0: 2e30 2f30 277d 5d0a 2020 2020 2020 2020  .0/0'}].        
+00014cd0: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
+00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cf0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00014d00: 2020 2020 2020 2020 2020 2020 2027 4970               'Ip
+00014d10: 5072 6f74 6f63 6f6c 273a 2027 7463 7027  Protocol': 'tcp'
+00014d20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014d30: 2020 2020 2020 2020 2020 2746 726f 6d50            'FromP
+00014d40: 6f72 7427 3a20 3830 2c0a 2020 2020 2020  ort': 80,.      
+00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d60: 2020 2754 6f50 6f72 7427 3a20 3830 2c0a    'ToPort': 80,.
+00014d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d80: 2020 2020 2020 2020 2749 7052 616e 6765          'IpRange
+00014d90: 7327 3a20 5b7b 2743 6964 7249 7027 3a20  s': [{'CidrIp': 
+00014da0: 2730 2e30 2e30 2e30 2f30 277d 5d0a 2020  '0.0.0.0/0'}].  
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+00014dd0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 2027 4970 5072 6f74 6f63 6f6c 273a     'IpProtocol':
+00014e00: 2027 7463 7027 2c0a 2020 2020 2020 2020   'tcp',.        
+00014e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e20: 2746 726f 6d50 6f72 7427 3a20 3434 332c  'FromPort': 443,
+00014e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014e40: 2020 2020 2020 2020 2027 546f 506f 7274           'ToPort
+00014e50: 273a 2034 3433 2c0a 2020 2020 2020 2020  ': 443,.        
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2749 7052 616e 6765 7327 3a20 5b7b 2743  'IpRanges': [{'C
+00014e80: 6964 7249 7027 3a20 2730 2e30 2e30 2e30  idrIp': '0.0.0.0
+00014e90: 2f30 277d 5d0a 2020 2020 2020 2020 2020  /0'}].          
+00014ea0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ec0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00014ed0: 2020 2020 2020 2020 2020 2027 4970 5072             'IpPr
+00014ee0: 6f74 6f63 6f6c 273a 2027 7463 7027 2c0a  otocol': 'tcp',.
 00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f00: 2020 2020 2020 2070 7269 6e74 2827 646f         print('do
-00014f10: 6e65 2729 0a20 2020 2020 2020 2020 2020  ne').           
-00014f20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f40: 2020 2020 2020 2070 7269 6e74 2827 6e6f         print('no
-00014f50: 7468 696e 6720 746f 2072 656d 6f76 6527  thing to remove'
-00014f60: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00014f70: 2020 2070 7269 6e74 2866 272e 2e2e 666f     print(f'...fo
-00014f80: 6c64 6572 207b 726f 6f74 7d20 7265 7365  lder {root} rese
-00014f90: 7420 7375 6363 6573 7366 756c 6c79 5c6e  t successfully\n
-00014fa0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-00014fb0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00014fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014fd0: 2020 7072 696e 745f 6572 726f 7228 290a    print_error().
-00014fe0: 0a20 2020 2064 6566 205f 6973 5f73 6d61  .    def _is_sma
-00014ff0: 6c6c 5f66 696c 655f 696e 5f64 6972 2873  ll_file_in_dir(s
-00015000: 656c 662c 2064 6972 2c20 736d 616c 6c3d  elf, dir, small=
-00015010: 3130 3234 293a 0a20 2020 2020 2020 2023  1024):.        #
-00015020: 2047 6574 2061 6c6c 2066 696c 6573 2069   Get all files i
-00015030: 6e20 7468 6520 7370 6563 6966 6965 6420  n the specified 
-00015040: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-00015050: 2020 6669 6c65 7320 3d20 5b6f 732e 7061    files = [os.pa
-00015060: 7468 2e6a 6f69 6e28 6469 722c 2066 2920  th.join(dir, f) 
-00015070: 666f 7220 6620 696e 206f 732e 6c69 7374  for f in os.list
-00015080: 6469 7228 0a20 2020 2020 2020 2020 2020  dir(.           
-00015090: 2064 6972 2920 6966 206f 732e 7061 7468   dir) if os.path
-000150a0: 2e69 7366 696c 6528 6f73 2e70 6174 682e  .isfile(os.path.
-000150b0: 6a6f 696e 2864 6972 2c20 6629 295d 0a20  join(dir, f))]. 
-000150c0: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-000150d0: 2a2a 2066 696c 6573 3a22 2c66 696c 6573  ** files:",files
-000150e0: 290a 2020 2020 2020 2020 2320 4368 6563  ).        # Chec
-000150f0: 6b20 6966 2074 6865 7265 2773 2061 6e79  k if there's any
-00015100: 2066 696c 6520 6c65 7373 2074 6861 6e20   file less than 
-00015110: 736d 616c 6c0a 2020 2020 2020 2020 6973  small.        is
-00015120: 5f74 6865 7265 5f73 6d61 6c6c 5f66 696c  _there_small_fil
-00015130: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
-00015140: 2020 666f 7220 6620 696e 2066 696c 6573    for f in files
-00015150: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00015160: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00015170: 2020 2073 2c20 2a5f 203d 2073 656c 662e     s, *_ = self.
-00015180: 5f67 6574 5f66 696c 655f 7374 6174 7328  _get_file_stats(
-00015190: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
-000151a0: 2020 2069 6620 7320 3c20 736d 616c 6c2a     if s < small*
-000151b0: 3130 3234 3a0a 2020 2020 2020 2020 2020  1024:.          
-000151c0: 2020 2020 2020 2020 2020 6973 5f74 6865            is_the
-000151d0: 7265 5f73 6d61 6c6c 5f66 696c 6520 3d20  re_small_file = 
-000151e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000151f0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00015200: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00015210: 7420 4669 6c65 4e6f 7446 6f75 6e64 4572  t FileNotFoundEr
-00015220: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00015230: 2020 2020 2023 2048 616e 646c 6520 7468       # Handle th
-00015240: 6520 6572 726f 7220 2865 2e67 2e2c 2070  e error (e.g., p
-00015250: 7269 6e74 2061 206d 6573 7361 6765 206f  rint a message o
-00015260: 7220 636f 6e74 696e 7565 2074 6f20 7468  r continue to th
-00015270: 6520 6e65 7874 2066 696c 6529 0a20 2020  e next file).   
-00015280: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00015290: 6e74 2866 2246 696c 6520 6e6f 7420 666f  nt(f"File not fo
-000152a0: 756e 643a 207b 667d 2229 0a20 2020 2020  und: {f}").     
-000152b0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-000152c0: 6e75 650a 2020 2020 2020 2020 7265 7475  nue.        retu
-000152d0: 726e 2069 735f 7468 6572 655f 736d 616c  rn is_there_smal
-000152e0: 6c5f 6669 6c65 0a0a 2020 2020 6465 6620  l_file..    def 
-000152f0: 5f67 6574 5f66 696c 655f 7374 6174 7328  _get_file_stats(
-00015300: 7365 6c66 2c20 6669 6c65 7061 7468 293a  self, filepath):
-00015310: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00015320: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
-00015330: 6c73 7461 7420 746f 2067 6574 2073 7461  lstat to get sta
-00015340: 7473 206f 6620 7379 6d6c 696e 6b20 6974  ts of symlink it
-00015350: 7365 6c66 2c20 6e6f 7420 7468 6520 6669  self, not the fi
-00015360: 6c65 2069 7420 706f 696e 7473 2074 6f0a  le it points to.
-00015370: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-00015380: 7320 3d20 6f73 2e6c 7374 6174 2866 696c  s = os.lstat(fil
-00015390: 6570 6174 6829 0a20 2020 2020 2020 2020  epath).         
-000153a0: 2020 2072 6574 7572 6e20 7374 6174 732e     return stats.
-000153b0: 7374 5f73 697a 652c 2073 7461 7473 2e73  st_size, stats.s
-000153c0: 745f 6d74 696d 652c 2073 7461 7473 2e73  t_mtime, stats.s
-000153d0: 745f 6174 696d 650a 2020 2020 2020 2020  t_atime.        
-000153e0: 6578 6365 7074 2046 696c 654e 6f74 466f  except FileNotFo
-000153f0: 756e 6445 7272 6f72 3a0a 2020 2020 2020  undError:.      
-00015400: 2020 2020 2020 7072 696e 7428 6622 7b66        print(f"{f
-00015410: 696c 6570 6174 687d 206e 6f74 2066 6f75  ilepath} not fou
-00015420: 6e64 2e22 290a 2020 2020 2020 2020 2020  nd.").          
-00015430: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
-00015440: 6f6e 652c 204e 6f6e 650a 0a20 2020 2064  one, None..    d
-00015450: 6566 2064 656c 6574 655f 6c6f 6361 6c6c  ef delete_locall
-00015460: 7928 7365 6c66 2c20 666f 6c64 6572 5f74  y(self, folder_t
-00015470: 6f5f 6465 6c65 7465 293a 0a20 2020 2020  o_delete):.     
-00015480: 2020 2027 2727 4465 6c65 7465 2074 6865     '''Delete the
-00015490: 2067 6976 656e 2066 6f6c 6465 7227 2727   given folder'''
-000154a0: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-000154b0: 6627 5c6e 4445 4c45 5449 4e47 207b 666f  f'\nDELETING {fo
-000154c0: 6c64 6572 5f74 6f5f 6465 6c65 7465 7d2e  lder_to_delete}.
-000154d0: 2e2e 2729 0a0a 2020 2020 2020 2020 6172  ..')..        ar
-000154e0: 6368 6976 6564 5f66 6f6c 6465 725f 696e  chived_folder_in
-000154f0: 666f 203d 2073 656c 662e 6172 6368 6976  fo = self.archiv
-00015500: 655f 6a73 6f6e 5f67 6574 5f72 6f77 2866  e_json_get_row(f
-00015510: 6f6c 6465 725f 746f 5f64 656c 6574 6529  older_to_delete)
-00015520: 0a0a 2020 2020 2020 2020 6966 2061 7263  ..        if arc
-00015530: 6869 7665 645f 666f 6c64 6572 5f69 6e66  hived_folder_inf
-00015540: 6f20 6973 204e 6f6e 653a 0a20 2020 2020  o is None:.     
-00015550: 2020 2020 2020 2070 7269 6e74 2866 275c         print(f'\
-00015560: 6e46 6f6c 6465 7220 7b66 6f6c 6465 725f  nFolder {folder_
-00015570: 746f 5f64 656c 6574 657d 2069 7320 6e6f  to_delete} is no
-00015580: 7420 6172 6368 6976 6564 2729 0a20 2020  t archived').   
-00015590: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-000155a0: 274e 6f20 656e 7472 7920 666f 756e 6420  'No entry found 
-000155b0: 696e 2066 726f 7374 6572 2d61 7263 6869  in froster-archi
-000155c0: 7665 732e 6a73 6f6e 5c6e 2729 0a20 2020  ves.json\n').   
-000155d0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-000155e0: 0a20 2020 2020 2020 2074 7279 3a0a 0a20  .        try:.. 
-000155f0: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-00015600: 2074 6865 2070 6174 6820 746f 2074 6865   the path to the
-00015610: 2068 6173 6820 6669 6c65 0a20 2020 2020   hash file.     
-00015620: 2020 2020 2020 2068 6173 6866 696c 6520         hashfile 
-00015630: 3d20 6f73 2e70 6174 682e 6a6f 696e 2866  = os.path.join(f
-00015640: 6f6c 6465 725f 746f 5f64 656c 6574 652c  older_to_delete,
-00015650: 2073 656c 662e 6d64 3573 756d 5f66 696c   self.md5sum_fil
-00015660: 656e 616d 6529 0a0a 2020 2020 2020 2020  ename)..        
-00015670: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
-00015680: 6865 2068 6173 6866 696c 6520 6578 6973  he hashfile exis
-00015690: 7473 0a20 2020 2020 2020 2020 2020 2069  ts.            i
-000156a0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-000156b0: 6973 7473 2868 6173 6866 696c 6529 3a0a  ists(hashfile):.
-000156c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000156d0: 2023 2052 6567 756c 6172 2068 6173 6866   # Regular hashf
-000156e0: 696c 6520 646f 6573 206e 6f74 2065 7869  ile does not exi
-000156f0: 7374 2c20 6368 6563 6b20 6966 2074 6865  st, check if the
-00015700: 2072 6573 746f 7265 6420 6861 7368 6669   restored hashfi
-00015710: 6c65 2065 7869 7374 730a 2020 2020 2020  le exists.      
-00015720: 2020 2020 2020 2020 2020 6861 7368 6669            hashfi
-00015730: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
-00015740: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00015750: 2020 2020 2020 2066 6f6c 6465 725f 746f         folder_to
-00015760: 5f64 656c 6574 652c 2073 656c 662e 6d64  _delete, self.md
-00015770: 3573 756d 5f72 6573 746f 7265 645f 6669  5sum_restored_fi
-00015780: 6c65 6e61 6d65 290a 0a20 2020 2020 2020  lename)..       
-00015790: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000157a0: 6f73 2e70 6174 682e 6578 6973 7473 2868  os.path.exists(h
-000157b0: 6173 6866 696c 6529 3a0a 2020 2020 2020  ashfile):.      
-000157c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000157d0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-000157e0: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-000157f0: 6865 7265 2069 7320 6e6f 2068 6173 6866  here is no hashf
-00015800: 696c 6520 7468 6572 6566 6f72 6520 6361  ile therefore ca
-00015810: 6e6e 6f74 2064 656c 6574 6520 6669 6c65  nnot delete file
-00015820: 7320 696e 207b 666f 6c64 6572 5f74 6f5f  s in {folder_to_
-00015830: 6465 6c65 7465 7d27 290a 2020 2020 2020  delete}').      
-00015840: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015850: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
-00015860: 2020 2320 4765 7420 7468 6520 7375 6266    # Get the subf
-00015870: 6f6c 6465 7220 7061 7468 0a20 2020 2020  older path.     
-00015880: 2020 2020 2020 2073 7562 666f 6c64 6572         subfolder
-00015890: 5f70 6174 6820 3d20 666f 6c64 6572 5f74  _path = folder_t
-000158a0: 6f5f 6465 6c65 7465 2e72 6570 6c61 6365  o_delete.replace
-000158b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000158c0: 2020 6172 6368 6976 6564 5f66 6f6c 6465    archived_folde
-000158d0: 725f 696e 666f 5b27 6c6f 6361 6c5f 666f  r_info['local_fo
-000158e0: 6c64 6572 275d 2c20 2727 290a 0a20 2020  lder'], '')..   
-000158f0: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
-00015900: 6865 2070 6174 6820 746f 2074 6865 2053  he path to the S
-00015910: 3320 6465 7374 696e 6174 696f 6e0a 2020  3 destination.  
-00015920: 2020 2020 2020 2020 2020 2320 5269 736b            # Risk
-00015930: 792c 2062 7574 206f 732e 7061 6874 2e6a  y, but os.paht.j
-00015940: 6f69 6e20 646f 6573 206e 6f74 2077 6f72  oin does not wor
-00015950: 6b20 7769 7468 203a 7333 3a20 7061 7468  k with :s3: path
-00015960: 730a 2020 2020 2020 2020 2020 2020 7333  s.            s3
-00015970: 5f64 6573 7420 3d20 6172 6368 6976 6564  _dest = archived
-00015980: 5f66 6f6c 6465 725f 696e 666f 5b27 6172  _folder_info['ar
-00015990: 6368 6976 655f 666f 6c64 6572 275d 202b  chive_folder'] +
-000159a0: 2073 7562 666f 6c64 6572 5f70 6174 680a   subfolder_path.
-000159b0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000159c0: 6e74 2866 275c 6e20 2020 2056 6572 6966  nt(f'\n    Verif
-000159d0: 7969 6e67 2063 6865 636b 7375 6d73 2e2e  ying checksums..
-000159e0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-000159f0: 7263 6c6f 6e65 203d 2052 636c 6f6e 6528  rclone = Rclone(
-00015a00: 7365 6c66 2e61 7267 732c 2073 656c 662e  self.args, self.
-00015a10: 6366 6729 0a20 2020 2020 2020 2020 2020  cfg).           
-00015a20: 2072 6574 203d 2072 636c 6f6e 652e 6368   ret = rclone.ch
-00015a30: 6563 6b73 756d 2868 6173 6866 696c 652c  ecksum(hashfile,
-00015a40: 2073 335f 6465 7374 2c20 272d 2d6d 6178   s3_dest, '--max
-00015a50: 2d64 6570 7468 272c 2027 3127 290a 2020  -depth', '1').  
-00015a60: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00015a70: 6b20 6966 2074 6865 2063 6865 636b 7375  k if the checksu
-00015a80: 6d73 2061 7265 2063 6f72 7265 6374 0a20  ms are correct. 
-00015a90: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00015aa0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00015ab0: 2020 2070 7269 6e74 2827 2020 2020 2e2e     print('    ..
-00015ac0: 2e64 6f6e 6527 290a 2020 2020 2020 2020  .done').        
-00015ad0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00015ae0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015af0: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00015b00: 6c65 7465 645f 6669 6c65 7320 3d20 5b5d  leted_files = []
-00015b10: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00015b20: 4465 6c65 7465 2074 6865 2066 696c 6573  Delete the files
-00015b30: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00015b40: 2072 6f6f 742c 2064 6972 732c 2066 696c   root, dirs, fil
-00015b50: 6573 2069 6e20 7365 6c66 2e5f 7761 6c6b  es in self._walk
-00015b60: 6572 2866 6f6c 6465 725f 746f 5f64 656c  er(folder_to_del
-00015b70: 6574 6529 3a0a 2020 2020 2020 2020 2020  ete):.          
-00015b80: 2020 2020 2020 6966 2072 6f6f 7420 213d        if root !=
-00015b90: 2066 6f6c 6465 725f 746f 5f64 656c 6574   folder_to_delet
-00015ba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00015bb0: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-00015bc0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00015bd0: 696e 7428 6627 5c6e 2020 2020 4465 6c65  int(f'\n    Dele
-00015be0: 7469 6e67 2066 696c 6573 2e2e 2e27 290a  ting files...').
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c00: 666f 7220 6669 6c65 2069 6e20 6669 6c65  for file in file
-00015c10: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00015c20: 2020 2020 2020 2069 6620 6669 6c65 203d         if file =
-00015c30: 3d20 7365 6c66 2e6d 6435 7375 6d5f 6669  = self.md5sum_fi
-00015c40: 6c65 6e61 6d65 206f 7220 6669 6c65 203d  lename or file =
-00015c50: 3d20 7365 6c66 2e6d 6435 7375 6d5f 7265  = self.md5sum_re
-00015c60: 7374 6f72 6564 5f66 696c 656e 616d 6520  stored_filename 
-00015c70: 6f72 2066 696c 6520 3d3d 2073 656c 662e  or file == self.
-00015c80: 616c 6c66 696c 6573 5f63 7376 5f66 696c  allfiles_csv_fil
-00015c90: 656e 616d 6520 6f72 2066 696c 6520 3d3d  ename or file ==
-00015ca0: 2073 656c 662e 7768 6572 655f 6469 645f   self.where_did_
-00015cb0: 7468 655f 6669 6c65 735f 676f 5f66 696c  the_files_go_fil
-00015cc0: 656e 616d 653a 0a20 2020 2020 2020 2020  ename:.         
-00015cd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015ce0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00015cf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00015d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015d10: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-00015d20: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
-00015d30: 696e 2872 6f6f 742c 2066 696c 6529 0a20  in(root, file). 
-00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d50: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00015d60: 2866 696c 655f 7061 7468 290a 2020 2020  (file_path).    
-00015d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d80: 2020 2020 6465 6c65 7465 645f 6669 6c65      deleted_file
-00015d90: 732e 6170 7065 6e64 2866 696c 6529 0a20  s.append(file). 
-00015da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00015db0: 7269 6e74 2866 2720 2020 2020 2020 202e  rint(f'        .
-00015dc0: 2e2e 646f 6e65 2729 0a0a 2020 2020 2020  ..done')..      
-00015dd0: 2020 2020 2020 2320 5772 6974 6520 6120        # Write a 
-00015de0: 7265 6164 6d65 2066 696c 6520 7769 7468  readme file with
-00015df0: 2074 6865 206d 6574 6164 6174 610a 2020   the metadata.  
-00015e00: 2020 2020 2020 2020 2020 656d 6169 6c20            email 
-00015e10: 3d20 7365 6c66 2e63 6667 2e65 6d61 696c  = self.cfg.email
-00015e20: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-00015e30: 646d 6520 3d20 6f73 2e70 6174 682e 6a6f  dme = os.path.jo
-00015e40: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-00015e50: 2020 2020 666f 6c64 6572 5f74 6f5f 6465      folder_to_de
-00015e60: 6c65 7465 2c20 7365 6c66 2e77 6865 7265  lete, self.where
-00015e70: 5f64 6964 5f74 6865 5f66 696c 6573 5f67  _did_the_files_g
-00015e80: 6f5f 6669 6c65 6e61 6d65 290a 0a20 2020  o_filename)..   
-00015e90: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00015ea0: 656e 2872 6561 646d 652c 2027 7727 2920  en(readme, 'w') 
-00015eb0: 6173 2072 6d65 3a0a 2020 2020 2020 2020  as rme:.        
-00015ec0: 2020 2020 2020 2020 726d 652e 7772 6974          rme.writ
-00015ed0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00015ee0: 2020 2020 2020 2066 2754 6865 2066 696c         f'The fil
-00015ef0: 6573 2069 6e20 7468 6973 2066 6f6c 6465  es in this folde
-00015f00: 7220 6861 7665 2062 6565 6e20 6d6f 7665  r have been move
-00015f10: 6420 746f 2061 6e20 4157 5320 5333 2061  d to an AWS S3 a
-00015f20: 7263 6869 7665 215c 6e27 290a 2020 2020  rchive!\n').    
-00015f30: 2020 2020 2020 2020 2020 2020 726d 652e              rme.
-00015f40: 7772 6974 6528 6627 5c6e 4172 6368 6976  write(f'\nArchiv
-00015f50: 6520 6c6f 6361 7469 6f6e 3a20 7b73 335f  e location: {s3_
-00015f60: 6465 7374 7d5c 6e27 290a 2020 2020 2020  dest}\n').      
-00015f70: 2020 2020 2020 2020 2020 726d 652e 7772            rme.wr
-00015f80: 6974 6528 0a20 2020 2020 2020 2020 2020  ite(.           
-00015f90: 2020 2020 2020 2020 2066 2241 7263 6869           f"Archi
-00015fa0: 7665 2070 726f 6669 6c65 2028 7e2f 2e61  ve profile (~/.a
-00015fb0: 7773 293a 207b 6172 6368 6976 6564 5f66  ws): {archived_f
-00015fc0: 6f6c 6465 725f 696e 666f 5b27 7072 6f66  older_info['prof
-00015fd0: 696c 6527 5d7d 5c6e 2229 0a20 2020 2020  ile']}\n").     
-00015fe0: 2020 2020 2020 2020 2020 2072 6d65 2e77             rme.w
-00015ff0: 7269 7465 2866 2241 7263 6869 7665 7220  rite(f"Archiver 
-00016000: 7573 6572 3a20 7b61 7263 6869 7665 645f  user: {archived_
-00016010: 666f 6c64 6572 5f69 6e66 6f5b 2775 7365  folder_info['use
-00016020: 7227 5d7d 5c6e 2229 0a20 2020 2020 2020  r']}\n").       
-00016030: 2020 2020 2020 2020 2072 6d65 2e77 7269           rme.wri
-00016040: 7465 2866 2741 7263 6869 7665 7220 656d  te(f'Archiver em
-00016050: 6169 6c3a 207b 7365 6c66 2e63 6667 2e65  ail: {self.cfg.e
-00016060: 6d61 696c 7d5c 6e27 290a 2020 2020 2020  mail}\n').      
-00016070: 2020 2020 2020 2020 2020 726d 652e 7772            rme.wr
-00016080: 6974 6528 0a20 2020 2020 2020 2020 2020  ite(.           
-00016090: 2020 2020 2020 2020 2066 2741 7263 6869           f'Archi
-000160a0: 7665 2074 6f6f 6c3a 2068 7474 7073 3a2f  ve tool: https:/
-000160b0: 2f67 6974 6875 622e 636f 6d2f 6469 726b  /github.com/dirk
-000160c0: 7065 7465 7273 656e 2f66 726f 7374 6572  petersen/froster
-000160d0: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
-000160e0: 2020 2020 2072 6d65 2e77 7269 7465 280a       rme.write(.
-000160f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016100: 2020 2020 6627 5265 7374 6f72 6520 636f      f'Restore co
-00016110: 6d6d 616e 643a 2066 726f 7374 6572 2072  mmand: froster r
-00016120: 6573 746f 7265 2022 7b66 6f6c 6465 725f  estore "{folder_
-00016130: 746f 5f64 656c 6574 657d 225c 6e27 290a  to_delete}"\n').
-00016140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016150: 726d 652e 7772 6974 6528 0a20 2020 2020  rme.write(.     
-00016160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00016170: 2744 656c 6574 696f 6e20 6461 7465 3a20  'Deletion date: 
-00016180: 7b64 6174 6574 696d 652e 6461 7465 7469  {datetime.dateti
-00016190: 6d65 2e6e 6f77 2829 7d5c 6e27 290a 2020  me.now()}\n').  
-000161a0: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-000161b0: 652e 7772 6974 6528 6627 5c6e 5c6e 4669  e.write(f'\n\nFi
-000161c0: 7273 7420 3130 2066 696c 6573 2064 656c  rst 10 files del
-000161d0: 6574 6564 2074 6869 7320 7469 6d65 3a5c  eted this time:\
-000161e0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-000161f0: 2020 2020 726d 652e 7772 6974 6528 272c      rme.write(',
-00016200: 2027 2e6a 6f69 6e28 6465 6c65 7465 645f   '.join(deleted_
-00016210: 6669 6c65 735b 3a31 305d 2929 0a20 2020  files[:10])).   
-00016220: 2020 2020 2020 2020 2020 2020 2072 6d65               rme
-00016230: 2e77 7269 7465 280a 2020 2020 2020 2020  .write(.        
-00016240: 2020 2020 2020 2020 2020 2020 6627 5c6e              f'\n
-00016250: 5c6e 506c 6561 7365 2073 6565 206d 6f72  \nPlease see mor
-00016260: 6520 6d65 7461 6461 7461 2069 6e20 4672  e metadata in Fr
-00016270: 6f73 7465 722e 616c 6c66 696c 6573 2e63  oster.allfiles.c
-00016280: 7376 2066 696c 655c 6e27 290a 0a20 2020  sv file\n')..   
-00016290: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-000162a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162b0: 6627 2020 4465 6c65 7465 6420 7b6c 656e  f'  Deleted {len
-000162c0: 2864 656c 6574 6564 5f66 696c 6573 297d  (deleted_files)}
-000162d0: 2066 696c 6573 2061 6e64 2077 726f 7465   files and wrote
-000162e0: 206d 616e 6966 6573 7420 746f 2022 7b72   manifest to "{r
-000162f0: 6561 646d 657d 225c 6e27 290a 0a20 2020  eadme}"\n')..   
-00016300: 2020 2020 2020 2020 2023 2050 7269 6e74           # Print
-00016310: 2074 6865 2066 696e 616c 206d 6573 7361   the final messa
-00016320: 6765 0a20 2020 2020 2020 2020 2020 2070  ge.            p
-00016330: 7269 6e74 2866 275c 6e44 454c 4554 494e  rint(f'\nDELETIN
-00016340: 4720 5355 4343 4553 5346 554c 4c59 2043  G SUCCESSFULLY C
-00016350: 4f4d 504c 4554 4544 5c6e 2729 0a20 2020  OMPLETED\n').   
-00016360: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00016370: 275c 6e20 2020 204c 4f43 414c 2044 454c  '\n    LOCAL DEL
-00016380: 4554 4544 2046 4f4c 4445 523a 2020 207b  ETED FOLDER:   {
-00016390: 666f 6c64 6572 5f74 6f5f 6465 6c65 7465  folder_to_delete
-000163a0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-000163b0: 7072 696e 7428 6627 2020 2020 4157 5320  print(f'    AWS 
-000163c0: 5333 2044 4553 5449 4e41 5449 4f4e 3a20  S3 DESTINATION: 
-000163d0: 2020 2020 7b73 335f 6465 7374 7d5c 6e27      {s3_dest}\n'
-000163e0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-000163f0: 696e 7428 6627 5c6e 2020 2020 546f 7461  int(f'\n    Tota
-00016400: 6c20 6669 6c65 7320 6465 6c65 7465 643a  l files deleted:
-00016410: 2020 2020 7b6c 656e 2864 656c 6574 6564      {len(deleted
-00016420: 5f66 696c 6573 297d 5c6e 2729 0a20 2020  _files)}\n').   
-00016430: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 6627 2020 2020 4265 666f 7265 2064 656c  f'    Before del
-00016460: 6574 696f 6e2c 2061 6c6c 2066 696c 6573  etion, all files
-00016470: 2077 6572 6520 7468 6f72 6f75 6768 6c79   were thoroughly
-00016480: 2076 6572 6966 6965 6420 746f 2065 7869   verified to exi
-00016490: 7374 2069 6e20 4157 5320 5333 2e5c 6e27  st in AWS S3.\n'
-000164a0: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-000164b0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000164c0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000164d0: 696e 745f 6572 726f 7228 290a 2020 2020  int_error().    
-000164e0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-000164f0: 2020 2020 6465 6620 6465 6c65 7465 2873      def delete(s
-00016500: 656c 662c 2066 6f6c 6465 7273 293a 0a0a  elf, folders):..
-00016510: 2020 2020 2020 2020 2320 436c 6561 6e20          # Clean 
-00016520: 7468 6520 7072 6f76 6964 6564 2070 6174  the provided pat
-00016530: 6873 0a20 2020 2020 2020 2066 6f6c 6465  hs.        folde
-00016540: 7273 203d 2063 6c65 616e 5f70 6174 6873  rs = clean_paths
-00016550: 2866 6f6c 6465 7273 290a 0a20 2020 2020  (folders)..     
-00016560: 2020 2023 2053 6574 2066 6c61 6773 0a20     # Set flags. 
-00016570: 2020 2020 2020 2069 735f 7265 6375 7273         is_recurs
-00016580: 6976 6520 3d20 7365 6c66 2e61 7267 732e  ive = self.args.
-00016590: 7265 6375 7273 6976 650a 0a20 2020 2020  recursive..     
-000165a0: 2020 2069 6620 6973 5f72 6563 7572 7369     if is_recursi
-000165b0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-000165c0: 6966 2073 656c 662e 5f69 735f 7265 6375  if self._is_recu
-000165d0: 7273 6976 655f 636f 6c6c 6973 696f 6e28  rsive_collision(
-000165e0: 666f 6c64 6572 7329 3a0a 2020 2020 2020  folders):.      
-000165f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00016600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016610: 2020 2020 2066 275c 6e45 7272 6f72 3a20       f'\nError: 
-00016620: 596f 7520 6361 6e6e 6f74 2064 656c 6574  You cannot delet
-00016630: 6520 666f 6c64 6572 7320 7265 6375 7273  e folders recurs
-00016640: 6976 656c 7920 6966 2074 6865 7265 2069  ively if there i
-00016650: 7320 6120 6465 7065 6e64 656e 6379 2062  s a dependency b
-00016660: 6574 7765 656e 2074 6865 6d2e 5c6e 2729  etween them.\n')
-00016670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016680: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
-00016690: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-000166a0: 2077 6520 6361 6e20 7265 6164 2026 2077   we can read & w
-000166b0: 7269 7465 2061 6c6c 2066 696c 6573 2061  rite all files a
-000166c0: 6e64 2066 6f6c 6465 7273 0a20 2020 2020  nd folders.     
-000166d0: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-000166e0: 6973 5f63 6f72 7265 6374 5f66 696c 6573  is_correct_files
-000166f0: 5f66 6f6c 6465 7273 5f70 6572 6d69 7373  _folders_permiss
-00016700: 696f 6e73 2866 6f6c 6465 7273 2c20 6973  ions(folders, is
-00016710: 5f72 6563 7572 7369 7665 293a 0a20 2020  _recursive):.   
-00016720: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00016730: 5c6e 4572 726f 723a 2043 616e 6e6f 7420  \nError: Cannot 
-00016740: 7265 6164 206f 7220 7772 6974 6520 746f  read or write to
-00016750: 2061 6c6c 2066 696c 6573 2061 6e64 2066   all files and f
-00016760: 6f6c 6465 7273 2e5c 6e27 2c20 6669 6c65  olders.\n', file
-00016770: 3d73 7973 2e73 7464 6572 7229 0a20 2020  =sys.stderr).   
-00016780: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00016790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167a0: 6627 596f 7520 6361 6e20 6368 6563 6b20  f'You can check 
-000167b0: 7468 6520 7065 726d 6973 7369 6f6e 7320  the permissions 
-000167c0: 6f66 2074 6865 2066 696c 6573 2061 6e64  of the files and
-000167d0: 2066 6f6c 6465 7273 2075 7369 6e67 2074   folders using t
-000167e0: 6865 2063 6f6d 6d61 6e64 3a27 2c20 6669  he command:', fi
-000167f0: 6c65 3d73 7973 2e73 7464 6572 7229 0a20  le=sys.stderr). 
-00016800: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00016810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00016820: 2020 6627 2020 2020 6672 6f73 7465 7220    f'    froster 
-00016830: 6172 6368 6976 6520 2d2d 7065 726d 6973  archive --permis
-00016840: 7369 6f6e 7320 222f 796f 7572 2f66 6f6c  sions "/your/fol
-00016850: 6465 722f 746f 2f61 7263 6869 7665 225c  der/to/archive"\
-00016860: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
-00016870: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-00016880: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
-00016890: 2020 2020 2020 666f 7220 666f 6c64 6572        for folder
-000168a0: 2069 6e20 666f 6c64 6572 733a 0a20 2020   in folders:.   
-000168b0: 2020 2020 2020 2020 2069 6620 6973 5f72           if is_r
-000168c0: 6563 7572 7369 7665 3a0a 2020 2020 2020  ecursive:.      
-000168d0: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
-000168e0: 6f74 2c20 6469 7273 2c20 6669 6c65 7320  ot, dirs, files 
-000168f0: 696e 2073 656c 662e 5f77 616c 6b65 7228  in self._walker(
-00016900: 666f 6c64 6572 293a 0a20 2020 2020 2020  folder):.       
-00016910: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016920: 662e 6465 6c65 7465 5f6c 6f63 616c 6c79  f.delete_locally
-00016930: 2872 6f6f 7429 0a20 2020 2020 2020 2020  (root).         
-00016940: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00016950: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00016960: 6c65 7465 5f6c 6f63 616c 6c79 2866 6f6c  lete_locally(fol
-00016970: 6465 7229 0a0a 2020 2020 6465 6620 5f64  der)..    def _d
-00016980: 656c 6574 655f 7461 725f 636f 6e74 656e  elete_tar_conten
-00016990: 7428 7365 6c66 2c20 6469 7265 6374 6f72  t(self, director
-000169a0: 792c 2066 696c 6573 293a 0a20 2020 2020  y, files):.     
-000169b0: 2020 2064 656c 6574 6564 203d 205b 5d0a     deleted = [].
-000169c0: 2020 2020 2020 2020 666f 7220 6620 696e          for f in
-000169d0: 2066 696c 6573 3a0a 2020 2020 2020 2020   files:.        
-000169e0: 2020 2020 6670 203d 206f 732e 7061 7468      fp = os.path
-000169f0: 2e6a 6f69 6e28 6469 7265 6374 6f72 792c  .join(directory,
-00016a00: 2066 290a 0a20 2020 2020 2020 2020 2020   f)..           
-00016a10: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00016a20: 6c65 2866 7029 206f 7220 6f73 2e70 6174  le(fp) or os.pat
-00016a30: 682e 6973 6c69 6e6b 2866 7029 3a0a 2020  h.islink(fp):.  
-00016a40: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00016a50: 2e72 656d 6f76 6528 6670 290a 2020 2020  .remove(fp).    
-00016a60: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
-00016a70: 7465 642e 6170 7065 6e64 2866 290a 2020  ted.append(f).  
-00016a80: 2020 2020 2020 7072 696e 7464 6267 280a        printdbg(.
-00016a90: 2020 2020 2020 2020 2020 2020 6627 4669              f'Fi
-00016aa0: 6c65 7320 6465 6c65 7465 6420 696e 205f  les deleted in _
-00016ab0: 6465 6c65 7465 5f74 6172 5f63 6f6e 7465  delete_tar_conte
-00016ac0: 6e74 3a20 7b22 2c20 222e 6a6f 696e 2864  nt: {", ".join(d
-00016ad0: 656c 6574 6564 297d 2729 0a0a 2020 2020  eleted)}')..    
-00016ae0: 2020 2020 7265 7475 726e 2064 656c 6574      return delet
-00016af0: 6564 0a0a 2020 2020 6465 6620 5f67 6574  ed..    def _get
-00016b00: 5f74 6172 5f63 6f6e 7465 6e74 2873 656c  _tar_content(sel
-00016b10: 662c 2064 6972 6563 746f 7279 293a 0a20  f, directory):. 
-00016b20: 2020 2020 2020 2066 696c 6573 203d 205b         files = [
-00016b30: 5d0a 2020 2020 2020 2020 7461 725f 7061  ].        tar_pa
-00016b40: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-00016b50: 6e28 6469 7265 6374 6f72 792c 2027 4672  n(directory, 'Fr
-00016b60: 6f73 7465 722e 736d 616c 6c66 696c 6573  oster.smallfiles
-00016b70: 2e74 6172 2729 0a20 2020 2020 2020 2069  .tar').        i
-00016b80: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00016b90: 2874 6172 5f70 6174 6829 3a0a 2020 2020  (tar_path):.    
-00016ba0: 2020 2020 2020 2020 7769 7468 2074 6172          with tar
-00016bb0: 6669 6c65 2e6f 7065 6e28 7461 725f 7061  file.open(tar_pa
-00016bc0: 7468 2c20 2772 2729 2061 7320 7461 723a  th, 'r') as tar:
-00016bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016be0: 2066 6f72 206d 656d 6265 7220 696e 2074   for member in t
-00016bf0: 6172 2e67 6574 6d65 6d62 6572 7328 293a  ar.getmembers():
-00016c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c10: 2020 2020 2066 696c 6573 2e61 7070 656e       files.appen
-00016c20: 6428 6d65 6d62 6572 2e6e 616d 6529 0a20  d(member.name). 
-00016c30: 2020 2020 2020 2063 7376 5f70 6174 6820         csv_path 
-00016c40: 3d20 6f73 2e70 6174 682e 6a6f 696e 2864  = os.path.join(d
-00016c50: 6972 6563 746f 7279 2c20 2746 726f 7374  irectory, 'Frost
-00016c60: 6572 2e61 6c6c 6669 6c65 732e 6373 7627  er.allfiles.csv'
-00016c70: 290a 2020 2020 2020 2020 6966 206f 732e  ).        if os.
-00016c80: 7061 7468 2e65 7869 7374 7328 6373 765f  path.exists(csv_
-00016c90: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00016ca0: 2020 2066 696c 655f 6c69 7374 203d 205b     file_list = [
-00016cb0: 5d0a 2020 2020 2020 2020 2020 2020 7769  ].            wi
-00016cc0: 7468 206f 7065 6e28 6373 765f 7061 7468  th open(csv_path
-00016cd0: 2c20 2772 2729 2061 7320 6373 7666 696c  , 'r') as csvfil
-00016ce0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00016cf0: 2020 2023 2055 7365 2063 7376 2072 6561     # Use csv rea
-00016d00: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-00016d10: 2020 2020 7265 6164 6572 203d 2063 7376      reader = csv
-00016d20: 2e44 6963 7452 6561 6465 7228 6373 7666  .DictReader(csvf
-00016d30: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-00016d40: 2020 2020 2023 2049 7465 7261 7465 206f       # Iterate o
-00016d50: 7665 7220 6561 6368 2072 6f77 2069 6e20  ver each row in 
-00016d60: 7468 6520 6373 760a 2020 2020 2020 2020  the csv.        
-00016d70: 2020 2020 2020 2020 666f 7220 726f 7720          for row 
-00016d80: 696e 2072 6561 6465 723a 0a20 2020 2020  in reader:.     
-00016d90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016da0: 2049 6620 2254 6172 7265 6422 2069 7320   If "Tarred" is 
-00016db0: 2259 6573 222c 2061 7070 656e 6420 7468  "Yes", append th
-00016dc0: 6520 2246 696c 6522 2074 6f20 7468 6520  e "File" to the 
-00016dd0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-00016de0: 2020 2020 2020 2020 2069 6620 726f 775b           if row[
-00016df0: 2754 6172 7265 6427 5d20 3d3d 2027 5965  'Tarred'] == 'Ye
-00016e00: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
-00016e10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00016e20: 6f74 2072 6f77 5b27 4669 6c65 275d 2069  ot row['File'] i
-00016e30: 6e20 6669 6c65 733a 0a20 2020 2020 2020  n files:.       
-00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e50: 2020 2020 2066 696c 6573 2e61 7070 656e       files.appen
-00016e60: 6428 726f 775b 2746 696c 6527 5d29 0a20  d(row['File']). 
-00016e70: 2020 2020 2020 2070 7269 6e74 6462 6728         printdbg(
-00016e80: 0a20 2020 2020 2020 2020 2020 2066 2746  .            f'F
-00016e90: 696c 6573 2066 6f75 6e64 7320 696e 205f  iles founds in _
-00016ea0: 6765 745f 7461 725f 636f 6e74 656e 743a  get_tar_content:
-00016eb0: 207b 222c 2022 2e6a 6f69 6e28 6669 6c65   {", ".join(file
-00016ec0: 7329 7d27 290a 2020 2020 2020 2020 7265  s)}').        re
-00016ed0: 7475 726e 2066 696c 6573 0a0a 2020 2020  turn files..    
-00016ee0: 6465 6620 7265 7374 6f72 6528 7365 6c66  def restore(self
-00016ef0: 2c20 666f 6c64 6572 2c20 7265 6375 7273  , folder, recurs
-00016f00: 6976 653d 4661 6c73 6529 3a0a 0a20 2020  ive=False):..   
-00016f10: 2020 2020 2023 2063 6f70 6965 6420 6672       # copied fr
-00016f20: 6f6d 2061 7263 6869 7665 0a20 2020 2020  om archive.     
-00016f30: 2020 2072 6f77 6469 6374 203d 2073 656c     rowdict = sel
-00016f40: 662e 6172 6368 6976 655f 6a73 6f6e 5f67  f.archive_json_g
-00016f50: 6574 5f72 6f77 2866 6f6c 6465 7229 0a20  et_row(folder). 
-00016f60: 2020 2020 2020 2069 6620 726f 7764 6963         if rowdic
-00016f70: 7420 3d3d 204e 6f6e 653a 0a20 2020 2020  t == None:.     
-00016f80: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00016f90: 6c73 650a 2020 2020 2020 2020 7461 696c  lse.        tail
-00016fa0: 203d 2027 270a 2020 2020 2020 2020 6966   = ''.        if
-00016fb0: 2027 6172 6368 6976 655f 6d6f 6465 2720   'archive_mode' 
-00016fc0: 696e 2072 6f77 6469 6374 3a0a 2020 2020  in rowdict:.    
-00016fd0: 2020 2020 2020 2020 6966 2072 6f77 6469          if rowdi
-00016fe0: 6374 5b27 6172 6368 6976 655f 6d6f 6465  ct['archive_mode
-00016ff0: 275d 203d 3d20 2252 6563 7572 7369 7665  '] == "Recursive
-00017000: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00017010: 2020 2072 6563 7572 7369 7665 203d 2054     recursive = T
-00017020: 7275 650a 2020 2020 2020 2020 6966 2066  rue.        if f
-00017030: 6f6c 6465 7220 213d 2072 6f77 6469 6374  older != rowdict
-00017040: 5b27 6c6f 6361 6c5f 666f 6c64 6572 275d  ['local_folder']
-00017050: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00017060: 696e 7464 6267 280a 2020 2020 2020 2020  intdbg(.        
-00017070: 2020 2020 2020 2020 6622 726f 7764 6963          f"rowdic
-00017080: 745b 6c6f 6361 6c5f 666f 6c64 6572 5d3a  t[local_folder]:
-00017090: 207b 726f 7764 6963 745b 276c 6f63 616c   {rowdict['local
-000170a0: 5f66 6f6c 6465 7227 5d7d 2229 0a20 2020  _folder']}").   
-000170b0: 2020 2020 2020 2020 2023 2074 7279 2074           # try t
-000170c0: 6f20 7265 7374 6f72 6520 6672 6f6d 2073  o restore from s
-000170d0: 7562 6469 722c 2077 6520 6e65 6564 2074  ubdir, we need t
-000170e0: 6f20 6368 6563 6b20 6966 2061 7263 6869  o check if archi
-000170f0: 7665 6420 7265 6375 7273 6976 656c 790a  ved recursively.
-00017100: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00017110: 6f74 2072 6563 7572 7369 7665 3a0a 2020  ot recursive:.  
-00017120: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00017130: 696e 7428 7465 7874 7772 6170 2e64 6564  int(textwrap.ded
-00017140: 656e 7428 6627 2727 5c6e 0a20 2020 2020  ent(f'''\n.     
-00017150: 2020 2020 2020 2020 2020 2020 2020 2059                 Y
-00017160: 6f75 2061 7265 2074 7279 696e 6720 746f  ou are trying to
-00017170: 2072 6573 746f 7265 2061 2073 7562 2066   restore a sub f
-00017180: 6f6c 6465 7220 6275 7420 7468 6520 7061  older but the pa
-00017190: 7265 6e74 2061 7263 6869 7665 0a20 2020  rent archive.   
-000171a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171b0: 2077 6173 206e 6f74 2073 6176 6564 2072   was not saved r
-000171c0: 6563 7572 7369 7665 6c79 2e20 596f 7520  ecursively. You 
-000171d0: 6361 6e20 7472 7920 7265 7374 6f72 696e  can try restorin
-000171e0: 6720 7468 6973 2066 6f6c 6465 723a 0a20  g this folder:. 
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 207b 726f 7764 6963 745b 276c 6f63     {rowdict['loc
-00017210: 616c 5f66 6f6c 6465 7227 5d7d 0a20 2020  al_folder']}.   
-00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017230: 2027 2727 2929 0a20 2020 2020 2020 2020   ''')).         
-00017240: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00017250: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00017260: 7461 696c 203d 2066 6f6c 6465 722e 7265  tail = folder.re
-00017270: 706c 6163 6528 726f 7764 6963 745b 276c  place(rowdict['l
-00017280: 6f63 616c 5f66 6f6c 6465 7227 5d2c 2027  ocal_folder'], '
-00017290: 2729 0a0a 2020 2020 2020 2020 736f 7572  ')..        sour
-000172a0: 6365 203d 2072 6f77 6469 6374 5b27 6172  ce = rowdict['ar
-000172b0: 6368 6976 655f 666f 6c64 6572 275d 2b74  chive_folder']+t
-000172c0: 6169 6c2b 272f 270a 2020 2020 2020 2020  ail+'/'.        
-000172d0: 7461 7267 6574 203d 2066 6f6c 6465 720a  target = folder.
-000172e0: 0a20 2020 2020 2020 2062 7563 2c20 7072  .        buc, pr
-000172f0: 652c 2072 6563 7572 2c20 6973 676c 6163  e, recur, isglac
-00017300: 6965 7220 3d20 7365 6c66 2e61 7263 6869  ier = self.archi
-00017310: 7665 5f67 6574 5f62 7563 6b65 745f 696e  ve_get_bucket_in
-00017320: 666f 2874 6172 6765 7429 0a20 2020 2020  fo(target).     
-00017330: 2020 2069 6620 6973 676c 6163 6965 723a     if isglacier:
-00017340: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00017350: 7073 203d 2073 6f75 7263 652e 7370 6c69  ps = source.spli
-00017360: 7428 272f 272c 2031 290a 2020 2020 2020  t('/', 1).      
-00017370: 2020 2020 2020 2320 626b 203d 2073 7073        # bk = sps
-00017380: 5b30 5d2e 7265 706c 6163 6528 273a 7333  [0].replace(':s3
-00017390: 3a27 2c27 2729 0a20 2020 2020 2020 2020  :','').         
-000173a0: 2020 2023 2070 7220 3d20 6627 7b73 7073     # pr = f'{sps
-000173b0: 5b31 5d7d 2f27 2023 2074 7261 696c 696e  [1]}/' # trailin
-000173c0: 6720 736c 6173 6820 656e 7375 7265 640a  g slash ensured.
-000173d0: 2020 2020 2020 2020 2020 2020 7472 6967              trig
-000173e0: 2c20 7265 7374 2c20 646f 6e65 2c20 6e6f  , rest, done, no
-000173f0: 7467 203d 2073 656c 662e 5f67 6c61 6369  tg = self._glaci
-00017400: 6572 5f72 6573 746f 7265 2862 7563 2c20  er_restore(buc, 
-00017410: 7072 652c 0a20 2020 2020 2020 2020 2020  pre,.           
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017450: 7365 6c66 2e61 7267 732e 6461 7973 2c20  self.args.days, 
-00017460: 7365 6c66 2e61 7267 732e 7265 7472 6965  self.args.retrie
-00017470: 7665 6f70 742c 2072 6563 7572 290a 2020  veopt, recur).  
-00017480: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00017490: 2754 7269 6767 6572 6564 2047 6c61 6369  'Triggered Glaci
-000174a0: 6572 2072 6574 7269 6576 616c 733a 272c  er retrievals:',
-000174b0: 206c 656e 2874 7269 6729 290a 2020 2020   len(trig)).    
-000174c0: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-000174d0: 7572 7265 6e74 6c79 2072 6574 7269 6576  urrently retriev
-000174e0: 696e 6720 6672 6f6d 2047 6c61 6369 6572  ing from Glacier
-000174f0: 3a27 2c20 6c65 6e28 7265 7374 2929 0a20  :', len(rest)). 
-00017500: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00017510: 2827 5265 7472 6965 7665 6420 6672 6f6d  ('Retrieved from
-00017520: 2047 6c61 6369 6572 3a27 2c20 6c65 6e28   Glacier:', len(
-00017530: 646f 6e65 2929 0a20 2020 2020 2020 2020  done)).         
-00017540: 2020 2070 7269 6e74 2827 4e6f 7420 696e     print('Not in
-00017550: 2047 6c61 6369 6572 3a27 2c20 6c65 6e28   Glacier:', len(
-00017560: 6e6f 7467 2929 0a20 2020 2020 2020 2020  notg)).         
-00017570: 2020 2069 6620 6c65 6e28 7472 6967 2920     if len(trig) 
-00017580: 3e20 3020 6f72 206c 656e 2872 6573 7429  > 0 or len(rest)
-00017590: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000175a0: 2020 2020 2020 2320 676c 6163 6965 7220        # glacier 
-000175b0: 6973 2073 7469 6c6c 206f 6e67 6f69 6e67  is still ongoing
-000175c0: 2c20 7265 7475 726e 2023 206f 6620 7065  , return # of pe
-000175d0: 6e64 696e 6720 6f70 730a 2020 2020 2020  nding ops.      
-000175e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000175f0: 206c 656e 2874 7269 6729 2b6c 656e 2872   len(trig)+len(r
-00017600: 6573 7429 0a0a 2020 2020 2020 2020 6966  est)..        if
-00017610: 2073 656c 662e 6172 6773 2e6e 6f64 6f77   self.args.nodow
-00017620: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
-00017630: 2020 2072 6574 7572 6e20 2d31 0a0a 2020     return -1..  
-00017640: 2020 2020 2020 7263 6c6f 6e65 203d 2052        rclone = R
-00017650: 636c 6f6e 6528 7365 6c66 2e61 7267 732c  clone(self.args,
-00017660: 2073 656c 662e 6366 6729 0a0a 2020 2020   self.cfg)..    
-00017670: 2020 2020 6966 2072 6563 7572 7369 7665      if recursive
-00017680: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00017690: 696e 7428 6627 5265 6375 7273 6976 656c  int(f'Recursivel
-000176a0: 7920 636f 7079 696e 6720 6669 6c65 7320  y copying files 
-000176b0: 6672 6f6d 2061 7263 6869 7665 2074 6f20  from archive to 
-000176c0: 227b 7461 7267 6574 7d22 202e 2e2e 2729  "{target}" ...')
-000176d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000176e0: 203d 2072 636c 6f6e 652e 636f 7079 2873   = rclone.copy(s
-000176f0: 6f75 7263 652c 2074 6172 6765 7429 0a20  ource, target). 
-00017700: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00017710: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00017720: 2743 6f70 7969 6e67 2066 696c 6573 2066  'Copying files f
-00017730: 726f 6d20 6172 6368 6976 6520 746f 2022  rom archive to "
-00017740: 7b74 6172 6765 747d 2220 2e2e 2e27 290a  {target}" ...').
-00017750: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-00017760: 3d20 7263 6c6f 6e65 2e63 6f70 7928 736f  = rclone.copy(so
-00017770: 7572 6365 2c20 7461 7267 6574 2c20 272d  urce, target, '-
-00017780: 2d6d 6178 2d64 6570 7468 272c 2027 3127  -max-depth', '1'
-00017790: 290a 0a20 2020 2020 2020 2070 7269 6e74  )..        print
-000177a0: 6462 6728 272a 2a2a 2052 434c 4f4e 4520  dbg('*** RCLONE 
-000177b0: 636f 7079 2072 6574 202a 2a2a 3a5c 6e27  copy ret ***:\n'
-000177c0: 2c20 7265 742c 2027 5c6e 2729 0a20 2020  , ret, '\n').   
-000177d0: 2020 2020 2023 2070 7269 6e74 2028 274d       # print ('M
-000177e0: 6573 7361 6765 3a27 2c20 7265 745b 276d  essage:', ret['m
-000177f0: 7367 275d 2e72 6570 6c61 6365 2827 5c6e  sg'].replace('\n
-00017800: 272c 273b 2729 290a 2020 2020 2020 2020  ',';')).        
-00017810: 6966 2072 6574 5b27 7374 6174 7327 5d5b  if ret['stats'][
-00017820: 2765 7272 6f72 7327 5d20 3e20 303a 0a20  'errors'] > 0:. 
-00017830: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00017840: 2827 4c61 7374 2045 7272 6f72 3a27 2c20  ('Last Error:', 
-00017850: 7265 745b 2773 7461 7473 275d 5b27 6c61  ret['stats']['la
-00017860: 7374 4572 726f 7227 5d2c 2066 696c 653d  stError'], file=
-00017870: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
-00017880: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-00017890: 6f70 7969 6e67 2077 6173 206e 6f74 2073  opying was not s
-000178a0: 7563 6365 7373 6675 6c2e 272c 2066 696c  uccessful.', fil
-000178b0: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
-000178c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000178d0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-000178e0: 2020 2023 206c 6173 7445 7272 6f72 2063     # lastError c
-000178f0: 6f75 6c64 2063 6f6e 7461 696e 3a20 4f62  ould contain: Ob
-00017900: 6a65 6374 2069 6e20 474c 4143 4945 522c  ject in GLACIER,
-00017910: 2072 6573 746f 7265 2066 6972 7374 0a0a   restore first..
-00017920: 2020 2020 2020 2020 7474 7261 6e73 6665          ttransfe
-00017930: 7273 203d 2072 6574 5b27 7374 6174 7327  rs = ret['stats'
-00017940: 5d5b 2774 6f74 616c 5472 616e 7366 6572  ]['totalTransfer
-00017950: 7327 5d0a 2020 2020 2020 2020 7462 7974  s'].        tbyt
-00017960: 6573 203d 2072 6574 5b27 7374 6174 7327  es = ret['stats'
-00017970: 5d5b 2774 6f74 616c 4279 7465 7327 5d0a  ]['totalBytes'].
-00017980: 2020 2020 2020 2020 746f 7461 6c20 3d20          total = 
-00017990: 7365 6c66 2e63 6f6e 7665 7274 5f73 697a  self.convert_siz
-000179a0: 6528 7462 7974 6573 290a 2020 2020 2020  e(tbytes).      
-000179b0: 2020 6966 2073 656c 662e 6172 6773 2e64    if self.args.d
-000179c0: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
-000179d0: 2020 7072 696e 7428 275c 6e27 290a 2020    print('\n').  
-000179e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000179f0: 2753 7065 6564 3a27 2c20 7265 745b 2773  'Speed:', ret['s
-00017a00: 7461 7473 275d 5b27 7370 6565 6427 5d29  tats']['speed'])
-00017a10: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00017a20: 6e74 2827 5472 616e 7366 6572 733a 272c  nt('Transfers:',
-00017a30: 2072 6574 5b27 7374 6174 7327 5d5b 2774   ret['stats']['t
-00017a40: 7261 6e73 6665 7273 275d 290a 2020 2020  ransfers']).    
-00017a50: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
-00017a60: 6f74 2054 7261 6e73 6665 7273 3a27 2c20  ot Transfers:', 
-00017a70: 7265 745b 2773 7461 7473 275d 5b27 746f  ret['stats']['to
-00017a80: 7461 6c54 7261 6e73 6665 7273 275d 290a  talTransfers']).
-00017a90: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00017aa0: 7428 2754 6f74 2042 7974 6573 3a27 2c20  t('Tot Bytes:', 
-00017ab0: 7265 745b 2773 7461 7473 275d 5b27 746f  ret['stats']['to
-00017ac0: 7461 6c42 7974 6573 275d 290a 2020 2020  talBytes']).    
-00017ad0: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
-00017ae0: 6f74 2043 6865 636b 733a 272c 2072 6574  ot Checks:', ret
-00017af0: 5b27 7374 6174 7327 5d5b 2774 6f74 616c  ['stats']['total
-00017b00: 4368 6563 6b73 275d 290a 0a20 2020 2020  Checks'])..     
-00017b10: 2020 2023 2020 207b 2762 7974 6573 273a     #   {'bytes':
-00017b20: 2030 2c20 2763 6865 636b 7327 3a20 302c   0, 'checks': 0,
-00017b30: 2027 6465 6c65 7465 6444 6972 7327 3a20   'deletedDirs': 
-00017b40: 302c 2027 6465 6c65 7465 7327 3a20 302c  0, 'deletes': 0,
-00017b50: 2027 656c 6170 7365 6454 696d 6527 3a20   'elapsedTime': 
-00017b60: 322e 3738 3330 3033 3031 392c 0a20 2020  2.783003019,.   
-00017b70: 2020 2020 2023 2020 2020 2765 7272 6f72       #    'error
-00017b80: 7327 3a20 312c 2027 6574 6127 3a20 4e6f  s': 1, 'eta': No
-00017b90: 6e65 2c20 2766 6174 616c 4572 726f 7227  ne, 'fatalError'
-00017ba0: 3a20 4661 6c73 652c 2027 6c61 7374 4572  : False, 'lastEr
-00017bb0: 726f 7227 3a20 2764 6972 6563 746f 7279  ror': 'directory
-00017bc0: 206e 6f74 2066 6f75 6e64 272c 0a20 2020   not found',.   
-00017bd0: 2020 2020 2023 2020 2020 2772 656e 616d       #    'renam
-00017be0: 6573 273a 2030 2c20 2772 6574 7279 4572  es': 0, 'retryEr
-00017bf0: 726f 7227 3a20 5472 7565 2c20 2773 7065  ror': True, 'spe
-00017c00: 6564 273a 2030 2c20 2774 6f74 616c 4279  ed': 0, 'totalBy
-00017c10: 7465 7327 3a20 302c 2027 746f 7461 6c43  tes': 0, 'totalC
-00017c20: 6865 636b 7327 3a20 302c 0a20 2020 2020  hecks': 0,.     
-00017c30: 2020 2023 2020 2020 2774 6f74 616c 5472     #    'totalTr
-00017c40: 616e 7366 6572 7327 3a20 302c 2027 7472  ansfers': 0, 'tr
-00017c50: 616e 7366 6572 5469 6d65 273a 2030 2c20  ansferTime': 0, 
-00017c60: 2774 7261 6e73 6665 7273 273a 2030 7d0a  'transfers': 0}.
-00017c70: 2020 2020 2020 2020 2320 6368 6563 6b73          # checks
-00017c80: 756d 0a0a 2020 2020 2020 2020 6966 2073  um..        if s
-00017c90: 656c 662e 5f72 6573 746f 7265 5f76 6572  elf._restore_ver
-00017ca0: 6966 7928 736f 7572 6365 2c20 7461 7267  ify(source, targ
-00017cb0: 6574 2c20 7265 6375 7273 6976 6529 3a0a  et, recursive):.
-00017cc0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00017cd0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00017ce0: 2020 2066 2754 6172 6765 7420 616e 6420     f'Target and 
-00017cf0: 6172 6368 6976 6520 6172 6520 6964 656e  archive are iden
-00017d00: 7469 6361 6c2e 207b 7474 7261 6e73 6665  tical. {ttransfe
-00017d10: 7273 7d20 6669 6c65 7320 7769 7468 207b  rs} files with {
-00017d20: 746f 7461 6c7d 2074 7261 6e73 6665 7272  total} transferr
-00017d30: 6564 2e27 290a 2020 2020 2020 2020 656c  ed.').        el
-00017d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017d50: 7072 696e 7428 6627 5072 6f62 6c65 6d3a  print(f'Problem:
-00017d60: 2074 6172 6765 7420 616e 6420 6172 6368   target and arch
-00017d70: 6976 6520 6172 6520 4e4f 5420 6964 656e  ive are NOT iden
-00017d80: 7469 6361 6c2e 2729 0a20 2020 2020 2020  tical.').       
-00017d90: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00017da0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00017db0: 6e20 2d31 0a0a 2020 2020 6465 6620 5f72  n -1..    def _r
-00017dc0: 6573 746f 7265 5f76 6572 6966 7928 7365  estore_verify(se
-00017dd0: 6c66 2c20 736f 7572 6365 2c20 7461 7267  lf, source, targ
-00017de0: 6574 2c20 7265 6375 7273 6976 653d 4661  et, recursive=Fa
-00017df0: 6c73 6529 3a0a 2020 2020 2020 2020 2320  lse):.        # 
-00017e00: 706f 7374 2064 6f77 6e6c 6f61 6420 7461  post download ta
-00017e10: 736b 7320 6c69 6b65 2063 6865 636b 7375  sks like checksu
-00017e20: 6d20 7665 7269 6669 6361 7469 6f6e 2061  m verification a
-00017e30: 6e64 2075 6e74 6172 7269 6e67 0a20 2020  nd untarring.   
-00017e40: 2020 2020 2072 636c 6f6e 6520 3d20 5263       rclone = Rc
-00017e50: 6c6f 6e65 2873 656c 662e 6172 6773 2c20  lone(self.args, 
-00017e60: 7365 6c66 2e63 6667 290a 2020 2020 2020  self.cfg).      
-00017e70: 2020 666f 7220 726f 6f74 2c20 6469 7273    for root, dirs
-00017e80: 2c20 6669 6c65 7320 696e 2073 656c 662e  , files in self.
-00017e90: 5f77 616c 6b65 7228 7461 7267 6574 293a  _walker(target):
-00017ea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017eb0: 6e6f 7420 7265 6375 7273 6976 6520 616e  not recursive an
-00017ec0: 6420 726f 6f74 2021 3d20 7461 7267 6574  d root != target
-00017ed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017ee0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-00017ef0: 2020 2020 7265 7374 7061 7468 203d 2072      restpath = r
-00017f00: 6f6f 740a 2020 2020 2020 2020 2020 2020  oot.            
-00017f10: 7072 696e 7428 6627 5c6e 2020 4368 6563  print(f'\n  Chec
-00017f20: 6b69 6e67 2066 6f6c 6465 7220 227b 7265  king folder "{re
-00017f30: 7374 7061 7468 7d22 202e 2e2e 2027 290a  stpath}" ... ').
-00017f40: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00017f50: 6f6f 7420 213d 2074 6172 6765 743a 0a20  oot != target:. 
-00017f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017f70: 6f75 7263 6520 3d20 736f 7572 6365 202b  ource = source +
-00017f80: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-00017f90: 6528 726f 6f74 2920 2b20 272f 270a 2020  e(root) + '/'.  
-00017fa0: 2020 2020 2020 2020 2020 7472 793a 0a0a            try:..
-00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fc0: 2320 5468 6973 206e 6565 6473 2074 6f20  # This needs to 
-00017fd0: 6861 7070 656e 2072 6563 7572 7369 7665  happen recursive
-00017fe0: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
-00017ff0: 2020 2074 6172 7265 645f 6669 6c65 7320     tarred_files 
-00018000: 3d20 7365 6c66 2e5f 6765 745f 7461 725f  = self._get_tar_
-00018010: 636f 6e74 656e 7428 726f 6f74 290a 2020  content(root).  
-00018020: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018030: 206c 656e 2874 6172 7265 645f 6669 6c65   len(tarred_file
-00018040: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-00018050: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018060: 2e5f 6465 6c65 7465 5f74 6172 5f63 6f6e  ._delete_tar_con
-00018070: 7465 6e74 2872 6573 7470 6174 682c 2074  tent(restpath, t
-00018080: 6172 7265 645f 6669 6c65 7329 0a0a 2020  arred_files)..  
-00018090: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000180a0: 7420 3d20 7365 6c66 2e5f 6765 6e5f 6d64  t = self._gen_md
-000180b0: 3573 756d 7328 0a20 2020 2020 2020 2020  5sums(.         
-000180c0: 2020 2020 2020 2020 2020 2072 6573 7470             restp
-000180d0: 6174 682c 2073 656c 662e 6d64 3573 756d  ath, self.md5sum
-000180e0: 5f72 6573 746f 7265 645f 6669 6c65 6e61  _restored_filena
-000180f0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00018100: 2020 2020 6966 2072 6574 203d 3d20 3133      if ret == 13
-00018110: 3a20 2023 2063 616e 6e6f 7420 7772 6974  :  # cannot writ
-00018120: 6520 746f 2066 6f6c 6465 720a 2020 2020  e to folder.    
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00018150: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00018160: 6866 696c 6520 3d20 6f73 2e70 6174 682e  hfile = os.path.
-00018170: 6a6f 696e 2872 6573 7470 6174 682c 2027  join(restpath, '
-00018180: 2e66 726f 7374 6572 2d72 6573 746f 7265  .froster-restore
-00018190: 642e 6d64 3573 756d 2729 0a20 2020 2020  d.md5sum').     
-000181a0: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-000181b0: 2072 636c 6f6e 652e 6368 6563 6b73 756d   rclone.checksum
-000181c0: 2868 6173 6866 696c 652c 2073 6f75 7263  (hashfile, sourc
-000181d0: 652c 2027 2d2d 6d61 782d 6465 7074 6827  e, '--max-depth'
-000181e0: 2c20 2731 2729 0a20 2020 2020 2020 2020  , '1').         
-000181f0: 2020 2020 2020 2070 7269 6e74 6462 6728         printdbg(
-00018200: 272a 2a2a 2052 434c 4f4e 4520 6368 6563  '*** RCLONE chec
-00018210: 6b73 756d 2072 6574 202a 2a2a 3a5c 6e27  ksum ret ***:\n'
-00018220: 2c20 7265 742c 2027 5c6e 2729 0a20 2020  , ret, '\n').   
-00018230: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018240: 7265 745b 2773 7461 7473 275d 5b27 6572  ret['stats']['er
-00018250: 726f 7273 275d 203e 2030 3a0a 2020 2020  rors'] > 0:.    
-00018260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018270: 7072 696e 7428 274c 6173 7420 4572 726f  print('Last Erro
-00018280: 723a 272c 2072 6574 5b27 7374 6174 7327  r:', ret['stats'
-00018290: 5d5b 276c 6173 7445 7272 6f72 275d 2c20  ]['lastError'], 
-000182a0: 6669 6c65 3d73 7973 2e73 7464 6572 7229  file=sys.stderr)
-000182b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000182c0: 2020 2020 2070 7269 6e74 2827 4368 6563       print('Chec
-000182d0: 6b73 756d 2074 6573 7420 7761 7320 6e6f  ksum test was no
-000182e0: 7420 7375 6363 6573 7366 756c 2e27 2c20  t successful.', 
-000182f0: 6669 6c65 3d73 7973 2e73 7464 6572 7229  file=sys.stderr)
-00018300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018310: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00018320: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00018330: 2020 2072 6574 203d 2073 656c 662e 5f75     ret = self._u
-00018340: 6e74 6172 5f66 696c 6573 2872 6573 7470  ntar_files(restp
-00018350: 6174 6829 0a0a 2020 2020 2020 2020 2020  ath)..          
-00018360: 2020 2020 2020 6966 2072 6574 203d 3d20        if ret == 
-00018370: 3133 3a20 2023 2063 616e 6e6f 7420 7772  13:  # cannot wr
-00018380: 6974 6520 746f 2066 6f6c 6465 720a 2020  ite to folder.  
-00018390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183a0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-000183b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000183c0: 6c69 6620 6e6f 7420 7265 743a 0a20 2020  lif not ret:.   
-000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183e0: 2070 7269 6e74 2827 2020 436f 756c 6420   print('  Could 
-000183f0: 6e6f 7420 6372 6561 7465 2068 6173 6866  not create hashf
-00018400: 696c 6520 2e66 726f 7374 6572 2d72 6573  ile .froster-res
-00018410: 746f 7265 642e 6d64 3573 756d 2e27 2c20  tored.md5sum.', 
-00018420: 6669 6c65 3d73 7973 2e73 7464 6572 7229  file=sys.stderr)
-00018430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018440: 2020 2020 2070 7269 6e74 2827 2020 5065       print('  Pe
-00018450: 7268 6170 7320 7468 6572 6520 6172 6520  rhaps there are 
-00018460: 6e6f 2066 696c 6573 206f 7220 7468 6520  no files or the 
-00018470: 666f 6c64 6572 2064 6f65 7320 6e6f 7420  folder does not 
-00018480: 6578 6973 743f 272c 2066 696c 653d 7379  exist?', file=sy
-00018490: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
-000184a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000184b0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-000184c0: 2020 2020 2020 2020 6578 6365 7074 2050          except P
-000184d0: 6572 6d69 7373 696f 6e45 7272 6f72 2061  ermissionError a
-000184e0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-000184f0: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
-00018500: 6572 726f 7220 6e75 6d62 6572 2069 7320  error number is 
-00018510: 3133 2028 5065 726d 6973 7369 6f6e 2064  13 (Permission d
-00018520: 656e 6965 6429 0a20 2020 2020 2020 2020  enied).         
-00018530: 2020 2020 2020 2069 6620 652e 6572 726e         if e.errn
-00018540: 6f20 3d3d 2031 333a 0a20 2020 2020 2020  o == 13:.       
-00018550: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00018560: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00018570: 2020 2020 2020 2020 2020 2020 6627 5065              f'Pe
-00018580: 726d 6973 7369 6f6e 2064 656e 6965 6420  rmission denied 
-00018590: 746f 2022 7b72 6573 7470 6174 687d 2227  to "{restpath}"'
-000185a0: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
-000185b0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-000185c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000185f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00018600: 6622 416e 2075 6e65 7870 6563 7465 6420  f"An unexpected 
-00018610: 5065 726d 6973 7369 6f6e 4572 726f 7220  PermissionError 
-00018620: 6f63 6375 7272 6564 3a5c 6e7b 657d 222c  occurred:\n{e}",
-00018630: 2066 696c 653d 7379 732e 7374 6465 7272   file=sys.stderr
-00018640: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018650: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00018660: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00018670: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00018680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018690: 2020 7072 696e 7428 6622 416e 2075 6e65    print(f"An une
-000186a0: 7870 6563 7465 6420 6572 726f 7220 6f63  xpected error oc
-000186b0: 6375 7272 6564 3a5c 6e7b 657d 222c 2066  curred:\n{e}", f
-000186c0: 696c 653d 7379 732e 7374 6465 7272 290a  ile=sys.stderr).
-000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186e0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-000186f0: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
-00018700: 2020 6465 6620 5f67 6c61 6369 6572 5f72    def _glacier_r
-00018710: 6573 746f 7265 2873 656c 662c 2062 7563  estore(self, buc
-00018720: 6b65 742c 2070 7265 6669 782c 206b 6565  ket, prefix, kee
-00018730: 705f 6461 7973 3d33 302c 2072 6574 5f6f  p_days=30, ret_o
-00018740: 7074 3d22 4275 6c6b 222c 2072 6563 7572  pt="Bulk", recur
-00018750: 7369 7665 3d46 616c 7365 293a 0a20 2020  sive=False):.   
-00018760: 2020 2020 2023 2074 6869 7320 6973 2064       # this is d
-00018770: 726f 7070 696e 6720 6261 636b 2074 6f20  ropping back to 
-00018780: 6465 6661 756c 7420 6372 6564 732c 206e  default creds, n
-00018790: 6565 6420 746f 2066 6978 0a20 2020 2020  eed to fix.     
-000187a0: 2020 2023 2070 7269 6e74 2822 4157 535f     # print("AWS_
-000187b0: 4143 4345 5353 5f4b 4559 5f49 443a 222c  ACCESS_KEY_ID:",
-000187c0: 206f 732e 656e 7669 726f 6e5b 2741 5753   os.environ['AWS
-000187d0: 5f41 4343 4553 535f 4b45 595f 4944 275d  _ACCESS_KEY_ID']
-000187e0: 290a 2020 2020 2020 2020 2320 7072 696e  ).        # prin
-000187f0: 7428 2241 5753 5f50 524f 4649 4c45 3a22  t("AWS_PROFILE:"
-00018800: 2c20 6f73 2e65 6e76 6972 6f6e 5b27 4157  , os.environ['AW
-00018810: 535f 5052 4f46 494c 4527 5d29 0a20 2020  S_PROFILE']).   
-00018820: 2020 2020 2067 6c61 6369 6572 5f63 6c61       glacier_cla
-00018830: 7373 6573 203d 207b 2747 4c41 4349 4552  sses = {'GLACIER
-00018840: 272c 2027 4445 4550 5f41 5243 4849 5645  ', 'DEEP_ARCHIVE
-00018850: 277d 0a20 2020 2020 2020 2074 7279 3a0a  '}.        try:.
-00018860: 2020 2020 2020 2020 2020 2020 2320 6e6f              # no
-00018870: 7420 6e65 6564 6564 2068 6572 6520 6173  t needed here as
-00018880: 2070 726f 6669 6c65 2063 6f6d 6573 2066   profile comes f
-00018890: 726f 6d20 656e 760a 2020 2020 2020 2020  rom env.        
-000188a0: 2020 2020 2320 7365 7373 696f 6e20 3d20      # session = 
-000188b0: 626f 746f 332e 5365 7373 696f 6e28 7072  boto3.Session(pr
-000188c0: 6f66 696c 655f 6e61 6d65 3d70 726f 6669  ofile_name=profi
-000188d0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-000188e0: 2320 7333 203d 2073 6573 7369 6f6e 2e63  # s3 = session.c
-000188f0: 6c69 656e 7428 2773 3327 290a 2020 2020  lient('s3').    
-00018900: 2020 2020 2020 2020 7333 203d 2062 6f74          s3 = bot
-00018910: 6f33 2e63 6c69 656e 7428 2773 3327 290a  o3.client('s3').
-00018920: 2020 2020 2020 2020 2020 2020 7061 6769              pagi
-00018930: 6e61 746f 7220 3d20 7333 2e67 6574 5f70  nator = s3.get_p
-00018940: 6167 696e 6174 6f72 2827 6c69 7374 5f6f  aginator('list_o
-00018950: 626a 6563 7473 5f76 3227 290a 2020 2020  bjects_v2').    
-00018960: 2020 2020 2020 2020 7061 6765 7320 3d20          pages = 
-00018970: 7061 6769 6e61 746f 722e 7061 6769 6e61  paginator.pagina
-00018980: 7465 2842 7563 6b65 743d 6275 636b 6574  te(Bucket=bucket
-00018990: 2c20 5072 6566 6978 3d70 7265 6669 7829  , Prefix=prefix)
-000189a0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000189b0: 626f 746f 636f 7265 2e65 7863 6570 7469  botocore.excepti
-000189c0: 6f6e 732e 436c 6965 6e74 4572 726f 7220  ons.ClientError 
-000189d0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000189e0: 2020 6572 726f 725f 636f 6465 203d 2065    error_code = e
-000189f0: 2e72 6573 706f 6e73 655b 2745 7272 6f72  .response['Error
-00018a00: 275d 5b27 436f 6465 275d 0a20 2020 2020  ']['Code'].     
-00018a10: 2020 2020 2020 2069 6620 6572 726f 725f         if error_
-00018a20: 636f 6465 203d 3d20 2741 6363 6573 7344  code == 'AccessD
-00018a30: 656e 6965 6427 3a0a 2020 2020 2020 2020  enied':.        
-00018a40: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00018a50: 4163 6365 7373 2064 656e 6965 6420 666f  Access denied fo
-00018a60: 7220 6275 636b 6574 2027 7b62 7563 6b65  r bucket '{bucke
-00018a70: 747d 2722 2c20 6669 6c65 3d73 7973 2e73  t}'", file=sys.s
-00018a80: 7464 6572 7229 0a20 2020 2020 2020 2020  tderr).         
-00018a90: 2020 2020 2020 2070 7269 6e74 2827 4368         print('Ch
-00018aa0: 6563 6b20 796f 7572 2070 6572 6d69 7373  eck your permiss
-00018ab0: 696f 6e73 2061 6e64 2f6f 7220 6372 6564  ions and/or cred
-00018ac0: 656e 7469 616c 732e 272c 2066 696c 653d  entials.', file=
-00018ad0: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
-00018ae0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018af0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00018b00: 696e 745f 6572 726f 7228 290a 2020 2020  int_error().    
-00018b10: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00018b20: 5d2c 205b 5d2c 205b 5d0a 2020 2020 2020  ], [], [].      
-00018b30: 2020 7472 6967 6765 7265 645f 6b65 7973    triggered_keys
-00018b40: 203d 205b 5d0a 2020 2020 2020 2020 7265   = [].        re
-00018b50: 7374 6f72 696e 675f 6b65 7973 203d 205b  storing_keys = [
-00018b60: 5d0a 2020 2020 2020 2020 7265 7374 6f72  ].        restor
-00018b70: 6564 5f6b 6579 7320 3d20 5b5d 0a20 2020  ed_keys = [].   
-00018b80: 2020 2020 206e 6f74 5f67 6c61 6369 6572       not_glacier
-00018b90: 5f6b 6579 7320 3d20 5b5d 0a20 2020 2020  _keys = [].     
-00018ba0: 2020 2066 6f72 2070 6167 6520 696e 2070     for page in p
-00018bb0: 6167 6573 3a0a 2020 2020 2020 2020 2020  ages:.          
-00018bc0: 2020 6966 206e 6f74 2027 436f 6e74 656e    if not 'Conten
-00018bd0: 7473 2720 696e 2070 6167 653a 0a20 2020  ts' in page:.   
-00018be0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00018bf0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00018c00: 2020 666f 7220 6f62 6a20 696e 2070 6167    for obj in pag
-00018c10: 655b 2743 6f6e 7465 6e74 7327 5d3a 0a20  e['Contents']:. 
-00018c20: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00018c30: 626a 6563 745f 6b65 7920 3d20 6f62 6a5b  bject_key = obj[
-00018c40: 274b 6579 275d 0a20 2020 2020 2020 2020  'Key'].         
-00018c50: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00018c60: 6620 7468 6572 6520 6172 6520 6164 6469  f there are addi
-00018c70: 7469 6f6e 616c 2073 6c61 7368 6573 2061  tional slashes a
-00018c80: 6674 6572 2074 6865 2070 7265 6669 782c  fter the prefix,
-00018c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ca0: 2023 2069 6e64 6963 6174 696e 6720 7468   # indicating th
-00018cb0: 6174 2074 6865 206f 626a 6563 7420 6973  at the object is
-00018cc0: 2069 6e20 6120 7375 6266 6f6c 6465 722e   in a subfolder.
-00018cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ce0: 2072 656d 6169 6e69 6e67 5f70 6174 6820   remaining_path 
-00018cf0: 3d20 6f62 6a65 6374 5f6b 6579 5b6c 656e  = object_key[len
-00018d00: 2870 7265 6669 7829 3a5d 0a20 2020 2020  (prefix):].     
-00018d10: 2020 2020 2020 2020 2020 2069 6620 272f             if '/
-00018d20: 2720 696e 2072 656d 6169 6e69 6e67 5f70  ' in remaining_p
-00018d30: 6174 6820 616e 6420 6e6f 7420 7265 6375  ath and not recu
-00018d40: 7273 6976 653a 0a20 2020 2020 2020 2020  rsive:.         
-00018d50: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00018d60: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00018d70: 2020 2020 6865 6164 6572 203d 2073 332e      header = s3.
-00018d80: 6865 6164 5f6f 626a 6563 7428 4275 636b  head_object(Buck
-00018d90: 6574 3d62 7563 6b65 742c 204b 6579 3d6f  et=bucket, Key=o
-00018da0: 626a 6563 745f 6b65 7929 0a20 2020 2020  bject_key).     
-00018db0: 2020 2020 2020 2020 2020 2069 6620 2753             if 'S
-00018dc0: 746f 7261 6765 436c 6173 7327 2069 6e20  torageClass' in 
-00018dd0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-00018de0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00018df0: 6f74 2068 6561 6465 725b 2753 746f 7261  ot header['Stora
-00018e00: 6765 436c 6173 7327 5d20 696e 2067 6c61  geClass'] in gla
-00018e10: 6369 6572 5f63 6c61 7373 6573 3a0a 2020  cier_classes:.  
-00018e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e30: 2020 2020 2020 6e6f 745f 676c 6163 6965        not_glacie
-00018e40: 725f 6b65 7973 2e61 7070 656e 6428 6f62  r_keys.append(ob
-00018e50: 6a65 6374 5f6b 6579 290a 2020 2020 2020  ject_key).      
-00018e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e70: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018e80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ea0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00018eb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018ec0: 2027 5265 7374 6f72 6527 2069 6e20 6865   'Restore' in he
-00018ed0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00018ee0: 2020 2020 2020 2020 2020 6966 2027 6f6e            if 'on
-00018ef0: 676f 696e 672d 7265 7175 6573 743d 2274  going-request="t
-00018f00: 7275 6522 2720 696e 2068 6561 6465 725b  rue"' in header[
-00018f10: 2752 6573 746f 7265 275d 3a0a 2020 2020  'Restore']:.    
-00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f30: 2020 2020 7265 7374 6f72 696e 675f 6b65      restoring_ke
-00018f40: 7973 2e61 7070 656e 6428 6f62 6a65 6374  ys.append(object
-00018f50: 5f6b 6579 290a 2020 2020 2020 2020 2020  _key).          
-00018f60: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00018f70: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00018f80: 2020 2020 2020 2069 6620 2752 6573 746f         if 'Resto
-00018f90: 7265 2720 696e 2068 6561 6465 723a 0a20  re' in header:. 
-00018fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fb0: 2020 2069 6620 276f 6e67 6f69 6e67 2d72     if 'ongoing-r
-00018fc0: 6571 7565 7374 3d22 6661 6c73 6522 2720  equest="false"' 
-00018fd0: 696e 2068 6561 6465 725b 2752 6573 746f  in header['Resto
-00018fe0: 7265 275d 3a0a 2020 2020 2020 2020 2020  re']:.          
-00018ff0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00019000: 7374 6f72 6564 5f6b 6579 732e 6170 7065  stored_keys.appe
-00019010: 6e64 286f 626a 6563 745f 6b65 7929 0a20  nd(object_key). 
-00019020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019030: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00019040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019050: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00019060: 2020 2020 2020 2020 2073 332e 7265 7374           s3.rest
-00019070: 6f72 655f 6f62 6a65 6374 280a 2020 2020  ore_object(.    
-00019080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019090: 2020 2020 4275 636b 6574 3d62 7563 6b65      Bucket=bucke
-000190a0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-000190b0: 2020 2020 2020 2020 2020 204b 6579 3d6f             Key=o
-000190c0: 626a 6563 745f 6b65 792c 0a20 2020 2020  bject_key,.     
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190e0: 2020 2052 6573 746f 7265 5265 7175 6573     RestoreReques
-000190f0: 743d 7b0a 2020 2020 2020 2020 2020 2020  t={.            
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 2744 6179 7327 3a20 6b65 6570 5f64 6179  'Days': keep_day
-00019120: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00019130: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00019140: 476c 6163 6965 724a 6f62 5061 7261 6d65  GlacierJobParame
-00019150: 7465 7273 273a 207b 0a20 2020 2020 2020  ters': {.       
-00019160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019170: 2020 2020 2020 2020 2027 5469 6572 273a           'Tier':
-00019180: 2072 6574 5f6f 7074 0a20 2020 2020 2020   ret_opt.       
-00019190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191a0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-000191b0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000191c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000191d0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000191e0: 2020 2020 2020 2020 2020 2074 7269 6767             trigg
-000191f0: 6572 6564 5f6b 6579 732e 6170 7065 6e64  ered_keys.append
-00019200: 286f 626a 6563 745f 6b65 7929 0a20 2020  (object_key).   
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2070 7269 6e74 6462 6728 0a20 2020 2020   printdbg(.     
-00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019240: 2020 2066 2752 6573 746f 7265 2072 6571     f'Restore req
-00019250: 7565 7374 2069 6e69 7469 6174 6564 2066  uest initiated f
-00019260: 6f72 207b 6f62 6a65 6374 5f6b 6579 7d20  or {object_key} 
-00019270: 7573 696e 6720 7b72 6574 5f6f 7074 7d20  using {ret_opt} 
-00019280: 7265 7472 6965 7661 6c2e 2729 0a20 2020  retrieval.').   
-00019290: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000192a0: 6570 7420 626f 746f 636f 7265 2e65 7863  ept botocore.exc
-000192b0: 6570 7469 6f6e 732e 436c 6965 6e74 4572  eptions.ClientEr
-000192c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-000192d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000192e0: 2065 2e72 6573 706f 6e73 655b 2745 7272   e.response['Err
-000192f0: 6f72 275d 5b27 436f 6465 275d 203d 3d20  or']['Code'] == 
-00019300: 2752 6573 746f 7265 416c 7265 6164 7949  'RestoreAlreadyI
-00019310: 6e50 726f 6772 6573 7327 3a0a 2020 2020  nProgress':.    
-00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019330: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019350: 2020 2020 2020 2066 2752 6573 746f 7265         f'Restore
-00019360: 2069 7320 616c 7265 6164 7920 696e 2070   is already in p
-00019370: 726f 6772 6573 7320 666f 7220 7b6f 626a  rogress for {obj
-00019380: 6563 745f 6b65 797d 2e20 536b 6970 7069  ect_key}. Skippi
-00019390: 6e67 2e2e 2e27 290a 2020 2020 2020 2020  ng...').        
-000193a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193b0: 7265 7374 6f72 696e 675f 6b65 7973 2e61  restoring_keys.a
-000193c0: 7070 656e 6428 6f62 6a65 6374 5f6b 6579  ppend(object_key
-000193d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000193e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000193f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019400: 2020 2020 7072 696e 7428 6627 4572 726f      print(f'Erro
-00019410: 7220 6f63 6375 7272 6564 2066 6f72 207b  r occurred for {
-00019420: 6f62 6a65 6374 5f6b 6579 7d3a 207b 657d  object_key}: {e}
-00019430: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00019440: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-00019450: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019460: 7269 6e74 2866 2752 6573 746f 7265 2072  rint(f'Restore r
-00019470: 6571 7565 7374 2066 6f72 207b 6f62 6a65  equest for {obje
-00019480: 6374 5f6b 6579 7d20 6661 696c 6564 2e27  ct_key} failed.'
-00019490: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000194a0: 2074 7269 6767 6572 6564 5f6b 6579 732c   triggered_keys,
-000194b0: 2072 6573 746f 7269 6e67 5f6b 6579 732c   restoring_keys,
-000194c0: 2072 6573 746f 7265 645f 6b65 7973 2c20   restored_keys, 
-000194d0: 6e6f 745f 676c 6163 6965 725f 6b65 7973  not_glacier_keys
-000194e0: 0a0a 2020 2020 6465 6620 6d64 3573 756d  ..    def md5sum
-000194f0: 6578 2873 656c 662c 2066 696c 655f 7061  ex(self, file_pa
-00019500: 7468 293a 0a20 2020 2020 2020 2074 7279  th):.        try
-00019510: 3a0a 2020 2020 2020 2020 2020 2020 636d  :.            cm
-00019520: 6420 3d20 6627 6d64 3573 756d 207b 6669  d = f'md5sum {fi
-00019530: 6c65 5f70 6174 687d 270a 2020 2020 2020  le_path}'.      
-00019540: 2020 2020 2020 7265 7420 3d20 7375 6270        ret = subp
-00019550: 726f 6365 7373 2e72 756e 2863 6d64 2c20  rocess.run(cmd, 
-00019560: 7374 646f 7574 3d73 7562 7072 6f63 6573  stdout=subproces
-00019570: 732e 5049 5045 2c0a 2020 2020 2020 2020  s.PIPE,.        
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 2020 2020 2020 2020 2073 7464 6572 723d           stderr=
-000195a0: 7375 6270 726f 6365 7373 2e50 4950 452c  subprocess.PIPE,
-000195b0: 2053 6865 6c6c 3d54 7275 6529 0a20 2020   Shell=True).   
-000195c0: 2020 2020 2020 2020 2069 6620 7265 742e           if ret.
-000195d0: 7265 7475 726e 636f 6465 2021 3d20 303a  returncode != 0:
-000195e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000195f0: 2070 7269 6e74 2866 276d 6435 7375 6d20   print(f'md5sum 
-00019600: 7265 7475 726e 2063 6f64 6520 3e20 303a  return code > 0:
-00019610: 207b 636d 647d 2045 7272 6f72 3a5c 6e7b   {cmd} Error:\n{
-00019620: 7265 742e 7374 6465 7272 7d27 290a 2020  ret.stderr}').  
-00019630: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019640: 2072 6574 2e73 7464 6f75 742e 7374 7269   ret.stdout.stri
-00019650: 7028 2920 2023 202c 2072 6574 2e73 7464  p()  # , ret.std
-00019660: 6572 722e 7374 7269 7028 290a 0a20 2020  err.strip()..   
-00019670: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00019680: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00019690: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-000196a0: 6d64 3573 756d 2045 7272 6f72 3a20 7b73  md5sum Error: {s
-000196b0: 7472 2865 297d 2729 0a20 2020 2020 2020  tr(e)}').       
-000196c0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000196d0: 2c20 7374 7228 6529 0a0a 2020 2020 6465  , str(e)..    de
-000196e0: 6620 6d64 3573 756d 2873 656c 662c 2066  f md5sum(self, f
-000196f0: 696c 655f 7061 7468 293a 0a20 2020 2020  ile_path):.     
-00019700: 2020 2027 2727 4361 6c63 756c 6174 6520     '''Calculate 
-00019710: 6d64 3573 756d 206f 6620 6120 6669 6c65  md5sum of a file
-00019720: 2727 270a 0a20 2020 2020 2020 206d 6435  '''..        md5
-00019730: 5f68 6173 6820 3d20 6861 7368 6c69 622e  _hash = hashlib.
-00019740: 6d64 3528 290a 2020 2020 2020 2020 7769  md5().        wi
-00019750: 7468 206f 7065 6e28 6669 6c65 5f70 6174  th open(file_pat
-00019760: 682c 2022 7262 2229 2061 7320 663a 0a20  h, "rb") as f:. 
-00019770: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00019780: 6875 6e6b 2069 6e20 6974 6572 286c 616d  hunk in iter(lam
-00019790: 6264 613a 2066 2e72 6561 6428 3430 3936  bda: f.read(4096
-000197a0: 292c 2062 2222 293a 0a20 2020 2020 2020  ), b""):.       
-000197b0: 2020 2020 2020 2020 206d 6435 5f68 6173           md5_has
-000197c0: 682e 7570 6461 7465 2863 6875 6e6b 290a  h.update(chunk).
-000197d0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-000197e0: 6435 5f68 6173 682e 6865 7864 6967 6573  d5_hash.hexdiges
-000197f0: 7428 290a 0a20 2020 2064 6566 2075 6964  t()..    def uid
-00019800: 3275 7365 7228 7365 6c66 2c20 7569 6429  2user(self, uid)
-00019810: 3a0a 2020 2020 2020 2020 2320 7472 7920  :.        # try 
-00019820: 746f 2063 6f6e 7665 7274 2075 6964 2074  to convert uid t
-00019830: 6f20 7573 6572 206e 616d 650a 2020 2020  o user name.    
-00019840: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00019850: 2020 2020 2072 6574 7572 6e20 7077 642e       return pwd.
-00019860: 6765 7470 7775 6964 2875 6964 295b 305d  getpwuid(uid)[0]
-00019870: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-00019880: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00019890: 6e74 6462 6728 6627 7569 6432 7573 6572  ntdbg(f'uid2user
-000198a0: 3a20 4572 726f 7220 636f 6e76 6572 7469  : Error converti
-000198b0: 6e67 2075 6964 207b 7569 647d 2729 0a20  ng uid {uid}'). 
-000198c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000198d0: 6e20 7569 640a 0a20 2020 2064 6566 2067  n uid..    def g
-000198e0: 6964 3267 726f 7570 2873 656c 662c 2067  id2group(self, g
-000198f0: 6964 293a 0a20 2020 2020 2020 2023 2074  id):.        # t
-00019900: 7279 2074 6f20 636f 6e76 6572 7420 6769  ry to convert gi
-00019910: 6420 746f 2067 726f 7570 206e 616d 650a  d to group name.
-00019920: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00019930: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019940: 6772 702e 6765 7467 7267 6964 2867 6964  grp.getgrgid(gid
-00019950: 295b 305d 0a20 2020 2020 2020 2065 7863  )[0].        exc
-00019960: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00019970: 2070 7269 6e74 6462 6728 6627 6769 6432   printdbg(f'gid2
-00019980: 6772 6f75 703a 2045 7272 6f72 2063 6f6e  group: Error con
-00019990: 7665 7274 696e 6720 6769 6420 7b67 6964  verting gid {gid
-000199a0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-000199b0: 7265 7475 726e 2067 6964 0a0a 2020 2020  return gid..    
-000199c0: 6465 6620 6461 7973 6167 6f28 7365 6c66  def daysago(self
-000199d0: 2c20 756e 6978 7469 6d65 293a 0a20 2020  , unixtime):.   
-000199e0: 2020 2020 2023 2068 6f77 206d 616e 7920       # how many 
-000199f0: 6461 7973 2061 676f 2069 7320 7468 6973  days ago is this
-00019a00: 2065 706f 6368 2074 696d 6520 3f0a 2020   epoch time ?.  
-00019a10: 2020 2020 2020 6966 206e 6f74 2075 6e69        if not uni
-00019a20: 7874 696d 653a 0a20 2020 2020 2020 2020  xtime:.         
-00019a30: 2020 2070 7269 6e74 6462 6728 0a20 2020     printdbg(.   
-00019a40: 2020 2020 2020 2020 2020 2020 2027 6461               'da
-00019a50: 7973 6167 6f3a 2061 6e20 696e 7465 6765  ysago: an intege
-00019a60: 7220 6973 2072 6571 7569 7265 6420 2867  r is required (g
-00019a70: 6f74 2074 7970 6520 4e6f 6e65 5479 7065  ot type NoneType
-00019a80: 2927 290a 2020 2020 2020 2020 2020 2020  )').            
-00019a90: 7265 7475 726e 2030 0a20 2020 2020 2020  return 0.       
-00019aa0: 2064 6966 6620 3d20 6461 7465 7469 6d65   diff = datetime
-00019ab0: 2e64 6174 6574 696d 652e 6e6f 7728 292d  .datetime.now()-
-00019ac0: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-00019ad0: 652e 6672 6f6d 7469 6d65 7374 616d 7028  e.fromtimestamp(
-00019ae0: 756e 6978 7469 6d65 290a 2020 2020 2020  unixtime).      
-00019af0: 2020 7265 7475 726e 2064 6966 662e 6461    return diff.da
-00019b00: 7973 0a0a 2020 2020 6465 6620 636f 6e76  ys..    def conv
-00019b10: 6572 745f 7369 7a65 2873 656c 662c 2073  ert_size(self, s
-00019b20: 697a 655f 6279 7465 7329 3a0a 2020 2020  ize_bytes):.    
-00019b30: 2020 2020 6966 2073 697a 655f 6279 7465      if size_byte
-00019b40: 7320 3d3d 2030 3a0a 2020 2020 2020 2020  s == 0:.        
-00019b50: 2020 2020 7265 7475 726e 2022 3042 220a      return "0B".
-00019b60: 2020 2020 2020 2020 7369 7a65 5f6e 616d          size_nam
-00019b70: 6520 3d20 2822 4222 2c20 224b 6942 222c  e = ("B", "KiB",
-00019b80: 2022 4d69 4222 2c20 2247 6942 222c 2022   "MiB", "GiB", "
-00019b90: 5469 4222 2c20 2250 6942 222c 2022 4569  TiB", "PiB", "Ei
-00019ba0: 4222 290a 2020 2020 2020 2020 6920 3d20  B").        i = 
-00019bb0: 696e 7428 6d61 7468 2e66 6c6f 6f72 286d  int(math.floor(m
-00019bc0: 6174 682e 6c6f 6728 7369 7a65 5f62 7974  ath.log(size_byt
-00019bd0: 6573 2c20 3130 3234 2929 290a 2020 2020  es, 1024))).    
-00019be0: 2020 2020 7020 3d20 6d61 7468 2e70 6f77      p = math.pow
-00019bf0: 2831 3032 342c 2069 290a 2020 2020 2020  (1024, i).      
-00019c00: 2020 7320 3d20 726f 756e 6428 7369 7a65    s = round(size
-00019c10: 5f62 7974 6573 2f70 2c20 3329 0a20 2020  _bytes/p, 3).   
-00019c20: 2020 2020 2072 6574 7572 6e20 6622 7b73       return f"{s
-00019c30: 7d20 7b73 697a 655f 6e61 6d65 5b69 5d7d  } {size_name[i]}
-00019c40: 220a 0a20 2020 2064 6566 205f 6172 6368  "..    def _arch
-00019c50: 6976 655f 6a73 6f6e 5f61 6464 5f65 6e74  ive_json_add_ent
-00019c60: 7279 2873 656c 662c 206b 6579 2c20 7661  ry(self, key, va
-00019c70: 6c75 6529 3a0a 2020 2020 2020 2020 2727  lue):.        ''
-00019c80: 2741 6464 2061 206e 6577 2065 6e74 7279  'Add a new entry
-00019c90: 2074 6f20 7468 6520 6172 6368 6976 6520   to the archive 
-00019ca0: 4a53 4f4e 2066 696c 6527 2727 0a0a 2020  JSON file'''..  
-00019cb0: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
-00019cc0: 7a65 2074 6865 2064 6174 6120 6469 6374  ze the data dict
-00019cd0: 696f 6e61 7279 2069 6e20 6361 7365 2061  ionary in case a
-00019ce0: 7263 6869 7665 5f6a 736f 6e20 646f 6573  rchive_json does
-00019cf0: 206e 6f74 2065 7869 7374 0a20 2020 2020   not exist.     
-00019d00: 2020 2064 6174 6120 3d20 7b7d 0a0a 2020     data = {}..  
-00019d10: 2020 2020 2020 2320 5265 6164 2074 6865        # Read the
-00019d20: 2061 7263 6869 7665 204a 534f 4e20 6669   archive JSON fi
-00019d30: 6c65 0a20 2020 2020 2020 2069 6620 6f73  le.        if os
-00019d40: 2e70 6174 682e 6973 6669 6c65 2873 656c  .path.isfile(sel
-00019d50: 662e 6172 6368 6976 655f 6a73 6f6e 293a  f.archive_json):
-00019d60: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00019d70: 6820 6f70 656e 2873 656c 662e 6172 6368  h open(self.arch
-00019d80: 6976 655f 6a73 6f6e 2c20 2772 2729 2061  ive_json, 'r') a
-00019d90: 7320 6669 6c65 3a0a 2020 2020 2020 2020  s file:.        
-00019da0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00019db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019dc0: 2064 6174 6120 3d20 6a73 6f6e 2e6c 6f61   data = json.loa
-00019dd0: 6428 6669 6c65 290a 2020 2020 2020 2020  d(file).        
-00019de0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e00: 2020 2020 7072 696e 7428 2745 7272 6f72      print('Error
-00019e10: 2069 6e20 4172 6368 6976 6572 2e5f 6172   in Archiver._ar
-00019e20: 6368 6976 655f 6a73 6f6e 5f61 6464 5f65  chive_json_add_e
-00019e30: 6e74 7279 2829 3a27 290a 2020 2020 2020  ntry():').      
-00019e40: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00019e50: 696e 7428 6627 4361 6e6e 6f74 2072 6561  int(f'Cannot rea
-00019e60: 6420 7b73 656c 662e 6172 6368 6976 655f  d {self.archive_
-00019e70: 6a73 6f6e 7d2c 2066 696c 6520 636f 7272  json}, file corr
-00019e80: 7570 743f 2729 0a20 2020 2020 2020 2020  upt?').         
-00019e90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00019ea0: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
-00019eb0: 2023 2041 6464 2074 6865 206e 6577 2065   # Add the new e
-00019ec0: 6e74 7279 2074 6f20 7468 6520 6461 7461  ntry to the data
-00019ed0: 2064 6963 7469 6f6e 6172 790a 2020 2020   dictionary.    
-00019ee0: 2020 2020 6461 7461 5b6b 6579 5d20 3d20      data[key] = 
-00019ef0: 7661 6c75 650a 0a20 2020 2020 2020 2023  value..        #
-00019f00: 2057 7269 7465 2074 6865 2075 7064 6174   Write the updat
-00019f10: 6564 2064 6174 6120 6469 6374 696f 6e61  ed data dictiona
-00019f20: 7279 2074 6f20 7468 6520 6172 6368 6976  ry to the archiv
-00019f30: 6520 4a53 4f4e 2066 696c 650a 2020 2020  e JSON file.    
-00019f40: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
-00019f50: 6c66 2e61 7263 6869 7665 5f6a 736f 6e2c  lf.archive_json,
-00019f60: 2027 7727 2920 6173 2066 696c 653a 0a20   'w') as file:. 
-00019f70: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
-00019f80: 6475 6d70 2864 6174 612c 2066 696c 652c  dump(data, file,
-00019f90: 2069 6e64 656e 743d 3429 0a0a 2020 2020   indent=4)..    
-00019fa0: 6465 6620 5f69 735f 666f 6c64 6572 5f61  def _is_folder_a
-00019fb0: 7263 6869 7665 6428 7365 6c66 2c20 666f  rchived(self, fo
-00019fc0: 6c64 6572 293a 0a20 2020 2020 2020 2027  lder):.        '
-00019fd0: 2727 4368 6563 6b20 6966 2061 6e20 656e  ''Check if an en
-00019fe0: 7472 7920 6578 6973 7473 2069 6e20 7468  try exists in th
-00019ff0: 6520 6172 6368 6976 6520 4a53 4f4e 2066  e archive JSON f
-0001a000: 696c 6527 2727 0a0a 2020 2020 2020 2020  ile'''..        
-0001a010: 7265 7475 726e 2028 7365 6c66 2e61 7263  return (self.arc
-0001a020: 6869 7665 5f6a 736f 6e5f 6765 745f 726f  hive_json_get_ro
-0001a030: 7728 666f 6c64 6572 2920 213d 204e 6f6e  w(folder) != Non
-0001a040: 6529 0a0a 2020 2020 6465 6620 6172 6368  e)..    def arch
-0001a050: 6976 655f 6765 745f 6275 636b 6574 5f69  ive_get_bucket_i
-0001a060: 6e66 6f28 7365 6c66 2c20 666f 6c64 6572  nfo(self, folder
-0001a070: 293a 0a20 2020 2020 2020 2023 2072 6574  ):.        # ret
-0001a080: 7572 6e73 2062 7563 6b65 7428 7374 7229  urns bucket(str)
-0001a090: 2c20 7072 6566 6978 2873 7472 292c 2072  , prefix(str), r
-0001a0a0: 6563 7572 7369 7665 2862 6f6f 6c29 2c20  ecursive(bool), 
-0001a0b0: 676c 6163 6965 7228 626f 6f6c 290a 2020  glacier(bool).  
-0001a0c0: 2020 2020 2020 7265 6375 7273 6976 6520        recursive 
-0001a0d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0001a0e0: 676c 6163 6965 7220 3d20 4661 6c73 650a  glacier = False.
-0001a0f0: 2020 2020 2020 2020 726f 7764 6963 7420          rowdict 
-0001a100: 3d20 7365 6c66 2e61 7263 6869 7665 5f6a  = self.archive_j
-0001a110: 736f 6e5f 6765 745f 726f 7728 666f 6c64  son_get_row(fold
-0001a120: 6572 290a 2020 2020 2020 2020 7072 696e  er).        prin
-0001a130: 7464 6267 2866 2770 6174 683a 207b 666f  tdbg(f'path: {fo
-0001a140: 6c64 6572 7d20 726f 7764 6963 743a 207b  lder} rowdict: {
-0001a150: 726f 7764 6963 747d 2729 0a20 2020 2020  rowdict}').     
-0001a160: 2020 2069 6620 726f 7764 6963 7420 3d3d     if rowdict ==
-0001a170: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001a180: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
-0001a190: 4e6f 6e65 2c20 7265 6375 7273 6976 652c  None, recursive,
-0001a1a0: 2067 6c61 6369 6572 0a20 2020 2020 2020   glacier.       
-0001a1b0: 2069 6620 2761 7263 6869 7665 5f6d 6f64   if 'archive_mod
-0001a1c0: 6527 2069 6e20 726f 7764 6963 743a 0a20  e' in rowdict:. 
-0001a1d0: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-0001a1e0: 7764 6963 745b 2761 7263 6869 7665 5f6d  wdict['archive_m
-0001a1f0: 6f64 6527 5d20 3d3d 2022 5265 6375 7273  ode'] == "Recurs
-0001a200: 6976 6522 3a0a 2020 2020 2020 2020 2020  ive":.          
-0001a210: 2020 2020 2020 7265 6375 7273 6976 6520        recursive 
-0001a220: 3d20 5472 7565 0a20 2020 2020 2020 2073  = True.        s
-0001a230: 335f 7374 6f72 6167 655f 636c 6173 7320  3_storage_class 
-0001a240: 3d20 726f 7764 6963 745b 2773 335f 7374  = rowdict['s3_st
-0001a250: 6f72 6167 655f 636c 6173 7327 5d0a 2020  orage_class'].  
-0001a260: 2020 2020 2020 6966 2073 335f 7374 6f72        if s3_stor
-0001a270: 6167 655f 636c 6173 7320 696e 205b 2744  age_class in ['D
-0001a280: 4545 505f 4152 4348 4956 4527 2c20 2747  EEP_ARCHIVE', 'G
-0001a290: 4c41 4349 4552 275d 3a0a 2020 2020 2020  LACIER']:.      
-0001a2a0: 2020 2020 2020 676c 6163 6965 7220 3d20        glacier = 
-0001a2b0: 5472 7565 0a20 2020 2020 2020 2073 7073  True.        sps
-0001a2c0: 203d 2072 6f77 6469 6374 5b27 6172 6368   = rowdict['arch
-0001a2d0: 6976 655f 666f 6c64 6572 275d 2e73 706c  ive_folder'].spl
-0001a2e0: 6974 2827 2f27 2c20 3129 0a20 2020 2020  it('/', 1).     
-0001a2f0: 2020 2062 7563 6b65 7420 3d20 7370 735b     bucket = sps[
-0001a300: 305d 2e72 6570 6c61 6365 2827 3a73 333a  0].replace(':s3:
-0001a310: 272c 2027 2729 0a20 2020 2020 2020 2070  ', '').        p
-0001a320: 7265 6669 7820 3d20 6627 7b73 7073 5b31  refix = f'{sps[1
-0001a330: 5d7d 2f27 2020 2320 7472 6169 6c69 6e67  ]}/'  # trailing
-0001a340: 2073 6c61 7368 2065 6e73 7572 6564 0a20   slash ensured. 
-0001a350: 2020 2020 2020 2072 6574 7572 6e20 6275         return bu
-0001a360: 636b 6574 2c20 7072 6566 6978 2c20 7265  cket, prefix, re
-0001a370: 6375 7273 6976 652c 2067 6c61 6369 6572  cursive, glacier
-0001a380: 0a0a 2020 2020 6465 6620 6172 6368 6976  ..    def archiv
-0001a390: 655f 6a73 6f6e 5f67 6574 5f72 6f77 2873  e_json_get_row(s
-0001a3a0: 656c 662c 2066 6f6c 6465 7229 3a0a 2020  elf, folder):.  
-0001a3b0: 2020 2020 2020 2727 2747 6574 2061 6e20        '''Get an 
-0001a3c0: 656e 7472 7920 6672 6f6d 2074 6865 2061  entry from the a
-0001a3d0: 7263 6869 7665 204a 534f 4e20 6669 6c65  rchive JSON file
-0001a3e0: 2727 270a 0a20 2020 2020 2020 2023 2049  '''..        # I
-0001a3f0: 6620 7468 6520 6172 6368 6976 6520 4a53  f the archive JS
-0001a400: 4f4e 2066 696c 6520 646f 6573 206e 6f74  ON file does not
-0001a410: 2065 7869 7374 2c20 7468 6520 656e 7472   exist, the entr
-0001a420: 7920 646f 6573 206e 6f74 2065 7869 7374  y does not exist
-0001a430: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001a440: 6f73 2e70 6174 682e 6973 6669 6c65 2873  os.path.isfile(s
-0001a450: 656c 662e 6172 6368 6976 655f 6a73 6f6e  elf.archive_json
-0001a460: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0001a470: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-0001a480: 2020 2020 2320 5265 6164 2074 6865 2061      # Read the a
-0001a490: 7263 6869 7665 204a 534f 4e20 6669 6c65  rchive JSON file
-0001a4a0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-0001a4b0: 656e 2873 656c 662e 6172 6368 6976 655f  en(self.archive_
-0001a4c0: 6a73 6f6e 2c20 2772 2729 2061 7320 6669  json, 'r') as fi
-0001a4d0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001a4e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001a4f0: 2020 2020 2064 6174 6120 3d20 6a73 6f6e       data = json
-0001a500: 2e6c 6f61 6428 6669 6c65 290a 2020 2020  .load(file).    
-0001a510: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 7072 696e 7428 2745 7272 6f72 2069 6e20  print('Error in 
-0001a540: 4172 6368 6976 6572 2e5f 6172 6368 6976  Archiver._archiv
-0001a550: 655f 6a73 6f6e 5f65 6e74 7279 5f65 7869  e_json_entry_exi
-0001a560: 7374 7328 293a 2729 0a20 2020 2020 2020  sts():').       
-0001a570: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0001a580: 2743 616e 6e6f 7420 7265 6164 207b 7365  'Cannot read {se
-0001a590: 6c66 2e61 7263 6869 7665 5f6a 736f 6e7d  lf.archive_json}
-0001a5a0: 2c20 6669 6c65 2063 6f72 7275 7074 3f27  , file corrupt?'
-0001a5b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a5c0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-0001a5d0: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-0001a5e0: 6620 7468 6520 656e 7472 7920 6578 6973  f the entry exis
-0001a5f0: 7473 2069 6e20 7468 6520 6461 7461 2064  ts in the data d
-0001a600: 6963 7469 6f6e 6172 790a 2020 2020 2020  ictionary.      
-0001a610: 2020 6966 2066 6f6c 6465 7220 696e 2064    if folder in d
-0001a620: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0001a630: 2072 6574 7572 6e20 6461 7461 5b66 6f6c   return data[fol
-0001a640: 6465 725d 0a20 2020 2020 2020 2065 6c73  der].        els
-0001a650: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0001a660: 2043 6865 636b 2069 6620 6120 7061 7265   Check if a pare
-0001a670: 6e74 2066 6f6c 6465 7220 6578 6973 7473  nt folder exists
-0001a680: 2069 6e20 7468 6520 6461 7461 2064 6963   in the data dic
-0001a690: 7469 6f6e 6172 7920 7769 7468 2072 6563  tionary with rec
-0001a6a0: 7572 7369 7665 2061 7263 6869 7669 6e67  ursive archiving
-0001a6b0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0001a6c0: 6820 3d20 5061 7468 2866 6f6c 6465 7229  h = Path(folder)
-0001a6d0: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0001a6e0: 7220 7061 7265 6e74 2069 6e20 7061 7468  r parent in path
-0001a6f0: 2e70 6172 656e 7473 3a0a 2020 2020 2020  .parents:.      
-0001a700: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-0001a710: 203d 2073 7472 2870 6172 656e 7429 0a20   = str(parent). 
-0001a720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a730: 6620 7061 7265 6e74 2069 6e20 6461 7461  f parent in data
-0001a740: 2061 6e64 2064 6174 615b 7061 7265 6e74   and data[parent
-0001a750: 5d5b 2761 7263 6869 7665 5f6d 6f64 6527  ]['archive_mode'
-0001a760: 5d20 3d3d 2027 5265 6375 7273 6976 6527  ] == 'Recursive'
-0001a770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a780: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
-0001a790: 615b 7061 7265 6e74 5d0a 0a20 2020 2020  a[parent]..     
-0001a7a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001a7b0: 6e65 0a0a 2020 2020 6465 6620 6172 6368  ne..    def arch
-0001a7c0: 6976 655f 6a73 6f6e 5f67 6574 5f63 7376  ive_json_get_csv
-0001a7d0: 2873 656c 662c 2063 6f6c 756d 6e73 293a  (self, columns):
-0001a7e0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0001a7f0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001a800: 7365 6c66 2e61 7263 6869 7665 5f6a 736f  self.archive_jso
-0001a810: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-0001a820: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-0001a830: 7769 7468 206f 7065 6e28 7365 6c66 2e61  with open(self.a
-0001a840: 7263 6869 7665 5f6a 736f 6e2c 2027 7227  rchive_json, 'r'
-0001a850: 2920 6173 2066 696c 653a 0a20 2020 2020  ) as file:.     
-0001a860: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001a870: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001a880: 203d 206a 736f 6e2e 6c6f 6164 2866 696c   = json.load(fil
-0001a890: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0001a8a0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0001a8b0: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
-0001a8c0: 7272 6f72 2069 6e20 4172 6368 6976 6572  rror in Archiver
-0001a8d0: 2e5f 6172 6368 6976 655f 6a73 6f6e 5f67  ._archive_json_g
-0001a8e0: 6574 5f63 7376 2829 3a27 290a 2020 2020  et_csv():').    
-0001a8f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001a900: 7428 6627 4361 6e6e 6f74 2072 6561 6420  t(f'Cannot read 
-0001a910: 7b73 656c 662e 6172 6368 6976 655f 6a73  {self.archive_js
-0001a920: 6f6e 7d2c 2066 696c 6520 636f 7272 7570  on}, file corrup
-0001a930: 743f 2729 0a20 2020 2020 2020 2020 2020  t?').           
-0001a940: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-0001a950: 2020 2020 2023 2053 6f72 7420 6461 7461       # Sort data
-0001a960: 2062 7920 7469 6d65 7374 616d 7020 696e   by timestamp in
-0001a970: 2072 6576 6572 7365 206f 7264 6572 0a20   reverse order. 
-0001a980: 2020 2020 2020 2073 6f72 7465 645f 6461         sorted_da
-0001a990: 7461 203d 2073 6f72 7465 6428 0a20 2020  ta = sorted(.   
-0001a9a0: 2020 2020 2020 2020 2064 6174 612e 6974           data.it
-0001a9b0: 656d 7328 292c 206b 6579 3d6c 616d 6264  ems(), key=lambd
-0001a9c0: 6120 783a 2078 5b31 5d5b 2774 696d 6573  a x: x[1]['times
-0001a9d0: 7461 6d70 275d 2c20 7265 7665 7273 653d  tamp'], reverse=
-0001a9e0: 5472 7565 290a 0a20 2020 2020 2020 2023  True)..        #
-0001a9f0: 2050 7265 7061 7265 2043 5356 2064 6174   Prepare CSV dat
-0001aa00: 610a 2020 2020 2020 2020 6373 765f 6461  a.        csv_da
-0001aa10: 7461 203d 205b 636f 6c75 6d6e 735d 0a0a  ta = [columns]..
-0001aa20: 2020 2020 2020 2020 666f 7220 7061 7468          for path
-0001aa30: 5f6e 616d 652c 2072 6f77 5f64 6174 6120  _name, row_data 
-0001aa40: 696e 2073 6f72 7465 645f 6461 7461 3a0a  in sorted_data:.
-0001aa50: 2020 2020 2020 2020 2020 2020 6373 765f              csv_
-0001aa60: 726f 7720 3d20 5b72 6f77 5f64 6174 615b  row = [row_data[
-0001aa70: 636f 6c5d 2066 6f72 2063 6f6c 2069 6e20  col] for col in 
-0001aa80: 636f 6c75 6d6e 7320 6966 2063 6f6c 2069  columns if col i
-0001aa90: 6e20 726f 775f 6461 7461 5d0a 2020 2020  n row_data].    
-0001aaa0: 2020 2020 2020 2020 6373 765f 6461 7461          csv_data
-0001aab0: 2e61 7070 656e 6428 6373 765f 726f 7729  .append(csv_row)
-0001aac0: 0a0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
-0001aad0: 6572 7420 4353 5620 6461 7461 2074 6f20  ert CSV data to 
-0001aae0: 6120 4353 5620 7374 7269 6e67 0a20 2020  a CSV string.   
-0001aaf0: 2020 2020 206f 7574 7075 7420 3d20 696f       output = io
-0001ab00: 2e53 7472 696e 6749 4f28 290a 0a20 2020  .StringIO()..   
-0001ab10: 2020 2020 2077 7269 7465 7220 3d20 6373       writer = cs
-0001ab20: 762e 7772 6974 6572 286f 7574 7075 742c  v.writer(output,
-0001ab30: 2064 6961 6c65 6374 3d27 6578 6365 6c27   dialect='excel'
-0001ab40: 290a 2020 2020 2020 2020 7772 6974 6572  ).        writer
-0001ab50: 2e77 7269 7465 726f 7773 2863 7376 5f64  .writerows(csv_d
-0001ab60: 6174 6129 0a20 2020 2020 2020 2063 7376  ata).        csv
-0001ab70: 5f73 7472 696e 6720 3d20 6f75 7470 7574  _string = output
-0001ab80: 2e67 6574 7661 6c75 6528 290a 0a20 2020  .getvalue()..   
-0001ab90: 2020 2020 206f 7574 7075 742e 636c 6f73       output.clos
-0001aba0: 6528 290a 0a20 2020 2020 2020 2072 6574  e()..        ret
-0001abb0: 7572 6e20 6373 765f 7374 7269 6e67 0a0a  urn csv_string..
-0001abc0: 2020 2020 6465 6620 5f67 6574 5f6e 6577      def _get_new
-0001abd0: 6573 745f 6669 6c65 5f61 7469 6d65 2873  est_file_atime(s
-0001abe0: 656c 662c 2066 6f6c 6465 725f 7061 7468  elf, folder_path
-0001abf0: 2c20 666f 6c64 6572 5f61 7469 6d65 3d4e  , folder_atime=N
-0001ac00: 6f6e 6529 3a0a 2020 2020 2020 2020 2320  one):.        # 
-0001ac10: 4265 6361 7573 6520 7468 6520 666f 6c64  Because the fold
-0001ac20: 6572 2061 7469 6d65 2069 7320 7265 7365  er atime is rese
-0001ac30: 7420 7768 656e 2063 7261 776c 696e 6720  t when crawling 
-0001ac40: 7765 206e 6565 640a 2020 2020 2020 2020  we need.        
-0001ac50: 2320 746f 206c 6f6f 6b75 7020 7468 6520  # to lookup the 
-0001ac60: 6174 696d 6520 6f66 2074 6865 206c 6173  atime of the las
-0001ac70: 7420 6163 6365 7373 6564 2066 696c 6520  t accessed file 
-0001ac80: 696e 2074 6869 7320 666f 6c64 6572 0a20  in this folder. 
-0001ac90: 2020 2020 2020 2069 6620 6e6f 7420 666f         if not fo
-0001aca0: 6c64 6572 5f70 6174 6820 6f72 206e 6f74  lder_path or not
-0001acb0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001acc0: 666f 6c64 6572 5f70 6174 6829 3a0a 2020  folder_path):.  
-0001acd0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001ace0: 6622 2049 6e76 616c 6964 2066 6f6c 6465  f" Invalid folde
-0001acf0: 7220 7061 7468 3a20 7b66 6f6c 6465 725f  r path: {folder_
-0001ad00: 7061 7468 7d22 290a 2020 2020 2020 2020  path}").        
-0001ad10: 2020 2020 7265 7475 726e 2066 6f6c 6465      return folde
-0001ad20: 725f 6174 696d 650a 2020 2020 2020 2020  r_atime.        
-0001ad30: 6c61 7374 5f61 6363 6573 7365 645f 7469  last_accessed_ti
-0001ad40: 6d65 203d 204e 6f6e 650a 2020 2020 2020  me = None.      
-0001ad50: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001ad60: 2020 2073 7562 6f62 6a65 6374 7320 3d20     subobjects = 
-0001ad70: 6f73 2e6c 6973 7464 6972 2866 6f6c 6465  os.listdir(folde
-0001ad80: 725f 7061 7468 290a 2020 2020 2020 2020  r_path).        
-0001ad90: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001ada0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001adb0: 2020 2070 7269 6e74 2866 2745 7272 6f72     print(f'Error
-0001adc0: 2061 6363 6573 7369 6e67 2066 6f6c 6465   accessing folde
-0001add0: 7220 7b66 6f6c 6465 725f 7061 7468 7d3a  r {folder_path}:
-0001ade0: 5c6e 7b65 7d27 290a 2020 2020 2020 2020  \n{e}').        
-0001adf0: 2020 2020 7265 7475 726e 2066 6f6c 6465      return folde
-0001ae00: 725f 6174 696d 650a 2020 2020 2020 2020  r_atime.        
-0001ae10: 666f 7220 6669 6c65 5f6e 616d 6520 696e  for file_name in
-0001ae20: 2073 7562 6f62 6a65 6374 733a 0a20 2020   subobjects:.   
-0001ae30: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0001ae40: 5f6e 616d 6520 696e 2073 656c 662e 6469  _name in self.di
-0001ae50: 726d 6574 6166 696c 6573 3a0a 2020 2020  rmetafiles:.    
-0001ae60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001ae70: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001ae80: 2066 696c 655f 7061 7468 203d 206f 732e   file_path = os.
-0001ae90: 7061 7468 2e6a 6f69 6e28 666f 6c64 6572  path.join(folder
-0001aea0: 5f70 6174 682c 2066 696c 655f 6e61 6d65  _path, file_name
-0001aeb0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0001aec0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-0001aed0: 6669 6c65 5f70 6174 6829 3a0a 2020 2020  file_path):.    
-0001aee0: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-0001aef0: 7373 6564 5f74 696d 6520 3d20 6f73 2e70  ssed_time = os.p
-0001af00: 6174 682e 6765 7461 7469 6d65 2866 696c  ath.getatime(fil
-0001af10: 655f 7061 7468 290a 2020 2020 2020 2020  e_path).        
-0001af20: 2020 2020 2020 2020 6966 206c 6173 745f          if last_
-0001af30: 6163 6365 7373 6564 5f74 696d 6520 6973  accessed_time is
-0001af40: 204e 6f6e 6520 6f72 2061 6363 6573 7365   None or accesse
-0001af50: 645f 7469 6d65 203e 206c 6173 745f 6163  d_time > last_ac
-0001af60: 6365 7373 6564 5f74 696d 653a 0a20 2020  cessed_time:.   
-0001af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af80: 206c 6173 745f 6163 6365 7373 6564 5f74   last_accessed_t
-0001af90: 696d 6520 3d20 6163 6365 7373 6564 5f74  ime = accessed_t
-0001afa0: 696d 650a 2020 2020 2020 2020 6966 206c  ime.        if l
-0001afb0: 6173 745f 6163 6365 7373 6564 5f74 696d  ast_accessed_tim
-0001afc0: 6520 3d3d 204e 6f6e 653a 0a20 2020 2020  e == None:.     
-0001afd0: 2020 2020 2020 206c 6173 745f 6163 6365         last_acce
-0001afe0: 7373 6564 5f74 696d 6520 3d20 666f 6c64  ssed_time = fold
-0001aff0: 6572 5f61 7469 6d65 0a20 2020 2020 2020  er_atime.       
-0001b000: 2072 6574 7572 6e20 6c61 7374 5f61 6363   return last_acc
-0001b010: 6573 7365 645f 7469 6d65 0a0a 2020 2020  essed_time..    
-0001b020: 6465 6620 5f67 6574 5f6e 6577 6573 745f  def _get_newest_
-0001b030: 6669 6c65 5f6d 7469 6d65 2873 656c 662c  file_mtime(self,
-0001b040: 2066 6f6c 6465 725f 7061 7468 2c20 666f   folder_path, fo
-0001b050: 6c64 6572 5f6d 7469 6d65 3d4e 6f6e 6529  lder_mtime=None)
-0001b060: 3a0a 2020 2020 2020 2020 2320 4265 6361  :.        # Beca
-0001b070: 7573 6520 7468 6520 666f 6c64 6572 2061  use the folder a
-0001b080: 7469 6d65 2069 7320 7265 7365 7420 7768  time is reset wh
-0001b090: 656e 2063 7261 776c 696e 6720 7765 206e  en crawling we n
-0001b0a0: 6565 640a 2020 2020 2020 2020 2320 746f  eed.        # to
-0001b0b0: 206c 6f6f 6b75 7020 7468 6520 6174 696d   lookup the atim
-0001b0c0: 6520 6f66 2074 6865 206c 6173 7420 6d6f  e of the last mo
-0001b0d0: 6469 6669 6564 2066 696c 6520 696e 2074  dified file in t
-0001b0e0: 6869 7320 666f 6c64 6572 0a20 2020 2020  his folder.     
-0001b0f0: 2020 2069 6620 6e6f 7420 666f 6c64 6572     if not folder
-0001b100: 5f70 6174 6820 6f72 206e 6f74 206f 732e  _path or not os.
-0001b110: 7061 7468 2e65 7869 7374 7328 666f 6c64  path.exists(fold
-0001b120: 6572 5f70 6174 6829 3a0a 2020 2020 2020  er_path):.      
-0001b130: 2020 2020 2020 7072 696e 7428 6622 2049        print(f" I
-0001b140: 6e76 616c 6964 2066 6f6c 6465 7220 7061  nvalid folder pa
-0001b150: 7468 3a20 7b66 6f6c 6465 725f 7061 7468  th: {folder_path
-0001b160: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001b170: 7265 7475 726e 2066 6f6c 6465 725f 6d74  return folder_mt
-0001b180: 696d 650a 0a20 2020 2020 2020 206c 6173  ime..        las
-0001b190: 745f 6d6f 6469 6669 6564 5f74 696d 6520  t_modified_time 
-0001b1a0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-0001b1b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001b1c0: 7375 626f 626a 6563 7473 203d 206f 732e  subobjects = os.
-0001b1d0: 6c69 7374 6469 7228 666f 6c64 6572 5f70  listdir(folder_p
-0001b1e0: 6174 6829 0a20 2020 2020 2020 2065 7863  ath).        exc
-0001b1f0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0001b200: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001b210: 7072 696e 7428 6627 4572 726f 7220 6163  print(f'Error ac
-0001b220: 6365 7373 696e 6720 666f 6c64 6572 207b  cessing folder {
-0001b230: 666f 6c64 6572 5f70 6174 687d 3a5c 6e7b  folder_path}:\n{
-0001b240: 657d 2729 0a20 2020 2020 2020 2020 2020  e}').           
-0001b250: 2072 6574 7572 6e20 666f 6c64 6572 5f6d   return folder_m
-0001b260: 7469 6d65 0a20 2020 2020 2020 2066 6f72  time.        for
-0001b270: 2066 696c 655f 6e61 6d65 2069 6e20 7375   file_name in su
-0001b280: 626f 626a 6563 7473 3a0a 2020 2020 2020  bobjects:.      
-0001b290: 2020 2020 2020 6966 2066 696c 655f 6e61        if file_na
-0001b2a0: 6d65 2069 6e20 7365 6c66 2e64 6972 6d65  me in self.dirme
-0001b2b0: 7461 6669 6c65 733a 0a20 2020 2020 2020  tafiles:.       
-0001b2c0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001b2d0: 650a 2020 2020 2020 2020 2020 2020 6669  e.            fi
-0001b2e0: 6c65 5f70 6174 6820 3d20 6f73 2e70 6174  le_path = os.pat
-0001b2f0: 682e 6a6f 696e 2866 6f6c 6465 725f 7061  h.join(folder_pa
-0001b300: 7468 2c20 6669 6c65 5f6e 616d 6529 0a20  th, file_name). 
-0001b310: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-0001b320: 2e70 6174 682e 6973 6669 6c65 2866 696c  .path.isfile(fil
-0001b330: 655f 7061 7468 293a 0a20 2020 2020 2020  e_path):.       
-0001b340: 2020 2020 2020 2020 206d 6f64 6966 6965           modifie
-0001b350: 645f 7469 6d65 203d 206f 732e 7061 7468  d_time = os.path
-0001b360: 2e67 6574 6d74 696d 6528 6669 6c65 5f70  .getmtime(file_p
-0001b370: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-0001b380: 2020 2020 2069 6620 6c61 7374 5f6d 6f64       if last_mod
-0001b390: 6966 6965 645f 7469 6d65 2069 7320 4e6f  ified_time is No
-0001b3a0: 6e65 206f 7220 6d6f 6469 6669 6564 5f74  ne or modified_t
-0001b3b0: 696d 6520 3e20 6c61 7374 5f6d 6f64 6966  ime > last_modif
-0001b3c0: 6965 645f 7469 6d65 3a0a 2020 2020 2020  ied_time:.      
-0001b3d0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001b3e0: 7374 5f6d 6f64 6966 6965 645f 7469 6d65  st_modified_time
-0001b3f0: 203d 206d 6f64 6966 6965 645f 7469 6d65   = modified_time
-0001b400: 0a20 2020 2020 2020 2069 6620 6c61 7374  .        if last
-0001b410: 5f6d 6f64 6966 6965 645f 7469 6d65 203d  _modified_time =
-0001b420: 3d20 4e6f 6e65 3a0a 2020 2020 2020 2020  = None:.        
-0001b430: 2020 2020 6c61 7374 5f6d 6f64 6966 6965      last_modifie
-0001b440: 645f 7469 6d65 203d 2066 6f6c 6465 725f  d_time = folder_
-0001b450: 6d74 696d 650a 2020 2020 2020 2020 7265  mtime.        re
-0001b460: 7475 726e 206c 6173 745f 6d6f 6469 6669  turn last_modifi
-0001b470: 6564 5f74 696d 650a 0a20 2020 2064 6566  ed_time..    def
-0001b480: 2067 6574 5f68 6f74 7370 6f74 735f 7061   get_hotspots_pa
-0001b490: 7468 2873 656c 662c 2066 6f6c 6465 7229  th(self, folder)
-0001b4a0: 3a0a 2020 2020 2020 2020 2727 2720 4765  :.        ''' Ge
-0001b4b0: 7420 6120 6675 6c6c 2070 6174 6820 6e61  t a full path na
-0001b4c0: 6d65 206f 6620 6120 6e65 7720 686f 7473  me of a new hots
-0001b4d0: 706f 7473 2066 696c 6527 2727 0a0a 2020  pots file'''..  
-0001b4e0: 2020 2020 2020 2320 5461 6b65 2074 6865        # Take the
-0001b4f0: 2063 6f72 7265 6374 2068 6f74 7370 6f74   correct hotspot
-0001b500: 7320 6469 7265 6374 6f72 790a 2020 2020  s directory.    
-0001b510: 2020 2020 686f 7473 706f 7464 6972 203d      hotspotdir =
-0001b520: 2073 656c 662e 6366 672e 7368 6172 6564   self.cfg.shared
-0001b530: 5f68 6f74 7370 6f74 735f 6469 7220 6966  _hotspots_dir if
-0001b540: 2073 656c 662e 6366 672e 6973 5f73 6861   self.cfg.is_sha
-0001b550: 7265 6420 656c 7365 2073 656c 662e 6366  red else self.cf
-0001b560: 672e 686f 7473 706f 7473 5f64 6972 0a0a  g.hotspots_dir..
-0001b570: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-0001b580: 2068 6f74 7370 6f74 7320 6469 7265 6374   hotspots direct
-0001b590: 6f72 7920 6966 2069 7420 646f 6573 206e  ory if it does n
-0001b5a0: 6f74 2065 7869 7374 0a20 2020 2020 2020  ot exist.       
-0001b5b0: 206f 732e 6d61 6b65 6469 7273 2868 6f74   os.makedirs(hot
-0001b5c0: 7370 6f74 6469 722c 2065 7869 7374 5f6f  spotdir, exist_o
-0001b5d0: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
-0001b5e0: 3735 290a 0a20 2020 2020 2020 2023 2047  75)..        # G
-0001b5f0: 6574 2074 6865 2066 756c 6c20 7061 7468  et the full path
-0001b600: 206e 616d 6520 6f66 2074 6865 206e 6577   name of the new
-0001b610: 2068 6f74 7370 6f74 7320 6669 6c65 0a20   hotspots file. 
-0001b620: 2020 2020 2020 2072 6574 7572 6e20 6f73         return os
-0001b630: 2e70 6174 682e 6a6f 696e 2868 6f74 7370  .path.join(hotsp
-0001b640: 6f74 6469 722c 2073 656c 662e 5f67 6574  otdir, self._get
-0001b650: 5f68 6f74 7370 6f74 735f 6669 6c65 2866  _hotspots_file(f
-0001b660: 6f6c 6465 7229 290a 0a20 2020 2064 6566  older))..    def
-0001b670: 205f 6765 745f 686f 7473 706f 7473 5f66   _get_hotspots_f
-0001b680: 696c 6528 7365 6c66 2c20 666f 6c64 6572  ile(self, folder
-0001b690: 293a 0a20 2020 2020 2020 2023 2067 6574  ):.        # get
-0001b6a0: 2061 2066 756c 6c20 7061 7468 206e 616d   a full path nam
-0001b6b0: 6520 6f66 2061 206e 6577 2068 6f74 7370  e of a new hotsp
-0001b6c0: 6f74 7320 6669 6c65 0a20 2020 2020 2020  ots file.       
-0001b6d0: 2023 2062 6173 6564 206f 6e20 6120 666f   # based on a fo
-0001b6e0: 6c64 6572 206e 616d 6520 7468 6174 2068  lder name that h
-0001b6f0: 6173 2062 6565 6e20 6372 6177 6c65 640a  as been crawled.
-0001b700: 2020 2020 2020 2020 6d6f 756e 746c 6973          mountlis
-0001b710: 7420 3d20 7365 6c66 2e5f 6765 745f 6d6f  t = self._get_mo
-0001b720: 756e 745f 696e 666f 2829 0a20 2020 2020  unt_info().     
-0001b730: 2020 2074 7261 696c 6469 7220 3d20 2727     traildir = ''
-0001b740: 0a20 2020 2020 2020 2068 7366 696c 6520  .        hsfile 
-0001b750: 3d20 666f 6c64 6572 2e72 6570 6c61 6365  = folder.replace
-0001b760: 2827 2f27 2c20 272b 2729 202b 2027 2e63  ('/', '+') + '.c
-0001b770: 7376 270a 2020 2020 2020 2020 666f 7220  sv'.        for 
-0001b780: 6d6e 7420 696e 206d 6f75 6e74 6c69 7374  mnt in mountlist
-0001b790: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001b7a0: 2066 6f6c 6465 722e 7374 6172 7473 7769   folder.startswi
-0001b7b0: 7468 286d 6e74 5b27 6d6f 756e 745f 706f  th(mnt['mount_po
-0001b7c0: 696e 7427 5d29 3a0a 2020 2020 2020 2020  int']):.        
-0001b7d0: 2020 2020 2020 2020 7472 6169 6c64 6972          traildir
-0001b7e0: 203d 2073 656c 662e 5f67 6574 5f6c 6173   = self._get_las
-0001b7f0: 745f 6469 7265 6374 6f72 7928 6d6e 745b  t_directory(mnt[
-0001b800: 276d 6f75 6e74 5f70 6f69 6e74 275d 290a  'mount_point']).
-0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b820: 6873 6669 6c65 203d 2066 6f6c 6465 722e  hsfile = folder.
-0001b830: 7265 706c 6163 6528 6d6e 745b 276d 6f75  replace(mnt['mou
-0001b840: 6e74 5f70 6f69 6e74 275d 2c20 2727 290a  nt_point'], '').
-0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b860: 6873 6669 6c65 203d 2066 2740 7b74 7261  hsfile = f'@{tra
-0001b870: 696c 6469 727d 2b7b 6873 6669 6c65 7d27  ildir}+{hsfile}'
-0001b880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b890: 2069 6620 6c65 6e28 6873 6669 6c65 2920   if len(hsfile) 
-0001b8a0: 3e20 3235 353a 0a20 2020 2020 2020 2020  > 255:.         
-0001b8b0: 2020 2020 2020 2020 2020 2068 7366 696c             hsfil
-0001b8c0: 6520 3d20 6627 7b68 7366 696c 655b 3a32  e = f'{hsfile[:2
-0001b8d0: 355d 7d2e 2e2e 2e2e 7b68 7366 696c 655b  5]}.....{hsfile[
-0001b8e0: 2d32 3235 3a5d 7d27 0a20 2020 2020 2020  -225:]}'.       
-0001b8f0: 2072 6574 7572 6e20 6873 6669 6c65 0a0a   return hsfile..
-0001b900: 2020 2020 6465 6620 5f77 616c 6b65 7228      def _walker(
-0001b910: 7365 6c66 2c20 746f 702c 2073 6b69 7064  self, top, skipd
-0001b920: 6972 733d 5b27 2e73 6e61 7073 686f 7427  irs=['.snapshot'
-0001b930: 2c5d 293a 0a20 2020 2020 2020 2022 2222  ,]):.        """
-0001b940: 2072 6574 7572 6e73 2073 7562 7365 7420   returns subset 
-0001b950: 6f66 206f 732e 7761 6c6b 2020 2222 220a  of os.walk  """.
-0001b960: 2020 2020 2020 2020 666f 7220 726f 6f74          for root
-0001b970: 2c20 6469 7273 2c20 6669 6c65 7320 696e  , dirs, files in
-0001b980: 206f 732e 7761 6c6b 2874 6f70 2c20 746f   os.walk(top, to
-0001b990: 7064 6f77 6e3d 5472 7565 2c20 6f6e 6572  pdown=True, oner
-0001b9a0: 726f 723d 7365 6c66 2e5f 7761 6c6b 6572  ror=self._walker
-0001b9b0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001b9c0: 666f 7220 736b 6970 6469 7220 696e 2073  for skipdir in s
-0001b9d0: 6b69 7064 6972 733a 0a20 2020 2020 2020  kipdirs:.       
-0001b9e0: 2020 2020 2020 2020 2069 6620 736b 6970           if skip
-0001b9f0: 6469 7220 696e 2064 6972 733a 0a20 2020  dir in dirs:.   
-0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba10: 2064 6972 732e 7265 6d6f 7665 2873 6b69   dirs.remove(ski
-0001ba20: 7064 6972 2920 2023 2064 6f6e 2774 2076  pdir)  # don't v
-0001ba30: 6973 6974 2074 6869 7320 6469 7265 6374  isit this direct
-0001ba40: 6f72 790a 2020 2020 2020 2020 2020 2020  ory.            
-0001ba50: 7969 656c 6420 726f 6f74 2c20 6469 7273  yield root, dirs
-0001ba60: 2c20 6669 6c65 730a 0a20 2020 2064 6566  , files..    def
-0001ba70: 205f 7761 6c6b 6572 7228 7365 6c66 2c20   _walkerr(self, 
-0001ba80: 6f73 6572 7229 3a0a 2020 2020 2020 2020  oserr):.        
-0001ba90: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
-0001baa0: 2873 7472 286f 7365 7272 2929 0a20 2020  (str(oserr)).   
-0001bab0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-0001bac0: 7772 6974 6528 275c 6e27 290a 0a20 2020  write('\n')..   
-0001bad0: 2064 6566 205f 6765 745f 6c61 7374 5f64   def _get_last_d
-0001bae0: 6972 6563 746f 7279 2873 656c 662c 2070  irectory(self, p
-0001baf0: 6174 6829 3a0a 0a20 2020 2020 2020 2023  ath):..        #
-0001bb00: 2052 656d 6f76 6520 616e 7920 7472 6169   Remove any trai
-0001bb10: 6c69 6e67 2073 6c61 7368 6573 0a20 2020  ling slashes.   
-0001bb20: 2020 2020 2070 6174 6820 3d20 7061 7468       path = path
-0001bb30: 2e72 7374 7269 7028 6f73 2e70 6174 682e  .rstrip(os.path.
-0001bb40: 7365 7029 0a0a 2020 2020 2020 2020 2320  sep)..        # 
-0001bb50: 5370 6c69 7420 7468 6520 7061 7468 2062  Split the path b
-0001bb60: 7920 7468 6520 7365 7061 7261 746f 720a  y the separator.
-0001bb70: 2020 2020 2020 2020 7061 7468 5f70 6172          path_par
-0001bb80: 7473 203d 2070 6174 682e 7370 6c69 7428  ts = path.split(
-0001bb90: 6f73 2e70 6174 682e 7365 7029 0a0a 2020  os.path.sep)..  
-0001bba0: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
-0001bbb0: 6865 206c 6173 7420 6469 7265 6374 6f72  he last director
-0001bbc0: 790a 2020 2020 2020 2020 7265 7475 726e  y.        return
-0001bbd0: 2070 6174 685f 7061 7274 735b 2d31 5d0a   path_parts[-1].
-0001bbe0: 0a20 2020 2064 6566 205f 6765 745f 6d6f  .    def _get_mo
-0001bbf0: 756e 745f 696e 666f 2873 656c 6629 3a0a  unt_info(self):.
-0001bc00: 2020 2020 2020 2020 6669 6c65 5f70 6174          file_pat
-0001bc10: 6820 3d20 272f 7072 6f63 2f73 656c 662f  h = '/proc/self/
-0001bc20: 6d6f 756e 7469 6e66 6f27 0a0a 2020 2020  mountinfo'..    
-0001bc30: 2020 2020 6673 5f74 7970 6573 203d 207b      fs_types = {
-0001bc40: 276e 6673 272c 2027 6e66 7334 272c 2027  'nfs', 'nfs4', '
-0001bc50: 6369 6673 272c 2027 736d 6227 2c20 2761  cifs', 'smb', 'a
-0001bc60: 6673 272c 2027 6e63 7027 2c0a 2020 2020  fs', 'ncp',.    
-0001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc80: 276e 6370 6673 272c 2027 676c 7573 7465  'ncpfs', 'gluste
-0001bc90: 7266 7327 2c20 2763 6570 6827 2c20 2762  rfs', 'ceph', 'b
-0001bca0: 6565 6766 7327 2c0a 2020 2020 2020 2020  eegfs',.        
-0001bcb0: 2020 2020 2020 2020 2020 2020 276c 7573              'lus
-0001bcc0: 7472 6527 2c20 276f 7261 6e67 6566 7327  tre', 'orangefs'
-0001bcd0: 2c20 2777 656b 6166 7327 2c20 2767 7066  , 'wekafs', 'gpf
-0001bce0: 7327 7d0a 0a20 2020 2020 2020 206d 6f75  s'}..        mou
-0001bcf0: 6e74 696e 666f 5f6c 6973 7420 3d20 5b5d  ntinfo_list = []
-0001bd00: 0a0a 2020 2020 2020 2020 7769 7468 206f  ..        with o
-0001bd10: 7065 6e28 6669 6c65 5f70 6174 682c 2027  pen(file_path, '
-0001bd20: 7227 2920 6173 2066 3a0a 2020 2020 2020  r') as f:.      
-0001bd30: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-0001bd40: 6e20 663a 0a20 2020 2020 2020 2020 2020  n f:.           
-0001bd50: 2020 2020 2066 6965 6c64 7320 3d20 6c69       fields = li
-0001bd60: 6e65 2e73 7472 6970 2829 2e73 706c 6974  ne.strip().split
-0001bd70: 2827 2027 290a 2020 2020 2020 2020 2020  (' ').          
-0001bd80: 2020 2020 2020 5f2c 205f 2c20 5f2c 205f        _, _, _, _
-0001bd90: 2c20 6d6f 756e 745f 706f 696e 742c 205f  , mount_point, _
-0001bda0: 203d 2066 6965 6c64 735b 3a36 5d0a 2020   = fields[:6].  
-0001bdb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001bdc0: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
-0001bdd0: 735b 363a 5d3a 0a20 2020 2020 2020 2020  s[6:]:.         
-0001bde0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0001bdf0: 656c 6420 3d3d 2027 2d27 3a0a 2020 2020  eld == '-':.    
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0001be20: 2020 2020 2020 2020 2020 6673 5f74 7970            fs_typ
-0001be30: 652c 206d 6f75 6e74 5f73 6f75 7263 652c  e, mount_source,
-0001be40: 205f 203d 2066 6965 6c64 735b 2d33 3a5d   _ = fields[-3:]
-0001be50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be60: 206d 6f75 6e74 5f73 6f75 7263 655f 666f   mount_source_fo
-0001be70: 6c64 6572 203d 206d 6f75 6e74 5f73 6f75  lder = mount_sou
-0001be80: 7263 652e 7370 6c69 7428 0a20 2020 2020  rce.split(.     
-0001be90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001bea0: 3a27 295b 2d31 5d20 6966 2027 3a27 2069  :')[-1] if ':' i
-0001beb0: 6e20 6d6f 756e 745f 736f 7572 6365 2065  n mount_source e
-0001bec0: 6c73 6520 2727 0a20 2020 2020 2020 2020  lse ''.         
-0001bed0: 2020 2020 2020 2069 6620 6673 5f74 7970         if fs_typ
-0001bee0: 6520 696e 2066 735f 7479 7065 733a 0a20  e in fs_types:. 
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf00: 2020 206d 6f75 6e74 696e 666f 5f6c 6973     mountinfo_lis
-0001bf10: 742e 6170 7065 6e64 287b 0a20 2020 2020  t.append({.     
-0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf30: 2020 2027 6d6f 756e 745f 736f 7572 6365     'mount_source
-0001bf40: 5f66 6f6c 6465 7227 3a20 6d6f 756e 745f  _folder': mount_
-0001bf50: 736f 7572 6365 5f66 6f6c 6465 722c 0a20  source_folder,. 
-0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf70: 2020 2020 2020 2027 6d6f 756e 745f 706f         'mount_po
-0001bf80: 696e 7427 3a20 6d6f 756e 745f 706f 696e  int': mount_poin
-0001bf90: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0001bfa0: 2020 2020 2020 2020 2020 2027 6673 5f74             'fs_t
-0001bfb0: 7970 6527 3a20 6673 5f74 7970 652c 0a20  ype': fs_type,. 
-0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfd0: 2020 2020 2020 2027 6d6f 756e 745f 736f         'mount_so
-0001bfe0: 7572 6365 273a 206d 6f75 6e74 5f73 6f75  urce': mount_sou
-0001bff0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
-0001c000: 2020 2020 2020 2020 207d 290a 2020 2020           }).    
-0001c010: 2020 2020 7265 7475 726e 206d 6f75 6e74      return mount
-0001c020: 696e 666f 5f6c 6973 740a 0a20 2020 2064  info_list..    d
-0001c030: 6566 2064 6f77 6e6c 6f61 645f 7265 7374  ef download_rest
-0001c040: 6f72 6564 5f66 696c 6528 7365 6c66 2c20  ored_file(self, 
-0001c050: 6275 636b 6574 5f6e 616d 652c 206f 626a  bucket_name, obj
-0001c060: 6563 745f 6b65 792c 206c 6f63 616c 5f70  ect_key, local_p
-0001c070: 6174 6829 3a0a 2020 2020 2020 2020 7333  ath):.        s3
-0001c080: 203d 2062 6f74 6f33 2e72 6573 6f75 7263   = boto3.resourc
-0001c090: 6528 2773 3327 290a 2020 2020 2020 2020  e('s3').        
-0001c0a0: 7333 2e42 7563 6b65 7428 6275 636b 6574  s3.Bucket(bucket
-0001c0b0: 5f6e 616d 6529 2e64 6f77 6e6c 6f61 645f  _name).download_
-0001c0c0: 6669 6c65 286f 626a 6563 745f 6b65 792c  file(object_key,
-0001c0d0: 206c 6f63 616c 5f70 6174 6829 0a20 2020   local_path).   
-0001c0e0: 2020 2020 2070 7269 6e74 2866 2744 6f77       print(f'Dow
-0001c0f0: 6e6c 6f61 6465 6420 7b6f 626a 6563 745f  nloaded {object_
-0001c100: 6b65 797d 2074 6f20 7b6c 6f63 616c 5f70  key} to {local_p
-0001c110: 6174 687d 2e27 290a 0a20 2020 2064 6566  ath}.')..    def
-0001c120: 205f 7570 6c6f 6164 5f66 696c 655f 746f   _upload_file_to
-0001c130: 5f73 3328 7365 6c66 2c20 6669 6c65 6e61  _s3(self, filena
-0001c140: 6d65 2c20 6275 636b 6574 2c20 6f62 6a65  me, bucket, obje
-0001c150: 6374 5f6e 616d 653d 4e6f 6e65 2c20 7072  ct_name=None, pr
-0001c160: 6f66 696c 653d 4e6f 6e65 293a 0a20 2020  ofile=None):.   
-0001c170: 2020 2020 2073 6573 7369 6f6e 203d 2062       session = b
-0001c180: 6f74 6f33 2e53 6573 7369 6f6e 280a 2020  oto3.Session(.  
-0001c190: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-0001c1a0: 655f 6e61 6d65 3d70 726f 6669 6c65 2920  e_name=profile) 
-0001c1b0: 6966 2070 726f 6669 6c65 2065 6c73 6520  if profile else 
-0001c1c0: 626f 746f 332e 5365 7373 696f 6e28 290a  boto3.Session().
-0001c1d0: 2020 2020 2020 2020 7333 203d 2073 6573          s3 = ses
-0001c1e0: 7369 6f6e 2e63 6c69 656e 7428 2773 3327  sion.client('s3'
-0001c1f0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
-0001c200: 5333 206f 626a 6563 745f 6e61 6d65 2077  S3 object_name w
-0001c210: 6173 206e 6f74 2073 7065 6369 6669 6564  as not specified
-0001c220: 2c20 7573 6520 7468 6520 6669 6c65 6e61  , use the filena
-0001c230: 6d65 0a20 2020 2020 2020 2069 6620 6f62  me.        if ob
-0001c240: 6a65 6374 5f6e 616d 6520 6973 204e 6f6e  ject_name is Non
-0001c250: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-0001c260: 626a 6563 745f 6e61 6d65 203d 206f 732e  bject_name = os.
-0001c270: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
-0001c280: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0001c290: 7472 793a 0a0a 2020 2020 2020 2020 2020  try:..          
-0001c2a0: 2020 2320 5570 6c6f 6164 2074 6865 2066    # Upload the f
-0001c2b0: 696c 6520 7769 7468 2049 6e74 656c 6c69  ile with Intelli
-0001c2c0: 6765 6e74 2d54 6965 7269 6e67 2073 746f  gent-Tiering sto
-0001c2d0: 7261 6765 2063 6c61 7373 0a20 2020 2020  rage class.     
-0001c2e0: 2020 2020 2020 2073 332e 7570 6c6f 6164         s3.upload
-0001c2f0: 5f66 696c 6528 6669 6c65 6e61 6d65 2c20  _file(filename, 
-0001c300: 6275 636b 6574 2c20 6f62 6a65 6374 5f6e  bucket, object_n
-0001c310: 616d 652c 2045 7874 7261 4172 6773 3d7b  ame, ExtraArgs={
-0001c320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c330: 2020 2020 2020 2020 2020 2020 2753 746f              'Sto
-0001c340: 7261 6765 436c 6173 7327 3a20 2749 4e54  rageClass': 'INT
-0001c350: 454c 4c49 4745 4e54 5f54 4945 5249 4e47  ELLIGENT_TIERING
-0001c360: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
-0001c370: 7072 696e 7464 6267 280a 2020 2020 2020  printdbg(.      
-0001c380: 2020 2020 2020 2020 2020 6622 4669 6c65            f"File
-0001c390: 207b 6f62 6a65 6374 5f6e 616d 657d 2075   {object_name} u
-0001c3a0: 706c 6f61 6465 6420 746f 2049 6e74 656c  ploaded to Intel
-0001c3b0: 6c69 6765 6e74 2d54 6965 7269 6e67 2073  ligent-Tiering s
-0001c3c0: 746f 7261 6765 2063 6c61 7373 2122 290a  torage class!").
-0001c3d0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0001c3e0: 696e 7428 6622 4669 6c65 207b 6669 6c65  int(f"File {file
-0001c3f0: 6e61 6d65 7d20 7570 6c6f 6164 6564 2073  name} uploaded s
-0001c400: 7563 6365 7373 6675 6c6c 7920 746f 2049  uccessfully to I
-0001c410: 6e74 656c 6c69 6765 6e74 2d54 6965 7269  ntelligent-Tieri
-0001c420: 6e67 2073 746f 7261 6765 2063 6c61 7373  ng storage class
-0001c430: 2122 290a 2020 2020 2020 2020 6578 6365  !").        exce
-0001c440: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0001c450: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0001c460: 7269 6e74 2866 2241 6e20 6572 726f 7220  rint(f"An error 
-0001c470: 6f63 6375 7272 6564 3a20 7b65 7d22 290a  occurred: {e}").
-0001c480: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001c490: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001c4a0: 2072 6574 7572 6e20 5472 7565 0a0a 0a63   return True...c
-0001c4b0: 6c61 7373 2041 5753 426f 746f 3a0a 2020  lass AWSBoto:.  
-0001c4c0: 2020 2727 2741 5753 2068 616e 646c 6572    '''AWS handler
-0001c4d0: 2063 6c61 7373 2e20 5468 6973 2063 6c61   class. This cla
-0001c4e0: 7373 2069 7320 7573 6564 2074 6f20 696e  ss is used to in
-0001c4f0: 7465 7261 6374 2077 6974 6820 4157 5320  teract with AWS 
-0001c500: 7365 7276 6963 6573 2e27 2727 0a0a 2020  services.'''..  
-0001c510: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0001c520: 656c 662c 2061 7267 732c 2063 6667 3a20  elf, args, cfg: 
-0001c530: 436f 6e66 6967 4d61 6e61 6765 722c 2061  ConfigManager, a
-0001c540: 7263 683a 2041 7263 6869 7665 7229 3a0a  rch: Archiver):.
-0001c550: 2020 2020 2020 2020 7365 6c66 2e61 7267          self.arg
-0001c560: 7320 3d20 6172 6773 0a20 2020 2020 2020  s = args.       
-0001c570: 2073 656c 662e 6366 6720 3d20 6366 670a   self.cfg = cfg.
-0001c580: 2020 2020 2020 2020 7365 6c66 2e61 7263          self.arc
-0001c590: 6820 3d20 6172 6368 0a0a 2020 2020 2020  h = arch..      
-0001c5a0: 2020 7365 6c66 2e76 616c 6964 5f73 6573    self.valid_ses
-0001c5b0: 7369 6f6e 203d 2046 616c 7365 0a0a 2020  sion = False..  
-0001c5c0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-0001c5d0: 2863 6667 2c20 2761 7773 5f70 726f 6669  (cfg, 'aws_profi
-0001c5e0: 6c65 2729 3a0a 2020 2020 2020 2020 2020  le'):.          
-0001c5f0: 2020 6966 2073 656c 662e 6368 6563 6b5f    if self.check_
-0001c600: 6372 6564 656e 7469 616c 7328 6177 735f  credentials(aws_
-0001c610: 7072 6f66 696c 653d 6366 672e 6177 735f  profile=cfg.aws_
-0001c620: 7072 6f66 696c 6529 3a0a 2020 2020 2020  profile):.      
-0001c630: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0001c640: 6574 5f73 6573 7369 6f6e 2870 726f 6669  et_session(profi
-0001c650: 6c65 5f6e 616d 653d 6366 672e 6177 735f  le_name=cfg.aws_
-0001c660: 7072 6f66 696c 652c 0a20 2020 2020 2020  profile,.       
-0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c680: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-0001c690: 3d63 6667 2e61 7773 5f72 6567 696f 6e29  =cfg.aws_region)
-0001c6a0: 0a0a 2020 2020 6465 6620 6368 6563 6b5f  ..    def check_
-0001c6b0: 6275 636b 6574 5f61 6363 6573 7328 7365  bucket_access(se
-0001c6c0: 6c66 2c20 6275 636b 6574 5f6e 616d 652c  lf, bucket_name,
-0001c6d0: 2072 6561 6477 7269 7465 3d46 616c 7365   readwrite=False
-0001c6e0: 293a 0a20 2020 2020 2020 2027 2727 4368  ):.        '''Ch
-0001c6f0: 6563 6b20 6966 2074 6865 2075 7365 7220  eck if the user 
-0001c700: 6861 7320 6163 6365 7373 2074 6f20 7468  has access to th
-0001c710: 6520 6769 7665 6e20 6275 636b 6574 2727  e given bucket''
-0001c720: 270a 0a20 2020 2020 2020 2069 6620 6e6f  '..        if no
-0001c730: 7420 6275 636b 6574 5f6e 616d 653a 0a20  t bucket_name:. 
-0001c740: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001c750: 2056 616c 7565 4572 726f 7228 274e 6f20   ValueError('No 
-0001c760: 6275 636b 6574 206e 616d 6520 7072 6f76  bucket name prov
-0001c770: 6964 6564 2729 0a0a 2020 2020 2020 2020  ided')..        
-0001c780: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001c790: 2023 2047 6574 2074 6865 2062 7563 6b65   # Get the bucke
-0001c7a0: 7420 4163 6365 7373 2043 6f6e 7472 6f6c  t Access Control
-0001c7b0: 204c 6973 7420 2841 434c 290a 2020 2020   List (ACL).    
-0001c7c0: 2020 2020 2020 2020 6275 636b 6574 5f69          bucket_i
-0001c7d0: 6e66 6f20 3d20 7365 6c66 2e73 335f 636c  nfo = self.s3_cl
-0001c7e0: 6965 6e74 2e67 6574 5f62 7563 6b65 745f  ient.get_bucket_
-0001c7f0: 6163 6c28 4275 636b 6574 3d62 7563 6b65  acl(Bucket=bucke
-0001c800: 745f 6e61 6d65 290a 0a20 2020 2020 2020  t_name)..       
-0001c810: 2020 2020 2023 2041 6363 6573 7320 7468       # Access th
-0001c820: 6520 2750 6572 6d69 7373 696f 6e27 206b  e 'Permission' k
-0001c830: 6579 0a20 2020 2020 2020 2020 2020 2070  ey.            p
-0001c840: 6572 6d69 7373 696f 6e20 3d20 6275 636b  ermission = buck
-0001c850: 6574 5f69 6e66 6f5b 2747 7261 6e74 7327  et_info['Grants'
-0001c860: 5d5b 305d 5b27 5065 726d 6973 7369 6f6e  ][0]['Permission
-0001c870: 275d 0a0a 2020 2020 2020 2020 2020 2020  ']..            
-0001c880: 6966 2072 6561 6477 7269 7465 3a0a 2020  if readwrite:.  
-0001c890: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001c8a0: 7475 726e 2028 7065 726d 6973 7369 6f6e  turn (permission
-0001c8b0: 203d 3d20 2746 554c 4c5f 434f 4e54 524f   == 'FULL_CONTRO
-0001c8c0: 4c27 290a 2020 2020 2020 2020 2020 2020  L').            
-0001c8d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001c8e0: 2020 2020 2020 7265 7475 726e 2028 7065        return (pe
-0001c8f0: 726d 6973 7369 6f6e 203d 3d20 2752 4541  rmission == 'REA
-0001c900: 4427 290a 0a20 2020 2020 2020 2065 7863  D')..        exc
-0001c910: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0001c920: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001c930: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-0001c940: 2020 2020 2020 2320 6578 6365 7074 2062        # except b
-0001c950: 6f74 6f63 6f72 652e 6578 6365 7074 696f  otocore.exceptio
-0001c960: 6e73 2e43 6c69 656e 7445 7272 6f72 2061  ns.ClientError a
-0001c970: 7320 653a 0a20 2020 2020 2020 2023 2020  s e:.        #  
-0001c980: 2020 2065 7272 6f72 5f63 6f64 6520 3d20     error_code = 
-0001c990: 652e 7265 7370 6f6e 7365 5b27 4572 726f  e.response['Erro
-0001c9a0: 7227 5d5b 2743 6f64 6527 5d0a 2020 2020  r']['Code'].    
-0001c9b0: 2020 2020 2320 2020 2020 6966 2065 7272      #     if err
-0001c9c0: 6f72 5f63 6f64 6520 3d3d 2027 3430 3327  or_code == '403'
-0001c9d0: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-0001c9e0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0001c9f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0001ca00: 2066 2245 7272 6f72 3a20 4163 6365 7373   f"Error: Access
-0001ca10: 2064 656e 6965 6420 746f 2062 7563 6b65   denied to bucke
-0001ca20: 7420 7b62 7563 6b65 745f 6e61 6d65 7d20  t {bucket_name} 
-0001ca30: 666f 7220 7072 6f66 696c 6520 7b73 656c  for profile {sel
-0001ca40: 662e 6177 735f 7072 6f66 696c 657d 2e20  f.aws_profile}. 
-0001ca50: 4368 6563 6b20 796f 7572 2070 6572 6d69  Check your permi
-0001ca60: 7373 696f 6e73 2e22 290a 2020 2020 2020  ssions.").      
-0001ca70: 2020 2320 2020 2020 656c 6966 2065 7272    #     elif err
-0001ca80: 6f72 5f63 6f64 6520 3d3d 2027 3430 3427  or_code == '404'
-0001ca90: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-0001caa0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0001cab0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0001cac0: 2066 2245 7272 6f72 3a20 4275 636b 6574   f"Error: Bucket
-0001cad0: 207b 6275 636b 6574 5f6e 616d 657d 2064   {bucket_name} d
-0001cae0: 6f65 7320 6e6f 7420 6578 6973 7420 696e  oes not exist in
-0001caf0: 2070 726f 6669 6c65 207b 7365 6c66 2e61   profile {self.a
-0001cb00: 7773 5f70 726f 6669 6c65 7d2e 2229 0a20  ws_profile}."). 
-0001cb10: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001cb20: 2070 7269 6e74 2822 7275 6e20 2766 726f   print("run 'fro
-0001cb30: 7374 6572 2063 6f6e 6669 6727 2074 6f20  ster config' to 
-0001cb40: 6372 6561 7465 2074 6869 7320 6275 636b  create this buck
-0001cb50: 6574 2e22 290a 2020 2020 2020 2020 2320  et.").        # 
-0001cb60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001cb70: 2020 2320 2020 2020 2020 2020 7072 696e    #         prin
-0001cb80: 7428 0a20 2020 2020 2020 2023 2020 2020  t(.        #    
-0001cb90: 2020 2020 2020 2020 2066 2245 7272 6f72           f"Error
-0001cba0: 2061 6363 6573 7369 6e67 2062 7563 6b65   accessing bucke
-0001cbb0: 7420 7b62 7563 6b65 745f 6e61 6d65 7d20  t {bucket_name} 
-0001cbc0: 696e 2070 726f 6669 6c65 207b 7365 6c66  in profile {self
-0001cbd0: 2e61 7773 5f70 726f 6669 6c65 7d3a 207b  .aws_profile}: {
-0001cbe0: 657d 2229 0a20 2020 2020 2020 2023 2020  e}").        #  
-0001cbf0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001cc00: 2020 2020 2020 2020 2320 6578 6365 7074          # except
-0001cc10: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0001cc20: 0a20 2020 2020 2020 2023 2020 2020 2070  .        #     p
-0001cc30: 7269 6e74 280a 2020 2020 2020 2020 2320  rint(.        # 
-0001cc40: 2020 2020 2020 2020 6622 416e 2075 6e65          f"An une
-0001cc50: 7870 6563 7465 6420 6572 726f 7220 696e  xpected error in
-0001cc60: 2066 756e 6374 696f 6e20 6368 6563 6b5f   function check_
-0001cc70: 6275 636b 6574 5f61 6363 6573 7320 666f  bucket_access fo
-0001cc80: 7220 7072 6f66 696c 6520 7b73 656c 662e  r profile {self.
-0001cc90: 6177 735f 7072 6f66 696c 657d 3a20 7b65  aws_profile}: {e
-0001cca0: 7d22 290a 2020 2020 2020 2020 2320 2020  }").        #   
-0001ccb0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001ccc0: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
-0001ccd0: 2072 6561 6477 7269 7465 3a0a 2020 2020   readwrite:.    
-0001cce0: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
-0001ccf0: 2054 7275 650a 0a20 2020 2020 2020 2023   True..        #
-0001cd00: 2023 2054 6573 7420 7772 6974 6520 6163   # Test write ac
-0001cd10: 6365 7373 2062 7920 7570 6c6f 6164 696e  cess by uploadin
-0001cd20: 6720 6120 736d 616c 6c20 7465 7374 2066  g a small test f
-0001cd30: 696c 650a 2020 2020 2020 2020 2320 7472  ile.        # tr
-0001cd40: 793a 0a20 2020 2020 2020 2023 2020 2020  y:.        #    
-0001cd50: 2074 6573 745f 6f62 6a65 6374 5f6b 6579   test_object_key
-0001cd60: 203d 2022 7465 7374 5f77 7269 7465 5f61   = "test_write_a
-0001cd70: 6363 6573 732e 7478 7422 0a20 2020 2020  ccess.txt".     
-0001cd80: 2020 2023 2020 2020 2073 332e 7075 745f     #     s3.put_
-0001cd90: 6f62 6a65 6374 2842 7563 6b65 743d 6275  object(Bucket=bu
-0001cda0: 636b 6574 5f6e 616d 652c 204b 6579 3d74  cket_name, Key=t
-0001cdb0: 6573 745f 6f62 6a65 6374 5f6b 6579 2c0a  est_object_key,.
-0001cdc0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001cdd0: 2020 2020 2020 2020 2020 2020 426f 6479              Body
-0001cde0: 3d22 5465 7374 2077 7269 7465 2061 6363  ="Test write acc
-0001cdf0: 6573 7322 290a 2020 2020 2020 2020 2320  ess").        # 
-0001ce00: 2020 2020 2320 7072 696e 7428 6622 5375      # print(f"Su
-0001ce10: 6363 6573 7366 756c 6c79 2077 726f 7465  ccessfully wrote
-0001ce20: 2074 6573 7420 746f 207b 6275 636b 6574   test to {bucket
-0001ce30: 5f6e 616d 657d 2229 0a0a 2020 2020 2020  _name}")..      
-0001ce40: 2020 2320 2020 2020 2320 436c 6561 6e20    #     # Clean 
-0001ce50: 7570 2062 7920 6465 6c65 7469 6e67 2074  up by deleting t
-0001ce60: 6865 2074 6573 7420 6f62 6a65 6374 0a20  he test object. 
-0001ce70: 2020 2020 2020 2023 2020 2020 2073 332e         #     s3.
-0001ce80: 6465 6c65 7465 5f6f 626a 6563 7428 4275  delete_object(Bu
-0001ce90: 636b 6574 3d62 7563 6b65 745f 6e61 6d65  cket=bucket_name
-0001cea0: 2c20 4b65 793d 7465 7374 5f6f 626a 6563  , Key=test_objec
-0001ceb0: 745f 6b65 7929 0a20 2020 2020 2020 2023  t_key).        #
-0001cec0: 2020 2020 2023 2070 7269 6e74 2866 2253       # print(f"S
-0001ced0: 7563 6365 7373 6675 6c6c 7920 6465 6c65  uccessfully dele
-0001cee0: 7465 6420 7465 7374 206f 626a 6563 7420  ted test object 
-0001cef0: 6672 6f6d 207b 6275 636b 6574 5f6e 616d  from {bucket_nam
-0001cf00: 657d 2229 0a20 2020 2020 2020 2023 2020  e}").        #  
-0001cf10: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-0001cf20: 2020 2020 2020 2023 2065 7863 6570 7420         # except 
-0001cf30: 626f 746f 636f 7265 2e65 7863 6570 7469  botocore.excepti
-0001cf40: 6f6e 732e 436c 6965 6e74 4572 726f 7220  ons.ClientError 
-0001cf50: 6173 2065 3a0a 2020 2020 2020 2020 2320  as e:.        # 
-0001cf60: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0001cf70: 2020 2023 2020 2020 2020 2020 2066 2245     #         f"E
-0001cf80: 7272 6f72 3a20 6361 6e6e 6f74 2077 7269  rror: cannot wri
-0001cf90: 7465 2074 6f20 6275 636b 6574 207b 6275  te to bucket {bu
-0001cfa0: 636b 6574 5f6e 616d 657d 2069 6e20 7072  cket_name} in pr
-0001cfb0: 6f66 696c 6520 7b73 656c 662e 6177 735f  ofile {self.aws_
-0001cfc0: 7072 6f66 696c 657d 3a20 7b65 7d22 290a  profile}: {e}").
-0001cfd0: 2020 2020 2020 2020 2320 2020 2020 7265          #     re
-0001cfe0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-0001cff0: 6465 6620 6368 6563 6b5f 6372 6564 656e  def check_creden
-0001d000: 7469 616c 7328 7365 6c66 2c0a 2020 2020  tials(self,.    
-0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d020: 2020 2020 2020 6177 735f 7072 6f66 696c        aws_profil
-0001d030: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d050: 2020 6177 735f 6163 6365 7373 5f6b 6579    aws_access_key
-0001d060: 5f69 643d 4e6f 6e65 2c0a 2020 2020 2020  _id=None,.      
-0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d080: 2020 2020 6177 735f 7365 6372 6574 5f61      aws_secret_a
-0001d090: 6363 6573 735f 6b65 793d 4e6f 6e65 293a  ccess_key=None):
-0001d0a0: 0a20 2020 2020 2020 2027 2727 2041 5753  .        ''' AWS
-0001d0b0: 2063 7265 6465 6e74 6961 6c20 6368 6563   credential chec
-0001d0c0: 6b65 720a 0a20 2020 2020 2020 2043 6865  ker..        Che
-0001d0d0: 636b 2069 6620 7468 6520 7072 6f76 6964  ck if the provid
-0001d0e0: 6564 2041 5753 2063 7265 6465 6e74 6961  ed AWS credentia
-0001d0f0: 6c73 206f 7220 7072 6f76 6964 6520 4157  ls or provide AW
-0001d100: 5320 7072 6f66 696c 6520 6172 6520 7661  S profile are va
-0001d110: 6c69 642e 0a20 2020 2020 2020 2049 6620  lid..        If 
-0001d120: 6e6f 7468 696e 6720 6973 2070 726f 7669  nothing is provi
-0001d130: 6465 642c 2074 6865 2063 7572 7265 6e74  ded, the current
-0001d140: 2073 6573 7369 6f6e 2069 7320 6368 6563   session is chec
-0001d150: 6b65 642e 2727 270a 0a20 2020 2020 2020  ked.'''..       
-0001d160: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001d170: 2020 6966 2061 7773 5f61 6363 6573 735f    if aws_access_
-0001d180: 6b65 795f 6964 2061 6e64 2061 7773 5f73  key_id and aws_s
-0001d190: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
-0001d1a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d1b0: 2020 2320 4275 696c 6420 6120 6e65 7720    # Build a new 
-0001d1c0: 5354 5320 636c 6965 6e74 2077 6974 6820  STS client with 
-0001d1d0: 7468 6520 7072 6f76 6964 6564 2063 7265  the provided cre
-0001d1e0: 6465 6e74 6961 6c73 0a20 2020 2020 2020  dentials.       
-0001d1f0: 2020 2020 2020 2020 2073 7473 203d 2062           sts = b
-0001d200: 6f74 6f33 2e53 6573 7369 6f6e 2861 7773  oto3.Session(aws
-0001d210: 5f61 6363 6573 735f 6b65 795f 6964 3d61  _access_key_id=a
-0001d220: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
-0001d230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 6177 735f 7365 6372 6574        aws_secret
-0001d260: 5f61 6363 6573 735f 6b65 793d 6177 735f  _access_key=aws_
-0001d270: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
-0001d280: 7929 2e63 6c69 656e 7428 2773 7473 2729  y).client('sts')
-0001d290: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0001d2a0: 6966 2061 7773 5f70 726f 6669 6c65 3a0a  if aws_profile:.
-0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2c0: 2320 4275 696c 6420 6120 6e65 7720 5354  # Build a new ST
-0001d2d0: 5320 636c 6965 6e74 2077 6974 6820 7468  S client with th
-0001d2e0: 6520 7072 6f76 6964 6564 2070 726f 6669  e provided profi
-0001d2f0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-0001d300: 2020 2073 7473 203d 2062 6f74 6f33 2e53     sts = boto3.S
-0001d310: 6573 7369 6f6e 2870 726f 6669 6c65 5f6e  ession(profile_n
-0001d320: 616d 653d 6177 735f 7072 6f66 696c 6529  ame=aws_profile)
-0001d330: 2e63 6c69 656e 7428 2773 7473 2729 0a0a  .client('sts')..
-0001d340: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001d350: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
-0001d360: 7333 5f63 6c69 656e 7427 293a 0a20 2020  s3_client'):.   
-0001d370: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-0001d380: 6574 2074 6865 2063 7572 7265 6e74 2073  et the current s
-0001d390: 7473 5f63 6c69 656e 740a 2020 2020 2020  ts_client.      
-0001d3a0: 2020 2020 2020 2020 2020 7374 7320 3d20            sts = 
-0001d3b0: 7365 6c66 2e73 7473 5f63 6c69 656e 740a  self.sts_client.
-0001d3c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0001d3d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001d3e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0001d3f0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001d400: 2020 2020 2020 2020 2022 4e6f 2041 5753           "No AWS
-0001d410: 2063 7265 6465 6e74 6961 6c73 206e 6f72   credentials nor
-0001d420: 2070 726f 6669 6c65 2070 726f 7669 6465   profile provide
-0001d430: 6420 616e 6420 6375 7272 656e 7420 4157  d and current AW
-0001d440: 5320 7365 7373 696f 6e20 6e6f 7420 7365  S session not se
-0001d450: 742e 2229 0a0a 2020 2020 2020 2020 2020  t.")..          
-0001d460: 2020 2320 4368 6563 6b20 7468 6174 2077    # Check that w
-0001d470: 6520 6361 6e20 6765 7420 7468 6520 6361  e can get the ca
-0001d480: 6c6c 6572 2069 6465 6e74 6974 790a 2020  ller identity.  
-0001d490: 2020 2020 2020 2020 2020 7374 732e 6765            sts.ge
-0001d4a0: 745f 6361 6c6c 6572 5f69 6465 6e74 6974  t_caller_identit
-0001d4b0: 7928 290a 0a20 2020 2020 2020 2020 2020  y()..           
-0001d4c0: 2023 2043 7265 6465 6e74 6961 6c73 2061   # Credentials a
-0001d4d0: 7265 2076 616c 6964 0a20 2020 2020 2020  re valid.       
-0001d4e0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001d4f0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0001d500: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0001d510: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-0001d520: 7265 6465 6e74 6961 6c73 2061 7265 206e  redentials are n
-0001d530: 6f74 2076 616c 6964 0a20 2020 2020 2020  ot valid.       
-0001d540: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0001d550: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
-0001d560: 4f3a 2072 6577 6f72 6b20 6572 726f 7220  O: rework error 
-0001d570: 6368 6563 6b73 0a0a 2020 2020 2020 2020  checks..        
-0001d580: 2320 6578 6365 7074 2062 6f74 6f33 2e65  # except boto3.e
-0001d590: 7863 6570 7469 6f6e 732e 436c 6965 6e74  xceptions.Client
-0001d5a0: 4572 726f 723a 0a20 2020 2020 2020 2023  Error:.        #
-0001d5b0: 2020 2020 2070 7269 6e74 2822 4572 726f       print("Erro
-0001d5c0: 723a 2055 6e61 626c 6520 746f 2072 6574  r: Unable to ret
-0001d5d0: 7269 6576 6520 4157 5320 7265 6769 6f6e  rieve AWS region
-0001d5e0: 7320 666f 7220 7468 6520 6769 7665 6e20  s for the given 
-0001d5f0: 6372 6564 656e 7469 616c 732e 2229 0a20  credentials."). 
-0001d600: 2020 2020 2020 2023 2020 2020 2065 7869         #     exi
-0001d610: 7428 3129 0a0a 2020 2020 2020 2020 2320  t(1)..        # 
-0001d620: 6578 6365 7074 2062 6f74 6f33 2e65 7863  except boto3.exc
-0001d630: 6570 7469 6f6e 732e 4e6f 4372 6564 656e  eptions.NoCreden
-0001d640: 7469 616c 7345 7272 6f72 3a0a 2020 2020  tialsError:.    
-0001d650: 2020 2020 2320 2020 2020 7072 696e 7428      #     print(
-0001d660: 224e 6f20 4157 5320 6372 6564 656e 7469  "No AWS credenti
-0001d670: 616c 7320 666f 756e 6422 290a 2020 2020  als found").    
-0001d680: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
-0001d690: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-0001d6a0: 2320 6578 6365 7074 2062 6f74 6f33 2e65  # except boto3.e
-0001d6b0: 7863 6570 7469 6f6e 732e 456e 6470 6f69  xceptions.Endpoi
-0001d6c0: 6e74 436f 6e6e 6563 7469 6f6e 4572 726f  ntConnectionErro
-0001d6d0: 723a 0a20 2020 2020 2020 2023 2020 2020  r:.        #    
-0001d6e0: 2070 7269 6e74 2822 556e 6162 6c65 2074   print("Unable t
-0001d6f0: 6f20 636f 6e6e 6563 7420 746f 2074 6865  o connect to the
-0001d700: 2041 5753 2053 3320 656e 6470 6f69 6e74   AWS S3 endpoint
-0001d710: 2e22 290a 2020 2020 2020 2020 2320 2020  .").        #   
-0001d720: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001d730: 2020 2020 2020 2020 2320 6578 6365 7074          # except
-0001d740: 2062 6f74 6f33 2e65 7863 6570 7469 6f6e   boto3.exception
-0001d750: 732e 436c 6965 6e74 4572 726f 7220 6173  s.ClientError as
-0001d760: 2065 3a0a 2020 2020 2020 2020 2320 2020   e:.        #   
-0001d770: 2020 6572 726f 725f 636f 6465 203d 2065    error_code = e
-0001d780: 2e72 6573 706f 6e73 652e 6765 7428 2745  .response.get('E
-0001d790: 7272 6f72 272c 207b 7d29 2e67 6574 2827  rror', {}).get('
-0001d7a0: 436f 6465 2729 0a0a 2020 2020 2020 2020  Code')..        
-0001d7b0: 2320 2020 2020 6966 2065 7272 6f72 5f63  #     if error_c
-0001d7c0: 6f64 6520 3d3d 2027 5265 7175 6573 7454  ode == 'RequestT
-0001d7d0: 696d 6554 6f6f 536b 6577 6564 273a 0a20  imeTooSkewed':. 
-0001d7e0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001d7f0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0001d800: 2320 2020 2020 2020 2020 2020 2020 6622  #             f"
-0001d810: 5468 6520 7469 6d65 2064 6966 6665 7265  The time differe
-0001d820: 6e63 6520 6265 7477 6565 6e20 5333 2073  nce between S3 s
-0001d830: 746f 7261 6765 2061 6e64 2079 6f75 7220  torage and your 
-0001d840: 636f 6d70 7574 6572 2069 7320 746f 6f20  computer is too 
-0001d850: 6869 6768 3a5c 6e7b 657d 2229 0a20 2020  high:\n{e}").   
-0001d860: 2020 2020 2023 2020 2020 2065 6c69 6620       #     elif 
-0001d870: 6572 726f 725f 636f 6465 203d 3d20 2749  error_code == 'I
-0001d880: 6e76 616c 6964 4163 6365 7373 4b65 7949  nvalidAccessKeyI
-0001d890: 6427 3a0a 2020 2020 2020 2020 2320 2020  d':.        #   
-0001d8a0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-0001d8b0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-0001d8c0: 2020 2066 2245 7272 6f72 3a20 496e 7661     f"Error: Inva
-0001d8d0: 6c69 6420 4157 5320 4163 6365 7373 204b  lid AWS Access K
-0001d8e0: 6579 2049 443a 5c6e 7b65 7d22 290a 2020  ey ID:\n{e}").  
-0001d8f0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001d900: 7072 696e 7428 0a20 2020 2020 2020 2023  print(.        #
-0001d910: 2020 2020 2020 2020 2020 2020 2066 2246               f"F
-0001d920: 6978 2079 6f75 7220 6372 6564 656e 7469  ix your credenti
-0001d930: 616c 7320 696e 207e 2f2e 6177 732f 6372  als in ~/.aws/cr
-0001d940: 6564 656e 7469 616c 7322 290a 2020 2020  edentials").    
-0001d950: 2020 2020 2320 2020 2020 656c 6966 2065      #     elif e
-0001d960: 7272 6f72 5f63 6f64 6520 3d3d 2027 5369  rror_code == 'Si
-0001d970: 676e 6174 7572 6544 6f65 734e 6f74 4d61  gnatureDoesNotMa
-0001d980: 7463 6827 3a0a 2020 2020 2020 2020 2320  tch':.        # 
-0001d990: 2020 2020 2020 2020 6966 2022 5369 676e          if "Sign
-0001d9a0: 6174 7572 6520 6578 7069 7265 6422 2069  ature expired" i
-0001d9b0: 6e20 7374 7228 6529 3a0a 2020 2020 2020  n str(e):.      
-0001d9c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001d9d0: 7072 696e 7428 0a20 2020 2020 2020 2023  print(.        #
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2066 2245 7272 6f72 3a20 5369 676e 6174   f"Error: Signat
-0001da00: 7572 6520 6578 7069 7265 642e 2054 6865  ure expired. The
-0001da10: 2073 7973 7465 6d20 7469 6d65 206f 6620   system time of 
-0001da20: 796f 7572 2063 6f6d 7075 7465 7220 6973  your computer is
-0001da30: 206c 696b 656c 7920 7772 6f6e 673a 5c6e   likely wrong:\n
-0001da40: 7b65 7d22 290a 2020 2020 2020 2020 2320  {e}").        # 
-0001da50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001da60: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001da70: 2023 2020 2020 2020 2020 2065 6c73 653a   #         else:
-0001da80: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-0001da90: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-0001daa0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001dab0: 2020 2020 2020 2020 6622 4572 726f 723a          f"Error:
-0001dac0: 2049 6e76 616c 6964 2041 5753 2053 6563   Invalid AWS Sec
-0001dad0: 7265 7420 4163 6365 7373 204b 6579 3a5c  ret Access Key:\
-0001dae0: 6e7b 657d 2229 0a20 2020 2020 2020 2023  n{e}").        #
-0001daf0: 2020 2020 2065 6c69 6620 6572 726f 725f       elif error_
-0001db00: 636f 6465 203d 3d20 2749 6e76 616c 6964  code == 'Invalid
-0001db10: 436c 6965 6e74 546f 6b65 6e49 6427 3a0a  ClientTokenId':.
-0001db20: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001db30: 2020 7072 696e 7428 6622 4572 726f 723a    print(f"Error:
-0001db40: 2049 6e76 616c 6964 2041 5753 2041 6363   Invalid AWS Acc
-0001db50: 6573 7320 4b65 7920 4944 206f 7220 5365  ess Key ID or Se
-0001db60: 6372 6574 2041 6363 6573 7320 4b65 7920  cret Access Key 
-0001db70: 2122 290a 2020 2020 2020 2020 2320 2020  !").        #   
-0001db80: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-0001db90: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-0001dba0: 2020 2066 2246 6978 2079 6f75 7220 6372     f"Fix your cr
-0001dbb0: 6564 656e 7469 616c 7320 696e 207e 2f2e  edentials in ~/.
-0001dbc0: 6177 732f 6372 6564 656e 7469 616c 7322  aws/credentials"
-0001dbd0: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
-0001dbe0: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
-0001dbf0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0001dc00: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001dc10: 2020 2020 2066 2245 7272 6f72 2076 616c       f"Error val
-0001dc20: 6964 6174 696e 6720 6372 6564 656e 7469  idating credenti
-0001dc30: 616c 733a 207b 657d 2229 0a20 2020 2020  als: {e}").     
-0001dc40: 2020 2023 2020 2020 2020 2020 2070 7269     #         pri
-0001dc50: 6e74 280a 2020 2020 2020 2020 2320 2020  nt(.        #   
-0001dc60: 2020 2020 2020 2020 2020 6622 4669 7820            f"Fix 
-0001dc70: 796f 7572 2063 7265 6465 6e74 6961 6c73  your credentials
-0001dc80: 2069 6e20 7e2f 2e61 7773 2f63 7265 6465   in ~/.aws/crede
-0001dc90: 6e74 6961 6c73 2229 0a20 2020 2020 2020  ntials").       
-0001dca0: 2023 2020 2020 2072 6574 7572 6e20 4661   #     return Fa
-0001dcb0: 6c73 650a 2020 2020 2020 2020 2320 6578  lse.        # ex
-0001dcc0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0001dcd0: 7320 653a 0a20 2020 2020 2020 2023 2020  s e:.        #  
-0001dce0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0001dcf0: 2020 2320 2020 2020 2020 2020 6622 556e    #         f"Un
-0001dd00: 6578 7065 6374 6564 2065 7272 6f72 2063  expected error c
-0001dd10: 6865 636b 696e 6720 7333 2063 7265 6465  hecking s3 crede
-0001dd20: 6e74 6961 6c73 3a20 7b65 7d22 290a 2020  ntials: {e}").  
-0001dd30: 2020 2020 2020 2320 2020 2020 7265 7475        #     retu
-0001dd40: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-0001dd50: 6620 6372 6561 7465 5f62 7563 6b65 7428  f create_bucket(
-0001dd60: 7365 6c66 2c20 6275 636b 6574 5f6e 616d  self, bucket_nam
-0001dd70: 652c 2072 6567 696f 6e29 3a0a 2020 2020  e, region):.    
-0001dd80: 2020 2020 2727 2743 7265 6174 6520 6120      '''Create a 
-0001dd90: 6e65 7720 5333 2062 7563 6b65 7420 7769  new S3 bucket wi
-0001dda0: 7468 2074 6865 2070 726f 7669 6465 6420  th the provided 
-0001ddb0: 6e61 6d65 2e27 2727 0a0a 2020 2020 2020  name.'''..      
-0001ddc0: 2020 6966 206e 6f74 2062 7563 6b65 745f    if not bucket_
-0001ddd0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0001dde0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001ddf0: 6f72 2822 4275 636b 6574 206e 616d 6520  or("Bucket name 
-0001de00: 6e6f 7420 7072 6f76 6964 6564 2229 0a0a  not provided")..
-0001de10: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
-0001de20: 6173 6174 7472 2873 656c 662c 2027 7333  asattr(self, 's3
-0001de30: 5f63 6c69 656e 7427 293a 0a20 2020 2020  _client'):.     
-0001de40: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0001de50: 7565 4572 726f 7228 224e 6f20 5333 2063  ueError("No S3 c
-0001de60: 6c69 656e 7420 666f 756e 642e 2053 6574  lient found. Set
-0001de70: 2041 5753 2063 7265 6465 6e74 6961 6c73   AWS credentials
-0001de80: 2066 6972 7374 2e22 290a 0a20 2020 2020   first.")..     
-0001de90: 2020 2074 7279 3a0a 0a20 2020 2020 2020     try:..       
-0001dea0: 2020 2020 2070 7269 6e74 2866 275c 6e43       print(f'\nC
-0001deb0: 7265 6174 696e 6720 6275 636b 6574 207b  reating bucket {
-0001dec0: 6275 636b 6574 5f6e 616d 657d 2e2e 2e27  bucket_name}...'
-0001ded0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0001dee0: 656c 662e 7333 5f63 6c69 656e 742e 6372  elf.s3_client.cr
-0001def0: 6561 7465 5f62 7563 6b65 7428 4275 636b  eate_bucket(Buck
-0001df00: 6574 3d62 7563 6b65 745f 6e61 6d65 2c0a  et=bucket_name,.
-0001df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df30: 2020 2020 2020 2020 2043 7265 6174 6542           CreateB
-0001df40: 7563 6b65 7443 6f6e 6669 6775 7261 7469  ucketConfigurati
-0001df50: 6f6e 3d7b 274c 6f63 6174 696f 6e43 6f6e  on={'LocationCon
-0001df60: 7374 7261 696e 7427 3a20 7265 6769 6f6e  straint': region
-0001df70: 7d29 0a20 2020 2020 2020 2020 2020 2070  }).            p
-0001df80: 7269 6e74 2866 2720 2020 202e 2e2e 6275  rint(f'    ...bu
-0001df90: 636b 6574 2063 7265 6174 6564 5c6e 2729  cket created\n')
-0001dfa0: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0001dfb0: 696e 7428 6627 5c6e 4170 706c 7969 6e67  int(f'\nApplying
-0001dfc0: 2041 4553 3235 3620 656e 6372 7970 7469   AES256 encrypti
-0001dfd0: 6f6e 2074 6f20 6275 636b 6574 207b 6275  on to bucket {bu
-0001dfe0: 636b 6574 5f6e 616d 657d 2e2e 2e27 290a  cket_name}...').
-0001dff0: 2020 2020 2020 2020 2020 2020 656e 6372              encr
-0001e000: 7970 7469 6f6e 5f63 6f6e 6669 6775 7261  yption_configura
-0001e010: 7469 6f6e 203d 207b 0a20 2020 2020 2020  tion = {.       
-0001e020: 2020 2020 2020 2020 2027 5275 6c65 7327           'Rules'
-0001e030: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
-0001e040: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
-0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e060: 2020 2741 7070 6c79 5365 7276 6572 5369    'ApplyServerSi
-0001e070: 6465 456e 6372 7970 7469 6f6e 4279 4465  deEncryptionByDe
-0001e080: 6661 756c 7427 3a20 7b0a 2020 2020 2020  fault': {.      
-0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0a0: 2020 2020 2020 2753 5345 416c 676f 7269        'SSEAlgori
-0001e0b0: 7468 6d27 3a20 2741 4553 3235 3627 0a20  thm': 'AES256'. 
-0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0d0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0001e0e0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-0001e0f0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-0001e100: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-0001e110: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001e120: 7333 5f63 6c69 656e 742e 7075 745f 6275  s3_client.put_bu
-0001e130: 636b 6574 5f65 6e63 7279 7074 696f 6e28  cket_encryption(
-0001e140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e150: 2042 7563 6b65 743d 6275 636b 6574 5f6e   Bucket=bucket_n
-0001e160: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0001e170: 2020 2020 2053 6572 7665 7253 6964 6545       ServerSideE
-0001e180: 6e63 7279 7074 696f 6e43 6f6e 6669 6775  ncryptionConfigu
-0001e190: 7261 7469 6f6e 3d65 6e63 7279 7074 696f  ration=encryptio
-0001e1a0: 6e5f 636f 6e66 6967 7572 6174 696f 6e0a  n_configuration.
-0001e1b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001e1c0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001e1d0: 6627 2020 2020 2e2e 2e65 6e63 7279 7074  f'    ...encrypt
-0001e1e0: 696f 6e20 6170 706c 6965 642e 5c6e 2729  ion applied.\n')
-0001e1f0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0001e200: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0001e210: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001e220: 6e74 2866 2745 7272 6f72 2063 7265 6174  nt(f'Error creat
-0001e230: 696e 6720 6275 636b 6574 207b 6275 636b  ing bucket {buck
-0001e240: 6574 5f6e 616d 657d 3a20 7b65 7d27 290a  et_name}: {e}').
-0001e250: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0001e260: 6578 6974 2831 290a 0a20 2020 2020 2020  exit(1)..       
-0001e270: 2023 2054 4f44 4f3a 2065 7870 616e 6420   # TODO: expand 
-0001e280: 6572 726f 7220 636f 6465 730a 0a20 2020  error codes..   
-0001e290: 2020 2020 2023 2065 7863 6570 7420 626f       # except bo
-0001e2a0: 746f 636f 7265 2e65 7863 6570 7469 6f6e  tocore.exception
-0001e2b0: 732e 426f 746f 436f 7265 4572 726f 7220  s.BotoCoreError 
-0001e2c0: 6173 2065 3a0a 2020 2020 2020 2020 2320  as e:.        # 
-0001e2d0: 2020 2020 7072 696e 7428 6622 426f 746f      print(f"Boto
-0001e2e0: 436f 7265 4572 726f 723a 207b 657d 2229  CoreError: {e}")
-0001e2f0: 0a20 2020 2020 2020 2023 2065 7863 6570  .        # excep
-0001e300: 7420 626f 746f 636f 7265 2e65 7863 6570  t botocore.excep
-0001e310: 7469 6f6e 732e 436c 6965 6e74 4572 726f  tions.ClientErro
-0001e320: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0001e330: 2320 2020 2020 6572 726f 725f 636f 6465  #     error_code
-0001e340: 203d 2065 2e72 6573 706f 6e73 655b 2745   = e.response['E
-0001e350: 7272 6f72 275d 5b27 436f 6465 275d 0a20  rror']['Code']. 
-0001e360: 2020 2020 2020 2023 2020 2020 2069 6620         #     if 
-0001e370: 6572 726f 725f 636f 6465 203d 3d20 2749  error_code == 'I
-0001e380: 6e76 616c 6964 4275 636b 6574 4e61 6d65  nvalidBucketName
-0001e390: 273a 0a20 2020 2020 2020 2023 2020 2020  ':.        #    
-0001e3a0: 2020 2020 2070 7269 6e74 2866 2245 7272       print(f"Err
-0001e3b0: 6f72 3a20 496e 7661 6c69 6420 6275 636b  or: Invalid buck
-0001e3c0: 6574 206e 616d 6520 277b 6275 636b 6574  et name '{bucket
-0001e3d0: 5f6e 616d 657d 275c 6e7b 657d 2229 0a20  _name}'\n{e}"). 
-0001e3e0: 2020 2020 2020 2023 2020 2020 2065 6c69         #     eli
-0001e3f0: 6620 6572 726f 725f 636f 6465 203d 3d20  f error_code == 
-0001e400: 2742 7563 6b65 7441 6c72 6561 6479 4578  'BucketAlreadyEx
-0001e410: 6973 7473 273a 0a20 2020 2020 2020 2023  ists':.        #
-0001e420: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0001e430: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001e440: 2320 7072 696e 7428 6622 4572 726f 723a  # print(f"Error:
-0001e450: 2042 7563 6b65 7420 277b 6275 636b 6574   Bucket '{bucket
-0001e460: 5f6e 616d 657d 2720 616c 7265 6164 7920  _name}' already 
-0001e470: 6578 6973 7473 2e22 290a 2020 2020 2020  exists.").      
-0001e480: 2020 2320 2020 2020 656c 6966 2065 7272    #     elif err
-0001e490: 6f72 5f63 6f64 6520 3d3d 2027 4275 636b  or_code == 'Buck
-0001e4a0: 6574 416c 7265 6164 794f 776e 6564 4279  etAlreadyOwnedBy
-0001e4b0: 596f 7527 3a0a 2020 2020 2020 2020 2320  You':.        # 
-0001e4c0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0001e4d0: 2020 2020 2023 2020 2020 2020 2020 2023       #         #
-0001e4e0: 2070 7269 6e74 2866 2245 7272 6f72 3a20   print(f"Error: 
-0001e4f0: 596f 7520 616c 7265 6164 7920 6f77 6e20  You already own 
-0001e500: 6120 6275 636b 6574 206e 616d 6564 2027  a bucket named '
-0001e510: 7b62 7563 6b65 745f 6e61 6d65 7d27 2e22  {bucket_name}'."
-0001e520: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
-0001e530: 656c 6966 2065 7272 6f72 5f63 6f64 6520  elif error_code 
-0001e540: 3d3d 2027 496e 7661 6c69 6441 6363 6573  == 'InvalidAcces
-0001e550: 734b 6579 4964 273a 0a20 2020 2020 2020  sKeyId':.       
-0001e560: 2023 2020 2020 2020 2020 2023 2070 6173   #         # pas
-0001e570: 730a 2020 2020 2020 2020 2320 2020 2020  s.        #     
-0001e580: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0001e590: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0001e5a0: 2022 4572 726f 723a 2049 6e76 616c 6964   "Error: Invalid
-0001e5b0: 4163 6365 7373 4b65 7949 642e 2054 6865  AccessKeyId. The
-0001e5c0: 2041 5753 2041 6363 6573 7320 4b65 7920   AWS Access Key 
-0001e5d0: 4964 2079 6f75 2070 726f 7669 6465 6420  Id you provided 
-0001e5e0: 646f 6573 206e 6f74 2065 7869 7374 2069  does not exist i
-0001e5f0: 6e20 6f75 7220 7265 636f 7264 7322 290a  n our records").
-0001e600: 2020 2020 2020 2020 2320 2020 2020 656c          #     el
-0001e610: 6966 2065 7272 6f72 5f63 6f64 6520 3d3d  if error_code ==
-0001e620: 2027 5369 676e 6174 7572 6544 6f65 734e   'SignatureDoesN
-0001e630: 6f74 4d61 7463 6827 3a0a 2020 2020 2020  otMatch':.      
-0001e640: 2020 2320 2020 2020 2020 2020 7061 7373    #         pass
-0001e650: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-0001e660: 2020 2023 2070 7269 6e74 2822 4572 726f     # print("Erro
-0001e670: 723a 2049 6e76 616c 6964 2041 5753 2053  r: Invalid AWS S
-0001e680: 6563 7265 7420 4163 6365 7373 204b 6579  ecret Access Key
-0001e690: 2e22 290a 2020 2020 2020 2020 2320 2020  .").        #   
-0001e6a0: 2020 656c 6966 2065 7272 6f72 5f63 6f64    elif error_cod
-0001e6b0: 6520 3d3d 2027 4163 6365 7373 4465 6e69  e == 'AccessDeni
-0001e6c0: 6564 273a 0a20 2020 2020 2020 2023 2020  ed':.        #  
-0001e6d0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-0001e6e0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001e6f0: 2020 2020 2245 7272 6f72 3a20 4163 6365      "Error: Acce
-0001e700: 7373 2064 656e 6965 642e 2043 6865 636b  ss denied. Check
-0001e710: 2079 6f75 7220 6163 636f 756e 7420 7065   your account pe
-0001e720: 726d 6973 7369 6f6e 7320 666f 7220 6372  rmissions for cr
-0001e730: 6561 7469 6e67 2053 3320 6275 636b 6574  eating S3 bucket
-0001e740: 7322 290a 2020 2020 2020 2020 2320 2020  s").        #   
-0001e750: 2020 656c 6966 2065 7272 6f72 5f63 6f64    elif error_cod
-0001e760: 6520 3d3d 2027 496c 6c65 6761 6c4c 6f63  e == 'IllegalLoc
-0001e770: 6174 696f 6e43 6f6e 7374 7261 696e 7445  ationConstraintE
-0001e780: 7863 6570 7469 6f6e 273a 0a20 2020 2020  xception':.     
-0001e790: 2020 2023 2020 2020 2020 2020 2070 7269     #         pri
-0001e7a0: 6e74 2866 2245 7272 6f72 3a20 5468 6520  nt(f"Error: The 
-0001e7b0: 7370 6563 6966 6965 6420 7265 6769 6f6e  specified region
-0001e7c0: 2027 7b72 6567 696f 6e7d 2720 6973 206e   '{region}' is n
-0001e7d0: 6f74 2076 616c 6964 2e22 290a 2020 2020  ot valid.").    
-0001e7e0: 2020 2020 2320 2020 2020 656c 7365 3a0a      #     else:.
-0001e7f0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001e800: 2020 7072 696e 7428 6622 436c 6965 6e74    print(f"Client
-0001e810: 4572 726f 723a 207b 657d 2229 0a20 2020  Error: {e}").   
-0001e820: 2020 2020 2023 2020 2020 2072 6574 7572       #     retur
-0001e830: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-0001e840: 2320 6578 6365 7074 2045 7863 6570 7469  # except Excepti
-0001e850: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0001e860: 2023 2020 2020 2070 7269 6e74 2866 2241   #     print(f"A
-0001e870: 6e20 756e 6578 7065 6374 6564 2065 7272  n unexpected err
-0001e880: 6f72 206f 6363 7572 7265 643a 207b 657d  or occurred: {e}
-0001e890: 2229 0a20 2020 2020 2020 2023 2020 2020  ").        #    
-0001e8a0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-0001e8b0: 2020 2020 2020 2023 2065 6e63 7279 7074         # encrypt
-0001e8c0: 696f 6e5f 636f 6e66 6967 7572 6174 696f  ion_configuratio
-0001e8d0: 6e20 3d20 7b0a 2020 2020 2020 2020 2320  n = {.        # 
-0001e8e0: 2020 2020 2752 756c 6573 273a 205b 0a20      'Rules': [. 
-0001e8f0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001e900: 207b 0a20 2020 2020 2020 2023 2020 2020   {.        #    
-0001e910: 2020 2020 2020 2020 2027 4170 706c 7953           'ApplyS
-0001e920: 6572 7665 7253 6964 6545 6e63 7279 7074  erverSideEncrypt
-0001e930: 696f 6e42 7944 6566 6175 6c74 273a 207b  ionByDefault': {
-0001e940: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-0001e950: 2020 2020 2020 2020 2020 2027 5353 4541             'SSEA
-0001e960: 6c67 6f72 6974 686d 273a 2027 4145 5332  lgorithm': 'AES2
-0001e970: 3536 270a 2020 2020 2020 2020 2320 2020  56'.        #   
-0001e980: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0001e990: 2020 2020 2320 2020 2020 2020 2020 7d0a      #         }.
-0001e9a0: 2020 2020 2020 2020 2320 2020 2020 5d0a          #     ].
-0001e9b0: 2020 2020 2020 2020 2320 7d0a 2020 2020          # }.    
-0001e9c0: 2020 2020 2320 7472 793a 0a20 2020 2020      # try:.     
-0001e9d0: 2020 2023 2020 2020 2072 6573 706f 6e73     #     respons
-0001e9e0: 6520 3d20 7333 5f63 6c69 656e 742e 7075  e = s3_client.pu
-0001e9f0: 745f 6275 636b 6574 5f65 6e63 7279 7074  t_bucket_encrypt
-0001ea00: 696f 6e28 0a20 2020 2020 2020 2023 2020  ion(.        #  
-0001ea10: 2020 2020 2020 2042 7563 6b65 743d 6275         Bucket=bu
-0001ea20: 636b 6574 5f6e 616d 652c 0a20 2020 2020  cket_name,.     
-0001ea30: 2020 2023 2020 2020 2020 2020 2053 6572     #         Ser
-0001ea40: 7665 7253 6964 6545 6e63 7279 7074 696f  verSideEncryptio
-0001ea50: 6e43 6f6e 6669 6775 7261 7469 6f6e 3d65  nConfiguration=e
-0001ea60: 6e63 7279 7074 696f 6e5f 636f 6e66 6967  ncryption_config
-0001ea70: 7572 6174 696f 6e0a 2020 2020 2020 2020  uration.        
-0001ea80: 2320 2020 2020 290a 2020 2020 2020 2020  #     ).        
-0001ea90: 2320 2020 2020 7072 696e 7428 6622 4170  #     print(f"Ap
-0001eaa0: 706c 6965 6420 4145 5332 3536 2065 6e63  plied AES256 enc
-0001eab0: 7279 7074 696f 6e20 746f 2053 3320 6275  ryption to S3 bu
-0001eac0: 636b 6574 2027 7b62 7563 6b65 745f 6e61  cket '{bucket_na
-0001ead0: 6d65 7d27 2229 0a20 2020 2020 2020 2023  me}'").        #
-0001eae0: 2065 7863 6570 7420 626f 746f 636f 7265   except botocore
-0001eaf0: 2e65 7863 6570 7469 6f6e 732e 436c 6965  .exceptions.Clie
-0001eb00: 6e74 4572 726f 7220 6173 2065 3a0a 2020  ntError as e:.  
-0001eb10: 2020 2020 2020 2320 2020 2020 6572 726f        #     erro
-0001eb20: 725f 636f 6465 203d 2065 2e72 6573 706f  r_code = e.respo
-0001eb30: 6e73 655b 2745 7272 6f72 275d 5b27 436f  nse['Error']['Co
-0001eb40: 6465 275d 0a20 2020 2020 2020 2023 2020  de'].        #  
-0001eb50: 2020 2069 6620 6572 726f 725f 636f 6465     if error_code
-0001eb60: 203d 3d20 2749 6e76 616c 6964 4275 636b   == 'InvalidBuck
-0001eb70: 6574 4e61 6d65 273a 0a20 2020 2020 2020  etName':.       
-0001eb80: 2023 2020 2020 2020 2020 2070 7269 6e74   #         print
-0001eb90: 2866 2245 7272 6f72 3a20 496e 7661 6c69  (f"Error: Invali
-0001eba0: 6420 6275 636b 6574 206e 616d 6520 277b  d bucket name '{
-0001ebb0: 6275 636b 6574 5f6e 616d 657d 275c 6e7b  bucket_name}'\n{
-0001ebc0: 657d 2229 0a20 2020 2020 2020 2023 2020  e}").        #  
-0001ebd0: 2020 2065 6c69 6620 6572 726f 725f 636f     elif error_co
-0001ebe0: 6465 203d 3d20 2741 6363 6573 7344 656e  de == 'AccessDen
-0001ebf0: 6965 6427 3a0a 2020 2020 2020 2020 2320  ied':.        # 
-0001ec00: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0001ec10: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001ec20: 2020 2020 2022 4572 726f 723a 2041 6363       "Error: Acc
-0001ec30: 6573 7320 6465 6e69 6564 2e20 4368 6563  ess denied. Chec
-0001ec40: 6b20 796f 7572 2061 6363 6f75 6e74 2070  k your account p
-0001ec50: 6572 6d69 7373 696f 6e73 2066 6f72 2063  ermissions for c
-0001ec60: 7265 6174 696e 6720 5333 2062 7563 6b65  reating S3 bucke
-0001ec70: 7473 2229 0a20 2020 2020 2020 2023 2020  ts").        #  
-0001ec80: 2020 2065 6c69 6620 6572 726f 725f 636f     elif error_co
-0001ec90: 6465 203d 3d20 2749 6c6c 6567 616c 4c6f  de == 'IllegalLo
-0001eca0: 6361 7469 6f6e 436f 6e73 7472 6169 6e74  cationConstraint
-0001ecb0: 4578 6365 7074 696f 6e27 3a0a 2020 2020  Exception':.    
-0001ecc0: 2020 2020 2320 2020 2020 2020 2020 7072      #         pr
-0001ecd0: 696e 7428 6622 4572 726f 723a 2054 6865  int(f"Error: The
-0001ece0: 2073 7065 6369 6669 6564 2072 6567 696f   specified regio
-0001ecf0: 6e20 277b 7265 6769 6f6e 7d27 2069 7320  n '{region}' is 
-0001ed00: 6e6f 7420 7661 6c69 642e 2229 0a20 2020  not valid.").   
-0001ed10: 2020 2020 2023 2020 2020 2065 6c69 6620       #     elif 
-0001ed20: 6572 726f 725f 636f 6465 203d 3d20 2749  error_code == 'I
-0001ed30: 6e76 616c 6964 4c6f 6361 7469 6f6e 436f  nvalidLocationCo
-0001ed40: 6e73 7472 6169 6e74 273a 0a20 2020 2020  nstraint':.     
-0001ed50: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
-0001ed60: 6e6f 7420 6570 5f75 726c 3a0a 2020 2020  not ep_url:.    
-0001ed70: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001ed80: 2020 2320 646f 206e 6f74 2073 686f 7720    # do not show 
-0001ed90: 7468 6973 2065 7272 6f72 2077 6974 6820  this error with 
-0001eda0: 6e6f 6e20 4157 5320 656e 6470 6f69 6e74  non AWS endpoint
-0001edb0: 730a 2020 2020 2020 2020 2320 2020 2020  s.        #     
-0001edc0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0001edd0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001ede0: 2020 2020 2020 2020 2066 2245 7272 6f72           f"Error
-0001edf0: 3a20 5468 6520 7370 6563 6966 6965 6420  : The specified 
-0001ee00: 6c6f 6361 7469 6f6e 2d63 6f6e 7374 7261  location-constra
-0001ee10: 696e 7420 277b 7265 6769 6f6e 7d27 2069  int '{region}' i
-0001ee20: 7320 6e6f 7420 7661 6c69 6422 290a 2020  s not valid").  
-0001ee30: 2020 2020 2020 2320 2020 2020 656c 7365        #     else
-0001ee40: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-0001ee50: 2020 2020 7072 696e 7428 6622 436c 6965      print(f"Clie
-0001ee60: 6e74 4572 726f 723a 207b 657d 2229 0a20  ntError: {e}"). 
-0001ee70: 2020 2020 2020 2023 2065 7863 6570 7420         # except 
-0001ee80: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0001ee90: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
-0001eea0: 696e 7428 6622 416e 2075 6e65 7870 6563  int(f"An unexpec
-0001eeb0: 7465 6420 6572 726f 7220 6f63 6375 7272  ted error occurr
-0001eec0: 6564 2069 6e20 6372 6561 7465 5f62 7563  ed in create_buc
-0001eed0: 6b65 743a 207b 657d 2229 0a20 2020 2020  ket: {e}").     
-0001eee0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
-0001eef0: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
-0001ef00: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-0001ef10: 2064 6566 2067 6574 5f62 7563 6b65 7473   def get_buckets
-0001ef20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001ef30: 2727 2720 4765 7420 6120 6c69 7374 206f  ''' Get a list o
-0001ef40: 6620 616c 6c20 7468 6520 6672 6f73 7465  f all the froste
-0001ef50: 7220 6275 636b 6574 7320 696e 2074 6865  r buckets in the
-0001ef60: 2063 7572 7265 6e74 2073 6573 7369 6f6e   current session
-0001ef70: 2727 270a 0a20 2020 2020 2020 2074 7279  '''..        try
-0001ef80: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001ef90: 4765 7420 616c 6c20 7468 6520 6275 636b  Get all the buck
-0001efa0: 6574 730a 2020 2020 2020 2020 2020 2020  ets.            
-0001efb0: 6578 6973 7469 6e67 5f62 7563 6b65 7473  existing_buckets
-0001efc0: 203d 2073 656c 662e 7333 5f63 6c69 656e   = self.s3_clien
-0001efd0: 742e 6c69 7374 5f62 7563 6b65 7473 2829  t.list_buckets()
-0001efe0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001eff0: 4578 7472 6163 7420 7468 6520 6275 636b  Extract the buck
-0001f000: 6574 206e 616d 6573 0a20 2020 2020 2020  et names.       
-0001f010: 2020 2020 2062 7563 6b65 745f 6c69 7374       bucket_list
-0001f020: 203d 205b 6275 636b 6574 5b27 4e61 6d65   = [bucket['Name
-0001f030: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001f040: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001f050: 7220 6275 636b 6574 2069 6e20 6578 6973  r bucket in exis
-0001f060: 7469 6e67 5f62 7563 6b65 7473 5b27 4275  ting_buckets['Bu
-0001f070: 636b 6574 7327 5d5d 0a0a 2020 2020 2020  ckets']]..      
-0001f080: 2020 2020 2020 2320 4669 6c74 6572 2074        # Filter t
-0001f090: 6865 2062 7563 6b65 7420 6e61 6d65 7320  he bucket names 
-0001f0a0: 616e 6420 7265 7472 6965 7665 206f 6e6c  and retrieve onl
-0001f0b0: 7920 6672 6f73 7465 722d 2a20 6275 636b  y froster-* buck
-0001f0c0: 6574 730a 2020 2020 2020 2020 2020 2020  ets.            
-0001f0d0: 6672 6f73 7465 725f 6275 636b 6574 5f6c  froster_bucket_l
-0001f0e0: 6973 7420 3d20 5b0a 2020 2020 2020 2020  ist = [.        
-0001f0f0: 2020 2020 2020 2020 7820 666f 7220 7820          x for x 
-0001f100: 696e 2062 7563 6b65 745f 6c69 7374 2069  in bucket_list i
-0001f110: 6620 782e 7374 6172 7473 7769 7468 2827  f x.startswith('
-0001f120: 6672 6f73 7465 722d 2729 5d0a 0a20 2020  froster-')]..   
-0001f130: 2020 2020 2020 2020 2023 2052 6574 7572           # Retur
-0001f140: 6e20 7468 6520 6c69 7374 206f 6620 6672  n the list of fr
-0001f150: 6f73 7465 7220 6275 636b 6574 730a 2020  oster buckets.  
-0001f160: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001f170: 2066 726f 7374 6572 5f62 7563 6b65 745f   froster_bucket_
-0001f180: 6c69 7374 0a0a 2020 2020 2020 2020 2320  list..        # 
-0001f190: 544f 444f 3a20 4578 7061 6e64 2065 7863  TODO: Expand exc
-0001f1a0: 6570 7469 6f6e 2068 616e 646c 696e 670a  eption handling.
-0001f1b0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-0001f1c0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-0001f1d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001f1e0: 5f65 7272 6f72 2829 0a20 2020 2020 2020  _error().       
-0001f1f0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-0001f200: 0a0a 2020 2020 6465 6620 6765 745f 656e  ..    def get_en
-0001f210: 6470 6f69 6e74 2873 656c 6629 3a0a 2020  dpoint(self):.  
-0001f220: 2020 2020 2020 2727 2720 4765 7420 7468        ''' Get th
-0001f230: 6520 656e 6470 6f69 6e74 2055 524c 206f  e endpoint URL o
-0001f240: 6620 7468 6520 6375 7272 656e 7420 7365  f the current se
-0001f250: 7373 696f 6e27 2727 0a0a 2020 2020 2020  ssion'''..      
-0001f260: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
-0001f270: 662c 2027 7333 5f63 6c69 656e 7427 293a  f, 's3_client'):
-0001f280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001f290: 7572 6e20 7365 6c66 2e73 335f 636c 6965  urn self.s3_clie
-0001f2a0: 6e74 2e6d 6574 612e 656e 6470 6f69 6e74  nt.meta.endpoint
-0001f2b0: 5f75 726c 0a20 2020 2020 2020 2065 6c73  _url.        els
-0001f2c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001f2d0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-0001f2e0: 6465 6620 6765 745f 686f 7374 6e61 6d65  def get_hostname
-0001f2f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001f300: 2727 2720 4765 7420 7468 6520 686f 7374  ''' Get the host
-0001f310: 6e61 6d65 206f 6620 7468 6520 6375 7272  name of the curr
-0001f320: 656e 7420 7365 7373 696f 6e27 2727 0a0a  ent session'''..
-0001f330: 2020 2020 2020 2020 6966 2028 6861 7361          if (hasa
-0001f340: 7474 7228 7365 6c66 2c20 2773 335f 636c  ttr(self, 's3_cl
-0001f350: 6965 6e74 2729 293a 0a20 2020 2020 2020  ient')):.       
-0001f360: 2020 2020 2065 7020 3d20 7365 6c66 2e73       ep = self.s
-0001f370: 335f 636c 6965 6e74 2e6d 6574 612e 656e  3_client.meta.en
-0001f380: 6470 6f69 6e74 5f75 726c 0a20 2020 2020  dpoint_url.     
-0001f390: 2020 2020 2020 2072 6574 7572 6e20 7572         return ur
-0001f3a0: 6c6c 6962 2e70 6172 7365 2e75 726c 7061  llib.parse.urlpa
-0001f3b0: 7273 6528 6570 292e 686f 7374 6e61 6d65  rse(ep).hostname
-0001f3c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001f3d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001f3e0: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
-0001f3f0: 6765 745f 7072 6f66 696c 6573 2873 656c  get_profiles(sel
-0001f400: 6629 3a0a 2020 2020 2020 2020 2727 2720  f):.        ''' 
-0001f410: 4765 7420 6120 6c69 7374 206f 6620 6176  Get a list of av
-0001f420: 6169 6c61 626c 6520 4157 5320 7072 6f66  ailable AWS prof
-0001f430: 696c 6573 2727 270a 0a20 2020 2020 2020  iles'''..       
-0001f440: 2072 6574 7572 6e20 626f 746f 332e 5365   return boto3.Se
-0001f450: 7373 696f 6e28 292e 6176 6169 6c61 626c  ssion().availabl
-0001f460: 655f 7072 6f66 696c 6573 0a0a 2020 2020  e_profiles..    
-0001f470: 6465 6620 6765 745f 7265 6769 6f6e 7328  def get_regions(
-0001f480: 7365 6c66 293a 0a20 2020 2020 2020 2027  self):.        '
-0001f490: 2727 4765 7420 7468 6520 7265 6769 6f6e  ''Get the region
-0001f4a0: 7320 666f 7220 7468 6520 6375 7272 656e  s for the curren
-0001f4b0: 7420 7365 7373 696f 6e20 6f72 2067 6574  t session or get
-0001f4c0: 2064 6566 6175 6c74 2072 6567 696f 6e73   default regions
-0001f4d0: 2e27 2727 0a0a 2020 2020 2020 2020 7472  .'''..        tr
-0001f4e0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-0001f4f0: 6567 696f 6e73 203d 2073 656c 662e 6563  egions = self.ec
-0001f500: 325f 636c 6965 6e74 2e64 6573 6372 6962  2_client.describ
-0001f510: 655f 7265 6769 6f6e 7328 290a 2020 2020  e_regions().    
-0001f520: 2020 2020 2020 2020 7265 6769 6f6e 5f6e          region_n
-0001f530: 616d 6573 203d 205b 7265 6769 6f6e 5b27  ames = [region['
-0001f540: 5265 6769 6f6e 4e61 6d65 275d 0a20 2020  RegionName'].   
-0001f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f560: 2020 2020 2020 2020 2066 6f72 2072 6567           for reg
-0001f570: 696f 6e20 696e 2072 6567 696f 6e73 5b27  ion in regions['
-0001f580: 5265 6769 6f6e 7327 5d5d 0a20 2020 2020  Regions']].     
-0001f590: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0001f5a0: 6769 6f6e 5f6e 616d 6573 0a0a 2020 2020  gion_names..    
-0001f5b0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0001f5c0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0001f5d0: 2020 2020 2020 2023 2049 6620 6375 7272         # If curr
-0001f5e0: 656e 7420 7365 7373 696f 6e20 646f 6573  ent session does
-0001f5f0: 206e 6f74 2068 6176 6520 6120 7265 6769   not have a regi
-0001f600: 6f6e 2c20 7265 7475 726e 2064 6566 6175  on, return defau
-0001f610: 6c74 2072 6567 696f 6e73 0a20 2020 2020  lt regions.     
-0001f620: 2020 2020 2020 2073 203d 2062 6f74 6f33         s = boto3
-0001f630: 2e53 6573 7369 6f6e 2829 0a20 2020 2020  .Session().     
-0001f640: 2020 2020 2020 2064 796e 616d 6f64 625f         dynamodb_
-0001f650: 7265 6769 6f6e 7320 3d20 732e 6765 745f  regions = s.get_
-0001f660: 6176 6169 6c61 626c 655f 7265 6769 6f6e  available_region
-0001f670: 7328 2764 796e 616d 6f64 6227 290a 2020  s('dynamodb').  
-0001f680: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001f690: 2064 796e 616d 6f64 625f 7265 6769 6f6e   dynamodb_region
-0001f6a0: 730a 0a20 2020 2020 2020 2023 2070 7269  s..        # pri
-0001f6b0: 6e74 2872 6567 696f 6e73 290a 2020 2020  nt(regions).    
-0001f6c0: 2020 2020 2320 7265 6769 6f6e 7320 3d20      # regions = 
-0001f6d0: 5b69 2066 6f72 2069 2069 6e20 7265 6769  [i for i in regi
-0001f6e0: 6f6e 7320 6966 206e 6f74 2069 2e73 7461  ons if not i.sta
-0001f6f0: 7274 7377 6974 6828 2761 702d 2729 5d0a  rtswith('ap-')].
-0001f700: 2020 2020 2020 2020 2320 7265 7475 726e          # return
-0001f710: 2073 6f72 7465 6428 7265 6769 6f6e 732c   sorted(regions,
-0001f720: 2072 6576 6572 7365 3d54 7275 6529 0a0a   reverse=True)..
-0001f730: 2020 2020 2020 2020 2320 6966 2070 726f          # if pro
-0001f740: 7669 6465 7220 3d3d 2027 4157 5327 3a0a  vider == 'AWS':.
-0001f750: 2020 2020 2020 2020 2320 2020 2020 7472          #     tr
-0001f760: 793a 0a20 2020 2020 2020 2023 2020 2020  y:.        #    
-0001f770: 2020 2020 2073 6573 7369 6f6e 203d 2062       session = b
-0001f780: 6f74 6f33 2e53 6573 7369 6f6e 280a 2020  oto3.Session(.  
-0001f790: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001f7a0: 2020 2020 7072 6f66 696c 655f 6e61 6d65      profile_name
-0001f7b0: 3d70 726f 6669 6c65 2920 6966 2070 726f  =profile) if pro
-0001f7c0: 6669 6c65 2065 6c73 6520 626f 746f 332e  file else boto3.
-0001f7d0: 5365 7373 696f 6e28 290a 2020 2020 2020  Session().      
-0001f7e0: 2020 2320 2020 2020 2020 2020 7265 6769    #         regi
-0001f7f0: 6f6e 7320 3d20 7365 7373 696f 6e2e 6765  ons = session.ge
-0001f800: 745f 6176 6169 6c61 626c 655f 7265 6769  t_available_regi
-0001f810: 6f6e 7328 2765 6332 2729 0a20 2020 2020  ons('ec2').     
-0001f820: 2020 2023 2020 2020 2020 2020 2023 206d     #         # m
-0001f830: 616b 6520 7468 6520 6c69 7374 2061 206c  ake the list a l
-0001f840: 6974 746c 6520 7368 6f72 7465 720a 2020  ittle shorter.  
-0001f850: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001f860: 7265 6769 6f6e 7320 3d20 5b69 2066 6f72  regions = [i for
-0001f870: 2069 2069 6e20 7265 6769 6f6e 7320 6966   i in regions if
-0001f880: 206e 6f74 2069 2e73 7461 7274 7377 6974   not i.startswit
-0001f890: 6828 2761 702d 2729 5d0a 2020 2020 2020  h('ap-')].      
-0001f8a0: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-0001f8b0: 726e 2073 6f72 7465 6428 7265 6769 6f6e  rn sorted(region
-0001f8c0: 732c 2072 6576 6572 7365 3d54 7275 6529  s, reverse=True)
-0001f8d0: 0a20 2020 2020 2020 2023 2020 2020 2065  .        #     e
-0001f8e0: 7863 6570 743a 0a20 2020 2020 2020 2023  xcept:.        #
-0001f8f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001f900: 5b27 7573 2d77 6573 742d 3227 2c20 2775  ['us-west-2', 'u
-0001f910: 732d 7765 7374 2d31 272c 2027 7573 2d65  s-west-1', 'us-e
-0001f920: 6173 742d 3127 2c20 2727 5d0a 2020 2020  ast-1', ''].    
-0001f930: 2020 2020 2320 656c 6966 2070 726f 7669      # elif provi
-0001f940: 6465 7220 3d3d 2027 4743 5327 3a0a 2020  der == 'GCS':.  
-0001f950: 2020 2020 2020 2320 2020 2020 7265 7475        #     retu
-0001f960: 726e 205b 2775 732d 7765 7374 3127 2c20  rn ['us-west1', 
-0001f970: 2775 732d 6561 7374 3127 2c20 2727 5d0a  'us-east1', ''].
-0001f980: 2020 2020 2020 2020 2320 656c 6966 2070          # elif p
-0001f990: 726f 7669 6465 7220 3d3d 2027 5761 7361  rovider == 'Wasa
-0001f9a0: 6269 273a 0a20 2020 2020 2020 2023 2020  bi':.        #  
-0001f9b0: 2020 2072 6574 7572 6e20 5b27 7573 2d77     return ['us-w
-0001f9c0: 6573 742d 3127 2c20 2775 732d 6561 7374  est-1', 'us-east
-0001f9d0: 2d31 272c 2027 275d 0a20 2020 2020 2020  -1', ''].       
-0001f9e0: 2023 2065 6c69 6620 7072 6f76 6964 6572   # elif provider
-0001f9f0: 203d 3d20 2749 4472 6976 6527 3a0a 2020   == 'IDrive':.  
-0001fa00: 2020 2020 2020 2320 2020 2020 7265 7475        #     retu
-0001fa10: 726e 205b 2775 732d 6f72 272c 2027 7573  rn ['us-or', 'us
-0001fa20: 2d76 6127 2c20 2775 732d 6c61 272c 2027  -va', 'us-la', '
-0001fa30: 275d 0a20 2020 2020 2020 2023 2065 6c69  '].        # eli
-0001fa40: 6620 7072 6f76 6964 6572 203d 3d20 2743  f provider == 'C
-0001fa50: 6570 6827 3a0a 2020 2020 2020 2020 2320  eph':.        # 
-0001fa60: 2020 2020 7265 7475 726e 205b 2764 6566      return ['def
-0001fa70: 6175 6c74 2d70 6c61 6365 6d65 6e74 272c  ault-placement',
-0001fa80: 2027 7573 2d65 6173 742d 3127 2c20 2727   'us-east-1', ''
-0001fa90: 5d0a 0a20 2020 2064 6566 206c 6973 745f  ]..    def list_
-0001faa0: 6f62 6a65 6374 735f 696e 5f62 7563 6b65  objects_in_bucke
-0001fab0: 7428 7365 6c66 2c20 6275 636b 6574 5f6e  t(self, bucket_n
-0001fac0: 616d 6529 3a0a 2020 2020 2020 2020 6966  ame):.        if
-0001fad0: 206e 6f74 2062 7563 6b65 745f 6e61 6d65   not bucket_name
-0001fae0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001faf0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-0001fb00: 4e6f 2062 7563 6b65 7420 6e61 6d65 2070  No bucket name p
-0001fb10: 726f 7669 6465 6427 290a 0a20 2020 2020  rovided')..     
-0001fb20: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
-0001fb30: 6c66 2e73 335f 636c 6965 6e74 2e6c 6973  lf.s3_client.lis
-0001fb40: 745f 6f62 6a65 6374 735f 7632 2842 7563  t_objects_v2(Buc
-0001fb50: 6b65 743d 6275 636b 6574 5f6e 616d 6529  ket=bucket_name)
-0001fb60: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001fb70: 2072 6573 706f 6e73 652e 6765 7428 2743   response.get('C
-0001fb80: 6f6e 7465 6e74 7327 2c20 5b5d 290a 0a20  ontents', []).. 
-0001fb90: 2020 2064 6566 2073 6574 5f73 6573 7369     def set_sessi
-0001fba0: 6f6e 2873 656c 662c 2070 726f 6669 6c65  on(self, profile
-0001fbb0: 5f6e 616d 652c 2072 6567 696f 6e29 3a0a  _name, region):.
-0001fbc0: 2020 2020 2020 2020 2727 2720 5365 7420          ''' Set 
-0001fbd0: 7468 6520 4157 5320 7072 6f66 696c 6520  the AWS profile 
-0001fbe0: 666f 7220 7468 6520 6375 7272 656e 7420  for the current 
-0001fbf0: 7365 7373 696f 6e27 2727 0a0a 2020 2020  session'''..    
-0001fc00: 2020 2020 7472 793a 0a0a 2020 2020 2020      try:..      
-0001fc10: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
-0001fc20: 7a65 2061 2042 6f74 6f33 2073 6573 7369  ze a Boto3 sessi
-0001fc30: 6f6e 2075 7369 6e67 2074 6865 2063 6f6e  on using the con
-0001fc40: 6669 6775 7265 6420 7072 6f66 696c 650a  figured profile.
-0001fc50: 2020 2020 2020 2020 2020 2020 7365 7373              sess
-0001fc60: 696f 6e20 3d20 626f 746f 332e 5365 7373  ion = boto3.Sess
-0001fc70: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001fc80: 2020 2020 2070 726f 6669 6c65 5f6e 616d       profile_nam
-0001fc90: 653d 7072 6f66 696c 655f 6e61 6d65 2c20  e=profile_name, 
-0001fca0: 7265 6769 6f6e 5f6e 616d 653d 7265 6769  region_name=regi
-0001fcb0: 6f6e 290a 0a20 2020 2020 2020 2020 2020  on)..           
-0001fcc0: 2023 2049 6e69 7469 616c 697a 6520 7468   # Initialize th
-0001fcd0: 6520 4157 5320 636c 6965 6e74 730a 2020  e AWS clients.  
-0001fce0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0001fcf0: 655f 636c 6965 6e74 203d 2073 6573 7369  e_client = sessi
-0001fd00: 6f6e 2e63 6c69 656e 7428 2763 6527 290a  on.client('ce').
-0001fd10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001fd20: 2e65 6332 5f63 6c69 656e 7420 3d20 7365  .ec2_client = se
-0001fd30: 7373 696f 6e2e 636c 6965 6e74 2827 6563  ssion.client('ec
-0001fd40: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
-0001fd50: 7365 6c66 2e69 616d 5f63 6c69 656e 7420  self.iam_client 
-0001fd60: 3d20 7365 7373 696f 6e2e 636c 6965 6e74  = session.client
-0001fd70: 2827 6961 6d27 290a 2020 2020 2020 2020  ('iam').        
-0001fd80: 2020 2020 7365 6c66 2e73 335f 636c 6965      self.s3_clie
-0001fd90: 6e74 203d 2073 6573 7369 6f6e 2e63 6c69  nt = session.cli
-0001fda0: 656e 7428 2773 3327 290a 2020 2020 2020  ent('s3').      
-0001fdb0: 2020 2020 2020 7365 6c66 2e73 6573 5f63        self.ses_c
-0001fdc0: 6c69 656e 7420 3d20 7365 7373 696f 6e2e  lient = session.
-0001fdd0: 636c 6965 6e74 2827 7365 7327 290a 2020  client('ses').  
-0001fde0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0001fdf0: 7473 5f63 6c69 656e 7420 3d20 7365 7373  ts_client = sess
-0001fe00: 696f 6e2e 636c 6965 6e74 2827 7374 7327  ion.client('sts'
-0001fe10: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0001fe20: 2054 4f44 4f3a 2054 6869 7320 6973 2066   TODO: This is f
-0001fe30: 6f72 205f 6563 325f 6372 6561 7465 5f69  or _ec2_create_i
-0001fe40: 6e73 7461 6e63 6520 6675 6e63 7469 6f6e  nstance function
-0001fe50: 2e20 5265 7669 6577 2069 6620 7765 2072  . Review if we r
-0001fe60: 6561 6c6c 7920 6e65 6564 6564 0a20 2020  eally needed.   
-0001fe70: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0001fe80: 7373 696f 6e20 3d20 7365 7373 696f 6e0a  ssion = session.
-0001fe90: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-0001fea0: 746f 7265 2074 6861 7420 7468 6520 7365  tore that the se
-0001feb0: 7373 696f 6e20 6973 2076 616c 6964 0a20  ssion is valid. 
-0001fec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001fed0: 7661 6c69 645f 7365 7373 696f 6e20 3d20  valid_session = 
-0001fee0: 5472 7565 0a0a 2020 2020 2020 2020 6578  True..        ex
-0001fef0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0001ff00: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001ff10: 2070 6173 730a 0a20 2020 2064 6566 2067   pass..    def g
-0001ff20: 6574 5f74 696d 655f 7a6f 6e65 2873 656c  et_time_zone(sel
-0001ff30: 6629 3a0a 2020 2020 2020 2020 2727 2747  f):.        '''G
-0001ff40: 6574 2074 6865 2063 7572 7265 6e74 2074  et the current t
-0001ff50: 696d 6520 7a6f 6e65 2073 7472 696e 6720  ime zone string 
-0001ff60: 6672 6f6d 2074 6865 2073 7973 7465 6d27  from the system'
-0001ff70: 2727 0a0a 2020 2020 2020 2020 7472 793a  ''..        try:
-0001ff80: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
-0001ff90: 6573 6f6c 7665 2074 6865 202f 6574 632f  esolve the /etc/
-0001ffa0: 6c6f 6361 6c74 696d 6520 7379 6d6c 696e  localtime symlin
-0001ffb0: 6b0a 2020 2020 2020 2020 2020 2020 7469  k.            ti
-0001ffc0: 6d65 7a6f 6e65 5f70 6174 6820 3d20 6f73  mezone_path = os
-0001ffd0: 2e70 6174 682e 7265 616c 7061 7468 2822  .path.realpath("
-0001ffe0: 2f65 7463 2f6c 6f63 616c 7469 6d65 2229  /etc/localtime")
-0001fff0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00020000: 4578 7472 6163 7420 7468 6520 7469 6d65  Extract the time
-00020010: 207a 6f6e 6520 7374 7269 6e67 2062 7920   zone string by 
-00020020: 7374 7269 7070 696e 6720 6f66 6620 7468  stripping off th
-00020030: 6520 7072 6566 6978 206f 6620 7468 6520  e prefix of the 
-00020040: 7a6f 6e65 696e 666f 2070 6174 680a 2020  zoneinfo path.  
-00020050: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00020060: 745f 747a 5f73 7472 203d 2074 696d 657a  t_tz_str = timez
-00020070: 6f6e 655f 7061 7468 2e73 706c 6974 2822  one_path.split("
-00020080: 7a6f 6e65 696e 666f 2f22 295b 2d31 5d0a  zoneinfo/")[-1].
-00020090: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
-000200a0: 6574 7572 6e20 7468 6520 7469 6d65 207a  eturn the time z
-000200b0: 6f6e 6520 7374 7269 6e67 0a20 2020 2020  one string.     
-000200c0: 2020 2020 2020 2072 6574 7572 6e20 6375         return cu
-000200d0: 7272 656e 745f 747a 5f73 7472 0a0a 2020  rrent_tz_str..  
-000200e0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000200f0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-00020100: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00020110: 2745 7272 6f72 3a20 7b65 7d2e 2055 7369  'Error: {e}. Usi
-00020120: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
-00020130: 2022 416d 6572 6963 612f 4c6f 735f 416e   "America/Los_An
-00020140: 6765 6c65 7322 2729 0a20 2020 2020 2020  geles"').       
-00020150: 2020 2020 2072 6574 7572 6e20 2827 416d       return ('Am
-00020160: 6572 6963 612f 4c6f 735f 416e 6765 6c65  erica/Los_Angele
-00020170: 7327 290a 0a23 2323 2323 2323 2323 2323  s')..###########
-00020180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000201a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000201b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000201c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000201d0: 2323 2323 2323 2323 230a 0a20 2020 2064  #########..    d
-000201e0: 6566 2063 6865 636b 5f62 7563 6b65 745f  ef check_bucket_
-000201f0: 6163 6365 7373 5f66 6f6c 6465 7273 2873  access_folders(s
-00020200: 656c 662c 2066 6f6c 6465 7273 293a 0a20  elf, folders):. 
-00020210: 2020 2020 2020 2023 2054 4f44 4f3a 2066         # TODO: f
-00020220: 756e 6374 696f 6e20 7065 6e64 696e 7420  unction pendint 
-00020230: 746f 2072 6576 6965 770a 2020 2020 2020  to review.      
-00020240: 2020 7072 696e 7428 6627 544f 444f 3a20    print(f'TODO: 
-00020250: 6675 6e63 7469 6f6e 207b 696e 7370 6563  function {inspec
-00020260: 742e 7374 6163 6b28 295b 305d 5b33 5d7d  t.stack()[0][3]}
-00020270: 2070 656e 6469 6e67 2074 6f20 7265 7669   pending to revi
-00020280: 6577 2729 0a20 2020 2020 2020 2065 7869  ew').        exi
-00020290: 7428 3129 0a0a 2020 2020 2020 2020 2320  t(1)..        # 
-000202a0: 6368 6563 6b20 616c 6c20 7468 6520 6275  check all the bu
-000202b0: 636b 6574 7320 7468 6174 2068 6176 6520  ckets that have 
-000202c0: 6265 656e 2075 7365 6420 666f 7220 6172  been used for ar
-000202d0: 6368 6976 696e 670a 2020 2020 2020 2020  chiving.        
-000202e0: 7375 6666 6963 6965 6e74 203d 2054 7275  sufficient = Tru
-000202f0: 650a 2020 2020 2020 2020 6d79 6163 6365  e.        myacce
-00020300: 7373 203d 2027 7265 6164 270a 2020 2020  ss = 'read'.    
-00020310: 2020 2020 6275 636b 6574 7320 3d20 5b5d      buckets = []
-00020320: 0a20 2020 2020 2020 2066 6f72 2066 6f6c  .        for fol
-00020330: 6465 7220 696e 2066 6f6c 6465 7273 3a0a  der in folders:.
-00020340: 2020 2020 2020 2020 2020 2020 6275 636b              buck
-00020350: 6574 2c20 2a5f 203d 2073 656c 662e 6172  et, *_ = self.ar
-00020360: 6368 2e61 7263 6869 7665 5f67 6574 5f62  ch.archive_get_b
-00020370: 7563 6b65 745f 696e 666f 2866 6f6c 6465  ucket_info(folde
-00020380: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-00020390: 6620 6275 636b 6574 3a0a 2020 2020 2020  f bucket:.      
-000203a0: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-000203b0: 732e 6170 7065 6e64 2862 7563 6b65 7429  s.append(bucket)
-000203c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000203d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000203e0: 2020 2070 7269 6e74 2866 2745 7272 6f72     print(f'Error
-000203f0: 3a20 4e6f 2061 7263 6869 7665 2063 6f6e  : No archive con
-00020400: 6669 6720 666f 756e 6420 666f 7220 666f  fig found for fo
-00020410: 6c64 6572 207b 666f 6c64 6572 7d27 290a  lder {folder}').
-00020420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020430: 7375 6666 6963 6965 6e74 203d 2046 616c  sufficient = Fal
-00020440: 7365 0a20 2020 2020 2020 2062 7563 6b65  se.        bucke
-00020450: 7473 203d 206c 6973 7428 7365 7428 6275  ts = list(set(bu
-00020460: 636b 6574 7329 2920 2023 2072 656d 6f76  ckets))  # remov
-00020470: 6520 6475 7073 0a20 2020 2020 2020 2066  e dups.        f
-00020480: 6f72 2062 7563 6b65 7420 696e 2062 7563  or bucket in buc
-00020490: 6b65 7473 3a0a 2020 2020 2020 2020 2020  kets:.          
-000204a0: 2020 6966 206e 6f74 2073 656c 662e 6368    if not self.ch
-000204b0: 6563 6b5f 6275 636b 6574 5f61 6363 6573  eck_bucket_acces
-000204c0: 7328 6275 636b 6574 293a 0a20 2020 2020  s(bucket):.     
-000204d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000204e0: 2866 2720 596f 7520 6861 7665 206e 6f20  (f' You have no 
-000204f0: 7b6d 7961 6363 6573 737d 2061 6363 6573  {myaccess} acces
-00020500: 7320 746f 2062 7563 6b65 7420 227b 6275  s to bucket "{bu
-00020510: 636b 6574 7d22 2021 2729 0a20 2020 2020  cket}" !').     
-00020520: 2020 2020 2020 2020 2020 2073 7566 6669             suffi
-00020530: 6369 656e 7420 3d20 4661 6c73 650a 2020  cient = False.  
-00020540: 2020 2020 2020 7265 7475 726e 2073 7566        return suf
-00020550: 6669 6369 656e 740a 0a20 2020 2064 6566  ficient..    def
-00020560: 205f 6765 745f 7333 5f64 6174 615f 7369   _get_s3_data_si
-00020570: 7a65 2873 656c 662c 2066 6f6c 6465 7273  ze(self, folders
-00020580: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00020590: 2020 2020 2020 2047 6574 2074 6865 2073         Get the s
-000205a0: 697a 6520 6f66 2064 6174 6120 696e 2047  ize of data in G
-000205b0: 6942 2061 6767 7265 6761 7465 6420 6672  iB aggregated fr
-000205c0: 6f6d 206d 756c 7469 706c 650a 2020 2020  om multiple.    
-000205d0: 2020 2020 5333 2062 7563 6b65 7473 2066      S3 buckets f
-000205e0: 726f 6d20 6672 6f73 7465 7220 6172 6368  rom froster arch
-000205f0: 6976 6573 2069 6465 6e74 6966 6965 6420  ives identified 
-00020600: 6279 2061 0a20 2020 2020 2020 206c 6973  by a.        lis
-00020610: 7420 6f66 2066 6f6c 6465 7273 0a0a 2020  t of folders..  
-00020620: 2020 2020 2020 3a72 6574 7572 6e3a 2053        :return: S
-00020630: 697a 6520 6f66 2074 6865 2064 6174 6120  ize of the data 
-00020640: 696e 2047 6942 2e0a 2020 2020 2020 2020  in GiB..        
-00020650: 2222 220a 2020 2020 2020 2020 2320 496e  """.        # In
-00020660: 6974 6961 6c69 7a65 2074 6f74 616c 2073  itialize total s
-00020670: 697a 650a 2020 2020 2020 2020 746f 7461  ize.        tota
-00020680: 6c5f 7369 7a65 5f62 7974 6573 203d 2030  l_size_bytes = 0
-00020690: 0a0a 2020 2020 2020 2020 2320 6275 636b  ..        # buck
-000206a0: 6574 5f6e 616d 652c 2070 7265 6669 782c  et_name, prefix,
-000206b0: 2072 6563 7572 7369 7665 3d46 616c 7365   recursive=False
-000206c0: 0a20 2020 2020 2020 2066 6f72 2066 6c64  .        for fld
-000206d0: 2069 6e20 666f 6c64 6572 733a 0a20 2020   in folders:.   
-000206e0: 2020 2020 2020 2020 2062 7563 2c20 7072           buc, pr
-000206f0: 652c 2072 6563 7572 2c20 5f20 3d20 7365  e, recur, _ = se
-00020700: 6c66 2e61 7263 682e 6172 6368 6976 655f  lf.arch.archive_
-00020710: 6765 745f 6275 636b 6574 5f69 6e66 6f28  get_bucket_info(
-00020720: 666c 6429 0a20 2020 2020 2020 2020 2020  fld).           
-00020730: 2023 2072 6574 7572 6e73 2062 7563 6b65   # returns bucke
-00020740: 7428 7374 7229 2c20 7072 6566 6978 2873  t(str), prefix(s
-00020750: 7472 292c 2072 6563 7572 7369 7665 2862  tr), recursive(b
-00020760: 6f6f 6c29 2c20 676c 6163 6965 7228 626f  ool), glacier(bo
-00020770: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-00020780: 2320 5573 6520 7061 6769 6e61 746f 7220  # Use paginator 
-00020790: 746f 2068 616e 646c 6520 6275 636b 6574  to handle bucket
-000207a0: 7320 7769 7468 206c 6172 6765 206e 756d  s with large num
-000207b0: 6265 7220 6f66 206f 626a 6563 7473 0a20  ber of objects. 
-000207c0: 2020 2020 2020 2020 2020 2070 6167 696e             pagin
-000207d0: 6174 6f72 203d 2073 656c 662e 7333 5f63  ator = self.s3_c
-000207e0: 6c69 656e 742e 6765 745f 7061 6769 6e61  lient.get_pagina
-000207f0: 746f 7228 276c 6973 745f 6f62 6a65 6374  tor('list_object
-00020800: 735f 7632 2729 0a20 2020 2020 2020 2020  s_v2').         
-00020810: 2020 2066 6f72 2070 6167 6520 696e 2070     for page in p
-00020820: 6167 696e 6174 6f72 2e70 6167 696e 6174  aginator.paginat
-00020830: 6528 4275 636b 6574 3d62 7563 2c20 5072  e(Bucket=buc, Pr
-00020840: 6566 6978 3d70 7265 293a 0a20 2020 2020  efix=pre):.     
-00020850: 2020 2020 2020 2020 2020 2069 6620 2243             if "C
-00020860: 6f6e 7465 6e74 7322 2069 6e20 7061 6765  ontents" in page
-00020870: 3a20 2023 2045 6e73 7572 6520 7468 6572  :  # Ensure ther
-00020880: 6520 6172 6520 6f62 6a65 6374 7320 756e  e are objects un
-00020890: 6465 7220 7468 6520 7370 6563 6966 6965  der the specifie
-000208a0: 6420 7072 6566 6978 0a20 2020 2020 2020  d prefix.       
-000208b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000208c0: 206f 626a 2069 6e20 7061 6765 5b27 436f   obj in page['Co
-000208d0: 6e74 656e 7473 275d 3a0a 2020 2020 2020  ntents']:.      
-000208e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208f0: 2020 6b65 7920 3d20 6f62 6a5b 274b 6579    key = obj['Key
-00020900: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00020910: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00020920: 6375 7220 6f72 2028 6b65 792e 636f 756e  cur or (key.coun
-00020930: 7428 272f 2729 203d 3d20 7072 652e 636f  t('/') == pre.co
-00020940: 756e 7428 272f 2729 2061 6e64 206b 6579  unt('/') and key
-00020950: 2e73 7461 7274 7377 6974 6828 7072 6529  .startswith(pre)
-00020960: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00020970: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00020980: 6f74 616c 5f73 697a 655f 6279 7465 7320  otal_size_bytes 
-00020990: 2b3d 206f 626a 5b27 5369 7a65 275d 0a0a  += obj['Size']..
-000209a0: 2020 2020 2020 2020 746f 7461 6c5f 7369          total_si
-000209b0: 7a65 5f67 6962 203d 2074 6f74 616c 5f73  ze_gib = total_s
-000209c0: 697a 655f 6279 7465 7320 2f20 2831 3032  ize_bytes / (102
-000209d0: 3420 2a2a 2033 2920 2023 2043 6f6e 7665  4 ** 3)  # Conve
-000209e0: 7274 2062 7974 6573 2074 6f20 4769 420a  rt bytes to GiB.
-000209f0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00020a00: 6f74 616c 5f73 697a 655f 6769 620a 0a20  otal_size_gib.. 
-00020a10: 2020 2064 6566 2077 6169 745f 666f 725f     def wait_for_
-00020a20: 7373 685f 7265 6164 7928 7365 6c66 2c20  ssh_ready(self, 
-00020a30: 686f 7374 6e61 6d65 2c20 706f 7274 3d32  hostname, port=2
-00020a40: 322c 2074 696d 656f 7574 3d36 3029 3a0a  2, timeout=60):.
-00020a50: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
-00020a60: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00020a70: 0a20 2020 2020 2020 2077 6869 6c65 2074  .        while t
-00020a80: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00020a90: 7274 5f74 696d 6520 3c20 7469 6d65 6f75  rt_time < timeou
-00020aa0: 743a 0a20 2020 2020 2020 2020 2020 2073  t:.            s
-00020ab0: 203d 2073 6f63 6b65 742e 736f 636b 6574   = socket.socket
-00020ac0: 2873 6f63 6b65 742e 4146 5f49 4e45 542c  (socket.AF_INET,
-00020ad0: 2073 6f63 6b65 742e 534f 434b 5f53 5452   socket.SOCK_STR
-00020ae0: 4541 4d29 0a20 2020 2020 2020 2020 2020  EAM).           
-00020af0: 2073 2e73 6574 7469 6d65 6f75 7428 3329   s.settimeout(3)
-00020b00: 2020 2320 5365 7420 6120 7469 6d65 6f75    # Set a timeou
-00020b10: 7420 6f6e 2074 6865 2073 6f63 6b65 7420  t on the socket 
-00020b20: 6f70 6572 6174 696f 6e73 0a20 2020 2020  operations.     
-00020b30: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00020b40: 732e 636f 6e6e 6563 745f 6578 2828 686f  s.connect_ex((ho
-00020b50: 7374 6e61 6d65 2c20 706f 7274 2929 0a20  stname, port)). 
-00020b60: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00020b70: 7375 6c74 203d 3d20 303a 0a20 2020 2020  sult == 0:.     
-00020b80: 2020 2020 2020 2020 2020 2073 2e63 6c6f             s.clo
-00020b90: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
-00020ba0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00020bb0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00020bc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020bd0: 2020 2074 696d 652e 736c 6565 7028 3529     time.sleep(5)
-00020be0: 2020 2320 5761 6974 2066 6f72 2035 2073    # Wait for 5 s
-00020bf0: 6563 6f6e 6473 2062 6566 6f72 6520 7265  econds before re
-00020c00: 7472 7969 6e67 0a20 2020 2020 2020 2020  trying.         
-00020c10: 2020 2020 2020 2073 2e63 6c6f 7365 2829         s.close()
-00020c20: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00020c30: 5469 6d65 6f75 7420 7265 6163 6865 6420  Timeout reached 
-00020c40: 7769 7468 6f75 7420 5353 4820 7365 7276  without SSH serv
-00020c50: 6572 2062 6569 6e67 2072 6561 6479 2e22  er being ready."
-00020c60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00020c70: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
-00020c80: 6563 325f 6465 706c 6f79 2873 656c 662c  ec2_deploy(self,
-00020c90: 2066 6f6c 6465 7273 2c20 7333 7369 7a65   folders, s3size
-00020ca0: 3d4e 6f74 496d 706c 656d 656e 7465 6445  =NotImplementedE
-00020cb0: 7272 6f72 293a 0a0a 2020 2020 2020 2020  rror):..        
-00020cc0: 6966 2073 3373 697a 6520 213d 2030 3a0a  if s3size != 0:.
-00020cd0: 2020 2020 2020 2020 2020 2020 7333 7369              s3si
-00020ce0: 7a65 203d 2073 656c 662e 5f67 6574 5f73  ze = self._get_s
-00020cf0: 335f 6461 7461 5f73 697a 6528 666f 6c64  3_data_size(fold
-00020d00: 6572 7329 0a20 2020 2020 2020 2070 7269  ers).        pri
-00020d10: 6e74 2866 2254 6f74 616c 2064 6174 6120  nt(f"Total data 
-00020d20: 696e 2061 6c6c 2066 6f6c 6465 7273 3a20  in all folders: 
-00020d30: 7b73 3373 697a 653a 2e32 667d 2047 6942  {s3size:.2f} GiB
-00020d40: 2229 0a20 2020 2020 2020 2070 726f 6620  ").        prof 
-00020d50: 3d20 7365 6c66 2e5f 6563 325f 6372 6561  = self._ec2_crea
-00020d60: 7465 5f69 616d 5f70 6f6c 6963 795f 726f  te_iam_policy_ro
-00020d70: 6c65 735f 6563 3270 726f 6669 6c65 2829  les_ec2profile()
-00020d80: 0a20 2020 2020 2020 2069 6964 2c20 6970  .        iid, ip
-00020d90: 203d 2073 656c 662e 5f65 6332 5f63 7265   = self._ec2_cre
-00020da0: 6174 655f 696e 7374 616e 6365 2873 3373  ate_instance(s3s
-00020db0: 697a 652c 2070 726f 6629 0a20 2020 2020  ize, prof).     
-00020dc0: 2020 2070 7269 6e74 2827 2057 6169 7469     print(' Waiti
-00020dd0: 6e67 2066 6f72 2073 7368 2068 6f73 7420  ng for ssh host 
-00020de0: 746f 2062 6563 6f6d 6520 7265 6164 7920  to become ready 
-00020df0: 2e2e 2e27 290a 2020 2020 2020 2020 6966  ...').        if
-00020e00: 206e 6f74 2073 656c 662e 7761 6974 5f66   not self.wait_f
-00020e10: 6f72 5f73 7368 5f72 6561 6479 2869 7029  or_ssh_ready(ip)
-00020e20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00020e30: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-00020e40: 2020 2020 626f 6f74 7374 7261 705f 7265      bootstrap_re
-00020e50: 7374 6f72 6520 3d20 7365 6c66 2e5f 6563  store = self._ec
-00020e60: 325f 7573 6572 5f73 7061 6365 5f73 6372  2_user_space_scr
-00020e70: 6970 7428 6969 6429 0a0a 2020 2020 2020  ipt(iid)..      
-00020e80: 2020 2320 7061 7274 2032 2c20 7072 6570    # part 2, prep
-00020e90: 2072 6573 746f 7269 6e67 202e 2e2e 2e2e   restoring .....
-00020ea0: 0a20 2020 2020 2020 2066 6f72 2066 6f6c  .        for fol
-00020eb0: 6465 7220 696e 2073 656c 662e 6172 6773  der in self.args
-00020ec0: 2e66 6f6c 6465 7273 3a0a 2020 2020 2020  .folders:.      
-00020ed0: 2020 2020 2020 7265 666f 6c64 6572 203d        refolder =
-00020ee0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f73   os.path.join(os
-00020ef0: 2e70 6174 682e 7365 702c 2027 7265 7374  .path.sep, 'rest
-00020f00: 6f72 6564 272c 2066 6f6c 6465 725b 313a  ored', folder[1:
-00020f10: 5d29 0a20 2020 2020 2020 2020 2020 2062  ]).            b
-00020f20: 6f6f 7473 7472 6170 5f72 6573 746f 7265  ootstrap_restore
-00020f30: 202b 3d20 6627 5c6e 6d6b 6469 7220 2d70   += f'\nmkdir -p
-00020f40: 2022 7b72 6566 6f6c 6465 727d 2227 0a20   "{refolder}"'. 
-00020f50: 2020 2020 2020 2020 2020 2062 6f6f 7473             boots
-00020f60: 7472 6170 5f72 6573 746f 7265 202b 3d20  trap_restore += 
-00020f70: 6627 5c6e 6c6e 202d 7320 227b 7265 666f  f'\nln -s "{refo
-00020f80: 6c64 6572 7d22 207e 2f72 6573 746f 7265  lder}" ~/restore
-00020f90: 642d 2428 6261 7365 6e61 6d65 2022 7b66  d-$(basename "{f
-00020fa0: 6f6c 6465 727d 2229 270a 2020 2020 2020  older}")'.      
-00020fb0: 2020 2020 2020 626f 6f74 7374 7261 705f        bootstrap_
-00020fc0: 7265 7374 6f72 6520 2b3d 2066 275c 6e73  restore += f'\ns
-00020fd0: 7564 6f20 6d6b 6469 7220 2d70 2024 2864  udo mkdir -p $(d
-00020fe0: 6972 6e61 6d65 2022 7b66 6f6c 6465 727d  irname "{folder}
-00020ff0: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
-00021000: 626f 6f74 7374 7261 705f 7265 7374 6f72  bootstrap_restor
-00021010: 6520 2b3d 2066 275c 6e73 7564 6f20 6368  e += f'\nsudo ch
-00021020: 6f77 6e20 6563 322d 7573 6572 2024 2864  own ec2-user $(d
-00021030: 6972 6e61 6d65 2022 7b66 6f6c 6465 727d  irname "{folder}
-00021040: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
-00021050: 626f 6f74 7374 7261 705f 7265 7374 6f72  bootstrap_restor
-00021060: 6520 2b3d 2066 275c 6e6c 6e20 2d73 2022  e += f'\nln -s "
-00021070: 7b72 6566 6f6c 6465 727d 2220 227b 666f  {refolder}" "{fo
-00021080: 6c64 6572 7d22 270a 0a20 2020 2020 2020  lder}"'..       
-00021090: 2023 2074 6869 7320 626c 6f63 6b20 6d61   # this block ma
-000210a0: 7920 6e65 6564 2074 6f20 6265 206d 6f76  y need to be mov
-000210b0: 6564 2074 6f20 6120 6675 6e63 7469 6f6e  ed to a function
-000210c0: 0a20 2020 2020 2020 2061 7267 6c20 3d20  .        argl = 
-000210d0: 5b27 2d2d 6177 7327 2c20 272d 6127 5d0a  ['--aws', '-a'].
-000210e0: 2020 2020 2020 2020 636d 646c 6973 7420          cmdlist 
-000210f0: 3d20 5b69 7465 6d20 666f 7220 6974 656d  = [item for item
-00021100: 2069 6e20 7379 732e 6172 6776 2069 6620   in sys.argv if 
-00021110: 6974 656d 206e 6f74 2069 6e20 6172 676c  item not in argl
-00021120: 5d0a 2020 2020 2020 2020 6172 676c 203d  ].        argl =
-00021130: 205b 272d 2d69 6e73 7461 6e63 652d 7479   ['--instance-ty
-00021140: 7065 272c 2027 2d69 275d 2020 2320 6966  pe', '-i']  # if
-00021150: 2066 6f75 6e64 2072 656d 6f76 6520 6f70   found remove op
-00021160: 7469 6f6e 2061 6e64 206e 6578 7420 6172  tion and next ar
-00021170: 670a 2020 2020 2020 2020 636d 646c 6973  g.        cmdlis
-00021180: 7420 3d20 5b78 2066 6f72 2069 2c20 7820  t = [x for i, x 
-00021190: 696e 2065 6e75 6d65 7261 7465 2863 6d64  in enumerate(cmd
-000211a0: 6c69 7374 2920 6966 2078 0a20 2020 2020  list) if x.     
-000211b0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-000211c0: 7420 696e 2061 7267 6c20 616e 6420 2869  t in argl and (i
-000211d0: 203d 3d20 3020 6f72 2063 6d64 6c69 7374   == 0 or cmdlist
-000211e0: 5b69 2d31 5d20 6e6f 7420 696e 2061 7267  [i-1] not in arg
-000211f0: 6c29 5d0a 2020 2020 2020 2020 6966 206e  l)].        if n
-00021200: 6f74 2027 2d2d 7072 6f66 696c 6527 2069  ot '--profile' i
-00021210: 6e20 636d 646c 6973 7420 616e 6420 7365  n cmdlist and se
-00021220: 6c66 2e61 7267 732e 6177 735f 7072 6f66  lf.args.aws_prof
-00021230: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00021240: 2063 6d64 6c69 7374 2e69 6e73 6572 7428   cmdlist.insert(
-00021250: 312c 2027 2d2d 7072 6f66 696c 6527 290a  1, '--profile').
-00021260: 2020 2020 2020 2020 2020 2020 636d 646c              cmdl
-00021270: 6973 742e 696e 7365 7274 2832 2c20 7365  ist.insert(2, se
-00021280: 6c66 2e61 7267 732e 6177 735f 7072 6f66  lf.args.aws_prof
-00021290: 696c 6529 0a20 2020 2020 2020 2063 6d64  ile).        cmd
-000212a0: 6c69 6e65 203d 2027 6672 6f73 7465 7220  line = 'froster 
-000212b0: 2720 2b20 5c0a 2020 2020 2020 2020 2020  ' + \.          
-000212c0: 2020 2220 222e 6a6f 696e 286d 6170 2873    " ".join(map(s
-000212d0: 686c 6578 2e71 756f 7465 2c20 636d 646c  hlex.quote, cmdl
-000212e0: 6973 745b 313a 5d29 2920 2023 206f 7269  ist[1:]))  # ori
-000212f0: 6769 6e61 6c20 636d 646c 696e 650a 2020  ginal cmdline.  
-00021300: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00021310: 662e 6172 6773 2e66 6f6c 6465 7273 5b30  f.args.folders[0
-00021320: 5d20 696e 2063 6d64 6c69 6e65 3a0a 2020  ] in cmdline:.  
-00021330: 2020 2020 2020 2020 2020 666f 6c64 6572            folder
-00021340: 7320 3d20 2722 2022 272e 6a6f 696e 2873  s = '" "'.join(s
-00021350: 656c 662e 6172 6773 2e66 6f6c 6465 7273  elf.args.folders
-00021360: 290a 2020 2020 2020 2020 2020 2020 636d  ).            cm
-00021370: 646c 696e 6520 3d20 6627 7b63 6d64 6c69  dline = f'{cmdli
-00021380: 6e65 7d20 227b 666f 6c64 6572 737d 2227  ne} "{folders}"'
-00021390: 0a20 2020 2020 2020 2023 2065 6e64 2062  .        # end b
-000213a0: 6c6f 636b 0a0a 2020 2020 2020 2020 7072  lock..        pr
-000213b0: 696e 7428 6622 2077 696c 6c20 6578 6563  int(f" will exec
-000213c0: 7574 6520 277b 636d 646c 696e 657d 2720  ute '{cmdline}' 
-000213d0: 6f6e 207b 6970 7d20 2e2e 2e20 2229 0a20  on {ip} ... "). 
-000213e0: 2020 2020 2020 2062 6f6f 7473 7472 6170         bootstrap
-000213f0: 5f72 6573 746f 7265 202b 3d20 275c 6e27  _restore += '\n'
-00021400: 202b 2063 6d64 6c69 6e65 0a20 2020 2020   + cmdline.     
-00021410: 2020 2023 206f 6e63 6520 7265 7472 6965     # once retrie
-00021420: 7665 6420 6672 6f6d 2047 6c61 6369 6572  ved from Glacier
-00021430: 2077 6520 6e65 6564 2074 6f20 7265 7374   we need to rest
-00021440: 6f72 6520 7468 6973 2035 2061 6e64 2031  ore this 5 and 1
-00021450: 3220 686f 7572 7320 6672 6f6d 206e 6f77  2 hours from now
-00021460: 0a20 2020 2020 2020 2062 6f6f 7473 7472  .        bootstr
-00021470: 6170 5f72 6573 746f 7265 202b 3d20 275c  ap_restore += '\
-00021480: 6e27 202b 2066 2265 6368 6f20 277b 636d  n' + f"echo '{cm
-00021490: 646c 696e 657d 2720 7c20 6174 206e 6f77  dline}' | at now
-000214a0: 202b 2035 2068 6f75 7273 220a 2020 2020   + 5 hours".    
-000214b0: 2020 2020 626f 6f74 7374 7261 705f 7265      bootstrap_re
-000214c0: 7374 6f72 6520 2b3d 2027 5c6e 2720 2b20  store += '\n' + 
-000214d0: 6622 6563 686f 2027 7b63 6d64 6c69 6e65  f"echo '{cmdline
-000214e0: 7d27 207c 2061 7420 6e6f 7720 2b20 3132  }' | at now + 12
-000214f0: 2068 6f75 7273 220a 2020 2020 2020 2020   hours".        
-00021500: 7265 7420 3d20 7365 6c66 2e73 7368 5f75  ret = self.ssh_u
-00021510: 706c 6f61 6428 2765 6332 2d75 7365 7227  pload('ec2-user'
-00021520: 2c20 6970 2c0a 2020 2020 2020 2020 2020  , ip,.          
-00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021540: 2020 2020 626f 6f74 7374 7261 705f 7265      bootstrap_re
-00021550: 7374 6f72 652c 2022 626f 6f74 7374 7261  store, "bootstra
-00021560: 702e 7368 222c 2069 735f 7374 7269 6e67  p.sh", is_string
-00021570: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00021580: 6620 7265 742e 7374 646f 7574 206f 7220  f ret.stdout or 
-00021590: 7265 742e 7374 6465 7272 3a0a 2020 2020  ret.stderr:.    
-000215a0: 2020 2020 2020 2020 7072 696e 7428 7265          print(re
-000215b0: 742e 7374 646f 7574 2c20 7265 742e 7374  t.stdout, ret.st
-000215c0: 6465 7272 290a 2020 2020 2020 2020 7265  derr).        re
-000215d0: 7420 3d20 7365 6c66 2e73 7368 5f65 7865  t = self.ssh_exe
-000215e0: 6375 7465 2827 6563 322d 7573 6572 272c  cute('ec2-user',
-000215f0: 2069 702c 0a20 2020 2020 2020 2020 2020   ip,.           
-00021600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021610: 2020 2020 276e 6f68 7570 2062 6173 6820      'nohup bash 
-00021620: 626f 6f74 7374 7261 702e 7368 203c 202f  bootstrap.sh < /
-00021630: 6465 762f 6e75 6c6c 203e 2062 6f6f 7473  dev/null > boots
-00021640: 7472 6170 2e6f 7574 2032 3e26 3120 2627  trap.out 2>&1 &'
-00021650: 290a 2020 2020 2020 2020 6966 2072 6574  ).        if ret
-00021660: 2e73 7464 6f75 7420 6f72 2072 6574 2e73  .stdout or ret.s
-00021670: 7464 6572 723a 0a20 2020 2020 2020 2020  tderr:.         
-00021680: 2020 2070 7269 6e74 2872 6574 2e73 7464     print(ret.std
-00021690: 6f75 742c 2072 6574 2e73 7464 6572 7229  out, ret.stderr)
-000216a0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-000216b0: 2045 7865 6375 7465 6420 626f 6f74 7374   Executed bootst
-000216c0: 7261 7020 616e 6420 7265 7374 6f72 6520  rap and restore 
-000216d0: 7363 7269 7074 202e 2e2e 2079 6f75 206d  script ... you m
-000216e0: 6179 2068 6176 6520 746f 2077 6169 7420  ay have to wait 
-000216f0: 6120 7768 696c 6520 2e2e 2e27 290a 2020  a while ...').  
-00021700: 2020 2020 2020 7072 696e 7428 2720 6275        print(' bu
-00021710: 7420 796f 7520 6361 6e20 616c 7265 6164  t you can alread
-00021720: 7920 6c6f 6769 6e20 7573 696e 6720 2266  y login using "f
-00021730: 726f 7374 6572 2073 7368 2227 290a 0a20  roster ssh"').. 
-00021740: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
-00021750: 2866 2765 6368 6f20 226c 7320 2d6c 207b  (f'echo "ls -l {
-00021760: 7365 6c66 2e61 7267 732e 666f 6c64 6572  self.args.folder
-00021770: 735b 305d 7d22 203e 3e20 7e2f 2e62 6173  s[0]}" >> ~/.bas
-00021780: 685f 6869 7374 6f72 7927 290a 2020 2020  h_history').    
-00021790: 2020 2020 7265 7420 3d20 7365 6c66 2e73      ret = self.s
-000217a0: 7368 5f75 706c 6f61 6428 2765 6332 2d75  sh_upload('ec2-u
-000217b0: 7365 7227 2c20 6970 2c0a 2020 2020 2020  ser', ip,.      
-000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217d0: 2020 2020 2020 2020 227e 2f2e 6261 7368          "~/.bash
-000217e0: 5f68 6973 746f 7279 222c 2022 2e62 6173  _history", ".bas
-000217f0: 685f 6869 7374 6f72 7922 290a 2020 2020  h_history").    
-00021800: 2020 2020 6966 2072 6574 2e73 7464 6f75      if ret.stdou
-00021810: 7420 6f72 2072 6574 2e73 7464 6572 723a  t or ret.stderr:
-00021820: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00021830: 6e74 2872 6574 2e73 7464 6f75 742c 2072  nt(ret.stdout, r
-00021840: 6574 2e73 7464 6572 7229 0a0a 2020 2020  et.stderr)..    
-00021850: 2020 2020 7265 7420 3d20 7365 6c66 2e73      ret = self.s
-00021860: 7368 5f75 706c 6f61 6428 0a20 2020 2020  sh_upload(.     
-00021870: 2020 2020 2020 2027 6563 322d 7573 6572         'ec2-user
-00021880: 272c 2069 702c 2073 656c 662e 6366 672e  ', ip, self.cfg.
-00021890: 6172 6368 6976 655f 6a73 6f6e 2c20 227e  archive_json, "~
-000218a0: 2f2e 636f 6e66 6967 2f66 726f 7374 6572  /.config/froster
-000218b0: 2f22 290a 2020 2020 2020 2020 6966 2072  /").        if r
-000218c0: 6574 2e73 7464 6f75 7420 6f72 2072 6574  et.stdout or ret
-000218d0: 2e73 7464 6572 723a 0a20 2020 2020 2020  .stderr:.       
-000218e0: 2020 2020 2070 7269 6e74 2872 6574 2e73       print(ret.s
-000218f0: 7464 6f75 742c 2072 6574 2e73 7464 6572  tdout, ret.stder
-00021900: 7229 0a0a 2020 2020 2020 2020 7365 6c66  r)..        self
-00021910: 2e73 656e 645f 656d 6169 6c5f 7365 7328  .send_email_ses(
-00021920: 7365 6c66 2e63 6667 2e65 6d61 696c 2c20  self.cfg.email, 
-00021930: 7365 6c66 2e63 6667 2e65 6d61 696c 2c20  self.cfg.email, 
-00021940: 2746 726f 7374 6572 2072 6573 746f 7265  'Froster restore
-00021950: 206f 6e20 4543 3227 2c0a 2020 2020 2020   on EC2',.      
-00021960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021970: 2020 2020 2020 6627 7468 6973 2063 6f6d        f'this com
-00021980: 6d61 6e64 206c 696e 6520 7761 7320 6578  mand line was ex
-00021990: 6563 7574 6564 206f 6e20 686f 7374 207b  ecuted on host {
-000219a0: 6970 7d3a 5c6e 7b63 6d64 6c69 6e65 7d27  ip}:\n{cmdline}'
-000219b0: 290a 0a20 2020 2064 6566 205f 6563 325f  )..    def _ec2_
-000219c0: 6372 6561 7465 5f6f 725f 6765 745f 6961  create_or_get_ia
-000219d0: 6d5f 706f 6c69 6379 2873 656c 662c 2070  m_policy(self, p
-000219e0: 6f6c 5f6e 616d 652c 2070 6f6c 5f64 6f63  ol_name, pol_doc
-000219f0: 293a 0a0a 2020 2020 2020 2020 706f 6c69  ):..        poli
-00021a00: 6379 5f61 726e 203d 204e 6f6e 650a 2020  cy_arn = None.  
-00021a10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00021a20: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-00021a30: 3d20 7365 6c66 2e69 616d 5f63 6c69 656e  = self.iam_clien
-00021a40: 742e 6372 6561 7465 5f70 6f6c 6963 7928  t.create_policy(
-00021a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021a60: 2050 6f6c 6963 794e 616d 653d 706f 6c5f   PolicyName=pol_
-00021a70: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00021a80: 2020 2020 2020 506f 6c69 6379 446f 6375        PolicyDocu
-00021a90: 6d65 6e74 3d6a 736f 6e2e 6475 6d70 7328  ment=json.dumps(
-00021aa0: 706f 6c5f 646f 6329 0a20 2020 2020 2020  pol_doc).       
-00021ab0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00021ac0: 2020 2070 6f6c 6963 795f 6172 6e20 3d20     policy_arn = 
-00021ad0: 7265 7370 6f6e 7365 5b27 506f 6c69 6379  response['Policy
-00021ae0: 275d 5b27 4172 6e27 5d0a 2020 2020 2020  ']['Arn'].      
-00021af0: 2020 2020 2020 7072 696e 7428 6622 506f        print(f"Po
-00021b00: 6c69 6379 2063 7265 6174 6564 2077 6974  licy created wit
-00021b10: 6820 4152 4e3a 207b 706f 6c69 6379 5f61  h ARN: {policy_a
-00021b20: 726e 7d22 290a 2020 2020 2020 2020 6578  rn}").        ex
-00021b30: 6365 7074 2073 656c 662e 6961 6d5f 636c  cept self.iam_cl
-00021b40: 6965 6e74 2e65 7863 6570 7469 6f6e 732e  ient.exceptions.
-00021b50: 456e 7469 7479 416c 7265 6164 7945 7869  EntityAlreadyExi
-00021b60: 7374 7345 7863 6570 7469 6f6e 2061 7320  stsException as 
-00021b70: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00021b80: 6f6c 6963 6965 7320 3d20 7365 6c66 2e69  olicies = self.i
-00021b90: 616d 5f63 6c69 656e 742e 6c69 7374 5f70  am_client.list_p
-00021ba0: 6f6c 6963 6965 7328 5363 6f70 653d 274c  olicies(Scope='L
-00021bb0: 6f63 616c 2729 0a20 2020 2020 2020 2020  ocal').         
-00021bc0: 2020 2023 2053 636f 7065 3d27 4c6f 6361     # Scope='Loca
-00021bd0: 6c27 2066 6f72 2063 7573 746f 6d65 722d  l' for customer-
-00021be0: 6d61 6e61 6765 6420 706f 6c69 6369 6573  managed policies
-00021bf0: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
-00021c00: 2741 5753 2720 666f 7220 4157 532d 6d61  'AWS' for AWS-ma
-00021c10: 6e61 6765 6420 706f 6c69 6369 6573 0a20  naged policies. 
-00021c20: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00021c30: 6f6c 6963 7920 696e 2070 6f6c 6963 6965  olicy in policie
-00021c40: 735b 2750 6f6c 6963 6965 7327 5d3a 0a20  s['Policies']:. 
-00021c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021c60: 6620 706f 6c69 6379 5b27 506f 6c69 6379  f policy['Policy
-00021c70: 4e61 6d65 275d 203d 3d20 706f 6c5f 6e61  Name'] == pol_na
-00021c80: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00021c90: 2020 2020 2020 2020 706f 6c69 6379 5f61          policy_a
-00021ca0: 726e 203d 2070 6f6c 6963 795b 2741 726e  rn = policy['Arn
-00021cb0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00021cc0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00021cd0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00021ce0: 2750 6f6c 6963 7920 7b70 6f6c 5f6e 616d  'Policy {pol_nam
-00021cf0: 657d 2061 6c72 6561 6479 2065 7869 7374  e} already exist
-00021d00: 7327 290a 2020 2020 2020 2020 6578 6365  s').        exce
-00021d10: 7074 2062 6f74 6f63 6f72 652e 6578 6365  pt botocore.exce
-00021d20: 7074 696f 6e73 2e43 6c69 656e 7445 7272  ptions.ClientErr
-00021d30: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-00021d40: 2020 2020 2065 7272 6f72 5f63 6f64 6520       error_code 
-00021d50: 3d20 652e 7265 7370 6f6e 7365 5b27 4572  = e.response['Er
-00021d60: 726f 7227 5d5b 2743 6f64 6527 5d0a 2020  ror']['Code'].  
-00021d70: 2020 2020 2020 2020 2020 6966 2065 7272            if err
-00021d80: 6f72 5f63 6f64 6520 3d3d 2027 4163 6365  or_code == 'Acce
-00021d90: 7373 4465 6e69 6564 273a 0a20 2020 2020  ssDenied':.     
-00021da0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00021db0: 6462 6728 0a20 2020 2020 2020 2020 2020  dbg(.           
-00021dc0: 2020 2020 2020 2020 2066 2741 6363 6573           f'Acces
-00021dd0: 7320 6465 6e69 6564 2120 506c 6561 7365  s denied! Please
-00021de0: 2063 6865 636b 2079 6f75 7220 4941 4d20   check your IAM 
-00021df0: 7065 726d 6973 7369 6f6e 732e 205c 6e20  permissions. \n 
-00021e00: 2020 4572 726f 723a 207b 657d 2729 0a20    Error: {e}'). 
-00021e10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00021e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021e30: 2070 7269 6e74 2866 2743 6c69 656e 7420   print(f'Client 
-00021e40: 4572 726f 723a 207b 657d 2729 0a20 2020  Error: {e}').   
-00021e50: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00021e60: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00021e70: 2020 2020 2020 2020 7072 696e 7428 274f          print('O
-00021e80: 7468 6572 2045 7272 6f72 3a27 2c20 6529  ther Error:', e)
-00021e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00021ea0: 706f 6c69 6379 5f61 726e 0a0a 2020 2020  policy_arn..    
-00021eb0: 6465 6620 5f65 6332 5f63 7265 6174 655f  def _ec2_create_
-00021ec0: 6672 6f73 7465 725f 6961 6d5f 706f 6c69  froster_iam_poli
-00021ed0: 6379 2873 656c 6629 3a0a 0a20 2020 2020  cy(self):..     
-00021ee0: 2020 2023 2044 6566 696e 6520 706f 6c69     # Define poli
-00021ef0: 6379 206e 616d 6520 616e 6420 706f 6c69  cy name and poli
-00021f00: 6379 2064 6f63 756d 656e 740a 2020 2020  cy document.    
-00021f10: 2020 2020 706f 6c69 6379 5f6e 616d 6520      policy_name 
-00021f20: 3d20 2746 726f 7374 6572 4543 3244 6573  = 'FrosterEC2Des
-00021f30: 6372 6962 6550 6f6c 6963 7927 0a20 2020  cribePolicy'.   
-00021f40: 2020 2020 2070 6f6c 6963 795f 646f 6375       policy_docu
-00021f50: 6d65 6e74 203d 207b 0a20 2020 2020 2020  ment = {.       
-00021f60: 2020 2020 2022 5665 7273 696f 6e22 3a20       "Version": 
-00021f70: 2232 3031 322d 3130 2d31 3722 2c0a 2020  "2012-10-17",.  
-00021f80: 2020 2020 2020 2020 2020 2253 7461 7465            "State
-00021f90: 6d65 6e74 223a 205b 0a20 2020 2020 2020  ment": [.       
-00021fa0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-00021fb0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00021fc0: 4566 6665 6374 223a 2022 416c 6c6f 7722  Effect": "Allow"
-00021fd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00021fe0: 2020 2020 2020 2241 6374 696f 6e22 3a20        "Action": 
-00021ff0: 2265 6332 3a44 6573 6372 6962 652a 222c  "ec2:Describe*",
-00022000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022010: 2020 2020 2022 5265 736f 7572 6365 223a       "Resource":
-00022020: 2022 2a22 0a20 2020 2020 2020 2020 2020   "*".           
-00022030: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00022040: 2020 205d 0a20 2020 2020 2020 207d 0a0a     ].        }..
-00022050: 2020 2020 2020 2020 2320 4765 7420 6375          # Get cu
-00022060: 7272 656e 7420 4941 4d20 7573 6572 2773  rrent IAM user's
-00022070: 2064 6574 6169 6c73 0a20 2020 2020 2020   details.       
-00022080: 2075 7365 7220 3d20 7365 6c66 2e69 616d   user = self.iam
-00022090: 5f63 6c69 656e 742e 6765 745f 7573 6572  _client.get_user
-000220a0: 2829 0a20 2020 2020 2020 2075 7365 725f  ().        user_
-000220b0: 6e61 6d65 203d 2075 7365 725b 2755 7365  name = user['Use
-000220c0: 7227 5d5b 2755 7365 724e 616d 6527 5d0a  r']['UserName'].
-000220d0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-000220e0: 2069 6620 706f 6c69 6379 2061 6c72 6561   if policy alrea
-000220f0: 6479 2065 7869 7374 7320 666f 7220 7468  dy exists for th
-00022100: 6520 7573 6572 0a20 2020 2020 2020 2065  e user.        e
-00022110: 7869 7374 696e 675f 706f 6c69 6369 6573  xisting_policies
-00022120: 203d 2073 656c 662e 6961 6d5f 636c 6965   = self.iam_clie
-00022130: 6e74 2e6c 6973 745f 7573 6572 5f70 6f6c  nt.list_user_pol
-00022140: 6963 6965 7328 0a20 2020 2020 2020 2020  icies(.         
-00022150: 2020 2055 7365 724e 616d 653d 7573 6572     UserName=user
-00022160: 5f6e 616d 6529 0a20 2020 2020 2020 2069  _name).        i
-00022170: 6620 706f 6c69 6379 5f6e 616d 6520 696e  f policy_name in
-00022180: 2065 7869 7374 696e 675f 706f 6c69 6369   existing_polici
-00022190: 6573 5b27 506f 6c69 6379 4e61 6d65 7327  es['PolicyNames'
-000221a0: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
-000221b0: 7269 6e74 2866 227b 706f 6c69 6379 5f6e  rint(f"{policy_n
-000221c0: 616d 657d 2061 6c72 6561 6479 2065 7869  ame} already exi
-000221d0: 7374 7320 666f 7220 7573 6572 207b 7573  sts for user {us
-000221e0: 6572 5f6e 616d 657d 2e22 290a 2020 2020  er_name}.").    
-000221f0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00022200: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00022210: 2070 6f6c 6963 7920 666f 7220 7573 6572   policy for user
-00022220: 0a20 2020 2020 2020 2073 656c 662e 6961  .        self.ia
-00022230: 6d5f 636c 6965 6e74 2e70 7574 5f75 7365  m_client.put_use
-00022240: 725f 706f 6c69 6379 280a 2020 2020 2020  r_policy(.      
-00022250: 2020 2020 2020 5573 6572 4e61 6d65 3d75        UserName=u
-00022260: 7365 725f 6e61 6d65 2c0a 2020 2020 2020  ser_name,.      
-00022270: 2020 2020 2020 506f 6c69 6379 4e61 6d65        PolicyName
-00022280: 3d70 6f6c 6963 795f 6e61 6d65 2c0a 2020  =policy_name,.  
-00022290: 2020 2020 2020 2020 2020 506f 6c69 6379            Policy
-000222a0: 446f 6375 6d65 6e74 3d6a 736f 6e2e 6475  Document=json.du
-000222b0: 6d70 7328 706f 6c69 6379 5f64 6f63 756d  mps(policy_docum
-000222c0: 656e 7429 0a20 2020 2020 2020 2029 0a0a  ent).        )..
-000222d0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-000222e0: 2020 2020 2020 2020 2020 2066 2250 6f6c             f"Pol
-000222f0: 6963 7920 7b70 6f6c 6963 795f 6e61 6d65  icy {policy_name
-00022300: 7d20 6174 7461 6368 6564 2073 7563 6365  } attached succe
-00022310: 7373 6675 6c6c 7920 746f 2075 7365 7220  ssfully to user 
-00022320: 7b75 7365 725f 6e61 6d65 7d2e 2229 0a0a  {user_name}.")..
-00022330: 2020 2020 6465 6620 5f65 6332 5f63 7265      def _ec2_cre
-00022340: 6174 655f 6961 6d5f 706f 6c69 6379 5f72  ate_iam_policy_r
-00022350: 6f6c 6573 5f65 6332 7072 6f66 696c 6528  oles_ec2profile(
-00022360: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-00022370: 2063 7265 6174 6520 616c 6c20 7468 6520   create all the 
-00022380: 4941 4d20 7265 7175 6972 656d 656e 7420  IAM requirement 
-00022390: 746f 2061 6c6c 6f77 2061 6e20 6563 3220  to allow an ec2 
-000223a0: 696e 7374 616e 6365 2074 6f0a 2020 2020  instance to.    
-000223b0: 2020 2020 2320 312e 2073 656c 6620 6465      # 1. self de
-000223c0: 7374 7275 6374 2c20 322e 206d 6f6e 6974  struct, 2. monit
-000223d0: 6f72 2063 6f73 7420 7769 7468 2043 4520  or cost with CE 
-000223e0: 616e 6420 332e 2073 656e 6420 656d 6169  and 3. send emai
-000223f0: 6c73 2076 6961 2053 4553 0a0a 2020 2020  ls via SES..    
-00022400: 2020 2320 5374 6570 2030 3a20 4372 6561    # Step 0: Crea
-00022410: 7465 2049 414d 2073 656c 6620 6465 7374  te IAM self dest
-00022420: 7275 6374 2061 6e64 2045 4332 2072 6561  ruct and EC2 rea
-00022430: 6420 706f 6c69 6379 0a20 2020 2020 2020  d policy.       
-00022440: 2070 6f6c 6963 795f 646f 6375 6d65 6e74   policy_document
-00022450: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00022460: 2022 5665 7273 696f 6e22 3a20 2232 3031   "Version": "201
-00022470: 322d 3130 2d31 3722 2c0a 2020 2020 2020  2-10-17",.      
-00022480: 2020 2020 2020 2253 7461 7465 6d65 6e74        "Statement
-00022490: 223a 205b 0a20 2020 2020 2020 2020 2020  ": [.           
-000224a0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-000224b0: 2020 2020 2020 2020 2020 2022 4566 6665             "Effe
-000224c0: 6374 223a 2022 416c 6c6f 7722 2c0a 2020  ct": "Allow",.  
-000224d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224e0: 2020 2241 6374 696f 6e22 3a20 5b0a 2020    "Action": [.  
-000224f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022500: 2020 2020 2020 2265 6332 3a44 6573 6372        "ec2:Descr
-00022510: 6962 652a 222c 2020 2020 2023 2042 6173  ibe*",     # Bas
-00022520: 6963 2045 4332 2072 6561 6420 7065 726d  ic EC2 read perm
-00022530: 6973 7369 6f6e 730a 2020 2020 2020 2020  issions.        
-00022540: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
-00022550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022560: 2020 2022 5265 736f 7572 6365 223a 2022     "Resource": "
-00022570: 2a22 0a20 2020 2020 2020 2020 2020 2020  *".             
-00022580: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
-00022590: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-000225a0: 2020 2020 2020 2020 2020 2020 2245 6666              "Eff
-000225b0: 6563 7422 3a20 2241 6c6c 6f77 222c 0a20  ect": "Allow",. 
-000225c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225d0: 2020 2022 4163 7469 6f6e 223a 2022 6563     "Action": "ec
-000225e0: 323a 5465 726d 696e 6174 6549 6e73 7461  2:TerminateInsta
-000225f0: 6e63 6573 222c 0a20 2020 2020 2020 2020  nces",.         
-00022600: 2020 2020 2020 2020 2020 2022 5265 736f             "Reso
-00022610: 7572 6365 223a 2022 2a22 2c0a 2020 2020  urce": "*",.    
-00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022630: 2243 6f6e 6469 7469 6f6e 223a 207b 0a20  "Condition": {. 
-00022640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022650: 2020 2020 2020 2022 5374 7269 6e67 4571         "StringEq
-00022660: 7561 6c73 223a 207b 0a20 2020 2020 2020  uals": {.       
-00022670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022680: 2020 2020 2022 6563 323a 5265 736f 7572       "ec2:Resour
-00022690: 6365 5461 672f 4e61 6d65 223a 2022 4672  ceTag/Name": "Fr
-000226a0: 6f73 7465 7253 656c 6644 6573 7472 7563  osterSelfDestruc
-000226b0: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
-000226c0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-000226d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226e0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-000226f0: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
-00022700: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00022710: 2020 2020 2020 2020 2020 2020 2245 6666              "Eff
-00022720: 6563 7422 3a20 2241 6c6c 6f77 222c 0a20  ect": "Allow",. 
-00022730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022740: 2020 2022 4163 7469 6f6e 223a 205b 0a20     "Action": [. 
-00022750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022760: 2020 2020 2020 2022 6365 3a47 6574 436f         "ce:GetCo
-00022770: 7374 416e 6455 7361 6765 220a 2020 2020  stAndUsage".    
-00022780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022790: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000227a0: 2020 2020 2020 2022 5265 736f 7572 6365         "Resource
-000227b0: 223a 2022 2a22 0a20 2020 2020 2020 2020  ": "*".         
-000227c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000227d0: 2020 2020 205d 0a20 2020 2020 2020 207d       ].        }
-000227e0: 0a20 2020 2020 2020 2070 6f6c 6963 795f  .        policy_
-000227f0: 6e61 6d65 203d 2027 4672 6f73 7465 7253  name = 'FrosterS
-00022800: 656c 6644 6573 7472 7563 7450 6f6c 6963  elfDestructPolic
-00022810: 7927 0a0a 2020 2020 2020 2020 6465 7374  y'..        dest
-00022820: 7275 6374 5f70 6f6c 6963 795f 6172 6e20  ruct_policy_arn 
-00022830: 3d20 7365 6c66 2e5f 6563 325f 6372 6561  = self._ec2_crea
-00022840: 7465 5f6f 725f 6765 745f 6961 6d5f 706f  te_or_get_iam_po
-00022850: 6c69 6379 280a 2020 2020 2020 2020 2020  licy(.          
-00022860: 2020 706f 6c69 6379 5f6e 616d 652c 2070    policy_name, p
-00022870: 6f6c 6963 795f 646f 6375 6d65 6e74 290a  olicy_document).
-00022880: 0a20 2020 2020 2020 2023 2031 2e20 4372  .        # 1. Cr
-00022890: 6561 7465 2061 6e20 4941 4d20 726f 6c65  eate an IAM role
-000228a0: 0a20 2020 2020 2020 2074 7275 7374 5f70  .        trust_p
-000228b0: 6f6c 6963 7920 3d20 7b0a 2020 2020 2020  olicy = {.      
-000228c0: 2020 2020 2020 2256 6572 7369 6f6e 223a        "Version":
-000228d0: 2022 3230 3132 2d31 302d 3137 222c 0a20   "2012-10-17",. 
-000228e0: 2020 2020 2020 2020 2020 2022 5374 6174             "Stat
-000228f0: 656d 656e 7422 3a20 5b0a 2020 2020 2020  ement": [.      
-00022900: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
-00022910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022920: 2245 6666 6563 7422 3a20 2241 6c6c 6f77  "Effect": "Allow
-00022930: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00022940: 2020 2020 2020 2022 5072 696e 6369 7061         "Principa
-00022950: 6c22 3a20 7b22 5365 7276 6963 6522 3a20  l": {"Service": 
-00022960: 2265 6332 2e61 6d61 7a6f 6e61 7773 2e63  "ec2.amazonaws.c
-00022970: 6f6d 227d 2c0a 2020 2020 2020 2020 2020  om"},.          
-00022980: 2020 2020 2020 2020 2020 2241 6374 696f            "Actio
-00022990: 6e22 3a20 2273 7473 3a41 7373 756d 6552  n": "sts:AssumeR
-000229a0: 6f6c 6522 0a20 2020 2020 2020 2020 2020  ole".           
-000229b0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
-000229c0: 2020 2020 5d0a 2020 2020 2020 2020 7d0a      ].        }.
-000229d0: 0a20 2020 2020 2020 2072 6f6c 655f 6e61  .        role_na
-000229e0: 6d65 203d 2022 4672 6f73 7465 7245 4332  me = "FrosterEC2
-000229f0: 526f 6c65 220a 2020 2020 2020 2020 7472  Role".        tr
-00022a00: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-00022a10: 656c 662e 6961 6d5f 636c 6965 6e74 2e63  elf.iam_client.c
-00022a20: 7265 6174 655f 726f 6c65 280a 2020 2020  reate_role(.    
-00022a30: 2020 2020 2020 2020 2020 2020 526f 6c65              Role
-00022a40: 4e61 6d65 3d72 6f6c 655f 6e61 6d65 2c0a  Name=role_name,.
-00022a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a60: 4173 7375 6d65 526f 6c65 506f 6c69 6379  AssumeRolePolicy
-00022a70: 446f 6375 6d65 6e74 3d6a 736f 6e2e 6475  Document=json.du
-00022a80: 6d70 7328 7472 7573 745f 706f 6c69 6379  mps(trust_policy
-00022a90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00022aa0: 2020 2044 6573 6372 6970 7469 6f6e 3d27     Description='
-00022ab0: 4672 6f73 7465 7220 726f 6c65 2061 6c6c  Froster role all
-00022ac0: 6f77 7320 4269 6c6c 696e 672c 2053 4553  ows Billing, SES
-00022ad0: 2061 6e64 2054 6572 6d69 6e61 7465 270a   and Terminate'.
-00022ae0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00022af0: 2020 2020 2020 6578 6365 7074 2073 656c        except sel
-00022b00: 662e 6961 6d5f 636c 6965 6e74 2e65 7863  f.iam_client.exc
-00022b10: 6570 7469 6f6e 732e 456e 7469 7479 416c  eptions.EntityAl
-00022b20: 7265 6164 7945 7869 7374 7345 7863 6570  readyExistsExcep
-00022b30: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00022b40: 2020 7072 696e 7428 6627 526f 6c65 207b    print(f'Role {
-00022b50: 726f 6c65 5f6e 616d 657d 2061 6c72 6561  role_name} alrea
-00022b60: 6479 2065 7869 7374 732e 2729 0a20 2020  dy exists.').   
-00022b70: 2020 2020 2065 7863 6570 7420 626f 746f       except boto
-00022b80: 636f 7265 2e65 7863 6570 7469 6f6e 732e  core.exceptions.
-00022b90: 436c 6965 6e74 4572 726f 7220 6173 2065  ClientError as e
-00022ba0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-00022bb0: 726f 725f 636f 6465 203d 2065 2e72 6573  ror_code = e.res
-00022bc0: 706f 6e73 655b 2745 7272 6f72 275d 5b27  ponse['Error']['
-00022bd0: 436f 6465 275d 0a20 2020 2020 2020 2020  Code'].         
-00022be0: 2020 2069 6620 6572 726f 725f 636f 6465     if error_code
-00022bf0: 203d 3d20 2741 6363 6573 7344 656e 6965   == 'AccessDenie
-00022c00: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
-00022c10: 2020 2020 7072 696e 7464 6267 280a 2020      printdbg(.  
-00022c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c30: 2020 6627 4163 6365 7373 2064 656e 6965    f'Access denie
-00022c40: 6421 2050 6c65 6173 6520 6368 6563 6b20  d! Please check 
-00022c50: 796f 7572 2049 414d 2070 6572 6d69 7373  your IAM permiss
-00022c60: 696f 6e73 2e20 5c6e 2020 2045 7272 6f72  ions. \n   Error
-00022c70: 3a20 7b65 7d27 290a 2020 2020 2020 2020  : {e}').        
-00022c80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00022c90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00022ca0: 6627 436c 6965 6e74 2045 7272 6f72 3a20  f'Client Error: 
-00022cb0: 7b65 7d27 290a 2020 2020 2020 2020 6578  {e}').        ex
-00022cc0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00022cd0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00022ce0: 2070 7269 6e74 2827 4f74 6865 7220 4572   print('Other Er
-00022cf0: 726f 723a 272c 2065 290a 0a20 2020 2020  ror:', e)..     
-00022d00: 2020 2023 2032 2e20 4174 7461 6368 2070     # 2. Attach p
-00022d10: 6572 6d69 7373 696f 6e73 2070 6f6c 6963  ermissions polic
-00022d20: 6965 7320 746f 2074 6865 2049 414d 2072  ies to the IAM r
-00022d30: 6f6c 650a 2020 2020 2020 2020 636f 7374  ole.        cost
-00022d40: 5f65 7870 6c6f 7265 725f 706f 6c69 6379  _explorer_policy
-00022d50: 203d 2022 6172 6e3a 6177 733a 6961 6d3a   = "arn:aws:iam:
-00022d60: 3a61 7773 3a70 6f6c 6963 792f 4157 5342  :aws:policy/AWSB
-00022d70: 696c 6c69 6e67 5265 6164 4f6e 6c79 4163  illingReadOnlyAc
-00022d80: 6365 7373 220a 2020 2020 2020 2020 7365  cess".        se
-00022d90: 735f 706f 6c69 6379 203d 2022 6172 6e3a  s_policy = "arn:
-00022da0: 6177 733a 6961 6d3a 3a61 7773 3a70 6f6c  aws:iam::aws:pol
-00022db0: 6963 792f 416d 617a 6f6e 5345 5346 756c  icy/AmazonSESFul
-00022dc0: 6c41 6363 6573 7322 0a0a 2020 2020 2020  lAccess"..      
-00022dd0: 2020 7472 793a 0a0a 2020 2020 2020 2020    try:..        
-00022de0: 2020 2020 7365 6c66 2e69 616d 5f63 6c69      self.iam_cli
-00022df0: 656e 742e 6174 7461 6368 5f72 6f6c 655f  ent.attach_role_
-00022e00: 706f 6c69 6379 280a 2020 2020 2020 2020  policy(.        
-00022e10: 2020 2020 2020 2020 526f 6c65 4e61 6d65          RoleName
-00022e20: 3d72 6f6c 655f 6e61 6d65 2c0a 2020 2020  =role_name,.    
-00022e30: 2020 2020 2020 2020 2020 2020 506f 6c69              Poli
-00022e40: 6379 4172 6e3d 636f 7374 5f65 7870 6c6f  cyArn=cost_explo
-00022e50: 7265 725f 706f 6c69 6379 0a20 2020 2020  rer_policy.     
-00022e60: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00022e70: 2020 2020 2020 7365 6c66 2e69 616d 5f63        self.iam_c
-00022e80: 6c69 656e 742e 6174 7461 6368 5f72 6f6c  lient.attach_rol
-00022e90: 655f 706f 6c69 6379 280a 2020 2020 2020  e_policy(.      
-00022ea0: 2020 2020 2020 2020 2020 526f 6c65 4e61            RoleNa
-00022eb0: 6d65 3d72 6f6c 655f 6e61 6d65 2c0a 2020  me=role_name,.  
-00022ec0: 2020 2020 2020 2020 2020 2020 2020 506f                Po
-00022ed0: 6c69 6379 4172 6e3d 7365 735f 706f 6c69  licyArn=ses_poli
-00022ee0: 6379 0a20 2020 2020 2020 2020 2020 2029  cy.            )
-00022ef0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00022f00: 6c66 2e69 616d 5f63 6c69 656e 742e 6174  lf.iam_client.at
-00022f10: 7461 6368 5f72 6f6c 655f 706f 6c69 6379  tach_role_policy
-00022f20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022f30: 2020 526f 6c65 4e61 6d65 3d72 6f6c 655f    RoleName=role_
-00022f40: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00022f50: 2020 2020 2020 506f 6c69 6379 4172 6e3d        PolicyArn=
-00022f60: 6465 7374 7275 6374 5f70 6f6c 6963 795f  destruct_policy_
-00022f70: 6172 6e0a 2020 2020 2020 2020 2020 2020  arn.            
-00022f80: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00022f90: 2073 656c 662e 6961 6d5f 636c 6965 6e74   self.iam_client
-00022fa0: 2e65 7863 6570 7469 6f6e 732e 506f 6c69  .exceptions.Poli
-00022fb0: 6379 4e6f 7441 7474 6163 6861 626c 6545  cyNotAttachableE
-00022fc0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-00022fd0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00022fe0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022ff0: 2020 6622 506f 6c69 6379 207b 652e 706f    f"Policy {e.po
-00023000: 6c69 6379 5f61 726e 7d20 6973 206e 6f74  licy_arn} is not
-00023010: 2061 7474 6163 6861 626c 652e 2050 6c65   attachable. Ple
-00023020: 6173 6520 6368 6563 6b20 796f 7572 2070  ase check your p
-00023030: 6572 6d69 7373 696f 6e73 2e22 290a 2020  ermissions.").  
-00023040: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00023050: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
-00023060: 7863 6570 7420 626f 746f 636f 7265 2e65  xcept botocore.e
-00023070: 7863 6570 7469 6f6e 732e 436c 6965 6e74  xceptions.Client
-00023080: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-00023090: 2020 2020 2020 2020 6572 726f 725f 636f          error_co
-000230a0: 6465 203d 2065 2e72 6573 706f 6e73 655b  de = e.response[
-000230b0: 2745 7272 6f72 275d 5b27 436f 6465 275d  'Error']['Code']
-000230c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000230d0: 6572 726f 725f 636f 6465 203d 3d20 2741  error_code == 'A
-000230e0: 6363 6573 7344 656e 6965 6427 3a0a 2020  ccessDenied':.  
-000230f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00023100: 696e 7464 6267 280a 2020 2020 2020 2020  intdbg(.        
-00023110: 2020 2020 2020 2020 2020 2020 6627 4163              f'Ac
-00023120: 6365 7373 2064 656e 6965 6421 2050 6c65  cess denied! Ple
-00023130: 6173 6520 6368 6563 6b20 796f 7572 2049  ase check your I
-00023140: 414d 2070 6572 6d69 7373 696f 6e73 2e20  AM permissions. 
-00023150: 5c6e 2020 2045 7272 6f72 3a20 7b65 7d27  \n   Error: {e}'
-00023160: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00023170: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00023180: 2020 2020 7072 696e 7428 6627 436c 6965      print(f'Clie
-00023190: 6e74 2045 7272 6f72 3a20 7b65 7d27 290a  nt Error: {e}').
-000231a0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-000231b0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-000231c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000231d0: 2827 4f74 6865 7220 4572 726f 723a 272c  ('Other Error:',
-000231e0: 2065 290a 2020 2020 2020 2020 2020 2020   e).            
-000231f0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00023200: 2020 2020 2023 2033 2e20 4372 6561 7465       # 3. Create
-00023210: 2061 6e20 696e 7374 616e 6365 2070 726f   an instance pro
-00023220: 6669 6c65 2061 6e64 2061 7373 6f63 6961  file and associa
-00023230: 7465 2069 7420 7769 7468 2074 6865 2072  te it with the r
-00023240: 6f6c 650a 2020 2020 2020 2020 696e 7374  ole.        inst
-00023250: 616e 6365 5f70 726f 6669 6c65 5f6e 616d  ance_profile_nam
-00023260: 6520 3d20 2246 726f 7374 6572 4543 3250  e = "FrosterEC2P
-00023270: 726f 6669 6c65 220a 2020 2020 2020 2020  rofile".        
-00023280: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00023290: 2073 656c 662e 6961 6d5f 636c 6965 6e74   self.iam_client
-000232a0: 2e63 7265 6174 655f 696e 7374 616e 6365  .create_instance
-000232b0: 5f70 726f 6669 6c65 280a 2020 2020 2020  _profile(.      
-000232c0: 2020 2020 2020 2020 2020 496e 7374 616e            Instan
-000232d0: 6365 5072 6f66 696c 654e 616d 653d 696e  ceProfileName=in
-000232e0: 7374 616e 6365 5f70 726f 6669 6c65 5f6e  stance_profile_n
-000232f0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00023300: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00023310: 6c66 2e69 616d 5f63 6c69 656e 742e 6164  lf.iam_client.ad
-00023320: 645f 726f 6c65 5f74 6f5f 696e 7374 616e  d_role_to_instan
-00023330: 6365 5f70 726f 6669 6c65 280a 2020 2020  ce_profile(.    
-00023340: 2020 2020 2020 2020 2020 2020 496e 7374              Inst
-00023350: 616e 6365 5072 6f66 696c 654e 616d 653d  anceProfileName=
-00023360: 696e 7374 616e 6365 5f70 726f 6669 6c65  instance_profile
-00023370: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00023380: 2020 2020 2020 2052 6f6c 654e 616d 653d         RoleName=
-00023390: 726f 6c65 5f6e 616d 650a 2020 2020 2020  role_name.      
-000233a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000233b0: 6578 6365 7074 2073 656c 662e 6961 6d5f  except self.iam_
-000233c0: 636c 6965 6e74 2e65 7863 6570 7469 6f6e  client.exception
-000233d0: 732e 456e 7469 7479 416c 7265 6164 7945  s.EntityAlreadyE
-000233e0: 7869 7374 7345 7863 6570 7469 6f6e 3a0a  xistsException:.
-000233f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00023400: 7428 6627 5072 6f66 696c 6520 7b69 6e73  t(f'Profile {ins
-00023410: 7461 6e63 655f 7072 6f66 696c 655f 6e61  tance_profile_na
-00023420: 6d65 7d20 616c 7265 6164 7920 6578 6973  me} already exis
-00023430: 7473 2e27 290a 2020 2020 2020 2020 2020  ts.').          
-00023440: 2020 7265 7475 726e 2069 6e73 7461 6e63    return instanc
-00023450: 655f 7072 6f66 696c 655f 6e61 6d65 0a20  e_profile_name. 
-00023460: 2020 2020 2020 2065 7863 6570 7420 626f         except bo
-00023470: 746f 636f 7265 2e65 7863 6570 7469 6f6e  tocore.exception
-00023480: 732e 436c 6965 6e74 4572 726f 7220 6173  s.ClientError as
-00023490: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000234a0: 6572 726f 725f 636f 6465 203d 2065 2e72  error_code = e.r
-000234b0: 6573 706f 6e73 655b 2745 7272 6f72 275d  esponse['Error']
-000234c0: 5b27 436f 6465 275d 0a20 2020 2020 2020  ['Code'].       
-000234d0: 2020 2020 2069 6620 6572 726f 725f 636f       if error_co
-000234e0: 6465 203d 3d20 2741 6363 6573 7344 656e  de == 'AccessDen
-000234f0: 6965 6427 3a0a 2020 2020 2020 2020 2020  ied':.          
-00023500: 2020 2020 2020 7072 696e 7464 6267 280a        printdbg(.
-00023510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023520: 2020 2020 6627 4163 6365 7373 2064 656e      f'Access den
-00023530: 6965 6421 2050 6c65 6173 6520 6368 6563  ied! Please chec
-00023540: 6b20 796f 7572 2049 414d 2070 6572 6d69  k your IAM permi
-00023550: 7373 696f 6e73 2e20 5c6e 2020 2045 7272  ssions. \n   Err
-00023560: 6f72 3a20 7b65 7d27 290a 2020 2020 2020  or: {e}').      
-00023570: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023580: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00023590: 7428 6627 436c 6965 6e74 2045 7272 6f72  t(f'Client Error
-000235a0: 3a20 7b65 7d27 290a 2020 2020 2020 2020  : {e}').        
-000235b0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-000235c0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-000235d0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-000235e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000235f0: 2827 4f74 6865 7220 4572 726f 723a 272c  ('Other Error:',
-00023600: 2065 290a 2020 2020 2020 2020 2020 2020   e).            
-00023610: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-00023620: 2020 2020 2023 2047 6976 6520 4157 5320       # Give AWS 
-00023630: 6120 6d6f 6d65 6e74 2074 6f20 7072 6f70  a moment to prop
-00023640: 6167 6174 6520 7468 6520 6368 616e 6765  agate the change
-00023650: 730a 2020 2020 2020 2020 7072 696e 7428  s.        print(
-00023660: 2777 6169 7420 666f 7220 3135 2073 6563  'wait for 15 sec
-00023670: 202e 2e2e 2729 0a20 2020 2020 2020 2074   ...').        t
-00023680: 696d 652e 736c 6565 7028 3135 2920 2023  ime.sleep(15)  #
-00023690: 2057 6169 7420 666f 7220 3135 2073 6563   Wait for 15 sec
-000236a0: 6f6e 6473 0a0a 2020 2020 2020 2020 7265  onds..        re
-000236b0: 7475 726e 2069 6e73 7461 6e63 655f 7072  turn instance_pr
-000236c0: 6f66 696c 655f 6e61 6d65 0a0a 2020 2020  ofile_name..    
-000236d0: 6465 6620 5f65 6332 5f63 7265 6174 655f  def _ec2_create_
-000236e0: 616e 645f 6174 7461 6368 5f73 6563 7572  and_attach_secur
-000236f0: 6974 795f 6772 6f75 7028 7365 6c66 2c20  ity_group(self, 
-00023700: 696e 7374 616e 6365 5f69 6429 3a0a 0a20  instance_id):.. 
-00023710: 2020 2020 2020 2065 6332 5f72 6573 6f75         ec2_resou
-00023720: 7263 6520 3d20 7365 6c66 2e73 6573 7369  rce = self.sessi
-00023730: 6f6e 2e72 6573 6f75 7263 6528 2765 6332  on.resource('ec2
-00023740: 2729 0a20 2020 2020 2020 2067 726f 7570  ').        group
-00023750: 5f6e 616d 6520 3d20 2753 5348 2d48 5454  _name = 'SSH-HTT
-00023760: 502d 4943 4d50 270a 0a20 2020 2020 2020  P-ICMP'..       
-00023770: 2023 2043 6865 636b 2069 6620 7365 6375   # Check if secu
-00023780: 7269 7479 2067 726f 7570 2061 6c72 6561  rity group alrea
-00023790: 6479 2065 7869 7374 730a 2020 2020 2020  dy exists.      
-000237a0: 2020 7365 6375 7269 7479 5f67 726f 7570    security_group
-000237b0: 7320 3d20 7365 6c66 2e65 6332 5f63 6c69  s = self.ec2_cli
-000237c0: 656e 742e 6465 7363 7269 6265 5f73 6563  ent.describe_sec
-000237d0: 7572 6974 795f 6772 6f75 7073 280a 2020  urity_groups(.  
-000237e0: 2020 2020 2020 2020 2020 4669 6c74 6572            Filter
-000237f0: 733d 5b7b 274e 616d 6527 3a20 2767 726f  s=[{'Name': 'gro
-00023800: 7570 2d6e 616d 6527 2c20 2756 616c 7565  up-name', 'Value
-00023810: 7327 3a20 5b67 726f 7570 5f6e 616d 655d  s': [group_name]
-00023820: 7d5d 290a 2020 2020 2020 2020 6966 2073  }]).        if s
-00023830: 6563 7572 6974 795f 6772 6f75 7073 5b27  ecurity_groups['
-00023840: 5365 6375 7269 7479 4772 6f75 7073 275d  SecurityGroups']
-00023850: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00023860: 6375 7269 7479 5f67 726f 7570 5f69 6420  curity_group_id 
-00023870: 3d20 7365 6375 7269 7479 5f67 726f 7570  = security_group
-00023880: 735b 2753 6563 7572 6974 7947 726f 7570  s['SecurityGroup
-00023890: 7327 5d5b 305d 5b27 4772 6f75 7049 6427  s'][0]['GroupId'
-000238a0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-000238b0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-000238c0: 6561 7465 2073 6563 7572 6974 7920 6772  eate security gr
-000238d0: 6f75 700a 2020 2020 2020 2020 2020 2020  oup.            
-000238e0: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
-000238f0: 6563 325f 636c 6965 6e74 2e63 7265 6174  ec2_client.creat
-00023900: 655f 7365 6375 7269 7479 5f67 726f 7570  e_security_group
-00023910: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00023920: 2020 4772 6f75 704e 616d 653d 6772 6f75    GroupName=grou
-00023930: 705f 6e61 6d65 2c0a 2020 2020 2020 2020  p_name,.        
-00023940: 2020 2020 2020 2020 4465 7363 7269 7074          Descript
-00023950: 696f 6e3d 2741 6c6c 6f77 7320 5353 4820  ion='Allows SSH 
-00023960: 616e 6420 4943 4d50 2069 6e62 6f75 6e64  and ICMP inbound
-00023970: 2074 7261 6666 6963 270a 2020 2020 2020   traffic'.      
-00023980: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00023990: 2020 2020 7365 6375 7269 7479 5f67 726f      security_gro
-000239a0: 7570 5f69 6420 3d20 7265 7370 6f6e 7365  up_id = response
-000239b0: 5b27 4772 6f75 7049 6427 5d0a 0a20 2020  ['GroupId']..   
-000239c0: 2020 2020 2020 2020 2023 2041 6c6c 6f77           # Allow
-000239d0: 2070 6f72 7473 2032 322c 2038 302c 2034   ports 22, 80, 4
-000239e0: 3433 2c20 3830 3030 2d39 3030 302c 2049  43, 8000-9000, I
-000239f0: 434d 500a 2020 2020 2020 2020 2020 2020  CMP.            
-00023a00: 7365 6c66 2e65 6332 5f63 6c69 656e 742e  self.ec2_client.
-00023a10: 6175 7468 6f72 697a 655f 7365 6375 7269  authorize_securi
-00023a20: 7479 5f67 726f 7570 5f69 6e67 7265 7373  ty_group_ingress
-00023a30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00023a40: 2020 4772 6f75 7049 643d 7365 6375 7269    GroupId=securi
-00023a50: 7479 5f67 726f 7570 5f69 642c 0a20 2020  ty_group_id,.   
-00023a60: 2020 2020 2020 2020 2020 2020 2049 7050               IpP
-00023a70: 6572 6d69 7373 696f 6e73 3d5b 0a20 2020  ermissions=[.   
-00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a90: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00023aa0: 2020 2020 2020 2020 2020 2027 4970 5072             'IpPr
-00023ab0: 6f74 6f63 6f6c 273a 2027 7463 7027 2c0a  otocol': 'tcp',.
-00023ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ad0: 2020 2020 2020 2020 2746 726f 6d50 6f72          'FromPor
-00023ae0: 7427 3a20 3232 2c0a 2020 2020 2020 2020  t': 22,.        
-00023af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b00: 2754 6f50 6f72 7427 3a20 3232 2c0a 2020  'ToPort': 22,.  
-00023b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b20: 2020 2020 2020 2749 7052 616e 6765 7327        'IpRanges'
-00023b30: 3a20 5b7b 2743 6964 7249 7027 3a20 2730  : [{'CidrIp': '0
-00023b40: 2e30 2e30 2e30 2f30 277d 5d0a 2020 2020  .0.0.0/0'}].    
-00023b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b60: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00023b70: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00023b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b90: 2027 4970 5072 6f74 6f63 6f6c 273a 2027   'IpProtocol': '
-00023ba0: 7463 7027 2c0a 2020 2020 2020 2020 2020  tcp',.          
-00023bb0: 2020 2020 2020 2020 2020 2020 2020 2746                'F
-00023bc0: 726f 6d50 6f72 7427 3a20 3830 2c0a 2020  romPort': 80,.  
-00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023be0: 2020 2020 2020 2754 6f50 6f72 7427 3a20        'ToPort': 
-00023bf0: 3830 2c0a 2020 2020 2020 2020 2020 2020  80,.            
-00023c00: 2020 2020 2020 2020 2020 2020 2749 7052              'IpR
-00023c10: 616e 6765 7327 3a20 5b7b 2743 6964 7249  anges': [{'CidrI
-00023c20: 7027 3a20 2730 2e30 2e30 2e30 2f30 277d  p': '0.0.0.0/0'}
-00023c30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00023c40: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-00023c50: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
-00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c70: 2020 2020 2020 2027 4970 5072 6f74 6f63         'IpProtoc
-00023c80: 6f6c 273a 2027 7463 7027 2c0a 2020 2020  ol': 'tcp',.    
-00023c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ca0: 2020 2020 2746 726f 6d50 6f72 7427 3a20      'FromPort': 
-00023cb0: 3434 332c 0a20 2020 2020 2020 2020 2020  443,.           
-00023cc0: 2020 2020 2020 2020 2020 2020 2027 546f               'To
-00023cd0: 506f 7274 273a 2034 3433 2c0a 2020 2020  Port': 443,.    
-00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cf0: 2020 2020 2749 7052 616e 6765 7327 3a20      'IpRanges': 
-00023d00: 5b7b 2743 6964 7249 7027 3a20 2730 2e30  [{'CidrIp': '0.0
-00023d10: 2e30 2e30 2f30 277d 5d0a 2020 2020 2020  .0.0/0'}].      
-00023d20: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
-00023d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023d40: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00023d50: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00023d60: 4970 5072 6f74 6f63 6f6c 273a 2027 7463  IpProtocol': 'tc
-00023d70: 7027 2c0a 2020 2020 2020 2020 2020 2020  p',.            
-00023d80: 2020 2020 2020 2020 2020 2020 2746 726f              'Fro
-00023d90: 6d50 6f72 7427 3a20 3830 3030 2c0a 2020  mPort': 8000,.  
-00023da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023db0: 2020 2020 2020 2754 6f50 6f72 7427 3a20        'ToPort': 
-00023dc0: 3930 3030 2c0a 2020 2020 2020 2020 2020  9000,.          
-00023dd0: 2020 2020 2020 2020 2020 2020 2020 2749                'I
-00023de0: 7052 616e 6765 7327 3a20 5b7b 2743 6964  pRanges': [{'Cid
-00023df0: 7249 7027 3a20 2730 2e30 2e30 2e30 2f30  rIp': '0.0.0.0/0
-00023e00: 277d 5d0a 2020 2020 2020 2020 2020 2020  '}].            
-00023e10: 2020 2020 2020 2020 7d2c 2020 2020 2020          },      
-00023e20: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
-00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e40: 2020 2020 2020 2020 2749 7050 726f 746f          'IpProto
-00023e50: 636f 6c27 3a20 2769 636d 7027 2c0a 2020  col': 'icmp',.  
-00023e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e70: 2020 2020 2020 2746 726f 6d50 6f72 7427        'FromPort'
-00023e80: 3a20 2d31 2c20 2023 202d 3120 616c 6c6f  : -1,  # -1 allo
-00023e90: 7773 2061 6c6c 2049 434d 5020 7479 7065  ws all ICMP type
-00023ea0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00023eb0: 2020 2020 2020 2020 2020 2754 6f50 6f72            'ToPor
-00023ec0: 7427 3a20 2d31 2c0a 2020 2020 2020 2020  t': -1,.        
-00023ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ee0: 2749 7052 616e 6765 7327 3a20 5b7b 2743  'IpRanges': [{'C
-00023ef0: 6964 7249 7027 3a20 2730 2e30 2e30 2e30  idrIp': '0.0.0.0
-00023f00: 2f30 277d 5d0a 2020 2020 2020 2020 2020  /0'}].          
-00023f10: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00023f20: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-00023f30: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00023f40: 2020 2020 2023 2041 7474 6163 6820 7468       # Attach th
-00023f50: 6520 7365 6375 7269 7479 2067 726f 7570  e security group
-00023f60: 2074 6f20 7468 6520 696e 7374 616e 6365   to the instance
-00023f70: 0a20 2020 2020 2020 2069 6e73 7461 6e63  .        instanc
-00023f80: 6520 3d20 6563 325f 7265 736f 7572 6365  e = ec2_resource
-00023f90: 2e49 6e73 7461 6e63 6528 696e 7374 616e  .Instance(instan
-00023fa0: 6365 5f69 6429 0a20 2020 2020 2020 2063  ce_id).        c
-00023fb0: 7572 7265 6e74 5f73 6563 7572 6974 795f  urrent_security_
-00023fc0: 6772 6f75 7073 203d 205b 7367 5b27 4772  groups = [sg['Gr
-00023fd0: 6f75 7049 6427 5d0a 2020 2020 2020 2020  oupId'].        
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00024000: 6720 696e 2069 6e73 7461 6e63 652e 7365  g in instance.se
-00024010: 6375 7269 7479 5f67 726f 7570 735d 0a0a  curity_groups]..
-00024020: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-00024030: 6966 2074 6865 2073 6563 7572 6974 7920  if the security 
-00024040: 6772 6f75 7020 6973 2061 6c72 6561 6479  group is already
-00024050: 2061 7474 6163 6865 6420 746f 2074 6865   attached to the
-00024060: 2069 6e73 7461 6e63 650a 2020 2020 2020   instance.      
-00024070: 2020 6966 2073 6563 7572 6974 795f 6772    if security_gr
-00024080: 6f75 705f 6964 206e 6f74 2069 6e20 6375  oup_id not in cu
-00024090: 7272 656e 745f 7365 6375 7269 7479 5f67  rrent_security_g
-000240a0: 726f 7570 733a 0a20 2020 2020 2020 2020  roups:.         
-000240b0: 2020 2063 7572 7265 6e74 5f73 6563 7572     current_secur
-000240c0: 6974 795f 6772 6f75 7073 2e61 7070 656e  ity_groups.appen
-000240d0: 6428 7365 6375 7269 7479 5f67 726f 7570  d(security_group
-000240e0: 5f69 6429 0a20 2020 2020 2020 2020 2020  _id).           
-000240f0: 2069 6e73 7461 6e63 652e 6d6f 6469 6679   instance.modify
-00024100: 5f61 7474 7269 6275 7465 2847 726f 7570  _attribute(Group
-00024110: 733d 6375 7272 656e 745f 7365 6375 7269  s=current_securi
-00024120: 7479 5f67 726f 7570 7329 0a0a 2020 2020  ty_groups)..    
-00024130: 2020 2020 7265 7475 726e 2073 6563 7572      return secur
-00024140: 6974 795f 6772 6f75 705f 6964 0a0a 2020  ity_group_id..  
-00024150: 2020 6465 6620 5f65 6332 5f67 6574 5f6c    def _ec2_get_l
-00024160: 6174 6573 745f 616d 617a 6f6e 5f6c 696e  atest_amazon_lin
-00024170: 7578 325f 616d 6928 7365 6c66 293a 0a0a  ux2_ami(self):..
-00024180: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-00024190: 203d 2073 656c 662e 6563 325f 636c 6965   = self.ec2_clie
-000241a0: 6e74 2e64 6573 6372 6962 655f 696d 6167  nt.describe_imag
-000241b0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-000241c0: 4669 6c74 6572 733d 5b0a 2020 2020 2020  Filters=[.      
-000241d0: 2020 2020 2020 2020 2020 7b27 4e61 6d65            {'Name
-000241e0: 273a 2027 6e61 6d65 272c 2027 5661 6c75  ': 'name', 'Valu
-000241f0: 6573 273a 205b 2761 6c32 3032 332d 616d  es': ['al2023-am
-00024200: 692d 2a27 5d7d 2c0a 2020 2020 2020 2020  i-*']},.        
-00024210: 2020 2020 2020 2020 7b27 4e61 6d65 273a          {'Name':
-00024220: 2027 7374 6174 6527 2c20 2756 616c 7565   'state', 'Value
-00024230: 7327 3a20 5b27 6176 6169 6c61 626c 6527  s': ['available'
-00024240: 5d7d 2c0a 2020 2020 2020 2020 2020 2020  ]},.            
-00024250: 2020 2020 7b27 4e61 6d65 273a 2027 6172      {'Name': 'ar
-00024260: 6368 6974 6563 7475 7265 272c 2027 5661  chitecture', 'Va
-00024270: 6c75 6573 273a 205b 2778 3836 5f36 3427  lues': ['x86_64'
-00024280: 5d7d 2c0a 2020 2020 2020 2020 2020 2020  ]},.            
-00024290: 2020 2020 7b27 4e61 6d65 273a 2027 7669      {'Name': 'vi
-000242a0: 7274 7561 6c69 7a61 7469 6f6e 2d74 7970  rtualization-typ
-000242b0: 6527 2c20 2756 616c 7565 7327 3a20 5b27  e', 'Values': ['
-000242c0: 6876 6d27 5d7d 0a20 2020 2020 2020 2020  hvm']}.         
-000242d0: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
-000242e0: 2020 4f77 6e65 7273 3d5b 2761 6d61 7a6f    Owners=['amazo
-000242f0: 6e27 5d0a 0a20 2020 2020 2020 2020 2020  n']..           
-00024300: 2023 2061 6d7a 6e32 2d61 6d69 2d68 766d   # amzn2-ami-hvm
-00024310: 2d32 2e30 2e2a 2d78 3836 5f36 342d 6770  -2.0.*-x86_64-gp
-00024320: 320a 2020 2020 2020 2020 2020 2020 2320  2.            # 
-00024330: 616c 3230 3233 2d61 6d69 2d6b 6572 6e65  al2023-ami-kerne
-00024340: 6c2d 6465 6661 756c 742d 7838 365f 3634  l-default-x86_64
-00024350: 0a0a 2020 2020 2020 2020 290a 0a20 2020  ..        )..   
-00024360: 2020 2020 2023 2053 6f72 7420 696d 6167       # Sort imag
-00024370: 6573 2062 7920 6372 6561 7469 6f6e 2064  es by creation d
-00024380: 6174 6520 746f 2067 6574 2074 6865 206c  ate to get the l
-00024390: 6174 6573 740a 2020 2020 2020 2020 696d  atest.        im
-000243a0: 6167 6573 203d 2073 6f72 7465 6428 7265  ages = sorted(re
-000243b0: 7370 6f6e 7365 5b27 496d 6167 6573 275d  sponse['Images']
-000243c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000243d0: 2020 2020 2020 2020 2020 6b65 793d 6c61            key=la
-000243e0: 6d62 6461 206b 3a20 6b5b 2743 7265 6174  mbda k: k['Creat
-000243f0: 696f 6e44 6174 6527 5d2c 2072 6576 6572  ionDate'], rever
-00024400: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
-00024410: 2069 6620 696d 6167 6573 3a0a 2020 2020   if images:.    
-00024420: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00024430: 6d61 6765 735b 305d 5b27 496d 6167 6549  mages[0]['ImageI
-00024440: 6427 5d0a 2020 2020 2020 2020 656c 7365  d'].        else
-00024450: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00024460: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
-00024470: 6566 205f 6372 6561 7465 5f70 726f 6772  ef _create_progr
-00024480: 6573 735f 6261 7228 7365 6c66 2c20 6d61  ess_bar(self, ma
-00024490: 785f 7661 6c75 6529 3a0a 2020 2020 2020  x_value):.      
-000244a0: 2020 6465 6620 7368 6f77 5f70 726f 6772    def show_progr
-000244b0: 6573 735f 6261 7228 6974 6572 6174 696f  ess_bar(iteratio
-000244c0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-000244d0: 7065 7263 656e 7420 3d20 2822 7b30 3a2e  percent = ("{0:.
-000244e0: 3166 7d22 292e 666f 726d 6174 2831 3030  1f}").format(100
-000244f0: 202a 2028 6974 6572 6174 696f 6e20 2f20   * (iteration / 
-00024500: 666c 6f61 7428 6d61 785f 7661 6c75 6529  float(max_value)
-00024510: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
-00024520: 656e 6774 6820 3d20 3530 2020 2320 6164  ength = 50  # ad
-00024530: 6a75 7374 2061 7320 6e65 6564 6564 2066  just as needed f
-00024540: 6f72 2074 6865 2062 6172 206c 656e 6774  or the bar lengt
-00024550: 680a 2020 2020 2020 2020 2020 2020 6669  h.            fi
-00024560: 6c6c 6564 5f6c 656e 6774 6820 3d20 696e  lled_length = in
-00024570: 7428 6c65 6e67 7468 202a 2069 7465 7261  t(length * itera
-00024580: 7469 6f6e 202f 2f20 6d61 785f 7661 6c75  tion // max_valu
-00024590: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
-000245a0: 6172 203d 2022 e296 8822 202a 2066 696c  ar = "..." * fil
-000245b0: 6c65 645f 6c65 6e67 7468 202b 2027 2d27  led_length + '-'
-000245c0: 202a 2028 6c65 6e67 7468 202d 2066 696c   * (length - fil
-000245d0: 6c65 645f 6c65 6e67 7468 290a 2020 2020  led_length).    
-000245e0: 2020 2020 2020 2020 6966 2073 7973 2e73          if sys.s
-000245f0: 7464 696e 2e69 7361 7474 7928 293a 0a20  tdin.isatty():. 
-00024600: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00024610: 7269 6e74 2866 275c 727c 7b62 6172 7d7c  rint(f'\r|{bar}|
-00024620: 207b 7065 7263 656e 747d 2527 2c20 656e   {percent}%', en
-00024630: 643d 275c 7227 290a 2020 2020 2020 2020  d='\r').        
-00024640: 2020 2020 6966 2069 7465 7261 7469 6f6e      if iteration
-00024650: 203d 3d20 6d61 785f 7661 6c75 653a 0a20   == max_value:. 
-00024660: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00024670: 7269 6e74 2829 0a0a 2020 2020 2020 2020  rint()..        
-00024680: 7265 7475 726e 2073 686f 775f 7072 6f67  return show_prog
-00024690: 7265 7373 5f62 6172 0a0a 2020 2020 6465  ress_bar..    de
-000246a0: 6620 5f65 6332 5f63 6c6f 7564 5f69 6e69  f _ec2_cloud_ini
-000246b0: 745f 7363 7269 7074 2873 656c 6629 3a0a  t_script(self):.
-000246c0: 2020 2020 2020 2020 2320 4465 6669 6e65          # Define
-000246d0: 2074 6865 2055 7365 7220 4461 7461 2073   the User Data s
-000246e0: 6372 6970 740a 2020 2020 2020 2020 6c6f  cript.        lo
-000246f0: 6e67 5f74 696d 657a 6f6e 6520 3d20 7365  ng_timezone = se
-00024700: 6c66 2e67 6574 5f74 696d 655f 7a6f 6e65  lf.get_time_zone
-00024710: 2829 0a20 2020 2020 2020 2075 7365 7264  ().        userd
-00024720: 6174 6120 3d20 7465 7874 7772 6170 2e64  ata = textwrap.d
-00024730: 6564 656e 7428 6627 2727 0a20 2020 2020  edent(f'''.     
-00024740: 2020 2023 2120 2f62 696e 2f62 6173 680a     #! /bin/bash.
-00024750: 2020 2020 2020 2020 646e 6620 696e 7374          dnf inst
-00024760: 616c 6c20 2d79 2067 6363 206d 6461 646d  all -y gcc mdadm
-00024770: 0a20 2020 2020 2020 2062 6967 6469 736b  .        bigdisk
-00024780: 733d 2428 6c73 626c 6b20 2d2d 6673 202d  s=$(lsblk --fs -
-00024790: 2d6a 736f 6e20 7c20 6a71 202d 7220 272e  -json | jq -r '.
-000247a0: 626c 6f63 6b64 6576 6963 6573 5b5d 207c  blockdevices[] |
-000247b0: 2073 656c 6563 7428 2e63 6869 6c64 7265   select(.childre
-000247c0: 6e20 3d3d 206e 756c 6c20 616e 6420 2e66  n == null and .f
-000247d0: 7374 7970 6520 3d3d 206e 756c 6c29 207c  stype == null) |
-000247e0: 2022 2f64 6576 2f22 202b 202e 6e61 6d65   "/dev/" + .name
-000247f0: 2729 0a20 2020 2020 2020 206e 756d 6469  ').        numdi
-00024800: 736b 3d24 2865 6368 6f20 2462 6967 6469  sk=$(echo $bigdi
-00024810: 736b 7320 7c20 7763 202d 7729 0a20 2020  sks | wc -w).   
-00024820: 2020 2020 206d 6b64 6972 202f 7265 7374       mkdir /rest
-00024830: 6f72 6564 0a20 2020 2020 2020 2069 6620  ored.        if 
-00024840: 5b5b 2024 6e75 6d64 6973 6b20 2d67 7420  [[ $numdisk -gt 
-00024850: 3120 5d5d 3b20 7468 656e 0a20 2020 2020  1 ]]; then.     
-00024860: 2020 2020 206d 6461 646d 202d 2d63 7265       mdadm --cre
-00024870: 6174 6520 2f64 6576 2f6d 6430 202d 2d6c  ate /dev/md0 --l
-00024880: 6576 656c 3d30 202d 2d72 6169 642d 6465  evel=0 --raid-de
-00024890: 7669 6365 733d 246e 756d 6469 736b 2024  vices=$numdisk $
-000248a0: 6269 6764 6973 6b73 0a20 2020 2020 2020  bigdisks.       
-000248b0: 2020 206d 6b66 7320 2d74 2078 6673 202f     mkfs -t xfs /
-000248c0: 6465 762f 6d64 300a 2020 2020 2020 2020  dev/md0.        
-000248d0: 2020 6d6f 756e 7420 2f64 6576 2f6d 6430    mount /dev/md0
-000248e0: 202f 7265 7374 6f72 6564 0a20 2020 2020   /restored.     
-000248f0: 2020 2065 6c69 6620 5b5b 2024 6e75 6d64     elif [[ $numd
-00024900: 6973 6b20 2d65 7120 3120 5d5d 3b20 7468  isk -eq 1 ]]; th
-00024910: 656e 0a20 2020 2020 2020 2020 206d 6b66  en.          mkf
-00024920: 7320 2d74 2078 6673 2024 6269 6764 6973  s -t xfs $bigdis
-00024930: 6b73 0a20 2020 2020 2020 2020 206d 6f75  ks.          mou
-00024940: 6e74 2024 6269 6764 6973 6b73 202f 7265  nt $bigdisks /re
-00024950: 7374 6f72 6564 0a20 2020 2020 2020 2066  stored.        f
-00024960: 690a 2020 2020 2020 2020 6368 6f77 6e20  i.        chown 
-00024970: 6563 322d 7573 6572 202f 7265 7374 6f72  ec2-user /restor
-00024980: 6564 0a20 2020 2020 2020 2064 6e66 2063  ed.        dnf c
-00024990: 6865 636b 2d75 7064 6174 650a 2020 2020  heck-update.    
-000249a0: 2020 2020 646e 6620 7570 6461 7465 202d      dnf update -
-000249b0: 790a 2020 2020 2020 2020 646e 6620 696e  y.        dnf in
-000249c0: 7374 616c 6c20 2d79 2061 7420 6763 6320  stall -y at gcc 
-000249d0: 7669 6d20 7767 6574 2070 7974 686f 6e33  vim wget python3
-000249e0: 2d70 6970 2070 7974 686f 6e33 2d70 7375  -pip python3-psu
-000249f0: 7469 6c0a 2020 2020 2020 2020 686f 7374  til.        host
-00024a00: 6e61 6d65 6374 6c20 7365 742d 686f 7374  namectl set-host
-00024a10: 6e61 6d65 2066 726f 7374 6572 0a20 2020  name froster.   
-00024a20: 2020 2020 2074 696d 6564 6174 6563 746c       timedatectl
-00024a30: 2073 6574 2d74 696d 657a 6f6e 6520 277b   set-timezone '{
-00024a40: 6c6f 6e67 5f74 696d 657a 6f6e 657d 270a  long_timezone}'.
-00024a50: 2020 2020 2020 2020 6c6f 6769 6e63 746c          loginctl
-00024a60: 2065 6e61 626c 652d 6c69 6e67 6572 2065   enable-linger e
-00024a70: 6332 2d75 7365 720a 2020 2020 2020 2020  c2-user.        
-00024a80: 7379 7374 656d 6374 6c20 7374 6172 7420  systemctl start 
-00024a90: 6174 640a 2020 2020 2020 2020 646e 6620  atd.        dnf 
-00024aa0: 7570 6772 6164 650a 2020 2020 2020 2020  upgrade.        
-00024ab0: 646e 6620 696e 7374 616c 6c20 2d79 206d  dnf install -y m
-00024ac0: 6320 6769 7420 646f 636b 6572 206c 7561  c git docker lua
-00024ad0: 206c 7561 2d70 6f73 6978 206c 7561 2d64   lua-posix lua-d
-00024ae0: 6576 656c 2074 636c 2d64 6576 656c 206e  evel tcl-devel n
-00024af0: 6f64 656a 732d 6e70 6d0a 2020 2020 2020  odejs-npm.      
-00024b00: 2020 646e 6620 6772 6f75 7020 696e 7374    dnf group inst
-00024b10: 616c 6c20 2d79 2027 4465 7665 6c6f 706d  all -y 'Developm
-00024b20: 656e 7420 546f 6f6c 7327 0a20 2020 2020  ent Tools'.     
-00024b30: 2020 2063 6420 2f74 6d70 0a20 2020 2020     cd /tmp.     
-00024b40: 2020 2077 6765 7420 6874 7470 733a 2f2f     wget https://
-00024b50: 736f 7572 6365 666f 7267 652e 6e65 742f  sourceforge.net/
-00024b60: 7072 6f6a 6563 7473 2f6c 6d6f 642f 6669  projects/lmod/fi
-00024b70: 6c65 732f 4c6d 6f64 2d38 2e37 2e74 6172  les/Lmod-8.7.tar
-00024b80: 2e62 7a32 0a20 2020 2020 2020 2074 6172  .bz2.        tar
-00024b90: 202d 786a 6620 4c6d 6f64 2d38 2e37 2e74   -xjf Lmod-8.7.t
-00024ba0: 6172 2e62 7a32 0a20 2020 2020 2020 2063  ar.bz2.        c
-00024bb0: 6420 4c6d 6f64 2d38 2e37 2026 2620 2e2f  d Lmod-8.7 && ./
-00024bc0: 636f 6e66 6967 7572 6520 2626 206d 616b  configure && mak
-00024bd0: 6520 696e 7374 616c 6c0a 2020 2020 2020  e install.      
-00024be0: 2020 2727 2729 2e73 7472 6970 2829 0a20    ''').strip(). 
-00024bf0: 2020 2020 2020 2072 6574 7572 6e20 7573         return us
-00024c00: 6572 6461 7461 0a0a 2020 2020 6465 6620  erdata..    def 
-00024c10: 5f65 6332 5f75 7365 725f 7370 6163 655f  _ec2_user_space_
-00024c20: 7363 7269 7074 2873 656c 662c 2069 6e73  script(self, ins
-00024c30: 7461 6e63 655f 6964 3d27 272c 2062 7363  tance_id='', bsc
-00024c40: 7269 7074 3d27 7e2f 626f 6f74 7374 7261  ript='~/bootstra
-00024c50: 702e 7368 2729 3a0a 2020 2020 2020 2020  p.sh'):.        
-00024c60: 2320 4465 6669 6e65 2073 6372 6970 7420  # Define script 
-00024c70: 7468 6174 2077 696c 6c20 6265 2069 6e73  that will be ins
-00024c80: 7461 6c6c 6564 2062 7920 6563 322d 7573  talled by ec2-us
-00024c90: 6572 0a0a 2020 2020 2020 2020 2320 544f  er..        # TO
-00024ca0: 444f 3a20 5265 706c 6963 6174 6520 7468  DO: Replicate th
-00024cb0: 6520 636f 6e66 6967 7572 6174 696f 6e20  e configuration 
-00024cc0: 6f66 2074 6865 2075 7365 7220 7370 6163  of the user spac
-00024cd0: 6520 7363 7269 7074 0a0a 2020 2020 2020  e script..      
-00024ce0: 2020 2320 7368 6f72 745f 7469 6d65 7a6f    # short_timezo
-00024cf0: 6e65 203d 2064 6174 6574 696d 652e 6461  ne = datetime.da
-00024d00: 7465 7469 6d65 2e6e 6f77 2829 2e61 7374  tetime.now().ast
-00024d10: 696d 657a 6f6e 6528 292e 747a 696e 666f  imezone().tzinfo
-00024d20: 0a20 2020 2020 2020 206c 6f6e 675f 7469  .        long_ti
-00024d30: 6d65 7a6f 6e65 203d 2073 656c 662e 6765  mezone = self.ge
-00024d40: 745f 7469 6d65 5f7a 6f6e 6528 290a 2020  t_time_zone().  
-00024d50: 2020 2020 2020 7265 7475 726e 2074 6578        return tex
-00024d60: 7477 7261 702e 6465 6465 6e74 2866 2727  twrap.dedent(f''
-00024d70: 270a 2020 2020 2020 2020 2321 202f 6269  '.        #! /bi
-00024d80: 6e2f 6261 7368 0a20 2020 2020 2020 206d  n/bash.        m
-00024d90: 6b64 6972 202d 7020 7e2f 2e66 726f 7374  kdir -p ~/.frost
-00024da0: 6572 2f63 6f6e 6669 670a 2020 2020 2020  er/config.      
-00024db0: 2020 736c 6565 7020 3320 2320 6769 7665    sleep 3 # give
-00024dc0: 2075 7320 736f 6d65 2074 696d 6520 746f   us some time to
-00024dd0: 2075 706c 6f61 6420 6a73 6f6e 2074 6f20   upload json to 
-00024de0: 7e2f 2e66 726f 7374 6572 2f63 6f6e 6669  ~/.froster/confi
-00024df0: 670a 2020 2020 2020 2020 6563 686f 2027  g.        echo '
-00024e00: 5053 313d 225c 5c75 4066 726f 7374 6572  PS1="\\u@froster
-00024e10: 3a5c 5c77 2420 2227 203e 3e20 7e2f 2e62  :\\w$ "' >> ~/.b
-00024e20: 6173 6872 630a 2020 2020 2020 2020 6563  ashrc.        ec
-00024e30: 686f 2027 2365 7870 6f72 7420 4543 325f  ho '#export EC2_
-00024e40: 494e 5354 414e 4345 5f49 443d 7b69 6e73  INSTANCE_ID={ins
-00024e50: 7461 6e63 655f 6964 7d27 203e 3e20 7e2f  tance_id}' >> ~/
-00024e60: 2e62 6173 6872 630a 2020 2020 2020 2020  .bashrc.        
-00024e70: 6563 686f 2027 2365 7870 6f72 7420 4157  echo '#export AW
-00024e80: 535f 4445 4641 554c 545f 5245 4749 4f4e  S_DEFAULT_REGION
-00024e90: 3d7b 7365 6c66 2e63 6667 2e61 7773 5f72  ={self.cfg.aws_r
-00024ea0: 6567 696f 6e7d 2720 3e3e 207e 2f2e 6261  egion}' >> ~/.ba
-00024eb0: 7368 7263 0a20 2020 2020 2020 2065 6368  shrc.        ech
-00024ec0: 6f20 2723 6578 706f 7274 2054 5a3d 7b6c  o '#export TZ={l
-00024ed0: 6f6e 675f 7469 6d65 7a6f 6e65 7d27 203e  ong_timezone}' >
-00024ee0: 3e20 7e2f 2e62 6173 6872 630a 2020 2020  > ~/.bashrc.    
-00024ef0: 2020 2020 6563 686f 2027 2361 6c69 6173      echo '#alias
-00024f00: 2073 696e 6775 6c61 7269 7479 3d22 6170   singularity="ap
-00024f10: 7074 6169 6e65 7222 2720 3e3e 207e 2f2e  ptainer"' >> ~/.
-00024f20: 6261 7368 7263 0a20 2020 2020 2020 2063  bashrc.        c
-00024f30: 6420 2f74 6d70 0a20 2020 2020 2020 2063  d /tmp.        c
-00024f40: 7572 6c20 6874 7470 733a 2f2f 7261 772e  url https://raw.
-00024f50: 6769 7468 7562 7573 6572 636f 6e74 656e  githubuserconten
-00024f60: 742e 636f 6d2f 6469 726b 7065 7465 7273  t.com/dirkpeters
-00024f70: 656e 2f66 726f 7374 6572 2f6d 6169 6e2f  en/froster/main/
-00024f80: 696e 7374 616c 6c2e 7368 207c 2062 6173  install.sh | bas
-00024f90: 680a 2020 2020 2020 2020 6672 6f73 7465  h.        froste
-00024fa0: 7220 636f 6e66 6967 202d 2d6d 6f6e 6974  r config --monit
-00024fb0: 6f72 0a20 2020 2020 2020 2061 7773 2063  or.        aws c
-00024fc0: 6f6e 6669 6775 7265 2073 6574 2061 7773  onfigure set aws
-00024fd0: 5f61 6363 6573 735f 6b65 795f 6964 207b  _access_key_id {
-00024fe0: 6f73 2e65 6e76 6972 6f6e 5b27 4157 535f  os.environ['AWS_
-00024ff0: 4143 4345 5353 5f4b 4559 5f49 4427 5d7d  ACCESS_KEY_ID']}
-00025000: 0a20 2020 2020 2020 2061 7773 2063 6f6e  .        aws con
-00025010: 6669 6775 7265 2073 6574 2061 7773 5f73  figure set aws_s
-00025020: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
-00025030: 207b 6f73 2e65 6e76 6972 6f6e 5b27 4157   {os.environ['AW
-00025040: 535f 5345 4352 4554 5f41 4343 4553 535f  S_SECRET_ACCESS_
-00025050: 4b45 5927 5d7d 0a20 2020 2020 2020 2061  KEY']}.        a
-00025060: 7773 2063 6f6e 6669 6775 7265 2073 6574  ws configure set
-00025070: 2072 6567 696f 6e20 7b73 656c 662e 6366   region {self.cf
-00025080: 672e 6177 735f 7265 6769 6f6e 7d0a 2020  g.aws_region}.  
-00025090: 2020 2020 2020 6177 7320 636f 6e66 6967        aws config
-000250a0: 7572 6520 2d2d 7072 6f66 696c 6520 7b73  ure --profile {s
-000250b0: 656c 662e 6366 672e 6177 735f 7072 6f66  elf.cfg.aws_prof
-000250c0: 696c 657d 2073 6574 2061 7773 5f61 6363  ile} set aws_acc
-000250d0: 6573 735f 6b65 795f 6964 207b 6f73 2e65  ess_key_id {os.e
-000250e0: 6e76 6972 6f6e 5b27 4157 535f 4143 4345  nviron['AWS_ACCE
-000250f0: 5353 5f4b 4559 5f49 4427 5d7d 0a20 2020  SS_KEY_ID']}.   
-00025100: 2020 2020 2061 7773 2063 6f6e 6669 6775       aws configu
-00025110: 7265 202d 2d70 726f 6669 6c65 207b 7365  re --profile {se
-00025120: 6c66 2e63 6667 2e61 7773 5f70 726f 6669  lf.cfg.aws_profi
-00025130: 6c65 7d20 7365 7420 6177 735f 7365 6372  le} set aws_secr
-00025140: 6574 5f61 6363 6573 735f 6b65 7920 7b6f  et_access_key {o
-00025150: 732e 656e 7669 726f 6e5b 2741 5753 5f53  s.environ['AWS_S
-00025160: 4543 5245 545f 4143 4345 5353 5f4b 4559  ECRET_ACCESS_KEY
-00025170: 275d 7d0a 2020 2020 2020 2020 6177 7320  ']}.        aws 
-00025180: 636f 6e66 6967 7572 6520 2d2d 7072 6f66  configure --prof
-00025190: 696c 6520 7b73 656c 662e 6366 672e 6177  ile {self.cfg.aw
-000251a0: 735f 7072 6f66 696c 657d 2073 6574 2072  s_profile} set r
-000251b0: 6567 696f 6e20 7b73 656c 662e 6366 672e  egion {self.cfg.
-000251c0: 6177 735f 7265 6769 6f6e 7d0a 2020 2020  aws_region}.    
-000251d0: 2020 2020 7079 7468 6f6e 3320 2d6d 2070      python3 -m p
-000251e0: 6970 2069 6e73 7461 6c6c 2062 6f74 6f33  ip install boto3
-000251f0: 0a20 2020 2020 2020 2073 6564 202d 6920  .        sed -i 
-00025200: 2773 2f61 7773 5f61 6363 6573 735f 6b65  's/aws_access_ke
-00025210: 795f 6964 205b 5e20 5d2a 2f61 7773 5f61  y_id [^ ]*/aws_a
-00025220: 6363 6573 735f 6b65 795f 6964 202f 2720  ccess_key_id /' 
-00025230: 7b62 7363 7269 7074 7d0a 2020 2020 2020  {bscript}.      
-00025240: 2020 7365 6420 2d69 2027 732f 6177 735f    sed -i 's/aws_
-00025250: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
-00025260: 7920 5b5e 205d 2a2f 6177 735f 7365 6372  y [^ ]*/aws_secr
-00025270: 6574 5f61 6363 6573 735f 6b65 7920 2f27  et_access_key /'
-00025280: 207b 6273 6372 6970 747d 0a20 2020 2020   {bscript}.     
-00025290: 2020 2063 7572 6c20 2d73 2068 7474 7073     curl -s https
-000252a0: 3a2f 2f72 6177 2e67 6974 6875 6275 7365  ://raw.githubuse
-000252b0: 7263 6f6e 7465 6e74 2e63 6f6d 2f61 7070  rcontent.com/app
-000252c0: 7461 696e 6572 2f61 7070 7461 696e 6572  tainer/apptainer
-000252d0: 2f6d 6169 6e2f 746f 6f6c 732f 696e 7374  /main/tools/inst
-000252e0: 616c 6c2d 756e 7072 6976 696c 6567 6564  all-unprivileged
-000252f0: 2e73 6820 7c20 6261 7368 202d 7320 2d20  .sh | bash -s - 
-00025300: 7e2f 2e6c 6f63 616c 0a20 2020 2020 2020  ~/.local.       
-00025310: 2063 7572 6c20 2d4f 6b4c 2068 7474 7073   curl -OkL https
-00025320: 3a2f 2f72 6570 6f2e 616e 6163 6f6e 6461  ://repo.anaconda
-00025330: 2e63 6f6d 2f6d 696e 6963 6f6e 6461 2f4d  .com/miniconda/M
-00025340: 696e 6963 6f6e 6461 332d 6c61 7465 7374  iniconda3-latest
-00025350: 2d4c 696e 7578 2d78 3836 5f36 342e 7368  -Linux-x86_64.sh
-00025360: 0a20 2020 2020 2020 2062 6173 6820 4d69  .        bash Mi
-00025370: 6e69 636f 6e64 6133 2d6c 6174 6573 742d  niconda3-latest-
-00025380: 4c69 6e75 782d 7838 365f 3634 2e73 6820  Linux-x86_64.sh 
-00025390: 2d62 0a20 2020 2020 2020 207e 2f6d 696e  -b.        ~/min
-000253a0: 6963 6f6e 6461 332f 6269 6e2f 636f 6e64  iconda3/bin/cond
-000253b0: 6120 696e 6974 2062 6173 680a 2020 2020  a init bash.    
-000253c0: 2020 2020 736f 7572 6365 207e 2f2e 6261      source ~/.ba
-000253d0: 7368 7263 0a20 2020 2020 2020 2063 6f6e  shrc.        con
-000253e0: 6461 2061 6374 6976 6174 650a 2020 2020  da activate.    
-000253f0: 2020 2020 6563 686f 2027 2321 202f 6269      echo '#! /bi
-00025400: 6e2f 6261 7368 2720 3e20 7e2f 2e6c 6f63  n/bash' > ~/.loc
-00025410: 616c 2f62 696e 2f67 6574 2d70 7562 6c69  al/bin/get-publi
-00025420: 632d 6970 0a20 2020 2020 2020 2065 6368  c-ip.        ech
-00025430: 6f20 2745 544f 4b45 4e3d 2428 6375 726c  o 'ETOKEN=$(curl
-00025440: 202d 7358 2050 5554 2022 6874 7470 3a2f   -sX PUT "http:/
-00025450: 2f31 3639 2e32 3534 2e31 3639 2e32 3534  /169.254.169.254
-00025460: 2f6c 6174 6573 742f 6170 692f 746f 6b65  /latest/api/toke
-00025470: 6e22 202d 4820 2258 2d61 7773 2d65 6332  n" -H "X-aws-ec2
-00025480: 2d6d 6574 6164 6174 612d 746f 6b65 6e2d  -metadata-token-
-00025490: 7474 6c2d 7365 636f 6e64 733a 2032 3136  ttl-seconds: 216
-000254a0: 3030 2229 2720 3e3e 207e 2f2e 6c6f 6361  00")' >> ~/.loca
-000254b0: 6c2f 6269 6e2f 6765 742d 7075 626c 6963  l/bin/get-public
-000254c0: 2d69 700a 2020 2020 2020 2020 6370 202d  -ip.        cp -
-000254d0: 6620 7e2f 2e6c 6f63 616c 2f62 696e 2f67  f ~/.local/bin/g
-000254e0: 6574 2d70 7562 6c69 632d 6970 207e 2f2e  et-public-ip ~/.
-000254f0: 6c6f 6361 6c2f 6269 6e2f 6765 742d 6c6f  local/bin/get-lo
-00025500: 6361 6c2d 6970 0a20 2020 2020 2020 2065  cal-ip.        e
-00025510: 6368 6f20 2763 7572 6c20 2d73 4820 2258  cho 'curl -sH "X
-00025520: 2d61 7773 2d65 6332 2d6d 6574 6164 6174  -aws-ec2-metadat
-00025530: 612d 746f 6b65 6e3a 2024 4554 4f4b 454e  a-token: $ETOKEN
-00025540: 2220 6874 7470 3a2f 2f31 3639 2e32 3534  " http://169.254
-00025550: 2e31 3639 2e32 3534 2f6c 6174 6573 742f  .169.254/latest/
-00025560: 6d65 7461 2d64 6174 612f 7075 626c 6963  meta-data/public
-00025570: 2d69 7076 3427 203e 3e20 7e2f 2e6c 6f63  -ipv4' >> ~/.loc
-00025580: 616c 2f62 696e 2f67 6574 2d70 7562 6c69  al/bin/get-publi
-00025590: 632d 6970 0a20 2020 2020 2020 2065 6368  c-ip.        ech
-000255a0: 6f20 2763 7572 6c20 2d73 4820 2258 2d61  o 'curl -sH "X-a
-000255b0: 7773 2d65 6332 2d6d 6574 6164 6174 612d  ws-ec2-metadata-
-000255c0: 746f 6b65 6e3a 2024 4554 4f4b 454e 2220  token: $ETOKEN" 
-000255d0: 6874 7470 3a2f 2f31 3639 2e32 3534 2e31  http://169.254.1
-000255e0: 3639 2e32 3534 2f6c 6174 6573 742f 6d65  69.254/latest/me
-000255f0: 7461 2d64 6174 612f 6c6f 6361 6c2d 6970  ta-data/local-ip
-00025600: 7634 2720 3e3e 207e 2f2e 6c6f 6361 6c2f  v4' >> ~/.local/
-00025610: 6269 6e2f 6765 742d 6c6f 6361 6c2d 6970  bin/get-local-ip
-00025620: 0a20 2020 2020 2020 2063 686d 6f64 202b  .        chmod +
-00025630: 7820 7e2f 2e6c 6f63 616c 2f62 696e 2f67  x ~/.local/bin/g
-00025640: 6574 2d70 7562 6c69 632d 6970 0a20 2020  et-public-ip.   
-00025650: 2020 2020 2063 686d 6f64 202b 7820 7e2f       chmod +x ~/
-00025660: 2e6c 6f63 616c 2f62 696e 2f67 6574 2d6c  .local/bin/get-l
-00025670: 6f63 616c 2d69 700a 2020 2020 2020 2020  ocal-ip.        
-00025680: 7e2f 6d69 6e69 636f 6e64 6133 2f62 696e  ~/miniconda3/bin
-00025690: 2f63 6f6e 6461 2069 6e73 7461 6c6c 202d  /conda install -
-000256a0: 7920 6a75 7079 7465 726c 6162 0a20 2020  y jupyterlab.   
-000256b0: 2020 2020 207e 2f6d 696e 6963 6f6e 6461       ~/miniconda
-000256c0: 332f 6269 6e2f 636f 6e64 6120 696e 7374  3/bin/conda inst
-000256d0: 616c 6c20 2d79 202d 6320 7220 722d 6972  all -y -c r r-ir
-000256e0: 6b65 726e 656c 2072 2023 2052 206b 6572  kernel r # R ker
-000256f0: 6e65 6c20 616e 6420 5220 666f 7220 4a75  nel and R for Ju
-00025700: 7079 7465 720a 2020 2020 2020 2020 636f  pyter.        co
-00025710: 6e64 6120 7275 6e20 6261 7368 202d 6320  nda run bash -c 
-00025720: 227e 2f6d 696e 6963 6f6e 6461 332f 6269  "~/miniconda3/bi
-00025730: 6e2f 6a75 7079 7465 722d 6c61 6220 2d2d  n/jupyter-lab --
-00025740: 6970 3d24 2867 6574 2d6c 6f63 616c 2d69  ip=$(get-local-i
-00025750: 7029 202d 2d6e 6f2d 6272 6f77 7365 7220  p) --no-browser 
-00025760: 2d2d 6175 746f 7265 6c6f 6164 202d 2d6e  --autoreload --n
-00025770: 6f74 6562 6f6f 6b2d 6469 723d 7e20 3e20  otebook-dir=~ > 
-00025780: 7e2f 2e6a 7570 7974 6572 2e6c 6f67 2032  ~/.jupyter.log 2
-00025790: 3e26 3122 2026 0a20 2020 2020 2020 2073  >&1" &.        s
-000257a0: 6c65 6570 2036 300a 2020 2020 2020 2020  leep 60.        
-000257b0: 7365 6420 2273 2f24 2867 6574 2d6c 6f63  sed "s/$(get-loc
-000257c0: 616c 2d69 7029 2f24 2867 6574 2d70 7562  al-ip)/$(get-pub
-000257d0: 6c69 632d 6970 292f 6722 207e 2f2e 6a75  lic-ip)/g" ~/.ju
-000257e0: 7079 7465 722e 6c6f 6720 3e20 7e2f 2e6a  pyter.log > ~/.j
-000257f0: 7570 7974 6572 2d70 7562 6c69 632e 6c6f  upyter-public.lo
-00025800: 670a 2020 2020 2020 2020 6563 686f 2027  g.        echo '
-00025810: 7465 7374 202d 6420 2f75 7372 2f6c 6f63  test -d /usr/loc
-00025820: 616c 2f6c 6d6f 642f 6c6d 6f64 2f69 6e69  al/lmod/lmod/ini
-00025830: 7420 2626 2073 6f75 7263 6520 2f75 7372  t && source /usr
-00025840: 2f6c 6f63 616c 2f6c 6d6f 642f 6c6d 6f64  /local/lmod/lmod
-00025850: 2f69 6e69 742f 6261 7368 2720 3e3e 207e  /init/bash' >> ~
-00025860: 2f2e 6261 7368 7263 0a20 2020 2020 2020  /.bashrc.       
-00025870: 2065 6368 6f20 2222 203e 3e20 7e2f 2e62   echo "" >> ~/.b
-00025880: 6173 685f 7072 6f66 696c 650a 2020 2020  ash_profile.    
-00025890: 2020 2020 6563 686f 2027 6563 686f 2022      echo 'echo "
-000258a0: 4163 6365 7373 204a 7570 7974 6572 4c61  Access JupyterLa
-000258b0: 623a 2227 203e 3e20 7e2f 2e62 6173 685f  b:"' >> ~/.bash_
-000258c0: 7072 6f66 696c 650a 2020 2020 2020 2020  profile.        
-000258d0: 7572 6c3d 2428 7461 696c 202d 6e20 3720  url=$(tail -n 7 
-000258e0: 7e2f 2e6a 7570 7974 6572 2d70 7562 6c69  ~/.jupyter-publi
-000258f0: 632e 6c6f 6720 7c20 6772 6570 2024 2867  c.log | grep $(g
-00025900: 6574 2d70 7562 6c69 632d 6970 2920 7c20  et-public-ip) | 
-00025910: 2074 7220 2d64 2027 2027 290a 2020 2020   tr -d ' ').    
-00025920: 2020 2020 6563 686f 2022 6563 686f 205c      echo "echo \
-00025930: 5c22 2024 7572 6c5c 5c22 2220 3e3e 207e  \" $url\\"" >> ~
-00025940: 2f2e 6261 7368 5f70 726f 6669 6c65 0a20  /.bash_profile. 
-00025950: 2020 2020 2020 2065 6368 6f20 2765 6368         echo 'ech
-00025960: 6f20 2274 7970 6520 5c5c 2263 6f6e 6461  o "type \\"conda
-00025970: 2064 6561 6374 6976 6174 655c 5c22 2074   deactivate\\" t
-00025980: 6f20 6c65 6176 6520 6375 7272 656e 7420  o leave current 
-00025990: 636f 6e64 6120 656e 7669 726f 6e6d 656e  conda environmen
-000259a0: 7422 2720 3e3e 207e 2f2e 6261 7368 5f70  t"' >> ~/.bash_p
-000259b0: 726f 6669 6c65 0a20 2020 2020 2020 2027  rofile.        '
-000259c0: 2727 292e 7374 7269 7028 290a 0a20 2020  '').strip()..   
-000259d0: 2064 6566 205f 6563 325f 6372 6561 7465   def _ec2_create
-000259e0: 5f69 6e73 7461 6e63 6528 7365 6c66 2c20  _instance(self, 
-000259f0: 7265 7175 6972 6564 5f73 7061 6365 2c20  required_space, 
-00025a00: 6961 6d70 726f 6669 6c65 3d4e 6f6e 6529  iamprofile=None)
-00025a10: 3a0a 2020 2020 2020 2020 2320 746f 2061  :.        # to a
-00025a20: 766f 6964 2065 6772 6573 7320 7765 2061  void egress we a
-00025a30: 7265 2063 7265 6174 696e 6720 616e 2045  re creating an E
-00025a40: 4332 2069 6e73 7461 6e63 650a 2020 2020  C2 instance.    
-00025a50: 2020 2020 2320 7769 7468 2065 7068 656d      # with ephem
-00025a60: 6572 616c 2028 6c6f 6361 6c29 2064 6973  eral (local) dis
-00025a70: 6b20 666f 7220 6120 7465 6d70 6f72 6172  k for a temporar
-00025a80: 7920 7265 7374 6f72 650a 2020 2020 2020  y restore.      
-00025a90: 2020 230a 2020 2020 2020 2020 2320 6933    #.        # i3
-00025aa0: 656e 2e32 3478 6c61 7267 652c 2039 3620  en.24xlarge, 96 
-00025ab0: 7663 7075 2c20 3630 5469 4220 666f 7220  vcpu, 60TiB for 
-00025ac0: 2431 302e 3835 0a20 2020 2020 2020 2023  $10.85.        #
-00025ad0: 2069 3365 6e2e 3132 786c 6172 6765 2c20   i3en.12xlarge, 
-00025ae0: 3438 2076 6370 752c 2033 3054 6942 2066  48 vcpu, 30TiB f
-00025af0: 6f72 2024 352e 3432 0a20 2020 2020 2020  or $5.42.       
-00025b00: 2023 2069 3365 6e2e 3678 6c61 7267 652c   # i3en.6xlarge,
-00025b10: 2032 3420 7663 7075 2c20 3135 5469 4220   24 vcpu, 15TiB 
-00025b20: 666f 7220 2432 2e37 310a 2020 2020 2020  for $2.71.      
-00025b30: 2020 2320 6933 656e 2e33 786c 6172 6765    # i3en.3xlarge
-00025b40: 2c20 3132 2076 6370 752c 2037 2e35 5469  , 12 vcpu, 7.5Ti
-00025b50: 6220 666f 7220 2431 2e33 360a 2020 2020  b for $1.36.    
-00025b60: 2020 2020 2320 6933 656e 2e78 6c61 7267      # i3en.xlarg
-00025b70: 652c 2034 2076 6370 752c 2032 2e35 5469  e, 4 vcpu, 2.5Ti
-00025b80: 6220 666f 7220 2430 2e34 350a 2020 2020  b for $0.45.    
-00025b90: 2020 2020 2320 6933 656e 2e6c 6172 6765      # i3en.large
-00025ba0: 2c20 3220 7663 7075 2c20 312e 3235 5469  , 2 vcpu, 1.25Ti
-00025bb0: 6220 666f 7220 2430 2e32 320a 2020 2020  b for $0.22.    
-00025bc0: 2020 2020 2320 6335 6164 2e6c 6172 6765      # c5ad.large
-00025bd0: 2c20 3220 7663 7075 2c20 3735 4742 2c20  , 2 vcpu, 75GB, 
-00025be0: 666f 7220 2430 2e30 390a 0a20 2020 2020  for $0.09..     
-00025bf0: 2020 2069 6e73 7461 6e63 655f 7479 7065     instance_type
-00025c00: 7320 3d20 7b27 6933 656e 2e32 3478 6c61  s = {'i3en.24xla
-00025c10: 7267 6527 3a20 3630 3030 302c 0a20 2020  rge': 60000,.   
-00025c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c30: 2020 2020 2020 2027 6933 656e 2e31 3278         'i3en.12x
-00025c40: 6c61 7267 6527 3a20 3330 3030 302c 0a20  large': 30000,. 
-00025c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c60: 2020 2020 2020 2020 2027 6933 656e 2e36           'i3en.6
-00025c70: 786c 6172 6765 273a 2031 3530 3030 2c0a  xlarge': 15000,.
-00025c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c90: 2020 2020 2020 2020 2020 2769 3365 6e2e            'i3en.
-00025ca0: 3378 6c61 7267 6527 3a20 3735 3030 2c0a  3xlarge': 7500,.
-00025cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025cc0: 2020 2020 2020 2020 2020 2769 3365 6e2e            'i3en.
-00025cd0: 786c 6172 6765 273a 2032 3530 302c 0a20  xlarge': 2500,. 
-00025ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025cf0: 2020 2020 2020 2020 2027 6933 656e 2e6c           'i3en.l
-00025d00: 6172 6765 273a 2031 3235 302c 0a20 2020  arge': 1250,.   
-00025d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d20: 2020 2020 2020 2027 6335 6164 2e6c 6172         'c5ad.lar
-00025d30: 6765 273a 2037 352c 0a20 2020 2020 2020  ge': 75,.       
-00025d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d50: 2020 2027 7433 612e 6d69 6372 6f27 3a20     't3a.micro': 
-00025d60: 352c 0a20 2020 2020 2020 2020 2020 2020  5,.             
-00025d70: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-00025d80: 2020 2020 2020 2020 6563 325f 7265 736f          ec2_reso
-00025d90: 7572 6365 203d 2073 656c 662e 7365 7373  urce = self.sess
-00025da0: 696f 6e2e 7265 736f 7572 6365 2827 6563  ion.resource('ec
-00025db0: 3227 290a 0a20 2020 2020 2020 2069 6620  2')..        if 
-00025dc0: 7265 7175 6972 6564 5f73 7061 6365 203e  required_space >
-00025dd0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00025de0: 7265 7175 6972 6564 5f73 7061 6365 203d  required_space =
-00025df0: 2072 6571 7569 7265 645f 7370 6163 6520   required_space 
-00025e00: 2b20 3520 2023 2061 766f 6964 206c 6f77  + 5  # avoid low
-00025e10: 2064 6973 6b20 7370 6163 6520 696e 206d   disk space in m
-00025e20: 6963 726f 2069 6e73 7461 6e63 6573 0a20  icro instances. 
-00025e30: 2020 2020 2020 2063 686f 7365 6e5f 696e         chosen_in
-00025e40: 7374 616e 6365 5f74 7970 6520 3d20 4e6f  stance_type = No
-00025e50: 6e65 0a20 2020 2020 2020 2066 6f72 2069  ne.        for i
-00025e60: 7479 7065 2c20 7370 6163 6520 696e 2069  type, space in i
-00025e70: 6e73 7461 6e63 655f 7479 7065 732e 6974  nstance_types.it
-00025e80: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00025e90: 2020 2069 6620 7370 6163 6520 3e20 312e     if space > 1.
-00025ea0: 3520 2a20 7265 7175 6972 6564 5f73 7061  5 * required_spa
-00025eb0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00025ec0: 2020 2020 6368 6f73 656e 5f69 6e73 7461      chosen_insta
-00025ed0: 6e63 655f 7479 7065 203d 2069 7479 7065  nce_type = itype
-00025ee0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00025ef0: 662e 6172 6773 2e69 6e73 7461 6e63 6574  f.args.instancet
-00025f00: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
-00025f10: 2063 686f 7365 6e5f 696e 7374 616e 6365   chosen_instance
-00025f20: 5f74 7970 6520 3d20 7365 6c66 2e61 7267  _type = self.arg
-00025f30: 732e 696e 7374 616e 6365 7479 7065 0a20  s.instancetype. 
-00025f40: 2020 2020 2020 2070 7269 6e74 2827 4368         print('Ch
-00025f50: 6f73 656e 2049 6e73 7461 6e63 653a 272c  osen Instance:',
-00025f60: 2063 686f 7365 6e5f 696e 7374 616e 6365   chosen_instance
-00025f70: 5f74 7970 6529 0a0a 2020 2020 2020 2020  _type)..        
-00025f80: 6966 206e 6f74 2063 686f 7365 6e5f 696e  if not chosen_in
-00025f90: 7374 616e 6365 5f74 7970 653a 0a20 2020  stance_type:.   
-00025fa0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00025fb0: 4e6f 2073 7569 7461 626c 6520 696e 7374  No suitable inst
-00025fc0: 616e 6365 2074 7970 6520 666f 756e 6420  ance type found 
-00025fd0: 666f 7220 7468 6520 6769 7665 6e20 6469  for the given di
-00025fe0: 736b 2073 7061 6365 2072 6571 7569 7265  sk space require
-00025ff0: 6d65 6e74 2e22 290a 2020 2020 2020 2020  ment.").        
-00026000: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00026010: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-00026020: 7465 2061 206e 6577 2045 4332 206b 6579  te a new EC2 key
-00026030: 2070 6169 720a 2020 2020 2020 2020 6b65   pair.        ke
-00026040: 795f 6469 7220 3d20 7365 6c66 2e63 6667  y_dir = self.cfg
-00026050: 2e73 6861 7265 645f 6469 7220 6966 2073  .shared_dir if s
-00026060: 656c 662e 6366 672e 6973 5f73 6861 7265  elf.cfg.is_share
-00026070: 6420 656c 7365 2073 656c 662e 6366 672e  d else self.cfg.
-00026080: 636f 6e66 6967 5f64 6972 0a20 2020 2020  config_dir.     
-00026090: 2020 206b 6579 5f70 6174 6820 3d20 6f73     key_path = os
-000260a0: 2e70 6174 682e 6a6f 696e 286b 6579 5f64  .path.join(key_d
-000260b0: 6972 2c20 6627 7b73 656c 662e 6366 672e  ir, f'{self.cfg.
-000260c0: 7373 685f 6b65 795f 6e61 6d65 7d2e 7065  ssh_key_name}.pe
-000260d0: 6d27 290a 2020 2020 2020 2020 6966 206e  m').        if n
-000260e0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-000260f0: 7328 6b65 795f 7061 7468 293a 0a20 2020  s(key_path):.   
-00026100: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00026110: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00026120: 6c66 2e65 6332 5f63 6c69 656e 742e 6465  lf.ec2_client.de
-00026130: 7363 7269 6265 5f6b 6579 5f70 6169 7273  scribe_key_pairs
-00026140: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00026150: 2020 2020 2020 4b65 794e 616d 6573 3d5b        KeyNames=[
-00026160: 7365 6c66 2e63 6667 2e73 7368 5f6b 6579  self.cfg.ssh_key
-00026170: 5f6e 616d 655d 290a 2020 2020 2020 2020  _name]).        
-00026180: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00026190: 206b 6579 2070 6169 7220 6578 6973 7473   key pair exists
-000261a0: 2c20 6465 6c65 7465 2069 740a 2020 2020  , delete it.    
-000261b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000261c0: 2e65 6332 5f63 6c69 656e 742e 6465 6c65  .ec2_client.dele
-000261d0: 7465 5f6b 6579 5f70 6169 7228 4b65 794e  te_key_pair(KeyN
-000261e0: 616d 653d 7365 6c66 2e63 6667 2e73 7368  ame=self.cfg.ssh
-000261f0: 5f6b 6579 5f6e 616d 6529 0a20 2020 2020  _key_name).     
-00026200: 2020 2020 2020 2065 7863 6570 7420 7365         except se
-00026210: 6c66 2e65 6332 5f63 6c69 656e 742e 6578  lf.ec2_client.ex
-00026220: 6365 7074 696f 6e73 2e43 6c69 656e 7445  ceptions.ClientE
-00026230: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00026240: 2020 2020 2020 2320 4b65 7920 7061 6972        # Key pair
-00026250: 2064 6f65 736e 2774 2065 7869 7374 2069   doesn't exist i
-00026260: 6e20 4157 532c 206e 6f20 6e65 6564 2074  n AWS, no need t
-00026270: 6f20 6465 6c65 7465 0a20 2020 2020 2020  o delete.       
-00026280: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00026290: 2020 2020 2020 2020 2020 6b65 795f 7061            key_pa
-000262a0: 6972 203d 2065 6332 5f72 6573 6f75 7263  ir = ec2_resourc
-000262b0: 652e 6372 6561 7465 5f6b 6579 5f70 6169  e.create_key_pai
-000262c0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000262d0: 2020 204b 6579 4e61 6d65 3d73 656c 662e     KeyName=self.
-000262e0: 6366 672e 7373 685f 6b65 795f 6e61 6d65  cfg.ssh_key_name
-000262f0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-00026300: 7468 206f 7065 6e28 6b65 795f 7061 7468  th open(key_path
-00026310: 2c20 2777 2729 2061 7320 6b65 795f 6669  , 'w') as key_fi
-00026320: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00026330: 2020 2020 6b65 795f 6669 6c65 2e77 7269      key_file.wri
-00026340: 7465 286b 6579 5f70 6169 722e 6b65 795f  te(key_pair.key_
-00026350: 6d61 7465 7269 616c 290a 2020 2020 2020  material).      
-00026360: 2020 2020 2020 6f73 2e63 686d 6f64 286b        os.chmod(k
-00026370: 6579 5f70 6174 682c 2030 6f36 3430 2920  ey_path, 0o640) 
-00026380: 2023 2053 6574 2066 696c 6520 7065 726d   # Set file perm
-00026390: 6973 7369 6f6e 2074 6f20 3630 300a 0a20  ission to 600.. 
-000263a0: 2020 2020 2020 206d 796b 6579 5f70 6174         mykey_pat
-000263b0: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
-000263c0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-000263d0: 6c66 2e63 6667 2e73 6861 7265 645f 6469  lf.cfg.shared_di
-000263e0: 722c 2066 277b 7365 6c66 2e63 6667 2e73  r, f'{self.cfg.s
-000263f0: 7368 5f6b 6579 5f6e 616d 657d 2d7b 7365  sh_key_name}-{se
-00026400: 6c66 2e63 6667 2e77 686f 616d 697d 2e70  lf.cfg.whoami}.p
-00026410: 656d 2729 0a20 2020 2020 2020 2069 6620  em').        if 
-00026420: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00026430: 7473 286d 796b 6579 5f70 6174 6829 3a0a  ts(mykey_path):.
-00026440: 2020 2020 2020 2020 2020 2020 7368 7574              shut
-00026450: 696c 2e63 6f70 7966 696c 6528 6b65 795f  il.copyfile(key_
-00026460: 7061 7468 2c20 6d79 6b65 795f 7061 7468  path, mykey_path
-00026470: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
-00026480: 2e63 686d 6f64 286d 796b 6579 5f70 6174  .chmod(mykey_pat
-00026490: 682c 2030 6f36 3030 2920 2023 2053 6574  h, 0o600)  # Set
-000264a0: 2066 696c 6520 7065 726d 6973 7369 6f6e   file permission
-000264b0: 2074 6f20 3630 300a 0a20 2020 2020 2020   to 600..       
-000264c0: 2069 6d61 6765 6964 203d 2073 656c 662e   imageid = self.
-000264d0: 5f65 6332 5f67 6574 5f6c 6174 6573 745f  _ec2_get_latest_
-000264e0: 616d 617a 6f6e 5f6c 696e 7578 325f 616d  amazon_linux2_am
-000264f0: 6928 290a 2020 2020 2020 2020 7072 696e  i().        prin
-00026500: 7428 6627 5573 696e 6720 496d 6167 6520  t(f'Using Image 
-00026510: 4944 3a20 7b69 6d61 6765 6964 7d27 290a  ID: {imageid}').
-00026520: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-00026530: 2866 272a 2a2a 2075 7365 7264 6174 612d  (f'*** userdata-
-00026540: 7363 7269 7074 3a5c 6e7b 7365 6c66 2e5f  script:\n{self._
-00026550: 6563 325f 7573 6572 5f64 6174 615f 7363  ec2_user_data_sc
-00026560: 7269 7074 2829 7d27 290a 0a20 2020 2020  ript()}')..     
-00026570: 2020 2069 616d 5f69 6e73 7461 6e63 655f     iam_instance_
-00026580: 7072 6f66 696c 6520 3d20 7b7d 0a20 2020  profile = {}.   
-00026590: 2020 2020 2069 6620 6961 6d70 726f 6669       if iamprofi
-000265a0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-000265b0: 6961 6d5f 696e 7374 616e 6365 5f70 726f  iam_instance_pro
-000265c0: 6669 6c65 203d 207b 0a20 2020 2020 2020  file = {.       
-000265d0: 2020 2020 2020 2020 2027 4e61 6d65 273a           'Name':
-000265e0: 2069 616d 7072 6f66 696c 6520 2023 2055   iamprofile  # U
-000265f0: 7365 2074 6865 2069 6e73 7461 6e63 6520  se the instance 
-00026600: 7072 6f66 696c 6520 6e61 6d65 0a20 2020  profile name.   
-00026610: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00026620: 2020 2070 7269 6e74 2866 2749 414d 2049     print(f'IAM I
-00026630: 6e73 7461 6e63 6520 7072 6f66 696c 653a  nstance profile:
-00026640: 207b 6961 6d70 726f 6669 6c65 7d2e 2729   {iamprofile}.')
-00026650: 0a0a 2020 2020 2020 2020 2320 6961 6d5f  ..        # iam_
-00026660: 696e 7374 616e 6365 5f70 726f 6669 6c65  instance_profile
-00026670: 203d 207b 7d0a 0a20 2020 2020 2020 2074   = {}..        t
-00026680: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00026690: 2320 4372 6561 7465 2045 4332 2069 6e73  # Create EC2 ins
-000266a0: 7461 6e63 650a 2020 2020 2020 2020 2020  tance.          
-000266b0: 2020 696e 7374 616e 6365 203d 2065 6332    instance = ec2
-000266c0: 5f72 6573 6f75 7263 652e 6372 6561 7465  _resource.create
-000266d0: 5f69 6e73 7461 6e63 6573 280a 2020 2020  _instances(.    
-000266e0: 2020 2020 2020 2020 2020 2020 496d 6167              Imag
-000266f0: 6549 643d 696d 6167 6569 642c 0a20 2020  eId=imageid,.   
-00026700: 2020 2020 2020 2020 2020 2020 204d 696e               Min
-00026710: 436f 756e 743d 312c 0a20 2020 2020 2020  Count=1,.       
-00026720: 2020 2020 2020 2020 204d 6178 436f 756e           MaxCoun
-00026730: 743d 312c 0a20 2020 2020 2020 2020 2020  t=1,.           
-00026740: 2020 2020 2049 6e73 7461 6e63 6554 7970       InstanceTyp
-00026750: 653d 6368 6f73 656e 5f69 6e73 7461 6e63  e=chosen_instanc
-00026760: 655f 7479 7065 2c0a 2020 2020 2020 2020  e_type,.        
-00026770: 2020 2020 2020 2020 4b65 794e 616d 653d          KeyName=
-00026780: 7365 6c66 2e63 6667 2e73 7368 5f6b 6579  self.cfg.ssh_key
-00026790: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-000267a0: 2020 2020 2020 2055 7365 7244 6174 613d         UserData=
-000267b0: 7365 6c66 2e5f 6563 325f 636c 6f75 645f  self._ec2_cloud_
-000267c0: 696e 6974 5f73 6372 6970 7428 292c 0a20  init_script(),. 
-000267d0: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-000267e0: 616d 496e 7374 616e 6365 5072 6f66 696c  amInstanceProfil
-000267f0: 653d 6961 6d5f 696e 7374 616e 6365 5f70  e=iam_instance_p
-00026800: 726f 6669 6c65 2c0a 2020 2020 2020 2020  rofile,.        
-00026810: 2020 2020 2020 2020 5461 6753 7065 6369          TagSpeci
-00026820: 6669 6361 7469 6f6e 733d 5b0a 2020 2020  fications=[.    
+00014f00: 2020 2020 2020 2020 2746 726f 6d50 6f72          'FromPor
+00014f10: 7427 3a20 3830 3030 2c0a 2020 2020 2020  t': 8000,.      
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2020 2754 6f50 6f72 7427 3a20 3930 3030    'ToPort': 9000
+00014f40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014f50: 2020 2020 2020 2020 2020 2749 7052 616e            'IpRan
+00014f60: 6765 7327 3a20 5b7b 2743 6964 7249 7027  ges': [{'CidrIp'
+00014f70: 3a20 2730 2e30 2e30 2e30 2f30 277d 5d0a  : '0.0.0.0/0'}].
+00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f90: 2020 2020 7d2c 2020 2020 2020 2020 2020      },          
+00014fa0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+00014fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fc0: 2020 2020 2749 7050 726f 746f 636f 6c27      'IpProtocol'
+00014fd0: 3a20 2769 636d 7027 2c0a 2020 2020 2020  : 'icmp',.      
+00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ff0: 2020 2746 726f 6d50 6f72 7427 3a20 2d31    'FromPort': -1
+00015000: 2c20 2023 202d 3120 616c 6c6f 7773 2061  ,  # -1 allows a
+00015010: 6c6c 2049 434d 5020 7479 7065 730a 2020  ll ICMP types.  
+00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015030: 2020 2020 2020 2754 6f50 6f72 7427 3a20        'ToPort': 
+00015040: 2d31 2c0a 2020 2020 2020 2020 2020 2020  -1,.            
+00015050: 2020 2020 2020 2020 2020 2020 2749 7052              'IpR
+00015060: 616e 6765 7327 3a20 5b7b 2743 6964 7249  anges': [{'CidrI
+00015070: 7027 3a20 2730 2e30 2e30 2e30 2f30 277d  p': '0.0.0.0/0'}
+00015080: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00015090: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+000150a0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+000150b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000150c0: 2023 2041 7474 6163 6820 7468 6520 7365   # Attach the se
+000150d0: 6375 7269 7479 2067 726f 7570 2074 6f20  curity group to 
+000150e0: 7468 6520 696e 7374 616e 6365 0a20 2020  the instance.   
+000150f0: 2020 2020 2069 6e73 7461 6e63 6520 3d20       instance = 
+00015100: 6563 325f 7265 736f 7572 6365 2e49 6e73  ec2_resource.Ins
+00015110: 7461 6e63 6528 696e 7374 616e 6365 5f69  tance(instance_i
+00015120: 6429 0a20 2020 2020 2020 2063 7572 7265  d).        curre
+00015130: 6e74 5f73 6563 7572 6974 795f 6772 6f75  nt_security_grou
+00015140: 7073 203d 205b 7367 5b27 4772 6f75 7049  ps = [sg['GroupI
+00015150: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
+00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015170: 2020 2020 2020 2066 6f72 2073 6720 696e         for sg in
+00015180: 2069 6e73 7461 6e63 652e 7365 6375 7269   instance.securi
+00015190: 7479 5f67 726f 7570 735d 0a0a 2020 2020  ty_groups]..    
+000151a0: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+000151b0: 6865 2073 6563 7572 6974 7920 6772 6f75  he security grou
+000151c0: 7020 6973 2061 6c72 6561 6479 2061 7474  p is already att
+000151d0: 6163 6865 6420 746f 2074 6865 2069 6e73  ached to the ins
+000151e0: 7461 6e63 650a 2020 2020 2020 2020 6966  tance.        if
+000151f0: 2073 6563 7572 6974 795f 6772 6f75 705f   security_group_
+00015200: 6964 206e 6f74 2069 6e20 6375 7272 656e  id not in curren
+00015210: 745f 7365 6375 7269 7479 5f67 726f 7570  t_security_group
+00015220: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+00015230: 7572 7265 6e74 5f73 6563 7572 6974 795f  urrent_security_
+00015240: 6772 6f75 7073 2e61 7070 656e 6428 7365  groups.append(se
+00015250: 6375 7269 7479 5f67 726f 7570 5f69 6429  curity_group_id)
+00015260: 0a20 2020 2020 2020 2020 2020 2069 6e73  .            ins
+00015270: 7461 6e63 652e 6d6f 6469 6679 5f61 7474  tance.modify_att
+00015280: 7269 6275 7465 2847 726f 7570 733d 6375  ribute(Groups=cu
+00015290: 7272 656e 745f 7365 6375 7269 7479 5f67  rrent_security_g
+000152a0: 726f 7570 7329 0a0a 2020 2020 2020 2020  roups)..        
+000152b0: 7265 7475 726e 2073 6563 7572 6974 795f  return security_
+000152c0: 6772 6f75 705f 6964 0a0a 2020 2020 6465  group_id..    de
+000152d0: 6620 5f65 6332 5f67 6574 5f6c 6174 6573  f _ec2_get_lates
+000152e0: 745f 616d 617a 6f6e 5f6c 696e 7578 325f  t_amazon_linux2_
+000152f0: 616d 6928 7365 6c66 293a 0a0a 2020 2020  ami(self):..    
+00015300: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+00015310: 656c 662e 6563 325f 636c 6965 6e74 2e64  elf.ec2_client.d
+00015320: 6573 6372 6962 655f 696d 6167 6573 280a  escribe_images(.
+00015330: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
+00015340: 6572 733d 5b0a 2020 2020 2020 2020 2020  ers=[.          
+00015350: 2020 2020 2020 7b27 4e61 6d65 273a 2027        {'Name': '
+00015360: 6e61 6d65 272c 2027 5661 6c75 6573 273a  name', 'Values':
+00015370: 205b 2761 6c32 3032 332d 616d 692d 2a27   ['al2023-ami-*'
+00015380: 5d7d 2c0a 2020 2020 2020 2020 2020 2020  ]},.            
+00015390: 2020 2020 7b27 4e61 6d65 273a 2027 7374      {'Name': 'st
+000153a0: 6174 6527 2c20 2756 616c 7565 7327 3a20  ate', 'Values': 
+000153b0: 5b27 6176 6169 6c61 626c 6527 5d7d 2c0a  ['available']},.
+000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153d0: 7b27 4e61 6d65 273a 2027 6172 6368 6974  {'Name': 'archit
+000153e0: 6563 7475 7265 272c 2027 5661 6c75 6573  ecture', 'Values
+000153f0: 273a 205b 2778 3836 5f36 3427 5d7d 2c0a  ': ['x86_64']},.
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 7b27 4e61 6d65 273a 2027 7669 7274 7561  {'Name': 'virtua
+00015420: 6c69 7a61 7469 6f6e 2d74 7970 6527 2c20  lization-type', 
+00015430: 2756 616c 7565 7327 3a20 5b27 6876 6d27  'Values': ['hvm'
+00015440: 5d7d 0a20 2020 2020 2020 2020 2020 205d  ]}.            ]
+00015450: 2c0a 2020 2020 2020 2020 2020 2020 4f77  ,.            Ow
+00015460: 6e65 7273 3d5b 2761 6d61 7a6f 6e27 5d0a  ners=['amazon'].
+00015470: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+00015480: 6d7a 6e32 2d61 6d69 2d68 766d 2d32 2e30  mzn2-ami-hvm-2.0
+00015490: 2e2a 2d78 3836 5f36 342d 6770 320a 2020  .*-x86_64-gp2.  
+000154a0: 2020 2020 2020 2020 2020 2320 616c 3230            # al20
+000154b0: 3233 2d61 6d69 2d6b 6572 6e65 6c2d 6465  23-ami-kernel-de
+000154c0: 6661 756c 742d 7838 365f 3634 0a0a 2020  fault-x86_64..  
+000154d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000154e0: 2023 2053 6f72 7420 696d 6167 6573 2062   # Sort images b
+000154f0: 7920 6372 6561 7469 6f6e 2064 6174 6520  y creation date 
+00015500: 746f 2067 6574 2074 6865 206c 6174 6573  to get the lates
+00015510: 740a 2020 2020 2020 2020 696d 6167 6573  t.        images
+00015520: 203d 2073 6f72 7465 6428 7265 7370 6f6e   = sorted(respon
+00015530: 7365 5b27 496d 6167 6573 275d 2c0a 2020  se['Images'],.  
+00015540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015550: 2020 2020 2020 6b65 793d 6c61 6d62 6461        key=lambda
+00015560: 206b 3a20 6b5b 2743 7265 6174 696f 6e44   k: k['CreationD
+00015570: 6174 6527 5d2c 2072 6576 6572 7365 3d54  ate'], reverse=T
+00015580: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
+00015590: 696d 6167 6573 3a0a 2020 2020 2020 2020  images:.        
+000155a0: 2020 2020 7265 7475 726e 2069 6d61 6765      return image
+000155b0: 735b 305d 5b27 496d 6167 6549 6427 5d0a  s[0]['ImageId'].
+000155c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000155d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000155e0: 204e 6f6e 650a 0a20 2020 2064 6566 205f   None..    def _
+000155f0: 6372 6561 7465 5f70 726f 6772 6573 735f  create_progress_
+00015600: 6261 7228 7365 6c66 2c20 6d61 785f 7661  bar(self, max_va
+00015610: 6c75 6529 3a0a 2020 2020 2020 2020 6465  lue):.        de
+00015620: 6620 7368 6f77 5f70 726f 6772 6573 735f  f show_progress_
+00015630: 6261 7228 6974 6572 6174 696f 6e29 3a0a  bar(iteration):.
+00015640: 2020 2020 2020 2020 2020 2020 7065 7263              perc
+00015650: 656e 7420 3d20 2822 7b30 3a2e 3166 7d22  ent = ("{0:.1f}"
+00015660: 292e 666f 726d 6174 2831 3030 202a 2028  ).format(100 * (
+00015670: 6974 6572 6174 696f 6e20 2f20 666c 6f61  iteration / floa
+00015680: 7428 6d61 785f 7661 6c75 6529 2929 0a20  t(max_value))). 
+00015690: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
+000156a0: 6820 3d20 3530 2020 2320 6164 6a75 7374  h = 50  # adjust
+000156b0: 2061 7320 6e65 6564 6564 2066 6f72 2074   as needed for t
+000156c0: 6865 2062 6172 206c 656e 6774 680a 2020  he bar length.  
+000156d0: 2020 2020 2020 2020 2020 6669 6c6c 6564            filled
+000156e0: 5f6c 656e 6774 6820 3d20 696e 7428 6c65  _length = int(le
+000156f0: 6e67 7468 202a 2069 7465 7261 7469 6f6e  ngth * iteration
+00015700: 202f 2f20 6d61 785f 7661 6c75 6529 0a20   // max_value). 
+00015710: 2020 2020 2020 2020 2020 2062 6172 203d             bar =
+00015720: 2022 e296 8822 202a 2066 696c 6c65 645f   "..." * filled_
+00015730: 6c65 6e67 7468 202b 2027 2d27 202a 2028  length + '-' * (
+00015740: 6c65 6e67 7468 202d 2066 696c 6c65 645f  length - filled_
+00015750: 6c65 6e67 7468 290a 2020 2020 2020 2020  length).        
+00015760: 2020 2020 6966 2073 7973 2e73 7464 696e      if sys.stdin
+00015770: 2e69 7361 7474 7928 293a 0a20 2020 2020  .isatty():.     
+00015780: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00015790: 2866 275c 727c 7b62 6172 7d7c 207b 7065  (f'\r|{bar}| {pe
+000157a0: 7263 656e 747d 2527 2c20 656e 643d 275c  rcent}%', end='\
+000157b0: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
+000157c0: 6966 2069 7465 7261 7469 6f6e 203d 3d20  if iteration == 
+000157d0: 6d61 785f 7661 6c75 653a 0a20 2020 2020  max_value:.     
+000157e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000157f0: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00015800: 726e 2073 686f 775f 7072 6f67 7265 7373  rn show_progress
+00015810: 5f62 6172 0a0a 2020 2020 6465 6620 5f65  _bar..    def _e
+00015820: 6332 5f63 6c6f 7564 5f69 6e69 745f 7363  c2_cloud_init_sc
+00015830: 7269 7074 2873 656c 6629 3a0a 2020 2020  ript(self):.    
+00015840: 2020 2020 2320 4465 6669 6e65 2074 6865      # Define the
+00015850: 2055 7365 7220 4461 7461 2073 6372 6970   User Data scrip
+00015860: 740a 2020 2020 2020 2020 6c6f 6e67 5f74  t.        long_t
+00015870: 696d 657a 6f6e 6520 3d20 7365 6c66 2e67  imezone = self.g
+00015880: 6574 5f74 696d 655f 7a6f 6e65 2829 0a20  et_time_zone(). 
+00015890: 2020 2020 2020 2075 7365 7264 6174 6120         userdata 
+000158a0: 3d20 7465 7874 7772 6170 2e64 6564 656e  = textwrap.deden
+000158b0: 7428 6627 2727 0a20 2020 2020 2020 2023  t(f'''.        #
+000158c0: 2120 2f62 696e 2f62 6173 680a 2020 2020  ! /bin/bash.    
+000158d0: 2020 2020 646e 6620 696e 7374 616c 6c20      dnf install 
+000158e0: 2d79 2067 6363 206d 6461 646d 0a20 2020  -y gcc mdadm.   
+000158f0: 2020 2020 2062 6967 6469 736b 733d 2428       bigdisks=$(
+00015900: 6c73 626c 6b20 2d2d 6673 202d 2d6a 736f  lsblk --fs --jso
+00015910: 6e20 7c20 6a71 202d 7220 272e 626c 6f63  n | jq -r '.bloc
+00015920: 6b64 6576 6963 6573 5b5d 207c 2073 656c  kdevices[] | sel
+00015930: 6563 7428 2e63 6869 6c64 7265 6e20 3d3d  ect(.children ==
+00015940: 206e 756c 6c20 616e 6420 2e66 7374 7970   null and .fstyp
+00015950: 6520 3d3d 206e 756c 6c29 207c 2022 2f64  e == null) | "/d
+00015960: 6576 2f22 202b 202e 6e61 6d65 2729 0a20  ev/" + .name'). 
+00015970: 2020 2020 2020 206e 756d 6469 736b 3d24         numdisk=$
+00015980: 2865 6368 6f20 2462 6967 6469 736b 7320  (echo $bigdisks 
+00015990: 7c20 7763 202d 7729 0a20 2020 2020 2020  | wc -w).       
+000159a0: 206d 6b64 6972 202f 7265 7374 6f72 6564   mkdir /restored
+000159b0: 0a20 2020 2020 2020 2069 6620 5b5b 2024  .        if [[ $
+000159c0: 6e75 6d64 6973 6b20 2d67 7420 3120 5d5d  numdisk -gt 1 ]]
+000159d0: 3b20 7468 656e 0a20 2020 2020 2020 2020  ; then.         
+000159e0: 206d 6461 646d 202d 2d63 7265 6174 6520   mdadm --create 
+000159f0: 2f64 6576 2f6d 6430 202d 2d6c 6576 656c  /dev/md0 --level
+00015a00: 3d30 202d 2d72 6169 642d 6465 7669 6365  =0 --raid-device
+00015a10: 733d 246e 756d 6469 736b 2024 6269 6764  s=$numdisk $bigd
+00015a20: 6973 6b73 0a20 2020 2020 2020 2020 206d  isks.          m
+00015a30: 6b66 7320 2d74 2078 6673 202f 6465 762f  kfs -t xfs /dev/
+00015a40: 6d64 300a 2020 2020 2020 2020 2020 6d6f  md0.          mo
+00015a50: 756e 7420 2f64 6576 2f6d 6430 202f 7265  unt /dev/md0 /re
+00015a60: 7374 6f72 6564 0a20 2020 2020 2020 2065  stored.        e
+00015a70: 6c69 6620 5b5b 2024 6e75 6d64 6973 6b20  lif [[ $numdisk 
+00015a80: 2d65 7120 3120 5d5d 3b20 7468 656e 0a20  -eq 1 ]]; then. 
+00015a90: 2020 2020 2020 2020 206d 6b66 7320 2d74           mkfs -t
+00015aa0: 2078 6673 2024 6269 6764 6973 6b73 0a20   xfs $bigdisks. 
+00015ab0: 2020 2020 2020 2020 206d 6f75 6e74 2024           mount $
+00015ac0: 6269 6764 6973 6b73 202f 7265 7374 6f72  bigdisks /restor
+00015ad0: 6564 0a20 2020 2020 2020 2066 690a 2020  ed.        fi.  
+00015ae0: 2020 2020 2020 6368 6f77 6e20 6563 322d        chown ec2-
+00015af0: 7573 6572 202f 7265 7374 6f72 6564 0a20  user /restored. 
+00015b00: 2020 2020 2020 2064 6e66 2063 6865 636b         dnf check
+00015b10: 2d75 7064 6174 650a 2020 2020 2020 2020  -update.        
+00015b20: 646e 6620 7570 6461 7465 202d 790a 2020  dnf update -y.  
+00015b30: 2020 2020 2020 646e 6620 696e 7374 616c        dnf instal
+00015b40: 6c20 2d79 2061 7420 6763 6320 7669 6d20  l -y at gcc vim 
+00015b50: 7767 6574 2070 7974 686f 6e33 2d70 6970  wget python3-pip
+00015b60: 2070 7974 686f 6e33 2d70 7375 7469 6c0a   python3-psutil.
+00015b70: 2020 2020 2020 2020 686f 7374 6e61 6d65          hostname
+00015b80: 6374 6c20 7365 742d 686f 7374 6e61 6d65  ctl set-hostname
+00015b90: 2066 726f 7374 6572 0a20 2020 2020 2020   froster.       
+00015ba0: 2074 696d 6564 6174 6563 746c 2073 6574   timedatectl set
+00015bb0: 2d74 696d 657a 6f6e 6520 277b 6c6f 6e67  -timezone '{long
+00015bc0: 5f74 696d 657a 6f6e 657d 270a 2020 2020  _timezone}'.    
+00015bd0: 2020 2020 6c6f 6769 6e63 746c 2065 6e61      loginctl ena
+00015be0: 626c 652d 6c69 6e67 6572 2065 6332 2d75  ble-linger ec2-u
+00015bf0: 7365 720a 2020 2020 2020 2020 7379 7374  ser.        syst
+00015c00: 656d 6374 6c20 7374 6172 7420 6174 640a  emctl start atd.
+00015c10: 2020 2020 2020 2020 646e 6620 7570 6772          dnf upgr
+00015c20: 6164 650a 2020 2020 2020 2020 646e 6620  ade.        dnf 
+00015c30: 696e 7374 616c 6c20 2d79 206d 6320 6769  install -y mc gi
+00015c40: 7420 646f 636b 6572 206c 7561 206c 7561  t docker lua lua
+00015c50: 2d70 6f73 6978 206c 7561 2d64 6576 656c  -posix lua-devel
+00015c60: 2074 636c 2d64 6576 656c 206e 6f64 656a   tcl-devel nodej
+00015c70: 732d 6e70 6d0a 2020 2020 2020 2020 646e  s-npm.        dn
+00015c80: 6620 6772 6f75 7020 696e 7374 616c 6c20  f group install 
+00015c90: 2d79 2027 4465 7665 6c6f 706d 656e 7420  -y 'Development 
+00015ca0: 546f 6f6c 7327 0a20 2020 2020 2020 2063  Tools'.        c
+00015cb0: 6420 2f74 6d70 0a20 2020 2020 2020 2077  d /tmp.        w
+00015cc0: 6765 7420 6874 7470 733a 2f2f 736f 7572  get https://sour
+00015cd0: 6365 666f 7267 652e 6e65 742f 7072 6f6a  ceforge.net/proj
+00015ce0: 6563 7473 2f6c 6d6f 642f 6669 6c65 732f  ects/lmod/files/
+00015cf0: 4c6d 6f64 2d38 2e37 2e74 6172 2e62 7a32  Lmod-8.7.tar.bz2
+00015d00: 0a20 2020 2020 2020 2074 6172 202d 786a  .        tar -xj
+00015d10: 6620 4c6d 6f64 2d38 2e37 2e74 6172 2e62  f Lmod-8.7.tar.b
+00015d20: 7a32 0a20 2020 2020 2020 2063 6420 4c6d  z2.        cd Lm
+00015d30: 6f64 2d38 2e37 2026 2620 2e2f 636f 6e66  od-8.7 && ./conf
+00015d40: 6967 7572 6520 2626 206d 616b 6520 696e  igure && make in
+00015d50: 7374 616c 6c0a 2020 2020 2020 2020 2727  stall.        ''
+00015d60: 2729 2e73 7472 6970 2829 0a20 2020 2020  ').strip().     
+00015d70: 2020 2072 6574 7572 6e20 7573 6572 6461     return userda
+00015d80: 7461 0a0a 2020 2020 6465 6620 5f65 6332  ta..    def _ec2
+00015d90: 5f75 7365 725f 7370 6163 655f 7363 7269  _user_space_scri
+00015da0: 7074 2873 656c 662c 2069 6e73 7461 6e63  pt(self, instanc
+00015db0: 655f 6964 3d27 272c 2062 7363 7269 7074  e_id='', bscript
+00015dc0: 3d27 7e2f 626f 6f74 7374 7261 702e 7368  ='~/bootstrap.sh
+00015dd0: 2729 3a0a 2020 2020 2020 2020 2320 4465  '):.        # De
+00015de0: 6669 6e65 2073 6372 6970 7420 7468 6174  fine script that
+00015df0: 2077 696c 6c20 6265 2069 6e73 7461 6c6c   will be install
+00015e00: 6564 2062 7920 6563 322d 7573 6572 0a0a  ed by ec2-user..
+00015e10: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
+00015e20: 5265 706c 6963 6174 6520 7468 6520 636f  Replicate the co
+00015e30: 6e66 6967 7572 6174 696f 6e20 6f66 2074  nfiguration of t
+00015e40: 6865 2075 7365 7220 7370 6163 6520 7363  he user space sc
+00015e50: 7269 7074 0a0a 2020 2020 2020 2020 2320  ript..        # 
+00015e60: 7368 6f72 745f 7469 6d65 7a6f 6e65 203d  short_timezone =
+00015e70: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+00015e80: 6d65 2e6e 6f77 2829 2e61 7374 696d 657a  me.now().astimez
+00015e90: 6f6e 6528 292e 747a 696e 666f 0a20 2020  one().tzinfo.   
+00015ea0: 2020 2020 206c 6f6e 675f 7469 6d65 7a6f       long_timezo
+00015eb0: 6e65 203d 2073 656c 662e 6765 745f 7469  ne = self.get_ti
+00015ec0: 6d65 5f7a 6f6e 6528 290a 2020 2020 2020  me_zone().      
+00015ed0: 2020 7265 7475 726e 2074 6578 7477 7261    return textwra
+00015ee0: 702e 6465 6465 6e74 2866 2727 270a 2020  p.dedent(f'''.  
+00015ef0: 2020 2020 2020 2321 202f 6269 6e2f 6261        #! /bin/ba
+00015f00: 7368 0a20 2020 2020 2020 206d 6b64 6972  sh.        mkdir
+00015f10: 202d 7020 7e2f 2e66 726f 7374 6572 2f63   -p ~/.froster/c
+00015f20: 6f6e 6669 670a 2020 2020 2020 2020 736c  onfig.        sl
+00015f30: 6565 7020 3320 2320 6769 7665 2075 7320  eep 3 # give us 
+00015f40: 736f 6d65 2074 696d 6520 746f 2075 706c  some time to upl
+00015f50: 6f61 6420 6a73 6f6e 2074 6f20 7e2f 2e66  oad json to ~/.f
+00015f60: 726f 7374 6572 2f63 6f6e 6669 670a 2020  roster/config.  
+00015f70: 2020 2020 2020 6563 686f 2027 5053 313d        echo 'PS1=
+00015f80: 225c 5c75 4066 726f 7374 6572 3a5c 5c77  "\\u@froster:\\w
+00015f90: 2420 2227 203e 3e20 7e2f 2e62 6173 6872  $ "' >> ~/.bashr
+00015fa0: 630a 2020 2020 2020 2020 6563 686f 2027  c.        echo '
+00015fb0: 2365 7870 6f72 7420 4543 325f 494e 5354  #export EC2_INST
+00015fc0: 414e 4345 5f49 443d 7b69 6e73 7461 6e63  ANCE_ID={instanc
+00015fd0: 655f 6964 7d27 203e 3e20 7e2f 2e62 6173  e_id}' >> ~/.bas
+00015fe0: 6872 630a 2020 2020 2020 2020 6563 686f  hrc.        echo
+00015ff0: 2027 2365 7870 6f72 7420 4157 535f 4445   '#export AWS_DE
+00016000: 4641 554c 545f 5245 4749 4f4e 3d7b 7365  FAULT_REGION={se
+00016010: 6c66 2e63 6667 2e61 7773 5f72 6567 696f  lf.cfg.aws_regio
+00016020: 6e7d 2720 3e3e 207e 2f2e 6261 7368 7263  n}' >> ~/.bashrc
+00016030: 0a20 2020 2020 2020 2065 6368 6f20 2723  .        echo '#
+00016040: 6578 706f 7274 2054 5a3d 7b6c 6f6e 675f  export TZ={long_
+00016050: 7469 6d65 7a6f 6e65 7d27 203e 3e20 7e2f  timezone}' >> ~/
+00016060: 2e62 6173 6872 630a 2020 2020 2020 2020  .bashrc.        
+00016070: 6563 686f 2027 2361 6c69 6173 2073 696e  echo '#alias sin
+00016080: 6775 6c61 7269 7479 3d22 6170 7074 6169  gularity="apptai
+00016090: 6e65 7222 2720 3e3e 207e 2f2e 6261 7368  ner"' >> ~/.bash
+000160a0: 7263 0a20 2020 2020 2020 2063 6420 2f74  rc.        cd /t
+000160b0: 6d70 0a20 2020 2020 2020 2063 7572 6c20  mp.        curl 
+000160c0: 6874 7470 733a 2f2f 7261 772e 6769 7468  https://raw.gith
+000160d0: 7562 7573 6572 636f 6e74 656e 742e 636f  ubusercontent.co
+000160e0: 6d2f 6469 726b 7065 7465 7273 656e 2f66  m/dirkpetersen/f
+000160f0: 726f 7374 6572 2f6d 6169 6e2f 696e 7374  roster/main/inst
+00016100: 616c 6c2e 7368 207c 2062 6173 680a 2020  all.sh | bash.  
+00016110: 2020 2020 2020 6672 6f73 7465 7220 636f        froster co
+00016120: 6e66 6967 202d 2d6d 6f6e 6974 6f72 0a20  nfig --monitor. 
+00016130: 2020 2020 2020 2061 7773 2063 6f6e 6669         aws confi
+00016140: 6775 7265 2073 6574 2061 7773 5f61 6363  gure set aws_acc
+00016150: 6573 735f 6b65 795f 6964 207b 6f73 2e65  ess_key_id {os.e
+00016160: 6e76 6972 6f6e 5b27 4157 535f 4143 4345  nviron['AWS_ACCE
+00016170: 5353 5f4b 4559 5f49 4427 5d7d 0a20 2020  SS_KEY_ID']}.   
+00016180: 2020 2020 2061 7773 2063 6f6e 6669 6775       aws configu
+00016190: 7265 2073 6574 2061 7773 5f73 6563 7265  re set aws_secre
+000161a0: 745f 6163 6365 7373 5f6b 6579 207b 6f73  t_access_key {os
+000161b0: 2e65 6e76 6972 6f6e 5b27 4157 535f 5345  .environ['AWS_SE
+000161c0: 4352 4554 5f41 4343 4553 535f 4b45 5927  CRET_ACCESS_KEY'
+000161d0: 5d7d 0a20 2020 2020 2020 2061 7773 2063  ]}.        aws c
+000161e0: 6f6e 6669 6775 7265 2073 6574 2072 6567  onfigure set reg
+000161f0: 696f 6e20 7b73 656c 662e 6366 672e 6177  ion {self.cfg.aw
+00016200: 735f 7265 6769 6f6e 7d0a 2020 2020 2020  s_region}.      
+00016210: 2020 6177 7320 636f 6e66 6967 7572 6520    aws configure 
+00016220: 2d2d 7072 6f66 696c 6520 7b73 656c 662e  --profile {self.
+00016230: 6366 672e 6177 735f 7072 6f66 696c 657d  cfg.aws_profile}
+00016240: 2073 6574 2061 7773 5f61 6363 6573 735f   set aws_access_
+00016250: 6b65 795f 6964 207b 6f73 2e65 6e76 6972  key_id {os.envir
+00016260: 6f6e 5b27 4157 535f 4143 4345 5353 5f4b  on['AWS_ACCESS_K
+00016270: 4559 5f49 4427 5d7d 0a20 2020 2020 2020  EY_ID']}.       
+00016280: 2061 7773 2063 6f6e 6669 6775 7265 202d   aws configure -
+00016290: 2d70 726f 6669 6c65 207b 7365 6c66 2e63  -profile {self.c
+000162a0: 6667 2e61 7773 5f70 726f 6669 6c65 7d20  fg.aws_profile} 
+000162b0: 7365 7420 6177 735f 7365 6372 6574 5f61  set aws_secret_a
+000162c0: 6363 6573 735f 6b65 7920 7b6f 732e 656e  ccess_key {os.en
+000162d0: 7669 726f 6e5b 2741 5753 5f53 4543 5245  viron['AWS_SECRE
+000162e0: 545f 4143 4345 5353 5f4b 4559 275d 7d0a  T_ACCESS_KEY']}.
+000162f0: 2020 2020 2020 2020 6177 7320 636f 6e66          aws conf
+00016300: 6967 7572 6520 2d2d 7072 6f66 696c 6520  igure --profile 
+00016310: 7b73 656c 662e 6366 672e 6177 735f 7072  {self.cfg.aws_pr
+00016320: 6f66 696c 657d 2073 6574 2072 6567 696f  ofile} set regio
+00016330: 6e20 7b73 656c 662e 6366 672e 6177 735f  n {self.cfg.aws_
+00016340: 7265 6769 6f6e 7d0a 2020 2020 2020 2020  region}.        
+00016350: 7079 7468 6f6e 3320 2d6d 2070 6970 2069  python3 -m pip i
+00016360: 6e73 7461 6c6c 2062 6f74 6f33 0a20 2020  nstall boto3.   
+00016370: 2020 2020 2073 6564 202d 6920 2773 2f61       sed -i 's/a
+00016380: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
+00016390: 205b 5e20 5d2a 2f61 7773 5f61 6363 6573   [^ ]*/aws_acces
+000163a0: 735f 6b65 795f 6964 202f 2720 7b62 7363  s_key_id /' {bsc
+000163b0: 7269 7074 7d0a 2020 2020 2020 2020 7365  ript}.        se
+000163c0: 6420 2d69 2027 732f 6177 735f 7365 6372  d -i 's/aws_secr
+000163d0: 6574 5f61 6363 6573 735f 6b65 7920 5b5e  et_access_key [^
+000163e0: 205d 2a2f 6177 735f 7365 6372 6574 5f61   ]*/aws_secret_a
+000163f0: 6363 6573 735f 6b65 7920 2f27 207b 6273  ccess_key /' {bs
+00016400: 6372 6970 747d 0a20 2020 2020 2020 2063  cript}.        c
+00016410: 7572 6c20 2d73 2068 7474 7073 3a2f 2f72  url -s https://r
+00016420: 6177 2e67 6974 6875 6275 7365 7263 6f6e  aw.githubusercon
+00016430: 7465 6e74 2e63 6f6d 2f61 7070 7461 696e  tent.com/apptain
+00016440: 6572 2f61 7070 7461 696e 6572 2f6d 6169  er/apptainer/mai
+00016450: 6e2f 746f 6f6c 732f 696e 7374 616c 6c2d  n/tools/install-
+00016460: 756e 7072 6976 696c 6567 6564 2e73 6820  unprivileged.sh 
+00016470: 7c20 6261 7368 202d 7320 2d20 7e2f 2e6c  | bash -s - ~/.l
+00016480: 6f63 616c 0a20 2020 2020 2020 2063 7572  ocal.        cur
+00016490: 6c20 2d4f 6b4c 2068 7474 7073 3a2f 2f72  l -OkL https://r
+000164a0: 6570 6f2e 616e 6163 6f6e 6461 2e63 6f6d  epo.anaconda.com
+000164b0: 2f6d 696e 6963 6f6e 6461 2f4d 696e 6963  /miniconda/Minic
+000164c0: 6f6e 6461 332d 6c61 7465 7374 2d4c 696e  onda3-latest-Lin
+000164d0: 7578 2d78 3836 5f36 342e 7368 0a20 2020  ux-x86_64.sh.   
+000164e0: 2020 2020 2062 6173 6820 4d69 6e69 636f       bash Minico
+000164f0: 6e64 6133 2d6c 6174 6573 742d 4c69 6e75  nda3-latest-Linu
+00016500: 782d 7838 365f 3634 2e73 6820 2d62 0a20  x-x86_64.sh -b. 
+00016510: 2020 2020 2020 207e 2f6d 696e 6963 6f6e         ~/minicon
+00016520: 6461 332f 6269 6e2f 636f 6e64 6120 696e  da3/bin/conda in
+00016530: 6974 2062 6173 680a 2020 2020 2020 2020  it bash.        
+00016540: 736f 7572 6365 207e 2f2e 6261 7368 7263  source ~/.bashrc
+00016550: 0a20 2020 2020 2020 2063 6f6e 6461 2061  .        conda a
+00016560: 6374 6976 6174 650a 2020 2020 2020 2020  ctivate.        
+00016570: 6563 686f 2027 2321 202f 6269 6e2f 6261  echo '#! /bin/ba
+00016580: 7368 2720 3e20 7e2f 2e6c 6f63 616c 2f62  sh' > ~/.local/b
+00016590: 696e 2f67 6574 2d70 7562 6c69 632d 6970  in/get-public-ip
+000165a0: 0a20 2020 2020 2020 2065 6368 6f20 2745  .        echo 'E
+000165b0: 544f 4b45 4e3d 2428 6375 726c 202d 7358  TOKEN=$(curl -sX
+000165c0: 2050 5554 2022 6874 7470 3a2f 2f31 3639   PUT "http://169
+000165d0: 2e32 3534 2e31 3639 2e32 3534 2f6c 6174  .254.169.254/lat
+000165e0: 6573 742f 6170 692f 746f 6b65 6e22 202d  est/api/token" -
+000165f0: 4820 2258 2d61 7773 2d65 6332 2d6d 6574  H "X-aws-ec2-met
+00016600: 6164 6174 612d 746f 6b65 6e2d 7474 6c2d  adata-token-ttl-
+00016610: 7365 636f 6e64 733a 2032 3136 3030 2229  seconds: 21600")
+00016620: 2720 3e3e 207e 2f2e 6c6f 6361 6c2f 6269  ' >> ~/.local/bi
+00016630: 6e2f 6765 742d 7075 626c 6963 2d69 700a  n/get-public-ip.
+00016640: 2020 2020 2020 2020 6370 202d 6620 7e2f          cp -f ~/
+00016650: 2e6c 6f63 616c 2f62 696e 2f67 6574 2d70  .local/bin/get-p
+00016660: 7562 6c69 632d 6970 207e 2f2e 6c6f 6361  ublic-ip ~/.loca
+00016670: 6c2f 6269 6e2f 6765 742d 6c6f 6361 6c2d  l/bin/get-local-
+00016680: 6970 0a20 2020 2020 2020 2065 6368 6f20  ip.        echo 
+00016690: 2763 7572 6c20 2d73 4820 2258 2d61 7773  'curl -sH "X-aws
+000166a0: 2d65 6332 2d6d 6574 6164 6174 612d 746f  -ec2-metadata-to
+000166b0: 6b65 6e3a 2024 4554 4f4b 454e 2220 6874  ken: $ETOKEN" ht
+000166c0: 7470 3a2f 2f31 3639 2e32 3534 2e31 3639  tp://169.254.169
+000166d0: 2e32 3534 2f6c 6174 6573 742f 6d65 7461  .254/latest/meta
+000166e0: 2d64 6174 612f 7075 626c 6963 2d69 7076  -data/public-ipv
+000166f0: 3427 203e 3e20 7e2f 2e6c 6f63 616c 2f62  4' >> ~/.local/b
+00016700: 696e 2f67 6574 2d70 7562 6c69 632d 6970  in/get-public-ip
+00016710: 0a20 2020 2020 2020 2065 6368 6f20 2763  .        echo 'c
+00016720: 7572 6c20 2d73 4820 2258 2d61 7773 2d65  url -sH "X-aws-e
+00016730: 6332 2d6d 6574 6164 6174 612d 746f 6b65  c2-metadata-toke
+00016740: 6e3a 2024 4554 4f4b 454e 2220 6874 7470  n: $ETOKEN" http
+00016750: 3a2f 2f31 3639 2e32 3534 2e31 3639 2e32  ://169.254.169.2
+00016760: 3534 2f6c 6174 6573 742f 6d65 7461 2d64  54/latest/meta-d
+00016770: 6174 612f 6c6f 6361 6c2d 6970 7634 2720  ata/local-ipv4' 
+00016780: 3e3e 207e 2f2e 6c6f 6361 6c2f 6269 6e2f  >> ~/.local/bin/
+00016790: 6765 742d 6c6f 6361 6c2d 6970 0a20 2020  get-local-ip.   
+000167a0: 2020 2020 2063 686d 6f64 202b 7820 7e2f       chmod +x ~/
+000167b0: 2e6c 6f63 616c 2f62 696e 2f67 6574 2d70  .local/bin/get-p
+000167c0: 7562 6c69 632d 6970 0a20 2020 2020 2020  ublic-ip.       
+000167d0: 2063 686d 6f64 202b 7820 7e2f 2e6c 6f63   chmod +x ~/.loc
+000167e0: 616c 2f62 696e 2f67 6574 2d6c 6f63 616c  al/bin/get-local
+000167f0: 2d69 700a 2020 2020 2020 2020 7e2f 6d69  -ip.        ~/mi
+00016800: 6e69 636f 6e64 6133 2f62 696e 2f63 6f6e  niconda3/bin/con
+00016810: 6461 2069 6e73 7461 6c6c 202d 7920 6a75  da install -y ju
+00016820: 7079 7465 726c 6162 0a20 2020 2020 2020  pyterlab.       
+00016830: 207e 2f6d 696e 6963 6f6e 6461 332f 6269   ~/miniconda3/bi
+00016840: 6e2f 636f 6e64 6120 696e 7374 616c 6c20  n/conda install 
+00016850: 2d79 202d 6320 7220 722d 6972 6b65 726e  -y -c r r-irkern
+00016860: 656c 2072 2023 2052 206b 6572 6e65 6c20  el r # R kernel 
+00016870: 616e 6420 5220 666f 7220 4a75 7079 7465  and R for Jupyte
+00016880: 720a 2020 2020 2020 2020 636f 6e64 6120  r.        conda 
+00016890: 7275 6e20 6261 7368 202d 6320 227e 2f6d  run bash -c "~/m
+000168a0: 696e 6963 6f6e 6461 332f 6269 6e2f 6a75  iniconda3/bin/ju
+000168b0: 7079 7465 722d 6c61 6220 2d2d 6970 3d24  pyter-lab --ip=$
+000168c0: 2867 6574 2d6c 6f63 616c 2d69 7029 202d  (get-local-ip) -
+000168d0: 2d6e 6f2d 6272 6f77 7365 7220 2d2d 6175  -no-browser --au
+000168e0: 746f 7265 6c6f 6164 202d 2d6e 6f74 6562  toreload --noteb
+000168f0: 6f6f 6b2d 6469 723d 7e20 3e20 7e2f 2e6a  ook-dir=~ > ~/.j
+00016900: 7570 7974 6572 2e6c 6f67 2032 3e26 3122  upyter.log 2>&1"
+00016910: 2026 0a20 2020 2020 2020 2073 6c65 6570   &.        sleep
+00016920: 2036 300a 2020 2020 2020 2020 7365 6420   60.        sed 
+00016930: 2273 2f24 2867 6574 2d6c 6f63 616c 2d69  "s/$(get-local-i
+00016940: 7029 2f24 2867 6574 2d70 7562 6c69 632d  p)/$(get-public-
+00016950: 6970 292f 6722 207e 2f2e 6a75 7079 7465  ip)/g" ~/.jupyte
+00016960: 722e 6c6f 6720 3e20 7e2f 2e6a 7570 7974  r.log > ~/.jupyt
+00016970: 6572 2d70 7562 6c69 632e 6c6f 670a 2020  er-public.log.  
+00016980: 2020 2020 2020 6563 686f 2027 7465 7374        echo 'test
+00016990: 202d 6420 2f75 7372 2f6c 6f63 616c 2f6c   -d /usr/local/l
+000169a0: 6d6f 642f 6c6d 6f64 2f69 6e69 7420 2626  mod/lmod/init &&
+000169b0: 2073 6f75 7263 6520 2f75 7372 2f6c 6f63   source /usr/loc
+000169c0: 616c 2f6c 6d6f 642f 6c6d 6f64 2f69 6e69  al/lmod/lmod/ini
+000169d0: 742f 6261 7368 2720 3e3e 207e 2f2e 6261  t/bash' >> ~/.ba
+000169e0: 7368 7263 0a20 2020 2020 2020 2065 6368  shrc.        ech
+000169f0: 6f20 2222 203e 3e20 7e2f 2e62 6173 685f  o "" >> ~/.bash_
+00016a00: 7072 6f66 696c 650a 2020 2020 2020 2020  profile.        
+00016a10: 6563 686f 2027 6563 686f 2022 4163 6365  echo 'echo "Acce
+00016a20: 7373 204a 7570 7974 6572 4c61 623a 2227  ss JupyterLab:"'
+00016a30: 203e 3e20 7e2f 2e62 6173 685f 7072 6f66   >> ~/.bash_prof
+00016a40: 696c 650a 2020 2020 2020 2020 7572 6c3d  ile.        url=
+00016a50: 2428 7461 696c 202d 6e20 3720 7e2f 2e6a  $(tail -n 7 ~/.j
+00016a60: 7570 7974 6572 2d70 7562 6c69 632e 6c6f  upyter-public.lo
+00016a70: 6720 7c20 6772 6570 2024 2867 6574 2d70  g | grep $(get-p
+00016a80: 7562 6c69 632d 6970 2920 7c20 2074 7220  ublic-ip) |  tr 
+00016a90: 2d64 2027 2027 290a 2020 2020 2020 2020  -d ' ').        
+00016aa0: 6563 686f 2022 6563 686f 205c 5c22 2024  echo "echo \\" $
+00016ab0: 7572 6c5c 5c22 2220 3e3e 207e 2f2e 6261  url\\"" >> ~/.ba
+00016ac0: 7368 5f70 726f 6669 6c65 0a20 2020 2020  sh_profile.     
+00016ad0: 2020 2065 6368 6f20 2765 6368 6f20 2274     echo 'echo "t
+00016ae0: 7970 6520 5c5c 2263 6f6e 6461 2064 6561  ype \\"conda dea
+00016af0: 6374 6976 6174 655c 5c22 2074 6f20 6c65  ctivate\\" to le
+00016b00: 6176 6520 6375 7272 656e 7420 636f 6e64  ave current cond
+00016b10: 6120 656e 7669 726f 6e6d 656e 7422 2720  a environment"' 
+00016b20: 3e3e 207e 2f2e 6261 7368 5f70 726f 6669  >> ~/.bash_profi
+00016b30: 6c65 0a20 2020 2020 2020 2027 2727 292e  le.        ''').
+00016b40: 7374 7269 7028 290a 0a20 2020 2064 6566  strip()..    def
+00016b50: 205f 6563 325f 6372 6561 7465 5f69 6e73   _ec2_create_ins
+00016b60: 7461 6e63 6528 7365 6c66 2c20 7265 7175  tance(self, requ
+00016b70: 6972 6564 5f73 7061 6365 2c20 6961 6d70  ired_space, iamp
+00016b80: 726f 6669 6c65 3d4e 6f6e 6529 3a0a 2020  rofile=None):.  
+00016b90: 2020 2020 2020 2320 746f 2061 766f 6964        # to avoid
+00016ba0: 2065 6772 6573 7320 7765 2061 7265 2063   egress we are c
+00016bb0: 7265 6174 696e 6720 616e 2045 4332 2069  reating an EC2 i
+00016bc0: 6e73 7461 6e63 650a 2020 2020 2020 2020  nstance.        
+00016bd0: 2320 7769 7468 2065 7068 656d 6572 616c  # with ephemeral
+00016be0: 2028 6c6f 6361 6c29 2064 6973 6b20 666f   (local) disk fo
+00016bf0: 7220 6120 7465 6d70 6f72 6172 7920 7265  r a temporary re
+00016c00: 7374 6f72 650a 2020 2020 2020 2020 230a  store.        #.
+00016c10: 2020 2020 2020 2020 2320 6933 656e 2e32          # i3en.2
+00016c20: 3478 6c61 7267 652c 2039 3620 7663 7075  4xlarge, 96 vcpu
+00016c30: 2c20 3630 5469 4220 666f 7220 2431 302e  , 60TiB for $10.
+00016c40: 3835 0a20 2020 2020 2020 2023 2069 3365  85.        # i3e
+00016c50: 6e2e 3132 786c 6172 6765 2c20 3438 2076  n.12xlarge, 48 v
+00016c60: 6370 752c 2033 3054 6942 2066 6f72 2024  cpu, 30TiB for $
+00016c70: 352e 3432 0a20 2020 2020 2020 2023 2069  5.42.        # i
+00016c80: 3365 6e2e 3678 6c61 7267 652c 2032 3420  3en.6xlarge, 24 
+00016c90: 7663 7075 2c20 3135 5469 4220 666f 7220  vcpu, 15TiB for 
+00016ca0: 2432 2e37 310a 2020 2020 2020 2020 2320  $2.71.        # 
+00016cb0: 6933 656e 2e33 786c 6172 6765 2c20 3132  i3en.3xlarge, 12
+00016cc0: 2076 6370 752c 2037 2e35 5469 6220 666f   vcpu, 7.5Tib fo
+00016cd0: 7220 2431 2e33 360a 2020 2020 2020 2020  r $1.36.        
+00016ce0: 2320 6933 656e 2e78 6c61 7267 652c 2034  # i3en.xlarge, 4
+00016cf0: 2076 6370 752c 2032 2e35 5469 6220 666f   vcpu, 2.5Tib fo
+00016d00: 7220 2430 2e34 350a 2020 2020 2020 2020  r $0.45.        
+00016d10: 2320 6933 656e 2e6c 6172 6765 2c20 3220  # i3en.large, 2 
+00016d20: 7663 7075 2c20 312e 3235 5469 6220 666f  vcpu, 1.25Tib fo
+00016d30: 7220 2430 2e32 320a 2020 2020 2020 2020  r $0.22.        
+00016d40: 2320 6335 6164 2e6c 6172 6765 2c20 3220  # c5ad.large, 2 
+00016d50: 7663 7075 2c20 3735 4742 2c20 666f 7220  vcpu, 75GB, for 
+00016d60: 2430 2e30 390a 0a20 2020 2020 2020 2069  $0.09..        i
+00016d70: 6e73 7461 6e63 655f 7479 7065 7320 3d20  nstance_types = 
+00016d80: 7b27 6933 656e 2e32 3478 6c61 7267 6527  {'i3en.24xlarge'
+00016d90: 3a20 3630 3030 302c 0a20 2020 2020 2020  : 60000,.       
+00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016db0: 2020 2027 6933 656e 2e31 3278 6c61 7267     'i3en.12xlarg
+00016dc0: 6527 3a20 3330 3030 302c 0a20 2020 2020  e': 30000,.     
+00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016de0: 2020 2020 2027 6933 656e 2e36 786c 6172       'i3en.6xlar
+00016df0: 6765 273a 2031 3530 3030 2c0a 2020 2020  ge': 15000,.    
+00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e10: 2020 2020 2020 2769 3365 6e2e 3378 6c61        'i3en.3xla
+00016e20: 7267 6527 3a20 3735 3030 2c0a 2020 2020  rge': 7500,.    
+00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e40: 2020 2020 2020 2769 3365 6e2e 786c 6172        'i3en.xlar
+00016e50: 6765 273a 2032 3530 302c 0a20 2020 2020  ge': 2500,.     
+00016e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e70: 2020 2020 2027 6933 656e 2e6c 6172 6765       'i3en.large
+00016e80: 273a 2031 3235 302c 0a20 2020 2020 2020  ': 1250,.       
+00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ea0: 2020 2027 6335 6164 2e6c 6172 6765 273a     'c5ad.large':
+00016eb0: 2037 352c 0a20 2020 2020 2020 2020 2020   75,.           
+00016ec0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016ed0: 7433 612e 6d69 6372 6f27 3a20 352c 0a20  t3a.micro': 5,. 
+00016ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ef0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+00016f00: 2020 2020 6563 325f 7265 736f 7572 6365      ec2_resource
+00016f10: 203d 2073 656c 662e 7365 7373 696f 6e2e   = self.session.
+00016f20: 7265 736f 7572 6365 2827 6563 3227 290a  resource('ec2').
+00016f30: 0a20 2020 2020 2020 2069 6620 7265 7175  .        if requ
+00016f40: 6972 6564 5f73 7061 6365 203e 2031 3a0a  ired_space > 1:.
+00016f50: 2020 2020 2020 2020 2020 2020 7265 7175              requ
+00016f60: 6972 6564 5f73 7061 6365 203d 2072 6571  ired_space = req
+00016f70: 7569 7265 645f 7370 6163 6520 2b20 3520  uired_space + 5 
+00016f80: 2023 2061 766f 6964 206c 6f77 2064 6973   # avoid low dis
+00016f90: 6b20 7370 6163 6520 696e 206d 6963 726f  k space in micro
+00016fa0: 2069 6e73 7461 6e63 6573 0a20 2020 2020   instances.     
+00016fb0: 2020 2063 686f 7365 6e5f 696e 7374 616e     chosen_instan
+00016fc0: 6365 5f74 7970 6520 3d20 4e6f 6e65 0a20  ce_type = None. 
+00016fd0: 2020 2020 2020 2066 6f72 2069 7479 7065         for itype
+00016fe0: 2c20 7370 6163 6520 696e 2069 6e73 7461  , space in insta
+00016ff0: 6e63 655f 7479 7065 732e 6974 656d 7328  nce_types.items(
+00017000: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00017010: 6620 7370 6163 6520 3e20 312e 3520 2a20  f space > 1.5 * 
+00017020: 7265 7175 6972 6564 5f73 7061 6365 3a0a  required_space:.
+00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017040: 6368 6f73 656e 5f69 6e73 7461 6e63 655f  chosen_instance_
+00017050: 7479 7065 203d 2069 7479 7065 0a0a 2020  type = itype..  
+00017060: 2020 2020 2020 6966 2073 656c 662e 6172        if self.ar
+00017070: 6773 2e69 6e73 7461 6e63 6574 7970 653a  gs.instancetype:
+00017080: 0a20 2020 2020 2020 2020 2020 2063 686f  .            cho
+00017090: 7365 6e5f 696e 7374 616e 6365 5f74 7970  sen_instance_typ
+000170a0: 6520 3d20 7365 6c66 2e61 7267 732e 696e  e = self.args.in
+000170b0: 7374 616e 6365 7479 7065 0a20 2020 2020  stancetype.     
+000170c0: 2020 2070 7269 6e74 2827 4368 6f73 656e     print('Chosen
+000170d0: 2049 6e73 7461 6e63 653a 272c 2063 686f   Instance:', cho
+000170e0: 7365 6e5f 696e 7374 616e 6365 5f74 7970  sen_instance_typ
+000170f0: 6529 0a0a 2020 2020 2020 2020 6966 206e  e)..        if n
+00017100: 6f74 2063 686f 7365 6e5f 696e 7374 616e  ot chosen_instan
+00017110: 6365 5f74 7970 653a 0a20 2020 2020 2020  ce_type:.       
+00017120: 2020 2020 2070 7269 6e74 2822 4e6f 2073       print("No s
+00017130: 7569 7461 626c 6520 696e 7374 616e 6365  uitable instance
+00017140: 2074 7970 6520 666f 756e 6420 666f 7220   type found for 
+00017150: 7468 6520 6769 7665 6e20 6469 736b 2073  the given disk s
+00017160: 7061 6365 2072 6571 7569 7265 6d65 6e74  pace requirement
+00017170: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00017180: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+00017190: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
+000171a0: 206e 6577 2045 4332 206b 6579 2070 6169   new EC2 key pai
+000171b0: 720a 2020 2020 2020 2020 6b65 795f 6469  r.        key_di
+000171c0: 7220 3d20 7365 6c66 2e63 6667 2e73 6861  r = self.cfg.sha
+000171d0: 7265 645f 6469 7220 6966 2073 656c 662e  red_dir if self.
+000171e0: 6366 672e 6973 5f73 6861 7265 6420 656c  cfg.is_shared el
+000171f0: 7365 2073 656c 662e 6366 672e 636f 6e66  se self.cfg.conf
+00017200: 6967 5f64 6972 0a20 2020 2020 2020 206b  ig_dir.        k
+00017210: 6579 5f70 6174 6820 3d20 6f73 2e70 6174  ey_path = os.pat
+00017220: 682e 6a6f 696e 286b 6579 5f64 6972 2c20  h.join(key_dir, 
+00017230: 6627 7b73 656c 662e 6366 672e 7373 685f  f'{self.cfg.ssh_
+00017240: 6b65 795f 6e61 6d65 7d2e 7065 6d27 290a  key_name}.pem').
+00017250: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00017260: 732e 7061 7468 2e65 7869 7374 7328 6b65  s.path.exists(ke
+00017270: 795f 7061 7468 293a 0a20 2020 2020 2020  y_path):.       
+00017280: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00017290: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+000172a0: 6332 5f63 6c69 656e 742e 6465 7363 7269  c2_client.descri
+000172b0: 6265 5f6b 6579 5f70 6169 7273 280a 2020  be_key_pairs(.  
+000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172d0: 2020 4b65 794e 616d 6573 3d5b 7365 6c66    KeyNames=[self
+000172e0: 2e63 6667 2e73 7368 5f6b 6579 5f6e 616d  .cfg.ssh_key_nam
+000172f0: 655d 290a 2020 2020 2020 2020 2020 2020  e]).            
+00017300: 2020 2020 2320 4966 2074 6865 206b 6579      # If the key
+00017310: 2070 6169 7220 6578 6973 7473 2c20 6465   pair exists, de
+00017320: 6c65 7465 2069 740a 2020 2020 2020 2020  lete it.        
+00017330: 2020 2020 2020 2020 7365 6c66 2e65 6332          self.ec2
+00017340: 5f63 6c69 656e 742e 6465 6c65 7465 5f6b  _client.delete_k
+00017350: 6579 5f70 6169 7228 4b65 794e 616d 653d  ey_pair(KeyName=
+00017360: 7365 6c66 2e63 6667 2e73 7368 5f6b 6579  self.cfg.ssh_key
+00017370: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00017380: 2020 2065 7863 6570 7420 7365 6c66 2e65     except self.e
+00017390: 6332 5f63 6c69 656e 742e 6578 6365 7074  c2_client.except
+000173a0: 696f 6e73 2e43 6c69 656e 7445 7272 6f72  ions.ClientError
+000173b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000173c0: 2020 2320 4b65 7920 7061 6972 2064 6f65    # Key pair doe
+000173d0: 736e 2774 2065 7869 7374 2069 6e20 4157  sn't exist in AW
+000173e0: 532c 206e 6f20 6e65 6564 2074 6f20 6465  S, no need to de
+000173f0: 6c65 7465 0a20 2020 2020 2020 2020 2020  lete.           
+00017400: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00017410: 2020 2020 2020 6b65 795f 7061 6972 203d        key_pair =
+00017420: 2065 6332 5f72 6573 6f75 7263 652e 6372   ec2_resource.cr
+00017430: 6561 7465 5f6b 6579 5f70 6169 7228 0a20  eate_key_pair(. 
+00017440: 2020 2020 2020 2020 2020 2020 2020 204b                 K
+00017450: 6579 4e61 6d65 3d73 656c 662e 6366 672e  eyName=self.cfg.
+00017460: 7373 685f 6b65 795f 6e61 6d65 290a 2020  ssh_key_name).  
+00017470: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+00017480: 7065 6e28 6b65 795f 7061 7468 2c20 2777  pen(key_path, 'w
+00017490: 2729 2061 7320 6b65 795f 6669 6c65 3a0a  ') as key_file:.
+000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174b0: 6b65 795f 6669 6c65 2e77 7269 7465 286b  key_file.write(k
+000174c0: 6579 5f70 6169 722e 6b65 795f 6d61 7465  ey_pair.key_mate
+000174d0: 7269 616c 290a 2020 2020 2020 2020 2020  rial).          
+000174e0: 2020 6f73 2e63 686d 6f64 286b 6579 5f70    os.chmod(key_p
+000174f0: 6174 682c 2030 6f36 3430 2920 2023 2053  ath, 0o640)  # S
+00017500: 6574 2066 696c 6520 7065 726d 6973 7369  et file permissi
+00017510: 6f6e 2074 6f20 3630 300a 0a20 2020 2020  on to 600..     
+00017520: 2020 206d 796b 6579 5f70 6174 6820 3d20     mykey_path = 
+00017530: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+00017540: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00017550: 6667 2e73 6861 7265 645f 6469 722c 2066  fg.shared_dir, f
+00017560: 277b 7365 6c66 2e63 6667 2e73 7368 5f6b  '{self.cfg.ssh_k
+00017570: 6579 5f6e 616d 657d 2d7b 7365 6c66 2e63  ey_name}-{self.c
+00017580: 6667 2e77 686f 616d 697d 2e70 656d 2729  fg.whoami}.pem')
+00017590: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000175a0: 6f73 2e70 6174 682e 6578 6973 7473 286d  os.path.exists(m
+000175b0: 796b 6579 5f70 6174 6829 3a0a 2020 2020  ykey_path):.    
+000175c0: 2020 2020 2020 2020 7368 7574 696c 2e63          shutil.c
+000175d0: 6f70 7966 696c 6528 6b65 795f 7061 7468  opyfile(key_path
+000175e0: 2c20 6d79 6b65 795f 7061 7468 290a 2020  , mykey_path).  
+000175f0: 2020 2020 2020 2020 2020 6f73 2e63 686d            os.chm
+00017600: 6f64 286d 796b 6579 5f70 6174 682c 2030  od(mykey_path, 0
+00017610: 6f36 3030 2920 2023 2053 6574 2066 696c  o600)  # Set fil
+00017620: 6520 7065 726d 6973 7369 6f6e 2074 6f20  e permission to 
+00017630: 3630 300a 0a20 2020 2020 2020 2069 6d61  600..        ima
+00017640: 6765 6964 203d 2073 656c 662e 5f65 6332  geid = self._ec2
+00017650: 5f67 6574 5f6c 6174 6573 745f 616d 617a  _get_latest_amaz
+00017660: 6f6e 5f6c 696e 7578 325f 616d 6928 290a  on_linux2_ami().
+00017670: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00017680: 5573 696e 6720 496d 6167 6520 4944 3a20  Using Image ID: 
+00017690: 7b69 6d61 6765 6964 7d27 290a 0a20 2020  {imageid}')..   
+000176a0: 2020 2020 2023 2070 7269 6e74 2866 272a       # print(f'*
+000176b0: 2a2a 2075 7365 7264 6174 612d 7363 7269  ** userdata-scri
+000176c0: 7074 3a5c 6e7b 7365 6c66 2e5f 6563 325f  pt:\n{self._ec2_
+000176d0: 7573 6572 5f64 6174 615f 7363 7269 7074  user_data_script
+000176e0: 2829 7d27 290a 0a20 2020 2020 2020 2069  ()}')..        i
+000176f0: 616d 5f69 6e73 7461 6e63 655f 7072 6f66  am_instance_prof
+00017700: 696c 6520 3d20 7b7d 0a20 2020 2020 2020  ile = {}.       
+00017710: 2069 6620 6961 6d70 726f 6669 6c65 3a0a   if iamprofile:.
+00017720: 2020 2020 2020 2020 2020 2020 6961 6d5f              iam_
+00017730: 696e 7374 616e 6365 5f70 726f 6669 6c65  instance_profile
+00017740: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00017750: 2020 2020 2027 4e61 6d65 273a 2069 616d       'Name': iam
+00017760: 7072 6f66 696c 6520 2023 2055 7365 2074  profile  # Use t
+00017770: 6865 2069 6e73 7461 6e63 6520 7072 6f66  he instance prof
+00017780: 696c 6520 6e61 6d65 0a20 2020 2020 2020  ile name.       
+00017790: 2020 2020 207d 0a20 2020 2020 2020 2070       }.        p
+000177a0: 7269 6e74 2866 2749 414d 2049 6e73 7461  rint(f'IAM Insta
+000177b0: 6e63 6520 7072 6f66 696c 653a 207b 6961  nce profile: {ia
+000177c0: 6d70 726f 6669 6c65 7d2e 2729 0a0a 2020  mprofile}.')..  
+000177d0: 2020 2020 2020 2320 6961 6d5f 696e 7374        # iam_inst
+000177e0: 616e 6365 5f70 726f 6669 6c65 203d 207b  ance_profile = {
+000177f0: 7d0a 0a20 2020 2020 2020 2074 7279 3a0a  }..        try:.
+00017800: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+00017810: 6561 7465 2045 4332 2069 6e73 7461 6e63  eate EC2 instanc
+00017820: 650a 2020 2020 2020 2020 2020 2020 696e  e.            in
+00017830: 7374 616e 6365 203d 2065 6332 5f72 6573  stance = ec2_res
+00017840: 6f75 7263 652e 6372 6561 7465 5f69 6e73  ource.create_ins
+00017850: 7461 6e63 6573 280a 2020 2020 2020 2020  tances(.        
+00017860: 2020 2020 2020 2020 496d 6167 6549 643d          ImageId=
+00017870: 696d 6167 6569 642c 0a20 2020 2020 2020  imageid,.       
+00017880: 2020 2020 2020 2020 204d 696e 436f 756e           MinCoun
+00017890: 743d 312c 0a20 2020 2020 2020 2020 2020  t=1,.           
+000178a0: 2020 2020 204d 6178 436f 756e 743d 312c       MaxCount=1,
+000178b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178c0: 2049 6e73 7461 6e63 6554 7970 653d 6368   InstanceType=ch
+000178d0: 6f73 656e 5f69 6e73 7461 6e63 655f 7479  osen_instance_ty
+000178e0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+000178f0: 2020 2020 4b65 794e 616d 653d 7365 6c66      KeyName=self
+00017900: 2e63 6667 2e73 7368 5f6b 6579 5f6e 616d  .cfg.ssh_key_nam
+00017910: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00017920: 2020 2055 7365 7244 6174 613d 7365 6c66     UserData=self
+00017930: 2e5f 6563 325f 636c 6f75 645f 696e 6974  ._ec2_cloud_init
+00017940: 5f73 6372 6970 7428 292c 0a20 2020 2020  _script(),.     
+00017950: 2020 2020 2020 2020 2020 2049 616d 496e             IamIn
+00017960: 7374 616e 6365 5072 6f66 696c 653d 6961  stanceProfile=ia
+00017970: 6d5f 696e 7374 616e 6365 5f70 726f 6669  m_instance_profi
+00017980: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00017990: 2020 2020 5461 6753 7065 6369 6669 6361      TagSpecifica
+000179a0: 7469 6f6e 733d 5b0a 2020 2020 2020 2020  tions=[.        
+000179b0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179d0: 2020 2020 2020 2752 6573 6f75 7263 6554        'ResourceT
+000179e0: 7970 6527 3a20 2769 6e73 7461 6e63 6527  ype': 'instance'
+000179f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017a00: 2020 2020 2020 2020 2020 2754 6167 7327            'Tags'
+00017a10: 3a20 5b7b 274b 6579 273a 2027 4e61 6d65  : [{'Key': 'Name
+00017a20: 272c 2027 5661 6c75 6527 3a20 2746 726f  ', 'Value': 'Fro
+00017a30: 7374 6572 5365 6c66 4465 7374 7275 6374  sterSelfDestruct
+00017a40: 277d 5d0a 2020 2020 2020 2020 2020 2020  '}].            
+00017a50: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00017a60: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00017a70: 2020 2020 2020 2020 295b 305d 0a20 2020          )[0].   
+00017a80: 2020 2020 2065 7863 6570 7420 626f 746f       except boto
+00017a90: 636f 7265 2e65 7863 6570 7469 6f6e 732e  core.exceptions.
+00017aa0: 436c 6965 6e74 4572 726f 7220 6173 2065  ClientError as e
+00017ab0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
+00017ac0: 726f 725f 636f 6465 203d 2065 2e72 6573  ror_code = e.res
+00017ad0: 706f 6e73 655b 2745 7272 6f72 275d 5b27  ponse['Error']['
+00017ae0: 436f 6465 275d 0a20 2020 2020 2020 2020  Code'].         
+00017af0: 2020 2069 6620 6572 726f 725f 636f 6465     if error_code
+00017b00: 203d 3d20 2741 6363 6573 7344 656e 6965   == 'AccessDenie
+00017b10: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
+00017b20: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00017b40: 2741 6363 6573 7320 6465 6e69 6564 2120  'Access denied! 
+00017b50: 506c 6561 7365 2063 6865 636b 2079 6f75  Please check you
+00017b60: 7220 4941 4d20 7065 726d 6973 7369 6f6e  r IAM permission
+00017b70: 732e 205c 6e20 2020 4572 726f 723a 207b  s. \n   Error: {
+00017b80: 657d 2729 0a20 2020 2020 2020 2020 2020  e}').           
+00017b90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017ba0: 2020 2020 2020 2070 7269 6e74 2866 2743         print(f'C
+00017bb0: 6c69 656e 7420 4572 726f 723a 207b 657d  lient Error: {e}
+00017bc0: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+00017bd0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+00017be0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00017bf0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00017c00: 2020 2020 2020 7072 696e 7428 274f 7468        print('Oth
+00017c10: 6572 2045 7272 6f72 3a20 7b65 7d27 290a  er Error: {e}').
+00017c20: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00017c30: 6578 6974 2831 290a 0a20 2020 2020 2020  exit(1)..       
+00017c40: 2023 2055 7365 2061 2077 6169 7465 7220   # Use a waiter 
+00017c50: 746f 2065 6e73 7572 6520 7468 6520 696e  to ensure the in
+00017c60: 7374 616e 6365 2069 7320 7275 6e6e 696e  stance is runnin
+00017c70: 6720 6265 666f 7265 2074 7279 696e 6720  g before trying 
+00017c80: 746f 2061 6363 6573 7320 6974 7320 7072  to access its pr
+00017c90: 6f70 6572 7469 6573 0a20 2020 2020 2020  operties.       
+00017ca0: 2069 6e73 7461 6e63 655f 6964 203d 2069   instance_id = i
+00017cb0: 6e73 7461 6e63 652e 6964 0a0a 2020 2020  nstance.id..    
+00017cc0: 2020 2020 2320 7461 6720 7468 6520 696e      # tag the in
+00017cd0: 7374 616e 6365 2066 6f72 2063 6f73 7420  stance for cost 
+00017ce0: 6578 706c 6f72 6572 0a20 2020 2020 2020  explorer.       
+00017cf0: 2074 6167 203d 207b 0a20 2020 2020 2020   tag = {.       
+00017d00: 2020 2020 2027 4b65 7927 3a20 2749 4e53       'Key': 'INS
+00017d10: 5441 4e43 455f 4944 272c 0a20 2020 2020  TANCE_ID',.     
+00017d20: 2020 2020 2020 2027 5661 6c75 6527 3a20         'Value': 
+00017d30: 696e 7374 616e 6365 5f69 640a 2020 2020  instance_id.    
+00017d40: 2020 2020 7d0a 2020 2020 2020 2020 7472      }.        tr
+00017d50: 793a 0a20 2020 2020 2020 2020 2020 2065  y:.            e
+00017d60: 6332 5f72 6573 6f75 7263 652e 6372 6561  c2_resource.crea
+00017d70: 7465 5f74 6167 7328 5265 736f 7572 6365  te_tags(Resource
+00017d80: 733d 5b69 6e73 7461 6e63 655f 6964 5d2c  s=[instance_id],
+00017d90: 2054 6167 733d 5b74 6167 5d29 0a20 2020   Tags=[tag]).   
+00017da0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00017db0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00017dc0: 2020 2020 2020 2020 7072 696e 7464 6267          printdbg
+00017dd0: 2827 4572 726f 7220 6372 6561 7469 6e67  ('Error creating
+00017de0: 2054 6167 733a 207b 657d 2729 0a0a 2020   Tags: {e}')..  
+00017df0: 2020 2020 2020 7072 696e 7428 6627 4c61        print(f'La
+00017e00: 756e 6368 696e 6720 696e 7374 616e 6365  unching instance
+00017e10: 207b 696e 7374 616e 6365 5f69 647d 202e   {instance_id} .
+00017e20: 2e2e 2070 6c65 6173 6520 7761 6974 202e  .. please wait .
+00017e30: 2e2e 2729 0a0a 2020 2020 2020 2020 6d61  ..')..        ma
+00017e40: 785f 7761 6974 5f74 696d 6520 3d20 3330  x_wait_time = 30
+00017e50: 3020 2023 2073 6563 6f6e 6473 0a20 2020  0  # seconds.   
+00017e60: 2020 2020 2064 656c 6179 5f74 696d 6520       delay_time 
+00017e70: 3d20 3130 2020 2320 6368 6563 6b20 6576  = 10  # check ev
+00017e80: 6572 7920 3130 2073 6563 6f6e 6473 2c20  ery 10 seconds, 
+00017e90: 6164 6a75 7374 2061 7320 6e65 6564 6564  adjust as needed
+00017ea0: 0a20 2020 2020 2020 206d 6178 5f61 7474  .        max_att
+00017eb0: 656d 7074 7320 3d20 6d61 785f 7761 6974  empts = max_wait
+00017ec0: 5f74 696d 6520 2f2f 2064 656c 6179 5f74  _time // delay_t
+00017ed0: 696d 650a 0a20 2020 2020 2020 2077 6169  ime..        wai
+00017ee0: 7465 7220 3d20 7365 6c66 2e65 6332 5f63  ter = self.ec2_c
+00017ef0: 6c69 656e 742e 6765 745f 7761 6974 6572  lient.get_waiter
+00017f00: 2827 696e 7374 616e 6365 5f72 756e 6e69  ('instance_runni
+00017f10: 6e67 2729 0a20 2020 2020 2020 2070 726f  ng').        pro
+00017f20: 6772 6573 7320 3d20 7365 6c66 2e5f 6372  gress = self._cr
+00017f30: 6561 7465 5f70 726f 6772 6573 735f 6261  eate_progress_ba
+00017f40: 7228 6d61 785f 6174 7465 6d70 7473 290a  r(max_attempts).
+00017f50: 0a20 2020 2020 2020 2066 6f72 2061 7474  .        for att
+00017f60: 656d 7074 2069 6e20 7261 6e67 6528 6d61  empt in range(ma
+00017f70: 785f 6174 7465 6d70 7473 293a 0a20 2020  x_attempts):.   
+00017f80: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00017f90: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00017fa0: 6974 6572 2e77 6169 7428 496e 7374 616e  iter.wait(Instan
+00017fb0: 6365 4964 733d 5b69 6e73 7461 6e63 655f  ceIds=[instance_
+00017fc0: 6964 5d2c 2057 6169 7465 7243 6f6e 6669  id], WaiterConfi
+00017fd0: 673d 7b0a 2020 2020 2020 2020 2020 2020  g={.            
+00017fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ff0: 2744 656c 6179 273a 2064 656c 6179 5f74  'Delay': delay_t
+00018000: 696d 652c 2027 4d61 7841 7474 656d 7074  ime, 'MaxAttempt
+00018010: 7327 3a20 317d 290a 2020 2020 2020 2020  s': 1}).        
+00018020: 2020 2020 2020 2020 7072 6f67 7265 7373          progress
+00018030: 2861 7474 656d 7074 290a 2020 2020 2020  (attempt).      
+00018040: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00018050: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00018060: 7074 2062 6f74 6f63 6f72 652e 6578 6365  pt botocore.exce
+00018070: 7074 696f 6e73 2e57 6169 7465 7245 7272  ptions.WaiterErr
+00018080: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00018090: 2020 2020 7072 6f67 7265 7373 2861 7474      progress(att
+000180a0: 656d 7074 290a 2020 2020 2020 2020 2020  empt).          
+000180b0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+000180c0: 2020 2020 2020 2070 7269 6e74 2827 2729         print('')
+000180d0: 0a20 2020 2020 2020 2069 6e73 7461 6e63  .        instanc
+000180e0: 652e 7265 6c6f 6164 2829 0a0a 2020 2020  e.reload()..    
+000180f0: 2020 2020 6772 7069 6420 3d20 7365 6c66      grpid = self
+00018100: 2e5f 6563 325f 6372 6561 7465 5f61 6e64  ._ec2_create_and
+00018110: 5f61 7474 6163 685f 7365 6375 7269 7479  _attach_security
+00018120: 5f67 726f 7570 280a 2020 2020 2020 2020  _group(.        
+00018130: 2020 2020 696e 7374 616e 6365 5f69 6429      instance_id)
+00018140: 0a20 2020 2020 2020 2069 6620 6772 7069  .        if grpi
+00018150: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
+00018160: 7269 6e74 2866 2753 6563 7572 6974 7920  rint(f'Security 
+00018170: 4772 6f75 7020 227b 6772 7069 647d 2220  Group "{grpid}" 
+00018180: 6174 7461 6368 6564 2e27 290a 2020 2020  attached.').    
+00018190: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000181a0: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
+000181b0: 5365 6375 7269 7479 2047 726f 7570 2049  Security Group I
+000181c0: 4420 6372 6561 7465 642e 2729 0a20 2020  D created.').   
+000181d0: 2020 2020 2069 6e73 7461 6e63 652e 7761       instance.wa
+000181e0: 6974 5f75 6e74 696c 5f72 756e 6e69 6e67  it_until_running
+000181f0: 2829 0a20 2020 2020 2020 2070 7269 6e74  ().        print
+00018200: 2866 2749 6e73 7461 6e63 6520 4950 3a20  (f'Instance IP: 
+00018210: 7b69 6e73 7461 6e63 652e 7075 626c 6963  {instance.public
+00018220: 5f69 705f 6164 6472 6573 737d 2729 0a0a  _ip_address}')..
+00018230: 2020 2020 2020 2020 2320 5361 7665 2074          # Save t
+00018240: 6865 206c 6173 7420 696e 7374 616e 6365  he last instance
+00018250: 2049 5020 6164 6472 6573 730a 2020 2020   IP address.    
+00018260: 2020 2020 7365 6c66 2e63 6667 2e73 6574      self.cfg.set
+00018270: 5f65 6332 5f6c 6173 745f 696e 7374 616e  _ec2_last_instan
+00018280: 6365 2869 6e73 7461 6e63 652e 7075 626c  ce(instance.publ
+00018290: 6963 5f69 705f 6164 6472 6573 7329 0a0a  ic_ip_address)..
+000182a0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+000182b0: 6e73 7461 6e63 655f 6964 2c20 696e 7374  nstance_id, inst
+000182c0: 616e 6365 2e70 7562 6c69 635f 6970 5f61  ance.public_ip_a
+000182d0: 6464 7265 7373 0a0a 2020 2020 6465 6620  ddress..    def 
+000182e0: 6563 325f 7465 726d 696e 6174 655f 696e  ec2_terminate_in
+000182f0: 7374 616e 6365 2873 656c 662c 2069 7029  stance(self, ip)
+00018300: 3a0a 2020 2020 2020 2020 2320 7465 726d  :.        # term
+00018310: 696e 6174 6520 696e 7374 616e 6365 0a20  inate instance. 
+00018320: 2020 2020 2020 2023 2077 6974 6820 6570         # with ep
+00018330: 6865 6d65 7261 6c20 286c 6f63 616c 2920  hemeral (local) 
+00018340: 6469 736b 2066 6f72 2061 2074 656d 706f  disk for a tempo
+00018350: 7261 7279 2072 6573 746f 7265 0a0a 2020  rary restore..  
+00018360: 2020 2020 2020 2320 6970 7320 3d20 7365        # ips = se
+00018370: 6c66 2e65 6332 5f6c 6973 745f 6970 7328  lf.ec2_list_ips(
+00018380: 7365 6c66 2c20 274e 616d 6527 2c20 2746  self, 'Name', 'F
+00018390: 726f 7374 6572 5365 6c66 4465 7374 7275  rosterSelfDestru
+000183a0: 6374 2729 0a20 2020 2020 2020 2023 2055  ct').        # U
+000183b0: 7365 2064 6573 6372 6962 655f 696e 7374  se describe_inst
+000183c0: 616e 6365 7320 7769 7468 2061 2066 696c  ances with a fil
+000183d0: 7465 7220 666f 7220 7468 6520 7075 626c  ter for the publ
+000183e0: 6963 2049 5020 6164 6472 6573 7320 746f  ic IP address to
+000183f0: 2066 696e 6420 7468 6520 696e 7374 616e   find the instan
+00018400: 6365 2049 440a 2020 2020 2020 2020 6669  ce ID.        fi
+00018410: 6c74 6572 7320 3d20 5b7b 0a20 2020 2020  lters = [{.     
+00018420: 2020 2020 2020 2027 4e61 6d65 273a 2027         'Name': '
+00018430: 6e65 7477 6f72 6b2d 696e 7465 7266 6163  network-interfac
+00018440: 652e 6164 6472 6573 7365 732e 6173 736f  e.addresses.asso
+00018450: 6369 6174 696f 6e2e 7075 626c 6963 2d69  ciation.public-i
+00018460: 7027 2c0a 2020 2020 2020 2020 2020 2020  p',.            
+00018470: 2756 616c 7565 7327 3a20 5b69 705d 0a20  'Values': [ip]. 
+00018480: 2020 2020 2020 207d 5d0a 0a20 2020 2020         }]..     
+00018490: 2020 2069 6620 6e6f 7420 6970 2e73 7461     if not ip.sta
+000184a0: 7274 7377 6974 6828 2769 2d27 293a 2020  rtswith('i-'):  
+000184b0: 2320 7468 6973 2061 6e20 6970 2061 6e64  # this an ip and
+000184c0: 206e 6f74 2061 6e20 696e 7374 616e 6365   not an instance
+000184d0: 2049 440a 2020 2020 2020 2020 2020 2020   ID.            
+000184e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000184f0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+00018500: 7365 6c66 2e65 6332 5f63 6c69 656e 742e  self.ec2_client.
+00018510: 6465 7363 7269 6265 5f69 6e73 7461 6e63  describe_instanc
+00018520: 6573 2846 696c 7465 7273 3d66 696c 7465  es(Filters=filte
+00018530: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00018540: 6578 6365 7074 2062 6f74 6f63 6f72 652e  except botocore.
+00018550: 6578 6365 7074 696f 6e73 2e43 6c69 656e  exceptions.Clien
+00018560: 7445 7272 6f72 2061 7320 653a 0a20 2020  tError as e:.   
+00018570: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00018580: 6e74 2866 2745 7272 6f72 3a20 7b65 7d27  nt(f'Error: {e}'
+00018590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000185a0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+000185b0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000185c0: 636b 2069 6620 616e 7920 696e 7374 616e  ck if any instan
+000185d0: 6365 7320 6d61 7463 6820 7468 6520 6372  ces match the cr
+000185e0: 6974 6572 6961 0a20 2020 2020 2020 2020  iteria.         
+000185f0: 2020 2069 6e73 7461 6e63 6573 203d 205b     instances = [
+00018600: 696e 7374 616e 6365 2066 6f72 2072 6573  instance for res
+00018610: 6572 7661 7469 6f6e 2069 6e20 7265 7370  ervation in resp
+00018620: 6f6e 7365 5b27 5265 7365 7276 6174 696f  onse['Reservatio
+00018630: 6e73 275d 0a20 2020 2020 2020 2020 2020  ns'].           
+00018640: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00018650: 7220 696e 7374 616e 6365 2069 6e20 7265  r instance in re
+00018660: 7365 7276 6174 696f 6e5b 2749 6e73 7461  servation['Insta
+00018670: 6e63 6573 275d 5d0a 2020 2020 2020 2020  nces']].        
+00018680: 2020 2020 6966 206e 6f74 2069 6e73 7461      if not insta
+00018690: 6e63 6573 3a0a 2020 2020 2020 2020 2020  nces:.          
+000186a0: 2020 2020 2020 7072 696e 7428 6622 4e6f        print(f"No
+000186b0: 2045 4332 2069 6e73 7461 6e63 6520 666f   EC2 instance fo
+000186c0: 756e 6420 7769 7468 2070 7562 6c69 6320  und with public 
+000186d0: 4950 3a20 7b69 707d 2229 0a20 2020 2020  IP: {ip}").     
+000186e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000186f0: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
+00018700: 4578 7472 6163 7420 696e 7374 616e 6365  Extract instance
+00018710: 2049 4420 6672 6f6d 2074 6865 2069 6e73   ID from the ins
+00018720: 7461 6e63 650a 2020 2020 2020 2020 2020  tance.          
+00018730: 2020 696e 7374 616e 6365 5f69 6420 3d20    instance_id = 
+00018740: 696e 7374 616e 6365 735b 305d 5b27 496e  instances[0]['In
+00018750: 7374 616e 6365 4964 275d 0a20 2020 2020  stanceId'].     
+00018760: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00018770: 2020 2020 2069 6e73 7461 6e63 655f 6964       instance_id
+00018780: 203d 2069 700a 2020 2020 2020 2020 2320   = ip.        # 
+00018790: 5465 726d 696e 6174 6520 7468 6520 696e  Terminate the in
+000187a0: 7374 616e 6365 0a20 2020 2020 2020 2073  stance.        s
+000187b0: 656c 662e 6563 325f 636c 6965 6e74 2e74  elf.ec2_client.t
+000187c0: 6572 6d69 6e61 7465 5f69 6e73 7461 6e63  erminate_instanc
+000187d0: 6573 2849 6e73 7461 6e63 6549 6473 3d5b  es(InstanceIds=[
+000187e0: 696e 7374 616e 6365 5f69 645d 290a 0a20  instance_id]).. 
+000187f0: 2020 2020 2020 2070 7269 6e74 2866 2245         print(f"E
+00018800: 4332 2049 6e73 7461 6e63 6520 7b69 6e73  C2 Instance {ins
+00018810: 7461 6e63 655f 6964 7d20 287b 6970 7d29  tance_id} ({ip})
+00018820: 2069 7320 6265 696e 6720 7465 726d 696e   is being termin
+00018830: 6174 6564 2021 2229 0a0a 2020 2020 6465  ated !")..    de
+00018840: 6620 6563 325f 6c69 7374 5f69 6e73 7461  f ec2_list_insta
+00018850: 6e63 6573 2873 656c 662c 2074 6167 5f6e  nces(self, tag_n
+00018860: 616d 652c 2074 6167 5f76 616c 7565 293a  ame, tag_value):
+00018870: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018880: 2020 2020 204c 6973 7420 616c 6c20 4950       List all IP
+00018890: 2061 6464 7265 7373 6573 206f 6620 7275   addresses of ru
+000188a0: 6e6e 696e 6720 4543 3220 696e 7374 616e  nning EC2 instan
+000188b0: 6365 7320 7769 7468 2061 2073 7065 6369  ces with a speci
+000188c0: 6669 6320 7461 6720 6e61 6d65 2061 6e64  fic tag name and
+000188d0: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+000188e0: 3a70 6172 616d 2074 6167 5f6e 616d 653a  :param tag_name:
+000188f0: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
+00018900: 2074 6167 0a20 2020 2020 2020 203a 7061   tag.        :pa
+00018910: 7261 6d20 7461 675f 7661 6c75 653a 2054  ram tag_value: T
+00018920: 6865 2076 616c 7565 206f 6620 7468 6520  he value of the 
+00018930: 7461 670a 2020 2020 2020 2020 3a72 6574  tag.        :ret
+00018940: 7572 6e3a 204c 6973 7420 6f66 2049 5020  urn: List of IP 
+00018950: 6164 6472 6573 7365 730a 2020 2020 2020  addresses.      
+00018960: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00018970: 2044 6566 696e 6520 7468 6520 6669 6c74   Define the filt
+00018980: 6572 0a20 2020 2020 2020 2066 696c 7465  er.        filte
+00018990: 7273 203d 205b 0a20 2020 2020 2020 2020  rs = [.         
+000189a0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+000189b0: 2020 2020 2027 4e61 6d65 273a 2027 7461       'Name': 'ta
+000189c0: 673a 2720 2b20 7461 675f 6e61 6d65 2c0a  g:' + tag_name,.
+000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189e0: 2756 616c 7565 7327 3a20 5b74 6167 5f76  'Values': [tag_v
+000189f0: 616c 7565 5d0a 2020 2020 2020 2020 2020  alue].          
+00018a00: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+00018a10: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00018a20: 2020 2027 4e61 6d65 273a 2027 696e 7374     'Name': 'inst
+00018a30: 616e 6365 2d73 7461 7465 2d6e 616d 6527  ance-state-name'
+00018a40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018a50: 2020 2756 616c 7565 7327 3a20 5b27 7275    'Values': ['ru
+00018a60: 6e6e 696e 6727 5d0a 2020 2020 2020 2020  nning'].        
+00018a70: 2020 2020 7d0a 2020 2020 2020 2020 5d0a      }.        ].
+00018a80: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+00018a90: 7468 6520 6465 7363 7269 6265 2069 6e73  the describe ins
+00018aa0: 7461 6e63 6573 2063 616c 6c0a 2020 2020  tances call.    
+00018ab0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00018ac0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+00018ad0: 7365 6c66 2e65 6332 5f63 6c69 656e 742e  self.ec2_client.
+00018ae0: 6465 7363 7269 6265 5f69 6e73 7461 6e63  describe_instanc
+00018af0: 6573 2846 696c 7465 7273 3d66 696c 7465  es(Filters=filte
+00018b00: 7273 290a 2020 2020 2020 2020 6578 6365  rs).        exce
+00018b10: 7074 2062 6f74 6f63 6f72 652e 6578 6365  pt botocore.exce
+00018b20: 7074 696f 6e73 2e43 6c69 656e 7445 7272  ptions.ClientErr
+00018b30: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00018b40: 2020 2020 2065 7272 6f72 5f63 6f64 6520       error_code 
+00018b50: 3d20 652e 7265 7370 6f6e 7365 5b27 4572  = e.response['Er
+00018b60: 726f 7227 5d5b 2743 6f64 6527 5d0a 2020  ror']['Code'].  
+00018b70: 2020 2020 2020 2020 2020 6966 2065 7272            if err
+00018b80: 6f72 5f63 6f64 6520 3d3d 2027 4163 6365  or_code == 'Acce
+00018b90: 7373 4465 6e69 6564 273a 0a20 2020 2020  ssDenied':.     
+00018ba0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00018bb0: 6462 6728 0a20 2020 2020 2020 2020 2020  dbg(.           
+00018bc0: 2020 2020 2020 2020 2066 2741 6363 6573           f'Acces
+00018bd0: 7320 6465 6e69 6564 2120 506c 6561 7365  s denied! Please
+00018be0: 2063 6865 636b 2079 6f75 7220 4941 4d20   check your IAM 
+00018bf0: 7065 726d 6973 7369 6f6e 732e 205c 6e20  permissions. \n 
+00018c00: 2020 4572 726f 723a 207b 657d 2729 0a20    Error: {e}'). 
+00018c10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018c30: 2070 7269 6e74 2866 2743 6c69 656e 7420   print(f'Client 
+00018c40: 4572 726f 723a 207b 657d 2729 0a20 2020  Error: {e}').   
+00018c50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018c60: 5b5d 0a20 2020 2020 2020 2023 2041 6e20  [].        # An 
+00018c70: 6572 726f 7220 6f63 6375 7272 6564 2028  error occurred (
+00018c80: 4175 7468 4661 696c 7572 6529 2077 6865  AuthFailure) whe
+00018c90: 6e20 6361 6c6c 696e 6720 7468 6520 4465  n calling the De
+00018ca0: 7363 7269 6265 496e 7374 616e 6365 7320  scribeInstances 
+00018cb0: 6f70 6572 6174 696f 6e3a 2041 5753 2077  operation: AWS w
+00018cc0: 6173 206e 6f74 2061 626c 6520 746f 2076  as not able to v
+00018cd0: 616c 6964 6174 6520 7468 6520 7072 6f76  alidate the prov
+00018ce0: 6964 6564 2061 6363 6573 7320 6372 6564  ided access cred
+00018cf0: 656e 7469 616c 730a 2020 2020 2020 2020  entials.        
+00018d00: 696c 6973 7420 3d20 5b5d 0a20 2020 2020  ilist = [].     
+00018d10: 2020 2023 2045 7874 7261 6374 2049 5020     # Extract IP 
+00018d20: 6164 6472 6573 7365 730a 2020 2020 2020  addresses.      
+00018d30: 2020 666f 7220 7265 7365 7276 6174 696f    for reservatio
+00018d40: 6e20 696e 2072 6573 706f 6e73 655b 2752  n in response['R
+00018d50: 6573 6572 7661 7469 6f6e 7327 5d3a 0a20  eservations']:. 
+00018d60: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00018d70: 6e73 7461 6e63 6520 696e 2072 6573 6572  nstance in reser
+00018d80: 7661 7469 6f6e 5b27 496e 7374 616e 6365  vation['Instance
+00018d90: 7327 5d3a 0a20 2020 2020 2020 2020 2020  s']:.           
+00018da0: 2020 2020 2072 6f77 203d 205b 696e 7374       row = [inst
+00018db0: 616e 6365 5b27 5075 626c 6963 4970 4164  ance['PublicIpAd
+00018dc0: 6472 6573 7327 5d2c 0a20 2020 2020 2020  dress'],.       
+00018dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018de0: 696e 7374 616e 6365 5b27 496e 7374 616e  instance['Instan
+00018df0: 6365 4964 275d 2c0a 2020 2020 2020 2020  ceId'],.        
+00018e00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018e10: 6e73 7461 6e63 655b 2749 6e73 7461 6e63  nstance['Instanc
+00018e20: 6554 7970 6527 5d5d 0a20 2020 2020 2020  eType']].       
+00018e30: 2020 2020 2020 2020 2069 6c69 7374 2e61           ilist.a
+00018e40: 7070 656e 6428 726f 7729 0a20 2020 2020  ppend(row).     
+00018e50: 2020 2072 6574 7572 6e20 696c 6973 740a     return ilist.
+00018e60: 0a20 2020 2064 6566 205f 7373 685f 6765  .    def _ssh_ge
+00018e70: 745f 6b65 795f 7061 7468 2873 656c 6629  t_key_path(self)
+00018e80: 3a0a 2020 2020 2020 2020 6b65 795f 7061  :.        key_pa
+00018e90: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
+00018ea0: 6e28 7365 6c66 2e63 6667 2e73 6861 7265  n(self.cfg.share
+00018eb0: 645f 6469 722c 0a20 2020 2020 2020 2020  d_dir,.         
+00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ed0: 2020 2020 2020 2066 277b 7365 6c66 2e63         f'{self.c
+00018ee0: 6667 2e73 7368 5f6b 6579 5f6e 616d 657d  fg.ssh_key_name}
+00018ef0: 2e70 656d 2729 0a20 2020 2020 2020 206d  .pem').        m
+00018f00: 796b 6579 5f70 6174 6820 3d20 6f73 2e70  ykey_path = os.p
+00018f10: 6174 682e 6a6f 696e 280a 2020 2020 2020  ath.join(.      
+00018f20: 2020 2020 2020 7365 6c66 2e63 6667 2e73        self.cfg.s
+00018f30: 6861 7265 645f 6469 722c 2066 277b 7365  hared_dir, f'{se
+00018f40: 6c66 2e63 6667 2e73 7368 5f6b 6579 5f6e  lf.cfg.ssh_key_n
+00018f50: 616d 657d 2d7b 7365 6c66 2e63 6667 2e77  ame}-{self.cfg.w
+00018f60: 686f 616d 697d 2e70 656d 2729 0a20 2020  hoami}.pem').   
+00018f70: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00018f80: 6174 682e 6578 6973 7473 286b 6579 5f70  ath.exists(key_p
+00018f90: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00018fa0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+00018fb0: 2020 2020 2020 2020 2066 277b 6b65 795f           f'{key_
+00018fc0: 7061 7468 7d20 646f 6573 206e 6f74 2065  path} does not e
+00018fd0: 7869 7374 2e20 506c 6561 7365 2063 7265  xist. Please cre
+00018fe0: 6174 6520 6974 2062 7920 6c61 756e 6368  ate it by launch
+00018ff0: 696e 6720 2266 726f 7374 6572 2072 6573  ing "froster res
+00019000: 746f 7265 202d 2d61 7773 2227 290a 2020  tore --aws"').  
+00019010: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00019020: 6974 0a20 2020 2020 2020 2069 6620 6e6f  it.        if no
+00019030: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00019040: 286d 796b 6579 5f70 6174 6829 3a0a 2020  (mykey_path):.  
+00019050: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
+00019060: 2e63 6f70 7966 696c 6528 6b65 795f 7061  .copyfile(key_pa
+00019070: 7468 2c20 6d79 6b65 795f 7061 7468 290a  th, mykey_path).
+00019080: 2020 2020 2020 2020 2020 2020 6f73 2e63              os.c
+00019090: 686d 6f64 286d 796b 6579 5f70 6174 682c  hmod(mykey_path,
+000190a0: 2030 6f36 3030 2920 2023 2053 6574 2066   0o600)  # Set f
+000190b0: 696c 6520 7065 726d 6973 7369 6f6e 2074  ile permission t
+000190c0: 6f20 3630 300a 2020 2020 2020 2020 7265  o 600.        re
+000190d0: 7475 726e 206d 796b 6579 5f70 6174 680a  turn mykey_path.
+000190e0: 0a20 2020 2064 6566 2073 7368 5f65 7865  .    def ssh_exe
+000190f0: 6375 7465 2873 656c 662c 2075 7365 722c  cute(self, user,
+00019100: 2068 6f73 742c 2063 6f6d 6d61 6e64 3d4e   host, command=N
+00019110: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00019120: 2245 7865 6375 7465 2061 6e20 5353 4820  "Execute an SSH 
+00019130: 636f 6d6d 616e 6420 6f6e 2074 6865 2072  command on the r
+00019140: 656d 6f74 6520 7365 7276 6572 2e22 2222  emote server."""
+00019150: 0a20 2020 2020 2020 2053 5348 5f4f 5054  .        SSH_OPT
+00019160: 494f 4e53 203d 2022 2d6f 2053 7472 6963  IONS = "-o Stric
+00019170: 7448 6f73 744b 6579 4368 6563 6b69 6e67  tHostKeyChecking
+00019180: 3d6e 6f22 0a20 2020 2020 2020 206b 6579  =no".        key
+00019190: 5f70 6174 6820 3d20 7365 6c66 2e5f 7373  _path = self._ss
+000191a0: 685f 6765 745f 6b65 795f 7061 7468 2829  h_get_key_path()
+000191b0: 0a20 2020 2020 2020 2063 6d64 203d 2066  .        cmd = f
+000191c0: 2273 7368 207b 5353 485f 4f50 5449 4f4e  "ssh {SSH_OPTION
+000191d0: 537d 202d 6920 277b 6b65 795f 7061 7468  S} -i '{key_path
+000191e0: 7d27 207b 7573 6572 7d40 7b68 6f73 747d  }' {user}@{host}
+000191f0: 220a 2020 2020 2020 2020 6966 2063 6f6d  ".        if com
+00019200: 6d61 6e64 3a0a 2020 2020 2020 2020 2020  mand:.          
+00019210: 2020 636d 6420 2b3d 2066 2220 277b 636f    cmd += f" '{co
+00019220: 6d6d 616e 647d 2722 0a20 2020 2020 2020  mmand}'".       
+00019230: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00019240: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00019250: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00019260: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00019270: 2020 2020 2020 2063 6d64 2c20 7368 656c         cmd, shel
+00019280: 6c3d 5472 7565 2c20 6361 7074 7572 655f  l=True, capture_
+00019290: 6f75 7470 7574 3d54 7275 652c 2074 6578  output=True, tex
+000192a0: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
+000192b0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+000192c0: 6573 756c 740a 2020 2020 2020 2020 2020  esult.          
+000192d0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+000192e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000192f0: 6627 4572 726f 7220 6578 6563 7574 696e  f'Error executin
+00019300: 6720 227b 636d 647d 2e22 2729 0a20 2020  g "{cmd}."').   
+00019310: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00019320: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
+00019330: 732e 7275 6e28 636d 642c 2073 6865 6c6c  s.run(cmd, shell
+00019340: 3d54 7275 652c 2063 6170 7475 7265 5f6f  =True, capture_o
+00019350: 7574 7075 743d 4661 6c73 652c 2074 6578  utput=False, tex
+00019360: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
+00019370: 7072 696e 7464 6267 2866 2773 7368 2063  printdbg(f'ssh c
+00019380: 6f6d 6d61 6e64 206c 696e 653a 207b 636d  ommand line: {cm
+00019390: 647d 2729 0a20 2020 2020 2020 2072 6574  d}').        ret
+000193a0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 6465  urn None..    de
+000193b0: 6620 7373 685f 7570 6c6f 6164 2873 656c  f ssh_upload(sel
+000193c0: 662c 2075 7365 722c 2068 6f73 742c 206c  f, user, host, l
+000193d0: 6f63 616c 5f70 6174 682c 2072 656d 6f74  ocal_path, remot
+000193e0: 655f 7061 7468 2c20 6973 5f73 7472 696e  e_path, is_strin
+000193f0: 673d 4661 6c73 6529 3a0a 2020 2020 2020  g=False):.      
+00019400: 2020 2222 2255 706c 6f61 6420 6120 6669    """Upload a fi
+00019410: 6c65 2074 6f20 7468 6520 7265 6d6f 7465  le to the remote
+00019420: 2073 6572 7665 7220 7573 696e 6720 5343   server using SC
+00019430: 502e 2222 220a 2020 2020 2020 2020 5353  P.""".        SS
+00019440: 485f 4f50 5449 4f4e 5320 3d20 222d 6f20  H_OPTIONS = "-o 
+00019450: 5374 7269 6374 486f 7374 4b65 7943 6865  StrictHostKeyChe
+00019460: 636b 696e 673d 6e6f 220a 2020 2020 2020  cking=no".      
+00019470: 2020 6b65 795f 7061 7468 203d 2073 656c    key_path = sel
+00019480: 662e 5f73 7368 5f67 6574 5f6b 6579 5f70  f._ssh_get_key_p
+00019490: 6174 6828 290a 2020 2020 2020 2020 6966  ath().        if
+000194a0: 2069 735f 7374 7269 6e67 3a0a 2020 2020   is_string:.    
+000194b0: 2020 2020 2020 2020 2320 7468 6520 6c6f          # the lo
+000194c0: 6361 6c5f 7061 7468 2069 7320 6163 7475  cal_path is actu
+000194d0: 616c 6c79 2061 2073 7472 696e 6720 7468  ally a string th
+000194e0: 6174 206e 6565 6473 2074 6f20 676f 2069  at needs to go i
+000194f0: 6e74 6f20 7465 6d70 2066 696c 650a 2020  nto temp file.  
+00019500: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+00019510: 656d 7066 696c 652e 4e61 6d65 6454 656d  empfile.NamedTem
+00019520: 706f 7261 7279 4669 6c65 286d 6f64 653d  poraryFile(mode=
+00019530: 2777 2b27 2c20 6465 6c65 7465 3d46 616c  'w+', delete=Fal
+00019540: 7365 2920 6173 2074 656d 703a 0a20 2020  se) as temp:.   
+00019550: 2020 2020 2020 2020 2020 2020 2074 656d               tem
+00019560: 702e 7772 6974 6528 6c6f 6361 6c5f 7061  p.write(local_pa
+00019570: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+00019580: 2020 2020 6c6f 6361 6c5f 7061 7468 203d      local_path =
+00019590: 2074 656d 702e 6e61 6d65 0a20 2020 2020   temp.name.     
+000195a0: 2020 2063 6d64 203d 2066 2273 6370 207b     cmd = f"scp {
+000195b0: 5353 485f 4f50 5449 4f4e 537d 202d 6920  SSH_OPTIONS} -i 
+000195c0: 277b 6b65 795f 7061 7468 7d27 207b 6c6f  '{key_path}' {lo
+000195d0: 6361 6c5f 7061 7468 7d20 7b75 7365 727d  cal_path} {user}
+000195e0: 407b 686f 7374 7d3a 7b72 656d 6f74 655f  @{host}:{remote_
+000195f0: 7061 7468 7d22 0a20 2020 2020 2020 2074  path}".        t
+00019600: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00019610: 7265 7375 6c74 203d 2073 7562 7072 6f63  result = subproc
+00019620: 6573 732e 7275 6e28 0a20 2020 2020 2020  ess.run(.       
+00019630: 2020 2020 2020 2020 2063 6d64 2c20 7368           cmd, sh
+00019640: 656c 6c3d 5472 7565 2c20 6361 7074 7572  ell=True, captur
+00019650: 655f 6f75 7470 7574 3d54 7275 652c 2074  e_output=True, t
+00019660: 6578 743d 5472 7565 290a 2020 2020 2020  ext=True).      
+00019670: 2020 2020 2020 6966 2069 735f 7374 7269        if is_stri
+00019680: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+00019690: 2020 2020 6f73 2e72 656d 6f76 6528 6c6f      os.remove(lo
+000196a0: 6361 6c5f 7061 7468 290a 2020 2020 2020  cal_path).      
+000196b0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+000196c0: 756c 740a 2020 2020 2020 2020 6578 6365  ult.        exce
+000196d0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+000196e0: 7072 696e 7428 6627 4572 726f 7220 6578  print(f'Error ex
+000196f0: 6563 7574 696e 6720 227b 636d 647d 2e22  ecuting "{cmd}."
+00019700: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
+00019710: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
+00019720: 7373 685f 646f 776e 6c6f 6164 2873 656c  ssh_download(sel
+00019730: 662c 2075 7365 722c 2068 6f73 742c 2072  f, user, host, r
+00019740: 656d 6f74 655f 7061 7468 2c20 6c6f 6361  emote_path, loca
+00019750: 6c5f 7061 7468 293a 0a20 2020 2020 2020  l_path):.       
+00019760: 2022 2222 5570 6c6f 6164 2061 2066 696c   """Upload a fil
+00019770: 6520 746f 2074 6865 2072 656d 6f74 6520  e to the remote 
+00019780: 7365 7276 6572 2075 7369 6e67 2053 4350  server using SCP
+00019790: 2e22 2222 0a20 2020 2020 2020 2053 5348  .""".        SSH
+000197a0: 5f4f 5054 494f 4e53 203d 2022 2d6f 2053  _OPTIONS = "-o S
+000197b0: 7472 6963 7448 6f73 744b 6579 4368 6563  trictHostKeyChec
+000197c0: 6b69 6e67 3d6e 6f22 0a20 2020 2020 2020  king=no".       
+000197d0: 206b 6579 5f70 6174 6820 3d20 7365 6c66   key_path = self
+000197e0: 2e5f 7373 685f 6765 745f 6b65 795f 7061  ._ssh_get_key_pa
+000197f0: 7468 2829 0a20 2020 2020 2020 2063 6d64  th().        cmd
+00019800: 203d 2066 2273 6370 207b 5353 485f 4f50   = f"scp {SSH_OP
+00019810: 5449 4f4e 537d 202d 6920 277b 6b65 795f  TIONS} -i '{key_
+00019820: 7061 7468 7d27 207b 7573 6572 7d40 7b68  path}' {user}@{h
+00019830: 6f73 747d 3a7b 7265 6d6f 7465 5f70 6174  ost}:{remote_pat
+00019840: 687d 207b 6c6f 6361 6c5f 7061 7468 7d22  h} {local_path}"
+00019850: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00019860: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00019870: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00019880: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00019890: 2020 2063 6d64 2c20 7368 656c 6c3d 5472     cmd, shell=Tr
+000198a0: 7565 2c20 6361 7074 7572 655f 6f75 7470  ue, capture_outp
+000198b0: 7574 3d54 7275 652c 2074 6578 743d 5472  ut=True, text=Tr
+000198c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000198d0: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
+000198e0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+000198f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00019900: 6627 4572 726f 7220 6578 6563 7574 696e  f'Error executin
+00019910: 6720 227b 636d 647d 2e22 2729 0a20 2020  g "{cmd}."').   
+00019920: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00019930: 0a0a 2020 2020 6465 6620 7365 6e64 5f65  ..    def send_e
+00019940: 6d61 696c 5f73 6573 2873 656c 662c 2073  mail_ses(self, s
+00019950: 656e 6465 722c 2074 6f2c 2073 7562 6a65  ender, to, subje
+00019960: 6374 2c20 626f 6479 293a 0a20 2020 2020  ct, body):.     
+00019970: 2020 2027 2727 5573 696e 6720 4157 5320     '''Using AWS 
+00019980: 7365 7320 7365 7276 6963 6520 746f 2073  ses service to s
+00019990: 656e 6420 656d 6169 6c73 2727 270a 0a20  end emails'''.. 
+000199a0: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+000199b0: 6620 7265 7175 6972 6564 2070 6172 616d  f required param
+000199c0: 6574 6572 7320 6172 6520 7072 6f76 6964  eters are provid
+000199d0: 6564 0a20 2020 2020 2020 2069 6620 6e6f  ed.        if no
+000199e0: 7420 7365 6e64 6572 3a0a 2020 2020 2020  t sender:.      
+000199f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00019a00: 6545 7272 6f72 2827 5365 6e64 6572 2065  eError('Sender e
+00019a10: 6d61 696c 2061 6464 7265 7373 2069 7320  mail address is 
+00019a20: 7265 7175 6972 6564 2e27 290a 2020 2020  required.').    
+00019a30: 2020 2020 6966 206e 6f74 2074 6f3a 0a20      if not to:. 
+00019a40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00019a50: 2056 616c 7565 4572 726f 7228 2752 6563   ValueError('Rec
+00019a60: 6970 6965 6e74 2065 6d61 696c 2061 6464  ipient email add
+00019a70: 7265 7373 2069 7320 7265 7175 6972 6564  ress is required
+00019a80: 2e27 290a 2020 2020 2020 2020 6966 206e  .').        if n
+00019a90: 6f74 2073 7562 6a65 6374 3a0a 2020 2020  ot subject:.    
+00019aa0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00019ab0: 6c75 6545 7272 6f72 2827 456d 6169 6c20  lueError('Email 
+00019ac0: 7375 626a 6563 7420 6973 2072 6571 7569  subject is requi
+00019ad0: 7265 642e 2729 0a20 2020 2020 2020 2069  red.').        i
+00019ae0: 6620 6e6f 7420 626f 6479 3a0a 2020 2020  f not body:.    
+00019af0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00019b00: 6c75 6545 7272 6f72 2827 456d 6169 6c20  lueError('Email 
+00019b10: 626f 6479 2069 7320 7265 7175 6972 6564  body is required
+00019b20: 2e27 290a 0a20 2020 2020 2020 2073 6573  .')..        ses
+00019b30: 5f76 6572 6966 795f 7265 7175 6573 7473  _verify_requests
+00019b40: 5f73 656e 7420 3d20 7365 6c66 2e63 6667  _sent = self.cfg
+00019b50: 2e73 6573 5f76 6572 6966 795f 7265 7175  .ses_verify_requ
+00019b60: 6573 7473 5f73 656e 740a 0a20 2020 2020  ests_sent..     
+00019b70: 2020 2076 6572 6966 6965 645f 656d 6169     verified_emai
+00019b80: 6c5f 6164 6472 203d 205b 5d0a 2020 2020  l_addr = [].    
+00019b90: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00019ba0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+00019bb0: 7365 6c66 2e73 6573 5f63 6c69 656e 742e  self.ses_client.
+00019bc0: 6c69 7374 5f76 6572 6966 6965 645f 656d  list_verified_em
+00019bd0: 6169 6c5f 6164 6472 6573 7365 7328 290a  ail_addresses().
+00019be0: 2020 2020 2020 2020 2020 2020 7665 7269              veri
+00019bf0: 6669 6564 5f65 6d61 696c 5f61 6464 7220  fied_email_addr 
+00019c00: 3d20 7265 7370 6f6e 7365 2e67 6574 2827  = response.get('
+00019c10: 5665 7269 6669 6564 456d 6169 6c41 6464  VerifiedEmailAdd
+00019c20: 7265 7373 6573 272c 205b 5d29 0a20 2020  resses', []).   
+00019c30: 2020 2020 2065 7863 6570 7420 626f 746f       except boto
+00019c40: 636f 7265 2e65 7863 6570 7469 6f6e 732e  core.exceptions.
+00019c50: 436c 6965 6e74 4572 726f 7220 6173 2065  ClientError as e
+00019c60: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
+00019c70: 726f 725f 636f 6465 203d 2065 2e72 6573  ror_code = e.res
+00019c80: 706f 6e73 655b 2745 7272 6f72 275d 5b27  ponse['Error']['
+00019c90: 436f 6465 275d 0a20 2020 2020 2020 2020  Code'].         
+00019ca0: 2020 2069 6620 6572 726f 725f 636f 6465     if error_code
+00019cb0: 203d 3d20 2741 6363 6573 7344 656e 6965   == 'AccessDenie
+00019cc0: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
+00019cd0: 2020 2020 7072 696e 7464 6267 280a 2020      printdbg(.  
+00019ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cf0: 2020 6627 4163 6365 7373 2064 656e 6965    f'Access denie
+00019d00: 6420 746f 2053 4553 2061 6476 616e 6365  d to SES advance
+00019d10: 6420 6665 6174 7572 6573 2120 506c 6561  d features! Plea
+00019d20: 7365 2063 6865 636b 2079 6f75 7220 4941  se check your IA
+00019d30: 4d20 7065 726d 6973 7369 6f6e 732e 205c  M permissions. \
+00019d40: 6e45 7272 6f72 3a20 7b65 7d27 290a 2020  nError: {e}').  
+00019d50: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00019d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d70: 7072 696e 7428 6627 436c 6965 6e74 2045  print(f'Client E
+00019d80: 7272 6f72 3a20 7b65 7d27 290a 2020 2020  rror: {e}').    
+00019d90: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00019da0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00019db0: 2020 2020 2020 2070 7269 6e74 2866 274f         print(f'O
+00019dc0: 7468 6572 2045 7272 6f72 3a20 7b65 7d27  ther Error: {e}'
+00019dd0: 290a 0a20 2020 2020 2020 2063 6865 636b  )..        check
+00019de0: 7320 3d20 5b73 656e 6465 722c 2074 6f5d  s = [sender, to]
+00019df0: 0a20 2020 2020 2020 2063 6865 636b 7320  .        checks 
+00019e00: 3d20 6c69 7374 2873 6574 2863 6865 636b  = list(set(check
+00019e10: 7329 2920 2023 2072 656d 6f76 6520 6475  s))  # remove du
+00019e20: 706c 6963 6174 6573 0a20 2020 2020 2020  plicates.       
+00019e30: 2065 6d61 696c 5f6c 6973 7420 3d20 5b5d   email_list = []
+00019e40: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+00019e50: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+00019e60: 6865 636b 2069 6e20 6368 6563 6b73 3a0a  heck in checks:.
+00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e80: 6966 2063 6865 636b 206e 6f74 2069 6e20  if check not in 
+00019e90: 7665 7269 6669 6564 5f65 6d61 696c 5f61  verified_email_a
+00019ea0: 6464 7220 616e 6420 6368 6563 6b20 6e6f  ddr and check no
+00019eb0: 7420 696e 2073 6573 5f76 6572 6966 795f  t in ses_verify_
+00019ec0: 7265 7175 6573 7473 5f73 656e 743a 0a20  requests_sent:. 
+00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ee0: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
+00019ef0: 6c66 2e73 6573 5f63 6c69 656e 742e 7665  lf.ses_client.ve
+00019f00: 7269 6679 5f65 6d61 696c 5f69 6465 6e74  rify_email_ident
+00019f10: 6974 7928 0a20 2020 2020 2020 2020 2020  ity(.           
+00019f20: 2020 2020 2020 2020 2020 2020 2045 6d61               Ema
+00019f30: 696c 4164 6472 6573 733d 6368 6563 6b29  ilAddress=check)
+00019f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019f50: 2020 2020 2065 6d61 696c 5f6c 6973 742e       email_list.
+00019f60: 6170 7065 6e64 2863 6865 636b 290a 2020  append(check).  
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fa0: 2066 277b 6368 6563 6b7d 2077 6173 2075   f'{check} was u
+00019fb0: 7365 6420 666f 7220 7468 6520 6669 7273  sed for the firs
+00019fc0: 7420 7469 6d65 2c20 7665 7269 6669 6361  t time, verifica
+00019fd0: 7469 6f6e 2065 6d61 696c 2073 656e 742e  tion email sent.
+00019fe0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00019ff0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0001a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a010: 2020 2020 2020 2750 6c65 6173 6520 6861        'Please ha
+0001a020: 7665 207b 6368 6563 6b7d 2063 6865 636b  ve {check} check
+0001a030: 2069 6e62 6f78 2061 6e64 2063 6f6e 6669   inbox and confi
+0001a040: 726d 2065 6d61 696c 2066 726f 6d20 4157  rm email from AW
+0001a050: 532e 5c6e 2729 0a0a 2020 2020 2020 2020  S.\n')..        
+0001a060: 6578 6365 7074 2062 6f74 6f63 6f72 652e  except botocore.
+0001a070: 6578 6365 7074 696f 6e73 2e43 6c69 656e  exceptions.Clien
+0001a080: 7445 7272 6f72 2061 7320 653a 0a20 2020  tError as e:.   
+0001a090: 2020 2020 2020 2020 2065 7272 6f72 5f63           error_c
+0001a0a0: 6f64 6520 3d20 652e 7265 7370 6f6e 7365  ode = e.response
+0001a0b0: 5b27 4572 726f 7227 5d5b 2743 6f64 6527  ['Error']['Code'
+0001a0c0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0001a0d0: 2065 7272 6f72 5f63 6f64 6520 3d3d 2027   error_code == '
+0001a0e0: 4163 6365 7373 4465 6e69 6564 273a 0a20  AccessDenied':. 
+0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001a100: 7269 6e74 6462 6728 0a20 2020 2020 2020  rintdbg(.       
+0001a110: 2020 2020 2020 2020 2020 2020 2066 2741               f'A
+0001a120: 6363 6573 7320 6465 6e69 6564 2074 6f20  ccess denied to 
+0001a130: 5345 5320 6164 7661 6e63 6564 2066 6561  SES advanced fea
+0001a140: 7475 7265 7321 2050 6c65 6173 6520 6368  tures! Please ch
+0001a150: 6563 6b20 796f 7572 2049 414d 2070 6572  eck your IAM per
+0001a160: 6d69 7373 696f 6e73 2e20 5c6e 4572 726f  missions. \nErro
+0001a170: 723a 207b 657d 2729 0a20 2020 2020 2020  r: {e}').       
+0001a180: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001a190: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001a1a0: 2866 2743 6c69 656e 7420 4572 726f 723a  (f'Client Error:
+0001a1b0: 207b 657d 2729 0a20 2020 2020 2020 2065   {e}').        e
+0001a1c0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+0001a1d0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001a1e0: 2020 7072 696e 7428 6627 4f74 6865 7220    print(f'Other 
+0001a1f0: 4572 726f 723a 207b 657d 2729 0a0a 2020  Error: {e}')..  
+0001a200: 2020 2020 2020 7365 6c66 2e63 6667 2e73        self.cfg.s
+0001a210: 6573 5f76 6572 6966 795f 7265 7175 6573  es_verify_reques
+0001a220: 7473 5f73 656e 7428 656d 6169 6c5f 6c69  ts_sent(email_li
+0001a230: 7374 290a 0a20 2020 2020 2020 2074 7279  st)..        try
+0001a240: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001a250: 7370 6f6e 7365 203d 2073 656c 662e 7365  sponse = self.se
+0001a260: 735f 636c 6965 6e74 2e73 656e 645f 656d  s_client.send_em
+0001a270: 6169 6c28 0a20 2020 2020 2020 2020 2020  ail(.           
+0001a280: 2020 2020 2053 6f75 7263 653d 7365 6e64       Source=send
+0001a290: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0001a2a0: 2020 2020 4465 7374 696e 6174 696f 6e3d      Destination=
+0001a2b0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001a2c0: 2020 2020 2020 2754 6f41 6464 7265 7373        'ToAddress
+0001a2d0: 6573 273a 205b 746f 5d0a 2020 2020 2020  es': [to].      
+0001a2e0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+0001a2f0: 2020 2020 2020 2020 2020 2020 204d 6573               Mes
+0001a300: 7361 6765 3d7b 0a20 2020 2020 2020 2020  sage={.         
+0001a310: 2020 2020 2020 2020 2020 2027 5375 626a             'Subj
+0001a320: 6563 7427 3a20 7b0a 2020 2020 2020 2020  ect': {.        
+0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a340: 2744 6174 6127 3a20 7375 626a 6563 740a  'Data': subject.
+0001a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a360: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+0001a370: 2020 2020 2020 2020 2020 2027 426f 6479             'Body
+0001a380: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
+0001a390: 2020 2020 2020 2020 2020 2020 2027 5465               'Te
+0001a3a0: 7874 273a 207b 0a20 2020 2020 2020 2020  xt': {.         
+0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3c0: 2020 2027 4461 7461 273a 2062 6f64 790a     'Data': body.
+0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3e0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a410: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
+0001a420: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001a430: 7428 6627 5365 6e74 2065 6d61 696c 2022  t(f'Sent email "
+0001a440: 7b73 7562 6a65 6374 7d22 2074 6f20 7b74  {subject}" to {t
+0001a450: 6f7d 2127 290a 2020 2020 2020 2020 6578  o}!').        ex
+0001a460: 6365 7074 2062 6f74 6f63 6f72 652e 6578  cept botocore.ex
+0001a470: 6365 7074 696f 6e73 2e43 6c69 656e 7445  ceptions.ClientE
+0001a480: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0001a490: 2020 2020 2020 2065 7272 6f72 5f63 6f64         error_cod
+0001a4a0: 6520 3d20 652e 7265 7370 6f6e 7365 5b27  e = e.response['
+0001a4b0: 4572 726f 7227 5d5b 2743 6f64 6527 5d0a  Error']['Code'].
+0001a4c0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0001a4d0: 7272 6f72 5f63 6f64 6520 3d3d 2027 4d65  rror_code == 'Me
+0001a4e0: 7373 6167 6552 656a 6563 7465 6427 3a0a  ssageRejected':.
+0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a500: 7072 696e 7428 6627 4d65 7373 6167 6520  print(f'Message 
+0001a510: 7761 7320 7265 6a65 6374 6564 2c20 4572  was rejected, Er
+0001a520: 726f 723a 207b 657d 2729 0a20 2020 2020  ror: {e}').     
+0001a530: 2020 2020 2020 2065 6c69 6620 6572 726f         elif erro
+0001a540: 725f 636f 6465 203d 3d20 2741 6363 6573  r_code == 'Acces
+0001a550: 7344 656e 6965 6427 3a0a 2020 2020 2020  sDenied':.      
+0001a560: 2020 2020 2020 2020 2020 7072 696e 7464            printd
+0001a570: 6267 280a 2020 2020 2020 2020 2020 2020  bg(.            
+0001a580: 2020 2020 2020 2020 6627 4163 6365 7373          f'Access
+0001a590: 2064 656e 6965 6420 746f 2053 4553 2061   denied to SES a
+0001a5a0: 6476 616e 6365 6420 6665 6174 7572 6573  dvanced features
+0001a5b0: 2120 506c 6561 7365 2063 6865 636b 2079  ! Please check y
+0001a5c0: 6f75 7220 4941 4d20 7065 726d 6973 7369  our IAM permissi
+0001a5d0: 6f6e 732e 205c 6e45 7272 6f72 3a20 7b65  ons. \nError: {e
+0001a5e0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+0001a5f0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0001a600: 6172 6773 2e64 6562 7567 3a0a 2020 2020  args.debug:.    
+0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a620: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0001a630: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001a640: 2043 616e 6e6f 7420 7573 6520 5345 5320   Cannot use SES 
+0001a650: 656d 6169 6c20 6665 6174 7572 6573 2074  email features t
+0001a660: 6f20 7365 6e64 2079 6f75 2073 7461 7475  o send you statu
+0001a670: 7320 6d65 7373 6167 6573 3a20 4163 6365  s messages: Acce
+0001a680: 7373 4465 6e69 6564 2729 0a20 2020 2020  ssDenied').     
+0001a690: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001a6a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001a6b0: 6e74 2866 2743 6c69 656e 7420 4572 726f  nt(f'Client Erro
+0001a6c0: 723a 207b 657d 2729 0a20 2020 2020 2020  r: {e}').       
+0001a6d0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001a6e0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0001a6f0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+0001a700: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001a710: 6e74 2866 274f 7468 6572 2045 7272 6f72  nt(f'Other Error
+0001a720: 3a20 7b65 7d27 290a 2020 2020 2020 2020  : {e}').        
+0001a730: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001a740: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a750: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+0001a760: 5468 6520 6265 6c6f 7720 4149 4d20 706f  The below AIM po
+0001a770: 6c69 6379 2069 7320 6e65 6564 6564 2069  licy is needed i
+0001a780: 6620 796f 7520 646f 206e 6f74 2077 616e  f you do not wan
+0001a790: 7420 746f 2063 6f6e 6669 726d 0a20 2020  t to confirm.   
+0001a7a0: 2020 2020 2023 2065 6163 6820 616e 6420       # each and 
+0001a7b0: 6576 6572 7920 656d 6169 6c20 796f 7520  every email you 
+0001a7c0: 7761 6e74 2074 6f20 7365 6e64 2074 6f2e  want to send to.
+0001a7d0: 0a0a 2020 2020 2020 2020 2320 6961 6d20  ..        # iam 
+0001a7e0: 3d20 626f 746f 332e 636c 6965 6e74 2827  = boto3.client('
+0001a7f0: 6961 6d27 290a 2020 2020 2020 2020 2320  iam').        # 
+0001a800: 706f 6c69 6379 5f64 6f63 756d 656e 7420  policy_document 
+0001a810: 3d20 7b0a 2020 2020 2020 2020 2320 2020  = {.        #   
+0001a820: 2020 2256 6572 7369 6f6e 223a 2022 3230    "Version": "20
+0001a830: 3132 2d31 302d 3137 222c 0a20 2020 2020  12-10-17",.     
+0001a840: 2020 2023 2020 2020 2022 5374 6174 656d     #     "Statem
+0001a850: 656e 7422 3a20 5b0a 2020 2020 2020 2020  ent": [.        
+0001a860: 2320 2020 2020 2020 2020 7b0a 2020 2020  #         {.    
+0001a870: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0001a880: 2020 2245 6666 6563 7422 3a20 2241 6c6c    "Effect": "All
+0001a890: 6f77 222c 0a20 2020 2020 2020 2023 2020  ow",.        #  
+0001a8a0: 2020 2020 2020 2020 2020 2022 4163 7469             "Acti
+0001a8b0: 6f6e 223a 205b 0a20 2020 2020 2020 2023  on": [.        #
+0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8d0: 2022 7365 733a 5365 6e64 456d 6169 6c22   "ses:SendEmail"
+0001a8e0: 2c0a 2020 2020 2020 2020 2320 2020 2020  ,.        #     
+0001a8f0: 2020 2020 2020 2020 2020 2020 2273 6573              "ses
+0001a900: 3a53 656e 6452 6177 456d 6169 6c22 0a20  :SendRawEmail". 
+0001a910: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0001a920: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+0001a930: 2320 2020 2020 2020 2020 2020 2020 2252  #             "R
+0001a940: 6573 6f75 7263 6522 3a20 222a 220a 2020  esource": "*".  
+0001a950: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0001a960: 7d0a 2020 2020 2020 2020 2320 2020 2020  }.        #     
+0001a970: 5d0a 2020 2020 2020 2020 2320 7d0a 0a20  ].        # }.. 
+0001a980: 2020 2020 2020 2023 2070 6f6c 6963 795f         # policy_
+0001a990: 6e61 6d65 203d 2027 5345 535f 5365 6e64  name = 'SES_Send
+0001a9a0: 456d 6169 6c5f 506f 6c69 6379 270a 0a20  Email_Policy'.. 
+0001a9b0: 2020 2020 2020 2023 2070 6f6c 6963 795f         # policy_
+0001a9c0: 6172 6e20 3d20 7365 6c66 2e5f 6563 325f  arn = self._ec2_
+0001a9d0: 6372 6561 7465 5f6f 725f 6765 745f 6961  create_or_get_ia
+0001a9e0: 6d5f 706f 6c69 6379 280a 2020 2020 2020  m_policy(.      
+0001a9f0: 2020 2320 2020 2020 706f 6c69 6379 5f6e    #     policy_n
+0001aa00: 616d 652c 2070 6f6c 6963 795f 646f 6375  ame, policy_docu
+0001aa10: 6d65 6e74 2c20 7072 6f66 696c 6529 0a0a  ment, profile)..
+0001aa20: 2020 2020 2020 2020 2320 7573 6572 6e61          # userna
+0001aa30: 6d65 203d 2027 796f 7572 5f69 616d 5f75  me = 'your_iam_u
+0001aa40: 7365 726e 616d 6527 2020 2320 4368 616e  sername'  # Chan
+0001aa50: 6765 2074 6869 7320 746f 2074 6865 2075  ge this to the u
+0001aa60: 7365 726e 616d 6520 796f 7520 7769 7368  sername you wish
+0001aa70: 2074 6f20 6174 7461 6368 2074 6865 2070   to attach the p
+0001aa80: 6f6c 6963 7920 746f 0a0a 2020 2020 2020  olicy to..      
+0001aa90: 2020 2320 7265 7370 6f6e 7365 203d 2069    # response = i
+0001aaa0: 616d 2e61 7474 6163 685f 7573 6572 5f70  am.attach_user_p
+0001aab0: 6f6c 6963 7928 0a20 2020 2020 2020 2023  olicy(.        #
+0001aac0: 2020 2020 2055 7365 724e 616d 653d 7573       UserName=us
+0001aad0: 6572 6e61 6d65 2c0a 2020 2020 2020 2020  ername,.        
+0001aae0: 2320 2020 2020 506f 6c69 6379 4172 6e3d  #     PolicyArn=
+0001aaf0: 706f 6c69 6379 5f61 726e 0a20 2020 2020  policy_arn.     
+0001ab00: 2020 2023 2029 0a0a 2020 2020 2020 2020     # )..        
+0001ab10: 2320 7072 696e 7428 6622 506f 6c69 6379  # print(f"Policy
+0001ab20: 207b 706f 6c69 6379 5f61 726e 7d20 6174   {policy_arn} at
+0001ab30: 7461 6368 6564 2074 6f20 7573 6572 207b  tached to user {
+0001ab40: 7573 6572 6e61 6d65 7d22 290a 0a20 2020  username}")..   
+0001ab50: 2064 6566 2073 656e 645f 6563 325f 636f   def send_ec2_co
+0001ab60: 7374 7328 7365 6c66 2c20 696e 7374 616e  sts(self, instan
+0001ab70: 6365 5f69 6429 3a0a 2020 2020 2020 2020  ce_id):.        
+0001ab80: 7061 7373 0a0a 2020 2020 6465 6620 5f65  pass..    def _e
+0001ab90: 6332 5f63 7265 6174 655f 6961 6d5f 636f  c2_create_iam_co
+0001aba0: 7374 6578 706c 6f72 6572 5f73 6573 2873  stexplorer_ses(s
+0001abb0: 656c 662c 2069 6e73 7461 6e63 655f 6964  elf, instance_id
+0001abc0: 293a 0a0a 2020 2020 2020 2020 2320 4465  ):..        # De
+0001abd0: 6669 6e65 2074 6865 2070 6f6c 6963 790a  fine the policy.
+0001abe0: 2020 2020 2020 2020 706f 6c69 6379 5f64          policy_d
+0001abf0: 6f63 756d 656e 7420 3d20 7b0a 2020 2020  ocument = {.    
+0001ac00: 2020 2020 2020 2020 2256 6572 7369 6f6e          "Version
+0001ac10: 223a 2022 3230 3132 2d31 302d 3137 222c  ": "2012-10-17",
+0001ac20: 0a20 2020 2020 2020 2020 2020 2022 5374  .            "St
+0001ac30: 6174 656d 656e 7422 3a20 5b0a 2020 2020  atement": [.    
+0001ac40: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac60: 2020 2245 6666 6563 7422 3a20 2241 6c6c    "Effect": "All
+0001ac70: 6f77 222c 0a20 2020 2020 2020 2020 2020  ow",.           
+0001ac80: 2020 2020 2020 2020 2022 4163 7469 6f6e           "Action
+0001ac90: 223a 2022 7365 733a 5365 6e64 456d 6169  ": "ses:SendEmai
+0001aca0: 6c22 2c0a 2020 2020 2020 2020 2020 2020  l",.            
+0001acb0: 2020 2020 2020 2020 2252 6573 6f75 7263          "Resourc
+0001acc0: 6522 3a20 222a 220a 2020 2020 2020 2020  e": "*".        
+0001acd0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+0001ace0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
+0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad00: 2022 4566 6665 6374 223a 2022 416c 6c6f   "Effect": "Allo
+0001ad10: 7722 2c0a 2020 2020 2020 2020 2020 2020  w",.            
+0001ad20: 2020 2020 2020 2020 2241 6374 696f 6e22          "Action"
+0001ad30: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
+0001ad40: 2020 2020 2020 2020 2020 2020 2263 653a              "ce:
+0001ad50: 2a22 2c20 2020 2020 2020 2020 2020 2020  *",             
+0001ad60: 2023 2050 6572 6d69 7373 696f 6e73 2066   # Permissions f
+0001ad70: 6f72 2043 6f73 7420 4578 706c 6f72 6572  or Cost Explorer
+0001ad80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad90: 2020 2020 2020 2020 2022 6365 3a47 6574           "ce:Get
+0001ada0: 436f 7374 416e 6455 7361 6765 222c 2020  CostAndUsage",  
+0001adb0: 2320 616c 6c0a 2020 2020 2020 2020 2020  # all.          
+0001adc0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
+0001add0: 6332 3a44 6573 6372 6962 652a 222c 2020  c2:Describe*",  
+0001ade0: 2020 2023 2042 6173 6963 2045 4332 2072     # Basic EC2 r
+0001adf0: 6561 6420 7065 726d 6973 7369 6f6e 730a  ead permissions.
+0001ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae10: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
+0001ae20: 2020 2020 2020 2020 2020 2022 5265 736f             "Reso
+0001ae30: 7572 6365 223a 2022 2a22 0a20 2020 2020  urce": "*".     
+0001ae40: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+0001ae50: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0001ae60: 2020 207d 0a0a 2020 2020 2020 2020 2320     }..        # 
+0001ae70: 5374 6570 2031 3a20 4372 6561 7465 2074  Step 1: Create t
+0001ae80: 6865 2070 6f6c 6963 7920 696e 2049 414d  he policy in IAM
+0001ae90: 0a20 2020 2020 2020 2070 6f6c 6963 795f  .        policy_
+0001aea0: 6e61 6d65 203d 2022 436f 7374 4578 706c  name = "CostExpl
+0001aeb0: 6f72 6572 5345 5350 6f6c 6963 7922 0a0a  orerSESPolicy"..
+0001aec0: 2020 2020 2020 2020 706f 6c69 6379 5f61          policy_a
+0001aed0: 726e 203d 2073 656c 662e 5f65 6332 5f63  rn = self._ec2_c
+0001aee0: 7265 6174 655f 6f72 5f67 6574 5f69 616d  reate_or_get_iam
+0001aef0: 5f70 6f6c 6963 7928 0a20 2020 2020 2020  _policy(.       
+0001af00: 2020 2020 2070 6f6c 6963 795f 6e61 6d65       policy_name
+0001af10: 2c20 706f 6c69 6379 5f64 6f63 756d 656e  , policy_documen
+0001af20: 7429 0a0a 2020 2020 2020 2020 2320 5374  t)..        # St
+0001af30: 6570 2032 3a20 5265 7472 6965 7665 2074  ep 2: Retrieve t
+0001af40: 6865 2049 414d 2069 6e73 7461 6e63 6520  he IAM instance 
+0001af50: 7072 6f66 696c 6520 6174 7461 6368 6564  profile attached
+0001af60: 2074 6f20 7468 6520 4543 3220 696e 7374   to the EC2 inst
+0001af70: 616e 6365 0a20 2020 2020 2020 2072 6573  ance.        res
+0001af80: 706f 6e73 6520 3d20 7365 6c66 2e65 6332  ponse = self.ec2
+0001af90: 5f63 6c69 656e 742e 6465 7363 7269 6265  _client.describe
+0001afa0: 5f69 6e73 7461 6e63 6573 280a 2020 2020  _instances(.    
+0001afb0: 2020 2020 2020 2020 496e 7374 616e 6365          Instance
+0001afc0: 4964 733d 5b69 6e73 7461 6e63 655f 6964  Ids=[instance_id
+0001afd0: 5d29 0a20 2020 2020 2020 2069 6e73 7461  ]).        insta
+0001afe0: 6e63 655f 6461 7461 203d 2072 6573 706f  nce_data = respo
+0001aff0: 6e73 655b 2752 6573 6572 7661 7469 6f6e  nse['Reservation
+0001b000: 7327 5d5b 305d 5b27 496e 7374 616e 6365  s'][0]['Instance
+0001b010: 7327 5d5b 305d 0a20 2020 2020 2020 2069  s'][0].        i
+0001b020: 6620 2749 616d 496e 7374 616e 6365 5072  f 'IamInstancePr
+0001b030: 6f66 696c 6527 206e 6f74 2069 6e20 696e  ofile' not in in
+0001b040: 7374 616e 6365 5f64 6174 613a 0a20 2020  stance_data:.   
+0001b050: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b070: 6622 4e6f 2049 414d 2049 6e73 7461 6e63  f"No IAM Instanc
+0001b080: 6520 5072 6f66 696c 6520 6174 7461 6368  e Profile attach
+0001b090: 6564 2074 6f20 7468 6520 696e 7374 616e  ed to the instan
+0001b0a0: 6365 3a20 7b69 6e73 7461 6e63 655f 6964  ce: {instance_id
+0001b0b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001b0c0: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+0001b0d0: 2020 2020 2020 696e 7374 616e 6365 5f70        instance_p
+0001b0e0: 726f 6669 6c65 5f61 726e 203d 2072 6573  rofile_arn = res
+0001b0f0: 706f 6e73 655b 2752 6573 6572 7661 7469  ponse['Reservati
+0001b100: 6f6e 7327 5d5b 305d 5b27 496e 7374 616e  ons'][0]['Instan
+0001b110: 6365 7327 5d5b 305d 5b27 4961 6d49 6e73  ces'][0]['IamIns
+0001b120: 7461 6e63 6550 726f 6669 6c65 275d 5b27  tanceProfile']['
+0001b130: 4172 6e27 5d0a 0a20 2020 2020 2020 2023  Arn']..        #
+0001b140: 2045 7874 7261 6374 2074 6865 2069 6e73   Extract the ins
+0001b150: 7461 6e63 6520 7072 6f66 696c 6520 6e61  tance profile na
+0001b160: 6d65 2066 726f 6d20 6974 7320 4152 4e0a  me from its ARN.
+0001b170: 2020 2020 2020 2020 696e 7374 616e 6365          instance
+0001b180: 5f70 726f 6669 6c65 5f6e 616d 6520 3d20  _profile_name = 
+0001b190: 696e 7374 616e 6365 5f70 726f 6669 6c65  instance_profile
+0001b1a0: 5f61 726e 2e73 706c 6974 2827 2f27 295b  _arn.split('/')[
+0001b1b0: 2d31 5d0a 0a20 2020 2020 2020 2023 2053  -1]..        # S
+0001b1c0: 7465 7020 333a 2046 6574 6368 2074 6865  tep 3: Fetch the
+0001b1d0: 2072 6f6c 6520 6e61 6d65 2066 726f 6d20   role name from 
+0001b1e0: 7468 6520 696e 7374 616e 6365 2070 726f  the instance pro
+0001b1f0: 6669 6c65 0a20 2020 2020 2020 2072 6573  file.        res
+0001b200: 706f 6e73 6520 3d20 7365 6c66 2e69 616d  ponse = self.iam
+0001b210: 5f63 6c69 656e 742e 6765 745f 696e 7374  _client.get_inst
+0001b220: 616e 6365 5f70 726f 6669 6c65 280a 2020  ance_profile(.  
+0001b230: 2020 2020 2020 2020 2020 496e 7374 616e            Instan
+0001b240: 6365 5072 6f66 696c 654e 616d 653d 696e  ceProfileName=in
+0001b250: 7374 616e 6365 5f70 726f 6669 6c65 5f6e  stance_profile_n
+0001b260: 616d 6529 0a20 2020 2020 2020 2072 6f6c  ame).        rol
+0001b270: 655f 6e61 6d65 203d 2072 6573 706f 6e73  e_name = respons
+0001b280: 655b 2749 6e73 7461 6e63 6550 726f 6669  e['InstanceProfi
+0001b290: 6c65 275d 5b27 526f 6c65 7327 5d5b 305d  le']['Roles'][0]
+0001b2a0: 5b27 526f 6c65 4e61 6d65 275d 0a0a 2020  ['RoleName']..  
+0001b2b0: 2020 2020 2020 2320 5374 6570 2034 3a20        # Step 4: 
+0001b2c0: 4174 7461 6368 2074 6865 2064 6573 6972  Attach the desir
+0001b2d0: 6564 2070 6f6c 6963 7920 746f 2074 6865  ed policy to the
+0001b2e0: 2072 6f6c 650a 2020 2020 2020 2020 7472   role.        tr
+0001b2f0: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+0001b300: 656c 662e 6961 6d5f 636c 6965 6e74 2e61  elf.iam_client.a
+0001b310: 7474 6163 685f 726f 6c65 5f70 6f6c 6963  ttach_role_polic
+0001b320: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+0001b330: 2020 2052 6f6c 654e 616d 653d 726f 6c65     RoleName=role
+0001b340: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+0001b350: 2020 2020 2020 2050 6f6c 6963 7941 726e         PolicyArn
+0001b360: 3d70 6f6c 6963 795f 6172 6e0a 2020 2020  =policy_arn.    
+0001b370: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001b380: 2020 2020 2020 7072 696e 7428 6622 506f        print(f"Po
+0001b390: 6c69 6379 207b 706f 6c69 6379 5f61 726e  licy {policy_arn
+0001b3a0: 7d20 6174 7461 6368 6564 2074 6f20 726f  } attached to ro
+0001b3b0: 6c65 207b 726f 6c65 5f6e 616d 657d 2229  le {role_name}")
+0001b3c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001b3d0: 7365 6c66 2e69 616d 5f63 6c69 656e 742e  self.iam_client.
+0001b3e0: 6578 6365 7074 696f 6e73 2e4e 6f53 7563  exceptions.NoSuc
+0001b3f0: 6845 6e74 6974 7945 7863 6570 7469 6f6e  hEntityException
+0001b400: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0001b410: 696e 7428 6622 526f 6c65 207b 726f 6c65  int(f"Role {role
+0001b420: 5f6e 616d 657d 2064 6f65 7320 6e6f 7420  _name} does not 
+0001b430: 6578 6973 7421 2229 0a20 2020 2020 2020  exist!").       
+0001b440: 2065 7863 6570 7420 7365 6c66 2e69 616d   except self.iam
+0001b450: 5f63 6c69 656e 742e 6578 6365 7074 696f  _client.exceptio
+0001b460: 6e73 2e49 6e76 616c 6964 496e 7075 7445  ns.InvalidInputE
+0001b470: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0001b480: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001b490: 2866 2249 6e76 616c 6964 2069 6e70 7574  (f"Invalid input
+0001b4a0: 3a20 7b65 7d22 290a 2020 2020 2020 2020  : {e}").        
+0001b4b0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0001b4c0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0001b4d0: 2020 2070 7269 6e74 2866 224f 7468 6572     print(f"Other
+0001b4e0: 2045 7272 6f72 3a20 7b65 7d22 290a 0a20   Error: {e}").. 
+0001b4f0: 2020 2064 6566 205f 6563 325f 6372 6561     def _ec2_crea
+0001b500: 7465 5f69 616d 5f73 656c 665f 6465 7374  te_iam_self_dest
+0001b510: 7275 6374 5f72 6f6c 6528 7365 6c66 293a  ruct_role(self):
+0001b520: 0a0a 2020 2020 2020 2020 2320 5374 6570  ..        # Step
+0001b530: 2031 3a20 4372 6561 7465 2049 414d 2070   1: Create IAM p
+0001b540: 6f6c 6963 790a 2020 2020 2020 2020 706f  olicy.        po
+0001b550: 6c69 6379 5f64 6f63 756d 656e 7420 3d20  licy_document = 
+0001b560: 7b0a 2020 2020 2020 2020 2020 2020 2256  {.            "V
+0001b570: 6572 7369 6f6e 223a 2022 3230 3132 2d31  ersion": "2012-1
+0001b580: 302d 3137 222c 0a20 2020 2020 2020 2020  0-17",.         
+0001b590: 2020 2022 5374 6174 656d 656e 7422 3a20     "Statement": 
+0001b5a0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0001b5b0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+0001b5c0: 2020 2020 2020 2020 2245 6666 6563 7422          "Effect"
+0001b5d0: 3a20 2241 6c6c 6f77 222c 0a20 2020 2020  : "Allow",.     
+0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b5f0: 4163 7469 6f6e 223a 2022 6563 323a 5465  Action": "ec2:Te
+0001b600: 726d 696e 6174 6549 6e73 7461 6e63 6573  rminateInstances
+0001b610: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0001b620: 2020 2020 2020 2022 5265 736f 7572 6365         "Resource
+0001b630: 223a 2022 2a22 2c0a 2020 2020 2020 2020  ": "*",.        
+0001b640: 2020 2020 2020 2020 2020 2020 2243 6f6e              "Con
+0001b650: 6469 7469 6f6e 223a 207b 0a20 2020 2020  dition": {.     
+0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b670: 2020 2022 5374 7269 6e67 4571 7561 6c73     "StringEquals
+0001b680: 223a 207b 0a20 2020 2020 2020 2020 2020  ": {.           
+0001b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6a0: 2022 6563 323a 5265 736f 7572 6365 5461   "ec2:ResourceTa
+0001b6b0: 672f 4e61 6d65 223a 2022 4672 6f73 7465  g/Name": "Froste
+0001b6c0: 7253 656c 6644 6573 7472 7563 7422 0a20  rSelfDestruct". 
+0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001b6f0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0001b700: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0001b710: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
+0001b720: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001b730: 2070 6f6c 6963 795f 6e61 6d65 203d 2027   policy_name = '
+0001b740: 5365 6c66 4465 7374 7275 6374 506f 6c69  SelfDestructPoli
+0001b750: 6379 270a 0a20 2020 2020 2020 2070 6f6c  cy'..        pol
+0001b760: 6963 795f 6172 6e20 3d20 7365 6c66 2e5f  icy_arn = self._
+0001b770: 6563 325f 6372 6561 7465 5f6f 725f 6765  ec2_create_or_ge
+0001b780: 745f 6961 6d5f 706f 6c69 6379 280a 2020  t_iam_policy(.  
+0001b790: 2020 2020 2020 2020 2020 706f 6c69 6379            policy
+0001b7a0: 5f6e 616d 652c 2070 6f6c 6963 795f 646f  _name, policy_do
+0001b7b0: 6375 6d65 6e74 290a 0a20 2020 2020 2020  cument)..       
+0001b7c0: 2023 2053 7465 7020 323a 2043 7265 6174   # Step 2: Creat
+0001b7d0: 6520 616e 2049 414d 2072 6f6c 6520 616e  e an IAM role an
+0001b7e0: 6420 6174 7461 6368 2074 6865 2070 6f6c  d attach the pol
+0001b7f0: 6963 790a 2020 2020 2020 2020 7472 7573  icy.        trus
+0001b800: 745f 7265 6c61 7469 6f6e 7368 6970 203d  t_relationship =
+0001b810: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+0001b820: 5665 7273 696f 6e22 3a20 2232 3031 322d  Version": "2012-
+0001b830: 3130 2d31 3722 2c0a 2020 2020 2020 2020  10-17",.        
+0001b840: 2020 2020 2253 7461 7465 6d65 6e74 223a      "Statement":
+0001b850: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0001b860: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+0001b870: 2020 2020 2020 2020 2022 4566 6665 6374           "Effect
+0001b880: 223a 2022 416c 6c6f 7722 2c0a 2020 2020  ": "Allow",.    
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2250 7269 6e63 6970 616c 223a 207b 0a20  "Principal": {. 
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8c0: 2020 2020 2020 2022 5365 7276 6963 6522         "Service"
+0001b8d0: 3a20 2265 6332 2e61 6d61 7a6f 6e61 7773  : "ec2.amazonaws
+0001b8e0: 2e63 6f6d 220a 2020 2020 2020 2020 2020  .com".          
+0001b8f0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+0001b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b910: 2022 4163 7469 6f6e 223a 2022 7374 733a   "Action": "sts:
+0001b920: 4173 7375 6d65 526f 6c65 220a 2020 2020  AssumeRole".    
+0001b930: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0001b940: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+0001b950: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+0001b960: 6f6c 655f 6e61 6d65 203d 2027 5365 6c66  ole_name = 'Self
+0001b970: 4465 7374 7275 6374 526f 6c65 270a 2020  DestructRole'.  
+0001b980: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001b990: 2020 2020 2020 2073 656c 662e 6961 6d5f         self.iam_
+0001b9a0: 636c 6965 6e74 2e63 7265 6174 655f 726f  client.create_ro
+0001b9b0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0001b9c0: 2020 2020 526f 6c65 4e61 6d65 3d72 6f6c      RoleName=rol
+0001b9d0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+0001b9e0: 2020 2020 2020 2020 4173 7375 6d65 526f          AssumeRo
+0001b9f0: 6c65 506f 6c69 6379 446f 6375 6d65 6e74  lePolicyDocument
+0001ba00: 3d6a 736f 6e2e 6475 6d70 7328 7472 7573  =json.dumps(trus
+0001ba10: 745f 7265 6c61 7469 6f6e 7368 6970 292c  t_relationship),
+0001ba20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ba30: 2044 6573 6372 6970 7469 6f6e 3d27 416c   Description='Al
+0001ba40: 6c6f 7773 2045 4332 2069 6e73 7461 6e63  lows EC2 instanc
+0001ba50: 6573 2074 6f20 6361 6c6c 2041 5753 2073  es to call AWS s
+0001ba60: 6572 7669 6365 7320 6f6e 2079 6f75 7220  ervices on your 
+0001ba70: 6265 6861 6c66 2e27 0a20 2020 2020 2020  behalf.'.       
+0001ba80: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+0001ba90: 7863 6570 7420 7365 6c66 2e69 616d 5f63  xcept self.iam_c
+0001baa0: 6c69 656e 742e 6578 6365 7074 696f 6e73  lient.exceptions
+0001bab0: 2e45 6e74 6974 7941 6c72 6561 6479 4578  .EntityAlreadyEx
+0001bac0: 6973 7473 4578 6365 7074 696f 6e3a 0a20  istsException:. 
+0001bad0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001bae0: 2827 4941 4d20 5365 6c66 4465 7374 7275  ('IAM SelfDestru
+0001baf0: 6374 526f 6c65 2061 6c72 6561 6479 2065  ctRole already e
+0001bb00: 7869 7374 732e 2729 0a0a 2020 2020 2020  xists.')..      
+0001bb10: 2020 7365 6c66 2e69 616d 5f63 6c69 656e    self.iam_clien
+0001bb20: 742e 6174 7461 6368 5f72 6f6c 655f 706f  t.attach_role_po
+0001bb30: 6c69 6379 280a 2020 2020 2020 2020 2020  licy(.          
+0001bb40: 2020 526f 6c65 4e61 6d65 3d72 6f6c 655f    RoleName=role_
+0001bb50: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0001bb60: 2020 506f 6c69 6379 4172 6e3d 706f 6c69    PolicyArn=poli
+0001bb70: 6379 5f61 726e 0a20 2020 2020 2020 2029  cy_arn.        )
+0001bb80: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001bb90: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
+0001bba0: 6765 745f 6563 325f 6d65 7461 6461 7461  get_ec2_metadata
+0001bbb0: 2873 656c 662c 206d 6574 6164 6174 615f  (self, metadata_
+0001bbc0: 656e 7472 7929 3a0a 0a20 2020 2020 2020  entry):..       
+0001bbd0: 2023 2072 6571 7565 7374 2027 6c6f 6361   # request 'loca
+0001bbe0: 6c2d 686f 7374 6e61 6d65 272c 2027 7075  l-hostname', 'pu
+0001bbf0: 626c 6963 2d68 6f73 746e 616d 6527 2c20  blic-hostname', 
+0001bc00: 276c 6f63 616c 2d69 7076 3427 2c20 2770  'local-ipv4', 'p
+0001bc10: 7562 6c69 632d 6970 7634 270a 0a20 2020  ublic-ipv4'..   
+0001bc20: 2020 2020 2023 2044 6566 696e 6520 7468       # Define th
+0001bc30: 6520 6261 7365 2055 524c 2066 6f72 2074  e base URL for t
+0001bc40: 6865 2045 4332 206d 6574 6164 6174 6120  he EC2 metadata 
+0001bc50: 7365 7276 6963 650a 2020 2020 2020 2020  service.        
+0001bc60: 6261 7365 5f75 726c 203d 2022 6874 7470  base_url = "http
+0001bc70: 3a2f 2f31 3639 2e32 3534 2e31 3639 2e32  ://169.254.169.2
+0001bc80: 3534 2f6c 6174 6573 742f 6d65 7461 2d64  54/latest/meta-d
+0001bc90: 6174 612f 220a 0a20 2020 2020 2020 2023  ata/"..        #
+0001bca0: 2052 6571 7565 7374 2061 2074 6f6b 656e   Request a token
+0001bcb0: 2077 6974 6820 6120 5454 4c20 6f66 2036   with a TTL of 6
+0001bcc0: 3020 7365 636f 6e64 730a 2020 2020 2020  0 seconds.      
+0001bcd0: 2020 746f 6b65 6e5f 7572 6c20 3d20 2268    token_url = "h
+0001bce0: 7474 703a 2f2f 3136 392e 3235 342e 3136  ttp://169.254.16
+0001bcf0: 392e 3235 342f 6c61 7465 7374 2f61 7069  9.254/latest/api
+0001bd00: 2f74 6f6b 656e 220a 2020 2020 2020 2020  /token".        
+0001bd10: 746f 6b65 6e5f 6865 6164 6572 7320 3d20  token_headers = 
+0001bd20: 7b22 582d 6177 732d 6563 322d 6d65 7461  {"X-aws-ec2-meta
+0001bd30: 6461 7461 2d74 6f6b 656e 2d74 746c 2d73  data-token-ttl-s
+0001bd40: 6563 6f6e 6473 223a 2022 3630 227d 0a20  econds": "60"}. 
+0001bd50: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001bd60: 2020 2020 2020 2020 746f 6b65 6e5f 7265          token_re
+0001bd70: 7370 6f6e 7365 203d 2072 6571 7565 7374  sponse = request
+0001bd80: 732e 7075 7428 0a20 2020 2020 2020 2020  s.put(.         
+0001bd90: 2020 2020 2020 2074 6f6b 656e 5f75 726c         token_url
+0001bda0: 2c20 6865 6164 6572 733d 746f 6b65 6e5f  , headers=token_
+0001bdb0: 6865 6164 6572 732c 2074 696d 656f 7574  headers, timeout
+0001bdc0: 3d32 290a 2020 2020 2020 2020 6578 6365  =2).        exce
+0001bdd0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0001bde0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0001bdf0: 7269 6e74 2866 274f 7468 6572 2045 7272  rint(f'Other Err
+0001be00: 6f72 3a20 7b65 7d27 290a 2020 2020 2020  or: {e}').      
+0001be10: 2020 2020 2020 7265 7475 726e 2022 220a        return "".
+0001be20: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+0001be30: 746f 6b65 6e5f 7265 7370 6f6e 7365 2e74  token_response.t
+0001be40: 6578 740a 0a20 2020 2020 2020 2023 2055  ext..        # U
+0001be50: 7365 2074 6865 2074 6f6b 656e 2074 6f20  se the token to 
+0001be60: 7265 7472 6965 7665 2074 6865 2073 7065  retrieve the spe
+0001be70: 6369 6669 6564 206d 6574 6164 6174 6120  cified metadata 
+0001be80: 656e 7472 790a 2020 2020 2020 2020 6865  entry.        he
+0001be90: 6164 6572 7320 3d20 7b22 582d 6177 732d  aders = {"X-aws-
+0001bea0: 6563 322d 6d65 7461 6461 7461 2d74 6f6b  ec2-metadata-tok
+0001beb0: 656e 223a 2074 6f6b 656e 7d0a 2020 2020  en": token}.    
+0001bec0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001bed0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+0001bee0: 7265 7175 6573 7473 2e67 6574 280a 2020  requests.get(.  
+0001bef0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001bf00: 7365 5f75 726c 202b 206d 6574 6164 6174  se_url + metadat
+0001bf10: 615f 656e 7472 792c 2068 6561 6465 7273  a_entry, headers
+0001bf20: 3d68 6561 6465 7273 2c20 7469 6d65 6f75  =headers, timeou
+0001bf30: 743d 3229 0a20 2020 2020 2020 2065 7863  t=2).        exc
+0001bf40: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0001bf50: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001bf60: 7072 696e 7428 6627 4f74 6865 7220 4572  print(f'Other Er
+0001bf70: 726f 723a 207b 657d 2729 0a20 2020 2020  ror: {e}').     
+0001bf80: 2020 2020 2020 2072 6574 7572 6e20 2222         return ""
+0001bf90: 0a0a 2020 2020 2020 2020 6966 2072 6573  ..        if res
+0001bfa0: 706f 6e73 652e 7374 6174 7573 5f63 6f64  ponse.status_cod
+0001bfb0: 6520 213d 2032 3030 3a0a 2020 2020 2020  e != 200:.      
+0001bfc0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0001bfd0: 2020 2020 2020 2020 2020 2020 2066 2245               f"E
+0001bfe0: 7272 6f72 3a20 4661 696c 6564 2074 6f20  rror: Failed to 
+0001bff0: 7265 7472 6965 7665 206d 6574 6164 6174  retrieve metadat
+0001c000: 6120 666f 7220 656e 7472 793a 207b 6d65  a for entry: {me
+0001c010: 7461 6461 7461 5f65 6e74 7279 7d2e 2048  tadata_entry}. H
+0001c020: 5454 5020 5374 6174 7573 2043 6f64 653a  TTP Status Code:
+0001c030: 207b 7265 7370 6f6e 7365 2e73 7461 7475   {response.statu
+0001c040: 735f 636f 6465 7d22 290a 2020 2020 2020  s_code}").      
+0001c050: 2020 2020 2020 7265 7475 726e 2022 220a        return "".
+0001c060: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001c070: 7265 7370 6f6e 7365 2e74 6578 740a 0a20  response.text.. 
+0001c080: 2020 2023 2054 4f44 4f3a 204f 4853 552d     # TODO: OHSU-
+0001c090: 3937 3a20 496d 706c 656d 656e 7420 636f  97: Implement co
+0001c0a0: 7374 206d 6f6e 6974 6f72 696e 6720 616e  st monitoring an
+0001c0b0: 6420 656d 6169 6c20 7365 6e64 696e 670a  d email sending.
+0001c0c0: 2020 2020 6465 6620 6d6f 6e69 746f 725f      def monitor_
+0001c0d0: 6563 3228 7365 6c66 293a 0a0a 2020 2020  ec2(self):..    
+0001c0e0: 2020 2020 2320 544f 444f 3a20 6675 6e63      # TODO: func
+0001c0f0: 7469 6f6e 2070 656e 6469 6e74 2074 6f20  tion pendint to 
+0001c100: 7265 7669 6577 0a20 2020 2020 2020 2070  review.        p
+0001c110: 7269 6e74 2866 2754 4f44 4f3a 2066 756e  rint(f'TODO: fun
+0001c120: 6374 696f 6e20 7b69 6e73 7065 6374 2e73  ction {inspect.s
+0001c130: 7461 636b 2829 5b30 5d5b 335d 7d20 7065  tack()[0][3]} pe
+0001c140: 6e64 696e 6720 746f 2072 6576 6965 7727  nding to review'
+0001c150: 290a 2020 2020 2020 2020 6578 6974 2831  ).        exit(1
+0001c160: 290a 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
+0001c170: 7379 7374 656d 2069 7320 6964 6c65 2073  system is idle s
+0001c180: 656c 662d 6465 7374 726f 790a 0a20 2020  elf-destroy..   
+0001c190: 2020 2020 2069 6e73 7461 6e63 655f 6964       instance_id
+0001c1a0: 203d 2073 656c 662e 5f67 6574 5f65 6332   = self._get_ec2
+0001c1b0: 5f6d 6574 6164 6174 6128 2769 6e73 7461  _metadata('insta
+0001c1c0: 6e63 652d 6964 2729 0a20 2020 2020 2020  nce-id').       
+0001c1d0: 2070 7562 6c69 635f 6970 203d 2073 656c   public_ip = sel
+0001c1e0: 662e 5f67 6574 5f65 6332 5f6d 6574 6164  f._get_ec2_metad
+0001c1f0: 6174 6128 2770 7562 6c69 632d 6970 7634  ata('public-ipv4
+0001c200: 2729 0a20 2020 2020 2020 2069 6e73 7461  ').        insta
+0001c210: 6e63 655f 7479 7065 203d 2073 656c 662e  nce_type = self.
+0001c220: 5f67 6574 5f65 6332 5f6d 6574 6164 6174  _get_ec2_metadat
+0001c230: 6128 2769 6e73 7461 6e63 652d 7479 7065  a('instance-type
+0001c240: 2729 0a20 2020 2020 2020 2061 6d69 5f69  ').        ami_i
+0001c250: 6420 3d20 7365 6c66 2e5f 6765 745f 6563  d = self._get_ec
+0001c260: 325f 6d65 7461 6461 7461 2827 616d 692d  2_metadata('ami-
+0001c270: 6964 2729 0a20 2020 2020 2020 2072 6573  id').        res
+0001c280: 6572 7661 7469 6f6e 5f69 6420 3d20 7365  ervation_id = se
+0001c290: 6c66 2e5f 6765 745f 6563 325f 6d65 7461  lf._get_ec2_meta
+0001c2a0: 6461 7461 2827 7265 7365 7276 6174 696f  data('reservatio
+0001c2b0: 6e2d 6964 2729 0a0a 2020 2020 2020 2020  n-id')..        
+0001c2c0: 6e6f 7773 7472 203d 2064 6174 6574 696d  nowstr = datetim
+0001c2d0: 652e 6461 7465 7469 6d65 2e6e 6f77 2829  e.datetime.now()
+0001c2e0: 2e73 7472 6674 696d 6528 2725 483a 254d  .strftime('%H:%M
+0001c2f0: 3a25 5327 290a 2020 2020 2020 2020 7072  :%S').        pr
+0001c300: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0001c310: 2066 2766 726f 7374 6572 2d6d 6f6e 6974   f'froster-monit
+0001c320: 6f72 2028 7b6e 6f77 7374 727d 293a 207b  or ({nowstr}): {
+0001c330: 7075 626c 6963 5f69 707d 2028 7b69 6e73  public_ip} ({ins
+0001c340: 7461 6e63 655f 6964 7d2c 207b 696e 7374  tance_id}, {inst
+0001c350: 616e 6365 5f74 7970 657d 2c20 7b61 6d69  ance_type}, {ami
+0001c360: 5f69 647d 2c20 7b72 6573 6572 7661 7469  _id}, {reservati
+0001c370: 6f6e 5f69 647d 2920 2e2e 2e20 2729 0a0a  on_id}) ... ')..
+0001c380: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001c390: 5f6d 6f6e 6974 6f72 5f69 735f 6964 6c65  _monitor_is_idle
+0001c3a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001c3b0: 2320 5468 6973 206d 6163 6869 6e65 2077  # This machine w
+0001c3c0: 6173 2069 646c 6520 666f 7220 6120 6c6f  as idle for a lo
+0001c3d0: 6e67 2074 696d 652c 2064 6573 7472 6f79  ng time, destroy
+0001c3e0: 2069 740a 2020 2020 2020 2020 2020 2020   it.            
+0001c3f0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0001c400: 2020 2020 2020 2066 2766 726f 7374 6572         f'froster
+0001c410: 2d6d 6f6e 6974 6f72 2028 7b6e 6f77 7374  -monitor ({nowst
+0001c420: 727d 293a 2044 6573 7472 6f79 696e 6720  r}): Destroying 
+0001c430: 6375 7272 656e 7420 6964 6c69 6e67 206d  current idling m
+0001c440: 6163 6869 6e65 207b 7075 626c 6963 5f69  achine {public_i
+0001c450: 707d 2028 7b69 6e73 7461 6e63 655f 6964  p} ({instance_id
+0001c460: 7d29 202e 2e2e 2729 0a20 2020 2020 2020  }) ...').       
+0001c470: 2020 2020 2069 6620 7075 626c 6963 5f69       if public_i
+0001c480: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+0001c490: 2020 2062 6f64 795f 7465 7874 203d 2022     body_text = "
+0001c4a0: 496e 7374 616e 6365 2077 6173 2064 6574  Instance was det
+0001c4b0: 6563 7465 6420 6173 2069 646c 6520 616e  ected as idle an
+0001c4c0: 6420 7465 726d 696e 6174 6564 220a 2020  d terminated".  
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001c4e0: 6c66 2e73 656e 645f 656d 6169 6c5f 7365  lf.send_email_se
+0001c4f0: 7328 7365 6c66 2e63 6667 2e65 6d61 696c  s(self.cfg.email
+0001c500: 2c20 7365 6c66 2e63 6667 2e65 6d61 696c  , self.cfg.email
+0001c510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c530: 2020 2020 2020 6627 5465 726d 696e 6174        f'Terminat
+0001c540: 696e 6720 6964 6c65 2069 6e73 7461 6e63  ing idle instanc
+0001c550: 6520 7b70 7562 6c69 635f 6970 7d20 287b  e {public_ip} ({
+0001c560: 696e 7374 616e 6365 5f69 647d 2927 2c20  instance_id})', 
+0001c570: 626f 6479 5f74 6578 7429 0a20 2020 2020  body_text).     
+0001c580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c590: 6563 325f 7465 726d 696e 6174 655f 696e  ec2_terminate_in
+0001c5a0: 7374 616e 6365 2870 7562 6c69 635f 6970  stance(public_ip
+0001c5b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c5c0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+0001c5d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001c5e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001c5f0: 2827 436f 756c 6420 6e6f 7420 7265 7472  ('Could not retr
+0001c600: 6965 7665 206d 6574 6164 6174 6120 2849  ieve metadata (I
+0001c610: 5029 2729 0a20 2020 2020 2020 2020 2020  P)').           
+0001c620: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0001c630: 2020 2020 2063 7572 7265 6e74 5f74 696d       current_tim
+0001c640: 6520 3d20 6461 7465 7469 6d65 2e64 6174  e = datetime.dat
+0001c650: 6574 696d 652e 6e6f 7728 292e 7469 6d65  etime.now().time
+0001c660: 2829 0a20 2020 2020 2020 2073 7461 7274  ().        start
+0001c670: 5f74 696d 6520 3d20 6461 7465 7469 6d65  _time = datetime
+0001c680: 2e64 6174 6574 696d 652e 7374 7270 7469  .datetime.strpti
+0001c690: 6d65 2822 3233 3a30 303a 3030 222c 2022  me("23:00:00", "
+0001c6a0: 2548 3a25 4d3a 2553 2229 2e74 696d 6528  %H:%M:%S").time(
+0001c6b0: 290a 2020 2020 2020 2020 656e 645f 7469  ).        end_ti
+0001c6c0: 6d65 203d 2064 6174 6574 696d 652e 6461  me = datetime.da
+0001c6d0: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+0001c6e0: 2232 333a 3539 3a35 3922 2c20 2225 483a  "23:59:59", "%H:
+0001c6f0: 254d 3a25 5322 292e 7469 6d65 2829 0a20  %M:%S").time(). 
+0001c700: 2020 2020 2020 2069 6620 7374 6172 745f         if start_
+0001c710: 7469 6d65 203e 3d20 6375 7272 656e 745f  time >= current_
+0001c720: 7469 6d65 206f 7220 6375 7272 656e 745f  time or current_
+0001c730: 7469 6d65 203e 2065 6e64 5f74 696d 653a  time > end_time:
+0001c740: 0a20 2020 2020 2020 2020 2020 2023 206f  .            # o
+0001c750: 6e6c 7920 7275 6e20 636f 7374 2065 6d61  nly run cost ema
+0001c760: 696c 7320 6f6e 6365 2061 2064 6179 0a20  ils once a day. 
+0001c770: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001c780: 6e0a 0a20 2020 2020 2020 206d 6f6e 7468  n..        month
+0001c790: 6c79 5f63 6f73 742c 206d 6f6e 7468 6c79  ly_cost, monthly
+0001c7a0: 5f75 6e69 742c 2064 6169 6c79 5f63 6f73  _unit, daily_cos
+0001c7b0: 7473 5f62 795f 696e 7374 616e 6365 2c20  ts_by_instance, 
+0001c7c0: 7573 6572 5f6d 6f6e 7468 6c79 5f63 6f73  user_monthly_cos
+0001c7d0: 742c 2075 7365 725f 6d6f 6e74 686c 795f  t, user_monthly_
+0001c7e0: 756e 6974 2c20 5c0a 2020 2020 2020 2020  unit, \.        
+0001c7f0: 2020 2020 7573 6572 5f64 6169 6c79 5f63      user_daily_c
+0001c800: 6f73 742c 2075 7365 725f 6461 696c 795f  ost, user_daily_
+0001c810: 756e 6974 2c20 7573 6572 5f6e 616d 6520  unit, user_name 
+0001c820: 3d20 7365 6c66 2e5f 6d6f 6e69 746f 725f  = self._monitor_
+0001c830: 6765 745f 6563 325f 636f 7374 7328 290a  get_ec2_costs().
+0001c840: 0a20 2020 2020 2020 2062 6f64 7920 3d20  .        body = 
+0001c850: 5b5d 0a20 2020 2020 2020 2062 6f64 792e  [].        body.
+0001c860: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+0001c870: 2020 2020 6622 7b6d 6f6e 7468 6c79 5f63      f"{monthly_c
+0001c880: 6f73 743a 2e32 667d 207b 6d6f 6e74 686c  ost:.2f} {monthl
+0001c890: 795f 756e 6974 7d20 746f 7461 6c20 6163  y_unit} total ac
+0001c8a0: 636f 756e 7420 636f 7374 2066 6f72 2074  count cost for t
+0001c8b0: 6865 2063 7572 7265 6e74 206d 6f6e 7468  he current month
+0001c8c0: 2e22 290a 2020 2020 2020 2020 626f 6479  .").        body
+0001c8d0: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+0001c8e0: 2020 2020 2066 227b 7573 6572 5f6d 6f6e       f"{user_mon
+0001c8f0: 7468 6c79 5f63 6f73 743a 2e32 667d 207b  thly_cost:.2f} {
+0001c900: 7573 6572 5f6d 6f6e 7468 6c79 5f75 6e69  user_monthly_uni
+0001c910: 747d 2063 6f73 7420 6f66 2075 7365 7220  t} cost of user 
+0001c920: 7b75 7365 725f 6e61 6d65 7d20 666f 7220  {user_name} for 
+0001c930: 7468 6520 6375 7272 656e 7420 6d6f 6e74  the current mont
+0001c940: 682e 2229 0a20 2020 2020 2020 2062 6f64  h.").        bod
+0001c950: 792e 6170 7065 6e64 280a 2020 2020 2020  y.append(.      
+0001c960: 2020 2020 2020 6622 7b75 7365 725f 6461        f"{user_da
+0001c970: 696c 795f 636f 7374 3a2e 3266 7d20 7b75  ily_cost:.2f} {u
+0001c980: 7365 725f 6461 696c 795f 756e 6974 7d20  ser_daily_unit} 
+0001c990: 636f 7374 206f 6620 7573 6572 207b 7573  cost of user {us
+0001c9a0: 6572 5f6e 616d 657d 2069 6e20 7468 6520  er_name} in the 
+0001c9b0: 6c61 7374 2032 3420 686f 7572 732e 2229  last 24 hours.")
+0001c9c0: 0a20 2020 2020 2020 2062 6f64 792e 6170  .        body.ap
+0001c9d0: 7065 6e64 2822 436f 7374 2066 6f72 2065  pend("Cost for e
+0001c9e0: 6163 6820 4543 3220 696e 7374 616e 6365  ach EC2 instance
+0001c9f0: 2074 7970 6520 696e 2074 6865 206c 6173   type in the las
+0001ca00: 7420 3234 2068 6f75 7273 3a22 290a 2020  t 24 hours:").  
+0001ca10: 2020 2020 2020 666f 7220 696e 7374 616e        for instan
+0001ca20: 6365 5f74 2c20 2863 6f73 742c 2075 6e69  ce_t, (cost, uni
+0001ca30: 7429 2069 6e20 6461 696c 795f 636f 7374  t) in daily_cost
+0001ca40: 735f 6279 5f69 6e73 7461 6e63 652e 6974  s_by_instance.it
+0001ca50: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0001ca60: 2020 2069 6620 696e 7374 616e 6365 5f74     if instance_t
+0001ca70: 2021 3d20 274e 6f49 6e73 7461 6e63 6554   != 'NoInstanceT
+0001ca80: 7970 6527 3a0a 2020 2020 2020 2020 2020  ype':.          
+0001ca90: 2020 2020 2020 626f 6479 2e61 7070 656e        body.appen
+0001caa0: 6428 6622 2020 7b69 6e73 7461 6e63 655f  d(f"  {instance_
+0001cab0: 743a 3132 7d3a 2024 7b63 6f73 743a 2e32  t:12}: ${cost:.2
+0001cac0: 667d 207b 756e 6974 7d22 290a 2020 2020  f} {unit}").    
+0001cad0: 2020 2020 626f 6479 5f74 6578 7420 3d20      body_text = 
+0001cae0: 225c 6e22 2e6a 6f69 6e28 626f 6479 290a  "\n".join(body).
+0001caf0: 2020 2020 2020 2020 7365 6c66 2e73 656e          self.sen
+0001cb00: 645f 656d 6169 6c5f 7365 7328 7365 6c66  d_email_ses(self
+0001cb10: 2e63 6667 2e65 6d61 696c 2c20 7365 6c66  .cfg.email, self
+0001cb20: 2e63 6667 2e65 6d61 696c 2c0a 2020 2020  .cfg.email,.    
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb40: 2020 2020 2020 2020 6627 4672 6f73 7465          f'Froste
+0001cb50: 7220 4157 5320 636f 7374 2072 6570 6f72  r AWS cost repor
+0001cb60: 7420 287b 696e 7374 616e 6365 5f69 647d  t ({instance_id}
+0001cb70: 2927 2c20 626f 6479 5f74 6578 7429 0a0a  )', body_text)..
+0001cb80: 2020 2020 6465 6620 5f6d 6f6e 6974 6f72      def _monitor
+0001cb90: 5f75 7365 7273 5f6c 6f67 6765 645f 696e  _users_logged_in
+0001cba0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001cbb0: 2222 2243 6865 636b 2069 6620 616e 7920  """Check if any 
+0001cbc0: 7573 6572 7320 6172 6520 6c6f 6767 6564  users are logged
+0001cbd0: 2069 6e2e 2222 220a 2020 2020 2020 2020   in.""".        
+0001cbe0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001cbf0: 206f 7574 7075 7420 3d20 7375 6270 726f   output = subpro
+0001cc00: 6365 7373 2e63 6865 636b 5f6f 7574 7075  cess.check_outpu
+0001cc10: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0001cc20: 2020 205b 2777 686f 275d 292e 6465 636f     ['who']).deco
+0001cc30: 6465 2827 7574 662d 3827 2c20 6572 726f  de('utf-8', erro
+0001cc40: 7273 3d27 6967 6e6f 7265 2729 0a20 2020  rs='ignore').   
+0001cc50: 2020 2020 2020 2020 2069 6620 6f75 7470           if outp
+0001cc60: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+0001cc70: 2020 2020 7072 696e 7428 2766 726f 7374      print('frost
+0001cc80: 6572 2d6d 6f6e 6974 6f72 3a20 4e6f 7420  er-monitor: Not 
+0001cc90: 6964 6c65 2c20 6c6f 6767 6564 2069 6e3a  idle, logged in:
+0001cca0: 272c 206f 7574 7075 7429 0a20 2020 2020  ', output).     
+0001ccb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ccc0: 6e20 5472 7565 2020 2320 5573 6572 7320  n True  # Users 
+0001ccd0: 6172 6520 6c6f 6767 6564 2069 6e0a 2020  are logged in.  
+0001cce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ccf0: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+0001cd00: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+0001cd10: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001cd20: 2020 7072 696e 7428 6627 4f74 6865 7220    print(f'Other 
+0001cd30: 4572 726f 723a 207b 657d 2729 0a20 2020  Error: {e}').   
+0001cd40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001cd50: 5472 7565 0a0a 2020 2020 6465 6620 5f6d  True..    def _m
+0001cd60: 6f6e 6974 6f72 5f69 735f 6964 6c65 2873  onitor_is_idle(s
+0001cd70: 656c 662c 2069 6e74 6572 7661 6c3d 3630  elf, interval=60
+0001cd80: 2c20 6d69 6e5f 6964 6c65 5f63 6e74 3d37  , min_idle_cnt=7
+0001cd90: 3229 3a0a 0a20 2020 2020 2020 2023 2065  2):..        # e
+0001cda0: 6163 6820 7275 6e20 6368 6563 6b73 2069  ach run checks i
+0001cdb0: 646c 6520 7469 6d65 2066 6f72 2036 3020  dle time for 60 
+0001cdc0: 7365 636f 6e64 7320 2869 6e74 6572 7661  seconds (interva
+0001cdd0: 6c29 0a20 2020 2020 2020 2023 2069 6620  l).        # if 
+0001cde0: 7468 6520 7379 7374 656d 2068 6173 2062  the system has b
+0001cdf0: 6565 6e20 6964 6c65 2066 6f72 2037 3220  een idle for 72 
+0001ce00: 636f 6e73 6563 7574 6976 6520 7275 6e73  consecutive runs
+0001ce10: 0a20 2020 2020 2020 2023 2074 6865 2066  .        # the f
+0001ce20: 7563 6e74 696f 6e20 7769 6c6c 2072 6574  ucntion will ret
+0001ce30: 7572 6e20 6964 6c65 2073 7461 7465 2061  urn idle state a
+0001ce40: 6674 6572 2033 2064 6179 730a 2020 2020  fter 3 days.    
+0001ce50: 2020 2020 2320 6966 2074 6865 2063 726f      # if the cro
+0001ce60: 6e20 6a6f 6220 6973 2072 756e 6e69 6e67  n job is running
+0001ce70: 2068 6f75 726c 790a 0a20 2020 2020 2020   hourly..       
+0001ce80: 2023 2043 6f6e 7374 616e 7473 0a20 2020   # Constants.   
+0001ce90: 2020 2020 2043 5055 5f54 4852 4553 484f       CPU_THRESHO
+0001cea0: 4c44 203d 2032 3020 2023 2070 6572 6365  LD = 20  # perce
+0001ceb0: 6e74 0a20 2020 2020 2020 204e 4554 5f52  nt.        NET_R
+0001cec0: 4541 445f 5448 5245 5348 4f4c 4420 3d20  EAD_THRESHOLD = 
+0001ced0: 3130 3030 2020 2320 6279 7465 7320 7065  1000  # bytes pe
+0001cee0: 7220 7365 636f 6e64 0a20 2020 2020 2020  r second.       
+0001cef0: 204e 4554 5f57 5249 5445 5f54 4852 4553   NET_WRITE_THRES
+0001cf00: 484f 4c44 203d 2031 3030 3020 2023 2062  HOLD = 1000  # b
+0001cf10: 7974 6573 2070 6572 2073 6563 6f6e 640a  ytes per second.
+0001cf20: 2020 2020 2020 2020 4449 534b 5f57 5249          DISK_WRI
+0001cf30: 5445 5f54 4852 4553 484f 4c44 203d 2031  TE_THRESHOLD = 1
+0001cf40: 3030 3030 3020 2023 2062 7974 6573 2070  00000  # bytes p
+0001cf50: 6572 2073 6563 6f6e 640a 2020 2020 2020  er second.      
+0001cf60: 2020 5052 4f43 4553 535f 4350 555f 5448    PROCESS_CPU_TH
+0001cf70: 5245 5348 4f4c 4420 3d20 3130 2020 2320  RESHOLD = 10  # 
+0001cf80: 7065 7263 656e 7420 2866 6f72 2069 6e64  percent (for ind
+0001cf90: 6976 6964 7561 6c20 7072 6f63 6573 7365  ividual processe
+0001cfa0: 7329 0a20 2020 2020 2020 2050 524f 4345  s).        PROCE
+0001cfb0: 5353 5f4d 454d 5f54 4852 4553 484f 4c44  SS_MEM_THRESHOLD
+0001cfc0: 203d 2031 3020 2023 2070 6572 6365 6e74   = 10  # percent
+0001cfd0: 2028 666f 7220 696e 6469 7669 6475 616c   (for individual
+0001cfe0: 2070 726f 6365 7373 6573 290a 2020 2020   processes).    
+0001cff0: 2020 2020 4449 534b 5f57 5249 5445 5f45      DISK_WRITE_E
+0001d000: 5843 4c55 5349 4f4e 5320 3d20 5b22 7379  XCLUSIONS = ["sy
+0001d010: 7374 656d 6422 2c20 2273 7973 7465 6d64  stemd", "systemd
+0001d020: 2d6a 6f75 726e 616c 6422 2c0a 2020 2020  -journald",.    
+0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d040: 2020 2020 2020 2020 2020 2020 2022 6368               "ch
+0001d050: 726f 6e79 6422 2c20 2273 7368 6422 2c20  ronyd", "sshd", 
+0001d060: 2261 7564 6974 6422 2c20 2261 6765 7474  "auditd", "agett
+0001d070: 7922 5d0a 0a20 2020 2020 2020 2023 204e  y"]..        # N
+0001d080: 6f74 2069 646c 6520 6966 2061 6e79 2075  ot idle if any u
+0001d090: 7365 7273 2061 7265 206c 6f67 6765 6420  sers are logged 
+0001d0a0: 696e 0a20 2020 2020 2020 2069 6620 7365  in.        if se
+0001d0b0: 6c66 2e5f 6d6f 6e69 746f 725f 7573 6572  lf._monitor_user
+0001d0c0: 735f 6c6f 6767 6564 5f69 6e28 293a 0a20  s_logged_in():. 
+0001d0d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001d0e0: 2866 2766 726f 7374 6572 2d6d 6f6e 6974  (f'froster-monit
+0001d0f0: 6f72 3a20 4e6f 7420 6964 6c65 3a20 7573  or: Not idle: us
+0001d100: 6572 2873 2920 6c6f 6767 6564 2069 6e27  er(s) logged in'
+0001d110: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0001d120: 7265 7475 726e 2073 656c 662e 5f6d 6f6e  return self._mon
+0001d130: 6974 6f72 5f73 6176 655f 6964 6c65 5f73  itor_save_idle_s
+0001d140: 7461 7465 2846 616c 7365 2c20 6d69 6e5f  tate(False, min_
+0001d150: 6964 6c65 5f63 6e74 290a 0a20 2020 2020  idle_cnt)..     
+0001d160: 2020 2023 2043 5055 2c20 5469 6d65 2049     # CPU, Time I
+0001d170: 2f4f 2061 6e64 204e 6574 776f 726b 2041  /O and Network A
+0001d180: 6374 6976 6974 790a 2020 2020 2020 2020  ctivity.        
+0001d190: 696f 5f73 7461 7274 203d 2070 7375 7469  io_start = psuti
+0001d1a0: 6c2e 6469 736b 5f69 6f5f 636f 756e 7465  l.disk_io_counte
+0001d1b0: 7273 2829 0a20 2020 2020 2020 206e 6574  rs().        net
+0001d1c0: 5f73 7461 7274 203d 2070 7375 7469 6c2e  _start = psutil.
+0001d1d0: 6e65 745f 696f 5f63 6f75 6e74 6572 7328  net_io_counters(
+0001d1e0: 290a 2020 2020 2020 2020 6370 755f 7065  ).        cpu_pe
+0001d1f0: 7263 656e 7420 3d20 7073 7574 696c 2e63  rcent = psutil.c
+0001d200: 7075 5f70 6572 6365 6e74 2869 6e74 6572  pu_percent(inter
+0001d210: 7661 6c3d 696e 7465 7276 616c 290a 2020  val=interval).  
+0001d220: 2020 2020 2020 696f 5f65 6e64 203d 2070        io_end = p
+0001d230: 7375 7469 6c2e 6469 736b 5f69 6f5f 636f  sutil.disk_io_co
+0001d240: 756e 7465 7273 2829 0a20 2020 2020 2020  unters().       
+0001d250: 206e 6574 5f65 6e64 203d 2070 7375 7469   net_end = psuti
+0001d260: 6c2e 6e65 745f 696f 5f63 6f75 6e74 6572  l.net_io_counter
+0001d270: 7328 290a 0a20 2020 2020 2020 2070 7269  s()..        pri
+0001d280: 6e74 2866 2766 726f 7374 6572 2d6d 6f6e  nt(f'froster-mon
+0001d290: 6974 6f72 3a20 4375 7272 656e 7420 4350  itor: Current CP
+0001d2a0: 5525 207b 6370 755f 7065 7263 656e 747d  U% {cpu_percent}
+0001d2b0: 2729 0a0a 2020 2020 2020 2020 2320 4368  ')..        # Ch
+0001d2c0: 6563 6b20 4350 5520 5574 696c 697a 6174  eck CPU Utilizat
+0001d2d0: 696f 6e0a 2020 2020 2020 2020 6966 2063  ion.        if c
+0001d2e0: 7075 5f70 6572 6365 6e74 203e 2043 5055  pu_percent > CPU
+0001d2f0: 5f54 4852 4553 484f 4c44 3a0a 2020 2020  _THRESHOLD:.    
+0001d300: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+0001d310: 6672 6f73 7465 722d 6d6f 6e69 746f 723a  froster-monitor:
+0001d320: 204e 6f74 2069 646c 653a 2043 5055 2520   Not idle: CPU% 
+0001d330: 7b63 7075 5f70 6572 6365 6e74 7d27 290a  {cpu_percent}').
+0001d340: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+0001d350: 7475 726e 2073 656c 662e 5f6d 6f6e 6974  turn self._monit
+0001d360: 6f72 5f73 6176 655f 6964 6c65 5f73 7461  or_save_idle_sta
+0001d370: 7465 2846 616c 7365 2c20 6d69 6e5f 6964  te(False, min_id
+0001d380: 6c65 5f63 6e74 290a 0a20 2020 2020 2020  le_cnt)..       
+0001d390: 2023 2043 6865 636b 2049 2f4f 2041 6374   # Check I/O Act
+0001d3a0: 6976 6974 790a 2020 2020 2020 2020 7772  ivity.        wr
+0001d3b0: 6974 655f 6469 6666 203d 2069 6f5f 656e  ite_diff = io_en
+0001d3c0: 642e 7772 6974 655f 6279 7465 7320 2d20  d.write_bytes - 
+0001d3d0: 696f 5f73 7461 7274 2e77 7269 7465 5f62  io_start.write_b
+0001d3e0: 7974 6573 0a20 2020 2020 2020 2077 7269  ytes.        wri
+0001d3f0: 7465 5f70 6572 5f73 6563 6f6e 6420 3d20  te_per_second = 
+0001d400: 7772 6974 655f 6469 6666 202f 2069 6e74  write_diff / int
+0001d410: 6572 7661 6c0a 0a20 2020 2020 2020 2069  erval..        i
+0001d420: 6620 7772 6974 655f 7065 725f 7365 636f  f write_per_seco
+0001d430: 6e64 203e 2044 4953 4b5f 5752 4954 455f  nd > DISK_WRITE_
+0001d440: 5448 5245 5348 4f4c 443a 0a20 2020 2020  THRESHOLD:.     
+0001d450: 2020 2020 2020 2066 6f72 2070 726f 6320         for proc 
+0001d460: 696e 2070 7375 7469 6c2e 7072 6f63 6573  in psutil.proces
+0001d470: 735f 6974 6572 285b 276e 616d 6527 5d29  s_iter(['name'])
+0001d480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d490: 2020 6966 2070 726f 632e 696e 666f 5b27    if proc.info['
+0001d4a0: 6e61 6d65 275d 2069 6e20 4449 534b 5f57  name'] in DISK_W
+0001d4b0: 5249 5445 5f45 5843 4c55 5349 4f4e 533a  RITE_EXCLUSIONS:
+0001d4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d4d0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0001d4e0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0001d4f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001d500: 2020 2020 2020 2069 6620 7072 6f63 2e69         if proc.i
+0001d510: 6f5f 636f 756e 7465 7273 2829 2e77 7269  o_counters().wri
+0001d520: 7465 5f62 7974 6573 203e 2030 3a0a 2020  te_bytes > 0:.  
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2020 2020 2020 2066 2766 726f 7374           f'frost
+0001d570: 6572 2d6d 6f6e 6974 6f72 3a69 6f20 6279  er-monitor:io by
+0001d580: 7465 7320 7772 6974 7465 6e3a 207b 7072  tes written: {pr
+0001d590: 6f63 2e69 6f5f 636f 756e 7465 7273 2829  oc.io_counters()
+0001d5a0: 2e77 7269 7465 5f62 7974 6573 7d27 290a  .write_bytes}').
+0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001d5d0: 656c 662e 5f6d 6f6e 6974 6f72 5f73 6176  elf._monitor_sav
+0001d5e0: 655f 6964 6c65 5f73 7461 7465 2846 616c  e_idle_state(Fal
+0001d5f0: 7365 2c20 6d69 6e5f 6964 6c65 5f63 6e74  se, min_idle_cnt
+0001d600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d610: 2020 6578 6365 7074 2028 7073 7574 696c    except (psutil
+0001d620: 2e4e 6f53 7563 6850 726f 6365 7373 2c20  .NoSuchProcess, 
+0001d630: 7073 7574 696c 2e41 6363 6573 7344 656e  psutil.AccessDen
+0001d640: 6965 6429 3a0a 2020 2020 2020 2020 2020  ied):.          
+0001d650: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+0001d660: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0001d670: 4e65 7477 6f72 6b20 4163 7469 7669 7479  Network Activity
+0001d680: 0a20 2020 2020 2020 2062 7974 6573 5f73  .        bytes_s
+0001d690: 656e 745f 6469 6666 203d 206e 6574 5f65  ent_diff = net_e
+0001d6a0: 6e64 2e62 7974 6573 5f73 656e 7420 2d20  nd.bytes_sent - 
+0001d6b0: 6e65 745f 7374 6172 742e 6279 7465 735f  net_start.bytes_
+0001d6c0: 7365 6e74 0a20 2020 2020 2020 2062 7974  sent.        byt
+0001d6d0: 6573 5f72 6563 765f 6469 6666 203d 206e  es_recv_diff = n
+0001d6e0: 6574 5f65 6e64 2e62 7974 6573 5f72 6563  et_end.bytes_rec
+0001d6f0: 7620 2d20 6e65 745f 7374 6172 742e 6279  v - net_start.by
+0001d700: 7465 735f 7265 6376 0a0a 2020 2020 2020  tes_recv..      
+0001d710: 2020 6279 7465 735f 7365 6e74 5f70 6572    bytes_sent_per
+0001d720: 5f73 6563 6f6e 6420 3d20 6279 7465 735f  _second = bytes_
+0001d730: 7365 6e74 5f64 6966 6620 2f20 696e 7465  sent_diff / inte
+0001d740: 7276 616c 0a20 2020 2020 2020 2062 7974  rval.        byt
+0001d750: 6573 5f72 6563 765f 7065 725f 7365 636f  es_recv_per_seco
+0001d760: 6e64 203d 2062 7974 6573 5f72 6563 765f  nd = bytes_recv_
+0001d770: 6469 6666 202f 2069 6e74 6572 7661 6c0a  diff / interval.
+0001d780: 0a20 2020 2020 2020 2069 6620 6279 7465  .        if byte
+0001d790: 735f 7365 6e74 5f70 6572 5f73 6563 6f6e  s_sent_per_secon
+0001d7a0: 6420 3e20 4e45 545f 5752 4954 455f 5448  d > NET_WRITE_TH
+0001d7b0: 5245 5348 4f4c 4420 6f72 205c 0a20 2020  RESHOLD or \.   
+0001d7c0: 2020 2020 2020 2020 2020 2020 2062 7974               byt
+0001d7d0: 6573 5f72 6563 765f 7065 725f 7365 636f  es_recv_per_seco
+0001d7e0: 6e64 203e 204e 4554 5f52 4541 445f 5448  nd > NET_READ_TH
+0001d7f0: 5245 5348 4f4c 443a 0a20 2020 2020 2020  RESHOLD:.       
+0001d800: 2020 2020 2070 7269 6e74 2866 2766 726f       print(f'fro
+0001d810: 7374 6572 2d6d 6f6e 6974 6f72 3a6e 6574  ster-monitor:net
+0001d820: 2062 7974 6573 2072 6563 763a 207b 6279   bytes recv: {by
+0001d830: 7465 735f 7265 6376 5f70 6572 5f73 6563  tes_recv_per_sec
+0001d840: 6f6e 647d 2729 0a20 2020 2020 2020 2020  ond}').         
+0001d850: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0001d860: 6d6f 6e69 746f 725f 7361 7665 5f69 646c  monitor_save_idl
+0001d870: 655f 7374 6174 6528 4661 6c73 652c 206d  e_state(False, m
+0001d880: 696e 5f69 646c 655f 636e 7429 0a0a 2020  in_idle_cnt)..  
+0001d890: 2020 2020 2020 2320 4578 616d 696e 6520        # Examine 
+0001d8a0: 5275 6e6e 696e 6720 5072 6f63 6573 7365  Running Processe
+0001d8b0: 7320 666f 7220 4350 5520 616e 6420 4d65  s for CPU and Me
+0001d8c0: 6d6f 7279 2055 7361 6765 0a20 2020 2020  mory Usage.     
+0001d8d0: 2020 2066 6f72 2070 726f 6320 696e 2070     for proc in p
+0001d8e0: 7375 7469 6c2e 7072 6f63 6573 735f 6974  sutil.process_it
+0001d8f0: 6572 285b 276e 616d 6527 2c20 2763 7075  er(['name', 'cpu
+0001d900: 5f70 6572 6365 6e74 272c 2027 6d65 6d6f  _percent', 'memo
+0001d910: 7279 5f70 6572 6365 6e74 275d 293a 0a20  ry_percent']):. 
+0001d920: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+0001d930: 6f63 2e69 6e66 6f5b 276e 616d 6527 5d20  oc.info['name'] 
+0001d940: 6e6f 7420 696e 2044 4953 4b5f 5752 4954  not in DISK_WRIT
+0001d950: 455f 4558 434c 5553 494f 4e53 3a0a 2020  E_EXCLUSIONS:.  
+0001d960: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d970: 2070 726f 632e 696e 666f 5b27 6370 755f   proc.info['cpu_
+0001d980: 7065 7263 656e 7427 5d20 3e20 5052 4f43  percent'] > PROC
+0001d990: 4553 535f 4350 555f 5448 5245 5348 4f4c  ESS_CPU_THRESHOL
+0001d9a0: 443a 0a20 2020 2020 2020 2020 2020 2020  D:.             
+0001d9b0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9d0: 2020 2020 2020 6627 6672 6f73 7465 722d        f'froster-
+0001d9e0: 6d6f 6e69 746f 723a 204e 6f74 2069 646c  monitor: Not idl
+0001d9f0: 653a 2043 5055 2520 7b70 726f 632e 696e  e: CPU% {proc.in
+0001da00: 666f 5b22 6370 755f 7065 7263 656e 7422  fo["cpu_percent"
+0001da10: 5d7d 2729 0a20 2020 2020 2020 2020 2020  ]}').           
+0001da20: 2020 2020 2020 2020 2023 2072 6574 7572           # retur
+0001da30: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001da40: 2020 2020 2020 2020 2320 6469 7361 626c          # disabl
+0001da50: 6564 2074 6869 7320 6964 6c65 2063 6865  ed this idle che
+0001da60: 636b 6572 0a20 2020 2020 2020 2020 2020  cker.           
+0001da70: 2020 2020 2023 2069 6620 7072 6f63 2e69       # if proc.i
+0001da80: 6e66 6f5b 276d 656d 6f72 795f 7065 7263  nfo['memory_perc
+0001da90: 656e 7427 5d20 3e20 5052 4f43 4553 535f  ent'] > PROCESS_
+0001daa0: 4d45 4d5f 5448 5245 5348 4f4c 443a 0a20  MEM_THRESHOLD:. 
+0001dab0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001dac0: 2020 2020 7072 696e 7428 6627 6672 6f73      print(f'fros
+0001dad0: 7465 722d 6d6f 6e69 746f 723a 204e 6f74  ter-monitor: Not
+0001dae0: 2069 646c 653a 204d 454d 2520 7b70 726f   idle: MEM% {pro
+0001daf0: 632e 696e 666f 5b22 6d65 6d6f 7279 5f70  c.info["memory_p
+0001db00: 6572 6365 6e74 225d 7d27 290a 2020 2020  ercent"]}').    
+0001db10: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0001db20: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+0001db30: 2020 2020 2020 2023 2057 7269 7465 2069         # Write i
+0001db40: 646c 6520 7374 6174 6520 616e 6420 7265  dle state and re
+0001db50: 6164 2063 6f6e 7365 6375 7469 7665 2069  ad consecutive i
+0001db60: 646c 6520 686f 7572 730a 2020 2020 2020  dle hours.      
+0001db70: 2020 7072 696e 7428 6627 6672 6f73 7465    print(f'froste
+0001db80: 722d 6d6f 6e69 746f 723a 2049 646c 6520  r-monitor: Idle 
+0001db90: 7374 6174 6520 6465 7465 6374 6564 2729  state detected')
+0001dba0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001dbb0: 7365 6c66 2e5f 6d6f 6e69 746f 725f 7361  self._monitor_sa
+0001dbc0: 7665 5f69 646c 655f 7374 6174 6528 5472  ve_idle_state(Tr
+0001dbd0: 7565 2c20 6d69 6e5f 6964 6c65 5f63 6e74  ue, min_idle_cnt
+0001dbe0: 290a 0a20 2020 2064 6566 205f 6d6f 6e69  )..    def _moni
+0001dbf0: 746f 725f 7361 7665 5f69 646c 655f 7374  tor_save_idle_st
+0001dc00: 6174 6528 7365 6c66 2c20 6973 5f73 7973  ate(self, is_sys
+0001dc10: 7465 6d5f 6964 6c65 2c20 6d69 6e5f 6964  tem_idle, min_id
+0001dc20: 6c65 5f63 6e74 293a 0a20 2020 2020 2020  le_cnt):.       
+0001dc30: 2049 444c 455f 5354 4154 455f 4649 4c45   IDLE_STATE_FILE
+0001dc40: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0001dc50: 6f73 2e67 6574 656e 7628 2754 4d50 4449  os.getenv('TMPDI
+0001dc60: 5227 2c20 272f 746d 7027 292c 0a20 2020  R', '/tmp'),.   
+0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 2766 726f 7374 6572 5f69 646c      'froster_idl
+0001dca0: 655f 7374 6174 652e 7478 7427 290a 2020  e_state.txt').  
+0001dcb0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+0001dcc0: 4944 4c45 5f53 5441 5445 5f46 494c 452c  IDLE_STATE_FILE,
+0001dcd0: 2027 6127 2920 6173 2066 696c 653a 0a20   'a') as file:. 
+0001dce0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0001dcf0: 7772 6974 6528 2731 5c6e 2720 6966 2069  write('1\n' if i
+0001dd00: 735f 7379 7374 656d 5f69 646c 6520 656c  s_system_idle el
+0001dd10: 7365 2027 305c 6e27 290a 2020 2020 2020  se '0\n').      
+0001dd20: 2020 7769 7468 206f 7065 6e28 4944 4c45    with open(IDLE
+0001dd30: 5f53 5441 5445 5f46 494c 452c 2027 7227  _STATE_FILE, 'r'
+0001dd40: 2920 6173 2066 696c 653a 0a20 2020 2020  ) as file:.     
+0001dd50: 2020 2020 2020 2073 7461 7465 7320 3d20         states = 
+0001dd60: 6669 6c65 2e72 6561 646c 696e 6573 2829  file.readlines()
+0001dd70: 0a20 2020 2020 2020 2063 6f75 6e74 203d  .        count =
+0001dd80: 2030 0a20 2020 2020 2020 2066 6f72 2073   0.        for s
+0001dd90: 7461 7465 2069 6e20 7265 7665 7273 6564  tate in reversed
+0001dda0: 2873 7461 7465 7329 3a0a 2020 2020 2020  (states):.      
+0001ddb0: 2020 2020 2020 6966 2073 7461 7465 2e73        if state.s
+0001ddc0: 7472 6970 2829 203d 3d20 2731 273a 0a20  trip() == '1':. 
+0001ddd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001dde0: 6f75 6e74 202b 3d20 310a 2020 2020 2020  ount += 1.      
+0001ddf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001de00: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0001de10: 6b0a 2020 2020 2020 2020 7265 7475 726e  k.        return
+0001de20: 2063 6f75 6e74 203e 3d20 6d69 6e5f 6964   count >= min_id
+0001de30: 6c65 5f63 6e74 0a0a 2020 2020 6465 6620  le_cnt..    def 
+0001de40: 5f6d 6f6e 6974 6f72 5f67 6574 5f65 6332  _monitor_get_ec2
+0001de50: 5f63 6f73 7473 2873 656c 6629 3a0a 0a20  _costs(self):.. 
+0001de60: 2020 2020 2020 2023 2049 6465 6e74 6966         # Identif
+0001de70: 7920 6375 7272 656e 7420 7573 6572 2f61  y current user/a
+0001de80: 6363 6f75 6e74 0a20 2020 2020 2020 2069  ccount.        i
+0001de90: 6465 6e74 6974 7920 3d20 7365 6c66 2e73  dentity = self.s
+0001dea0: 7473 5f63 6c69 656e 742e 6765 745f 6361  ts_client.get_ca
+0001deb0: 6c6c 6572 5f69 6465 6e74 6974 7928 290a  ller_identity().
+0001dec0: 2020 2020 2020 2020 7573 6572 5f61 726e          user_arn
+0001ded0: 203d 2069 6465 6e74 6974 795b 2741 726e   = identity['Arn
+0001dee0: 275d 0a0a 2020 2020 2020 2020 2320 4368  ']..        # Ch
+0001def0: 6563 6b20 6966 2069 7427 7320 7468 6520  eck if it's the 
+0001df00: 726f 6f74 2075 7365 720a 2020 2020 2020  root user.      
+0001df10: 2020 6973 5f72 6f6f 7420 3d20 223a 726f    is_root = ":ro
+0001df20: 6f74 2220 696e 2075 7365 725f 6172 6e0a  ot" in user_arn.
+0001df30: 0a20 2020 2020 2020 2023 2044 6174 6573  .        # Dates
+0001df40: 2066 6f72 2074 6865 2063 7572 7265 6e74   for the current
+0001df50: 206d 6f6e 7468 2061 6e64 2074 6865 206c   month and the l
+0001df60: 6173 7420 3234 2068 6f75 7273 0a20 2020  ast 24 hours.   
+0001df70: 2020 2020 2074 6f64 6179 203d 2064 6174       today = dat
+0001df80: 6574 696d 652e 6461 7465 7469 6d65 2e74  etime.datetime.t
+0001df90: 6f64 6179 2829 0a20 2020 2020 2020 2066  oday().        f
+0001dfa0: 6972 7374 5f64 6179 5f6f 665f 6d6f 6e74  irst_day_of_mont
+0001dfb0: 6820 3d20 6461 7465 7469 6d65 2e64 6174  h = datetime.dat
+0001dfc0: 6574 696d 6528 0a20 2020 2020 2020 2020  etime(.         
+0001dfd0: 2020 2074 6f64 6179 2e79 6561 722c 2074     today.year, t
+0001dfe0: 6f64 6179 2e6d 6f6e 7468 2c20 3129 2e64  oday.month, 1).d
+0001dff0: 6174 6528 290a 2020 2020 2020 2020 7965  ate().        ye
+0001e000: 7374 6572 6461 7920 3d20 2874 6f64 6179  sterday = (today
+0001e010: 202d 2064 6174 6574 696d 652e 7469 6d65   - datetime.time
+0001e020: 6465 6c74 6128 6461 7973 3d31 2929 2e64  delta(days=1)).d
+0001e030: 6174 6528 290a 0a20 2020 2020 2020 2023  ate()..        #
+0001e040: 2046 6574 6368 2045 4332 2063 6f73 7420   Fetch EC2 cost 
+0001e050: 6f66 2074 6865 2063 7572 7265 6e74 206d  of the current m
+0001e060: 6f6e 7468 0a20 2020 2020 2020 206d 6f6e  onth.        mon
+0001e070: 7468 6c79 5f72 6573 706f 6e73 6520 3d20  thly_response = 
+0001e080: 7365 6c66 2e63 655f 636c 6965 6e74 2e67  self.ce_client.g
+0001e090: 6574 5f63 6f73 745f 616e 645f 7573 6167  et_cost_and_usag
+0001e0a0: 6528 0a20 2020 2020 2020 2020 2020 2054  e(.            T
+0001e0b0: 696d 6550 6572 696f 643d 7b0a 2020 2020  imePeriod={.    
+0001e0c0: 2020 2020 2020 2020 2020 2020 2753 7461              'Sta
+0001e0d0: 7274 273a 2073 7472 2866 6972 7374 5f64  rt': str(first_d
+0001e0e0: 6179 5f6f 665f 6d6f 6e74 6829 2c0a 2020  ay_of_month),.  
+0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2745                'E
+0001e100: 6e64 273a 2073 7472 2874 6f64 6179 2e64  nd': str(today.d
+0001e110: 6174 6528 2929 0a20 2020 2020 2020 2020  ate()).         
+0001e120: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
+0001e130: 2020 4669 6c74 6572 3d7b 0a20 2020 2020    Filter={.     
+0001e140: 2020 2020 2020 2020 2020 2027 4469 6d65             'Dime
+0001e150: 6e73 696f 6e73 273a 207b 0a20 2020 2020  nsions': {.     
+0001e160: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001e170: 4b65 7927 3a20 2753 4552 5649 4345 272c  Key': 'SERVICE',
+0001e180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e190: 2020 2020 2027 5661 6c75 6573 273a 205b       'Values': [
+0001e1a0: 2741 6d61 7a6f 6e20 456c 6173 7469 6320  'Amazon Elastic 
+0001e1b0: 436f 6d70 7574 6520 436c 6f75 6420 2d20  Compute Cloud - 
+0001e1c0: 436f 6d70 7574 6527 5d0a 2020 2020 2020  Compute'].      
+0001e1d0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+0001e1e0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+0001e1f0: 2020 2020 2020 2047 7261 6e75 6c61 7269         Granulari
+0001e200: 7479 3d27 4d4f 4e54 484c 5927 2c0a 2020  ty='MONTHLY',.  
+0001e210: 2020 2020 2020 2020 2020 4d65 7472 6963            Metric
+0001e220: 733d 5b27 556e 626c 656e 6465 6443 6f73  s=['UnblendedCos
+0001e230: 7427 5d2c 0a20 2020 2020 2020 2029 0a20  t'],.        ). 
+0001e240: 2020 2020 2020 206d 6f6e 7468 6c79 5f63         monthly_c
+0001e250: 6f73 7420 3d20 666c 6f61 7428 0a20 2020  ost = float(.   
+0001e260: 2020 2020 2020 2020 206d 6f6e 7468 6c79           monthly
+0001e270: 5f72 6573 706f 6e73 655b 2752 6573 756c  _response['Resul
+0001e280: 7473 4279 5469 6d65 275d 5b30 5d5b 2754  tsByTime'][0]['T
+0001e290: 6f74 616c 275d 5b27 556e 626c 656e 6465  otal']['Unblende
+0001e2a0: 6443 6f73 7427 5d5b 2741 6d6f 756e 7427  dCost']['Amount'
+0001e2b0: 5d29 0a20 2020 2020 2020 206d 6f6e 7468  ]).        month
+0001e2c0: 6c79 5f75 6e69 7420 3d20 6d6f 6e74 686c  ly_unit = monthl
+0001e2d0: 795f 7265 7370 6f6e 7365 5b27 5265 7375  y_response['Resu
+0001e2e0: 6c74 7342 7954 696d 6527 5d5b 305d 5b27  ltsByTime'][0]['
+0001e2f0: 546f 7461 6c27 5d5b 2755 6e62 6c65 6e64  Total']['Unblend
+0001e300: 6564 436f 7374 275d 5b27 556e 6974 275d  edCost']['Unit']
+0001e310: 0a0a 2020 2020 2020 2020 2320 4966 2069  ..        # If i
+0001e320: 7427 7320 7468 6520 726f 6f74 2075 7365  t's the root use
+0001e330: 722c 2074 6865 2077 686f 6c65 2061 6363  r, the whole acc
+0001e340: 6f75 6e74 2773 2063 6f73 7473 2061 7265  ount's costs are
+0001e350: 2061 7373 756d 6564 2074 6f20 6265 2063   assumed to be c
+0001e360: 6175 7365 6420 6279 2072 6f6f 742e 0a20  aused by root.. 
+0001e370: 2020 2020 2020 2069 6620 6973 5f72 6f6f         if is_roo
+0001e380: 743a 0a20 2020 2020 2020 2020 2020 2075  t:.            u
+0001e390: 7365 725f 6e61 6d65 203d 2027 726f 6f74  ser_name = 'root
+0001e3a0: 270a 2020 2020 2020 2020 2020 2020 7573  '.            us
+0001e3b0: 6572 5f6d 6f6e 7468 6c79 5f63 6f73 7420  er_monthly_cost 
+0001e3c0: 3d20 6d6f 6e74 686c 795f 636f 7374 0a20  = monthly_cost. 
+0001e3d0: 2020 2020 2020 2020 2020 2075 7365 725f             user_
+0001e3e0: 6d6f 6e74 686c 795f 756e 6974 203d 206d  monthly_unit = m
+0001e3f0: 6f6e 7468 6c79 5f75 6e69 740a 2020 2020  onthly_unit.    
+0001e400: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001e410: 2020 2020 2020 2320 4173 7375 6d69 6e67        # Assuming
+0001e420: 2061 2074 6167 2060 4372 6561 7465 6442   a tag `CreatedB
+0001e430: 7960 2028 6368 616e 6765 2061 7320 7065  y` (change as pe
+0001e440: 7220 796f 7572 2074 6167 6769 6e67 2073  r your tagging s
+0001e450: 7973 7465 6d29 0a20 2020 2020 2020 2020  ystem).         
+0001e460: 2020 2075 7365 725f 6e61 6d65 203d 2075     user_name = u
+0001e470: 7365 725f 6172 6e2e 7370 6c69 7428 272f  ser_arn.split('/
+0001e480: 2729 5b2d 315d 0a20 2020 2020 2020 2020  ')[-1].         
+0001e490: 2020 2075 7365 725f 6d6f 6e74 686c 795f     user_monthly_
+0001e4a0: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+0001e4b0: 6365 5f63 6c69 656e 742e 6765 745f 636f  ce_client.get_co
+0001e4c0: 7374 5f61 6e64 5f75 7361 6765 280a 2020  st_and_usage(.  
+0001e4d0: 2020 2020 2020 2020 2020 2020 2020 5469                Ti
+0001e4e0: 6d65 5065 7269 6f64 3d7b 0a20 2020 2020  mePeriod={.     
+0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001e500: 5374 6172 7427 3a20 7374 7228 6669 7273  Start': str(firs
+0001e510: 745f 6461 795f 6f66 5f6d 6f6e 7468 292c  t_day_of_month),
+0001e520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e530: 2020 2020 2027 456e 6427 3a20 7374 7228       'End': str(
+0001e540: 746f 6461 792e 6461 7465 2829 290a 2020  today.date()).  
+0001e550: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
+0001e560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e570: 2046 696c 7465 723d 7b0a 2020 2020 2020   Filter={.      
+0001e580: 2020 2020 2020 2020 2020 2020 2020 2241                "A
+0001e590: 6e64 223a 205b 0a20 2020 2020 2020 2020  nd": [.         
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+0001e5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e5c0: 2020 2020 2020 2020 2020 2020 2027 4469               'Di
+0001e5d0: 6d65 6e73 696f 6e73 273a 207b 0a20 2020  mensions': {.   
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5f0: 2020 2020 2020 2020 2020 2020 2027 4b65               'Ke
+0001e600: 7927 3a20 2753 4552 5649 4345 272c 0a20  y': 'SERVICE',. 
+0001e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e620: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001e630: 5661 6c75 6573 273a 205b 2741 6d61 7a6f  Values': ['Amazo
+0001e640: 6e20 456c 6173 7469 6320 436f 6d70 7574  n Elastic Comput
+0001e650: 6520 436c 6f75 6420 2d20 436f 6d70 7574  e Cloud - Comput
+0001e660: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e680: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0001e690: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6b0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+0001e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6d0: 2020 2027 5461 6773 273a 207b 0a20 2020     'Tags': {.   
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6f0: 2020 2020 2020 2020 2020 2020 2027 4b65               'Ke
+0001e700: 7927 3a20 2743 7265 6174 6564 4279 272c  y': 'CreatedBy',
+0001e710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e730: 2027 5661 6c75 6573 273a 205b 7573 6572   'Values': [user
+0001e740: 5f6e 616d 655d 0a20 2020 2020 2020 2020  _name].         
+0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+0001e770: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0001e7a0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+0001e7b0: 2020 2020 2020 2020 4772 616e 756c 6172          Granular
+0001e7c0: 6974 793d 274d 4f4e 5448 4c59 272c 0a20  ity='MONTHLY',. 
+0001e7d0: 2020 2020 2020 2020 2020 2020 2020 204d                 M
+0001e7e0: 6574 7269 6373 3d5b 2755 6e62 6c65 6e64  etrics=['Unblend
+0001e7f0: 6564 436f 7374 275d 2c0a 2020 2020 2020  edCost'],.      
+0001e800: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001e810: 2020 2020 7573 6572 5f6d 6f6e 7468 6c79      user_monthly
+0001e820: 5f63 6f73 7420 3d20 666c 6f61 7428 0a20  _cost = float(. 
+0001e830: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001e840: 7365 725f 6d6f 6e74 686c 795f 7265 7370  ser_monthly_resp
+0001e850: 6f6e 7365 5b27 5265 7375 6c74 7342 7954  onse['ResultsByT
+0001e860: 696d 6527 5d5b 305d 5b27 546f 7461 6c27  ime'][0]['Total'
+0001e870: 5d5b 2755 6e62 6c65 6e64 6564 436f 7374  ]['UnblendedCost
+0001e880: 275d 5b27 416d 6f75 6e74 275d 290a 2020  ']['Amount']).  
+0001e890: 2020 2020 2020 2020 2020 7573 6572 5f6d            user_m
+0001e8a0: 6f6e 7468 6c79 5f75 6e69 7420 3d20 7573  onthly_unit = us
+0001e8b0: 6572 5f6d 6f6e 7468 6c79 5f72 6573 706f  er_monthly_respo
+0001e8c0: 6e73 655b 2752 6573 756c 7473 4279 5469  nse['ResultsByTi
+0001e8d0: 6d65 275d 5b30 5d5b 2754 6f74 616c 275d  me'][0]['Total']
+0001e8e0: 5b27 556e 626c 656e 6465 6443 6f73 7427  ['UnblendedCost'
+0001e8f0: 5d5b 2755 6e69 7427 5d0a 0a20 2020 2020  ]['Unit']..     
+0001e900: 2020 2023 2046 6574 6368 2063 6f73 7420     # Fetch cost 
+0001e910: 6f66 2065 6163 6820 4543 3220 696e 7374  of each EC2 inst
+0001e920: 616e 6365 2074 7970 6520 696e 2074 6865  ance type in the
+0001e930: 206c 6173 7420 3234 2068 6f75 7273 0a20   last 24 hours. 
+0001e940: 2020 2020 2020 2064 6169 6c79 5f72 6573         daily_res
+0001e950: 706f 6e73 6520 3d20 7365 6c66 2e63 655f  ponse = self.ce_
+0001e960: 636c 6965 6e74 2e67 6574 5f63 6f73 745f  client.get_cost_
+0001e970: 616e 645f 7573 6167 6528 0a20 2020 2020  and_usage(.     
+0001e980: 2020 2020 2020 2054 696d 6550 6572 696f         TimePerio
+0001e990: 643d 7b0a 2020 2020 2020 2020 2020 2020  d={.            
+0001e9a0: 2020 2020 2753 7461 7274 273a 2073 7472      'Start': str
+0001e9b0: 2879 6573 7465 7264 6179 292c 0a20 2020  (yesterday),.   
+0001e9c0: 2020 2020 2020 2020 2020 2020 2027 456e               'En
+0001e9d0: 6427 3a20 7374 7228 746f 6461 792e 6461  d': str(today.da
+0001e9e0: 7465 2829 290a 2020 2020 2020 2020 2020  te()).          
+0001e9f0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+0001ea00: 2046 696c 7465 723d 7b0a 2020 2020 2020   Filter={.      
+0001ea10: 2020 2020 2020 2020 2020 2744 696d 656e            'Dimen
+0001ea20: 7369 6f6e 7327 3a20 7b0a 2020 2020 2020  sions': {.      
+0001ea30: 2020 2020 2020 2020 2020 2020 2020 274b                'K
+0001ea40: 6579 273a 2027 5345 5256 4943 4527 2c0a  ey': 'SERVICE',.
+0001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea60: 2020 2020 2756 616c 7565 7327 3a20 5b27      'Values': ['
+0001ea70: 416d 617a 6f6e 2045 6c61 7374 6963 2043  Amazon Elastic C
+0001ea80: 6f6d 7075 7465 2043 6c6f 7564 202d 2043  ompute Cloud - C
+0001ea90: 6f6d 7075 7465 275d 0a20 2020 2020 2020  ompute'].       
+0001eaa0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0001eab0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+0001eac0: 2020 2020 2020 4772 616e 756c 6172 6974        Granularit
+0001ead0: 793d 2744 4149 4c59 272c 0a20 2020 2020  y='DAILY',.     
+0001eae0: 2020 2020 2020 2047 726f 7570 4279 3d5b         GroupBy=[
+0001eaf0: 7b27 5479 7065 273a 2027 4449 4d45 4e53  {'Type': 'DIMENS
+0001eb00: 494f 4e27 2c20 274b 6579 273a 2027 494e  ION', 'Key': 'IN
+0001eb10: 5354 414e 4345 5f54 5950 4527 7d5d 2c0a  STANCE_TYPE'}],.
+0001eb20: 2020 2020 2020 2020 2020 2020 4d65 7472              Metr
+0001eb30: 6963 733d 5b27 556e 626c 656e 6465 6443  ics=['UnblendedC
+0001eb40: 6f73 7427 5d2c 0a20 2020 2020 2020 2029  ost'],.        )
+0001eb50: 0a20 2020 2020 2020 2064 6169 6c79 5f63  .        daily_c
+0001eb60: 6f73 7473 5f62 795f 696e 7374 616e 6365  osts_by_instance
+0001eb70: 203d 207b 6772 6f75 705b 274b 6579 7327   = {group['Keys'
+0001eb80: 5d5b 305d 3a20 2866 6c6f 6174 2867 726f  ][0]: (float(gro
+0001eb90: 7570 5b27 4d65 7472 6963 7327 5d5b 2755  up['Metrics']['U
+0001eba0: 6e62 6c65 6e64 6564 436f 7374 275d 5b27  nblendedCost']['
+0001ebb0: 416d 6f75 6e74 275d 292c 0a20 2020 2020  Amount']),.     
+0001ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebf0: 2067 726f 7570 5b27 4d65 7472 6963 7327   group['Metrics'
+0001ec00: 5d5b 2755 6e62 6c65 6e64 6564 436f 7374  ]['UnblendedCost
+0001ec10: 275d 5b27 556e 6974 275d 2920 666f 7220  ']['Unit']) for 
+0001ec20: 6772 6f75 7020 696e 2064 6169 6c79 5f72  group in daily_r
+0001ec30: 6573 706f 6e73 655b 2752 6573 756c 7473  esponse['Results
+0001ec40: 4279 5469 6d65 275d 5b30 5d5b 2747 726f  ByTime'][0]['Gro
+0001ec50: 7570 7327 5d7d 0a0a 2020 2020 2020 2020  ups']}..        
+0001ec60: 2320 4665 7463 6820 636f 7374 2063 6175  # Fetch cost cau
+0001ec70: 7365 6420 6279 2074 6865 2063 7572 7265  sed by the curre
+0001ec80: 6e74 2075 7365 7220 696e 2074 6865 206c  nt user in the l
+0001ec90: 6173 7420 3234 2068 6f75 7273 0a20 2020  ast 24 hours.   
+0001eca0: 2020 2020 2069 6620 6973 5f72 6f6f 743a       if is_root:
+0001ecb0: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
+0001ecc0: 725f 6461 696c 795f 636f 7374 203d 2073  r_daily_cost = s
+0001ecd0: 756d 285b 636f 7374 5b30 5d0a 2020 2020  um([cost[0].    
+0001ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecf0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001ed00: 7220 636f 7374 2069 6e20 6461 696c 795f  r cost in daily_
+0001ed10: 636f 7374 735f 6279 5f69 6e73 7461 6e63  costs_by_instanc
+0001ed20: 652e 7661 6c75 6573 2829 5d29 0a20 2020  e.values()]).   
+0001ed30: 2020 2020 2020 2020 2023 2055 7369 6e67           # Using
+0001ed40: 206d 6f6e 7468 6c79 2075 6e69 7420 7369   monthly unit si
+0001ed50: 6e63 6520 6974 2073 686f 756c 6420 6265  nce it should be
+0001ed60: 2074 6865 2073 616d 6520 666f 7220 6461   the same for da
+0001ed70: 696c 790a 2020 2020 2020 2020 2020 2020  ily.            
+0001ed80: 7573 6572 5f64 6169 6c79 5f75 6e69 7420  user_daily_unit 
+0001ed90: 3d20 6d6f 6e74 686c 795f 756e 6974 0a20  = monthly_unit. 
+0001eda0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001edb0: 2020 2020 2020 2020 2075 7365 725f 6461           user_da
+0001edc0: 696c 795f 7265 7370 6f6e 7365 203d 2073  ily_response = s
+0001edd0: 656c 662e 6365 5f63 6c69 656e 742e 6765  elf.ce_client.ge
+0001ede0: 745f 636f 7374 5f61 6e64 5f75 7361 6765  t_cost_and_usage
+0001edf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001ee00: 2020 5469 6d65 5065 7269 6f64 3d7b 0a20    TimePeriod={. 
+0001ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee20: 2020 2027 5374 6172 7427 3a20 7374 7228     'Start': str(
+0001ee30: 7965 7374 6572 6461 7929 2c0a 2020 2020  yesterday),.    
+0001ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee50: 2745 6e64 273a 2073 7472 2874 6f64 6179  'End': str(today
+0001ee60: 2e64 6174 6528 2929 0a20 2020 2020 2020  .date()).       
+0001ee70: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
+0001ee80: 2020 2020 2020 2020 2020 2020 4669 6c74              Filt
+0001ee90: 6572 3d7b 0a20 2020 2020 2020 2020 2020  er={.           
+0001eea0: 2020 2020 2020 2020 2022 416e 6422 3a20           "And": 
+0001eeb0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0001eec0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+0001eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eee0: 2020 2020 2020 2020 2744 696d 656e 7369          'Dimensi
+0001eef0: 6f6e 7327 3a20 7b0a 2020 2020 2020 2020  ons': {.        
+0001ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef10: 2020 2020 2020 2020 274b 6579 273a 2027          'Key': '
+0001ef20: 5345 5256 4943 4527 2c0a 2020 2020 2020  SERVICE',.      
+0001ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef40: 2020 2020 2020 2020 2020 2756 616c 7565            'Value
+0001ef50: 7327 3a20 5b27 416d 617a 6f6e 2045 6c61  s': ['Amazon Ela
+0001ef60: 7374 6963 2043 6f6d 7075 7465 2043 6c6f  stic Compute Clo
+0001ef70: 7564 202d 2043 6f6d 7075 7465 275d 0a20  ud - Compute']. 
+0001ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef90: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efb0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efd0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001efe0: 2020 2020 2020 2020 2020 2020 2020 2754                'T
+0001eff0: 6167 7327 3a20 7b0a 2020 2020 2020 2020  ags': {.        
+0001f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f010: 2020 2020 2020 2020 274b 6579 273a 2027          'Key': '
+0001f020: 4372 6561 7465 6442 7927 2c0a 2020 2020  CreatedBy',.    
+0001f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f040: 2020 2020 2020 2020 2020 2020 2756 616c              'Val
+0001f050: 7565 7327 3a20 5b75 7365 725f 6e61 6d65  ues': [user_name
+0001f060: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001f070: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+0001f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f090: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001f0a0: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0001f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f0c0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+0001f0d0: 2020 2047 7261 6e75 6c61 7269 7479 3d27     Granularity='
+0001f0e0: 4441 494c 5927 2c0a 2020 2020 2020 2020  DAILY',.        
+0001f0f0: 2020 2020 2020 2020 4d65 7472 6963 733d          Metrics=
+0001f100: 5b27 556e 626c 656e 6465 6443 6f73 7427  ['UnblendedCost'
+0001f110: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
+0001f120: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
+0001f130: 725f 6461 696c 795f 636f 7374 203d 2066  r_daily_cost = f
+0001f140: 6c6f 6174 280a 2020 2020 2020 2020 2020  loat(.          
+0001f150: 2020 2020 2020 7573 6572 5f64 6169 6c79        user_daily
+0001f160: 5f72 6573 706f 6e73 655b 2752 6573 756c  _response['Resul
+0001f170: 7473 4279 5469 6d65 275d 5b30 5d5b 2754  tsByTime'][0]['T
+0001f180: 6f74 616c 275d 5b27 556e 626c 656e 6465  otal']['Unblende
+0001f190: 6443 6f73 7427 5d5b 2741 6d6f 756e 7427  dCost']['Amount'
+0001f1a0: 5d29 0a20 2020 2020 2020 2020 2020 2075  ]).            u
+0001f1b0: 7365 725f 6461 696c 795f 756e 6974 203d  ser_daily_unit =
+0001f1c0: 2075 7365 725f 6461 696c 795f 7265 7370   user_daily_resp
+0001f1d0: 6f6e 7365 5b27 5265 7375 6c74 7342 7954  onse['ResultsByT
+0001f1e0: 696d 6527 5d5b 305d 5b27 546f 7461 6c27  ime'][0]['Total'
+0001f1f0: 5d5b 2755 6e62 6c65 6e64 6564 436f 7374  ]['UnblendedCost
+0001f200: 275d 5b27 556e 6974 275d 0a0a 2020 2020  ']['Unit']..    
+0001f210: 2020 2020 7265 7475 726e 206d 6f6e 7468      return month
+0001f220: 6c79 5f63 6f73 742c 206d 6f6e 7468 6c79  ly_cost, monthly
+0001f230: 5f75 6e69 742c 2064 6169 6c79 5f63 6f73  _unit, daily_cos
+0001f240: 7473 5f62 795f 696e 7374 616e 6365 2c20  ts_by_instance, 
+0001f250: 7573 6572 5f6d 6f6e 7468 6c79 5f63 6f73  user_monthly_cos
+0001f260: 742c 205c 0a20 2020 2020 2020 2020 2020  t, \.           
+0001f270: 2075 7365 725f 6d6f 6e74 686c 795f 756e   user_monthly_un
+0001f280: 6974 2c20 7573 6572 5f64 6169 6c79 5f63  it, user_daily_c
+0001f290: 6f73 742c 2075 7365 725f 6461 696c 795f  ost, user_daily_
+0001f2a0: 756e 6974 2c20 7573 6572 5f6e 616d 650a  unit, user_name.
+0001f2b0: 0a0a 636c 6173 7320 4172 6368 6976 6572  ..class Archiver
+0001f2c0: 3a0a 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+0001f2d0: 745f 5f28 7365 6c66 2c20 6172 6773 3a20  t__(self, args: 
+0001f2e0: 6172 6770 6172 7365 2e4e 616d 6573 7061  argparse.Namespa
+0001f2f0: 6365 2c20 6366 673a 2043 6f6e 6669 674d  ce, cfg: ConfigM
+0001f300: 616e 6167 6572 293a 0a20 2020 2020 2020  anager):.       
+0001f310: 2073 656c 662e 6172 6773 203d 2061 7267   self.args = arg
+0001f320: 730a 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+0001f330: 6366 6720 3d20 6366 670a 0a20 2020 2020  cfg = cfg..     
+0001f340: 2020 2073 656c 662e 6172 6368 6976 655f     self.archive_
+0001f350: 6a73 6f6e 203d 2063 6667 2e61 7263 6869  json = cfg.archi
+0001f360: 7665 5f6a 736f 6e0a 0a20 2020 2020 2020  ve_json..       
+0001f370: 2078 203d 2063 6667 2e6d 6178 5f73 6d61   x = cfg.max_sma
+0001f380: 6c6c 5f66 696c 655f 7369 7a65 5f6b 6962  ll_file_size_kib
+0001f390: 0a20 2020 2020 2020 2073 656c 662e 7468  .        self.th
+0001f3a0: 7265 7368 6f6c 644b 4220 3d20 696e 7428  resholdKB = int(
+0001f3b0: 7829 2069 6620 7820 656c 7365 2031 3032  x) if x else 102
+0001f3c0: 340a 0a20 2020 2020 2020 2078 203d 2063  4..        x = c
+0001f3d0: 6667 2e6d 696e 5f69 6e64 6578 5f66 6f6c  fg.min_index_fol
+0001f3e0: 6465 725f 7369 7a65 5f67 6962 0a20 2020  der_size_gib.   
+0001f3f0: 2020 2020 2073 656c 662e 7468 7265 7368       self.thresh
+0001f400: 6f6c 6447 4220 3d20 696e 7428 7829 2069  oldGB = int(x) i
+0001f410: 6620 7820 656c 7365 2031 300a 0a20 2020  f x else 10..   
+0001f420: 2020 2020 2078 203d 2063 6667 2e6d 696e       x = cfg.min
+0001f430: 5f69 6e64 6578 5f66 6f6c 6465 725f 7369  _index_folder_si
+0001f440: 7a65 5f61 7667 5f6d 6962 0a20 2020 2020  ze_avg_mib.     
+0001f450: 2020 2073 656c 662e 7468 7265 7368 6f6c     self.threshol
+0001f460: 644d 4220 3d20 696e 7428 7829 2069 6620  dMB = int(x) if 
+0001f470: 7820 656c 7365 2031 300a 0a20 2020 2020  x else 10..     
+0001f480: 2020 2078 203d 2063 6667 2e6d 6178 5f68     x = cfg.max_h
+0001f490: 6f74 7370 6f74 735f 6469 7370 6c61 795f  otspots_display_
+0001f4a0: 656e 7472 6965 730a 2020 2020 2020 2020  entries.        
+0001f4b0: 676c 6f62 616c 204d 4158 484f 5453 504f  global MAXHOTSPO
+0001f4c0: 5453 0a20 2020 2020 2020 204d 4158 484f  TS.        MAXHO
+0001f4d0: 5453 504f 5453 203d 2069 6e74 2878 2920  TSPOTS = int(x) 
+0001f4e0: 6966 2078 2065 6c73 6520 3530 3030 0a0a  if x else 5000..
+0001f4f0: 2020 2020 2020 2020 7365 6c66 2e73 6d61          self.sma
+0001f500: 6c6c 6669 6c65 735f 7461 725f 6669 6c65  llfiles_tar_file
+0001f510: 6e61 6d65 203d 2027 4672 6f73 7465 722e  name = 'Froster.
+0001f520: 736d 616c 6c66 696c 6573 2e74 6172 270a  smallfiles.tar'.
+0001f530: 2020 2020 2020 2020 7365 6c66 2e61 6c6c          self.all
+0001f540: 6669 6c65 735f 6373 765f 6669 6c65 6e61  files_csv_filena
+0001f550: 6d65 203d 2027 4672 6f73 7465 722e 616c  me = 'Froster.al
+0001f560: 6c66 696c 6573 2e63 7376 270a 2020 2020  lfiles.csv'.    
+0001f570: 2020 2020 7365 6c66 2e6d 6435 7375 6d5f      self.md5sum_
+0001f580: 6669 6c65 6e61 6d65 203d 2027 2e66 726f  filename = '.fro
+0001f590: 7374 6572 2e6d 6435 7375 6d27 0a20 2020  ster.md5sum'.   
+0001f5a0: 2020 2020 2073 656c 662e 6d64 3573 756d       self.md5sum
+0001f5b0: 5f72 6573 746f 7265 645f 6669 6c65 6e61  _restored_filena
+0001f5c0: 6d65 203d 2027 2e66 726f 7374 6572 2d72  me = '.froster-r
+0001f5d0: 6573 746f 7265 642e 6d64 3573 756d 270a  estored.md5sum'.
+0001f5e0: 2020 2020 2020 2020 7365 6c66 2e77 6865          self.whe
+0001f5f0: 7265 5f64 6964 5f74 6865 5f66 696c 6573  re_did_the_files
+0001f600: 5f67 6f5f 6669 6c65 6e61 6d65 203d 2027  _go_filename = '
+0001f610: 5768 6572 652d 6469 642d 7468 652d 6669  Where-did-the-fi
+0001f620: 6c65 732d 676f 2e74 7874 270a 0a20 2020  les-go.txt'..   
+0001f630: 2020 2020 2073 656c 662e 6469 726d 6574       self.dirmet
+0001f640: 6166 696c 6573 203d 205b 7365 6c66 2e61  afiles = [self.a
+0001f650: 6c6c 6669 6c65 735f 6373 765f 6669 6c65  llfiles_csv_file
+0001f660: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0001f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f680: 2020 2073 656c 662e 736d 616c 6c66 696c     self.smallfil
+0001f690: 6573 5f74 6172 5f66 696c 656e 616d 652c  es_tar_filename,
+0001f6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f6b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001f6c0: 6c66 2e6d 6435 7375 6d5f 6669 6c65 6e61  lf.md5sum_filena
+0001f6d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0001f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6f0: 2073 656c 662e 6d64 3573 756d 5f72 6573   self.md5sum_res
+0001f700: 746f 7265 645f 6669 6c65 6e61 6d65 2c0a  tored_filename,.
+0001f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f720: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001f730: 662e 7768 6572 655f 6469 645f 7468 655f  f.where_did_the_
+0001f740: 6669 6c65 735f 676f 5f66 696c 656e 616d  files_go_filenam
+0001f750: 655d 0a0a 2020 2020 2020 2020 7365 6c66  e]..        self
+0001f760: 2e67 7261 6e74 7320 3d20 5b5d 0a0a 2020  .grants = []..  
+0001f770: 2020 6465 6620 5f69 6e64 6578 5f6c 6f63    def _index_loc
+0001f780: 616c 6c79 2873 656c 662c 2066 6f6c 6465  ally(self, folde
+0001f790: 7229 3a0a 2020 2020 2020 2020 2727 2749  r):.        '''I
+0001f7a0: 6e64 6578 2074 6865 2067 6976 656e 2066  ndex the given f
+0001f7b0: 6f6c 6465 7220 666f 7220 6172 6368 6976  older for archiv
+0001f7c0: 696e 6727 2727 0a20 2020 2020 2020 2074  ing'''.        t
+0001f7d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001f7e0: 2320 6d6f 7665 2064 6f77 6e20 746f 2063  # move down to c
+0001f7f0: 6c61 7373 0a20 2020 2020 2020 2020 2020  lass.           
+0001f800: 2064 6179 7361 6765 6420 3d20 5b35 3437   daysaged = [547
+0001f810: 352c 2033 3635 302c 2031 3832 352c 2031  5, 3650, 1825, 1
+0001f820: 3039 352c 2037 3330 2c20 3336 352c 2039  095, 730, 365, 9
+0001f830: 302c 2033 305d 0a20 2020 2020 2020 2020  0, 30].         
+0001f840: 2020 2054 6942 203d 2031 3039 3935 3131     TiB = 1099511
+0001f850: 3632 3737 3736 0a20 2020 2020 2020 2020  627776.         
+0001f860: 2020 2023 2047 6942 3d31 3037 3337 3431     # GiB=1073741
+0001f870: 3832 340a 2020 2020 2020 2020 2020 2020  824.            
+0001f880: 2320 4d69 423d 3130 3438 3537 360a 0a20  # MiB=1048576.. 
+0001f890: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0001f8a0: 7077 616c 6b63 6f70 7920 6c6f 6361 7469  pwalkcopy locati
+0001f8b0: 6f6e 2070 726f 7669 6465 642c 2072 756e  on provided, run
+0001f8c0: 2070 7761 6c6b 2061 6e64 2063 6f70 7920   pwalk and copy 
+0001f8d0: 7468 6520 6f75 7470 7574 2074 6f20 7468  the output to th
+0001f8e0: 6520 7370 6563 6966 6965 6420 6c6f 6361  e specified loca
+0001f8f0: 7469 6f6e 2065 7665 7279 2074 696d 650a  tion every time.
+0001f900: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001f910: 656c 662e 6172 6773 2e70 7761 6c6b 636f  elf.args.pwalkco
+0001f920: 7079 3a0a 2020 2020 2020 2020 2020 2020  py:.            
+0001f930: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f950: 275c 6e49 6e64 6578 696e 6720 666f 6c64  '\nIndexing fold
+0001f960: 6572 2022 7b66 6f6c 6465 727d 2220 616e  er "{folder}" an
+0001f970: 6420 636f 7079 696e 6720 6f75 7470 7574  d copying output
+0001f980: 2074 6f20 7b73 656c 662e 6172 6773 2e70   to {self.args.p
+0001f990: 7761 6c6b 636f 7079 7d2e 2e2e 272c 2066  walkcopy}...', f
+0001f9a0: 6c75 7368 3d54 7275 6529 0a20 2020 2020  lush=True).     
+0001f9b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f9c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001f9d0: 6e74 2866 275c 6e49 6e64 6578 696e 6720  nt(f'\nIndexing 
+0001f9e0: 666f 6c64 6572 2022 7b66 6f6c 6465 727d  folder "{folder}
+0001f9f0: 222e 2e2e 272c 2066 6c75 7368 3d54 7275  "...', flush=Tru
+0001fa00: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+0001fa10: 2020 2020 2320 4765 7420 7468 6520 7061      # Get the pa
+0001fa20: 7468 2074 6f20 7468 6520 686f 7473 706f  th to the hotspo
+0001fa30: 7473 2043 5356 2066 696c 650a 2020 2020  ts CSV file.    
+0001fa40: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
+0001fa50: 6572 5f68 6f74 7370 6f74 203d 2073 656c  er_hotspot = sel
+0001fa60: 662e 6765 745f 686f 7473 706f 7473 5f70  f.get_hotspots_p
+0001fa70: 6174 6828 666f 6c64 6572 290a 0a20 2020  ath(folder)..   
+0001fa80: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+0001fa90: 6620 7468 6520 666f 6c64 6572 2069 7320  f the folder is 
+0001faa0: 616c 7265 6164 7920 696e 6465 7865 6420  already indexed 
+0001fab0: 646f 6e27 7420 7275 6e20 7077 616c 6b20  don't run pwalk 
+0001fac0: 6167 6169 6e0a 2020 2020 2020 2020 2020  again.          
+0001fad0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+0001fae0: 2e69 7366 696c 6528 666f 6c64 6572 5f68  .isfile(folder_h
+0001faf0: 6f74 7370 6f74 293a 0a20 2020 2020 2020  otspot):.       
+0001fb00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001fb10: 7365 6c66 2e61 7267 732e 666f 7263 653a  self.args.force:
+0001fb20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fb30: 2020 2020 2020 2020 2023 2049 676e 6f72           # Ignor
+0001fb40: 6520 7468 6520 6578 6973 7469 6e67 2066  e the existing f
+0001fb50: 696c 6520 616e 6420 7265 2d69 6e64 6578  ile and re-index
+0001fb60: 2074 6865 2066 6f6c 6465 720a 2020 2020   the folder.    
+0001fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb80: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0001fb90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001fba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001fbb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001fbc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001fbd0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0001fbe0: 2020 2020 2e2e 2e66 6f6c 6465 7220 616c      ...folder al
+0001fbf0: 7265 6164 7920 696e 6465 7865 6420 6174  ready indexed at
+0001fc00: 207b 666f 6c64 6572 5f68 6f74 7370 6f74   {folder_hotspot
+0001fc10: 7d2e 2055 7365 2022 2d66 2220 6f72 2022  }. Use "-f" or "
+0001fc20: 2d2d 666f 7263 6522 2066 6c61 6720 746f  --force" flag to
+0001fc30: 2066 6f72 6365 2069 6e64 6578 696e 672e   force indexing.
+0001fc40: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+0001fc50: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001fc60: 7572 6e0a 0a20 2020 2020 2020 2020 2020  urn..           
+0001fc70: 2023 2052 756e 2070 7761 6c6b 206f 6e20   # Run pwalk on 
+0001fc80: 6769 7665 6e20 666f 6c64 6572 0a20 2020  given folder.   
+0001fc90: 2020 2020 2020 2020 2077 6974 6820 7465           with te
+0001fca0: 6d70 6669 6c65 2e4e 616d 6564 5465 6d70  mpfile.NamedTemp
+0001fcb0: 6f72 6172 7946 696c 6528 2920 6173 2070  oraryFile() as p
+0001fcc0: 7761 6c6b 5f6f 7574 7075 743a 0a20 2020  walk_output:.   
+0001fcd0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+0001fce0: 6820 7465 6d70 6669 6c65 2e4e 616d 6564  h tempfile.Named
+0001fcf0: 5465 6d70 6f72 6172 7946 696c 6528 2920  TemporaryFile() 
+0001fd00: 6173 2070 7761 6c6b 5f6f 7574 7075 745f  as pwalk_output_
+0001fd10: 666f 6c64 6572 733a 0a20 2020 2020 2020  folders:.       
+0001fd20: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+0001fd30: 6820 7465 6d70 6669 6c65 2e4e 616d 6564  h tempfile.Named
+0001fd40: 5465 6d70 6f72 6172 7946 696c 6528 2920  TemporaryFile() 
+0001fd50: 6173 2070 7761 6c6b 5f6f 7574 7075 745f  as pwalk_output_
+0001fd60: 666f 6c64 6572 735f 636f 6e76 6572 7465  folders_converte
+0001fd70: 643a 0a0a 2020 2020 2020 2020 2020 2020  d:..            
+0001fd80: 2020 2020 2020 2020 2020 2020 2320 4275              # Bu
+0001fd90: 696c 6420 7468 6520 7077 616c 6b20 636f  ild the pwalk co
+0001fda0: 6d6d 616e 640a 2020 2020 2020 2020 2020  mmand.          
+0001fdb0: 2020 2020 2020 2020 2020 2020 2020 7077                pw
+0001fdc0: 616c 6b5f 6269 6e20 3d20 6f73 2e70 6174  alk_bin = os.pat
+0001fdd0: 682e 6a6f 696e 2873 7973 2e70 7265 6669  h.join(sys.prefi
+0001fde0: 782c 2027 6269 6e27 2c20 2770 7761 6c6b  x, 'bin', 'pwalk
+0001fdf0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0001fe00: 2020 2020 2020 2020 2020 2070 7761 6c6b             pwalk
+0001fe10: 636d 6420 3d20 6627 7b70 7761 6c6b 5f62  cmd = f'{pwalk_b
+0001fe20: 696e 7d20 2d2d 4e6f 536e 6170 202d 2d6f  in} --NoSnap --o
+0001fe30: 6e65 2d66 696c 652d 7379 7374 656d 202d  ne-file-system -
+0001fe40: 2d68 6561 6465 7227 0a20 2020 2020 2020  -header'.       
+0001fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe60: 206d 7963 6d64 203d 2066 277b 7077 616c   mycmd = f'{pwal
+0001fe70: 6b63 6d64 7d20 227b 666f 6c64 6572 7d22  kcmd} "{folder}"
+0001fe80: 203e 207b 7077 616c 6b5f 6f75 7470 7574   > {pwalk_output
+0001fe90: 2e6e 616d 657d 270a 0a20 2020 2020 2020  .name}'..       
+0001fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001feb0: 2023 2052 756e 2074 6865 2070 7761 6c6b   # Run the pwalk
+0001fec0: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+0001fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fee0: 2072 6574 203d 2073 7562 7072 6f63 6573   ret = subproces
+0001fef0: 732e 7275 6e28 6d79 636d 642c 2073 6865  s.run(mycmd, she
+0001ff00: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
+0001ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff30: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
+0001ff40: 7072 6f63 6573 732e 5049 5045 2c20 7374  process.PIPE, st
+0001ff50: 6465 7272 3d73 7562 7072 6f63 6573 732e  derr=subprocess.
+0001ff60: 5049 5045 290a 0a20 2020 2020 2020 2020  PIPE)..         
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001ff80: 2043 6865 636b 2069 6620 7468 6520 7077   Check if the pw
+0001ff90: 616c 6b20 636f 6d6d 616e 6420 7761 7320  alk command was 
+0001ffa0: 7375 6363 6573 7366 756c 0a20 2020 2020  successful.     
+0001ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffc0: 2020 2069 6620 7265 742e 7265 7475 726e     if ret.return
+0001ffd0: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
+0001ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fff0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020010: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00020020: 5c6e 4572 726f 723a 2063 6f6d 6d61 6e64  \nError: command
+00020030: 207b 6d79 636d 647d 2066 6169 6c65 6420   {mycmd} failed 
+00020040: 7769 7468 2072 6574 7572 6e63 6f64 6520  with returncode 
+00020050: 7b72 6574 2e72 6574 7572 6e63 6f64 657d  {ret.returncode}
+00020060: 5c6e 222c 2066 696c 653d 7379 732e 7374  \n", file=sys.st
+00020070: 6465 7272 290a 2020 2020 2020 2020 2020  derr).          
+00020080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020090: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200b0: 2020 2020 2020 2023 2049 6620 7077 616c         # If pwal
+000200c0: 6b63 6f70 7920 6c6f 6361 7469 6f6e 2070  kcopy location p
+000200d0: 726f 7669 6465 642c 2074 6865 6e20 636f  rovided, then co
+000200e0: 7079 2074 6865 2070 7761 6c6b 206f 7574  py the pwalk out
+000200f0: 7075 7420 6669 6c65 2074 6f20 7468 6520  put file to the 
+00020100: 7370 6563 6966 6965 6420 6c6f 6361 7469  specified locati
+00020110: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00020120: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00020130: 6c66 2e61 7267 732e 7077 616c 6b63 6f70  lf.args.pwalkcop
+00020140: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+00020150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020160: 636f 7079 5f66 696c 656e 616d 6520 3d20  copy_filename = 
+00020170: 666f 6c64 6572 2e72 6570 6c61 6365 2827  folder.replace('
+00020180: 2f27 2c20 272b 2729 202b 2027 2e63 7376  /', '+') + '.csv
+00020190: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000201a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000201b0: 7079 5f66 696c 655f 7061 7468 203d 206f  py_file_path = o
+000201c0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000201f0: 662e 6172 6773 2e70 7761 6c6b 636f 7079  f.args.pwalkcopy
+00020200: 2c20 636f 7079 5f66 696c 656e 616d 6529  , copy_filename)
+00020210: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00020220: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00020230: 4275 696c 6420 7468 6520 636f 7079 2063  Build the copy c
+00020240: 6f6d 6d61 6e64 0a20 2020 2020 2020 2020  ommand.         
+00020250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020260: 2020 206d 7963 6d64 203d 2066 2769 636f     mycmd = f'ico
+00020270: 6e76 202d 6620 4953 4f2d 3838 3539 2d31  nv -f ISO-8859-1
+00020280: 202d 7420 5554 462d 3820 7b70 7761 6c6b   -t UTF-8 {pwalk
+00020290: 5f6f 7574 7075 742e 6e61 6d65 7d20 2d6f  _output.name} -o
+000202a0: 207b 636f 7079 5f66 696c 655f 7061 7468   {copy_file_path
+000202b0: 7d27 0a0a 2020 2020 2020 2020 2020 2020  }'..            
+000202c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202d0: 2320 5275 6e20 7468 6520 636f 7079 2063  # Run the copy c
+000202e0: 6f6d 6d61 6e64 0a20 2020 2020 2020 2020  ommand.         
+000202f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020300: 2020 2072 6573 756c 7420 3d20 7375 6270     result = subp
+00020310: 726f 6365 7373 2e72 756e 286d 7963 6d64  rocess.run(mycmd
+00020320: 2c20 7368 656c 6c3d 5472 7565 290a 0a20  , shell=True).. 
+00020330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020340: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00020350: 636b 2069 6620 7468 6520 636f 7079 2063  ck if the copy c
+00020360: 6f6d 6d61 6e64 2077 6173 2073 7563 6365  ommand was succe
+00020370: 7373 6675 6c0a 2020 2020 2020 2020 2020  ssful.          
+00020380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020390: 2020 6966 2072 6573 756c 742e 7265 7475    if result.retu
+000203a0: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
+000203b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000203d0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203f0: 2020 2020 2020 2020 6622 5c6e 4572 726f          f"\nErro
+00020400: 723a 2063 6f6d 6d61 6e64 207b 6d79 636d  r: command {mycm
+00020410: 647d 2066 6169 6c65 6420 7769 7468 2072  d} failed with r
+00020420: 6574 7572 6e63 6f64 6520 7b72 6573 756c  eturncode {resul
+00020430: 742e 7265 7475 726e 636f 6465 7d5c 6e22  t.returncode}\n"
+00020440: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
+00020450: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00020460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020470: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
+00020480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020490: 2020 2020 2020 2020 2320 4275 696c 6420          # Build 
+000204a0: 7468 6520 6669 6c65 7320 7265 6d6f 7669  the files removi
+000204b0: 6e67 2063 6f6d 6d61 6e64 0a20 2020 2020  ng command.     
+000204c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204d0: 2020 206d 7963 6d64 203d 2066 2767 7265     mycmd = f'gre
+000204e0: 7020 2d76 2022 2c2d 312c 3024 2220 227b  p -v ",-1,0$" "{
+000204f0: 7077 616c 6b5f 6f75 7470 7574 2e6e 616d  pwalk_output.nam
+00020500: 657d 2220 3e20 7b70 7761 6c6b 5f6f 7574  e}" > {pwalk_out
+00020510: 7075 745f 666f 6c64 6572 732e 6e61 6d65  put_folders.name
+00020520: 7d27 0a0a 2020 2020 2020 2020 2020 2020  }'..            
+00020530: 2020 2020 2020 2020 2020 2020 2320 5275              # Ru
+00020540: 6e20 7468 6520 6669 6c65 7320 7265 6d6f  n the files remo
+00020550: 7669 6e67 2063 6f6d 6d61 6e64 0a20 2020  ving command.   
+00020560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020570: 2020 2020 2072 6573 756c 7420 3d20 7375       result = su
+00020580: 6270 726f 6365 7373 2e72 756e 286d 7963  bprocess.run(myc
+00020590: 6d64 2c20 7368 656c 6c3d 5472 7565 290a  md, shell=True).
+000205a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000205b0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+000205c0: 2069 6620 7468 6520 6669 6c65 7320 7265   if the files re
+000205d0: 6d6f 7669 6e67 2063 6f6d 6d61 6e64 2077  moving command w
+000205e0: 6173 2073 7563 6365 7373 6675 6c0a 2020  as successful.  
+000205f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020600: 2020 2020 2020 6966 2072 6573 756c 742e        if result.
+00020610: 7265 7475 726e 636f 6465 2021 3d20 303a  returncode != 0:
+00020620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020630: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00020640: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00020650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020660: 2020 2020 6622 5c6e 4572 726f 723a 2063      f"\nError: c
+00020670: 6f6d 6d61 6e64 207b 6d79 636d 647d 2066  ommand {mycmd} f
+00020680: 6169 6c65 6420 7769 7468 2072 6574 7572  ailed with retur
+00020690: 6e63 6f64 6520 7b72 6573 756c 742e 7265  ncode {result.re
+000206a0: 7475 726e 636f 6465 7d5c 6e22 2c20 6669  turncode}\n", fi
+000206b0: 6c65 3d73 7973 2e73 7464 6572 7229 0a20  le=sys.stderr). 
+000206c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206d0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+000206e0: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
+000206f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020700: 2320 574f 524b 4152 4f55 4e44 3a20 436f  # WORKAROUND: Co
+00020710: 6e76 6572 7469 6e67 2066 696c 6520 6672  nverting file fr
+00020720: 6f6d 2049 534f 2d38 3835 392d 3120 746f  om ISO-8859-1 to
+00020730: 2075 7466 2d38 2074 6f20 6176 6f69 6420   utf-8 to avoid 
+00020740: 4475 636b 4442 2069 6d70 6f72 7420 6572  DuckDB import er
+00020750: 726f 720a 2020 2020 2020 2020 2020 2020  ror.            
+00020760: 2020 2020 2020 2020 2020 2020 2320 7077              # pw
+00020770: 616c 6b20 646f 6573 2061 6c72 6561 6479  alk does already
+00020780: 206f 7574 7075 7420 5554 462d 382c 2077   output UTF-8, w
+00020790: 6569 7264 2c20 7072 6f62 6162 6c79 2064  eird, probably d
+000207a0: 7563 6b64 6220 6572 726f 720a 0a20 2020  uckdb error..   
+000207b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207c0: 2020 2020 2023 2042 7569 6c64 2074 6865       # Build the
+000207d0: 2066 696c 6520 636f 6e76 6572 7369 6f6e   file conversion
+000207e0: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+000207f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020800: 206d 7963 6d64 203d 2066 2769 636f 6e76   mycmd = f'iconv
+00020810: 202d 6620 4953 4f2d 3838 3539 2d31 202d   -f ISO-8859-1 -
+00020820: 7420 5554 462d 3820 7b70 7761 6c6b 5f6f  t UTF-8 {pwalk_o
+00020830: 7574 7075 745f 666f 6c64 6572 732e 6e61  utput_folders.na
+00020840: 6d65 7d20 2d6f 207b 7077 616c 6b5f 6f75  me} -o {pwalk_ou
+00020850: 7470 7574 5f66 6f6c 6465 7273 5f63 6f6e  tput_folders_con
+00020860: 7665 7274 6564 2e6e 616d 657d 270a 0a20  verted.name}'.. 
+00020870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020880: 2020 2020 2020 2023 2052 756e 2074 6865         # Run the
+00020890: 2066 696c 6520 636f 6e76 6572 7369 6f6e   file conversion
+000208a0: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+000208b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000208c0: 2072 6573 756c 7420 3d20 7375 6270 726f   result = subpro
+000208d0: 6365 7373 2e72 756e 286d 7963 6d64 2c20  cess.run(mycmd, 
+000208e0: 7368 656c 6c3d 5472 7565 290a 0a20 2020  shell=True)..   
+000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020900: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+00020910: 7468 6520 6669 6c65 2063 6f6e 7665 7273  the file convers
+00020920: 696f 6e20 636f 6d6d 616e 6420 7761 7320  ion command was 
+00020930: 7375 6363 6573 7366 756c 0a20 2020 2020  successful.     
+00020940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020950: 2020 2069 6620 7265 7375 6c74 2e72 6574     if result.ret
+00020960: 7572 6e63 6f64 6520 213d 2030 3a0a 2020  urncode != 0:.  
+00020970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020980: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00020990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000209a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000209b0: 2066 225c 6e45 7272 6f72 3a20 636f 6d6d   f"\nError: comm
+000209c0: 616e 6420 7b6d 7963 6d64 7d20 6661 696c  and {mycmd} fail
+000209d0: 6564 2077 6974 6820 7265 7475 726e 636f  ed with returnco
+000209e0: 6465 207b 7265 7375 6c74 2e72 6574 7572  de {result.retur
+000209f0: 6e63 6f64 657d 5c6e 222c 2066 696c 653d  ncode}\n", file=
+00020a00: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
+00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a20: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00020a30: 2831 290a 0a20 2020 2020 2020 2020 2020  (1)..           
+00020a40: 2020 2020 2020 2020 2020 2020 2023 2042               # B
+00020a50: 7569 6c64 2074 6865 2053 514c 2071 7565  uild the SQL que
+00020a60: 7279 206f 6e20 7468 6520 4353 5620 6669  ry on the CSV fi
+00020a70: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+00020a80: 2020 2020 2020 2020 2020 2073 716c 5f71             sql_q
+00020a90: 7565 7279 203d 2066 2222 2253 454c 4543  uery = f"""SELEC
+00020aa0: 5420 5549 4420 6173 2055 7365 722c 0a20  T UID as User,. 
+00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ad0: 2020 2020 2020 2073 745f 6174 696d 6520         st_atime 
+00020ae0: 6173 2041 6363 442c 2073 745f 6d74 696d  as AccD, st_mtim
+00020af0: 6520 6173 204d 6f64 442c 0a20 2020 2020  e as ModD,.     
+00020b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b20: 2020 2070 775f 6469 7273 756d 2f31 3037     pw_dirsum/107
+00020b30: 3337 3431 3832 3420 6173 2047 6942 2c0a  3741824 as GiB,.
+00020b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b60: 2020 2020 2020 2020 7077 5f64 6972 7375          pw_dirsu
+00020b70: 6d2f 3130 3438 3537 362f 7077 5f66 636f  m/1048576/pw_fco
+00020b80: 756e 7420 6173 204d 6942 4176 672c 0a20  unt as MiBAvg,. 
+00020b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bb0: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+00020bc0: 6173 2046 6f6c 6465 722c 2047 4944 2061  as Folder, GID a
+00020bd0: 7320 4772 6f75 702c 0a20 2020 2020 2020  s Group,.       
+00020be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c00: 2070 775f 6469 7273 756d 2f31 3039 3935   pw_dirsum/10995
+00020c10: 3131 3632 3737 3736 2061 7320 5469 422c  11627776 as TiB,
+00020c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c40: 2020 2020 2020 2020 2070 775f 6663 6f75           pw_fcou
+00020c50: 6e74 2061 7320 4669 6c65 436f 756e 742c  nt as FileCount,
+00020c60: 2070 775f 6469 7273 756d 2061 7320 4469   pw_dirsum as Di
+00020c70: 7253 697a 650a 2020 2020 2020 2020 2020  rSize.          
+00020c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c90: 2020 2020 2020 2020 2020 4652 4f4d 2072            FROM r
+00020ca0: 6561 645f 6373 765f 6175 746f 2827 7b70  ead_csv_auto('{p
+00020cb0: 7761 6c6b 5f6f 7574 7075 745f 666f 6c64  walk_output_fold
+00020cc0: 6572 735f 636f 6e76 6572 7465 642e 6e61  ers_converted.na
+00020cd0: 6d65 7d27 2c0a 2020 2020 2020 2020 2020  me}',.          
+00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d00: 2020 6967 6e6f 7265 5f65 7272 6f72 733d    ignore_errors=
+00020d10: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00020d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d30: 2020 2020 2020 2057 4845 5245 2070 775f         WHERE pw_
+00020d40: 6663 6f75 6e74 203e 202d 3120 414e 4420  fcount > -1 AND 
+00020d50: 7077 5f64 6972 7375 6d20 3e20 300a 2020  pw_dirsum > 0.  
+00020d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d80: 2020 4f52 4445 5220 4259 2070 775f 6469    ORDER BY pw_di
+00020d90: 7273 756d 2044 6573 630a 2020 2020 2020  rsum Desc.      
+00020da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020db0: 2020 2020 2020 2020 2020 2222 2220 2023            """  #
+00020dc0: 2070 775f 6469 7273 756d 203e 2031 3037   pw_dirsum > 107
+00020dd0: 3337 3431 3832 340a 0a20 2020 2020 2020  3741824..       
+00020de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020df0: 2023 2043 6f6e 6e65 6374 2074 6f20 616e   # Connect to an
+00020e00: 2069 6e2d 6d65 6d6f 7279 2044 7563 6b44   in-memory DuckD
+00020e10: 4220 696e 7374 616e 6365 0a20 2020 2020  B instance.     
+00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e30: 2020 2064 7563 6b64 625f 636f 6e6e 6563     duckdb_connec
+00020e40: 7469 6f6e 203d 2064 7563 6b64 622e 636f  tion = duckdb.co
+00020e50: 6e6e 6563 7428 273a 6d65 6d6f 7279 3a27  nnect(':memory:'
+00020e60: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00020e70: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
+00020e80: 2074 6865 206e 756d 6265 7220 6f66 2074   the number of t
+00020e90: 6872 6561 6473 2074 6f20 7573 650a 2020  hreads to use.  
+00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020eb0: 2020 2020 2020 6475 636b 6462 5f63 6f6e        duckdb_con
+00020ec0: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
+00020ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020ee0: 2020 2020 2020 2020 2020 2020 2066 2750               f'P
+00020ef0: 5241 474d 4120 7468 7265 6164 733d 7b73  RAGMA threads={s
+00020f00: 656c 662e 6172 6773 2e63 6f72 6573 7d3b  elf.args.cores};
+00020f10: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+00020f20: 2020 2020 2020 2020 2020 2020 2320 4578              # Ex
+00020f30: 6563 7574 6520 7468 6520 5351 4c20 7175  ecute the SQL qu
+00020f40: 6572 790a 2020 2020 2020 2020 2020 2020  ery.            
+00020f50: 2020 2020 2020 2020 2020 2020 726f 7773              rows
+00020f60: 203d 2064 7563 6b64 625f 636f 6e6e 6563   = duckdb_connec
+00020f70: 7469 6f6e 2e65 7865 6375 7465 2873 716c  tion.execute(sql
+00020f80: 5f71 7565 7279 292e 6665 7463 6861 6c6c  _query).fetchall
+00020f90: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00020fa0: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+00020fb0: 7420 7468 6520 636f 6c75 6d6e 206e 616d  t the column nam
+00020fc0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00020fd0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00020fe0: 7220 3d20 6475 636b 6462 5f63 6f6e 6e65  r = duckdb_conne
+00020ff0: 6374 696f 6e2e 6578 6563 7574 6528 0a20  ction.execute(. 
+00021000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021010: 2020 2020 2020 2020 2020 2073 716c 5f71             sql_q
+00021020: 7565 7279 292e 6465 7363 7269 7074 696f  uery).descriptio
+00021030: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00021040: 2020 2020 2020 2020 2020 2023 2043 6c6f             # Clo
+00021050: 7365 2074 6865 2044 7563 6b44 4220 636f  se the DuckDB co
+00021060: 6e6e 6563 7469 6f6e 0a20 2020 2020 2020  nnection.       
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 2064 7563 6b64 625f 636f 6e6e 6563 7469   duckdb_connecti
+00021090: 6f6e 2e63 6c6f 7365 2829 0a0a 2020 2020  on.close()..    
+000210a0: 2020 2020 2020 2020 2320 5365 7420 7570          # Set up
+000210b0: 2076 6172 6961 626c 6573 2066 6f72 2074   variables for t
+000210c0: 6865 2068 6f74 7370 6f74 730a 2020 2020  he hotspots.    
+000210d0: 2020 2020 2020 2020 746f 7461 6c62 7974          totalbyt
+000210e0: 6573 203d 2030 0a20 2020 2020 2020 2020  es = 0.         
+000210f0: 2020 206e 756d 686f 7473 706f 7473 203d     numhotspots =
+00021100: 2030 0a20 2020 2020 2020 2020 2020 2061   0.            a
+00021110: 6765 6462 7974 6573 203d 205b 305d 202a  gedbytes = [0] *
+00021120: 206c 656e 2864 6179 7361 6765 6429 0a0a   len(daysaged)..
+00021130: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+00021140: 7420 7468 6520 7061 7468 2074 6f20 7468  t the path to th
+00021150: 6520 686f 7473 706f 7473 2043 5356 2066  e hotspots CSV f
+00021160: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00021170: 6d79 6373 7620 3d20 7365 6c66 2e67 6574  mycsv = self.get
+00021180: 5f68 6f74 7370 6f74 735f 7061 7468 2866  _hotspots_path(f
+00021190: 6f6c 6465 7229 0a0a 2020 2020 2020 2020  older)..        
+000211a0: 2020 2020 2320 5772 6974 6520 7468 6520      # Write the 
+000211b0: 686f 7473 706f 7473 2074 6f20 7468 6520  hotspots to the 
+000211c0: 4353 5620 6669 6c65 0a20 2020 2020 2020  CSV file.       
+000211d0: 2020 2020 2077 6974 6820 6f70 656e 286d       with open(m
+000211e0: 7963 7376 2c20 2777 2729 2061 7320 663a  ycsv, 'w') as f:
+000211f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021200: 2077 7269 7465 7220 3d20 6373 762e 7772   writer = csv.wr
+00021210: 6974 6572 2866 2c20 6469 616c 6563 743d  iter(f, dialect=
+00021220: 2765 7863 656c 2729 0a20 2020 2020 2020  'excel').       
+00021230: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
+00021240: 7772 6974 6572 6f77 285b 636f 6c5b 305d  writerow([col[0]
+00021250: 2066 6f72 2063 6f6c 2069 6e20 6865 6164   for col in head
+00021260: 6572 5d29 0a20 2020 2020 2020 2020 2020  er]).           
+00021270: 2020 2020 2023 2030 3a55 7372 2c31 3a41       # 0:Usr,1:A
+00021280: 6363 442c 323a 4d6f 6444 2c33 3a47 6942  ccD,2:ModD,3:GiB
+00021290: 2c34 3a4d 6942 4176 672c 353a 466f 6c64  ,4:MiBAvg,5:Fold
+000212a0: 6572 2c36 3a47 7270 2c37 3a54 6942 2c38  er,6:Grp,7:TiB,8
+000212b0: 3a46 696c 6543 6f75 6e74 2c39 3a44 6972  :FileCount,9:Dir
+000212c0: 5369 7a65 0a20 2020 2020 2020 2020 2020  Size.           
+000212d0: 2020 2020 2066 6f72 2072 2069 6e20 726f       for r in ro
+000212e0: 7773 3a0a 2020 2020 2020 2020 2020 2020  ws:.            
+000212f0: 2020 2020 2020 2020 726f 7720 3d20 6c69          row = li
+00021300: 7374 2872 290a 2020 2020 2020 2020 2020  st(r).          
+00021310: 2020 2020 2020 2020 2020 6966 2072 6f77            if row
+00021320: 5b33 5d20 3e3d 2073 656c 662e 7468 7265  [3] >= self.thre
+00021330: 7368 6f6c 6447 4220 616e 6420 726f 775b  sholdGB and row[
+00021340: 345d 203e 3d20 7365 6c66 2e74 6872 6573  4] >= self.thres
+00021350: 686f 6c64 4d42 3a0a 2020 2020 2020 2020  holdMB:.        
+00021360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021370: 6174 696d 6520 3d20 7365 6c66 2e5f 6765  atime = self._ge
+00021380: 745f 6e65 7765 7374 5f66 696c 655f 6174  t_newest_file_at
+00021390: 696d 6528 726f 775b 355d 2c20 726f 775b  ime(row[5], row[
+000213a0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+000213b0: 2020 2020 2020 2020 2020 2020 6d74 696d              mtim
+000213c0: 6520 3d20 7365 6c66 2e5f 6765 745f 6e65  e = self._get_ne
+000213d0: 7765 7374 5f66 696c 655f 6d74 696d 6528  west_file_mtime(
+000213e0: 726f 775b 355d 2c20 726f 775b 325d 290a  row[5], row[2]).
+000213f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021400: 2020 2020 2020 2020 726f 775b 305d 203d          row[0] =
+00021410: 2073 656c 662e 7569 6432 7573 6572 2872   self.uid2user(r
+00021420: 6f77 5b30 5d29 0a20 2020 2020 2020 2020  ow[0]).         
+00021430: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021440: 6f77 5b31 5d20 3d20 7365 6c66 2e64 6179  ow[1] = self.day
+00021450: 7361 676f 2861 7469 6d65 290a 2020 2020  sago(atime).    
+00021460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021470: 2020 2020 726f 775b 325d 203d 2073 656c      row[2] = sel
+00021480: 662e 6461 7973 6167 6f28 6d74 696d 6529  f.daysago(mtime)
+00021490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000214a0: 2020 2020 2020 2020 2072 6f77 5b33 5d20           row[3] 
+000214b0: 3d20 696e 7428 726f 775b 335d 290a 2020  = int(row[3]).  
+000214c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214d0: 2020 2020 2020 726f 775b 345d 203d 2069        row[4] = i
+000214e0: 6e74 2872 6f77 5b34 5d29 0a20 2020 2020  nt(row[4]).     
+000214f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021500: 2020 2072 6f77 5b36 5d20 3d20 7365 6c66     row[6] = self
+00021510: 2e67 6964 3267 726f 7570 2872 6f77 5b36  .gid2group(row[6
+00021520: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00021530: 2020 2020 2020 2020 2020 2072 6f77 5b37             row[7
+00021540: 5d20 3d20 696e 7428 726f 775b 375d 290a  ] = int(row[7]).
+00021550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021560: 2020 2020 2020 2020 7772 6974 6572 2e77          writer.w
+00021570: 7269 7465 726f 7728 726f 7729 0a20 2020  riterow(row).   
+00021580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021590: 2020 2020 206e 756d 686f 7473 706f 7473       numhotspots
+000215a0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+000215b0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+000215c0: 7461 6c62 7974 6573 202b 3d20 726f 775b  talbytes += row[
+000215d0: 395d 0a20 2020 2020 2020 2020 2020 2020  9].             
+000215e0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+000215f0: 2069 6e20 7261 6e67 6528 302c 206c 656e   in range(0, len
+00021600: 2864 6179 7361 6765 6429 293a 0a20 2020  (daysaged)):.   
+00021610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021620: 2020 2020 2020 2020 2069 6620 726f 775b           if row[
+00021630: 315d 203e 2064 6179 7361 6765 645b 695d  1] > daysaged[i]
+00021640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021660: 2020 6966 2069 203d 3d20 303a 0a20 2020    if i == 0:.   
+00021670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021690: 2023 2049 7320 7468 6973 2072 6561 6c6c   # Is this reall
+000216a0: 7920 3135 2079 6561 7273 203f 0a20 2020  y 15 years ?.   
+000216b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216d0: 2070 7269 6e74 6462 6728 0a20 2020 2020   printdbg(.     
+000216e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021700: 2020 2066 2720 207b 726f 775b 355d 7d20     f'  {row[5]} 
+00021710: 6861 7320 6e6f 7420 6265 656e 2061 6363  has not been acc
+00021720: 6573 7365 6420 666f 7220 7b72 6f77 5b31  essed for {row[1
+00021730: 5d7d 2064 6179 732e 2028 6174 696d 6520  ]} days. (atime 
+00021740: 3d20 7b61 7469 6d65 7d29 2729 0a20 2020  = {atime})').   
+00021750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021760: 2020 2020 2020 2020 2020 2020 2061 6765               age
+00021770: 6462 7974 6573 5b69 5d20 2b3d 2072 6f77  dbytes[i] += row
+00021780: 5b39 5d0a 0a20 2020 2020 2020 2020 2020  [9]..           
+00021790: 2070 7269 6e74 2866 2720 2020 202e 2e2e   print(f'    ...
+000217a0: 696e 6465 7869 6e67 2064 6f6e 652e 2729  indexing done.')
+000217b0: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+000217c0: 696e 7428 7465 7874 7772 6170 2e64 6564  int(textwrap.ded
+000217d0: 656e 7428 6627 2727 0a20 2020 2020 2020  ent(f'''.       
+000217e0: 2020 2020 2020 2020 2048 6f74 7370 6f74           Hotspot
+000217f0: 7320 6669 6c65 3a20 7b6d 7963 7376 7d0a  s file: {mycsv}.
+00021800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021810: 2020 2020 7769 7468 207b 6e75 6d68 6f74      with {numhot
+00021820: 7370 6f74 737d 2068 6f74 7370 6f74 7320  spots} hotspots 
+00021830: 3e3d 207b 7365 6c66 2e74 6872 6573 686f  >= {self.thresho
+00021840: 6c64 4742 7d20 4769 420a 2020 2020 2020  ldGB} GiB.      
+00021850: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00021860: 7468 2061 2074 6f74 616c 2064 6973 6b20  th a total disk 
+00021870: 7573 6520 6f66 207b 726f 756e 6428 746f  use of {round(to
+00021880: 7461 6c62 7974 6573 2f54 6942 2c33 297d  talbytes/TiB,3)}
+00021890: 2054 6942 0a20 2020 2020 2020 2020 2020   TiB.           
+000218a0: 2020 2020 2027 2727 2929 0a0a 2020 2020       '''))..    
+000218b0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+000218c0: 546f 7461 6c20 666f 6c64 6572 7320 7072  Total folders pr
+000218d0: 6f63 6573 7365 643a 207b 6c65 6e28 726f  ocessed: {len(ro
+000218e0: 7773 297d 2729 0a0a 2020 2020 2020 2020  ws)}')..        
+000218f0: 2020 2020 6c61 7374 6167 6564 6279 7465      lastagedbyte
+00021900: 7320 3d20 300a 2020 2020 2020 2020 2020  s = 0.          
+00021910: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00021920: 2830 2c20 6c65 6e28 6461 7973 6167 6564  (0, len(daysaged
+00021930: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00021940: 2020 2020 6966 2061 6765 6462 7974 6573      if agedbytes
+00021950: 5b69 5d20 3e20 3020 616e 6420 6167 6564  [i] > 0 and aged
+00021960: 6279 7465 735b 695d 2021 3d20 6c61 7374  bytes[i] != last
+00021970: 6167 6564 6279 7465 733a 0a20 2020 2020  agedbytes:.     
+00021980: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021990: 2064 6564 656e 7465 6420 6d75 6c74 692d   dedented multi-
+000219a0: 6c69 6e65 2072 656d 6f76 696e 6720 5c6e  line removing \n
+000219b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000219c0: 2020 2020 2070 7269 6e74 2874 6578 7477       print(textw
+000219d0: 7261 702e 6465 6465 6e74 2866 2727 270a  rap.dedent(f'''.
+000219e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219f0: 2020 2020 7b72 6f75 6e64 2861 6765 6462      {round(agedb
+00021a00: 7974 6573 5b69 5d2f 5469 422c 3329 7d20  ytes[i]/TiB,3)} 
+00021a10: 5469 4220 6861 7665 206e 6f74 2062 6565  TiB have not bee
+00021a20: 6e20 6163 6365 7373 6564 0a20 2020 2020  n accessed.     
+00021a30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00021a40: 6f72 207b 6461 7973 6167 6564 5b69 5d7d  or {daysaged[i]}
+00021a50: 2064 6179 7320 286f 7220 7b72 6f75 6e64   days (or {round
+00021a60: 2864 6179 7361 6765 645b 695d 2f33 3635  (daysaged[i]/365
+00021a70: 2c31 297d 2079 6561 7273 290a 2020 2020  ,1)} years).    
+00021a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a90: 2727 2729 2e72 6570 6c61 6365 2827 5c6e  ''').replace('\n
+00021aa0: 272c 2027 2729 290a 2020 2020 2020 2020  ', '')).        
+00021ab0: 2020 2020 2020 2020 6c61 7374 6167 6564          lastaged
+00021ac0: 6279 7465 7320 3d20 6167 6564 6279 7465  bytes = agedbyte
+00021ad0: 735b 695d 0a0a 2020 2020 2020 2020 2020  s[i]..          
+00021ae0: 2020 2320 4f75 7470 7574 2064 6563 6f72    # Output decor
+00021af0: 6174 696f 6e20 7072 696e 740a 2020 2020  ation print.    
+00021b00: 2020 2020 2020 2020 7072 696e 7428 290a          print().
+00021b10: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00021b20: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00021b30: 6e74 5f65 7272 6f72 2829 0a0a 2020 2020  nt_error()..    
+00021b40: 6465 6620 5f73 6c75 726d 5f63 6d64 2873  def _slurm_cmd(s
+00021b50: 656c 662c 2066 6f6c 6465 7273 2c20 636d  elf, folders, cm
+00021b60: 645f 7479 7065 293a 0a20 2020 2020 2020  d_type):.       
+00021b70: 2027 2727 4578 6563 7574 6520 7468 6520   '''Execute the 
+00021b80: 6375 7272 656e 7420 636f 6d6d 616e 6420  current command 
+00021b90: 7573 696e 6720 534c 5552 4d27 2727 0a0a  using SLURM'''..
+00021ba0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00021bb0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+00021bc0: 6520 6120 536c 7572 6d45 7373 656e 7469  e a SlurmEssenti
+00021bd0: 616c 7320 6f62 6a65 6374 0a20 2020 2020  als object.     
+00021be0: 2020 2020 2020 2073 6520 3d20 536c 7572         se = Slur
+00021bf0: 6d45 7373 656e 7469 616c 7328 7365 6c66  mEssentials(self
+00021c00: 2e61 7267 732c 2073 656c 662e 6366 6729  .args, self.cfg)
+00021c10: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00021c20: 4765 7420 7468 6520 6c61 6265 6c20 666f  Get the label fo
+00021c30: 7220 7468 6520 6a6f 620a 2020 2020 2020  r the job.      
+00021c40: 2020 2020 2020 6c61 6265 6c20 3d20 7365        label = se
+00021c50: 6c66 2e5f 6765 745f 686f 7473 706f 7473  lf._get_hotspots
+00021c60: 5f66 696c 656e 616d 6528 0a20 2020 2020  _filename(.     
+00021c70: 2020 2020 2020 2020 2020 2066 6f6c 6465             folde
+00021c80: 7273 5b30 5d29 2e72 6570 6c61 6365 2827  rs[0]).replace('
+00021c90: 2e63 7376 272c 2027 2729 2e72 6570 6c61  .csv', '').repla
+00021ca0: 6365 2827 2027 2c20 275f 2729 0a0a 2020  ce(' ', '_')..  
+00021cb0: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+00021cc0: 7468 6520 7368 6f72 746c 6162 656c 2066  the shortlabel f
+00021cd0: 6f72 2074 6865 2053 6c75 726d 206a 6f62  or the Slurm job
+00021ce0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+00021cf0: 7274 6c61 6265 6c20 3d20 6f73 2e70 6174  rtlabel = os.pat
+00021d00: 682e 6261 7365 6e61 6d65 2866 6f6c 6465  h.basename(folde
+00021d10: 7273 5b30 5d29 0a0a 2020 2020 2020 2020  rs[0])..        
+00021d20: 2020 2020 2320 4164 6420 7468 6520 6f72      # Add the or
+00021d30: 6967 696e 616c 2063 6d64 6c69 6e65 2074  iginal cmdline t
+00021d40: 6f20 7468 6520 536c 7572 6d20 7363 7269  o the Slurm scri
+00021d50: 7074 0a20 2020 2020 2020 2020 2020 2063  pt.            c
+00021d60: 6d64 203d 2022 2022 2e6a 6f69 6e28 6d61  md = " ".join(ma
+00021d70: 7028 7368 6c65 782e 7175 6f74 652c 2073  p(shlex.quote, s
+00021d80: 7973 2e61 7267 7629 290a 0a20 2020 2020  ys.argv))..     
+00021d90: 2020 2020 2020 2023 2053 7562 6d69 7420         # Submit 
+00021da0: 7468 6520 6a6f 620a 2020 2020 2020 2020  the job.        
+00021db0: 2020 2020 7365 2e73 7562 6d69 745f 6a6f      se.submit_jo
+00021dc0: 6228 636d 643d 636d 642c 0a20 2020 2020  b(cmd=cmd,.     
+00021dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021de0: 2020 2020 2063 6d64 5f74 7970 653d 636d       cmd_type=cm
+00021df0: 645f 7479 7065 2c0a 2020 2020 2020 2020  d_type,.        
+00021e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e10: 2020 6c61 6265 6c3d 6c61 6265 6c2c 0a20    label=label,. 
+00021e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e30: 2020 2020 2020 2020 2073 686f 7274 6c61           shortla
+00021e40: 6265 6c3d 7368 6f72 746c 6162 656c 290a  bel=shortlabel).
+00021e50: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00021e60: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00021e70: 6e74 5f65 7272 6f72 2829 0a0a 2020 2020  nt_error()..    
+00021e80: 6465 6620 696e 6465 7828 7365 6c66 2c20  def index(self, 
+00021e90: 666f 6c64 6572 7329 3a0a 2020 2020 2020  folders):.      
+00021ea0: 2020 2727 2749 6e64 6578 2074 6865 2067    '''Index the g
+00021eb0: 6976 656e 2066 6f6c 6465 7273 2066 6f72  iven folders for
+00021ec0: 2061 7263 6869 7669 6e67 2727 270a 2020   archiving'''.  
+00021ed0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00021ee0: 2020 2020 2020 2023 2043 6c65 616e 2074         # Clean t
+00021ef0: 6865 2070 726f 7669 6465 6420 7061 7468  he provided path
+00021f00: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+00021f10: 6c64 6572 7320 3d20 636c 6561 6e5f 7061  lders = clean_pa
+00021f20: 7468 5f6c 6973 7428 666f 6c64 6572 7329  th_list(folders)
+00021f30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00021f40: 2073 656c 662e 5f69 735f 7265 6375 7273   self._is_recurs
+00021f50: 6976 655f 636f 6c6c 6973 696f 6e28 666f  ive_collision(fo
+00021f60: 6c64 6572 7329 3a0a 2020 2020 2020 2020  lders):.        
+00021f70: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00021f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f90: 2020 2066 275c 6e45 7272 6f72 3a20 596f     f'\nError: Yo
+00021fa0: 7520 6361 6e6e 6f74 2069 6e64 6578 2066  u cannot index f
+00021fb0: 6f6c 6465 7273 2069 6620 7468 6572 6520  olders if there 
+00021fc0: 6973 2061 2064 6570 656e 6465 6e63 7920  is a dependency 
+00021fd0: 6265 7477 6565 6e20 7468 656d 2e20 5370  between them. Sp
+00021fe0: 6563 6966 7920 6f6e 6c79 2074 6865 2070  ecify only the p
+00021ff0: 6172 656e 7420 666f 6c64 6572 2e5c 6e27  arent folder.\n'
+00022000: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022010: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+00022020: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00022030: 636b 2069 6620 7765 2063 616e 2072 6561  ck if we can rea
+00022040: 6420 2620 7772 6974 6520 616c 6c20 6669  d & write all fi
+00022050: 6c65 7320 616e 6420 666f 6c64 6572 730a  les and folders.
+00022060: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00022070: 6f74 2073 656c 662e 5f69 735f 636f 7272  ot self._is_corr
+00022080: 6563 745f 6669 6c65 735f 666f 6c64 6572  ect_files_folder
+00022090: 735f 7065 726d 6973 7369 6f6e 7328 666f  s_permissions(fo
+000220a0: 6c64 6572 732c 2069 735f 7265 6375 7273  lders, is_recurs
+000220b0: 6976 653d 5472 7565 293a 0a20 2020 2020  ive=True):.     
+000220c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000220d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000220e0: 2020 2020 2020 275c 6e45 7272 6f72 3a20        '\nError: 
+000220f0: 4361 6e6e 6f74 2072 6561 6420 6f72 2077  Cannot read or w
+00022100: 7269 7465 2074 6f20 616c 6c20 6669 6c65  rite to all file
+00022110: 7320 616e 6420 666f 6c64 6572 732e 5c6e  s and folders.\n
+00022120: 272c 2066 696c 653d 7379 732e 7374 6465  ', file=sys.stde
+00022130: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+00022140: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00022150: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00022160: 2759 6f75 2063 616e 2063 6865 636b 2074  'You can check t
+00022170: 6865 2070 6572 6d69 7373 696f 6e73 206f  he permissions o
+00022180: 6620 7468 6520 6669 6c65 7320 616e 6420  f the files and 
+00022190: 666f 6c64 6572 7320 7573 696e 6720 7468  folders using th
+000221a0: 6520 636f 6d6d 616e 643a 272c 2066 696c  e command:', fil
+000221b0: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
+000221c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000221d0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000221e0: 2020 2020 2020 2020 2066 2720 2020 2066           f'    f
+000221f0: 726f 7374 6572 2061 7263 6869 7665 202d  roster archive -
+00022200: 2d70 6572 6d69 7373 696f 6e73 2022 2f79  -permissions "/y
+00022210: 6f75 722f 666f 6c64 6572 2f74 6f2f 6172  our/folder/to/ar
+00022220: 6368 6976 6522 5c6e 272c 2066 696c 653d  chive"\n', file=
+00022230: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
+00022240: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00022250: 6578 6974 2831 290a 0a20 2020 2020 2020  exit(1)..       
+00022260: 2020 2020 2069 6620 7573 655f 736c 7572       if use_slur
+00022270: 6d28 7365 6c66 2e61 7267 732e 6e6f 736c  m(self.args.nosl
+00022280: 7572 6d29 3a0a 2020 2020 2020 2020 2020  urm):.          
+00022290: 2020 2020 2020 7365 6c66 2e5f 736c 7572        self._slur
+000222a0: 6d5f 636d 6428 666f 6c64 6572 733d 666f  m_cmd(folders=fo
+000222b0: 6c64 6572 732c 2063 6d64 5f74 7970 653d  lders, cmd_type=
+000222c0: 2769 6e64 6578 2729 0a20 2020 2020 2020  'index').       
+000222d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000222e0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+000222f0: 6f6c 6465 7220 696e 2066 6f6c 6465 7273  older in folders
+00022300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022310: 2020 2020 2020 7365 6c66 2e5f 696e 6465        self._inde
+00022320: 785f 6c6f 6361 6c6c 7928 666f 6c64 6572  x_locally(folder
+00022330: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00022340: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00022350: 696e 745f 6572 726f 7228 290a 0a20 2020  int_error()..   
+00022360: 2064 6566 2061 7263 6869 7665 5f73 656c   def archive_sel
+00022370: 6563 745f 686f 7473 706f 7473 2873 656c  ect_hotspots(sel
+00022380: 6629 3a0a 0a20 2020 2020 2020 2023 2047  f):..        # G
+00022390: 6574 2074 6865 2068 6f74 7370 6f74 7320  et the hotspots 
+000223a0: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
+000223b0: 2020 686f 7473 706f 7473 5f64 6972 203d    hotspots_dir =
+000223c0: 2073 656c 662e 6366 672e 7368 6172 6564   self.cfg.shared
+000223d0: 5f68 6f74 7370 6f74 735f 6469 7220 6966  _hotspots_dir if
+000223e0: 2073 656c 662e 6366 672e 6973 5f73 6861   self.cfg.is_sha
+000223f0: 7265 6420 656c 7365 2073 656c 662e 6366  red else self.cf
+00022400: 672e 686f 7473 706f 7473 5f64 6972 0a0a  g.hotspots_dir..
+00022410: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00022420: 6966 2074 6865 2048 6f74 7370 6f74 7320  if the Hotspots 
+00022430: 6469 7265 6374 6f72 7920 6578 6973 7473  directory exists
+00022440: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00022450: 686f 7473 706f 7473 5f64 6972 206f 7220  hotspots_dir or 
+00022460: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00022470: 7473 2868 6f74 7370 6f74 735f 6469 7229  ts(hotspots_dir)
+00022480: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00022490: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000224a0: 2020 2020 2027 5c6e 4e6f 2066 6f6c 6465       '\nNo folde
+000224b0: 7273 2074 6f20 6172 6368 6976 6520 696e  rs to archive in
+000224c0: 2061 7267 756d 656e 7473 2061 6e64 206e   arguments and n
+000224d0: 6f20 486f 7473 706f 7473 2043 5356 2066  o Hotspots CSV f
+000224e0: 696c 6573 2066 6f75 6e64 2e27 290a 0a20  iles found.').. 
+000224f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00022500: 2827 5c6e 466f 7220 6172 6368 6976 6520  ('\nFor archive 
+00022510: 6120 7370 6563 6966 6963 2066 6f6c 6465  a specific folde
+00022520: 7220 7275 6e3a 2729 0a20 2020 2020 2020  r run:').       
+00022530: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+00022540: 6672 6f73 7465 7220 6172 6368 6976 6520  froster archive 
+00022550: 222f 796f 7572 2f66 6f6c 6465 722f 746f  "/your/folder/to
+00022560: 2f61 7263 6869 7665 2227 290a 0a20 2020  /archive"')..   
+00022570: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00022580: 5c6e 2046 6f72 2069 6e64 6578 2061 2066  \n For index a f
+00022590: 6f6c 6465 7220 6120 6669 6e64 2068 6f74  older a find hot
+000225a0: 7370 6f74 7320 7275 6e3a 2729 0a20 2020  spots run:').   
+000225b0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000225c0: 2020 2020 6672 6f73 7465 7220 696e 6465      froster inde
+000225d0: 7820 222f 796f 7572 2f66 6f6c 6465 722f  x "/your/folder/
+000225e0: 746f 2f69 6e64 6578 225c 6e27 290a 0a20  to/index"\n').. 
+000225f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022600: 6e0a 0a20 2020 2020 2020 2023 2047 6574  n..        # Get
+00022610: 2061 6c6c 2074 6865 2068 6f74 7370 6f74   all the hotspot
+00022620: 2043 5356 2066 696c 6573 2069 6e20 7468   CSV files in th
+00022630: 6520 686f 7473 706f 7473 2064 6972 6563  e hotspots direc
+00022640: 746f 7279 0a20 2020 2020 2020 2068 6f74  tory.        hot
+00022650: 7370 6f74 735f 6669 6c65 7320 3d20 5b66  spots_files = [f
+00022660: 2066 6f72 2066 2069 6e20 6f73 2e6c 6973   for f in os.lis
+00022670: 7464 6972 280a 2020 2020 2020 2020 2020  tdir(.          
+00022680: 2020 686f 7473 706f 7473 5f64 6972 2920    hotspots_dir) 
+00022690: 6966 2066 6e6d 6174 6368 2e66 6e6d 6174  if fnmatch.fnmat
+000226a0: 6368 2866 2c20 272a 2e63 7376 2729 5d0a  ch(f, '*.csv')].
+000226b0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+000226c0: 2069 6620 7468 6572 6520 6172 6520 4353   if there are CS
+000226d0: 5620 6669 6c65 732c 2069 6620 646f 6e27  V files, if don'
+000226e0: 7420 7468 6572 6520 6172 6520 6e6f 2066  t there are no f
+000226f0: 6f6c 6465 7273 2074 6f20 6172 6368 6976  olders to archiv
+00022700: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+00022710: 2068 6f74 7370 6f74 735f 6669 6c65 733a   hotspots_files:
+00022720: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00022730: 6e74 2827 5c6e 4e6f 2068 6f74 706f 7374  nt('\nNo hotpost
+00022740: 7320 666f 756e 642e 205c 6e27 290a 0a20  s found. \n').. 
+00022750: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00022760: 2866 2759 6f75 2063 616e 2073 6561 7263  (f'You can searc
+00022770: 6820 666f 7220 686f 7473 706f 7420 6279  h for hotspot by
+00022780: 2069 6e64 6578 696e 6720 666f 6c64 6572   indexing folder
+00022790: 7320 7573 696e 6720 636f 6d6d 616e 643a  s using command:
+000227a0: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+000227b0: 7269 6e74 2827 2020 2020 6672 6f73 7465  rint('    froste
+000227c0: 7220 696e 6465 7820 222f 796f 7572 2f66  r index "/your/f
+000227d0: 6f6c 6465 722f 746f 2f69 6e64 6578 225c  older/to/index"\
+000227e0: 6e27 290a 0a20 2020 2020 2020 2020 2020  n')..           
+000227f0: 2070 7269 6e74 2827 466f 7220 6172 6368   print('For arch
+00022800: 6976 6520 6120 7370 6563 6966 6963 2066  ive a specific f
+00022810: 6f6c 6465 7220 7275 6e3a 2729 0a20 2020  older run:').   
+00022820: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00022830: 2020 2020 6672 6f73 7465 7220 6172 6368      froster arch
+00022840: 6976 6520 222f 796f 7572 2f66 6f6c 6465  ive "/your/folde
+00022850: 722f 746f 2f61 7263 6869 7665 225c 6e27  r/to/archive"\n'
+00022860: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00022870: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+00022880: 2053 6f72 7420 7468 6520 4353 5620 6669   Sort the CSV fi
+00022890: 6c65 7320 6279 2074 6865 6972 206d 6f64  les by their mod
+000228a0: 6966 6963 6174 696f 6e20 7469 6d65 2069  ification time i
+000228b0: 6e20 6465 7363 656e 6469 6e67 206f 7264  n descending ord
+000228c0: 6572 2028 6e65 7765 7374 2066 6972 7374  er (newest first
+000228d0: 290a 2020 2020 2020 2020 686f 7473 706f  ).        hotspo
+000228e0: 7473 5f66 696c 6573 2e73 6f72 7428 6b65  ts_files.sort(ke
+000228f0: 793d 6c61 6d62 6461 2078 3a20 6f73 2e70  y=lambda x: os.p
+00022900: 6174 682e 6765 746d 7469 6d65 280a 2020  ath.getmtime(.  
+00022910: 2020 2020 2020 2020 2020 6f73 2e70 6174            os.pat
+00022920: 682e 6a6f 696e 2868 6f74 7370 6f74 735f  h.join(hotspots_
+00022930: 6469 722c 2078 2929 2c20 7265 7665 7273  dir, x)), revers
+00022940: 653d 5472 7565 290a 0a20 2020 2020 2020  e=True)..       
+00022950: 2023 2041 736b 2074 6865 2075 7365 7220   # Ask the user 
+00022960: 746f 2073 656c 6563 7420 6120 486f 7473  to select a Hots
+00022970: 706f 7420 6669 6c65 0a20 2020 2020 2020  pot file.       
+00022980: 2072 6574 203d 2054 6578 7475 616c 5374   ret = TextualSt
+00022990: 7269 6e67 4c69 7374 5365 6c65 6374 6f72  ringListSelector
+000229a0: 280a 2020 2020 2020 2020 2020 2020 7469  (.            ti
+000229b0: 746c 653d 2253 656c 6563 7420 6120 486f  tle="Select a Ho
+000229c0: 7473 706f 7420 6669 6c65 222c 2069 7465  tspot file", ite
+000229d0: 6d73 3d68 6f74 7370 6f74 735f 6669 6c65  ms=hotspots_file
+000229e0: 7329 2e72 756e 2829 0a0a 2020 2020 2020  s).run()..      
+000229f0: 2020 2320 4e6f 2066 696c 6520 7365 6c65    # No file sele
+00022a00: 6374 6564 0a20 2020 2020 2020 2069 6620  cted.        if 
+00022a10: 6e6f 7420 7265 743a 0a20 2020 2020 2020  not ret:.       
+00022a20: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00022a30: 2020 2020 2023 2047 6574 2074 6865 2073       # Get the s
+00022a40: 656c 6563 7465 6420 4353 5620 6669 6c65  elected CSV file
+00022a50: 0a20 2020 2020 2020 2068 6f74 7370 6f74  .        hotspot
+00022a60: 5f73 656c 6563 7465 6420 3d20 6f73 2e70  _selected = os.p
+00022a70: 6174 682e 6a6f 696e 2868 6f74 7370 6f74  ath.join(hotspot
+00022a80: 735f 6469 722c 2072 6574 5b30 5d29 0a0a  s_dir, ret[0])..
+00022a90: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
+00022aa0: 6520 666f 6c64 6572 7320 746f 2061 7263  e folders to arc
+00022ab0: 6869 7665 2066 726f 6d20 7468 6520 7365  hive from the se
+00022ac0: 6c65 6374 6564 2048 6f74 7370 6f74 2066  lected Hotspot f
+00022ad0: 696c 650a 2020 2020 2020 2020 666f 6c64  ile.        fold
+00022ae0: 6572 735f 746f 5f61 7263 6869 7665 203d  ers_to_archive =
+00022af0: 2073 656c 662e 6765 745f 686f 7473 706f   self.get_hotspo
+00022b00: 745f 666f 6c64 6572 7328 686f 7473 706f  t_folders(hotspo
+00022b10: 745f 7365 6c65 6374 6564 290a 0a20 2020  t_selected)..   
+00022b20: 2020 2020 2069 6620 6e6f 7420 666f 6c64       if not fold
+00022b30: 6572 735f 746f 5f61 7263 6869 7665 3a0a  ers_to_archive:.
+00022b40: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00022b50: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00022b60: 2020 2066 275c 6e4e 6f20 686f 7473 706f     f'\nNo hotspo
+00022b70: 7473 2074 6f20 6172 6368 6976 6520 666f  ts to archive fo
+00022b80: 756e 6420 696e 207b 686f 7473 706f 745f  und in {hotspot_
+00022b90: 7365 6c65 6374 6564 7d2e 2729 0a20 2020  selected}.').   
+00022ba0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00022bb0: 0a20 2020 2020 2020 2023 2041 7263 6869  .        # Archi
+00022bc0: 7669 6e67 206f 7074 696f 6e73 0a20 2020  ving options.   
+00022bd0: 2020 2020 2061 7263 6869 7669 6e67 5f6f       archiving_o
+00022be0: 7074 696f 6e73 203d 205b 2741 7263 6869  ptions = ['Archi
+00022bf0: 7665 2061 6c6c 2068 6f74 7370 6f74 7327  ve all hotspots'
+00022c00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022c10: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00022c20: 4172 6368 6976 6520 6f6e 6520 686f 7473  Archive one hots
+00022c30: 706f 7427 2c20 2743 616e 6365 6c27 5d0a  pot', 'Cancel'].
+00022c40: 0a20 2020 2020 2020 2023 2041 736b 2074  .        # Ask t
+00022c50: 6865 2075 7365 7220 686f 7720 746f 2070  he user how to p
+00022c60: 726f 6365 6564 2077 6974 6820 7468 6520  roceed with the 
+00022c70: 6172 6368 6976 696e 6720 7072 6f63 6573  archiving proces
+00022c80: 730a 2020 2020 2020 2020 6172 6368 6976  s.        archiv
+00022c90: 655f 7072 6f63 6564 7572 6520 3d20 696e  e_procedure = in
+00022ca0: 7175 6972 6572 2e6c 6973 745f 696e 7075  quirer.list_inpu
+00022cb0: 7428 0a20 2020 2020 2020 2020 2020 206d  t(.            m
+00022cc0: 6573 7361 6765 3d66 2248 6f77 2073 686f  essage=f"How sho
+00022cd0: 756c 6420 7765 2070 726f 6365 6564 2077  uld we proceed w
+00022ce0: 6974 6820 7468 6520 6172 6368 6976 696e  ith the archivin
+00022cf0: 6720 7072 6f63 6573 733f 222c 0a20 2020  g process?",.   
+00022d00: 2020 2020 2020 2020 2063 686f 6963 6573           choices
+00022d10: 3d61 7263 6869 7669 6e67 5f6f 7074 696f  =archiving_optio
+00022d20: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+00022d30: 6465 6661 756c 743d 2743 616e 6365 6c27  default='Cancel'
+00022d40: 290a 0a20 2020 2020 2020 2069 6620 6172  )..        if ar
+00022d50: 6368 6976 655f 7072 6f63 6564 7572 6520  chive_procedure 
+00022d60: 3d3d 2027 4172 6368 6976 6520 616c 6c20  == 'Archive all 
+00022d70: 686f 7473 706f 7473 273a 0a20 2020 2020  hotspots':.     
+00022d80: 2020 2020 2020 2023 2044 6f20 6e6f 7468         # Do noth
+00022d90: 696e 672c 2077 6520 616c 7265 6164 7920  ing, we already 
+00022da0: 6861 7665 2074 6865 2066 6f6c 6465 7273  have the folders
+00022db0: 206c 6973 7420 746f 2061 7263 6869 7665   list to archive
+00022dc0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00022dd0: 730a 0a20 2020 2020 2020 2065 6c69 6620  s..        elif 
+00022de0: 6172 6368 6976 655f 7072 6f63 6564 7572  archive_procedur
+00022df0: 6520 3d3d 2027 4172 6368 6976 6520 6f6e  e == 'Archive on
+00022e00: 6520 686f 7473 706f 7427 3a0a 2020 2020  e hotspot':.    
+00022e10: 2020 2020 2020 2020 7265 7420 3d20 5465          ret = Te
+00022e20: 7874 7561 6c53 7472 696e 674c 6973 7453  xtualStringListS
+00022e30: 656c 6563 746f 7228 0a20 2020 2020 2020  elector(.       
+00022e40: 2020 2020 2020 2020 2074 6974 6c65 3d22           title="
+00022e50: 5365 6c65 6374 2068 6f74 7370 6f74 2074  Select hotspot t
+00022e60: 6f20 6172 6368 6976 6520 222c 2069 7465  o archive ", ite
+00022e70: 6d73 3d66 6f6c 6465 7273 5f74 6f5f 6172  ms=folders_to_ar
+00022e80: 6368 6976 6529 2e72 756e 2829 0a20 2020  chive).run().   
+00022e90: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00022ea0: 7265 743a 0a20 2020 2020 2020 2020 2020  ret:.           
+00022eb0: 2020 2020 2023 204e 6f20 6669 6c65 2073       # No file s
+00022ec0: 656c 6563 7465 640a 2020 2020 2020 2020  elected.        
+00022ed0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00022ee0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00022ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022f00: 2066 6f6c 6465 7273 5f74 6f5f 6172 6368   folders_to_arch
+00022f10: 6976 6520 3d20 5b72 6574 5b30 5d5d 0a0a  ive = [ret[0]]..
+00022f20: 2020 2020 2020 2020 656c 6966 2061 7263          elif arc
+00022f30: 6869 7665 5f70 726f 6365 6475 7265 203d  hive_procedure =
+00022f40: 3d20 2743 616e 6365 6c27 3a0a 2020 2020  = 'Cancel':.    
+00022f50: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00022f60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00022f70: 2020 2020 2020 2020 2020 2320 5765 2073            # We s
+00022f80: 686f 756c 6420 6e65 7665 7220 656e 6420  hould never end 
+00022f90: 7570 2068 6572 650a 2020 2020 2020 2020  up here.        
+00022fa0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00022fb0: 7272 6f72 2822 496e 7661 6c69 6420 6f70  rror("Invalid op
+00022fc0: 7469 6f6e 2073 656c 6563 7465 642e 2229  tion selected.")
+00022fd0: 0a0a 2020 2020 2020 2020 2320 4172 6368  ..        # Arch
+00022fe0: 6976 6520 7468 6520 7365 6c65 6374 6564  ive the selected
+00022ff0: 2066 6f6c 6465 7273 0a20 2020 2020 2020   folders.       
+00023000: 2073 656c 662e 6172 6368 6976 6528 666f   self.archive(fo
+00023010: 6c64 6572 735f 746f 5f61 7263 6869 7665  lders_to_archive
+00023020: 290a 0a20 2020 2064 6566 205f 6973 5f72  )..    def _is_r
+00023030: 6563 7572 7369 7665 5f63 6f6c 6c69 7369  ecursive_collisi
+00023040: 6f6e 2873 656c 662c 2066 6f6c 6465 7273  on(self, folders
+00023050: 293a 0a20 2020 2020 2020 2027 2727 4368  ):.        '''Ch
+00023060: 6563 6b20 6966 2074 6865 7265 2069 7320  eck if there is 
+00023070: 6120 636f 6c6c 6973 696f 6e20 6265 7477  a collision betw
+00023080: 6565 6e20 666f 6c64 6572 7320 616e 6420  een folders and 
+00023090: 7265 6375 7273 6976 6520 666c 6167 2727  recursive flag''
+000230a0: 270a 2020 2020 2020 2020 6973 5f63 6f6c  '.        is_col
+000230b0: 6c69 7369 6f6e 203d 2046 616c 7365 0a0a  lision = False..
+000230c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000230d0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+000230e0: 6e20 7261 6e67 6528 6c65 6e28 666f 6c64  n range(len(fold
+000230f0: 6572 7329 293a 0a20 2020 2020 2020 2020  ers)):.         
+00023100: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
+00023110: 7261 6e67 6528 6920 2b20 312c 206c 656e  range(i + 1, len
+00023120: 2866 6f6c 6465 7273 2929 3a0a 2020 2020  (folders)):.    
+00023130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023140: 2320 4368 6563 6b20 6966 2066 6f6c 6465  # Check if folde
+00023150: 7273 5b6a 5d20 6973 2061 2073 7562 6469  rs[j] is a subdi
+00023160: 7265 6374 6f72 7920 6f66 2066 6f6c 6465  rectory of folde
+00023170: 7273 5b69 5d0a 2020 2020 2020 2020 2020  rs[i].          
+00023180: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00023190: 7061 7468 2e63 6f6d 6d6f 6e70 6174 6828  path.commonpath(
+000231a0: 5b66 6f6c 6465 7273 5b69 5d2c 2066 6f6c  [folders[i], fol
+000231b0: 6465 7273 5b6a 5d5d 2920 3d3d 2066 6f6c  ders[j]]) == fol
+000231c0: 6465 7273 5b69 5d3a 0a20 2020 2020 2020  ders[i]:.       
+000231d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231e0: 2069 735f 636f 6c6c 6973 696f 6e20 3d20   is_collision = 
+000231f0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00023200: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00023210: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00023220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023230: 6627 466f 6c64 6572 207b 666f 6c64 6572  f'Folder {folder
+00023240: 735b 6a5d 7d20 6973 2061 2073 7562 6469  s[j]} is a subdi
+00023250: 7265 6374 6f72 7920 6f66 2066 6f6c 6465  rectory of folde
+00023260: 7220 7b66 6f6c 6465 7273 5b69 5d7d 2e5c  r {folders[i]}.\
+00023270: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
+00023280: 6572 7229 0a0a 2020 2020 2020 2020 2020  err)..          
+00023290: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+000232a0: 6b20 6966 2066 6f6c 6465 7273 5b69 5d20  k if folders[i] 
+000232b0: 6973 2061 2073 7562 6469 7265 6374 6f72  is a subdirector
+000232c0: 7920 6f66 2066 6f6c 6465 7273 5b6a 5d0a  y of folders[j].
+000232d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000232e0: 2020 2020 656c 6966 206f 732e 7061 7468      elif os.path
+000232f0: 2e63 6f6d 6d6f 6e70 6174 6828 5b66 6f6c  .commonpath([fol
+00023300: 6465 7273 5b69 5d2c 2066 6f6c 6465 7273  ders[i], folders
+00023310: 5b6a 5d5d 2920 3d3d 2066 6f6c 6465 7273  [j]]) == folders
+00023320: 5b6a 5d3a 0a20 2020 2020 2020 2020 2020  [j]:.           
+00023330: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00023340: 636f 6c6c 6973 696f 6e20 3d20 5472 7565  collision = True
+00023350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023360: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+00023370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023380: 2020 2020 2020 2020 2020 2020 6627 466f              f'Fo
+00023390: 6c64 6572 207b 666f 6c64 6572 735b 695d  lder {folders[i]
+000233a0: 7d20 6973 2061 2073 7562 6469 7265 6374  } is a subdirect
+000233b0: 6f72 7920 6f66 2066 6f6c 6465 7220 7b66  ory of folder {f
+000233c0: 6f6c 6465 7273 5b6a 5d7d 2e5c 6e27 290a  olders[j]}.\n').
+000233d0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000233e0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+000233f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00023400: 5f65 7272 6f72 2829 0a20 2020 2020 2020  _error().       
+00023410: 2020 2020 2069 735f 636f 6c6c 6973 696f       is_collisio
+00023420: 6e20 3d20 5472 7565 0a0a 2020 2020 2020  n = True..      
+00023430: 2020 7265 7475 726e 2069 735f 636f 6c6c    return is_coll
+00023440: 6973 696f 6e0a 0a20 2020 2064 6566 205f  ision..    def _
+00023450: 6172 6368 6976 655f 6c6f 6361 6c6c 7928  archive_locally(
+00023460: 7365 6c66 2c20 666f 6c64 6572 5f74 6f5f  self, folder_to_
+00023470: 6172 6368 6976 652c 2069 735f 7265 6375  archive, is_recu
+00023480: 7273 6976 652c 2069 735f 7375 6266 6f6c  rsive, is_subfol
+00023490: 6465 722c 2069 735f 7461 722c 2069 735f  der, is_tar, is_
+000234a0: 666f 7263 6529 3a0a 2020 2020 2020 2020  force):.        
+000234b0: 2727 2741 7263 6869 7665 2074 6865 2067  '''Archive the g
+000234c0: 6976 656e 2066 6f6c 6465 7227 2727 0a0a  iven folder'''..
+000234d0: 2020 2020 2020 2020 2320 5365 7420 776f          # Set wo
+000234e0: 726b 666c 6f77 2065 7865 6375 7469 6f6e  rkflow execution
+000234f0: 2066 6c61 6773 0a20 2020 2020 2020 2069   flags.        i
+00023500: 735f 666f 6c64 6572 5f74 6172 7265 6420  s_folder_tarred 
+00023510: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00023520: 6973 5f66 6f6c 6465 725f 6172 6368 6976  is_folder_archiv
+00023530: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00023540: 2020 2069 735f 6672 6f73 7465 725f 616c     is_froster_al
+00023550: 6c66 696c 6573 5f67 656e 6572 6174 6564  lfiles_generated
+00023560: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00023570: 2069 735f 6368 6563 6b73 756d 5f67 656e   is_checksum_gen
+00023580: 6572 6174 6564 203d 2046 616c 7365 0a20  erated = False. 
+00023590: 2020 2020 2020 2069 735f 6368 6563 6b73         is_checks
+000235a0: 756d 5f63 6f72 7265 6374 203d 2046 616c  um_correct = Fal
+000235b0: 7365 0a0a 2020 2020 2020 2020 7472 793a  se..        try:
+000235c0: 0a20 2020 2020 2020 2020 2020 2073 335f  .            s3_
+000235d0: 6465 7374 203d 206f 732e 7061 7468 2e6a  dest = os.path.j
+000235e0: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
+000235f0: 2020 2020 2066 273a 7333 3a7b 7365 6c66       f':s3:{self
+00023600: 2e63 6667 2e62 7563 6b65 745f 6e61 6d65  .cfg.bucket_name
+00023610: 7d27 2c0a 2020 2020 2020 2020 2020 2020  }',.            
+00023620: 2020 2020 7365 6c66 2e63 6667 2e61 7263      self.cfg.arc
+00023630: 6869 7665 5f64 6972 2c0a 2020 2020 2020  hive_dir,.      
+00023640: 2020 2020 2020 2020 2020 666f 6c64 6572            folder
+00023650: 5f74 6f5f 6172 6368 6976 652e 6c73 7472  _to_archive.lstr
+00023660: 6970 286f 732e 7061 7468 2e73 6570 2929  ip(os.path.sep))
+00023670: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00023680: 544f 444f 3a20 766d 6163 6861 646f 3a20  TODO: vmachado: 
+00023690: 7265 7669 6577 2074 6869 7320 636f 6465  review this code
+000236a0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+000236b0: 7374 6572 5f6d 6435 7375 6d5f 6578 6973  ster_md5sum_exis
+000236c0: 7473 203d 206f 732e 7061 7468 2e69 7366  ts = os.path.isf
+000236d0: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
+000236e0: 2020 2020 206f 732e 7061 7468 2e6a 6f69       os.path.joi
+000236f0: 6e28 666f 6c64 6572 5f74 6f5f 6172 6368  n(folder_to_arch
+00023700: 6976 652c 2022 2e66 726f 7374 6572 2e6d  ive, ".froster.m
+00023710: 6435 7375 6d22 2929 0a0a 2020 2020 2020  d5sum"))..      
+00023720: 2020 2020 2020 6966 2066 726f 7374 6572        if froster
+00023730: 5f6d 6435 7375 6d5f 6578 6973 7473 3a0a  _md5sum_exists:.
+00023740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023750: 6966 2069 735f 666f 7263 653a 0a20 2020  if is_force:.   
+00023760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023770: 2073 656c 662e 7265 7365 745f 666f 6c64   self.reset_fold
+00023780: 6572 2866 6f6c 6465 725f 746f 5f61 7263  er(folder_to_arc
+00023790: 6869 7665 290a 2020 2020 2020 2020 2020  hive).          
+000237a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000237b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237c0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+000237d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000237e0: 275c 6e54 6865 2068 6173 6866 696c 6520  '\nThe hashfile 
+000237f0: 222e 6672 6f73 7465 722e 6d64 3573 756d  ".froster.md5sum
+00023800: 2220 616c 7265 6164 7920 6578 6973 7473  " already exists
+00023810: 2069 6e20 7b66 6f6c 6465 725f 746f 5f61   in {folder_to_a
+00023820: 7263 6869 7665 7d20 6672 6f6d 2061 2070  rchive} from a p
+00023830: 7265 7669 6f75 7320 6172 6368 6976 696e  revious archivin
+00023840: 6720 7072 6f63 6573 732e 2729 0a20 2020  g process.').   
+00023850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023860: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00023870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023880: 6627 5c6e 4966 2079 6f75 2077 616e 7420  f'\nIf you want 
+00023890: 746f 2066 6f72 6365 2074 6865 2061 7263  to force the arc
+000238a0: 6869 7669 6e67 2070 726f 6365 7373 2061  hiving process a
+000238b0: 6761 696e 206f 6e20 7468 6973 2066 6f6c  gain on this fol
+000238c0: 6465 722c 2070 6c65 6173 6520 7573 2074  der, please us t
+000238d0: 6865 202d 6620 6f72 202d 2d66 6f72 6365  he -f or --force
+000238e0: 2066 6c61 675c 6e27 290a 2020 2020 2020   flag\n').      
+000238f0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00023900: 732e 6578 6974 2831 290a 0a20 2020 2020  s.exit(1)..     
+00023910: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+00023920: 6620 7468 6520 666f 6c64 6572 2069 7320  f the folder is 
+00023930: 656d 7074 790a 2020 2020 2020 2020 2020  empty.          
+00023940: 2020 7769 7468 206f 732e 7363 616e 6469    with os.scandi
+00023950: 7228 666f 6c64 6572 5f74 6f5f 6172 6368  r(folder_to_arch
+00023960: 6976 6529 2061 7320 656e 7472 6965 733a  ive) as entries:
+00023970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023980: 2069 6620 6e6f 7420 616e 7928 5472 7565   if not any(True
+00023990: 2066 6f72 205f 2069 6e20 656e 7472 6965   for _ in entrie
+000239a0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+000239b0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+000239c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239d0: 2020 2020 2020 2066 275c 6e46 6f6c 6465         f'\nFolde
+000239e0: 7220 7b66 6f6c 6465 725f 746f 5f61 7263  r {folder_to_arc
+000239f0: 6869 7665 7d20 6973 2065 6d70 7479 2c20  hive} is empty, 
+00023a00: 736b 6970 7069 6e67 2e5c 6e27 290a 2020  skipping.\n').  
+00023a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a20: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00023a30: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
+00023a40: 4152 4348 4956 494e 4720 7b66 6f6c 6465  ARCHIVING {folde
+00023a50: 725f 746f 5f61 7263 6869 7665 7d27 290a  r_to_archive}').
+00023a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00023a70: 6973 5f74 6172 3a0a 2020 2020 2020 2020  is_tar:.        
+00023a80: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00023a90: 5c6e 2020 2020 4765 6e65 7261 7469 6e67  \n    Generating
+00023aa0: 2046 726f 7374 6572 2e61 6c6c 6669 6c65   Froster.allfile
+00023ab0: 732e 6373 7620 616e 6420 7461 7220 736d  s.csv and tar sm
+00023ac0: 616c 6c20 6669 6c65 732e 2e2e 2729 0a20  all files...'). 
+00023ad0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00023ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023af0: 2070 7269 6e74 2866 275c 6e20 2020 2047   print(f'\n    G
+00023b00: 656e 6572 6174 696e 6720 4672 6f73 7465  enerating Froste
+00023b10: 722e 616c 6c66 696c 6573 2e63 7376 2e2e  r.allfiles.csv..
+00023b20: 2e27 290a 0a20 2020 2020 2020 2020 2020  .')..           
+00023b30: 2023 2047 656e 6572 6174 6520 4672 6f73   # Generate Fros
+00023b40: 7465 722e 616c 6c66 696c 6573 2e63 7376  ter.allfiles.csv
+00023b50: 2061 6e64 2069 6620 6973 5f74 6172 2074   and if is_tar t
+00023b60: 6172 2073 6d61 6c6c 2066 696c 6573 0a20  ar small files. 
+00023b70: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00023b80: 6c66 2e5f 6765 6e5f 616c 6c66 696c 6573  lf._gen_allfiles
+00023b90: 5f61 6e64 5f74 6172 2866 6f6c 6465 725f  _and_tar(folder_
+00023ba0: 746f 5f61 7263 6869 7665 2c20 7365 6c66  to_archive, self
+00023bb0: 2e74 6872 6573 686f 6c64 4b42 2c20 6973  .thresholdKB, is
+00023bc0: 5f74 6172 293a 0a20 2020 2020 2020 2020  _tar):.         
+00023bd0: 2020 2020 2020 2069 735f 6672 6f73 7465         is_froste
+00023be0: 725f 616c 6c66 696c 6573 5f67 656e 6572  r_allfiles_gener
+00023bf0: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
+00023c00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00023c10: 7428 6627 2020 2020 2020 2020 2e2e 2e64  t(f'        ...d
+00023c20: 6f6e 6527 290a 2020 2020 2020 2020 2020  one').          
+00023c30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023c40: 2020 2020 2020 2020 2320 536f 6d65 7468          # Someth
+00023c50: 696e 6720 6661 696c 6564 2c20 6578 6974  ing failed, exit
+00023c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023c70: 2070 7269 6e74 2866 2720 2020 2020 2020   print(f'       
+00023c80: 202e 2e2e 4641 494c 4544 5c6e 2729 0a20   ...FAILED\n'). 
+00023c90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00023ca0: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
+00023cb0: 2020 2023 2047 656e 6572 6174 6520 6d64     # Generate md
+00023cc0: 3520 6368 6563 6b73 756d 7320 666f 7220  5 checksums for 
+00023cd0: 616c 6c20 6669 6c65 7320 696e 2074 6865  all files in the
+00023ce0: 2066 6f6c 6465 720a 2020 2020 2020 2020   folder.        
+00023cf0: 2020 2020 7072 696e 7428 6627 5c6e 2020      print(f'\n  
+00023d00: 2020 4765 6e65 7261 7469 6e67 2063 6865    Generating che
+00023d10: 636b 7375 6d73 2e2e 2e27 290a 2020 2020  cksums...').    
+00023d20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00023d30: 5f67 656e 5f6d 6435 7375 6d73 2866 6f6c  _gen_md5sums(fol
+00023d40: 6465 725f 746f 5f61 7263 6869 7665 2c20  der_to_archive, 
+00023d50: 7365 6c66 2e6d 6435 7375 6d5f 6669 6c65  self.md5sum_file
+00023d60: 6e61 6d65 293a 0a20 2020 2020 2020 2020  name):.         
+00023d70: 2020 2020 2020 2069 735f 6368 6563 6b73         is_checks
+00023d80: 756d 5f67 656e 6572 6174 6564 203d 2054  um_generated = T
+00023d90: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00023da0: 2020 2020 7072 696e 7428 2720 2020 2020      print('     
+00023db0: 2020 202e 2e2e 646f 6e65 2729 0a20 2020     ...done').   
+00023dc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00023dd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00023de0: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
+00023df0: 2020 2023 2047 6574 2074 6865 2070 6174     # Get the pat
+00023e00: 6820 746f 2074 6865 2068 6173 6866 696c  h to the hashfil
+00023e10: 650a 2020 2020 2020 2020 2020 2020 6861  e.            ha
+00023e20: 7368 6669 6c65 203d 206f 732e 7061 7468  shfile = os.path
+00023e30: 2e6a 6f69 6e28 666f 6c64 6572 5f74 6f5f  .join(folder_to_
+00023e40: 6172 6368 6976 652c 2073 656c 662e 6d64  archive, self.md
+00023e50: 3573 756d 5f66 696c 656e 616d 6529 0a0a  5sum_filename)..
+00023e60: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+00023e70: 6561 7465 2061 6e20 5263 6c6f 6e65 206f  eate an Rclone o
+00023e80: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
+00023e90: 2020 7263 6c6f 6e65 203d 2052 636c 6f6e    rclone = Rclon
+00023ea0: 6528 7365 6c66 2e61 7267 732c 2073 656c  e(self.args, sel
+00023eb0: 662e 6366 6729 0a0a 2020 2020 2020 2020  f.cfg)..        
+00023ec0: 2020 2020 2320 4172 6368 6976 6520 7468      # Archive th
+00023ed0: 6520 666f 6c64 6572 2074 6f20 5333 0a20  e folder to S3. 
+00023ee0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00023ef0: 2866 275c 6e20 2020 2055 706c 6f61 6469  (f'\n    Uploadi
+00023f00: 6e67 2066 696c 6573 2e2e 2e27 290a 2020  ng files...').  
+00023f10: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+00023f20: 7263 6c6f 6e65 2e63 6f70 7928 666f 6c64  rclone.copy(fold
+00023f30: 6572 5f74 6f5f 6172 6368 6976 652c 2073  er_to_archive, s
+00023f40: 335f 6465 7374 2c20 272d 2d6d 6178 2d64  3_dest, '--max-d
+00023f50: 6570 7468 272c 2027 3127 2c20 272d 2d6c  epth', '1', '--l
+00023f60: 696e 6b73 272c 0a20 2020 2020 2020 2020  inks',.         
+00023f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f80: 2020 2020 2027 2d2d 6578 636c 7564 6527       '--exclude'
+00023f90: 2c20 7365 6c66 2e6d 6435 7375 6d5f 6669  , self.md5sum_fi
+00023fa0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fc0: 2020 2020 2020 272d 2d65 7863 6c75 6465        '--exclude
+00023fd0: 272c 2073 656c 662e 6d64 3573 756d 5f72  ', self.md5sum_r
+00023fe0: 6573 746f 7265 645f 6669 6c65 6e61 6d65  estored_filename
+00023ff0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024010: 272d 2d65 7863 6c75 6465 272c 2073 656c  '--exclude', sel
+00024020: 662e 616c 6c66 696c 6573 5f63 7376 5f66  f.allfiles_csv_f
+00024030: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024050: 2020 2020 2020 2027 2d2d 6578 636c 7564         '--exclud
+00024060: 6527 2c20 7365 6c66 2e77 6865 7265 5f64  e', self.where_d
+00024070: 6964 5f74 6865 5f66 696c 6573 5f67 6f5f  id_the_files_go_
+00024080: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
+00024090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240a0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000240b0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+000240c0: 2074 6865 2066 6f6c 6465 7220 7761 7320   the folder was 
+000240d0: 6172 6368 6976 6564 2073 7563 6365 7373  archived success
+000240e0: 6675 6c6c 790a 2020 2020 2020 2020 2020  fully.          
+000240f0: 2020 6966 2072 6574 3a0a 2020 2020 2020    if ret:.      
+00024100: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00024110: 2720 2020 2020 2020 202e 2e2e 646f 6e65  '        ...done
+00024120: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00024130: 2020 2069 735f 666f 6c64 6572 5f61 7263     is_folder_arc
+00024140: 6869 7665 6420 3d20 5472 7565 0a20 2020  hived = True.   
+00024150: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00024160: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00024170: 7269 6e74 2827 2020 2020 2020 2020 2e2e  rint('        ..
+00024180: 2e46 4149 4c45 445c 6e27 290a 2020 2020  .FAILED\n').    
+00024190: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000241a0: 726e 0a0a 2020 2020 2020 2020 2020 2020  rn..            
+000241b0: 2320 4765 7420 7468 6520 7061 7468 2074  # Get the path t
+000241c0: 6f20 7468 6520 616c 6c66 696c 6573 2043  o the allfiles C
+000241d0: 5356 2066 696c 650a 2020 2020 2020 2020  SV file.        
+000241e0: 2020 2020 616c 6c66 696c 6573 5f73 6f75      allfiles_sou
+000241f0: 7263 6520 3d20 6f73 2e70 6174 682e 6a6f  rce = os.path.jo
+00024200: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+00024210: 2020 2020 666f 6c64 6572 5f74 6f5f 6172      folder_to_ar
+00024220: 6368 6976 652c 2073 656c 662e 616c 6c66  chive, self.allf
+00024230: 696c 6573 5f63 7376 5f66 696c 656e 616d  iles_csv_filenam
+00024240: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00024250: 7072 696e 7428 6627 5c6e 2020 2020 5570  print(f'\n    Up
+00024260: 6c6f 6164 696e 6720 4672 6f73 7465 722e  loading Froster.
+00024270: 616c 6c66 696c 6573 2e63 7376 2066 696c  allfiles.csv fil
+00024280: 652e 2e2e 2729 0a0a 2020 2020 2020 2020  e...')..        
+00024290: 2020 2020 2320 4368 616e 6765 2074 6865      # Change the
+000242a0: 2073 746f 7261 6765 2063 6c61 7373 2074   storage class t
+000242b0: 6f20 494e 5445 4c4c 4947 454e 545f 5449  o INTELLIGENT_TI
+000242c0: 4552 494e 470a 2020 2020 2020 2020 2020  ERING.          
+000242d0: 2020 7263 6c6f 6e65 2e65 6e76 726e 5b27    rclone.envrn['
+000242e0: 5243 4c4f 4e45 5f53 335f 5354 4f52 4147  RCLONE_S3_STORAG
+000242f0: 455f 434c 4153 5327 5d20 3d20 2749 4e54  E_CLASS'] = 'INT
+00024300: 454c 4c49 4745 4e54 5f54 4945 5249 4e47  ELLIGENT_TIERING
+00024310: 270a 0a20 2020 2020 2020 2020 2020 2023  '..            #
+00024320: 2041 7263 6869 7665 2074 6865 2061 6c6c   Archive the all
+00024330: 6669 6c65 7320 4353 5620 6669 6c65 2074  files CSV file t
+00024340: 6f20 5333 2049 4e54 454c 4c49 4745 4e54  o S3 INTELLIGENT
+00024350: 5f54 4945 5249 4e47 0a20 2020 2020 2020  _TIERING.       
+00024360: 2020 2020 2072 6574 203d 2072 636c 6f6e       ret = rclon
+00024370: 652e 636f 7079 2861 6c6c 6669 6c65 735f  e.copy(allfiles_
+00024380: 736f 7572 6365 2c20 7333 5f64 6573 742c  source, s3_dest,
+00024390: 2027 2d2d 6d61 782d 6465 7074 6827 2c20   '--max-depth', 
+000243a0: 2731 272c 2027 2d2d 6c69 6e6b 7327 2c0a  '1', '--links',.
+000243b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000243c0: 2020 2020 2020 2020 2020 2020 2020 272d                '-
+000243d0: 2d65 7863 6c75 6465 272c 2073 656c 662e  -exclude', self.
+000243e0: 6d64 3573 756d 5f66 696c 656e 616d 652c  md5sum_filename,
+000243f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024400: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00024410: 2d2d 6578 636c 7564 6527 2c20 7365 6c66  --exclude', self
+00024420: 2e6d 6435 7375 6d5f 7265 7374 6f72 6564  .md5sum_restored
+00024430: 5f66 696c 656e 616d 652c 0a20 2020 2020  _filename,.     
+00024440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024450: 2020 2020 2020 2020 2027 2d2d 6578 636c           '--excl
+00024460: 7564 6527 2c20 7365 6c66 2e61 6c6c 6669  ude', self.allfi
+00024470: 6c65 735f 6373 765f 6669 6c65 6e61 6d65  les_csv_filename
+00024480: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244a0: 272d 2d65 7863 6c75 6465 272c 2073 656c  '--exclude', sel
+000244b0: 662e 7768 6572 655f 6469 645f 7468 655f  f.where_did_the_
+000244c0: 6669 6c65 735f 676f 5f66 696c 656e 616d  files_go_filenam
+000244d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000244e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244f0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00024500: 2043 6861 6e67 6520 7468 6520 7374 6f72   Change the stor
+00024510: 6167 6520 636c 6173 7320 6261 636b 2074  age class back t
+00024520: 6f20 7468 6520 7573 6572 2070 7265 6665  o the user prefe
+00024530: 7265 6e63 650a 2020 2020 2020 2020 2020  rence.          
+00024540: 2020 7263 6c6f 6e65 2e65 6e76 726e 5b27    rclone.envrn['
+00024550: 5243 4c4f 4e45 5f53 335f 5354 4f52 4147  RCLONE_S3_STORAG
+00024560: 455f 434c 4153 5327 5d20 3d20 7365 6c66  E_CLASS'] = self
+00024570: 2e63 6667 2e73 746f 7261 6765 5f63 6c61  .cfg.storage_cla
+00024580: 7373 0a0a 2020 2020 2020 2020 2020 2020  ss..            
+00024590: 6966 2072 6574 3a0a 2020 2020 2020 2020  if ret:.        
+000245a0: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+000245b0: 2020 2020 2020 202e 2e2e 646f 6e65 2729         ...done')
+000245c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000245d0: 2069 735f 666f 6c64 6572 5f61 7263 6869   is_folder_archi
+000245e0: 7665 6420 3d20 5472 7565 0a20 2020 2020  ved = True.     
+000245f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00024600: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00024610: 6e74 2827 2020 2020 2020 2020 2e2e 2e46  nt('        ...F
+00024620: 4149 4c45 445c 6e27 290a 2020 2020 2020  AILED\n').      
+00024630: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00024640: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00024650: 696e 7428 6627 5c6e 2020 2020 5665 7269  int(f'\n    Veri
+00024660: 6679 696e 6720 6368 6563 6b73 756d 732e  fying checksums.
+00024670: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
+00024680: 2072 6574 203d 2072 636c 6f6e 652e 6368   ret = rclone.ch
+00024690: 6563 6b73 756d 2868 6173 6866 696c 652c  ecksum(hashfile,
+000246a0: 2073 335f 6465 7374 2c20 272d 2d6d 6178   s3_dest, '--max
+000246b0: 2d64 6570 7468 272c 2027 3127 290a 0a20  -depth', '1').. 
+000246c0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000246d0: 636b 2069 6620 7468 6520 6368 6563 6b73  ck if the checks
+000246e0: 756d 7320 6172 6520 636f 7272 6563 740a  ums are correct.
+000246f0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00024700: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
+00024710: 2020 2020 7072 696e 7428 2720 2020 2020      print('     
+00024720: 2020 202e 2e2e 646f 6e65 2729 0a20 2020     ...done').   
+00024730: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00024740: 6368 6563 6b73 756d 5f63 6f72 7265 6374  checksum_correct
+00024750: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00024760: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00024770: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00024780: 2720 2020 2020 2020 202e 2e2e 4641 494c  '        ...FAIL
+00024790: 4544 5c6e 2729 0a20 2020 2020 2020 2020  ED\n').         
+000247a0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+000247b0: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
+000247c0: 2074 6865 206d 6574 6164 6174 6120 746f   the metadata to
+000247d0: 2074 6865 2061 7263 6869 7665 204a 534f   the archive JSO
+000247e0: 4e20 6669 6c65 204f 4e4c 5920 6966 2074  N file ONLY if t
+000247f0: 6869 7320 6973 206e 6f74 2061 2073 7562  his is not a sub
+00024800: 666f 6c64 6572 0a20 2020 2020 2020 2020  folder.         
+00024810: 2020 2069 6620 6e6f 7420 6973 5f73 7562     if not is_sub
+00024820: 666f 6c64 6572 3a0a 2020 2020 2020 2020  folder:.        
+00024830: 2020 2020 2020 2020 2320 4765 7420 6375          # Get cu
+00024840: 7272 656e 7420 7469 6d65 7374 616d 700a  rrent timestamp.
+00024850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024860: 7469 6d65 7374 616d 7020 3d20 6461 7465  timestamp = date
+00024870: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+00024880: 7728 292e 6973 6f66 6f72 6d61 7428 290a  w().isoformat().
+00024890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000248a0: 2023 2047 6574 2074 6865 2061 7263 6869   # Get the archi
+000248b0: 7665 206d 6f64 650a 2020 2020 2020 2020  ve mode.        
+000248c0: 2020 2020 2020 2020 6966 2069 735f 7265          if is_re
+000248d0: 6375 7273 6976 653a 0a20 2020 2020 2020  cursive:.       
+000248e0: 2020 2020 2020 2020 2020 2020 2061 7263               arc
+000248f0: 6869 7665 5f6d 6f64 6520 3d20 2252 6563  hive_mode = "Rec
+00024900: 7572 7369 7665 220a 2020 2020 2020 2020  ursive".        
+00024910: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00024920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024930: 2020 6172 6368 6976 655f 6d6f 6465 203d    archive_mode =
+00024940: 2022 5369 6e67 6c65 220a 0a20 2020 2020   "Single"..     
+00024950: 2020 2020 2020 2020 2020 2023 2047 656e             # Gen
+00024960: 6572 6174 6520 7468 6520 6d65 7461 6461  erate the metada
+00024970: 7461 2064 6963 7469 6f6e 6172 790a 2020  ta dictionary.  
+00024980: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00024990: 775f 656e 7472 7920 3d20 7b27 6c6f 6361  w_entry = {'loca
+000249a0: 6c5f 666f 6c64 6572 273a 2066 6f6c 6465  l_folder': folde
+000249b0: 725f 746f 5f61 7263 6869 7665 2c0a 2020  r_to_archive,.  
+000249c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000249d0: 2020 2020 2020 2020 2020 2027 6172 6368             'arch
+000249e0: 6976 655f 666f 6c64 6572 273a 2073 335f  ive_folder': s3_
+000249f0: 6465 7374 2c0a 2020 2020 2020 2020 2020  dest,.          
+00024a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a10: 2020 2027 7333 5f73 746f 7261 6765 5f63     's3_storage_c
+00024a20: 6c61 7373 273a 2073 656c 662e 6366 672e  lass': self.cfg.
+00024a30: 7374 6f72 6167 655f 636c 6173 732c 0a20  storage_class,. 
+00024a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a50: 2020 2020 2020 2020 2020 2020 2770 726f              'pro
+00024a60: 6669 6c65 273a 2073 656c 662e 6366 672e  file': self.cfg.
+00024a70: 6177 735f 7072 6f66 696c 652c 0a20 2020  aws_profile,.   
+00024a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a90: 2020 2020 2020 2020 2020 2761 7263 6869            'archi
+00024aa0: 7665 5f6d 6f64 6527 3a20 6172 6368 6976  ve_mode': archiv
+00024ab0: 655f 6d6f 6465 2c0a 2020 2020 2020 2020  e_mode,.        
+00024ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ad0: 2020 2020 2027 7469 6d65 7374 616d 7027       'timestamp'
+00024ae0: 3a20 7469 6d65 7374 616d 702c 0a20 2020  : timestamp,.   
+00024af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b00: 2020 2020 2020 2020 2020 2774 696d 6573            'times
+00024b10: 7461 6d70 5f61 7263 6869 7665 273a 2074  tamp_archive': t
+00024b20: 696d 6573 7461 6d70 2c0a 2020 2020 2020  imestamp,.      
+00024b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b40: 2020 2020 2020 2027 7573 6572 273a 2067         'user': g
+00024b50: 6574 7061 7373 2e67 6574 7573 6572 2829  etpass.getuser()
+00024b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024b70: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00024b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024b90: 2023 2041 6464 204e 4948 2069 6e66 6f72   # Add NIH infor
+00024ba0: 6d61 7469 6f6e 2074 6f20 7468 6520 6d65  mation to the me
+00024bb0: 7461 6461 7461 2064 6963 7469 6f6e 6172  tadata dictionar
+00024bc0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+00024bd0: 2020 6966 2073 656c 662e 6172 6773 2e6e    if self.args.n
+00024be0: 6968 7265 663a 0a20 2020 2020 2020 2020  ihref:.         
+00024bf0: 2020 2020 2020 2020 2020 206e 6577 5f65             new_e
+00024c00: 6e74 7279 5b27 6e69 685f 7072 6f6a 6563  ntry['nih_projec
+00024c10: 7427 5d20 3d20 7365 6c66 2e61 7267 732e  t'] = self.args.
+00024c20: 6e69 6872 6566 0a0a 2020 2020 2020 2020  nihref..        
+00024c30: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00024c40: 7468 6520 6d65 7461 6461 7461 2074 6f20  the metadata to 
+00024c50: 7468 6520 6172 6368 6976 6520 4a53 4f4e  the archive JSON
+00024c60: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00024c70: 2020 2020 2020 7365 6c66 2e5f 6172 6368        self._arch
+00024c80: 6976 655f 6a73 6f6e 5f61 6464 5f65 6e74  ive_json_add_ent
+00024c90: 7279 286b 6579 3d66 6f6c 6465 725f 746f  ry(key=folder_to
+00024ca0: 5f61 7263 6869 7665 2e72 7374 7269 7028  _archive.rstrip(
+00024cb0: 6f73 2e70 6174 682e 7365 7029 2c0a 2020  os.path.sep),.  
+00024cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ce0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00024cf0: 3d6e 6577 5f65 6e74 7279 290a 0a20 2020  =new_entry)..   
+00024d00: 2020 2020 2020 2020 2023 2050 7269 6e74           # Print
+00024d10: 2074 6865 2066 696e 616c 206d 6573 7361   the final messa
+00024d20: 6765 0a20 2020 2020 2020 2020 2020 2070  ge.            p
+00024d30: 7269 6e74 2866 275c 6e41 5243 4849 5649  rint(f'\nARCHIVI
+00024d40: 4e47 2053 5543 4345 5353 4655 4c4c 5920  NG SUCCESSFULLY 
+00024d50: 434f 4d50 4c45 5445 445c 6e27 290a 2020  COMPLETED\n').  
+00024d60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00024d70: 6627 2020 2020 4c4f 4341 4c20 534f 5552  f'    LOCAL SOUR
+00024d80: 4345 3a20 2020 2020 2020 227b 666f 6c64  CE:       "{fold
+00024d90: 6572 5f74 6f5f 6172 6368 6976 657d 2227  er_to_archive}"'
+00024da0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00024db0: 696e 7428 6627 2020 2020 4157 5320 5333  int(f'    AWS S3
+00024dc0: 2044 4553 5449 4e41 5449 4f4e 3a20 227b   DESTINATION: "{
+00024dd0: 7333 5f64 6573 747d 225c 6e27 290a 2020  s3_dest}"\n').  
+00024de0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00024df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024e00: 2066 2720 2020 2041 6c6c 2066 696c 6573   f'    All files
+00024e10: 2077 6572 6520 636f 7272 6563 746c 7920   were correctly 
+00024e20: 7570 6c6f 6164 6564 2074 6f20 4157 5320  uploaded to AWS 
+00024e30: 5333 2062 7563 6b65 7420 616e 6420 646f  S3 bucket and do
+00024e40: 7562 6c65 2d63 6865 636b 6564 2077 6974  uble-checked wit
+00024e50: 6820 6d64 3573 756d 2063 6865 636b 7375  h md5sum checksu
+00024e60: 6d2e 5c6e 2729 0a0a 2020 2020 2020 2020  m.\n')..        
+00024e70: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00024e80: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00024e90: 696e 745f 6572 726f 7228 290a 0a20 2020  int_error()..   
+00024ea0: 2064 6566 2061 7263 6869 7665 2873 656c   def archive(sel
+00024eb0: 662c 2066 6f6c 6465 7273 293a 0a20 2020  f, folders):.   
+00024ec0: 2020 2020 2027 2727 4172 6368 6976 6520       '''Archive 
+00024ed0: 7468 6520 6769 7665 6e20 666f 6c64 6572  the given folder
+00024ee0: 7327 2727 0a20 2020 2020 2020 2074 7279  s'''.        try
+00024ef0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00024f00: 436c 6561 6e20 7468 6520 7072 6f76 6964  Clean the provid
+00024f10: 6564 2070 6174 6873 0a20 2020 2020 2020  ed paths.       
+00024f20: 2020 2020 2066 6f6c 6465 7273 203d 2063       folders = c
+00024f30: 6c65 616e 5f70 6174 685f 6c69 7374 2866  lean_path_list(f
+00024f40: 6f6c 6465 7273 290a 0a20 2020 2020 2020  olders)..       
+00024f50: 2020 2020 2023 2053 6574 2066 6c61 6773       # Set flags
+00024f60: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+00024f70: 7265 6375 7273 6976 6520 3d20 7365 6c66  recursive = self
+00024f80: 2e61 7267 732e 7265 6375 7273 6976 650a  .args.recursive.
+00024f90: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00024fa0: 6865 636b 2069 6620 4e49 4820 696e 666f  heck if NIH info
+00024fb0: 726d 6174 696f 6e20 6973 2072 6571 7569  rmation is requi
+00024fc0: 7265 6420 6279 2063 6f6e 6669 6775 7261  red by configura
+00024fd0: 7469 6f6e 2c20 6279 2063 6f6d 6d61 6e64  tion, by command
+00024fe0: 206c 696e 6520 6172 6775 6d65 6e74 206f   line argument o
+00024ff0: 7220 6966 2074 6865 7265 2069 7320 6120  r if there is a 
+00025000: 4e49 4820 7265 6665 7265 6e63 650a 2020  NIH reference.  
+00025010: 2020 2020 2020 2020 2020 6973 5f6e 6968            is_nih
+00025020: 203d 2073 656c 662e 6366 672e 6973 5f6e   = self.cfg.is_n
+00025030: 6968 206f 7220 7365 6c66 2e61 7267 732e  ih or self.args.
+00025040: 6e69 6820 616e 6420 6e6f 7420 7365 6c66  nih and not self
+00025050: 2e61 7267 732e 6e69 6872 6566 0a0a 2020  .args.nihref..  
+00025060: 2020 2020 2020 2020 2020 6973 5f74 6172            is_tar
+00025070: 203d 206e 6f74 2073 656c 662e 6172 6773   = not self.args
+00025080: 2e6e 6f74 6172 0a20 2020 2020 2020 2020  .notar.         
+00025090: 2020 2069 735f 666f 7263 6520 3d20 7365     is_force = se
+000250a0: 6c66 2e61 7267 732e 666f 7263 650a 0a20  lf.args.force.. 
+000250b0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000250c0: 636b 2069 6620 7468 6572 6520 6973 2061  ck if there is a
+000250d0: 2063 6f6e 666c 6963 7420 6265 7477 6565   conflict betwee
+000250e0: 6e20 666f 6c64 6572 7320 616e 6420 7265  n folders and re
+000250f0: 6375 7273 6976 6520 666c 6167 2c0a 2020  cursive flag,.  
+00025100: 2020 2020 2020 2020 2020 2320 692e 652e            # i.e.
+00025110: 2072 6563 7572 7369 7665 2066 6c61 6720   recursive flag 
+00025120: 6973 2073 6574 2061 6e64 2061 2066 6f6c  is set and a fol
+00025130: 6465 7220 6973 2061 2073 7562 6469 7265  der is a subdire
+00025140: 6374 6f72 7920 6f66 2061 6e6f 7468 6572  ctory of another
+00025150: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
+00025160: 2069 6620 6973 5f72 6563 7572 7369 7665   if is_recursive
+00025170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025180: 2020 6966 2073 656c 662e 5f69 735f 7265    if self._is_re
+00025190: 6375 7273 6976 655f 636f 6c6c 6973 696f  cursive_collisio
+000251a0: 6e28 666f 6c64 6572 7329 3a0a 2020 2020  n(folders):.    
+000251b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251c0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+000251d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000251e0: 275c 6e45 7272 6f72 3a20 596f 7520 6361  '\nError: You ca
+000251f0: 6e6e 6f74 2061 7263 6869 7665 2066 6f6c  nnot archive fol
+00025200: 6465 7273 2072 6563 7572 7369 7665 6c79  ders recursively
+00025210: 2069 6620 7468 6572 6520 6973 2061 2064   if there is a d
+00025220: 6570 656e 6465 6e63 7920 6265 7477 6565  ependency betwee
+00025230: 6e20 7468 656d 2e5c 6e27 290a 2020 2020  n them.\n').    
+00025240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025250: 7379 732e 6578 6974 2831 290a 0a20 2020  sys.exit(1)..   
+00025260: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00025270: 2069 6620 7765 2063 616e 2072 6561 6420   if we can read 
+00025280: 2620 7772 6974 6520 616c 6c20 6669 6c65  & write all file
+00025290: 7320 616e 6420 666f 6c64 6572 730a 2020  s and folders.  
+000252a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000252b0: 2073 656c 662e 5f69 735f 636f 7272 6563   self._is_correc
+000252c0: 745f 6669 6c65 735f 666f 6c64 6572 735f  t_files_folders_
+000252d0: 7065 726d 6973 7369 6f6e 7328 666f 6c64  permissions(fold
+000252e0: 6572 732c 2069 735f 7265 6375 7273 6976  ers, is_recursiv
+000252f0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00025300: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00025310: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00025320: 5c6e 4572 726f 723a 2043 616e 6e6f 7420  \nError: Cannot 
+00025330: 7265 6164 206f 7220 7772 6974 6520 746f  read or write to
+00025340: 2061 6c6c 2066 696c 6573 2061 6e64 2066   all files and f
+00025350: 6f6c 6465 7273 2e5c 6e27 2c20 6669 6c65  olders.\n', file
+00025360: 3d73 7973 2e73 7464 6572 7229 0a20 2020  =sys.stderr).   
+00025370: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00025380: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00025390: 2020 2020 2020 2020 6627 596f 7520 6361          f'You ca
+000253a0: 6e20 6368 6563 6b20 7468 6520 7065 726d  n check the perm
+000253b0: 6973 7369 6f6e 7320 6f66 2074 6865 2066  issions of the f
+000253c0: 696c 6573 2061 6e64 2066 6f6c 6465 7273  iles and folders
+000253d0: 2075 7369 6e67 2074 6865 2063 6f6d 6d61   using the comma
+000253e0: 6e64 3a27 2c20 6669 6c65 3d73 7973 2e73  nd:', file=sys.s
+000253f0: 7464 6572 7229 0a20 2020 2020 2020 2020  tderr).         
+00025400: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00025410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025420: 2020 6627 2020 2020 6672 6f73 7465 7220    f'    froster 
+00025430: 6172 6368 6976 6520 2d2d 7065 726d 6973  archive --permis
+00025440: 7369 6f6e 7320 222f 796f 7572 2f66 6f6c  sions "/your/fol
+00025450: 6465 722f 746f 2f61 7263 6869 7665 225c  der/to/archive"\
+00025460: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
+00025470: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+00025480: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00025490: 0a0a 2020 2020 2020 2020 2020 2020 6e69  ..            ni
+000254a0: 6820 3d20 2727 0a0a 2020 2020 2020 2020  h = ''..        
+000254b0: 2020 2020 6966 2069 735f 6e69 683a 0a20      if is_nih:. 
+000254c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000254d0: 7070 203d 2054 6162 6c65 4e49 4847 7261  pp = TableNIHGra
+000254e0: 6e74 7328 290a 2020 2020 2020 2020 2020  nts().          
+000254f0: 2020 2020 2020 6e69 6820 3d20 6170 702e        nih = app.
+00025500: 7275 6e28 290a 0a20 2020 2020 2020 2020  run()..         
+00025510: 2020 2020 2020 2069 6620 6e69 683a 0a20         if nih:. 
+00025520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025530: 2020 2023 2041 6464 2074 6865 206e 6968     # Add the nih
+00025540: 7265 6620 746f 2061 7267 756d 656e 7473  ref to arguments
+00025550: 2066 6f72 2073 6c75 726d 2073 6372 6970   for slurm scrip
+00025560: 7420 6578 6563 7574 696f 6e0a 2020 2020  t execution.    
+00025570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025580: 7379 732e 6172 6776 2e61 7070 656e 6428  sys.argv.append(
+00025590: 272d 2d6e 6968 2d72 6566 2729 0a20 2020  '--nih-ref').   
+000255a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255b0: 2073 7973 2e61 7267 762e 6170 7065 6e64   sys.argv.append
+000255c0: 286e 6968 5b30 5d29 0a20 2020 2020 2020  (nih[0]).       
+000255d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000255e0: 662e 6172 6773 2e6e 6968 7265 6620 3d20  f.args.nihref = 
+000255f0: 6e69 685b 305d 0a0a 2020 2020 2020 2020  nih[0]..        
+00025600: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00025610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025620: 2020 2320 4e6f 7468 696e 6720 7365 6c65    # Nothing sele
+00025630: 6374 6564 2e20 4578 6974 0a20 2020 2020  cted. Exit.     
+00025640: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00025650: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
+00025660: 2020 2069 6620 7573 655f 736c 7572 6d28     if use_slurm(
+00025670: 7365 6c66 2e61 7267 732e 6e6f 736c 7572  self.args.noslur
+00025680: 6d29 3a0a 0a20 2020 2020 2020 2020 2020  m):..           
+00025690: 2020 2020 2069 6620 272d 2d68 6f74 7370       if '--hotsp
+000256a0: 6f74 7327 2069 6e20 7379 732e 6172 6776  ots' in sys.argv
+000256b0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+000256c0: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+000256d0: 7468 6520 686f 7473 706f 7473 2066 6c61  the hotspots fla
+000256e0: 6720 6672 6f6d 2074 6865 2061 7267 756d  g from the argum
+000256f0: 656e 7473 2061 7320 7468 6973 2077 696c  ents as this wil
+00025700: 6c20 6265 2061 206e 6f6e 2d69 6e74 6572  l be a non-inter
+00025710: 6163 7469 7665 2073 6c75 726d 2065 7865  active slurm exe
+00025720: 6375 7469 6f6e 0a20 2020 2020 2020 2020  cution.         
+00025730: 2020 2020 2020 2020 2020 2073 7973 2e61             sys.a
+00025740: 7267 762e 7265 6d6f 7665 2827 2d2d 686f  rgv.remove('--ho
+00025750: 7473 706f 7473 2729 0a0a 2020 2020 2020  tspots')..      
+00025760: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00025770: 4170 7065 6e64 2074 6865 2073 656c 6563  Append the selec
+00025780: 7465 6420 666f 6c64 6572 7320 746f 2074  ted folders to t
+00025790: 6865 2061 7267 756d 656e 7473 2e20 4167  he arguments. Ag
+000257a0: 6169 6e3a 206e 6f6e 2d69 6e74 6572 6163  ain: non-interac
+000257b0: 7469 7665 2073 6c75 726d 2065 7865 6375  tive slurm execu
+000257c0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+000257d0: 2020 2020 2020 2020 2066 6f72 2066 6f6c           for fol
+000257e0: 6465 7220 696e 2066 6f6c 6465 7273 3a0a  der in folders:.
+000257f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025800: 2020 2020 2020 2020 7379 732e 6172 6776          sys.argv
+00025810: 2e61 7070 656e 6428 666f 6c64 6572 290a  .append(folder).
+00025820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025830: 2023 2045 7865 6375 7465 2073 6c75 726d   # Execute slurm
+00025840: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+00025850: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00025860: 6c75 726d 5f63 6d64 2866 6f6c 6465 7273  lurm_cmd(folders
+00025870: 3d66 6f6c 6465 7273 2c20 636d 645f 7479  =folders, cmd_ty
+00025880: 7065 3d27 6172 6368 6976 6527 290a 0a20  pe='archive').. 
+00025890: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000258a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000258b0: 2066 6f72 2066 6f6c 6465 7220 696e 2066   for folder in f
+000258c0: 6f6c 6465 7273 3a0a 2020 2020 2020 2020  olders:.        
+000258d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000258e0: 735f 7265 6375 7273 6976 653a 0a20 2020  s_recursive:.   
+000258f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025900: 2020 2020 2066 6f72 2072 6f6f 742c 2064       for root, d
+00025910: 6972 732c 2066 696c 6573 2069 6e20 7365  irs, files in se
+00025920: 6c66 2e5f 7761 6c6b 6572 2866 6f6c 6465  lf._walker(folde
+00025930: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00025940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025950: 6966 2066 6f6c 6465 7220 3d3d 2072 6f6f  if folder == roo
+00025960: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00025970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025980: 2020 2069 735f 7375 6266 6f6c 6465 7220     is_subfolder 
+00025990: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000259a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000259c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259d0: 2020 2020 2020 2020 2020 6973 5f73 7562            is_sub
+000259e0: 666f 6c64 6572 203d 2054 7275 650a 2020  folder = True.  
+000259f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a00: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00025a10: 6172 6368 6976 655f 6c6f 6361 6c6c 7928  archive_locally(
+00025a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a40: 2072 6f6f 742c 2069 735f 7265 6375 7273   root, is_recurs
+00025a50: 6976 652c 2069 735f 7375 6266 6f6c 6465  ive, is_subfolde
+00025a60: 722c 2069 735f 7461 722c 2069 735f 666f  r, is_tar, is_fo
+00025a70: 7263 6529 0a0a 2020 2020 2020 2020 2020  rce)..          
+00025a80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00025a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025aa0: 2020 2020 2020 2020 6973 5f73 7562 666f          is_subfo
+00025ab0: 6c64 6572 203d 2046 616c 7365 0a20 2020  lder = False.   
+00025ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ad0: 2020 2020 2073 656c 662e 5f61 7263 6869       self._archi
+00025ae0: 7665 5f6c 6f63 616c 6c79 280a 2020 2020  ve_locally(.    
+00025af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b00: 2020 2020 2020 2020 666f 6c64 6572 2c20          folder, 
+00025b10: 6973 5f72 6563 7572 7369 7665 2c20 6973  is_recursive, is
+00025b20: 5f73 7562 666f 6c64 6572 2c20 6973 5f74  _subfolder, is_t
+00025b30: 6172 2c20 6973 5f66 6f72 6365 290a 2020  ar, is_force).  
+00025b40: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00025b50: 2020 2020 2020 2020 2020 7072 696e 745f            print_
+00025b60: 6572 726f 7228 290a 0a20 2020 2064 6566  error()..    def
+00025b70: 2067 6574 5f6d 6f75 6e74 7328 7365 6c66   get_mounts(self
+00025b80: 293a 0a20 2020 2020 2020 2074 7279 3a0a  ):.        try:.
+00025b90: 2020 2020 2020 2020 2020 2020 7263 6c6f              rclo
+00025ba0: 6e65 203d 2052 636c 6f6e 6528 7365 6c66  ne = Rclone(self
+00025bb0: 2e61 7267 732c 2073 656c 662e 6366 6729  .args, self.cfg)
+00025bc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00025bd0: 7572 6e20 7263 6c6f 6e65 2e67 6574 5f6d  urn rclone.get_m
+00025be0: 6f75 6e74 7328 290a 2020 2020 2020 2020  ounts().        
+00025bf0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00025c00: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00025c10: 696e 745f 6572 726f 7228 290a 2020 2020  int_error().    
+00025c20: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00025c30: 2831 290a 0a20 2020 2064 6566 205f 6973  (1)..    def _is
+00025c40: 5f6d 6f75 6e74 6564 2873 656c 662c 2066  _mounted(self, f
+00025c50: 6f6c 6465 7229 3a0a 2020 2020 2020 2020  older):.        
+00025c60: 2727 2743 6865 636b 2069 6620 7468 6520  '''Check if the 
+00025c70: 6769 7665 6e20 666f 6c64 6572 2069 7320  given folder is 
+00025c80: 616c 7265 6164 7920 6d6f 756e 7465 6427  already mounted'
+00025c90: 2727 0a0a 2020 2020 2020 2020 6d6f 756e  ''..        moun
+00025ca0: 7473 203d 2073 656c 662e 6765 745f 6d6f  ts = self.get_mo
+00025cb0: 756e 7473 2829 0a0a 2020 2020 2020 2020  unts()..        
+00025cc0: 6966 2066 6f6c 6465 7220 696e 206d 6f75  if folder in mou
+00025cd0: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00025ce0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00025cf0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00025d00: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00025d10: 6c73 650a 0a20 2020 2064 6566 2070 7269  lse..    def pri
+00025d20: 6e74 5f63 7572 7265 6e74 5f6d 6f75 6e74  nt_current_mount
+00025d30: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00025d40: 2027 2727 5072 696e 7420 7468 6520 6375   '''Print the cu
+00025d50: 7272 656e 7420 6d6f 756e 7465 6420 666f  rrent mounted fo
+00025d60: 6c64 6572 7327 2727 0a0a 2020 2020 2020  lders'''..      
+00025d70: 2020 6d6f 756e 7473 203d 2073 656c 662e    mounts = self.
+00025d80: 6765 745f 6d6f 756e 7473 2829 0a0a 2020  get_mounts()..  
+00025d90: 2020 2020 2020 6966 206d 6f75 6e74 733a        if mounts:
+00025da0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00025db0: 6e74 2827 5c6e 4355 5252 454e 5420 4d4f  nt('\nCURRENT MO
+00025dc0: 554e 5445 4420 464f 4c44 4552 533a 5c6e  UNTED FOLDERS:\n
+00025dd0: 2729 0a20 2020 2020 2020 2020 2020 2066  ').            f
+00025de0: 6f72 206d 6f75 6e74 2069 6e20 6d6f 756e  or mount in moun
+00025df0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00025e00: 2020 2020 7072 696e 7428 6627 2020 2020      print(f'    
+00025e10: 7b6d 6f75 6e74 7d27 290a 0a20 2020 2020  {mount}')..     
+00025e20: 2020 2020 2020 2023 2044 6563 6f72 6174         # Decorat
+00025e30: 6f72 2070 7269 6e74 0a20 2020 2020 2020  or print.       
+00025e40: 2020 2020 2070 7269 6e74 2829 0a20 2020       print().   
+00025e50: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00025e60: 2020 2020 2020 2070 7269 6e74 2827 5c6e         print('\n
+00025e70: 4e4f 2046 4f4c 4445 5253 204d 4f55 4e54  NO FOLDERS MOUNT
+00025e80: 4544 5c6e 2729 0a0a 2020 2020 6465 6620  ED\n')..    def 
+00025e90: 5f6d 6f75 6e74 5f6c 6f63 616c 6c79 2873  _mount_locally(s
+00025ea0: 656c 662c 2066 6f6c 6465 7273 2c20 6d6f  elf, folders, mo
+00025eb0: 756e 7470 6f69 6e74 293a 0a0a 2020 2020  untpoint):..    
+00025ec0: 2020 2020 666f 7220 666f 6c64 6572 2069      for folder i
+00025ed0: 6e20 666f 6c64 6572 733a 0a0a 2020 2020  n folders:..    
+00025ee0: 2020 2020 2020 2020 6172 6368 6976 655f          archive_
+00025ef0: 666f 6c64 6572 5f69 6e66 6f20 3d20 7365  folder_info = se
+00025f00: 6c66 2e66 726f 7374 6572 5f61 7263 6869  lf.froster_archi
+00025f10: 7665 735f 6765 745f 656e 7472 7928 666f  ves_get_entry(fo
+00025f20: 6c64 6572 290a 0a20 2020 2020 2020 2020  lder)..         
+00025f30: 2020 2069 6620 6172 6368 6976 655f 666f     if archive_fo
+00025f40: 6c64 6572 5f69 6e66 6f20 6973 204e 6f6e  lder_info is Non
+00025f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00025f60: 2020 2070 7269 6e74 2866 275c 6e57 4152     print(f'\nWAR
+00025f70: 4e49 4e47 3a20 666f 6c64 6572 2022 7b66  NING: folder "{f
+00025f80: 6f6c 6465 727d 2220 6e6f 7420 696e 2061  older}" not in a
+00025f90: 7263 6869 7665 2e5c 6e27 290a 2020 2020  rchive.\n').    
+00025fa0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00025fb0: 7428 6627 4e6f 7468 696e 6720 7769 6c6c  t(f'Nothing will
+00025fc0: 2062 6520 7265 7374 6f72 6564 2e5c 6e27   be restored.\n'
+00025fd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00025fe0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+00025ff0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00026000: 732e 7061 7468 2e65 7869 7374 7328 666f  s.path.exists(fo
+00026010: 6c64 6572 2920 616e 6420 6e6f 7420 6d6f  lder) and not mo
+00026020: 756e 7470 6f69 6e74 3a0a 2020 2020 2020  untpoint:.      
+00026030: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00026040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026050: 2020 2020 2066 275c 6e57 4152 4e49 4e47       f'\nWARNING
+00026060: 3a20 666f 6c64 6572 2022 7b66 6f6c 6465  : folder "{folde
+00026070: 727d 2220 646f 6573 206e 6f74 2065 7869  r}" does not exi
+00026080: 7374 2061 6e64 206e 6f20 6d6f 756e 7470  st and no mountp
+00026090: 6f69 6e74 2070 726f 7669 6465 642e 5c6e  oint provided.\n
+000260a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000260b0: 2020 2070 7269 6e74 2866 274e 6f74 6869     print(f'Nothi
+000260c0: 6e67 2077 696c 6c20 6265 2072 6573 746f  ng will be resto
+000260d0: 7265 642e 5c6e 2729 0a20 2020 2020 2020  red.\n').       
+000260e0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000260f0: 650a 0a20 2020 2020 2020 2020 2020 2073  e..            s
+00026100: 335f 666f 6c64 6572 203d 2061 7263 6869  3_folder = archi
+00026110: 7665 5f66 6f6c 6465 725f 696e 666f 5b27  ve_folder_info['
+00026120: 6172 6368 6976 655f 666f 6c64 6572 275d  archive_folder']
+00026130: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
+00026140: 616c 5f66 6f6c 6465 7220 3d20 6172 6368  al_folder = arch
+00026150: 6976 655f 666f 6c64 6572 5f69 6e66 6f5b  ive_folder_info[
+00026160: 276c 6f63 616c 5f66 6f6c 6465 7227 5d0a  'local_folder'].
+00026170: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00026180: 666f 6c64 6572 203d 3d20 6c6f 6361 6c5f  folder == local_
+00026190: 666f 6c64 6572 3a0a 2020 2020 2020 2020  folder:.        
+000261a0: 2020 2020 2020 2020 6966 206d 6f75 6e74          if mount
+000261b0: 706f 696e 743a 0a20 2020 2020 2020 2020  point:.         
+000261c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000261d0: 2866 275c 6e4d 4f55 4e54 494e 4720 227b  (f'\nMOUNTING "{
+000261e0: 6c6f 6361 6c5f 666f 6c64 6572 7d22 2061  local_folder}" a
+000261f0: 7420 227b 6d6f 756e 7470 6f69 6e74 7d22  t "{mountpoint}"
+00026200: 2e2e 2e27 290a 2020 2020 2020 2020 2020  ...').          
+00026210: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00026220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026230: 7072 696e 7428 6627 5c6e 4d4f 554e 5449  print(f'\nMOUNTI
+00026240: 4e47 2022 7b6c 6f63 616c 5f66 6f6c 6465  NG "{local_folde
+00026250: 727d 222e 2e2e 2729 0a20 2020 2020 2020  r}"...').       
+00026260: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00026270: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
+00026280: 756e 7470 6f69 6e74 3a0a 2020 2020 2020  untpoint:.      
+00026290: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000262a0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000262b0: 2020 2020 2020 2020 2020 2020 2066 275c               f'\
+000262c0: 6e4d 4f55 4e54 494e 4720 7061 7265 6e74  nMOUNTING parent
+000262d0: 2066 6f6c 6465 7220 227b 6c6f 6361 6c5f   folder "{local_
+000262e0: 666f 6c64 6572 7d22 2061 7420 227b 6d6f  folder}" at "{mo
+000262f0: 756e 7470 6f69 6e74 7d22 2e2e 2e27 290a  untpoint}"...').
+00026300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026310: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00026320: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00026330: 6627 5c6e 4d4f 554e 5449 4e47 2070 6172  f'\nMOUNTING par
+00026340: 656e 7420 666f 6c64 6572 2022 7b6c 6f63  ent folder "{loc
+00026350: 616c 5f66 6f6c 6465 727d 222e 2e2e 2729  al_folder}"...')
+00026360: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00026370: 206e 6f74 206d 6f75 6e74 706f 696e 743a   not mountpoint:
+00026380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026390: 206d 6f75 6e74 706f 696e 7420 3d20 6c6f   mountpoint = lo
+000263a0: 6361 6c5f 666f 6c64 6572 0a0a 2020 2020  cal_folder..    
+000263b0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+000263c0: 6966 2074 6865 2066 6f6c 6465 7220 6973  if the folder is
+000263d0: 2061 6c72 6561 6479 206d 6f75 6e74 6564   already mounted
+000263e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000263f0: 7365 6c66 2e5f 6973 5f6d 6f75 6e74 6564  self._is_mounted
+00026400: 286d 6f75 6e74 706f 696e 7429 3a0a 2020  (mountpoint):.  
+00026410: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00026420: 696e 7428 6627 2020 2020 2e2e 2e22 7b6d  int(f'    ..."{m
+00026430: 6f75 6e74 706f 696e 747d 2220 616c 7265  ountpoint}" alre
+00026440: 6164 7920 6d6f 756e 7465 645c 6e27 290a  ady mounted\n').
+00026450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026460: 7379 732e 6578 6974 2831 290a 0a20 2020  sys.exit(1)..   
+00026470: 2020 2020 2020 2020 2023 204d 6f75 6e74           # Mount
+00026480: 2074 6865 2066 6f6c 6465 720a 2020 2020   the folder.    
+00026490: 2020 2020 2020 2020 7263 6c6f 6e65 203d          rclone =
+000264a0: 2052 636c 6f6e 6528 7365 6c66 2e61 7267   Rclone(self.arg
+000264b0: 732c 2073 656c 662e 6366 6729 0a20 2020  s, self.cfg).   
+000264c0: 2020 2020 2020 2020 2072 6574 203d 2072           ret = r
+000264d0: 636c 6f6e 652e 6d6f 756e 7428 7333 5f66  clone.mount(s3_f
+000264e0: 6f6c 6465 722c 206d 6f75 6e74 706f 696e  older, mountpoin
+000264f0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
+00026500: 2320 4368 6563 6b20 6966 2074 6865 2066  # Check if the f
+00026510: 6f6c 6465 7220 7761 7320 6d6f 756e 7465  older was mounte
+00026520: 6420 7375 6363 6573 7366 756c 6c79 0a20  d successfully. 
+00026530: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+00026540: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00026550: 2020 2070 7269 6e74 2827 2020 2020 2e2e     print('    ..
+00026560: 2e4d 4f55 4e54 4544 5c6e 2729 0a20 2020  .MOUNTED\n').   
+00026570: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00026580: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00026590: 7269 6e74 2827 2020 2020 2e2e 2e46 4149  rint('    ...FAI
+000265a0: 4c45 445c 6e27 290a 2020 2020 2020 2020  LED\n').        
+000265b0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+000265c0: 2020 2020 6465 6620 6d6f 756e 7428 7365      def mount(se
+000265d0: 6c66 2c20 666f 6c64 6572 732c 206d 6f75  lf, folders, mou
+000265e0: 6e74 706f 696e 7429 3a0a 2020 2020 2020  ntpoint):.      
+000265f0: 2020 2727 274d 6f75 6e74 2074 6865 2067    '''Mount the g
+00026600: 6976 656e 2066 6f6c 6465 7227 2727 0a0a  iven folder'''..
+00026610: 2020 2020 2020 2020 2320 436c 6561 6e20          # Clean 
+00026620: 7468 6520 7072 6f76 6964 6564 2070 6174  the provided pat
+00026630: 6873 0a20 2020 2020 2020 2066 6f6c 6465  hs.        folde
+00026640: 7273 203d 2063 6c65 616e 5f70 6174 685f  rs = clean_path_
+00026650: 6c69 7374 2866 6f6c 6465 7273 290a 2020  list(folders).  
+00026660: 2020 2020 2020 6d6f 756e 7470 6f69 6e74        mountpoint
+00026670: 203d 2063 6c65 616e 5f70 6174 6828 6d6f   = clean_path(mo
+00026680: 756e 7470 6f69 6e74 290a 0a20 2020 2020  untpoint)..     
+00026690: 2020 2073 656c 662e 5f6d 6f75 6e74 5f6c     self._mount_l
+000266a0: 6f63 616c 6c79 2866 6f6c 6465 7273 2c20  ocally(folders, 
+000266b0: 6d6f 756e 7470 6f69 6e74 290a 0a20 2020  mountpoint)..   
+000266c0: 2064 6566 205f 756e 6d6f 756e 745f 6c6f   def _unmount_lo
+000266d0: 6361 6c6c 7928 7365 6c66 2c20 666f 6c64  cally(self, fold
+000266e0: 6572 7329 3a0a 0a20 2020 2020 2020 2023  ers):..        #
+000266f0: 2072 636c 6f6e 6520 696e 7374 616e 6365   rclone instance
+00026700: 0a20 2020 2020 2020 2072 636c 6f6e 6520  .        rclone 
+00026710: 3d20 5263 6c6f 6e65 2873 656c 662e 6172  = Rclone(self.ar
+00026720: 6773 2c20 7365 6c66 2e63 6667 290a 0a20  gs, self.cfg).. 
+00026730: 2020 2020 2020 2066 6f72 2066 6f6c 6465         for folde
+00026740: 7220 696e 2066 6f6c 6465 7273 3a0a 2020  r in folders:.  
+00026750: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00026760: 6627 5c6e 554e 4d4f 554e 5449 4e47 207b  f'\nUNMOUNTING {
+00026770: 666f 6c64 6572 7d2e 2e2e 2729 0a0a 2020  folder}...')..  
+00026780: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00026790: 662e 5f69 735f 6d6f 756e 7465 6428 666f  f._is_mounted(fo
+000267a0: 6c64 6572 293a 0a20 2020 2020 2020 2020  lder):.         
+000267b0: 2020 2020 2020 2072 6574 203d 2072 636c         ret = rcl
+000267c0: 6f6e 652e 756e 6d6f 756e 7428 666f 6c64  one.unmount(fold
+000267d0: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
+000267e0: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+000267f0: 7468 6520 666f 6c64 6572 2077 6173 2075  the folder was u
+00026800: 6e6d 6f75 6e74 6564 2073 7563 6365 7373  nmounted success
+00026810: 6675 6c6c 790a 2020 2020 2020 2020 2020  fully.          
+00026820: 2020 2020 2020 6966 2072 6574 3a0a 2020        if ret:.  
 00026830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026840: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00026850: 2020 2020 2020 2020 2020 2752 6573 6f75            'Resou
-00026860: 7263 6554 7970 6527 3a20 2769 6e73 7461  rceType': 'insta
-00026870: 6e63 6527 2c0a 2020 2020 2020 2020 2020  nce',.          
-00026880: 2020 2020 2020 2020 2020 2020 2020 2754                'T
-00026890: 6167 7327 3a20 5b7b 274b 6579 273a 2027  ags': [{'Key': '
-000268a0: 4e61 6d65 272c 2027 5661 6c75 6527 3a20  Name', 'Value': 
-000268b0: 2746 726f 7374 6572 5365 6c66 4465 7374  'FrosterSelfDest
-000268c0: 7275 6374 277d 5d0a 2020 2020 2020 2020  ruct'}].        
-000268d0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000268e0: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-000268f0: 2020 2020 2020 2020 2020 2020 295b 305d              )[0]
-00026900: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00026910: 626f 746f 636f 7265 2e65 7863 6570 7469  botocore.excepti
-00026920: 6f6e 732e 436c 6965 6e74 4572 726f 7220  ons.ClientError 
-00026930: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00026940: 2020 6572 726f 725f 636f 6465 203d 2065    error_code = e
-00026950: 2e72 6573 706f 6e73 655b 2745 7272 6f72  .response['Error
-00026960: 275d 5b27 436f 6465 275d 0a20 2020 2020  ']['Code'].     
-00026970: 2020 2020 2020 2069 6620 6572 726f 725f         if error_
-00026980: 636f 6465 203d 3d20 2741 6363 6573 7344  code == 'AccessD
-00026990: 656e 6965 6427 3a0a 2020 2020 2020 2020  enied':.        
-000269a0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-000269b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000269c0: 2020 2066 2741 6363 6573 7320 6465 6e69     f'Access deni
-000269d0: 6564 2120 506c 6561 7365 2063 6865 636b  ed! Please check
-000269e0: 2079 6f75 7220 4941 4d20 7065 726d 6973   your IAM permis
-000269f0: 7369 6f6e 732e 205c 6e20 2020 4572 726f  sions. \n   Erro
-00026a00: 723a 207b 657d 2729 0a20 2020 2020 2020  r: {e}').       
-00026a10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00026a20: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00026a30: 2866 2743 6c69 656e 7420 4572 726f 723a  (f'Client Error:
-00026a40: 207b 657d 2729 0a20 2020 2020 2020 2020   {e}').         
-00026a50: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00026a60: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00026a70: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-00026a80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00026a90: 274f 7468 6572 2045 7272 6f72 3a20 7b65  'Other Error: {e
-00026aa0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-00026ab0: 7379 732e 6578 6974 2831 290a 0a20 2020  sys.exit(1)..   
-00026ac0: 2020 2020 2023 2055 7365 2061 2077 6169       # Use a wai
-00026ad0: 7465 7220 746f 2065 6e73 7572 6520 7468  ter to ensure th
-00026ae0: 6520 696e 7374 616e 6365 2069 7320 7275  e instance is ru
-00026af0: 6e6e 696e 6720 6265 666f 7265 2074 7279  nning before try
-00026b00: 696e 6720 746f 2061 6363 6573 7320 6974  ing to access it
-00026b10: 7320 7072 6f70 6572 7469 6573 0a20 2020  s properties.   
-00026b20: 2020 2020 2069 6e73 7461 6e63 655f 6964       instance_id
-00026b30: 203d 2069 6e73 7461 6e63 652e 6964 0a0a   = instance.id..
-00026b40: 2020 2020 2020 2020 2320 7461 6720 7468          # tag th
-00026b50: 6520 696e 7374 616e 6365 2066 6f72 2063  e instance for c
-00026b60: 6f73 7420 6578 706c 6f72 6572 0a20 2020  ost explorer.   
-00026b70: 2020 2020 2074 6167 203d 207b 0a20 2020       tag = {.   
-00026b80: 2020 2020 2020 2020 2027 4b65 7927 3a20           'Key': 
-00026b90: 2749 4e53 5441 4e43 455f 4944 272c 0a20  'INSTANCE_ID',. 
-00026ba0: 2020 2020 2020 2020 2020 2027 5661 6c75             'Valu
-00026bb0: 6527 3a20 696e 7374 616e 6365 5f69 640a  e': instance_id.
-00026bc0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00026bd0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00026be0: 2020 2065 6332 5f72 6573 6f75 7263 652e     ec2_resource.
-00026bf0: 6372 6561 7465 5f74 6167 7328 5265 736f  create_tags(Reso
-00026c00: 7572 6365 733d 5b69 6e73 7461 6e63 655f  urces=[instance_
-00026c10: 6964 5d2c 2054 6167 733d 5b74 6167 5d29  id], Tags=[tag])
-00026c20: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00026c30: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-00026c40: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00026c50: 7464 6267 2827 4572 726f 7220 6372 6561  tdbg('Error crea
-00026c60: 7469 6e67 2054 6167 733a 207b 657d 2729  ting Tags: {e}')
-00026c70: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00026c80: 6627 4c61 756e 6368 696e 6720 696e 7374  f'Launching inst
-00026c90: 616e 6365 207b 696e 7374 616e 6365 5f69  ance {instance_i
-00026ca0: 647d 202e 2e2e 2070 6c65 6173 6520 7761  d} ... please wa
-00026cb0: 6974 202e 2e2e 2729 0a0a 2020 2020 2020  it ...')..      
-00026cc0: 2020 6d61 785f 7761 6974 5f74 696d 6520    max_wait_time 
-00026cd0: 3d20 3330 3020 2023 2073 6563 6f6e 6473  = 300  # seconds
-00026ce0: 0a20 2020 2020 2020 2064 656c 6179 5f74  .        delay_t
-00026cf0: 696d 6520 3d20 3130 2020 2320 6368 6563  ime = 10  # chec
-00026d00: 6b20 6576 6572 7920 3130 2073 6563 6f6e  k every 10 secon
-00026d10: 6473 2c20 6164 6a75 7374 2061 7320 6e65  ds, adjust as ne
-00026d20: 6564 6564 0a20 2020 2020 2020 206d 6178  eded.        max
-00026d30: 5f61 7474 656d 7074 7320 3d20 6d61 785f  _attempts = max_
-00026d40: 7761 6974 5f74 696d 6520 2f2f 2064 656c  wait_time // del
-00026d50: 6179 5f74 696d 650a 0a20 2020 2020 2020  ay_time..       
-00026d60: 2077 6169 7465 7220 3d20 7365 6c66 2e65   waiter = self.e
-00026d70: 6332 5f63 6c69 656e 742e 6765 745f 7761  c2_client.get_wa
-00026d80: 6974 6572 2827 696e 7374 616e 6365 5f72  iter('instance_r
-00026d90: 756e 6e69 6e67 2729 0a20 2020 2020 2020  unning').       
-00026da0: 2070 726f 6772 6573 7320 3d20 7365 6c66   progress = self
-00026db0: 2e5f 6372 6561 7465 5f70 726f 6772 6573  ._create_progres
-00026dc0: 735f 6261 7228 6d61 785f 6174 7465 6d70  s_bar(max_attemp
-00026dd0: 7473 290a 0a20 2020 2020 2020 2066 6f72  ts)..        for
-00026de0: 2061 7474 656d 7074 2069 6e20 7261 6e67   attempt in rang
-00026df0: 6528 6d61 785f 6174 7465 6d70 7473 293a  e(max_attempts):
-00026e00: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00026e10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026e20: 2020 7761 6974 6572 2e77 6169 7428 496e    waiter.wait(In
-00026e30: 7374 616e 6365 4964 733d 5b69 6e73 7461  stanceIds=[insta
-00026e40: 6e63 655f 6964 5d2c 2057 6169 7465 7243  nce_id], WaiterC
-00026e50: 6f6e 6669 673d 7b0a 2020 2020 2020 2020  onfig={.        
-00026e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026e70: 2020 2020 2744 656c 6179 273a 2064 656c      'Delay': del
-00026e80: 6179 5f74 696d 652c 2027 4d61 7841 7474  ay_time, 'MaxAtt
-00026e90: 656d 7074 7327 3a20 317d 290a 2020 2020  empts': 1}).    
-00026ea0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
-00026eb0: 7265 7373 2861 7474 656d 7074 290a 2020  ress(attempt).  
-00026ec0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00026ed0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00026ee0: 6578 6365 7074 2062 6f74 6f63 6f72 652e  except botocore.
-00026ef0: 6578 6365 7074 696f 6e73 2e57 6169 7465  exceptions.Waite
-00026f00: 7245 7272 6f72 3a0a 2020 2020 2020 2020  rError:.        
-00026f10: 2020 2020 2020 2020 7072 6f67 7265 7373          progress
-00026f20: 2861 7474 656d 7074 290a 2020 2020 2020  (attempt).      
-00026f30: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00026f40: 7565 0a20 2020 2020 2020 2070 7269 6e74  ue.        print
-00026f50: 2827 2729 0a20 2020 2020 2020 2069 6e73  ('').        ins
-00026f60: 7461 6e63 652e 7265 6c6f 6164 2829 0a0a  tance.reload()..
-00026f70: 2020 2020 2020 2020 6772 7069 6420 3d20          grpid = 
-00026f80: 7365 6c66 2e5f 6563 325f 6372 6561 7465  self._ec2_create
-00026f90: 5f61 6e64 5f61 7474 6163 685f 7365 6375  _and_attach_secu
-00026fa0: 7269 7479 5f67 726f 7570 280a 2020 2020  rity_group(.    
-00026fb0: 2020 2020 2020 2020 696e 7374 616e 6365          instance
-00026fc0: 5f69 6429 0a20 2020 2020 2020 2069 6620  _id).        if 
-00026fd0: 6772 7069 643a 0a20 2020 2020 2020 2020  grpid:.         
-00026fe0: 2020 2070 7269 6e74 2866 2753 6563 7572     print(f'Secur
-00026ff0: 6974 7920 4772 6f75 7020 227b 6772 7069  ity Group "{grpi
-00027000: 647d 2220 6174 7461 6368 6564 2e27 290a  d}" attached.').
-00027010: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027020: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00027030: 274e 6f20 5365 6375 7269 7479 2047 726f  'No Security Gro
-00027040: 7570 2049 4420 6372 6561 7465 642e 2729  up ID created.')
-00027050: 0a20 2020 2020 2020 2069 6e73 7461 6e63  .        instanc
-00027060: 652e 7761 6974 5f75 6e74 696c 5f72 756e  e.wait_until_run
-00027070: 6e69 6e67 2829 0a20 2020 2020 2020 2070  ning().        p
-00027080: 7269 6e74 2866 2749 6e73 7461 6e63 6520  rint(f'Instance 
-00027090: 4950 3a20 7b69 6e73 7461 6e63 652e 7075  IP: {instance.pu
-000270a0: 626c 6963 5f69 705f 6164 6472 6573 737d  blic_ip_address}
-000270b0: 2729 0a0a 2020 2020 2020 2020 2320 5361  ')..        # Sa
-000270c0: 7665 2074 6865 206c 6173 7420 696e 7374  ve the last inst
-000270d0: 616e 6365 2049 5020 6164 6472 6573 730a  ance IP address.
-000270e0: 2020 2020 2020 2020 7365 6c66 2e63 6667          self.cfg
-000270f0: 2e73 6574 5f65 6332 5f6c 6173 745f 696e  .set_ec2_last_in
-00027100: 7374 616e 6365 2869 6e73 7461 6e63 652e  stance(instance.
-00027110: 7075 626c 6963 5f69 705f 6164 6472 6573  public_ip_addres
-00027120: 7329 0a0a 2020 2020 2020 2020 7265 7475  s)..        retu
-00027130: 726e 2069 6e73 7461 6e63 655f 6964 2c20  rn instance_id, 
-00027140: 696e 7374 616e 6365 2e70 7562 6c69 635f  instance.public_
-00027150: 6970 5f61 6464 7265 7373 0a0a 2020 2020  ip_address..    
-00027160: 6465 6620 6563 325f 7465 726d 696e 6174  def ec2_terminat
-00027170: 655f 696e 7374 616e 6365 2873 656c 662c  e_instance(self,
-00027180: 2069 7029 3a0a 2020 2020 2020 2020 2320   ip):.        # 
-00027190: 7465 726d 696e 6174 6520 696e 7374 616e  terminate instan
-000271a0: 6365 0a20 2020 2020 2020 2023 2077 6974  ce.        # wit
-000271b0: 6820 6570 6865 6d65 7261 6c20 286c 6f63  h ephemeral (loc
-000271c0: 616c 2920 6469 736b 2066 6f72 2061 2074  al) disk for a t
-000271d0: 656d 706f 7261 7279 2072 6573 746f 7265  emporary restore
-000271e0: 0a0a 2020 2020 2020 2020 2320 6970 7320  ..        # ips 
-000271f0: 3d20 7365 6c66 2e65 6332 5f6c 6973 745f  = self.ec2_list_
-00027200: 6970 7328 7365 6c66 2c20 274e 616d 6527  ips(self, 'Name'
-00027210: 2c20 2746 726f 7374 6572 5365 6c66 4465  , 'FrosterSelfDe
-00027220: 7374 7275 6374 2729 0a20 2020 2020 2020  struct').       
-00027230: 2023 2055 7365 2064 6573 6372 6962 655f   # Use describe_
-00027240: 696e 7374 616e 6365 7320 7769 7468 2061  instances with a
-00027250: 2066 696c 7465 7220 666f 7220 7468 6520   filter for the 
-00027260: 7075 626c 6963 2049 5020 6164 6472 6573  public IP addres
-00027270: 7320 746f 2066 696e 6420 7468 6520 696e  s to find the in
-00027280: 7374 616e 6365 2049 440a 2020 2020 2020  stance ID.      
-00027290: 2020 6669 6c74 6572 7320 3d20 5b7b 0a20    filters = [{. 
-000272a0: 2020 2020 2020 2020 2020 2027 4e61 6d65             'Name
-000272b0: 273a 2027 6e65 7477 6f72 6b2d 696e 7465  ': 'network-inte
-000272c0: 7266 6163 652e 6164 6472 6573 7365 732e  rface.addresses.
-000272d0: 6173 736f 6369 6174 696f 6e2e 7075 626c  association.publ
-000272e0: 6963 2d69 7027 2c0a 2020 2020 2020 2020  ic-ip',.        
-000272f0: 2020 2020 2756 616c 7565 7327 3a20 5b69      'Values': [i
-00027300: 705d 0a20 2020 2020 2020 207d 5d0a 0a20  p].        }].. 
-00027310: 2020 2020 2020 2069 6620 6e6f 7420 6970         if not ip
-00027320: 2e73 7461 7274 7377 6974 6828 2769 2d27  .startswith('i-'
-00027330: 293a 2020 2320 7468 6973 2061 6e20 6970  ):  # this an ip
-00027340: 2061 6e64 206e 6f74 2061 6e20 696e 7374   and not an inst
-00027350: 616e 6365 2049 440a 2020 2020 2020 2020  ance ID.        
-00027360: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00027370: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-00027380: 6520 3d20 7365 6c66 2e65 6332 5f63 6c69  e = self.ec2_cli
-00027390: 656e 742e 6465 7363 7269 6265 5f69 6e73  ent.describe_ins
-000273a0: 7461 6e63 6573 2846 696c 7465 7273 3d66  tances(Filters=f
-000273b0: 696c 7465 7273 290a 2020 2020 2020 2020  ilters).        
-000273c0: 2020 2020 6578 6365 7074 2062 6f74 6f63      except botoc
-000273d0: 6f72 652e 6578 6365 7074 696f 6e73 2e43  ore.exceptions.C
-000273e0: 6c69 656e 7445 7272 6f72 2061 7320 653a  lientError as e:
-000273f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027400: 2070 7269 6e74 2866 2745 7272 6f72 3a20   print(f'Error: 
-00027410: 7b65 7d27 290a 2020 2020 2020 2020 2020  {e}').          
-00027420: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00027430: 7365 0a20 2020 2020 2020 2020 2020 2023  se.            #
-00027440: 2043 6865 636b 2069 6620 616e 7920 696e   Check if any in
-00027450: 7374 616e 6365 7320 6d61 7463 6820 7468  stances match th
-00027460: 6520 6372 6974 6572 6961 0a20 2020 2020  e criteria.     
-00027470: 2020 2020 2020 2069 6e73 7461 6e63 6573         instances
-00027480: 203d 205b 696e 7374 616e 6365 2066 6f72   = [instance for
-00027490: 2072 6573 6572 7661 7469 6f6e 2069 6e20   reservation in 
-000274a0: 7265 7370 6f6e 7365 5b27 5265 7365 7276  response['Reserv
-000274b0: 6174 696f 6e73 275d 0a20 2020 2020 2020  ations'].       
-000274c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274d0: 2020 666f 7220 696e 7374 616e 6365 2069    for instance i
-000274e0: 6e20 7265 7365 7276 6174 696f 6e5b 2749  n reservation['I
-000274f0: 6e73 7461 6e63 6573 275d 5d0a 2020 2020  nstances']].    
-00027500: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00027510: 6e73 7461 6e63 6573 3a0a 2020 2020 2020  nstances:.      
-00027520: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00027530: 6622 4e6f 2045 4332 2069 6e73 7461 6e63  f"No EC2 instanc
-00027540: 6520 666f 756e 6420 7769 7468 2070 7562  e found with pub
-00027550: 6c69 6320 4950 3a20 7b69 707d 2229 0a20  lic IP: {ip}"). 
-00027560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00027570: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-00027580: 2020 2320 4578 7472 6163 7420 696e 7374    # Extract inst
-00027590: 616e 6365 2049 4420 6672 6f6d 2074 6865  ance ID from the
-000275a0: 2069 6e73 7461 6e63 650a 2020 2020 2020   instance.      
-000275b0: 2020 2020 2020 696e 7374 616e 6365 5f69        instance_i
-000275c0: 6420 3d20 696e 7374 616e 6365 735b 305d  d = instances[0]
-000275d0: 5b27 496e 7374 616e 6365 4964 275d 0a20  ['InstanceId']. 
-000275e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000275f0: 2020 2020 2020 2020 2069 6e73 7461 6e63           instanc
-00027600: 655f 6964 203d 2069 700a 2020 2020 2020  e_id = ip.      
-00027610: 2020 2320 5465 726d 696e 6174 6520 7468    # Terminate th
-00027620: 6520 696e 7374 616e 6365 0a20 2020 2020  e instance.     
-00027630: 2020 2073 656c 662e 6563 325f 636c 6965     self.ec2_clie
-00027640: 6e74 2e74 6572 6d69 6e61 7465 5f69 6e73  nt.terminate_ins
-00027650: 7461 6e63 6573 2849 6e73 7461 6e63 6549  tances(InstanceI
-00027660: 6473 3d5b 696e 7374 616e 6365 5f69 645d  ds=[instance_id]
-00027670: 290a 0a20 2020 2020 2020 2070 7269 6e74  )..        print
-00027680: 2866 2245 4332 2049 6e73 7461 6e63 6520  (f"EC2 Instance 
-00027690: 7b69 6e73 7461 6e63 655f 6964 7d20 287b  {instance_id} ({
-000276a0: 6970 7d29 2069 7320 6265 696e 6720 7465  ip}) is being te
-000276b0: 726d 696e 6174 6564 2021 2229 0a0a 2020  rminated !")..  
-000276c0: 2020 6465 6620 6563 325f 6c69 7374 5f69    def ec2_list_i
-000276d0: 6e73 7461 6e63 6573 2873 656c 662c 2074  nstances(self, t
-000276e0: 6167 5f6e 616d 652c 2074 6167 5f76 616c  ag_name, tag_val
-000276f0: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00027700: 0a20 2020 2020 2020 204c 6973 7420 616c  .        List al
-00027710: 6c20 4950 2061 6464 7265 7373 6573 206f  l IP addresses o
-00027720: 6620 7275 6e6e 696e 6720 4543 3220 696e  f running EC2 in
-00027730: 7374 616e 6365 7320 7769 7468 2061 2073  stances with a s
-00027740: 7065 6369 6669 6320 7461 6720 6e61 6d65  pecific tag name
-00027750: 2061 6e64 2076 616c 7565 2e0a 2020 2020   and value..    
-00027760: 2020 2020 3a70 6172 616d 2074 6167 5f6e      :param tag_n
-00027770: 616d 653a 2054 6865 206e 616d 6520 6f66  ame: The name of
-00027780: 2074 6865 2074 6167 0a20 2020 2020 2020   the tag.       
-00027790: 203a 7061 7261 6d20 7461 675f 7661 6c75   :param tag_valu
-000277a0: 653a 2054 6865 2076 616c 7565 206f 6620  e: The value of 
-000277b0: 7468 6520 7461 670a 2020 2020 2020 2020  the tag.        
-000277c0: 3a72 6574 7572 6e3a 204c 6973 7420 6f66  :return: List of
-000277d0: 2049 5020 6164 6472 6573 7365 730a 2020   IP addresses.  
-000277e0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000277f0: 2020 2023 2044 6566 696e 6520 7468 6520     # Define the 
-00027800: 6669 6c74 6572 0a20 2020 2020 2020 2066  filter.        f
-00027810: 696c 7465 7273 203d 205b 0a20 2020 2020  ilters = [.     
-00027820: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00027830: 2020 2020 2020 2020 2027 4e61 6d65 273a           'Name':
-00027840: 2027 7461 673a 2720 2b20 7461 675f 6e61   'tag:' + tag_na
-00027850: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00027860: 2020 2020 2756 616c 7565 7327 3a20 5b74      'Values': [t
-00027870: 6167 5f76 616c 7565 5d0a 2020 2020 2020  ag_value].      
-00027880: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-00027890: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-000278a0: 2020 2020 2020 2027 4e61 6d65 273a 2027         'Name': '
-000278b0: 696e 7374 616e 6365 2d73 7461 7465 2d6e  instance-state-n
-000278c0: 616d 6527 2c0a 2020 2020 2020 2020 2020  ame',.          
-000278d0: 2020 2020 2020 2756 616c 7565 7327 3a20        'Values': 
-000278e0: 5b27 7275 6e6e 696e 6727 5d0a 2020 2020  ['running'].    
-000278f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00027900: 2020 5d0a 0a20 2020 2020 2020 2023 204d    ]..        # M
-00027910: 616b 6520 7468 6520 6465 7363 7269 6265  ake the describe
-00027920: 2069 6e73 7461 6e63 6573 2063 616c 6c0a   instances call.
-00027930: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00027940: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-00027950: 6520 3d20 7365 6c66 2e65 6332 5f63 6c69  e = self.ec2_cli
-00027960: 656e 742e 6465 7363 7269 6265 5f69 6e73  ent.describe_ins
-00027970: 7461 6e63 6573 2846 696c 7465 7273 3d66  tances(Filters=f
-00027980: 696c 7465 7273 290a 2020 2020 2020 2020  ilters).        
-00027990: 6578 6365 7074 2062 6f74 6f63 6f72 652e  except botocore.
-000279a0: 6578 6365 7074 696f 6e73 2e43 6c69 656e  exceptions.Clien
-000279b0: 7445 7272 6f72 2061 7320 653a 0a20 2020  tError as e:.   
-000279c0: 2020 2020 2020 2020 2065 7272 6f72 5f63           error_c
-000279d0: 6f64 6520 3d20 652e 7265 7370 6f6e 7365  ode = e.response
-000279e0: 5b27 4572 726f 7227 5d5b 2743 6f64 6527  ['Error']['Code'
-000279f0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00027a00: 2065 7272 6f72 5f63 6f64 6520 3d3d 2027   error_code == '
-00027a10: 4163 6365 7373 4465 6e69 6564 273a 0a20  AccessDenied':. 
-00027a20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00027a30: 7269 6e74 6462 6728 0a20 2020 2020 2020  rintdbg(.       
-00027a40: 2020 2020 2020 2020 2020 2020 2066 2741               f'A
-00027a50: 6363 6573 7320 6465 6e69 6564 2120 506c  ccess denied! Pl
-00027a60: 6561 7365 2063 6865 636b 2079 6f75 7220  ease check your 
-00027a70: 4941 4d20 7065 726d 6973 7369 6f6e 732e  IAM permissions.
-00027a80: 205c 6e20 2020 4572 726f 723a 207b 657d   \n   Error: {e}
-00027a90: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
-00027aa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00027ab0: 2020 2020 2070 7269 6e74 2866 2743 6c69       print(f'Cli
-00027ac0: 656e 7420 4572 726f 723a 207b 657d 2729  ent Error: {e}')
-00027ad0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00027ae0: 7572 6e20 5b5d 0a20 2020 2020 2020 2023  urn [].        #
-00027af0: 2041 6e20 6572 726f 7220 6f63 6375 7272   An error occurr
-00027b00: 6564 2028 4175 7468 4661 696c 7572 6529  ed (AuthFailure)
-00027b10: 2077 6865 6e20 6361 6c6c 696e 6720 7468   when calling th
-00027b20: 6520 4465 7363 7269 6265 496e 7374 616e  e DescribeInstan
-00027b30: 6365 7320 6f70 6572 6174 696f 6e3a 2041  ces operation: A
-00027b40: 5753 2077 6173 206e 6f74 2061 626c 6520  WS was not able 
-00027b50: 746f 2076 616c 6964 6174 6520 7468 6520  to validate the 
-00027b60: 7072 6f76 6964 6564 2061 6363 6573 7320  provided access 
-00027b70: 6372 6564 656e 7469 616c 730a 2020 2020  credentials.    
-00027b80: 2020 2020 696c 6973 7420 3d20 5b5d 0a20      ilist = []. 
-00027b90: 2020 2020 2020 2023 2045 7874 7261 6374         # Extract
-00027ba0: 2049 5020 6164 6472 6573 7365 730a 2020   IP addresses.  
-00027bb0: 2020 2020 2020 666f 7220 7265 7365 7276        for reserv
-00027bc0: 6174 696f 6e20 696e 2072 6573 706f 6e73  ation in respons
-00027bd0: 655b 2752 6573 6572 7661 7469 6f6e 7327  e['Reservations'
-00027be0: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
-00027bf0: 6f72 2069 6e73 7461 6e63 6520 696e 2072  or instance in r
-00027c00: 6573 6572 7661 7469 6f6e 5b27 496e 7374  eservation['Inst
-00027c10: 616e 6365 7327 5d3a 0a20 2020 2020 2020  ances']:.       
-00027c20: 2020 2020 2020 2020 2072 6f77 203d 205b           row = [
-00027c30: 696e 7374 616e 6365 5b27 5075 626c 6963  instance['Public
-00027c40: 4970 4164 6472 6573 7327 5d2c 0a20 2020  IpAddress'],.   
-00027c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c60: 2020 2020 696e 7374 616e 6365 5b27 496e      instance['In
-00027c70: 7374 616e 6365 4964 275d 2c0a 2020 2020  stanceId'],.    
-00027c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c90: 2020 2069 6e73 7461 6e63 655b 2749 6e73     instance['Ins
-00027ca0: 7461 6e63 6554 7970 6527 5d5d 0a20 2020  tanceType']].   
-00027cb0: 2020 2020 2020 2020 2020 2020 2069 6c69               ili
-00027cc0: 7374 2e61 7070 656e 6428 726f 7729 0a20  st.append(row). 
-00027cd0: 2020 2020 2020 2072 6574 7572 6e20 696c         return il
-00027ce0: 6973 740a 0a20 2020 2064 6566 205f 7373  ist..    def _ss
-00027cf0: 685f 6765 745f 6b65 795f 7061 7468 2873  h_get_key_path(s
-00027d00: 656c 6629 3a0a 2020 2020 2020 2020 6b65  elf):.        ke
-00027d10: 795f 7061 7468 203d 206f 732e 7061 7468  y_path = os.path
-00027d20: 2e6a 6f69 6e28 7365 6c66 2e63 6667 2e73  .join(self.cfg.s
-00027d30: 6861 7265 645f 6469 722c 0a20 2020 2020  hared_dir,.     
-00027d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d50: 2020 2020 2020 2020 2020 2066 277b 7365             f'{se
-00027d60: 6c66 2e63 6667 2e73 7368 5f6b 6579 5f6e  lf.cfg.ssh_key_n
-00027d70: 616d 657d 2e70 656d 2729 0a20 2020 2020  ame}.pem').     
-00027d80: 2020 206d 796b 6579 5f70 6174 6820 3d20     mykey_path = 
-00027d90: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-00027da0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00027db0: 6667 2e73 6861 7265 645f 6469 722c 2066  fg.shared_dir, f
-00027dc0: 277b 7365 6c66 2e63 6667 2e73 7368 5f6b  '{self.cfg.ssh_k
-00027dd0: 6579 5f6e 616d 657d 2d7b 7365 6c66 2e63  ey_name}-{self.c
-00027de0: 6667 2e77 686f 616d 697d 2e70 656d 2729  fg.whoami}.pem')
-00027df0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00027e00: 6f73 2e70 6174 682e 6578 6973 7473 286b  os.path.exists(k
-00027e10: 6579 5f70 6174 6829 3a0a 2020 2020 2020  ey_path):.      
-00027e20: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00027e30: 2020 2020 2020 2020 2020 2020 2066 277b               f'{
-00027e40: 6b65 795f 7061 7468 7d20 646f 6573 206e  key_path} does n
-00027e50: 6f74 2065 7869 7374 2e20 506c 6561 7365  ot exist. Please
-00027e60: 2063 7265 6174 6520 6974 2062 7920 6c61   create it by la
-00027e70: 756e 6368 696e 6720 2266 726f 7374 6572  unching "froster
-00027e80: 2072 6573 746f 7265 202d 2d61 7773 2227   restore --aws"'
-00027e90: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00027ea0: 732e 6578 6974 0a20 2020 2020 2020 2069  s.exit.        i
-00027eb0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-00027ec0: 6973 7473 286d 796b 6579 5f70 6174 6829  ists(mykey_path)
-00027ed0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-00027ee0: 7574 696c 2e63 6f70 7966 696c 6528 6b65  util.copyfile(ke
-00027ef0: 795f 7061 7468 2c20 6d79 6b65 795f 7061  y_path, mykey_pa
-00027f00: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-00027f10: 6f73 2e63 686d 6f64 286d 796b 6579 5f70  os.chmod(mykey_p
-00027f20: 6174 682c 2030 6f36 3030 2920 2023 2053  ath, 0o600)  # S
-00027f30: 6574 2066 696c 6520 7065 726d 6973 7369  et file permissi
-00027f40: 6f6e 2074 6f20 3630 300a 2020 2020 2020  on to 600.      
-00027f50: 2020 7265 7475 726e 206d 796b 6579 5f70    return mykey_p
-00027f60: 6174 680a 0a20 2020 2064 6566 2073 7368  ath..    def ssh
-00027f70: 5f65 7865 6375 7465 2873 656c 662c 2075  _execute(self, u
-00027f80: 7365 722c 2068 6f73 742c 2063 6f6d 6d61  ser, host, comma
-00027f90: 6e64 3d4e 6f6e 6529 3a0a 2020 2020 2020  nd=None):.      
-00027fa0: 2020 2222 2245 7865 6375 7465 2061 6e20    """Execute an 
-00027fb0: 5353 4820 636f 6d6d 616e 6420 6f6e 2074  SSH command on t
-00027fc0: 6865 2072 656d 6f74 6520 7365 7276 6572  he remote server
-00027fd0: 2e22 2222 0a20 2020 2020 2020 2053 5348  .""".        SSH
-00027fe0: 5f4f 5054 494f 4e53 203d 2022 2d6f 2053  _OPTIONS = "-o S
-00027ff0: 7472 6963 7448 6f73 744b 6579 4368 6563  trictHostKeyChec
-00028000: 6b69 6e67 3d6e 6f22 0a20 2020 2020 2020  king=no".       
-00028010: 206b 6579 5f70 6174 6820 3d20 7365 6c66   key_path = self
-00028020: 2e5f 7373 685f 6765 745f 6b65 795f 7061  ._ssh_get_key_pa
-00028030: 7468 2829 0a20 2020 2020 2020 2063 6d64  th().        cmd
-00028040: 203d 2066 2273 7368 207b 5353 485f 4f50   = f"ssh {SSH_OP
-00028050: 5449 4f4e 537d 202d 6920 277b 6b65 795f  TIONS} -i '{key_
-00028060: 7061 7468 7d27 207b 7573 6572 7d40 7b68  path}' {user}@{h
-00028070: 6f73 747d 220a 2020 2020 2020 2020 6966  ost}".        if
-00028080: 2063 6f6d 6d61 6e64 3a0a 2020 2020 2020   command:.      
-00028090: 2020 2020 2020 636d 6420 2b3d 2066 2220        cmd += f" 
-000280a0: 277b 636f 6d6d 616e 647d 2722 0a20 2020  '{command}'".   
-000280b0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-000280c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000280d0: 7375 6c74 203d 2073 7562 7072 6f63 6573  sult = subproces
-000280e0: 732e 7275 6e28 0a20 2020 2020 2020 2020  s.run(.         
-000280f0: 2020 2020 2020 2020 2020 2063 6d64 2c20             cmd, 
-00028100: 7368 656c 6c3d 5472 7565 2c20 6361 7074  shell=True, capt
-00028110: 7572 655f 6f75 7470 7574 3d54 7275 652c  ure_output=True,
-00028120: 2074 6578 743d 5472 7565 290a 2020 2020   text=True).    
-00028130: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00028140: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
-00028150: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00028160: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00028170: 696e 7428 6627 4572 726f 7220 6578 6563  int(f'Error exec
-00028180: 7574 696e 6720 227b 636d 647d 2e22 2729  uting "{cmd}."')
-00028190: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000281a0: 2020 2020 2020 2020 2020 2073 7562 7072             subpr
-000281b0: 6f63 6573 732e 7275 6e28 636d 642c 2073  ocess.run(cmd, s
-000281c0: 6865 6c6c 3d54 7275 652c 2063 6170 7475  hell=True, captu
-000281d0: 7265 5f6f 7574 7075 743d 4661 6c73 652c  re_output=False,
-000281e0: 2074 6578 743d 5472 7565 290a 2020 2020   text=True).    
-000281f0: 2020 2020 7072 696e 7464 6267 2866 2773      printdbg(f's
-00028200: 7368 2063 6f6d 6d61 6e64 206c 696e 653a  sh command line:
-00028210: 207b 636d 647d 2729 0a20 2020 2020 2020   {cmd}').       
-00028220: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-00028230: 2020 6465 6620 7373 685f 7570 6c6f 6164    def ssh_upload
-00028240: 2873 656c 662c 2075 7365 722c 2068 6f73  (self, user, hos
-00028250: 742c 206c 6f63 616c 5f70 6174 682c 2072  t, local_path, r
-00028260: 656d 6f74 655f 7061 7468 2c20 6973 5f73  emote_path, is_s
-00028270: 7472 696e 673d 4661 6c73 6529 3a0a 2020  tring=False):.  
-00028280: 2020 2020 2020 2222 2255 706c 6f61 6420        """Upload 
-00028290: 6120 6669 6c65 2074 6f20 7468 6520 7265  a file to the re
-000282a0: 6d6f 7465 2073 6572 7665 7220 7573 696e  mote server usin
-000282b0: 6720 5343 502e 2222 220a 2020 2020 2020  g SCP.""".      
-000282c0: 2020 5353 485f 4f50 5449 4f4e 5320 3d20    SSH_OPTIONS = 
-000282d0: 222d 6f20 5374 7269 6374 486f 7374 4b65  "-o StrictHostKe
-000282e0: 7943 6865 636b 696e 673d 6e6f 220a 2020  yChecking=no".  
-000282f0: 2020 2020 2020 6b65 795f 7061 7468 203d        key_path =
-00028300: 2073 656c 662e 5f73 7368 5f67 6574 5f6b   self._ssh_get_k
-00028310: 6579 5f70 6174 6828 290a 2020 2020 2020  ey_path().      
-00028320: 2020 6966 2069 735f 7374 7269 6e67 3a0a    if is_string:.
-00028330: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-00028340: 6520 6c6f 6361 6c5f 7061 7468 2069 7320  e local_path is 
-00028350: 6163 7475 616c 6c79 2061 2073 7472 696e  actually a strin
-00028360: 6720 7468 6174 206e 6565 6473 2074 6f20  g that needs to 
-00028370: 676f 2069 6e74 6f20 7465 6d70 2066 696c  go into temp fil
-00028380: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
-00028390: 7468 2074 656d 7066 696c 652e 4e61 6d65  th tempfile.Name
-000283a0: 6454 656d 706f 7261 7279 4669 6c65 286d  dTemporaryFile(m
-000283b0: 6f64 653d 2777 2b27 2c20 6465 6c65 7465  ode='w+', delete
-000283c0: 3d46 616c 7365 2920 6173 2074 656d 703a  =False) as temp:
-000283d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000283e0: 2074 656d 702e 7772 6974 6528 6c6f 6361   temp.write(loca
-000283f0: 6c5f 7061 7468 290a 2020 2020 2020 2020  l_path).        
-00028400: 2020 2020 2020 2020 6c6f 6361 6c5f 7061          local_pa
-00028410: 7468 203d 2074 656d 702e 6e61 6d65 0a20  th = temp.name. 
-00028420: 2020 2020 2020 2063 6d64 203d 2066 2273         cmd = f"s
-00028430: 6370 207b 5353 485f 4f50 5449 4f4e 537d  cp {SSH_OPTIONS}
-00028440: 202d 6920 277b 6b65 795f 7061 7468 7d27   -i '{key_path}'
-00028450: 207b 6c6f 6361 6c5f 7061 7468 7d20 7b75   {local_path} {u
-00028460: 7365 727d 407b 686f 7374 7d3a 7b72 656d  ser}@{host}:{rem
-00028470: 6f74 655f 7061 7468 7d22 0a20 2020 2020  ote_path}".     
-00028480: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00028490: 2020 2020 7265 7375 6c74 203d 2073 7562      result = sub
-000284a0: 7072 6f63 6573 732e 7275 6e28 0a20 2020  process.run(.   
-000284b0: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-000284c0: 2c20 7368 656c 6c3d 5472 7565 2c20 6361  , shell=True, ca
-000284d0: 7074 7572 655f 6f75 7470 7574 3d54 7275  pture_output=Tru
-000284e0: 652c 2074 6578 743d 5472 7565 290a 2020  e, text=True).  
-000284f0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
-00028500: 7374 7269 6e67 3a0a 2020 2020 2020 2020  string:.        
-00028510: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
-00028520: 6528 6c6f 6361 6c5f 7061 7468 290a 2020  e(local_path).  
-00028530: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00028540: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00028550: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00028560: 2020 2020 7072 696e 7428 6627 4572 726f      print(f'Erro
-00028570: 7220 6578 6563 7574 696e 6720 227b 636d  r executing "{cm
-00028580: 647d 2e22 2729 0a20 2020 2020 2020 2072  d}."').        r
-00028590: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-000285a0: 6465 6620 7373 685f 646f 776e 6c6f 6164  def ssh_download
-000285b0: 2873 656c 662c 2075 7365 722c 2068 6f73  (self, user, hos
-000285c0: 742c 2072 656d 6f74 655f 7061 7468 2c20  t, remote_path, 
-000285d0: 6c6f 6361 6c5f 7061 7468 293a 0a20 2020  local_path):.   
-000285e0: 2020 2020 2022 2222 5570 6c6f 6164 2061       """Upload a
-000285f0: 2066 696c 6520 746f 2074 6865 2072 656d   file to the rem
-00028600: 6f74 6520 7365 7276 6572 2075 7369 6e67  ote server using
-00028610: 2053 4350 2e22 2222 0a20 2020 2020 2020   SCP.""".       
-00028620: 2053 5348 5f4f 5054 494f 4e53 203d 2022   SSH_OPTIONS = "
-00028630: 2d6f 2053 7472 6963 7448 6f73 744b 6579  -o StrictHostKey
-00028640: 4368 6563 6b69 6e67 3d6e 6f22 0a20 2020  Checking=no".   
-00028650: 2020 2020 206b 6579 5f70 6174 6820 3d20       key_path = 
-00028660: 7365 6c66 2e5f 7373 685f 6765 745f 6b65  self._ssh_get_ke
-00028670: 795f 7061 7468 2829 0a20 2020 2020 2020  y_path().       
-00028680: 2063 6d64 203d 2066 2273 6370 207b 5353   cmd = f"scp {SS
-00028690: 485f 4f50 5449 4f4e 537d 202d 6920 277b  H_OPTIONS} -i '{
-000286a0: 6b65 795f 7061 7468 7d27 207b 7573 6572  key_path}' {user
-000286b0: 7d40 7b68 6f73 747d 3a7b 7265 6d6f 7465  }@{host}:{remote
-000286c0: 5f70 6174 687d 207b 6c6f 6361 6c5f 7061  _path} {local_pa
-000286d0: 7468 7d22 0a20 2020 2020 2020 2074 7279  th}".        try
-000286e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000286f0: 7375 6c74 203d 2073 7562 7072 6f63 6573  sult = subproces
-00028700: 732e 7275 6e28 0a20 2020 2020 2020 2020  s.run(.         
-00028710: 2020 2020 2020 2063 6d64 2c20 7368 656c         cmd, shel
-00028720: 6c3d 5472 7565 2c20 6361 7074 7572 655f  l=True, capture_
-00028730: 6f75 7470 7574 3d54 7275 652c 2074 6578  output=True, tex
-00028740: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
-00028750: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00028760: 740a 2020 2020 2020 2020 6578 6365 7074  t.        except
-00028770: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00028780: 696e 7428 6627 4572 726f 7220 6578 6563  int(f'Error exec
-00028790: 7574 696e 6720 227b 636d 647d 2e22 2729  uting "{cmd}."')
-000287a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000287b0: 4e6f 6e65 0a0a 2020 2020 6465 6620 7365  None..    def se
-000287c0: 6e64 5f65 6d61 696c 5f73 6573 2873 656c  nd_email_ses(sel
-000287d0: 662c 2073 656e 6465 722c 2074 6f2c 2073  f, sender, to, s
-000287e0: 7562 6a65 6374 2c20 626f 6479 293a 0a20  ubject, body):. 
-000287f0: 2020 2020 2020 2027 2727 5573 696e 6720         '''Using 
-00028800: 4157 5320 7365 7320 7365 7276 6963 6520  AWS ses service 
-00028810: 746f 2073 656e 6420 656d 6169 6c73 2727  to send emails''
-00028820: 270a 0a20 2020 2020 2020 2023 2043 6865  '..        # Che
-00028830: 636b 2069 6620 7265 7175 6972 6564 2070  ck if required p
-00028840: 6172 616d 6574 6572 7320 6172 6520 7072  arameters are pr
-00028850: 6f76 6964 6564 0a20 2020 2020 2020 2069  ovided.        i
-00028860: 6620 6e6f 7420 7365 6e64 6572 3a0a 2020  f not sender:.  
-00028870: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00028880: 5661 6c75 6545 7272 6f72 2827 5365 6e64  ValueError('Send
-00028890: 6572 2065 6d61 696c 2061 6464 7265 7373  er email address
-000288a0: 2069 7320 7265 7175 6972 6564 2e27 290a   is required.').
-000288b0: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
-000288c0: 6f3a 0a20 2020 2020 2020 2020 2020 2072  o:.            r
-000288d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000288e0: 2752 6563 6970 6965 6e74 2065 6d61 696c  'Recipient email
-000288f0: 2061 6464 7265 7373 2069 7320 7265 7175   address is requ
-00028900: 6972 6564 2e27 290a 2020 2020 2020 2020  ired.').        
-00028910: 6966 206e 6f74 2073 7562 6a65 6374 3a0a  if not subject:.
-00028920: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00028930: 6520 5661 6c75 6545 7272 6f72 2827 456d  e ValueError('Em
-00028940: 6169 6c20 7375 626a 6563 7420 6973 2072  ail subject is r
-00028950: 6571 7569 7265 642e 2729 0a20 2020 2020  equired.').     
-00028960: 2020 2069 6620 6e6f 7420 626f 6479 3a0a     if not body:.
-00028970: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00028980: 6520 5661 6c75 6545 7272 6f72 2827 456d  e ValueError('Em
-00028990: 6169 6c20 626f 6479 2069 7320 7265 7175  ail body is requ
-000289a0: 6972 6564 2e27 290a 0a20 2020 2020 2020  ired.')..       
-000289b0: 2073 6573 5f76 6572 6966 795f 7265 7175   ses_verify_requ
-000289c0: 6573 7473 5f73 656e 7420 3d20 7365 6c66  ests_sent = self
-000289d0: 2e63 6667 2e73 6573 5f76 6572 6966 795f  .cfg.ses_verify_
-000289e0: 7265 7175 6573 7473 5f73 656e 740a 0a20  requests_sent.. 
-000289f0: 2020 2020 2020 2076 6572 6966 6965 645f         verified_
-00028a00: 656d 6169 6c5f 6164 6472 203d 205b 5d0a  email_addr = [].
-00028a10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00028a20: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-00028a30: 6520 3d20 7365 6c66 2e73 6573 5f63 6c69  e = self.ses_cli
-00028a40: 656e 742e 6c69 7374 5f76 6572 6966 6965  ent.list_verifie
-00028a50: 645f 656d 6169 6c5f 6164 6472 6573 7365  d_email_addresse
-00028a60: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00028a70: 7665 7269 6669 6564 5f65 6d61 696c 5f61  verified_email_a
-00028a80: 6464 7220 3d20 7265 7370 6f6e 7365 2e67  ddr = response.g
-00028a90: 6574 2827 5665 7269 6669 6564 456d 6169  et('VerifiedEmai
-00028aa0: 6c41 6464 7265 7373 6573 272c 205b 5d29  lAddresses', [])
-00028ab0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00028ac0: 626f 746f 636f 7265 2e65 7863 6570 7469  botocore.excepti
-00028ad0: 6f6e 732e 436c 6965 6e74 4572 726f 7220  ons.ClientError 
-00028ae0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00028af0: 2020 6572 726f 725f 636f 6465 203d 2065    error_code = e
-00028b00: 2e72 6573 706f 6e73 655b 2745 7272 6f72  .response['Error
-00028b10: 275d 5b27 436f 6465 275d 0a20 2020 2020  ']['Code'].     
-00028b20: 2020 2020 2020 2069 6620 6572 726f 725f         if error_
-00028b30: 636f 6465 203d 3d20 2741 6363 6573 7344  code == 'AccessD
-00028b40: 656e 6965 6427 3a0a 2020 2020 2020 2020  enied':.        
-00028b50: 2020 2020 2020 2020 7072 696e 7464 6267          printdbg
-00028b60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00028b70: 2020 2020 2020 6627 4163 6365 7373 2064        f'Access d
-00028b80: 656e 6965 6420 746f 2053 4553 2061 6476  enied to SES adv
-00028b90: 616e 6365 6420 6665 6174 7572 6573 2120  anced features! 
-00028ba0: 506c 6561 7365 2063 6865 636b 2079 6f75  Please check you
-00028bb0: 7220 4941 4d20 7065 726d 6973 7369 6f6e  r IAM permission
-00028bc0: 732e 205c 6e45 7272 6f72 3a20 7b65 7d27  s. \nError: {e}'
-00028bd0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00028be0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00028bf0: 2020 2020 7072 696e 7428 6627 436c 6965      print(f'Clie
-00028c00: 6e74 2045 7272 6f72 3a20 7b65 7d27 290a  nt Error: {e}').
-00028c10: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00028c20: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-00028c30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00028c40: 2866 274f 7468 6572 2045 7272 6f72 3a20  (f'Other Error: 
-00028c50: 7b65 7d27 290a 0a20 2020 2020 2020 2063  {e}')..        c
-00028c60: 6865 636b 7320 3d20 5b73 656e 6465 722c  hecks = [sender,
-00028c70: 2074 6f5d 0a20 2020 2020 2020 2063 6865   to].        che
-00028c80: 636b 7320 3d20 6c69 7374 2873 6574 2863  cks = list(set(c
-00028c90: 6865 636b 7329 2920 2023 2072 656d 6f76  hecks))  # remov
-00028ca0: 6520 6475 706c 6963 6174 6573 0a20 2020  e duplicates.   
-00028cb0: 2020 2020 2065 6d61 696c 5f6c 6973 7420       email_list 
-00028cc0: 3d20 5b5d 0a0a 2020 2020 2020 2020 7472  = []..        tr
-00028cd0: 793a 0a20 2020 2020 2020 2020 2020 2066  y:.            f
-00028ce0: 6f72 2063 6865 636b 2069 6e20 6368 6563  or check in chec
-00028cf0: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
-00028d00: 2020 2020 6966 2063 6865 636b 206e 6f74      if check not
-00028d10: 2069 6e20 7665 7269 6669 6564 5f65 6d61   in verified_ema
-00028d20: 696c 5f61 6464 7220 616e 6420 6368 6563  il_addr and chec
-00028d30: 6b20 6e6f 7420 696e 2073 6573 5f76 6572  k not in ses_ver
-00028d40: 6966 795f 7265 7175 6573 7473 5f73 656e  ify_requests_sen
-00028d50: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00028d60: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-00028d70: 3d20 7365 6c66 2e73 6573 5f63 6c69 656e  = self.ses_clien
-00028d80: 742e 7665 7269 6679 5f65 6d61 696c 5f69  t.verify_email_i
-00028d90: 6465 6e74 6974 7928 0a20 2020 2020 2020  dentity(.       
-00028da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028db0: 2045 6d61 696c 4164 6472 6573 733d 6368   EmailAddress=ch
-00028dc0: 6563 6b29 0a20 2020 2020 2020 2020 2020  eck).           
-00028dd0: 2020 2020 2020 2020 2065 6d61 696c 5f6c           email_l
-00028de0: 6973 742e 6170 7065 6e64 2863 6865 636b  ist.append(check
-00028df0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00028e00: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00028e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e20: 2020 2020 2066 277b 6368 6563 6b7d 2077       f'{check} w
-00028e30: 6173 2075 7365 6420 666f 7220 7468 6520  as used for the 
-00028e40: 6669 7273 7420 7469 6d65 2c20 7665 7269  first time, veri
-00028e50: 6669 6361 7469 6f6e 2065 6d61 696c 2073  fication email s
-00028e60: 656e 742e 2729 0a20 2020 2020 2020 2020  ent.').         
-00028e70: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00028e80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00028e90: 2020 2020 2020 2020 2020 2750 6c65 6173            'Pleas
-00028ea0: 6520 6861 7665 207b 6368 6563 6b7d 2063  e have {check} c
-00028eb0: 6865 636b 2069 6e62 6f78 2061 6e64 2063  heck inbox and c
-00028ec0: 6f6e 6669 726d 2065 6d61 696c 2066 726f  onfirm email fro
-00028ed0: 6d20 4157 532e 5c6e 2729 0a0a 2020 2020  m AWS.\n')..    
-00028ee0: 2020 2020 6578 6365 7074 2062 6f74 6f63      except botoc
-00028ef0: 6f72 652e 6578 6365 7074 696f 6e73 2e43  ore.exceptions.C
-00028f00: 6c69 656e 7445 7272 6f72 2061 7320 653a  lientError as e:
-00028f10: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-00028f20: 6f72 5f63 6f64 6520 3d20 652e 7265 7370  or_code = e.resp
-00028f30: 6f6e 7365 5b27 4572 726f 7227 5d5b 2743  onse['Error']['C
-00028f40: 6f64 6527 5d0a 2020 2020 2020 2020 2020  ode'].          
-00028f50: 2020 6966 2065 7272 6f72 5f63 6f64 6520    if error_code 
-00028f60: 3d3d 2027 4163 6365 7373 4465 6e69 6564  == 'AccessDenied
-00028f70: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00028f80: 2020 2070 7269 6e74 6462 6728 0a20 2020     printdbg(.   
-00028f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fa0: 2066 2741 6363 6573 7320 6465 6e69 6564   f'Access denied
-00028fb0: 2074 6f20 5345 5320 6164 7661 6e63 6564   to SES advanced
-00028fc0: 2066 6561 7475 7265 7321 2050 6c65 6173   features! Pleas
-00028fd0: 6520 6368 6563 6b20 796f 7572 2049 414d  e check your IAM
-00028fe0: 2070 6572 6d69 7373 696f 6e73 2e20 5c6e   permissions. \n
-00028ff0: 4572 726f 723a 207b 657d 2729 0a20 2020  Error: {e}').   
-00029000: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00029010: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00029020: 7269 6e74 2866 2743 6c69 656e 7420 4572  rint(f'Client Er
-00029030: 726f 723a 207b 657d 2729 0a20 2020 2020  ror: {e}').     
-00029040: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00029050: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00029060: 2020 2020 2020 7072 696e 7428 6627 4f74        print(f'Ot
-00029070: 6865 7220 4572 726f 723a 207b 657d 2729  her Error: {e}')
-00029080: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00029090: 6667 2e73 6573 5f76 6572 6966 795f 7265  fg.ses_verify_re
-000290a0: 7175 6573 7473 5f73 656e 7428 656d 6169  quests_sent(emai
-000290b0: 6c5f 6c69 7374 290a 0a20 2020 2020 2020  l_list)..       
-000290c0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-000290d0: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-000290e0: 662e 7365 735f 636c 6965 6e74 2e73 656e  f.ses_client.sen
-000290f0: 645f 656d 6169 6c28 0a20 2020 2020 2020  d_email(.       
-00029100: 2020 2020 2020 2020 2053 6f75 7263 653d           Source=
-00029110: 7365 6e64 6572 2c0a 2020 2020 2020 2020  sender,.        
-00029120: 2020 2020 2020 2020 4465 7374 696e 6174          Destinat
-00029130: 696f 6e3d 7b0a 2020 2020 2020 2020 2020  ion={.          
-00029140: 2020 2020 2020 2020 2020 2754 6f41 6464            'ToAdd
-00029150: 7265 7373 6573 273a 205b 746f 5d0a 2020  resses': [to].  
-00029160: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
-00029170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029180: 204d 6573 7361 6765 3d7b 0a20 2020 2020   Message={.     
-00029190: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000291a0: 5375 626a 6563 7427 3a20 7b0a 2020 2020  Subject': {.    
+00026840: 2020 7072 696e 7428 2720 2020 202e 2e2e    print('    ...
+00026850: 554e 4d4f 554e 5445 4420 5355 4343 4553  UNMOUNTED SUCCES
+00026860: 535c 6e27 290a 2020 2020 2020 2020 2020  S\n').          
+00026870: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026890: 7072 696e 7428 2720 2020 202e 2e2e 554e  print('    ...UN
+000268a0: 4d4f 554e 5449 4e47 2046 4149 4c45 445c  MOUNTING FAILED\
+000268b0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+000268c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000268d0: 2020 2020 2020 7072 696e 7428 6627 2020        print(f'  
+000268e0: 2020 2e2e 2e49 5320 4e4f 5420 4d4f 554e    ...IS NOT MOUN
+000268f0: 5445 445c 6e27 290a 0a20 2020 2064 6566  TED\n')..    def
+00026900: 2075 6e6d 6f75 6e74 2873 656c 662c 2066   unmount(self, f
+00026910: 6f6c 6465 7273 293a 0a0a 2020 2020 2020  olders):..      
+00026920: 2020 2320 436c 6561 6e20 7468 6520 7072    # Clean the pr
+00026930: 6f76 6964 6564 2070 6174 6873 0a20 2020  ovided paths.   
+00026940: 2020 2020 2066 6f6c 6465 7273 203d 2063       folders = c
+00026950: 6c65 616e 5f70 6174 685f 6c69 7374 2866  lean_path_list(f
+00026960: 6f6c 6465 7273 290a 0a20 2020 2020 2020  olders)..       
+00026970: 2073 656c 662e 5f75 6e6d 6f75 6e74 5f6c   self._unmount_l
+00026980: 6f63 616c 6c79 2866 6f6c 6465 7273 290a  ocally(folders).
+00026990: 0a20 2020 2064 6566 2067 6574 5f68 6f74  .    def get_hot
+000269a0: 7370 6f74 5f66 6f6c 6465 7273 2873 656c  spot_folders(sel
+000269b0: 662c 2068 6f74 7370 6f74 5f66 696c 6529  f, hotspot_file)
+000269c0: 3a0a 0a20 2020 2020 2020 2061 6765 666c  :..        agefl
+000269d0: 6420 3d20 2741 6363 4427 0a0a 2020 2020  d = 'AccD'..    
+000269e0: 2020 2020 6966 2073 656c 662e 6172 6773      if self.args
+000269f0: 2e61 6765 6d74 696d 653a 0a20 2020 2020  .agemtime:.     
+00026a00: 2020 2020 2020 2061 6765 666c 6420 3d20         agefld = 
+00026a10: 274d 6f64 4427 0a0a 2020 2020 2020 2020  'ModD'..        
+00026a20: 2320 496e 6974 6961 6c69 7a65 2061 2063  # Initialize a c
+00026a30: 6f6e 6e65 6374 696f 6e20 746f 2061 6e20  onnection to an 
+00026a40: 696e 2d6d 656d 6f72 7920 6461 7461 6261  in-memory databa
+00026a50: 7365 0a20 2020 2020 2020 2064 7563 6b64  se.        duckd
+00026a60: 625f 636f 6e6e 6563 7469 6f6e 203d 2064  b_connection = d
+00026a70: 7563 6b64 622e 636f 6e6e 6563 7428 0a20  uckdb.connect(. 
+00026a80: 2020 2020 2020 2020 2020 2064 6174 6162             datab
+00026a90: 6173 653d 273a 6d65 6d6f 7279 3a27 2c20  ase=':memory:', 
+00026aa0: 7265 6164 5f6f 6e6c 793d 4661 6c73 6529  read_only=False)
+00026ab0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+00026ac0: 7468 6520 6e75 6d62 6572 206f 6620 7468  the number of th
+00026ad0: 7265 6164 7320 746f 2075 7365 0a20 2020  reads to use.   
+00026ae0: 2020 2020 2064 7563 6b64 625f 636f 6e6e       duckdb_conn
+00026af0: 6563 7469 6f6e 2e65 7865 6375 7465 2866  ection.execute(f
+00026b00: 2750 5241 474d 4120 7468 7265 6164 733d  'PRAGMA threads=
+00026b10: 7b73 656c 662e 6172 6773 2e63 6f72 6573  {self.args.cores
+00026b20: 7d3b 2729 0a0a 2020 2020 2020 2020 2320  };')..        # 
+00026b30: 5265 6769 7374 6572 2043 5356 2066 696c  Register CSV fil
+00026b40: 6520 6173 2061 2076 6972 7475 616c 2074  e as a virtual t
+00026b50: 6162 6c65 0a20 2020 2020 2020 2064 7563  able.        duc
+00026b60: 6b64 625f 636f 6e6e 6563 7469 6f6e 2e65  kdb_connection.e
+00026b70: 7865 6375 7465 280a 2020 2020 2020 2020  xecute(.        
+00026b80: 2020 2020 6622 4352 4541 5445 2054 4142      f"CREATE TAB
+00026b90: 4c45 2068 7320 4153 2053 454c 4543 5420  LE hs AS SELECT 
+00026ba0: 2a20 4652 4f4d 2072 6561 645f 6373 765f  * FROM read_csv_
+00026bb0: 6175 746f 2827 7b68 6f74 7370 6f74 5f66  auto('{hotspot_f
+00026bc0: 696c 657d 2729 2229 0a0a 2020 2020 2020  ile}')")..      
+00026bd0: 2020 7175 6572 7920 3d20 2253 454c 4543    query = "SELEC
+00026be0: 5420 434f 554e 5428 2a29 2046 524f 4d20  T COUNT(*) FROM 
+00026bf0: 6873 220a 2020 2020 2020 2020 7265 7375  hs".        resu
+00026c00: 6c74 203d 2064 7563 6b64 625f 636f 6e6e  lt = duckdb_conn
+00026c10: 6563 7469 6f6e 2e65 7865 6375 7465 2871  ection.execute(q
+00026c20: 7565 7279 292e 6665 7463 6861 6c6c 2829  uery).fetchall()
+00026c30: 0a0a 2020 2020 2020 2020 6966 2072 6573  ..        if res
+00026c40: 756c 745b 305d 5b30 5d20 3d3d 2030 3a0a  ult[0][0] == 0:.
+00026c50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00026c60: 726e 205b 5d0a 0a20 2020 2020 2020 2023  rn []..        #
+00026c70: 2052 756e 2053 514c 2071 7565 7269 6573   Run SQL queries
+00026c80: 206f 6e20 7468 6973 2076 6972 7475 616c   on this virtual
+00026c90: 2074 6162 6c65 0a20 2020 2020 2020 2023   table.        #
+00026ca0: 2046 696c 7465 7220 6279 2067 6976 656e   Filter by given
+00026cb0: 2061 6765 2061 6e64 2073 697a 652e 2054   age and size. T
+00026cc0: 6865 2064 6566 6175 6c74 2076 616c 7565  he default value
+00026cd0: 2066 6f72 2061 6c6c 2069 7320 300a 2020   for all is 0.  
+00026ce0: 2020 2020 2020 6966 2073 656c 662e 6172        if self.ar
+00026cf0: 6773 2e6f 6c64 6572 203e 2030 3a0a 2020  gs.older > 0:.  
+00026d00: 2020 2020 2020 2020 2020 726f 7773 203d            rows =
+00026d10: 2064 7563 6b64 625f 636f 6e6e 6563 7469   duckdb_connecti
+00026d20: 6f6e 2e65 7865 6375 7465 280a 2020 2020  on.execute(.    
+00026d30: 2020 2020 2020 2020 2020 2020 6622 5345              f"SE
+00026d40: 4c45 4354 202a 2046 524f 4d20 6873 2057  LECT * FROM hs W
+00026d50: 4845 5245 207b 6167 6566 6c64 7d20 3e3d  HERE {agefld} >=
+00026d60: 207b 7365 6c66 2e61 7267 732e 6f6c 6465   {self.args.olde
+00026d70: 727d 2061 6e64 2047 6942 203e 3d20 7b73  r} and GiB >= {s
+00026d80: 656c 662e 6172 6773 2e6c 6172 6765 727d  elf.args.larger}
+00026d90: 2022 292e 6665 7463 6861 6c6c 2829 0a0a   ").fetchall()..
+00026da0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00026db0: 662e 6172 6773 2e6e 6577 6572 203e 2030  f.args.newer > 0
+00026dc0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+00026dd0: 7773 203d 2064 7563 6b64 625f 636f 6e6e  ws = duckdb_conn
+00026de0: 6563 7469 6f6e 2e65 7865 6375 7465 280a  ection.execute(.
+00026df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e00: 6622 5345 4c45 4354 202a 2046 524f 4d20  f"SELECT * FROM 
+00026e10: 6873 2057 4845 5245 207b 6167 6566 6c64  hs WHERE {agefld
+00026e20: 7d20 3c3d 207b 7365 6c66 2e61 7267 732e  } <= {self.args.
+00026e30: 6e65 7765 727d 2061 6e64 2047 6942 203e  newer} and GiB >
+00026e40: 3d20 7b73 656c 662e 6172 6773 2e6c 6172  = {self.args.lar
+00026e50: 6765 727d 2022 292e 6665 7463 6861 6c6c  ger} ").fetchall
+00026e60: 2829 0a0a 2020 2020 2020 2020 656c 7365  ()..        else
+00026e70: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+00026e80: 7773 203d 2064 7563 6b64 625f 636f 6e6e  ws = duckdb_conn
+00026e90: 6563 7469 6f6e 2e65 7865 6375 7465 280a  ection.execute(.
+00026ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026eb0: 6622 5345 4c45 4354 202a 2046 524f 4d20  f"SELECT * FROM 
+00026ec0: 6873 2057 4845 5245 2047 6942 203e 3d20  hs WHERE GiB >= 
+00026ed0: 7b73 656c 662e 6172 6773 2e6c 6172 6765  {self.args.large
+00026ee0: 727d 2022 292e 6665 7463 6861 6c6c 2829  r} ").fetchall()
+00026ef0: 0a0a 2020 2020 2020 2020 2320 436c 6f73  ..        # Clos
+00026f00: 6520 7468 6520 4475 636b 4442 2063 6f6e  e the DuckDB con
+00026f10: 6e65 6374 696f 6e0a 2020 2020 2020 2020  nection.        
+00026f20: 6475 636b 6462 5f63 6f6e 6e65 6374 696f  duckdb_connectio
+00026f30: 6e2e 636c 6f73 6528 290a 0a20 2020 2020  n.close()..     
+00026f40: 2020 2066 6f6c 6465 7273 5f74 6f5f 6172     folders_to_ar
+00026f50: 6368 6976 6520 3d20 5b28 6974 656d 5b35  chive = [(item[5
+00026f60: 5d2c 2069 7465 6d5b 335d 290a 2020 2020  ], item[3]).    
+00026f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f80: 2020 2020 2020 2020 2020 666f 7220 6974            for it
+00026f90: 656d 2069 6e20 726f 7773 5d20 2023 2049  em in rows]  # I
+00026fa0: 6e63 6c75 6465 2073 697a 6520 696e 2074  nclude size in t
+00026fb0: 6865 2074 7570 6c65 0a0a 2020 2020 2020  he tuple..      
+00026fc0: 2020 7072 696e 7428 6627 486f 7473 706f    print(f'Hotspo
+00026fd0: 7473 2066 696c 653a 207b 686f 7473 706f  ts file: {hotspo
+00026fe0: 745f 6669 6c65 7d27 290a 2020 2020 2020  t_file}').      
+00026ff0: 2020 7072 696e 7428 6627 5c6e 466f 6c64    print(f'\nFold
+00027000: 6572 7320 746f 2061 7263 6869 7665 3a5c  ers to archive:\
+00027010: 6e27 290a 2020 2020 2020 2020 666f 7220  n').        for 
+00027020: 666f 6c64 6572 2c20 7369 7a65 2069 6e20  folder, size in 
+00027030: 666f 6c64 6572 735f 746f 5f61 7263 6869  folders_to_archi
+00027040: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+00027050: 7072 696e 7428 6627 2020 7b66 6f6c 6465  print(f'  {folde
+00027060: 727d 202d 2053 697a 653a 207b 7369 7a65  r} - Size: {size
+00027070: 7d20 4769 4227 290a 0a20 2020 2020 2020  } GiB')..       
+00027080: 2074 6f74 616c 7370 6163 6520 3d20 7375   totalspace = su
+00027090: 6d28 6974 656d 5b33 5d20 666f 7220 6974  m(item[3] for it
+000270a0: 656d 2069 6e20 726f 7773 290a 2020 2020  em in rows).    
+000270b0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+000270c0: 2020 2020 2020 2066 275c 6e54 6f74 616c         f'\nTotal
+000270d0: 2073 7061 6365 2074 6f20 6172 6368 6976   space to archiv
+000270e0: 653a 207b 666f 726d 6174 2872 6f75 6e64  e: {format(round
+000270f0: 2874 6f74 616c 7370 6163 652c 2033 292c  (totalspace, 3),
+00027100: 222c 2229 7d20 4769 425c 6e27 290a 0a20  ",")} GiB\n').. 
+00027110: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+00027120: 6f6e 6c79 2074 6865 2066 6f6c 6465 7273  only the folders
+00027130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00027140: 5b66 6f6c 6465 7220 666f 7220 666f 6c64  [folder for fold
+00027150: 6572 2c20 7369 7a65 2069 6e20 666f 6c64  er, size in fold
+00027160: 6572 735f 746f 5f61 7263 6869 7665 5d0a  ers_to_archive].
+00027170: 0a20 2020 2064 6566 205f 6368 6563 6b5f  .    def _check_
+00027180: 7061 7468 5f70 6572 6d69 7373 696f 6e73  path_permissions
+00027190: 2873 656c 662c 2070 6174 6829 3a0a 2020  (self, path):.  
+000271a0: 2020 2020 2020 2727 2743 6865 636b 2069        '''Check i
+000271b0: 6620 7468 6520 7573 6572 2068 6173 2072  f the user has r
+000271c0: 6561 6420 616e 6420 7772 6974 6520 7065  ead and write pe
+000271d0: 726d 6973 7369 6f6e 7320 746f 2074 6865  rmissions to the
+000271e0: 2067 6976 656e 2070 6174 6827 2727 0a0a   given path'''..
+000271f0: 2020 2020 2020 2020 2320 4966 2070 6174          # If pat
+00027200: 6820 6973 2065 6d70 7479 2c20 7265 7475  h is empty, retu
+00027210: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00027220: 6966 206e 6f74 2070 6174 683a 0a20 2020  if not path:.   
+00027230: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00027240: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+00027250: 4765 7420 7061 7468 2070 6572 6d69 7373  Get path permiss
+00027260: 696f 6e73 0a20 2020 2020 2020 2063 616e  ions.        can
+00027270: 5f72 6561 6420 3d20 6f73 2e61 6363 6573  _read = os.acces
+00027280: 7328 7061 7468 2c20 6f73 2e52 5f4f 4b29  s(path, os.R_OK)
+00027290: 0a20 2020 2020 2020 2063 616e 5f77 7269  .        can_wri
+000272a0: 7465 203d 206f 732e 6163 6365 7373 2870  te = os.access(p
+000272b0: 6174 682c 206f 732e 575f 4f4b 290a 0a20  ath, os.W_OK).. 
+000272c0: 2020 2020 2020 2023 2050 7269 6e74 2065         # Print e
+000272d0: 7272 6f72 206d 6573 7361 6765 7320 6966  rror messages if
+000272e0: 2074 6865 2075 7365 7220 646f 6573 206e   the user does n
+000272f0: 6f74 2068 6176 6520 7265 6164 206f 7220  ot have read or 
+00027300: 7772 6974 6520 7065 726d 6973 7369 6f6e  write permission
+00027310: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+00027320: 2063 616e 5f72 6561 643a 0a20 2020 2020   can_read:.     
+00027330: 2020 2020 2020 2070 7269 6e74 2866 2243         print(f"C
+00027340: 616e 6e6f 7420 7265 6164 3a20 7b70 6174  annot read: {pat
+00027350: 687d 222c 2066 696c 653d 7379 732e 7374  h}", file=sys.st
+00027360: 6465 7272 290a 2020 2020 2020 2020 6966  derr).        if
+00027370: 206e 6f74 2063 616e 5f77 7269 7465 3a0a   not can_write:.
+00027380: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00027390: 7428 6622 4361 6e6e 6f74 2077 7269 7465  t(f"Cannot write
+000273a0: 3a20 7b70 6174 687d 222c 2066 696c 653d  : {path}", file=
+000273b0: 7379 732e 7374 6465 7272 290a 0a20 2020  sys.stderr)..   
+000273c0: 2020 2020 2023 2052 6574 7572 6e20 5472       # Return Tr
+000273d0: 7565 2069 6620 7468 6520 7573 6572 2068  ue if the user h
+000273e0: 6173 2072 6561 6420 616e 6420 7772 6974  as read and writ
+000273f0: 6520 7065 726d 6973 7369 6f6e 732c 206f  e permissions, o
+00027400: 7468 6572 7769 7365 2072 6574 7572 6e20  therwise return 
+00027410: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00027420: 7475 726e 2063 616e 5f72 6561 6420 616e  turn can_read an
+00027430: 6420 6361 6e5f 7772 6974 650a 0a20 2020  d can_write..   
+00027440: 2064 6566 205f 6973 5f63 6f72 7265 6374   def _is_correct
+00027450: 5f66 696c 6573 5f66 6f6c 6465 7273 5f70  _files_folders_p
+00027460: 6572 6d69 7373 696f 6e73 2873 656c 662c  ermissions(self,
+00027470: 2066 6f6c 6465 7273 2c20 6973 5f72 6563   folders, is_rec
+00027480: 7572 7369 7665 3d46 616c 7365 293a 0a20  ursive=False):. 
+00027490: 2020 2020 2020 2027 2727 4368 6563 6b20         '''Check 
+000274a0: 6966 2074 6865 2075 7365 7220 6861 7320  if the user has 
+000274b0: 7265 6164 2061 6e64 2077 7269 7465 2070  read and write p
+000274c0: 6572 6d69 7373 696f 6e73 2074 6f20 7468  ermissions to th
+000274d0: 6520 6769 7665 6e20 666f 6c64 6572 7327  e given folders'
+000274e0: 2727 0a0a 2020 2020 2020 2020 636f 7272  ''..        corr
+000274f0: 6563 745f 7065 726d 6973 7369 6f6e 7320  ect_permissions 
+00027500: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00027510: 7472 793a 0a0a 2020 2020 2020 2020 2020  try:..          
+00027520: 2020 666f 7220 666f 6c64 6572 2069 6e20    for folder in 
+00027530: 666f 6c64 6572 733a 0a0a 2020 2020 2020  folders:..      
+00027540: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00027550: 206f 732e 7061 7468 2e69 7364 6972 2866   os.path.isdir(f
+00027560: 6f6c 6465 7229 3a0a 2020 2020 2020 2020  older):.        
+00027570: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00027580: 7428 6622 4572 726f 723a 207b 666f 6c64  t(f"Error: {fold
+00027590: 6572 7d20 6973 206e 6f74 2061 2064 6972  er} is not a dir
+000275a0: 6563 746f 7279 2e22 2c0a 2020 2020 2020  ectory.",.      
+000275b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000275c0: 2020 2020 6669 6c65 3d73 7973 2e73 7464      file=sys.std
+000275d0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+000275e0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+000275f0: 7428 3129 0a0a 2020 2020 2020 2020 2020  t(1)..          
+00027600: 2020 2020 2020 6966 2069 735f 7265 6375        if is_recu
+00027610: 7273 6976 653a 0a0a 2020 2020 2020 2020  rsive:..        
+00027620: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+00027630: 6375 7273 6976 6520 666c 6167 2073 6574  cursive flag set
+00027640: 2c20 7573 696e 6720 6f73 2e77 616c 6b20  , using os.walk 
+00027650: 746f 2067 6574 2061 6c6c 2066 696c 6573  to get all files
+00027660: 2061 6e64 2066 6f6c 6465 7273 0a0a 2020   and folders..  
+00027670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027680: 2020 666f 7220 726f 6f74 2c20 6469 7273    for root, dirs
+00027690: 2c20 6669 6c65 7320 696e 206f 732e 7761  , files in os.wa
+000276a0: 6c6b 2866 6f6c 6465 722c 2074 6f70 646f  lk(folder, topdo
+000276b0: 776e 3d54 7275 6529 3a0a 0a20 2020 2020  wn=True):..     
+000276c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276d0: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
+000276e0: 6520 7573 6572 2068 6173 2072 6561 6420  e user has read 
+000276f0: 616e 6420 7772 6974 6520 7065 726d 6973  and write permis
+00027700: 7369 6f6e 7320 746f 2074 6865 2072 6f6f  sions to the roo
+00027710: 7420 666f 6c64 6572 0a20 2020 2020 2020  t folder.       
+00027720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027730: 2069 6620 6e6f 7420 7365 6c66 2e5f 6368   if not self._ch
+00027740: 6563 6b5f 7061 7468 5f70 6572 6d69 7373  eck_path_permiss
+00027750: 696f 6e73 2872 6f6f 7429 3a0a 2020 2020  ions(root):.    
+00027760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027770: 2020 2020 2020 2020 636f 7272 6563 745f          correct_
+00027780: 7065 726d 6973 7369 6f6e 7320 3d20 4661  permissions = Fa
+00027790: 6c73 650a 0a20 2020 2020 2020 2020 2020  lse..           
+000277a0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+000277b0: 6865 636b 2069 6620 7468 6520 7573 6572  heck if the user
+000277c0: 2068 6173 2072 6561 6420 616e 6420 7772   has read and wr
+000277d0: 6974 6520 7065 726d 6973 7369 6f6e 7320  ite permissions 
+000277e0: 746f 2061 6c6c 2073 7562 666f 6c64 6572  to all subfolder
+000277f0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00027800: 2020 2020 2020 2020 2020 666f 7220 6420            for d 
+00027810: 696e 2064 6972 733a 0a20 2020 2020 2020  in dirs:.       
+00027820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027830: 2020 2020 2064 5f70 6174 6820 3d20 6f73       d_path = os
+00027840: 2e70 6174 682e 6a6f 696e 2872 6f6f 742c  .path.join(root,
+00027850: 2064 290a 2020 2020 2020 2020 2020 2020   d).            
+00027860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027870: 6966 206e 6f74 2073 656c 662e 5f63 6865  if not self._che
+00027880: 636b 5f70 6174 685f 7065 726d 6973 7369  ck_path_permissi
+00027890: 6f6e 7328 645f 7061 7468 293a 0a20 2020  ons(d_path):.   
+000278a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278b0: 2020 2020 2020 2020 2020 2020 2063 6f72               cor
+000278c0: 7265 6374 5f70 6572 6d69 7373 696f 6e73  rect_permissions
+000278d0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+000278e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278f0: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
+00027900: 2075 7365 7220 6861 7320 7265 6164 2061   user has read a
+00027910: 6e64 2077 7269 7465 2070 6572 6d69 7373  nd write permiss
+00027920: 696f 6e73 2074 6f20 616c 6c20 6669 6c65  ions to all file
+00027930: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00027940: 2020 2020 2020 2020 2020 666f 7220 6620            for f 
+00027950: 696e 2066 696c 6573 3a0a 2020 2020 2020  in files:.      
+00027960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027970: 2020 2020 2020 665f 7061 7468 203d 206f        f_path = o
+00027980: 732e 7061 7468 2e6a 6f69 6e28 726f 6f74  s.path.join(root
+00027990: 2c20 6629 0a20 2020 2020 2020 2020 2020  , f).           
+000279a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279b0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6368   if not self._ch
+000279c0: 6563 6b5f 7061 7468 5f70 6572 6d69 7373  eck_path_permiss
+000279d0: 696f 6e73 2866 5f70 6174 6829 3a0a 2020  ions(f_path):.  
+000279e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00027a00: 7272 6563 745f 7065 726d 6973 7369 6f6e  rrect_permission
+00027a10: 7320 3d20 4661 6c73 650a 2020 2020 2020  s = False.      
+00027a20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00027a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027a40: 2020 2020 2023 2052 6563 7572 7369 7665       # Recursive
+00027a50: 2066 6c61 6720 6e6f 7420 7365 742c 2075   flag not set, u
+00027a60: 7369 6e67 206f 732e 6c69 7374 6469 7220  sing os.listdir 
+00027a70: 746f 2067 6574 2061 6e64 2063 6865 636b  to get and check
+00027a80: 2061 6c6c 2066 696c 6573 0a20 2020 2020   all files.     
+00027a90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00027aa0: 6f72 2066 2069 6e20 6f73 2e6c 6973 7464  or f in os.listd
+00027ab0: 6972 2866 6f6c 6465 7229 3a0a 2020 2020  ir(folder):.    
+00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ad0: 2020 2020 6669 6c65 5f70 6174 6820 3d20      file_path = 
+00027ae0: 6f73 2e70 6174 682e 6a6f 696e 2866 6f6c  os.path.join(fol
+00027af0: 6465 722c 2066 290a 2020 2020 2020 2020  der, f).        
+00027b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b10: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+00027b20: 6528 6669 6c65 5f70 6174 6829 3a0a 2020  e(file_path):.  
+00027b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b40: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00027b50: 2073 656c 662e 5f63 6865 636b 5f70 6174   self._check_pat
+00027b60: 685f 7065 726d 6973 7369 6f6e 7328 6669  h_permissions(fi
+00027b70: 6c65 5f70 6174 6829 3a0a 2020 2020 2020  le_path):.      
+00027b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b90: 2020 2020 2020 2020 2020 636f 7272 6563            correc
+00027ba0: 745f 7065 726d 6973 7369 6f6e 7320 3d20  t_permissions = 
+00027bb0: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00027bc0: 2020 2072 6574 7572 6e20 636f 7272 6563     return correc
+00027bd0: 745f 7065 726d 6973 7369 6f6e 730a 0a20  t_permissions.. 
+00027be0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00027bf0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00027c00: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00027c10: 650a 0a20 2020 2064 6566 2067 6574 5f75  e..    def get_u
+00027c20: 7365 725f 686f 7473 706f 7428 7365 6c66  ser_hotspot(self
+00027c30: 2c20 686f 7473 706f 745f 6373 7629 3a0a  , hotspot_csv):.
+00027c40: 2020 2020 2020 2020 2727 2752 6564 7563          '''Reduc
+00027c50: 6520 6120 686f 7473 706f 7473 2066 696c  e a hotspots fil
+00027c60: 6520 746f 2074 6865 2066 6f6c 6465 7273  e to the folders
+00027c70: 2074 6861 7420 7468 6520 7573 6572 2068   that the user h
+00027c80: 6173 2077 7269 7465 2061 6363 6573 7320  as write access 
+00027c90: 746f 2727 270a 2020 2020 2020 2020 7472  to'''.        tr
+00027ca0: 793a 0a20 2020 2020 2020 2020 2020 2068  y:.            h
+00027cb0: 7364 6972 2c20 6873 6669 6c65 203d 206f  sdir, hsfile = o
+00027cc0: 732e 7061 7468 2e73 706c 6974 2868 6f74  s.path.split(hot
+00027cd0: 7370 6f74 5f63 7376 290a 2020 2020 2020  spot_csv).      
+00027ce0: 2020 2020 2020 6873 6469 7275 7365 7220        hsdiruser 
+00027cf0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2868  = os.path.join(h
+00027d00: 7364 6972 2c20 7365 6c66 2e63 6667 2e77  sdir, self.cfg.w
+00027d10: 686f 616d 6929 0a20 2020 2020 2020 2020  hoami).         
+00027d20: 2020 206f 732e 6d61 6b65 6469 7273 2868     os.makedirs(h
+00027d30: 7364 6972 7573 6572 2c20 6578 6973 745f  sdiruser, exist_
+00027d40: 6f6b 3d54 7275 652c 206d 6f64 653d 306f  ok=True, mode=0o
+00027d50: 3737 3529 0a20 2020 2020 2020 2020 2020  775).           
+00027d60: 2075 7365 725f 6373 7620 3d20 6f73 2e70   user_csv = os.p
+00027d70: 6174 682e 6a6f 696e 2868 7364 6972 7573  ath.join(hsdirus
+00027d80: 6572 2c20 6873 6669 6c65 290a 2020 2020  er, hsfile).    
+00027d90: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00027da0: 7468 2e65 7869 7374 7328 7573 6572 5f63  th.exists(user_c
+00027db0: 7376 293a 0a20 2020 2020 2020 2020 2020  sv):.           
+00027dc0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00027dd0: 6765 746d 7469 6d65 2875 7365 725f 6373  getmtime(user_cs
+00027de0: 7629 203e 206f 732e 7061 7468 2e67 6574  v) > os.path.get
+00027df0: 6d74 696d 6528 686f 7473 706f 745f 6373  mtime(hotspot_cs
+00027e00: 7629 3a0a 2020 2020 2020 2020 2020 2020  v):.            
+00027e10: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00027e20: 6622 4669 6c65 207b 7573 6572 5f63 7376  f"File {user_csv
+00027e30: 7d20 616c 7265 6164 7920 6578 6973 7473  } already exists
+00027e40: 2061 6e64 2069 7320 6e65 7765 7220 7468   and is newer th
+00027e50: 616e 207b 686f 7473 706f 745f 6373 767d  an {hotspot_csv}
+00027e60: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00027e70: 2020 2020 2020 2020 7265 7475 726e 2075          return u
+00027e80: 7365 725f 6373 760a 2020 2020 2020 2020  ser_csv.        
+00027e90: 2020 2020 7072 696e 7428 2746 696c 7465      print('Filte
+00027ea0: 7269 6e67 2068 6f74 7370 6f74 7320 666f  ring hotspots fo
+00027eb0: 7220 666f 6c64 6572 7320 7769 7468 2077  r folders with w
+00027ec0: 7269 7465 2070 6572 6d69 7373 696f 6e73  rite permissions
+00027ed0: 202e 2e2e 2729 0a20 2020 2020 2020 2020   ...').         
+00027ee0: 2020 2077 7269 7461 626c 655f 666f 6c64     writable_fold
+00027ef0: 6572 7320 3d20 5b5d 0a20 2020 2020 2020  ers = [].       
+00027f00: 2020 2020 2077 6974 6820 6f70 656e 2868       with open(h
+00027f10: 6f74 7370 6f74 5f63 7376 2c20 6d6f 6465  otspot_csv, mode
+00027f20: 3d27 7227 2c20 6e65 776c 696e 653d 2727  ='r', newline=''
+00027f30: 2920 6173 2066 696c 653a 0a20 2020 2020  ) as file:.     
+00027f40: 2020 2020 2020 2020 2020 2072 6561 6465             reade
+00027f50: 7220 3d20 6373 762e 4469 6374 5265 6164  r = csv.DictRead
+00027f60: 6572 2866 696c 6529 0a20 2020 2020 2020  er(file).       
+00027f70: 2020 2020 2020 2020 206d 796c 656e 203d           mylen =
+00027f80: 2073 756d 2831 2066 6f72 2072 6f77 2069   sum(1 for row i
+00027f90: 6e20 7265 6164 6572 290a 2020 2020 2020  n reader).      
+00027fa0: 2020 2020 2020 2020 2020 6669 6c65 2e73            file.s
+00027fb0: 6565 6b28 3029 0a20 2020 2020 2020 2020  eek(0).         
+00027fc0: 2020 2020 2020 2072 6561 6465 7220 3d20         reader = 
+00027fd0: 6373 762e 4469 6374 5265 6164 6572 2866  csv.DictReader(f
+00027fe0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00027ff0: 2020 2020 2070 726f 6772 6573 7320 3d20       progress = 
+00028000: 7365 6c66 2e5f 6372 6561 7465 5f70 726f  self._create_pro
+00028010: 6772 6573 735f 6261 7228 6d79 6c65 6e2b  gress_bar(mylen+
+00028020: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00028030: 2020 2066 6f72 2072 6f77 2069 6e20 7265     for row in re
+00028040: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00028050: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+00028060: 7365 6c66 2e74 6573 745f 7772 6974 6528  self.test_write(
+00028070: 726f 775b 2746 6f6c 6465 7227 5d29 0a20  row['Folder']). 
+00028080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028090: 2020 2069 6620 7265 7420 213d 2031 3320     if ret != 13 
+000280a0: 616e 6420 7265 7420 213d 2032 3a0a 2020  and ret != 2:.  
+000280b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280c0: 2020 2020 2020 7772 6974 6162 6c65 5f66        writable_f
+000280d0: 6f6c 6465 7273 2e61 7070 656e 6428 726f  olders.append(ro
+000280e0: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
+000280f0: 2020 2020 2020 2070 726f 6772 6573 7328         progress(
+00028100: 7265 6164 6572 2e6c 696e 655f 6e75 6d29  reader.line_num)
+00028110: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00028120: 6820 6f70 656e 2875 7365 725f 6373 762c  h open(user_csv,
+00028130: 206d 6f64 653d 2777 272c 206e 6577 6c69   mode='w', newli
+00028140: 6e65 3d27 2729 2061 7320 6669 6c65 3a0a  ne='') as file:.
+00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028160: 7772 6974 6572 203d 2063 7376 2e44 6963  writer = csv.Dic
+00028170: 7457 7269 7465 7228 6669 6c65 2c20 6669  tWriter(file, fi
+00028180: 656c 646e 616d 6573 3d72 6561 6465 722e  eldnames=reader.
+00028190: 6669 656c 646e 616d 6573 290a 2020 2020  fieldnames).    
+000281a0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+000281b0: 6572 2e77 7269 7465 6865 6164 6572 2829  er.writeheader()
+000281c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000281d0: 2077 7269 7465 722e 7772 6974 6572 6f77   writer.writerow
+000281e0: 7328 7772 6974 6162 6c65 5f66 6f6c 6465  s(writable_folde
+000281f0: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00028200: 7265 7475 726e 2075 7365 725f 6373 760a  return user_csv.
+00028210: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00028220: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00028230: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00028240: 2866 225c 6e45 7272 6f72 2069 6e20 6765  (f"\nError in ge
+00028250: 745f 7573 6572 5f68 6f74 7370 6f74 3a20  t_user_hotspot: 
+00028260: 7b65 7d5c 6e22 290a 2020 2020 2020 2020  {e}\n").        
+00028270: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00028280: 0a20 2020 2064 6566 205f 6372 6561 7465  .    def _create
+00028290: 5f70 726f 6772 6573 735f 6261 7228 7365  _progress_bar(se
+000282a0: 6c66 2c20 6d61 785f 7661 6c75 6529 3a0a  lf, max_value):.
+000282b0: 2020 2020 2020 2020 6465 6620 7368 6f77          def show
+000282c0: 5f70 726f 6772 6573 735f 6261 7228 6974  _progress_bar(it
+000282d0: 6572 6174 696f 6e29 3a0a 2020 2020 2020  eration):.      
+000282e0: 2020 2020 2020 7065 7263 656e 7420 3d20        percent = 
+000282f0: 2822 7b30 3a2e 3166 7d22 292e 666f 726d  ("{0:.1f}").form
+00028300: 6174 2831 3030 202a 2028 6974 6572 6174  at(100 * (iterat
+00028310: 696f 6e20 2f20 666c 6f61 7428 6d61 785f  ion / float(max_
+00028320: 7661 6c75 6529 2929 0a20 2020 2020 2020  value))).       
+00028330: 2020 2020 206c 656e 6774 6820 3d20 3530       length = 50
+00028340: 2020 2320 6164 6a75 7374 2061 7320 6e65    # adjust as ne
+00028350: 6564 6564 2066 6f72 2074 6865 2062 6172  eded for the bar
+00028360: 206c 656e 6774 680a 2020 2020 2020 2020   length.        
+00028370: 2020 2020 6669 6c6c 6564 5f6c 656e 6774      filled_lengt
+00028380: 6820 3d20 696e 7428 6c65 6e67 7468 202a  h = int(length *
+00028390: 2069 7465 7261 7469 6f6e 202f 2f20 6d61   iteration // ma
+000283a0: 785f 7661 6c75 6529 0a20 2020 2020 2020  x_value).       
+000283b0: 2020 2020 2062 6172 203d 2022 e296 8822       bar = "..."
+000283c0: 202a 2066 696c 6c65 645f 6c65 6e67 7468   * filled_length
+000283d0: 202b 2027 2d27 202a 2028 6c65 6e67 7468   + '-' * (length
+000283e0: 202d 2066 696c 6c65 645f 6c65 6e67 7468   - filled_length
+000283f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00028400: 2073 7973 2e73 7464 696e 2e69 7361 7474   sys.stdin.isatt
+00028410: 7928 293a 0a20 2020 2020 2020 2020 2020  y():.           
+00028420: 2020 2020 2070 7269 6e74 2866 275c 727c       print(f'\r|
+00028430: 7b62 6172 7d7c 207b 7065 7263 656e 747d  {bar}| {percent}
+00028440: 2527 2c20 656e 643d 275c 7227 290a 2020  %', end='\r').  
+00028450: 2020 2020 2020 2020 2020 6966 2069 7465            if ite
+00028460: 7261 7469 6f6e 203d 3d20 6d61 785f 7661  ration == max_va
+00028470: 6c75 653a 0a20 2020 2020 2020 2020 2020  lue:.           
+00028480: 2020 2020 2070 7269 6e74 2829 0a20 2020       print().   
+00028490: 2020 2020 2072 6574 7572 6e20 7368 6f77       return show
+000284a0: 5f70 726f 6772 6573 735f 6261 720a 0a20  _progress_bar.. 
+000284b0: 2020 2064 6566 2070 7269 6e74 5f70 6174     def print_pat
+000284c0: 6873 5f72 775f 696e 666f 2873 656c 662c  hs_rw_info(self,
+000284d0: 2070 6174 6873 293a 0a0a 2020 2020 2020   paths):..      
+000284e0: 2020 6966 206e 6f74 2070 6174 6873 3a0a    if not paths:.
+000284f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00028500: 7428 275c 6e45 7272 6f72 3a20 4e6f 2066  t('\nError: No f
+00028510: 696c 6520 7061 7468 7320 7072 6f76 6964  ile paths provid
+00028520: 6564 2e5c 6e27 2c20 6669 6c65 3d73 7973  ed.\n', file=sys
+00028530: 2e73 7464 6572 7229 0a20 2020 2020 2020  .stderr).       
+00028540: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00028550: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
+00028560: 2070 6174 6873 3a0a 0a20 2020 2020 2020   paths:..       
+00028570: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+00028580: 6669 6c65 2065 7869 7374 730a 2020 2020  file exists.    
+00028590: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+000285a0: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
+000285b0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+000285c0: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+000285d0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+000285e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285f0: 2320 4765 7474 696e 6720 7468 6520 7374  # Getting the st
+00028600: 6174 7573 206f 6620 7468 6520 6669 6c65  atus of the file
+00028610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028620: 2066 696c 655f 7374 6174 203d 206f 732e   file_stat = os.
+00028630: 6c73 7461 7428 7061 7468 290a 0a20 2020  lstat(path)..   
+00028640: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+00028650: 6574 7469 6e67 2074 6865 2063 7572 7265  etting the curre
+00028660: 6e74 2075 7365 7220 616e 6420 6772 6f75  nt user and grou
+00028670: 7020 4944 730a 2020 2020 2020 2020 2020  p IDs.          
+00028680: 2020 2020 2020 6375 7272 656e 745f 7569        current_ui
+00028690: 6420 3d20 6f73 2e67 6574 7569 6428 290a  d = os.getuid().
+000286a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000286b0: 6375 7272 656e 745f 6769 6420 3d20 6f73  current_gid = os
+000286c0: 2e67 6574 6769 6428 290a 0a20 2020 2020  .getgid()..     
+000286d0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000286e0: 636b 696e 6720 6966 2074 6865 2075 7365  cking if the use
+000286f0: 7220 6973 2074 6865 206f 776e 6572 0a20  r is the owner. 
+00028700: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00028710: 735f 6f77 6e65 7220 3d20 6669 6c65 5f73  s_owner = file_s
+00028720: 7461 742e 7374 5f75 6964 203d 3d20 6375  tat.st_uid == cu
+00028730: 7272 656e 745f 7569 640a 0a20 2020 2020  rrent_uid..     
+00028740: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00028750: 636b 696e 6720 6966 2074 6865 2075 7365  cking if the use
+00028760: 7220 6973 2069 6e20 7468 6520 6669 6c65  r is in the file
+00028770: 2773 2067 726f 7570 0a20 2020 2020 2020  's group.       
+00028780: 2020 2020 2020 2020 2069 735f 6772 6f75           is_grou
+00028790: 705f 6d65 6d62 6572 203d 2066 696c 655f  p_member = file_
+000287a0: 7374 6174 2e73 745f 6769 6420 3d3d 2063  stat.st_gid == c
+000287b0: 7572 7265 6e74 5f67 6964 206f 7220 5c0a  urrent_gid or \.
+000287c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287d0: 2020 2020 616e 7928 6772 702e 6765 7467      any(grp.getg
+000287e0: 7267 6964 2867 292e 6772 5f67 6964 203d  rgid(g).gr_gid =
+000287f0: 3d0a 2020 2020 2020 2020 2020 2020 2020  =.              
+00028800: 2020 2020 2020 2020 2020 6669 6c65 5f73            file_s
+00028810: 7461 742e 7374 5f67 6964 2066 6f72 2067  tat.st_gid for g
+00028820: 2069 6e20 6f73 2e67 6574 6772 6f75 7073   in os.getgroups
+00028830: 2829 290a 0a20 2020 2020 2020 2020 2020  ())..           
+00028840: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00028850: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00028860: 2020 2020 2020 2020 7072 696e 745f 6572          print_er
+00028870: 726f 7228 290a 2020 2020 2020 2020 2020  ror().          
+00028880: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00028890: 2020 2020 2020 2020 2020 2320 4578 7472            # Extr
+000288a0: 6163 7469 6e67 2070 6572 6d69 7373 696f  acting permissio
+000288b0: 6e20 6269 7473 0a20 2020 2020 2020 2020  n bits.         
+000288c0: 2020 2070 6572 6d69 7373 696f 6e73 203d     permissions =
+000288d0: 2066 696c 655f 7374 6174 2e73 745f 6d6f   file_stat.st_mo
+000288e0: 6465 0a0a 2020 2020 2020 2020 2020 2020  de..            
+000288f0: 2320 4368 6563 6b69 6e67 2066 6f72 206f  # Checking for o
+00028900: 776e 6572 2072 6561 6420 7065 726d 6973  wner read permis
+00028910: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+00028920: 2068 6173 5f6f 776e 6572 5f72 6561 645f   has_owner_read_
+00028930: 7065 726d 6973 7369 6f6e 203d 2062 6f6f  permission = boo
+00028940: 6c28 7065 726d 6973 7369 6f6e 7320 2620  l(permissions & 
+00028950: 7374 6174 2e53 5f49 5255 5352 290a 0a20  stat.S_IRUSR).. 
+00028960: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00028970: 636b 696e 6720 666f 7220 6772 6f75 7020  cking for group 
+00028980: 7265 6164 2070 6572 6d69 7373 696f 6e0a  read permission.
+00028990: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+000289a0: 6772 6f75 705f 7265 6164 5f70 6572 6d69  group_read_permi
+000289b0: 7373 696f 6e20 3d20 626f 6f6c 2870 6572  ssion = bool(per
+000289c0: 6d69 7373 696f 6e73 2026 2073 7461 742e  missions & stat.
+000289d0: 535f 4952 4752 5029 0a0a 2020 2020 2020  S_IRGRP)..      
+000289e0: 2020 2020 2020 2320 4368 6563 6b69 6e67        # Checking
+000289f0: 2066 6f72 2027 3434 3427 2028 7265 6164   for '444' (read
+00028a00: 2070 6572 6d69 7373 696f 6e20 666f 7220   permission for 
+00028a10: 6576 6572 796f 6e65 290a 2020 2020 2020  everyone).      
+00028a20: 2020 2020 2020 6973 5f34 3434 203d 2070        is_444 = p
+00028a30: 6572 6d69 7373 696f 6e73 2026 2030 6f34  ermissions & 0o4
+00028a40: 3434 203d 3d20 306f 3434 340a 0a20 2020  44 == 0o444..   
+00028a50: 2020 2020 2020 2020 2023 2044 6574 6572           # Deter
+00028a60: 6d69 6e69 6e67 2069 6620 7468 6520 7573  mining if the us
+00028a70: 6572 2063 616e 2072 6561 6420 7468 6520  er can read the 
+00028a80: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00028a90: 2063 616e 5f72 6561 6420 3d20 2869 735f   can_read = (is_
+00028aa0: 6f77 6e65 7220 616e 6420 6861 735f 6f77  owner and has_ow
+00028ab0: 6e65 725f 7265 6164 5f70 6572 6d69 7373  ner_read_permiss
+00028ac0: 696f 6e29 206f 7220 5c0a 2020 2020 2020  ion) or \.      
+00028ad0: 2020 2020 2020 2020 2020 2869 735f 6772            (is_gr
+00028ae0: 6f75 705f 6d65 6d62 6572 2061 6e64 2068  oup_member and h
+00028af0: 6173 5f67 726f 7570 5f72 6561 645f 7065  as_group_read_pe
+00028b00: 726d 6973 7369 6f6e 2920 6f72 205c 0a20  rmission) or \. 
+00028b10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00028b20: 735f 3434 340a 0a20 2020 2020 2020 2020  s_444..         
+00028b30: 2020 2023 2043 6865 636b 696e 6720 666f     # Checking fo
+00028b40: 7220 6f77 6e65 7220 7772 6974 6520 7065  r owner write pe
+00028b50: 726d 6973 7369 6f6e 0a20 2020 2020 2020  rmission.       
+00028b60: 2020 2020 2068 6173 5f6f 776e 6572 5f77       has_owner_w
+00028b70: 7269 7465 5f70 6572 6d69 7373 696f 6e20  rite_permission 
+00028b80: 3d20 626f 6f6c 2870 6572 6d69 7373 696f  = bool(permissio
+00028b90: 6e73 2026 2073 7461 742e 535f 4957 5553  ns & stat.S_IWUS
+00028ba0: 5229 0a0a 2020 2020 2020 2020 2020 2020  R)..            
+00028bb0: 2320 4368 6563 6b69 6e67 2066 6f72 2067  # Checking for g
+00028bc0: 726f 7570 2077 7269 7465 2070 6572 6d69  roup write permi
+00028bd0: 7373 696f 6e0a 2020 2020 2020 2020 2020  ssion.          
+00028be0: 2020 6861 735f 6772 6f75 705f 7772 6974    has_group_writ
+00028bf0: 655f 7065 726d 6973 7369 6f6e 203d 2062  e_permission = b
+00028c00: 6f6f 6c28 7065 726d 6973 7369 6f6e 7320  ool(permissions 
+00028c10: 2620 7374 6174 2e53 5f49 5747 5250 290a  & stat.S_IWGRP).
+00028c20: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00028c30: 6865 636b 696e 6720 666f 7220 2736 3636  hecking for '666
+00028c40: 2720 6f72 2027 3737 3727 2070 6572 6d69  ' or '777' permi
+00028c50: 7373 696f 6e73 0a20 2020 2020 2020 2020  ssions.         
+00028c60: 2020 2069 735f 3636 365f 6f72 5f37 3737     is_666_or_777
+00028c70: 203d 2070 6572 6d69 7373 696f 6e73 2026   = permissions &
+00028c80: 2030 6f36 3636 203d 3d20 306f 3636 3620   0o666 == 0o666 
+00028c90: 6f72 2070 6572 6d69 7373 696f 6e73 2026  or permissions &
+00028ca0: 2030 6f37 3737 203d 3d20 306f 3737 370a   0o777 == 0o777.
+00028cb0: 0a20 2020 2020 2020 2020 2020 2023 2044  .            # D
+00028cc0: 6574 6572 6d69 6e69 6e67 2069 6620 7468  etermining if th
+00028cd0: 6520 7573 6572 2063 616e 2064 656c 6574  e user can delet
+00028ce0: 6520 7468 6520 6669 6c65 0a20 2020 2020  e the file.     
+00028cf0: 2020 2020 2020 2063 616e 5f77 7269 7465         can_write
+00028d00: 203d 2028 6973 5f6f 776e 6572 2061 6e64   = (is_owner and
+00028d10: 2068 6173 5f6f 776e 6572 5f77 7269 7465   has_owner_write
+00028d20: 5f70 6572 6d69 7373 696f 6e29 206f 7220  _permission) or 
+00028d30: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00028d40: 2020 2020 2020 2020 2020 2869 735f 6772            (is_gr
+00028d50: 6f75 705f 6d65 6d62 6572 2061 6e64 2068  oup_member and h
+00028d60: 6173 5f67 726f 7570 5f77 7269 7465 5f70  as_group_write_p
+00028d70: 6572 6d69 7373 696f 6e29 206f 7220 5c0a  ermission) or \.
+00028d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028d90: 6973 5f36 3636 5f6f 725f 3737 370a 0a20  is_666_or_777.. 
+00028da0: 2020 2020 2020 2020 2020 2023 2050 7269             # Pri
+00028db0: 6e74 696e 6720 7468 6520 6669 6c65 2773  nting the file's
+00028dc0: 2070 6572 6d69 7373 696f 6e73 0a20 2020   permissions.   
+00028dd0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00028de0: 275c 6e46 696c 653a 207b 7061 7468 7d27  '\nFile: {path}'
+00028df0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00028e00: 696e 7428 6627 5c6e 6973 5f6f 776e 6572  int(f'\nis_owner
+00028e10: 3a20 7b69 735f 6f77 6e65 727d 2729 0a20  : {is_owner}'). 
+00028e20: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00028e30: 2866 2768 6173 5f6f 776e 6572 5f72 6561  (f'has_owner_rea
+00028e40: 645f 7065 726d 6973 7369 6f6e 3a20 7b68  d_permission: {h
+00028e50: 6173 5f6f 776e 6572 5f72 6561 645f 7065  as_owner_read_pe
+00028e60: 726d 6973 7369 6f6e 7d27 290a 2020 2020  rmission}').    
+00028e70: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+00028e80: 6861 735f 6f77 6e65 725f 7772 6974 655f  has_owner_write_
+00028e90: 7065 726d 6973 7369 6f6e 3a20 7b68 6173  permission: {has
+00028ea0: 5f6f 776e 6572 5f77 7269 7465 5f70 6572  _owner_write_per
+00028eb0: 6d69 7373 696f 6e7d 2729 0a20 2020 2020  mission}').     
+00028ec0: 2020 2020 2020 2070 7269 6e74 2866 275c         print(f'\
+00028ed0: 6e69 735f 6772 6f75 705f 6d65 6d62 6572  nis_group_member
+00028ee0: 3a20 7b69 735f 6772 6f75 705f 6d65 6d62  : {is_group_memb
+00028ef0: 6572 7d27 290a 2020 2020 2020 2020 2020  er}').          
+00028f00: 2020 7072 696e 7428 6627 6861 735f 6772    print(f'has_gr
+00028f10: 6f75 705f 7265 6164 5f70 6572 6d69 7373  oup_read_permiss
+00028f20: 696f 6e3a 207b 6861 735f 6772 6f75 705f  ion: {has_group_
+00028f30: 7265 6164 5f70 6572 6d69 7373 696f 6e7d  read_permission}
+00028f40: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+00028f50: 7269 6e74 2866 2768 6173 5f67 726f 7570  rint(f'has_group
+00028f60: 5f77 7269 7465 5f70 6572 6d69 7373 696f  _write_permissio
+00028f70: 6e3a 207b 6861 735f 6772 6f75 705f 7772  n: {has_group_wr
+00028f80: 6974 655f 7065 726d 6973 7369 6f6e 7d27  ite_permission}'
+00028f90: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00028fa0: 696e 7428 6627 5c6e 6973 5f34 3434 3a20  int(f'\nis_444: 
+00028fb0: 7b69 735f 3434 347d 2729 0a20 2020 2020  {is_444}').     
+00028fc0: 2020 2020 2020 2070 7269 6e74 2866 2769         print(f'i
+00028fd0: 735f 3636 365f 6f72 5f37 3737 3a20 7b69  s_666_or_777: {i
+00028fe0: 735f 3636 365f 6f72 5f37 3737 7d27 290a  s_666_or_777}').
+00028ff0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00029000: 7428 6627 5c6e 6361 6e5f 7265 6164 3a20  t(f'\ncan_read: 
+00029010: 7b63 616e 5f72 6561 647d 2729 0a20 2020  {can_read}').   
+00029020: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00029030: 2763 616e 5f77 7269 7465 3a20 7b63 616e  'can_write: {can
+00029040: 5f77 7269 7465 7d5c 6e27 290a 0a20 2020  _write}\n')..   
+00029050: 2064 6566 205f 6765 6e5f 6d64 3573 756d   def _gen_md5sum
+00029060: 7328 7365 6c66 2c20 6469 7265 6374 6f72  s(self, director
+00029070: 792c 2068 6173 685f 6669 6c65 293a 0a20  y, hash_file):. 
+00029080: 2020 2020 2020 2027 2727 4765 6e65 7261         '''Genera
+00029090: 7465 206d 6435 7375 6d73 2066 6f72 2061  te md5sums for a
+000290a0: 6c6c 2066 696c 6573 2069 6e20 7468 6520  ll files in the 
+000290b0: 6469 7265 6374 6f72 7920 616e 6420 7772  directory and wr
+000290c0: 6974 6520 7468 656d 2074 6f20 6120 6861  ite them to a ha
+000290d0: 7368 2066 696c 6527 2727 0a0a 2020 2020  sh file'''..    
+000290e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000290f0: 2020 2020 2066 6f72 2072 6f6f 742c 2064       for root, d
+00029100: 6972 732c 2066 696c 6573 2069 6e20 7365  irs, files in se
+00029110: 6c66 2e5f 7761 6c6b 6572 2864 6972 6563  lf._walker(direc
+00029120: 746f 7279 293a 0a0a 2020 2020 2020 2020  tory):..        
+00029130: 2020 2020 2020 2020 2320 5765 206f 6e6c          # We onl
+00029140: 7920 7761 6e74 2074 6f20 6765 6e65 7261  y want to genera
+00029150: 7465 2074 6865 2068 6173 6820 6669 6c65  te the hash file
+00029160: 2069 6e20 7468 6520 726f 6f74 2064 6972   in the root dir
+00029170: 6563 746f 7279 2e20 4176 6f69 6420 7265  ectory. Avoid re
+00029180: 6375 7273 696f 6e0a 2020 2020 2020 2020  cursion.        
+00029190: 2020 2020 2020 2020 6966 2072 6f6f 7420          if root 
+000291a0: 213d 2064 6972 6563 746f 7279 3a0a 2020  != directory:.  
 000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291c0: 2020 2020 2744 6174 6127 3a20 7375 626a      'Data': subj
-000291d0: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
-000291e0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
-000291f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00029200: 426f 6479 273a 207b 0a20 2020 2020 2020  Body': {.       
-00029210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029220: 2027 5465 7874 273a 207b 0a20 2020 2020   'Text': {.     
-00029230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029240: 2020 2020 2020 2027 4461 7461 273a 2062         'Data': b
-00029250: 6f64 790a 2020 2020 2020 2020 2020 2020  ody.            
-00029260: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00029270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029280: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00029290: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000292a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000292b0: 7072 696e 7428 6627 5365 6e74 2065 6d61  print(f'Sent ema
-000292c0: 696c 2022 7b73 7562 6a65 6374 7d22 2074  il "{subject}" t
-000292d0: 6f20 7b74 6f7d 2127 290a 2020 2020 2020  o {to}!').      
-000292e0: 2020 6578 6365 7074 2062 6f74 6f63 6f72    except botocor
-000292f0: 652e 6578 6365 7074 696f 6e73 2e43 6c69  e.exceptions.Cli
-00029300: 656e 7445 7272 6f72 2061 7320 653a 0a20  entError as e:. 
-00029310: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00029320: 5f63 6f64 6520 3d20 652e 7265 7370 6f6e  _code = e.respon
-00029330: 7365 5b27 4572 726f 7227 5d5b 2743 6f64  se['Error']['Cod
-00029340: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00029350: 6966 2065 7272 6f72 5f63 6f64 6520 3d3d  if error_code ==
-00029360: 2027 4d65 7373 6167 6552 656a 6563 7465   'MessageRejecte
-00029370: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
-00029380: 2020 2020 7072 696e 7428 6627 4d65 7373      print(f'Mess
-00029390: 6167 6520 7761 7320 7265 6a65 6374 6564  age was rejected
-000293a0: 2c20 4572 726f 723a 207b 657d 2729 0a20  , Error: {e}'). 
-000293b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000293c0: 6572 726f 725f 636f 6465 203d 3d20 2741  error_code == 'A
-000293d0: 6363 6573 7344 656e 6965 6427 3a0a 2020  ccessDenied':.  
-000293e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000293f0: 696e 7464 6267 280a 2020 2020 2020 2020  intdbg(.        
-00029400: 2020 2020 2020 2020 2020 2020 6627 4163              f'Ac
-00029410: 6365 7373 2064 656e 6965 6420 746f 2053  cess denied to S
-00029420: 4553 2061 6476 616e 6365 6420 6665 6174  ES advanced feat
-00029430: 7572 6573 2120 506c 6561 7365 2063 6865  ures! Please che
-00029440: 636b 2079 6f75 7220 4941 4d20 7065 726d  ck your IAM perm
-00029450: 6973 7369 6f6e 732e 205c 6e45 7272 6f72  issions. \nError
-00029460: 3a20 7b65 7d27 290a 2020 2020 2020 2020  : {e}').        
-00029470: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00029480: 656c 662e 6172 6773 2e64 6562 7567 3a0a  elf.args.debug:.
-00029490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000294a0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+000291c0: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+000291d0: 2020 2020 2020 2020 2023 2042 7569 6c64           # Build
+000291e0: 2074 6865 2070 6174 6820 746f 2074 6865   the path to the
+000291f0: 2068 6173 6820 6669 6c65 0a20 2020 2020   hash file.     
+00029200: 2020 2020 2020 2020 2020 2068 6173 6870             hashp
+00029210: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
+00029220: 696e 2872 6f6f 742c 2068 6173 685f 6669  in(root, hash_fi
+00029230: 6c65 290a 0a20 2020 2020 2020 2020 2020  le)..           
+00029240: 2020 2020 2023 2053 6574 2074 6865 206e       # Set the n
+00029250: 756d 6265 7220 6f66 2077 6f72 6b65 7273  umber of workers
+00029260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029270: 206d 6178 5f77 6f72 6b65 7273 203d 206d   max_workers = m
+00029280: 6178 2834 2c20 696e 7428 7365 6c66 2e61  ax(4, int(self.a
+00029290: 7267 732e 636f 7265 7329 290a 0a20 2020  rgs.cores))..   
+000292a0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+000292b0: 6820 6f70 656e 2868 6173 6870 6174 682c  h open(hashpath,
+000292c0: 2022 7722 2920 6173 206f 7574 5f66 3a0a   "w") as out_f:.
+000292d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292e0: 2020 2020 7769 7468 2063 6f6e 6375 7272      with concurr
+000292f0: 656e 742e 6675 7475 7265 732e 5468 7265  ent.futures.Thre
+00029300: 6164 506f 6f6c 4578 6563 7574 6f72 286d  adPoolExecutor(m
+00029310: 6178 5f77 6f72 6b65 7273 3d6d 6178 5f77  ax_workers=max_w
+00029320: 6f72 6b65 7273 2920 6173 2065 7865 6375  orkers) as execu
+00029330: 746f 723a 0a0a 2020 2020 2020 2020 2020  tor:..          
+00029340: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00029350: 736b 7320 3d20 7b7d 0a0a 2020 2020 2020  sks = {}..      
+00029360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029370: 2020 666f 7220 6669 6c65 2069 6e20 6669    for file in fi
+00029380: 6c65 733a 0a0a 2020 2020 2020 2020 2020  les:..          
+00029390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000293a0: 2020 2320 4765 7420 7468 6520 6669 6c65    # Get the file
+000293b0: 2070 6174 680a 2020 2020 2020 2020 2020   path.          
+000293c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000293d0: 2020 6669 6c65 5f70 6174 6820 3d20 6f73    file_path = os
+000293e0: 2e70 6174 682e 6a6f 696e 2872 6f6f 742c  .path.join(root,
+000293f0: 2066 696c 6529 0a0a 2020 2020 2020 2020   file)..        
+00029400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029410: 2020 2020 2320 536b 6970 2066 726f 7374      # Skip frost
+00029420: 6572 2066 696c 6573 0a20 2020 2020 2020  er files.       
+00029430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029440: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00029450: 6973 6669 6c65 2866 696c 655f 7061 7468  isfile(file_path
+00029460: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+00029470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029480: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00029490: 2021 3d20 6861 7368 5f66 696c 6520 616e   != hash_file an
+000294a0: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
 000294b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000294c0: 2020 2027 2043 616e 6e6f 7420 7573 6520     ' Cannot use 
-000294d0: 5345 5320 656d 6169 6c20 6665 6174 7572  SES email featur
-000294e0: 6573 2074 6f20 7365 6e64 2079 6f75 2073  es to send you s
-000294f0: 7461 7475 7320 6d65 7373 6167 6573 3a20  tatus messages: 
-00029500: 4163 6365 7373 4465 6e69 6564 2729 0a20  AccessDenied'). 
-00029510: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00029520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029530: 2070 7269 6e74 2866 2743 6c69 656e 7420   print(f'Client 
-00029540: 4572 726f 723a 207b 657d 2729 0a20 2020  Error: {e}').   
-00029550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00029560: 4661 6c73 650a 2020 2020 2020 2020 6578  False.        ex
-00029570: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00029580: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00029590: 2070 7269 6e74 2866 274f 7468 6572 2045   print(f'Other E
-000295a0: 7272 6f72 3a20 7b65 7d27 290a 2020 2020  rror: {e}').    
-000295b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000295c0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-000295d0: 7572 6e20 5472 7565 0a0a 2020 2020 2020  urn True..      
-000295e0: 2020 2320 5468 6520 6265 6c6f 7720 4149    # The below AI
-000295f0: 4d20 706f 6c69 6379 2069 7320 6e65 6564  M policy is need
-00029600: 6564 2069 6620 796f 7520 646f 206e 6f74  ed if you do not
-00029610: 2077 616e 7420 746f 2063 6f6e 6669 726d   want to confirm
-00029620: 0a20 2020 2020 2020 2023 2065 6163 6820  .        # each 
-00029630: 616e 6420 6576 6572 7920 656d 6169 6c20  and every email 
-00029640: 796f 7520 7761 6e74 2074 6f20 7365 6e64  you want to send
-00029650: 2074 6f2e 0a0a 2020 2020 2020 2020 2320   to...        # 
-00029660: 6961 6d20 3d20 626f 746f 332e 636c 6965  iam = boto3.clie
-00029670: 6e74 2827 6961 6d27 290a 2020 2020 2020  nt('iam').      
-00029680: 2020 2320 706f 6c69 6379 5f64 6f63 756d    # policy_docum
-00029690: 656e 7420 3d20 7b0a 2020 2020 2020 2020  ent = {.        
-000296a0: 2320 2020 2020 2256 6572 7369 6f6e 223a  #     "Version":
-000296b0: 2022 3230 3132 2d31 302d 3137 222c 0a20   "2012-10-17",. 
-000296c0: 2020 2020 2020 2023 2020 2020 2022 5374         #     "St
-000296d0: 6174 656d 656e 7422 3a20 5b0a 2020 2020  atement": [.    
-000296e0: 2020 2020 2320 2020 2020 2020 2020 7b0a      #         {.
-000296f0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00029700: 2020 2020 2020 2245 6666 6563 7422 3a20        "Effect": 
-00029710: 2241 6c6c 6f77 222c 0a20 2020 2020 2020  "Allow",.       
-00029720: 2023 2020 2020 2020 2020 2020 2020 2022   #             "
-00029730: 4163 7469 6f6e 223a 205b 0a20 2020 2020  Action": [.     
-00029740: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00029750: 2020 2020 2022 7365 733a 5365 6e64 456d       "ses:SendEm
-00029760: 6169 6c22 2c0a 2020 2020 2020 2020 2320  ail",.        # 
-00029770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029780: 2273 6573 3a53 656e 6452 6177 456d 6169  "ses:SendRawEmai
-00029790: 6c22 0a20 2020 2020 2020 2023 2020 2020  l".        #    
-000297a0: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
-000297b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-000297c0: 2020 2252 6573 6f75 7263 6522 3a20 222a    "Resource": "*
-000297d0: 220a 2020 2020 2020 2020 2320 2020 2020  ".        #     
-000297e0: 2020 2020 7d0a 2020 2020 2020 2020 2320      }.        # 
-000297f0: 2020 2020 5d0a 2020 2020 2020 2020 2320      ].        # 
-00029800: 7d0a 0a20 2020 2020 2020 2023 2070 6f6c  }..        # pol
-00029810: 6963 795f 6e61 6d65 203d 2027 5345 535f  icy_name = 'SES_
-00029820: 5365 6e64 456d 6169 6c5f 506f 6c69 6379  SendEmail_Policy
-00029830: 270a 0a20 2020 2020 2020 2023 2070 6f6c  '..        # pol
-00029840: 6963 795f 6172 6e20 3d20 7365 6c66 2e5f  icy_arn = self._
-00029850: 6563 325f 6372 6561 7465 5f6f 725f 6765  ec2_create_or_ge
-00029860: 745f 6961 6d5f 706f 6c69 6379 280a 2020  t_iam_policy(.  
-00029870: 2020 2020 2020 2320 2020 2020 706f 6c69        #     poli
-00029880: 6379 5f6e 616d 652c 2070 6f6c 6963 795f  cy_name, policy_
-00029890: 646f 6375 6d65 6e74 2c20 7072 6f66 696c  document, profil
-000298a0: 6529 0a0a 2020 2020 2020 2020 2320 7573  e)..        # us
-000298b0: 6572 6e61 6d65 203d 2027 796f 7572 5f69  ername = 'your_i
-000298c0: 616d 5f75 7365 726e 616d 6527 2020 2320  am_username'  # 
-000298d0: 4368 616e 6765 2074 6869 7320 746f 2074  Change this to t
-000298e0: 6865 2075 7365 726e 616d 6520 796f 7520  he username you 
-000298f0: 7769 7368 2074 6f20 6174 7461 6368 2074  wish to attach t
-00029900: 6865 2070 6f6c 6963 7920 746f 0a0a 2020  he policy to..  
-00029910: 2020 2020 2020 2320 7265 7370 6f6e 7365        # response
-00029920: 203d 2069 616d 2e61 7474 6163 685f 7573   = iam.attach_us
-00029930: 6572 5f70 6f6c 6963 7928 0a20 2020 2020  er_policy(.     
-00029940: 2020 2023 2020 2020 2055 7365 724e 616d     #     UserNam
-00029950: 653d 7573 6572 6e61 6d65 2c0a 2020 2020  e=username,.    
-00029960: 2020 2020 2320 2020 2020 506f 6c69 6379      #     Policy
-00029970: 4172 6e3d 706f 6c69 6379 5f61 726e 0a20  Arn=policy_arn. 
-00029980: 2020 2020 2020 2023 2029 0a0a 2020 2020         # )..    
-00029990: 2020 2020 2320 7072 696e 7428 6622 506f      # print(f"Po
-000299a0: 6c69 6379 207b 706f 6c69 6379 5f61 726e  licy {policy_arn
-000299b0: 7d20 6174 7461 6368 6564 2074 6f20 7573  } attached to us
-000299c0: 6572 207b 7573 6572 6e61 6d65 7d22 290a  er {username}").
-000299d0: 0a20 2020 2064 6566 2073 656e 645f 6563  .    def send_ec
-000299e0: 325f 636f 7374 7328 7365 6c66 2c20 696e  2_costs(self, in
-000299f0: 7374 616e 6365 5f69 6429 3a0a 2020 2020  stance_id):.    
-00029a00: 2020 2020 7061 7373 0a0a 2020 2020 6465      pass..    de
-00029a10: 6620 5f65 6332 5f63 7265 6174 655f 6961  f _ec2_create_ia
-00029a20: 6d5f 636f 7374 6578 706c 6f72 6572 5f73  m_costexplorer_s
-00029a30: 6573 2873 656c 662c 2069 6e73 7461 6e63  es(self, instanc
-00029a40: 655f 6964 293a 0a0a 2020 2020 2020 2020  e_id):..        
-00029a50: 2320 4465 6669 6e65 2074 6865 2070 6f6c  # Define the pol
-00029a60: 6963 790a 2020 2020 2020 2020 706f 6c69  icy.        poli
-00029a70: 6379 5f64 6f63 756d 656e 7420 3d20 7b0a  cy_document = {.
-00029a80: 2020 2020 2020 2020 2020 2020 2256 6572              "Ver
-00029a90: 7369 6f6e 223a 2022 3230 3132 2d31 302d  sion": "2012-10-
-00029aa0: 3137 222c 0a20 2020 2020 2020 2020 2020  17",.           
-00029ab0: 2022 5374 6174 656d 656e 7422 3a20 5b0a   "Statement": [.
-00029ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ad0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00029ae0: 2020 2020 2020 2245 6666 6563 7422 3a20        "Effect": 
-00029af0: 2241 6c6c 6f77 222c 0a20 2020 2020 2020  "Allow",.       
-00029b00: 2020 2020 2020 2020 2020 2020 2022 4163               "Ac
-00029b10: 7469 6f6e 223a 2022 7365 733a 5365 6e64  tion": "ses:Send
-00029b20: 456d 6169 6c22 2c0a 2020 2020 2020 2020  Email",.        
-00029b30: 2020 2020 2020 2020 2020 2020 2252 6573              "Res
-00029b40: 6f75 7263 6522 3a20 222a 220a 2020 2020  ource": "*".    
-00029b50: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
-00029b60: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00029b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029b80: 2020 2020 2022 4566 6665 6374 223a 2022       "Effect": "
-00029b90: 416c 6c6f 7722 2c0a 2020 2020 2020 2020  Allow",.        
-00029ba0: 2020 2020 2020 2020 2020 2020 2241 6374              "Act
-00029bb0: 696f 6e22 3a20 5b0a 2020 2020 2020 2020  ion": [.        
-00029bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029bd0: 2263 653a 2a22 2c20 2020 2020 2020 2020  "ce:*",         
-00029be0: 2020 2020 2023 2050 6572 6d69 7373 696f       # Permissio
-00029bf0: 6e73 2066 6f72 2043 6f73 7420 4578 706c  ns for Cost Expl
-00029c00: 6f72 6572 0a20 2020 2020 2020 2020 2020  orer.           
-00029c10: 2020 2020 2020 2020 2020 2020 2022 6365               "ce
-00029c20: 3a47 6574 436f 7374 416e 6455 7361 6765  :GetCostAndUsage
-00029c30: 222c 2020 2320 616c 6c0a 2020 2020 2020  ",  # all.      
-00029c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029c50: 2020 2265 6332 3a44 6573 6372 6962 652a    "ec2:Describe*
-00029c60: 222c 2020 2020 2023 2042 6173 6963 2045  ",     # Basic E
-00029c70: 4332 2072 6561 6420 7065 726d 6973 7369  C2 read permissi
-00029c80: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-00029c90: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
-00029ca0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00029cb0: 5265 736f 7572 6365 223a 2022 2a22 0a20  Resource": "*". 
-00029cc0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00029cd0: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00029ce0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-00029cf0: 2020 2320 5374 6570 2031 3a20 4372 6561    # Step 1: Crea
-00029d00: 7465 2074 6865 2070 6f6c 6963 7920 696e  te the policy in
-00029d10: 2049 414d 0a20 2020 2020 2020 2070 6f6c   IAM.        pol
-00029d20: 6963 795f 6e61 6d65 203d 2022 436f 7374  icy_name = "Cost
-00029d30: 4578 706c 6f72 6572 5345 5350 6f6c 6963  ExplorerSESPolic
-00029d40: 7922 0a0a 2020 2020 2020 2020 706f 6c69  y"..        poli
-00029d50: 6379 5f61 726e 203d 2073 656c 662e 5f65  cy_arn = self._e
-00029d60: 6332 5f63 7265 6174 655f 6f72 5f67 6574  c2_create_or_get
-00029d70: 5f69 616d 5f70 6f6c 6963 7928 0a20 2020  _iam_policy(.   
-00029d80: 2020 2020 2020 2020 2070 6f6c 6963 795f           policy_
-00029d90: 6e61 6d65 2c20 706f 6c69 6379 5f64 6f63  name, policy_doc
-00029da0: 756d 656e 7429 0a0a 2020 2020 2020 2020  ument)..        
-00029db0: 2320 5374 6570 2032 3a20 5265 7472 6965  # Step 2: Retrie
-00029dc0: 7665 2074 6865 2049 414d 2069 6e73 7461  ve the IAM insta
-00029dd0: 6e63 6520 7072 6f66 696c 6520 6174 7461  nce profile atta
-00029de0: 6368 6564 2074 6f20 7468 6520 4543 3220  ched to the EC2 
-00029df0: 696e 7374 616e 6365 0a20 2020 2020 2020  instance.       
-00029e00: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
-00029e10: 2e65 6332 5f63 6c69 656e 742e 6465 7363  .ec2_client.desc
-00029e20: 7269 6265 5f69 6e73 7461 6e63 6573 280a  ribe_instances(.
-00029e30: 2020 2020 2020 2020 2020 2020 496e 7374              Inst
-00029e40: 616e 6365 4964 733d 5b69 6e73 7461 6e63  anceIds=[instanc
-00029e50: 655f 6964 5d29 0a20 2020 2020 2020 2069  e_id]).        i
-00029e60: 6e73 7461 6e63 655f 6461 7461 203d 2072  nstance_data = r
-00029e70: 6573 706f 6e73 655b 2752 6573 6572 7661  esponse['Reserva
-00029e80: 7469 6f6e 7327 5d5b 305d 5b27 496e 7374  tions'][0]['Inst
-00029e90: 616e 6365 7327 5d5b 305d 0a20 2020 2020  ances'][0].     
-00029ea0: 2020 2069 6620 2749 616d 496e 7374 616e     if 'IamInstan
-00029eb0: 6365 5072 6f66 696c 6527 206e 6f74 2069  ceProfile' not i
-00029ec0: 6e20 696e 7374 616e 6365 5f64 6174 613a  n instance_data:
-00029ed0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00029ee0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00029ef0: 2020 2020 6622 4e6f 2049 414d 2049 6e73      f"No IAM Ins
-00029f00: 7461 6e63 6520 5072 6f66 696c 6520 6174  tance Profile at
-00029f10: 7461 6368 6564 2074 6f20 7468 6520 696e  tached to the in
-00029f20: 7374 616e 6365 3a20 7b69 6e73 7461 6e63  stance: {instanc
-00029f30: 655f 6964 7d22 290a 2020 2020 2020 2020  e_id}").        
-00029f40: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00029f50: 0a0a 2020 2020 2020 2020 696e 7374 616e  ..        instan
-00029f60: 6365 5f70 726f 6669 6c65 5f61 726e 203d  ce_profile_arn =
-00029f70: 2072 6573 706f 6e73 655b 2752 6573 6572   response['Reser
-00029f80: 7661 7469 6f6e 7327 5d5b 305d 5b27 496e  vations'][0]['In
-00029f90: 7374 616e 6365 7327 5d5b 305d 5b27 4961  stances'][0]['Ia
-00029fa0: 6d49 6e73 7461 6e63 6550 726f 6669 6c65  mInstanceProfile
-00029fb0: 275d 5b27 4172 6e27 5d0a 0a20 2020 2020  ']['Arn']..     
-00029fc0: 2020 2023 2045 7874 7261 6374 2074 6865     # Extract the
-00029fd0: 2069 6e73 7461 6e63 6520 7072 6f66 696c   instance profil
-00029fe0: 6520 6e61 6d65 2066 726f 6d20 6974 7320  e name from its 
-00029ff0: 4152 4e0a 2020 2020 2020 2020 696e 7374  ARN.        inst
-0002a000: 616e 6365 5f70 726f 6669 6c65 5f6e 616d  ance_profile_nam
-0002a010: 6520 3d20 696e 7374 616e 6365 5f70 726f  e = instance_pro
-0002a020: 6669 6c65 5f61 726e 2e73 706c 6974 2827  file_arn.split('
-0002a030: 2f27 295b 2d31 5d0a 0a20 2020 2020 2020  /')[-1]..       
-0002a040: 2023 2053 7465 7020 333a 2046 6574 6368   # Step 3: Fetch
-0002a050: 2074 6865 2072 6f6c 6520 6e61 6d65 2066   the role name f
-0002a060: 726f 6d20 7468 6520 696e 7374 616e 6365  rom the instance
-0002a070: 2070 726f 6669 6c65 0a20 2020 2020 2020   profile.       
-0002a080: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
-0002a090: 2e69 616d 5f63 6c69 656e 742e 6765 745f  .iam_client.get_
-0002a0a0: 696e 7374 616e 6365 5f70 726f 6669 6c65  instance_profile
-0002a0b0: 280a 2020 2020 2020 2020 2020 2020 496e  (.            In
-0002a0c0: 7374 616e 6365 5072 6f66 696c 654e 616d  stanceProfileNam
-0002a0d0: 653d 696e 7374 616e 6365 5f70 726f 6669  e=instance_profi
-0002a0e0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
-0002a0f0: 2072 6f6c 655f 6e61 6d65 203d 2072 6573   role_name = res
-0002a100: 706f 6e73 655b 2749 6e73 7461 6e63 6550  ponse['InstanceP
-0002a110: 726f 6669 6c65 275d 5b27 526f 6c65 7327  rofile']['Roles'
-0002a120: 5d5b 305d 5b27 526f 6c65 4e61 6d65 275d  ][0]['RoleName']
-0002a130: 0a0a 2020 2020 2020 2020 2320 5374 6570  ..        # Step
-0002a140: 2034 3a20 4174 7461 6368 2074 6865 2064   4: Attach the d
-0002a150: 6573 6972 6564 2070 6f6c 6963 7920 746f  esired policy to
-0002a160: 2074 6865 2072 6f6c 650a 2020 2020 2020   the role.      
-0002a170: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0002a180: 2020 2073 656c 662e 6961 6d5f 636c 6965     self.iam_clie
-0002a190: 6e74 2e61 7474 6163 685f 726f 6c65 5f70  nt.attach_role_p
-0002a1a0: 6f6c 6963 7928 0a20 2020 2020 2020 2020  olicy(.         
-0002a1b0: 2020 2020 2020 2052 6f6c 654e 616d 653d         RoleName=
-0002a1c0: 726f 6c65 5f6e 616d 652c 0a20 2020 2020  role_name,.     
-0002a1d0: 2020 2020 2020 2020 2020 2050 6f6c 6963             Polic
-0002a1e0: 7941 726e 3d70 6f6c 6963 795f 6172 6e0a  yArn=policy_arn.
-0002a1f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002a200: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0002a210: 6622 506f 6c69 6379 207b 706f 6c69 6379  f"Policy {policy
-0002a220: 5f61 726e 7d20 6174 7461 6368 6564 2074  _arn} attached t
-0002a230: 6f20 726f 6c65 207b 726f 6c65 5f6e 616d  o role {role_nam
-0002a240: 657d 2229 0a20 2020 2020 2020 2065 7863  e}").        exc
-0002a250: 6570 7420 7365 6c66 2e69 616d 5f63 6c69  ept self.iam_cli
-0002a260: 656e 742e 6578 6365 7074 696f 6e73 2e4e  ent.exceptions.N
-0002a270: 6f53 7563 6845 6e74 6974 7945 7863 6570  oSuchEntityExcep
-0002a280: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0002a290: 2020 7072 696e 7428 6622 526f 6c65 207b    print(f"Role {
-0002a2a0: 726f 6c65 5f6e 616d 657d 2064 6f65 7320  role_name} does 
-0002a2b0: 6e6f 7420 6578 6973 7421 2229 0a20 2020  not exist!").   
-0002a2c0: 2020 2020 2065 7863 6570 7420 7365 6c66       except self
-0002a2d0: 2e69 616d 5f63 6c69 656e 742e 6578 6365  .iam_client.exce
-0002a2e0: 7074 696f 6e73 2e49 6e76 616c 6964 496e  ptions.InvalidIn
-0002a2f0: 7075 7445 7863 6570 7469 6f6e 2061 7320  putException as 
-0002a300: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0002a310: 7269 6e74 2866 2249 6e76 616c 6964 2069  rint(f"Invalid i
-0002a320: 6e70 7574 3a20 7b65 7d22 290a 2020 2020  nput: {e}").    
-0002a330: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0002a340: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0002a350: 2020 2020 2020 2070 7269 6e74 2866 224f         print(f"O
-0002a360: 7468 6572 2045 7272 6f72 3a20 7b65 7d22  ther Error: {e}"
-0002a370: 290a 0a20 2020 2064 6566 205f 6563 325f  )..    def _ec2_
-0002a380: 6372 6561 7465 5f69 616d 5f73 656c 665f  create_iam_self_
-0002a390: 6465 7374 7275 6374 5f72 6f6c 6528 7365  destruct_role(se
-0002a3a0: 6c66 293a 0a0a 2020 2020 2020 2020 2320  lf):..        # 
-0002a3b0: 5374 6570 2031 3a20 4372 6561 7465 2049  Step 1: Create I
-0002a3c0: 414d 2070 6f6c 6963 790a 2020 2020 2020  AM policy.      
-0002a3d0: 2020 706f 6c69 6379 5f64 6f63 756d 656e    policy_documen
-0002a3e0: 7420 3d20 7b0a 2020 2020 2020 2020 2020  t = {.          
-0002a3f0: 2020 2256 6572 7369 6f6e 223a 2022 3230    "Version": "20
-0002a400: 3132 2d31 302d 3137 222c 0a20 2020 2020  12-10-17",.     
-0002a410: 2020 2020 2020 2022 5374 6174 656d 656e         "Statemen
-0002a420: 7422 3a20 5b0a 2020 2020 2020 2020 2020  t": [.          
-0002a430: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-0002a440: 2020 2020 2020 2020 2020 2020 2245 6666              "Eff
-0002a450: 6563 7422 3a20 2241 6c6c 6f77 222c 0a20  ect": "Allow",. 
-0002a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a470: 2020 2022 4163 7469 6f6e 223a 2022 6563     "Action": "ec
-0002a480: 323a 5465 726d 696e 6174 6549 6e73 7461  2:TerminateInsta
-0002a490: 6e63 6573 222c 0a20 2020 2020 2020 2020  nces",.         
-0002a4a0: 2020 2020 2020 2020 2020 2022 5265 736f             "Reso
-0002a4b0: 7572 6365 223a 2022 2a22 2c0a 2020 2020  urce": "*",.    
-0002a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4d0: 2243 6f6e 6469 7469 6f6e 223a 207b 0a20  "Condition": {. 
-0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4f0: 2020 2020 2020 2022 5374 7269 6e67 4571         "StringEq
-0002a500: 7561 6c73 223a 207b 0a20 2020 2020 2020  uals": {.       
-0002a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a520: 2020 2020 2022 6563 323a 5265 736f 7572       "ec2:Resour
-0002a530: 6365 5461 672f 4e61 6d65 223a 2022 4672  ceTag/Name": "Fr
-0002a540: 6f73 7465 7253 656c 6644 6573 7472 7563  osterSelfDestruc
-0002a550: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
-0002a560: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0002a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a580: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-0002a590: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0002a5a0: 205d 0a20 2020 2020 2020 207d 0a20 2020   ].        }.   
-0002a5b0: 2020 2020 2070 6f6c 6963 795f 6e61 6d65       policy_name
-0002a5c0: 203d 2027 5365 6c66 4465 7374 7275 6374   = 'SelfDestruct
-0002a5d0: 506f 6c69 6379 270a 0a20 2020 2020 2020  Policy'..       
-0002a5e0: 2070 6f6c 6963 795f 6172 6e20 3d20 7365   policy_arn = se
-0002a5f0: 6c66 2e5f 6563 325f 6372 6561 7465 5f6f  lf._ec2_create_o
-0002a600: 725f 6765 745f 6961 6d5f 706f 6c69 6379  r_get_iam_policy
-0002a610: 280a 2020 2020 2020 2020 2020 2020 706f  (.            po
-0002a620: 6c69 6379 5f6e 616d 652c 2070 6f6c 6963  licy_name, polic
-0002a630: 795f 646f 6375 6d65 6e74 290a 0a20 2020  y_document)..   
-0002a640: 2020 2020 2023 2053 7465 7020 323a 2043       # Step 2: C
-0002a650: 7265 6174 6520 616e 2049 414d 2072 6f6c  reate an IAM rol
-0002a660: 6520 616e 6420 6174 7461 6368 2074 6865  e and attach the
-0002a670: 2070 6f6c 6963 790a 2020 2020 2020 2020   policy.        
-0002a680: 7472 7573 745f 7265 6c61 7469 6f6e 7368  trust_relationsh
-0002a690: 6970 203d 207b 0a20 2020 2020 2020 2020  ip = {.         
-0002a6a0: 2020 2022 5665 7273 696f 6e22 3a20 2232     "Version": "2
-0002a6b0: 3031 322d 3130 2d31 3722 2c0a 2020 2020  012-10-17",.    
-0002a6c0: 2020 2020 2020 2020 2253 7461 7465 6d65          "Stateme
-0002a6d0: 6e74 223a 205b 0a20 2020 2020 2020 2020  nt": [.         
-0002a6e0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-0002a6f0: 2020 2020 2020 2020 2020 2020 2022 4566               "Ef
-0002a700: 6665 6374 223a 2022 416c 6c6f 7722 2c0a  fect": "Allow",.
-0002a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a720: 2020 2020 2250 7269 6e63 6970 616c 223a      "Principal":
-0002a730: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0002a740: 2020 2020 2020 2020 2020 2022 5365 7276             "Serv
-0002a750: 6963 6522 3a20 2265 6332 2e61 6d61 7a6f  ice": "ec2.amazo
-0002a760: 6e61 7773 2e63 6f6d 220a 2020 2020 2020  naws.com".      
-0002a770: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
-0002a780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a790: 2020 2020 2022 4163 7469 6f6e 223a 2022       "Action": "
-0002a7a0: 7374 733a 4173 7375 6d65 526f 6c65 220a  sts:AssumeRole".
-0002a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7c0: 7d0a 2020 2020 2020 2020 2020 2020 5d0a  }.            ].
-0002a7d0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0002a7e0: 2020 2072 6f6c 655f 6e61 6d65 203d 2027     role_name = '
-0002a7f0: 5365 6c66 4465 7374 7275 6374 526f 6c65  SelfDestructRole
-0002a800: 270a 2020 2020 2020 2020 7472 793a 0a20  '.        try:. 
-0002a810: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002a820: 6961 6d5f 636c 6965 6e74 2e63 7265 6174  iam_client.creat
-0002a830: 655f 726f 6c65 280a 2020 2020 2020 2020  e_role(.        
-0002a840: 2020 2020 2020 2020 526f 6c65 4e61 6d65          RoleName
-0002a850: 3d72 6f6c 655f 6e61 6d65 2c0a 2020 2020  =role_name,.    
-0002a860: 2020 2020 2020 2020 2020 2020 4173 7375              Assu
-0002a870: 6d65 526f 6c65 506f 6c69 6379 446f 6375  meRolePolicyDocu
-0002a880: 6d65 6e74 3d6a 736f 6e2e 6475 6d70 7328  ment=json.dumps(
-0002a890: 7472 7573 745f 7265 6c61 7469 6f6e 7368  trust_relationsh
-0002a8a0: 6970 292c 0a20 2020 2020 2020 2020 2020  ip),.           
-0002a8b0: 2020 2020 2044 6573 6372 6970 7469 6f6e       Description
-0002a8c0: 3d27 416c 6c6f 7773 2045 4332 2069 6e73  ='Allows EC2 ins
-0002a8d0: 7461 6e63 6573 2074 6f20 6361 6c6c 2041  tances to call A
-0002a8e0: 5753 2073 6572 7669 6365 7320 6f6e 2079  WS services on y
-0002a8f0: 6f75 7220 6265 6861 6c66 2e27 0a20 2020  our behalf.'.   
-0002a900: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0002a910: 2020 2065 7863 6570 7420 7365 6c66 2e69     except self.i
-0002a920: 616d 5f63 6c69 656e 742e 6578 6365 7074  am_client.except
-0002a930: 696f 6e73 2e45 6e74 6974 7941 6c72 6561  ions.EntityAlrea
-0002a940: 6479 4578 6973 7473 4578 6365 7074 696f  dyExistsExceptio
-0002a950: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
-0002a960: 7269 6e74 2827 4941 4d20 5365 6c66 4465  rint('IAM SelfDe
-0002a970: 7374 7275 6374 526f 6c65 2061 6c72 6561  structRole alrea
-0002a980: 6479 2065 7869 7374 732e 2729 0a0a 2020  dy exists.')..  
-0002a990: 2020 2020 2020 7365 6c66 2e69 616d 5f63        self.iam_c
-0002a9a0: 6c69 656e 742e 6174 7461 6368 5f72 6f6c  lient.attach_rol
-0002a9b0: 655f 706f 6c69 6379 280a 2020 2020 2020  e_policy(.      
-0002a9c0: 2020 2020 2020 526f 6c65 4e61 6d65 3d72        RoleName=r
-0002a9d0: 6f6c 655f 6e61 6d65 2c0a 2020 2020 2020  ole_name,.      
-0002a9e0: 2020 2020 2020 506f 6c69 6379 4172 6e3d        PolicyArn=
-0002a9f0: 706f 6c69 6379 5f61 726e 0a20 2020 2020  policy_arn.     
-0002aa00: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-0002aa10: 7475 726e 2054 7275 650a 0a20 2020 2064  turn True..    d
-0002aa20: 6566 205f 6765 745f 6563 325f 6d65 7461  ef _get_ec2_meta
-0002aa30: 6461 7461 2873 656c 662c 206d 6574 6164  data(self, metad
-0002aa40: 6174 615f 656e 7472 7929 3a0a 0a20 2020  ata_entry):..   
-0002aa50: 2020 2020 2023 2072 6571 7565 7374 2027       # request '
-0002aa60: 6c6f 6361 6c2d 686f 7374 6e61 6d65 272c  local-hostname',
-0002aa70: 2027 7075 626c 6963 2d68 6f73 746e 616d   'public-hostnam
-0002aa80: 6527 2c20 276c 6f63 616c 2d69 7076 3427  e', 'local-ipv4'
-0002aa90: 2c20 2770 7562 6c69 632d 6970 7634 270a  , 'public-ipv4'.
-0002aaa0: 0a20 2020 2020 2020 2023 2044 6566 696e  .        # Defin
-0002aab0: 6520 7468 6520 6261 7365 2055 524c 2066  e the base URL f
-0002aac0: 6f72 2074 6865 2045 4332 206d 6574 6164  or the EC2 metad
-0002aad0: 6174 6120 7365 7276 6963 650a 2020 2020  ata service.    
-0002aae0: 2020 2020 6261 7365 5f75 726c 203d 2022      base_url = "
-0002aaf0: 6874 7470 3a2f 2f31 3639 2e32 3534 2e31  http://169.254.1
-0002ab00: 3639 2e32 3534 2f6c 6174 6573 742f 6d65  69.254/latest/me
-0002ab10: 7461 2d64 6174 612f 220a 0a20 2020 2020  ta-data/"..     
-0002ab20: 2020 2023 2052 6571 7565 7374 2061 2074     # Request a t
-0002ab30: 6f6b 656e 2077 6974 6820 6120 5454 4c20  oken with a TTL 
-0002ab40: 6f66 2036 3020 7365 636f 6e64 730a 2020  of 60 seconds.  
-0002ab50: 2020 2020 2020 746f 6b65 6e5f 7572 6c20        token_url 
-0002ab60: 3d20 2268 7474 703a 2f2f 3136 392e 3235  = "http://169.25
-0002ab70: 342e 3136 392e 3235 342f 6c61 7465 7374  4.169.254/latest
-0002ab80: 2f61 7069 2f74 6f6b 656e 220a 2020 2020  /api/token".    
-0002ab90: 2020 2020 746f 6b65 6e5f 6865 6164 6572      token_header
-0002aba0: 7320 3d20 7b22 582d 6177 732d 6563 322d  s = {"X-aws-ec2-
-0002abb0: 6d65 7461 6461 7461 2d74 6f6b 656e 2d74  metadata-token-t
-0002abc0: 746c 2d73 6563 6f6e 6473 223a 2022 3630  tl-seconds": "60
-0002abd0: 227d 0a20 2020 2020 2020 2074 7279 3a0a  "}.        try:.
-0002abe0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-0002abf0: 6e5f 7265 7370 6f6e 7365 203d 2072 6571  n_response = req
-0002ac00: 7565 7374 732e 7075 7428 0a20 2020 2020  uests.put(.     
-0002ac10: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
-0002ac20: 5f75 726c 2c20 6865 6164 6572 733d 746f  _url, headers=to
-0002ac30: 6b65 6e5f 6865 6164 6572 732c 2074 696d  ken_headers, tim
-0002ac40: 656f 7574 3d32 290a 2020 2020 2020 2020  eout=2).        
-0002ac50: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0002ac60: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0002ac70: 2020 2070 7269 6e74 2866 274f 7468 6572     print(f'Other
-0002ac80: 2045 7272 6f72 3a20 7b65 7d27 290a 2020   Error: {e}').  
-0002ac90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002aca0: 2022 220a 2020 2020 2020 2020 746f 6b65   "".        toke
-0002acb0: 6e20 3d20 746f 6b65 6e5f 7265 7370 6f6e  n = token_respon
-0002acc0: 7365 2e74 6578 740a 0a20 2020 2020 2020  se.text..       
-0002acd0: 2023 2055 7365 2074 6865 2074 6f6b 656e   # Use the token
-0002ace0: 2074 6f20 7265 7472 6965 7665 2074 6865   to retrieve the
-0002acf0: 2073 7065 6369 6669 6564 206d 6574 6164   specified metad
-0002ad00: 6174 6120 656e 7472 790a 2020 2020 2020  ata entry.      
-0002ad10: 2020 6865 6164 6572 7320 3d20 7b22 582d    headers = {"X-
-0002ad20: 6177 732d 6563 322d 6d65 7461 6461 7461  aws-ec2-metadata
-0002ad30: 2d74 6f6b 656e 223a 2074 6f6b 656e 7d0a  -token": token}.
-0002ad40: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0002ad50: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-0002ad60: 6520 3d20 7265 7175 6573 7473 2e67 6574  e = requests.get
-0002ad70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002ad80: 2020 6261 7365 5f75 726c 202b 206d 6574    base_url + met
-0002ad90: 6164 6174 615f 656e 7472 792c 2068 6561  adata_entry, hea
-0002ada0: 6465 7273 3d68 6561 6465 7273 2c20 7469  ders=headers, ti
-0002adb0: 6d65 6f75 743d 3229 0a20 2020 2020 2020  meout=2).       
-0002adc0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0002add0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0002ade0: 2020 2020 7072 696e 7428 6627 4f74 6865      print(f'Othe
-0002adf0: 7220 4572 726f 723a 207b 657d 2729 0a20  r Error: {e}'). 
-0002ae00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002ae10: 6e20 2222 0a0a 2020 2020 2020 2020 6966  n ""..        if
-0002ae20: 2072 6573 706f 6e73 652e 7374 6174 7573   response.status
-0002ae30: 5f63 6f64 6520 213d 2032 3030 3a0a 2020  _code != 200:.  
-0002ae40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0002ae50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ae60: 2066 2245 7272 6f72 3a20 4661 696c 6564   f"Error: Failed
-0002ae70: 2074 6f20 7265 7472 6965 7665 206d 6574   to retrieve met
-0002ae80: 6164 6174 6120 666f 7220 656e 7472 793a  adata for entry:
-0002ae90: 207b 6d65 7461 6461 7461 5f65 6e74 7279   {metadata_entry
-0002aea0: 7d2e 2048 5454 5020 5374 6174 7573 2043  }. HTTP Status C
-0002aeb0: 6f64 653a 207b 7265 7370 6f6e 7365 2e73  ode: {response.s
-0002aec0: 7461 7475 735f 636f 6465 7d22 290a 2020  tatus_code}").  
-0002aed0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002aee0: 2022 220a 0a20 2020 2020 2020 2072 6574   ""..        ret
-0002aef0: 7572 6e20 7265 7370 6f6e 7365 2e74 6578  urn response.tex
-0002af00: 740a 0a20 2020 2023 2054 4f44 4f3a 204f  t..    # TODO: O
-0002af10: 4853 552d 3937 3a20 496d 706c 656d 656e  HSU-97: Implemen
-0002af20: 7420 636f 7374 206d 6f6e 6974 6f72 696e  t cost monitorin
-0002af30: 6720 616e 6420 656d 6169 6c20 7365 6e64  g and email send
-0002af40: 696e 670a 2020 2020 6465 6620 6d6f 6e69  ing.    def moni
-0002af50: 746f 725f 6563 3228 7365 6c66 293a 0a0a  tor_ec2(self):..
-0002af60: 2020 2020 2020 2020 2320 6966 2073 7973          # if sys
-0002af70: 7465 6d20 6973 2069 646c 6520 7365 6c66  tem is idle self
-0002af80: 2d64 6573 7472 6f79 0a0a 2020 2020 2020  -destroy..      
-0002af90: 2020 696e 7374 616e 6365 5f69 6420 3d20    instance_id = 
-0002afa0: 7365 6c66 2e5f 6765 745f 6563 325f 6d65  self._get_ec2_me
-0002afb0: 7461 6461 7461 2827 696e 7374 616e 6365  tadata('instance
-0002afc0: 2d69 6427 290a 2020 2020 2020 2020 7075  -id').        pu
-0002afd0: 626c 6963 5f69 7020 3d20 7365 6c66 2e5f  blic_ip = self._
-0002afe0: 6765 745f 6563 325f 6d65 7461 6461 7461  get_ec2_metadata
-0002aff0: 2827 7075 626c 6963 2d69 7076 3427 290a  ('public-ipv4').
-0002b000: 2020 2020 2020 2020 696e 7374 616e 6365          instance
-0002b010: 5f74 7970 6520 3d20 7365 6c66 2e5f 6765  _type = self._ge
-0002b020: 745f 6563 325f 6d65 7461 6461 7461 2827  t_ec2_metadata('
-0002b030: 696e 7374 616e 6365 2d74 7970 6527 290a  instance-type').
-0002b040: 2020 2020 2020 2020 616d 695f 6964 203d          ami_id =
-0002b050: 2073 656c 662e 5f67 6574 5f65 6332 5f6d   self._get_ec2_m
-0002b060: 6574 6164 6174 6128 2761 6d69 2d69 6427  etadata('ami-id'
-0002b070: 290a 2020 2020 2020 2020 7265 7365 7276  ).        reserv
-0002b080: 6174 696f 6e5f 6964 203d 2073 656c 662e  ation_id = self.
-0002b090: 5f67 6574 5f65 6332 5f6d 6574 6164 6174  _get_ec2_metadat
-0002b0a0: 6128 2772 6573 6572 7661 7469 6f6e 2d69  a('reservation-i
-0002b0b0: 6427 290a 0a20 2020 2020 2020 206e 6f77  d')..        now
-0002b0c0: 7374 7220 3d20 6461 7465 7469 6d65 2e64  str = datetime.d
-0002b0d0: 6174 6574 696d 652e 6e6f 7728 292e 7374  atetime.now().st
-0002b0e0: 7266 7469 6d65 2827 2548 3a25 4d3a 2553  rftime('%H:%M:%S
-0002b0f0: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
-0002b100: 280a 2020 2020 2020 2020 2020 2020 6627  (.            f'
-0002b110: 6672 6f73 7465 722d 6d6f 6e69 746f 7220  froster-monitor 
-0002b120: 287b 6e6f 7773 7472 7d29 3a20 7b70 7562  ({nowstr}): {pub
-0002b130: 6c69 635f 6970 7d20 287b 696e 7374 616e  lic_ip} ({instan
-0002b140: 6365 5f69 647d 2c20 7b69 6e73 7461 6e63  ce_id}, {instanc
-0002b150: 655f 7479 7065 7d2c 207b 616d 695f 6964  e_type}, {ami_id
-0002b160: 7d2c 207b 7265 7365 7276 6174 696f 6e5f  }, {reservation_
-0002b170: 6964 7d29 202e 2e2e 2027 290a 0a20 2020  id}) ... ')..   
-0002b180: 2020 2020 2069 6620 7365 6c66 2e5f 6d6f       if self._mo
-0002b190: 6e69 746f 725f 6973 5f69 646c 6528 293a  nitor_is_idle():
-0002b1a0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0002b1b0: 6869 7320 6d61 6368 696e 6520 7761 7320  his machine was 
-0002b1c0: 6964 6c65 2066 6f72 2061 206c 6f6e 6720  idle for a long 
-0002b1d0: 7469 6d65 2c20 6465 7374 726f 7920 6974  time, destroy it
+000294c0: 2020 2020 2020 2020 6669 6c65 2021 3d20          file != 
+000294d0: 7365 6c66 2e77 6865 7265 5f64 6964 5f74  self.where_did_t
+000294e0: 6865 5f66 696c 6573 5f67 6f5f 6669 6c65  he_files_go_file
+000294f0: 6e61 6d65 2061 6e64 205c 0a20 2020 2020  name and \.     
+00029500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029510: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00029520: 696c 6520 213d 2073 656c 662e 6d64 3573  ile != self.md5s
+00029530: 756d 5f66 696c 656e 616d 6520 616e 6420  um_filename and 
+00029540: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00029550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029560: 2020 2020 2020 6669 6c65 2021 3d20 7365        file != se
+00029570: 6c66 2e6d 6435 7375 6d5f 7265 7374 6f72  lf.md5sum_restor
+00029580: 6564 5f66 696c 656e 616d 653a 0a0a 2020  ed_filename:..  
+00029590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295a0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+000295b0: 736b 203d 2065 7865 6375 746f 722e 7375  sk = executor.su
+000295c0: 626d 6974 2873 656c 662e 6d64 3573 756d  bmit(self.md5sum
+000295d0: 2c20 6669 6c65 5f70 6174 6829 0a0a 2020  , file_path)..  
+000295e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295f0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00029600: 736b 735b 7461 736b 5d20 3d20 6669 6c65  sks[task] = file
+00029610: 5f70 6174 680a 0a20 2020 2020 2020 2020  _path..         
+00029620: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00029630: 6f72 2066 7574 7572 6520 696e 2063 6f6e  or future in con
+00029640: 6375 7272 656e 742e 6675 7475 7265 732e  current.futures.
+00029650: 6173 5f63 6f6d 706c 6574 6564 2874 6173  as_completed(tas
+00029660: 6b73 293a 0a20 2020 2020 2020 2020 2020  ks):.           
+00029670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029680: 2066 696c 6520 3d20 6f73 2e70 6174 682e   file = os.path.
+00029690: 6261 7365 6e61 6d65 2874 6173 6b73 5b66  basename(tasks[f
+000296a0: 7574 7572 655d 290a 2020 2020 2020 2020  uture]).        
+000296b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000296c0: 2020 2020 6d64 3520 3d20 6675 7475 7265      md5 = future
+000296d0: 2e72 6573 756c 7428 290a 2020 2020 2020  .result().      
+000296e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000296f0: 2020 2020 2020 6f75 745f 662e 7772 6974        out_f.writ
+00029700: 6528 6622 7b6d 6435 7d20 207b 6669 6c65  e(f"{md5}  {file
+00029710: 7d5c 6e22 290a 0a20 2020 2020 2020 2020  }\n")..         
+00029720: 2020 2020 2020 2023 2043 6865 636b 2077         # Check w
+00029730: 6520 6765 6e65 7261 7465 6420 7468 6520  e generated the 
+00029740: 6861 7368 2066 696c 650a 2020 2020 2020  hash file.      
+00029750: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00029760: 7061 7468 2e67 6574 7369 7a65 2868 6173  path.getsize(has
+00029770: 6870 6174 6829 203d 3d20 303a 0a20 2020  hpath) == 0:.   
+00029780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029790: 206f 732e 7265 6d6f 7665 2868 6173 6870   os.remove(hashp
+000297a0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
+000297b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000297c0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000297d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000297e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297f0: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
+00029800: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00029810: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00029820: 2020 2070 7269 6e74 5f65 7272 6f72 2829     print_error()
+00029830: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00029840: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
+00029850: 6566 205f 6765 6e5f 616c 6c66 696c 6573  ef _gen_allfiles
+00029860: 5f61 6e64 5f74 6172 2873 656c 662c 2064  _and_tar(self, d
+00029870: 6972 6563 746f 7279 2c20 736d 616c 6c73  irectory, smalls
+00029880: 697a 653d 3130 3234 2c20 6973 5f74 6172  ize=1024, is_tar
+00029890: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+000298a0: 2727 2754 6172 2073 6d61 6c6c 2066 696c  '''Tar small fil
+000298b0: 6573 2069 6e20 6120 6469 7265 6374 6f72  es in a director
+000298c0: 7927 2727 0a0a 2020 2020 2020 2020 7472  y'''..        tr
+000298d0: 793a 0a20 2020 2020 2020 2020 2020 2074  y:.            t
+000298e0: 6172 5f70 6174 6820 3d20 6f73 2e70 6174  ar_path = os.pat
+000298f0: 682e 6a6f 696e 2864 6972 6563 746f 7279  h.join(directory
+00029900: 2c20 7365 6c66 2e73 6d61 6c6c 6669 6c65  , self.smallfile
+00029910: 735f 7461 725f 6669 6c65 6e61 6d65 290a  s_tar_filename).
+00029920: 2020 2020 2020 2020 2020 2020 6373 765f              csv_
+00029930: 7061 7468 203d 206f 732e 7061 7468 2e6a  path = os.path.j
+00029940: 6f69 6e28 6469 7265 6374 6f72 792c 2073  oin(directory, s
+00029950: 656c 662e 616c 6c66 696c 6573 5f63 7376  elf.allfiles_csv
+00029960: 5f66 696c 656e 616d 6529 0a0a 2020 2020  _filename)..    
+00029970: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00029980: 7468 2e65 7869 7374 7328 7461 725f 7061  th.exists(tar_pa
+00029990: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+000299a0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+000299b0: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000299c0: 7220 726f 6f74 2c20 6469 7273 2c20 6669  r root, dirs, fi
+000299d0: 6c65 7320 696e 2073 656c 662e 5f77 616c  les in self._wal
+000299e0: 6b65 7228 6469 7265 6374 6f72 7929 3a0a  ker(directory):.
+000299f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029a00: 2023 2057 6520 6f6e 6c79 2077 616e 7420   # We only want 
+00029a10: 746f 2074 6172 2074 6865 2066 696c 6573  to tar the files
+00029a20: 2069 6e20 7468 6520 726f 6f74 2064 6972   in the root dir
+00029a30: 6563 746f 7279 2e20 4176 6f69 6420 7265  ectory. Avoid re
+00029a40: 6375 7273 696f 6e2e 0a20 2020 2020 2020  cursion..       
+00029a50: 2020 2020 2020 2020 2069 6620 726f 6f74           if root
+00029a60: 2021 3d20 6469 7265 6374 6f72 793a 0a20   != directory:. 
+00029a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a80: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+00029a90: 2020 2020 2020 2020 2020 2320 466c 6167            # Flag
+00029aa0: 2074 6f20 6368 6563 6b20 6966 2061 6e79   to check if any
+00029ab0: 2066 696c 6573 2077 6572 6520 7461 7272   files were tarr
+00029ac0: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
+00029ad0: 2020 2064 6964 7461 7220 3d20 4661 6c73     didtar = Fals
+00029ae0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00029af0: 2020 2023 2043 7265 6174 6520 7461 7220     # Create tar 
+00029b00: 6669 6c65 2061 6e64 2063 7376 2066 696c  file and csv fil
+00029b10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00029b20: 2020 7769 7468 2074 6172 6669 6c65 2e6f    with tarfile.o
+00029b30: 7065 6e28 7461 725f 7061 7468 2c20 2277  pen(tar_path, "w
+00029b40: 2229 2061 7320 7461 725f 6669 6c65 2c20  ") as tar_file, 
+00029b50: 6f70 656e 2863 7376 5f70 6174 682c 2027  open(csv_path, '
+00029b60: 7727 2c20 6e65 776c 696e 653d 2727 2920  w', newline='') 
+00029b70: 6173 2063 7376 5f66 696c 653a 0a0a 2020  as csv_file:..  
+00029b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b90: 2020 2320 4372 6561 7465 2063 7376 2077    # Create csv w
+00029ba0: 7269 7465 720a 2020 2020 2020 2020 2020  riter.          
+00029bb0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
+00029bc0: 203d 2063 7376 2e77 7269 7465 7228 6373   = csv.writer(cs
+00029bd0: 765f 6669 6c65 290a 0a20 2020 2020 2020  v_file)..       
+00029be0: 2020 2020 2020 2020 2020 2020 2023 2057               # W
+00029bf0: 7269 7465 2074 6865 2068 6561 6465 720a  rite the header.
+00029c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c10: 2020 2020 7772 6974 6572 2e77 7269 7465      writer.write
+00029c20: 726f 7728 5b22 4669 6c65 222c 2022 5369  row(["File", "Si
+00029c30: 7a65 2862 7974 6573 2922 2c20 2244 6174  ze(bytes)", "Dat
+00029c40: 652d 4d6f 6469 6669 6564 222c 0a20 2020  e-Modified",.   
+00029c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c70: 2022 4461 7465 2d41 6363 6573 7365 6422   "Date-Accessed"
+00029c80: 2c20 224f 776e 6572 222c 2022 4772 6f75  , "Owner", "Grou
+00029c90: 7022 2c20 2250 6572 6d69 7373 696f 6e73  p", "Permissions
+00029ca0: 222c 2022 5461 7272 6564 225d 290a 0a20  ", "Tarred"]).. 
+00029cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cc0: 2020 2066 6f72 2066 696c 6520 696e 2066     for file in f
+00029cd0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+00029ce0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00029cf0: 4765 7420 7468 6520 6669 6c65 2070 6174  Get the file pat
+00029d00: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00029d10: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00029d20: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
+00029d30: 696e 2872 6f6f 742c 2066 696c 6529 0a0a  in(root, file)..
+00029d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d50: 2020 2020 2020 2020 2320 536b 6970 2074          # Skip t
+00029d60: 6865 2063 7376 2066 696c 650a 2020 2020  he csv file.    
+00029d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d80: 2020 2020 6966 2066 696c 655f 7061 7468      if file_path
+00029d90: 203d 3d20 6373 765f 7061 7468 3a0a 2020   == csv_path:.  
+00029da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029db0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00029dc0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+00029dd0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00029de0: 6563 6b20 6966 2066 696c 6520 6973 206c  eck if file is l
+00029df0: 6172 6765 7220 7468 616e 2058 204d 420a  arger than X MB.
+00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e10: 2020 2020 2020 2020 7369 7a65 2c20 6d74          size, mt
+00029e20: 696d 652c 2061 7469 6d65 203d 2073 656c  ime, atime = sel
+00029e30: 662e 5f67 6574 5f66 696c 655f 7374 6174  f._get_file_stat
+00029e40: 7328 6669 6c65 5f70 6174 6829 0a0a 2020  s(file_path)..  
+00029e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e60: 2020 2020 2020 2320 4765 7420 6c61 7374        # Get last
+00029e70: 206d 6f64 6966 6965 6420 6461 7465 0a20   modified date. 
+00029e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e90: 2020 2020 2020 206d 6461 7465 203d 2064         mdate = d
+00029ea0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+00029eb0: 2e66 726f 6d74 696d 6573 7461 6d70 280a  .fromtimestamp(.
+00029ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ed0: 2020 2020 2020 2020 2020 2020 6d74 696d              mtim
+00029ee0: 6529 2e73 7472 6674 696d 6528 2725 592d  e).strftime('%Y-
+00029ef0: 256d 2d25 6420 2548 3a25 4d3a 2553 2729  %m-%d %H:%M:%S')
+00029f00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00029f10: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+00029f20: 6c61 7374 2061 6363 6573 7365 6420 6461  last accessed da
+00029f30: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+00029f40: 2020 2020 2020 2020 2020 2061 6461 7465             adate
+00029f50: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+00029f60: 7469 6d65 2e66 726f 6d74 696d 6573 7461  time.fromtimesta
+00029f70: 6d70 280a 2020 2020 2020 2020 2020 2020  mp(.            
+00029f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f90: 6174 696d 6529 2e73 7472 6674 696d 6528  atime).strftime(
+00029fa0: 2725 592d 256d 2d25 6420 2548 3a25 4d3a  '%Y-%m-%d %H:%M:
+00029fb0: 2553 2729 0a0a 2020 2020 2020 2020 2020  %S')..          
+00029fc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00029fd0: 4765 7420 6f77 6e65 7273 6869 700a 2020  Get ownership.  
+00029fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ff0: 2020 2020 2020 6f77 6e65 7220 3d20 7365        owner = se
+0002a000: 6c66 2e75 6964 3275 7365 7228 6f73 2e6c  lf.uid2user(os.l
+0002a010: 7374 6174 2866 696c 655f 7061 7468 292e  stat(file_path).
+0002a020: 7374 5f75 6964 290a 2020 2020 2020 2020  st_uid).        
+0002a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a040: 6772 6f75 7020 3d20 7365 6c66 2e67 6964  group = self.gid
+0002a050: 3267 726f 7570 286f 732e 6c73 7461 7428  2group(os.lstat(
+0002a060: 6669 6c65 5f70 6174 6829 2e73 745f 6769  file_path).st_gi
+0002a070: 6429 0a0a 2020 2020 2020 2020 2020 2020  d)..            
+0002a080: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+0002a090: 7420 7065 726d 6973 7369 6f6e 730a 2020  t permissions.  
+0002a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a0b0: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
+0002a0c0: 7320 3d20 6f63 7428 6f73 2e6c 7374 6174  s = oct(os.lstat
+0002a0d0: 2866 696c 655f 7061 7468 292e 7374 5f6d  (file_path).st_m
+0002a0e0: 6f64 6529 0a0a 2020 2020 2020 2020 2020  ode)..          
+0002a0f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002a100: 5365 7420 7461 7272 6564 2074 6f20 4e6f  Set tarred to No
+0002a110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a120: 2020 2020 2020 2020 2074 6172 7265 6420           tarred 
+0002a130: 3d20 224e 6f22 0a0a 2020 2020 2020 2020  = "No"..        
+0002a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a150: 2320 5461 7220 7468 6520 6669 6c65 2069  # Tar the file i
+0002a160: 6620 6974 2773 2073 6d61 6c6c 6572 2074  f it's smaller t
+0002a170: 6861 6e20 7468 6520 7370 6563 6966 6965  han the specifie
+0002a180: 6420 7369 7a65 0a20 2020 2020 2020 2020  d size.         
+0002a190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002a1a0: 6620 6973 5f74 6172 2061 6e64 2073 697a  f is_tar and siz
+0002a1b0: 6520 3c20 736d 616c 6c73 697a 652a 3130  e < smallsize*10
+0002a1c0: 3234 3a0a 2020 2020 2020 2020 2020 2020  24:.            
+0002a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1e0: 2320 6164 6420 746f 2074 6172 2066 696c  # add to tar fil
+0002a1f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002a200: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+0002a210: 725f 6669 6c65 2e61 6464 2866 696c 655f  r_file.add(file_
+0002a220: 7061 7468 2c20 6172 636e 616d 653d 6669  path, arcname=fi
+0002a230: 6c65 290a 0a20 2020 2020 2020 2020 2020  le)..           
+0002a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a250: 2023 2053 6574 2064 6964 7461 7220 746f   # Set didtar to
+0002a260: 2054 7275 652c 2073 6f20 7765 206b 6e6f   True, so we kno
+0002a270: 7720 7765 2074 6172 7265 6420 6120 6669  w we tarred a fi
+0002a280: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+0002a290: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002a2a0: 6964 7461 7220 3d20 5472 7565 0a0a 2020  idtar = True..  
+0002a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2c0: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
+0002a2d0: 7665 206f 7269 6769 6e61 6c20 6669 6c65  ve original file
+0002a2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a2f0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+0002a300: 7265 6d6f 7665 2866 696c 655f 7061 7468  remove(file_path
+0002a310: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0002a320: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0002a330: 2053 6574 2074 6172 7265 6420 746f 2059   Set tarred to Y
+0002a340: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0002a350: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002a360: 6172 7265 6420 3d20 2259 6573 220a 0a20  arred = "Yes".. 
+0002a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a380: 2020 2020 2020 2023 2057 7269 7465 2066         # Write f
+0002a390: 696c 6520 696e 666f 2074 6f20 7468 6520  ile info to the 
+0002a3a0: 6373 7620 6669 6c65 0a20 2020 2020 2020  csv file.       
+0002a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a3c0: 2077 7269 7465 722e 7772 6974 6572 6f77   writer.writerow
+0002a3d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002a3e0: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
+0002a3f0: 696c 652c 2073 697a 652c 206d 6461 7465  ile, size, mdate
+0002a400: 2c20 6164 6174 652c 206f 776e 6572 2c20  , adate, owner, 
+0002a410: 6772 6f75 702c 2070 6572 6d69 7373 696f  group, permissio
+0002a420: 6e73 2c20 7461 7272 6564 5d29 0a0a 2020  ns, tarred])..  
+0002a430: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002a440: 4368 6563 6b20 6966 2077 6520 7461 7272  Check if we tarr
+0002a450: 6564 2061 6e79 2066 696c 6573 0a20 2020  ed any files.   
+0002a460: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002a470: 6e6f 7420 6469 6474 6172 3a0a 2020 2020  not didtar:.    
+0002a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a490: 2320 5265 6d6f 7665 2074 6865 2074 6172  # Remove the tar
+0002a4a0: 2066 696c 6520 6966 2069 7427 7320 656d   file if it's em
+0002a4b0: 7074 790a 2020 2020 2020 2020 2020 2020  pty.            
+0002a4c0: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+0002a4d0: 6528 7461 725f 7061 7468 290a 0a20 2020  e(tar_path)..   
+0002a4e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002a4f0: 5472 7565 0a0a 2020 2020 2020 2020 6578  True..        ex
+0002a500: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0002a510: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0002a520: 2069 6620 7365 6c66 2e61 7267 732e 6465   if self.args.de
+0002a530: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
+0002a540: 2020 2020 2070 7269 6e74 5f65 7272 6f72       print_error
+0002a550: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+0002a560: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0002a570: 2064 6566 2072 6573 6574 5f66 6f6c 6465   def reset_folde
+0002a580: 7228 7365 6c66 2c20 6469 7265 6374 6f72  r(self, director
+0002a590: 792c 2072 6563 7572 7369 7665 3d46 616c  y, recursive=Fal
+0002a5a0: 7365 293a 0a20 2020 2020 2020 2027 2727  se):.        '''
+0002a5b0: 5265 6d6f 7665 2061 6c6c 2066 726f 7374  Remove all frost
+0002a5c0: 6572 2061 7274 6966 6163 7473 2066 726f  er artifacts fro
+0002a5d0: 6d20 6120 666f 6c64 6572 2061 6e64 2075  m a folder and u
+0002a5e0: 6e74 6172 2073 6d61 6c6c 2066 696c 6573  ntar small files
+0002a5f0: 2727 270a 0a20 2020 2020 2020 2066 6f72  '''..        for
+0002a600: 2072 6f6f 742c 2064 6972 732c 2066 696c   root, dirs, fil
+0002a610: 6573 2069 6e20 7365 6c66 2e5f 7761 6c6b  es in self._walk
+0002a620: 6572 2864 6972 6563 746f 7279 293a 0a20  er(directory):. 
+0002a630: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002a640: 7420 7265 6375 7273 6976 6520 616e 6420  t recursive and 
+0002a650: 726f 6f74 2021 3d20 6469 7265 6374 6f72  root != director
+0002a660: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0002a670: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0002a680: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0002a690: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002a6a0: 6627 5c6e 5265 7365 7474 696e 6720 666f  f'\nResetting fo
+0002a6b0: 6c64 6572 207b 726f 6f74 7d2e 2e2e 2729  lder {root}...')
+0002a6c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a6d0: 2020 6966 2073 656c 662e 5f69 735f 666f    if self._is_fo
+0002a6e0: 6c64 6572 5f61 7263 6869 7665 6428 726f  lder_archived(ro
+0002a6f0: 6f74 2e72 7374 7269 7028 6f73 2e70 6174  ot.rstrip(os.pat
+0002a700: 682e 7365 7029 293a 0a20 2020 2020 2020  h.sep)):.       
+0002a710: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002a720: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0002a730: 2020 2020 2020 2020 2020 2020 6627 2020              f'  
+0002a740: 2020 2e2e 2e66 6f6c 6465 7220 7b72 6f6f    ...folder {roo
+0002a750: 747d 2069 7320 6172 6368 6976 6564 2c20  t} is archived, 
+0002a760: 6e6f 7468 696e 6720 746f 2072 6573 6574  nothing to reset
+0002a770: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+0002a780: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0002a790: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0002a7a0: 2020 2023 2047 6574 2074 6865 2070 6174     # Get the pat
+0002a7b0: 6820 746f 2074 6865 2074 6172 2066 696c  h to the tar fil
+0002a7c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002a7d0: 2020 7461 725f 7061 7468 203d 206f 732e    tar_path = os.
+0002a7e0: 7061 7468 2e6a 6f69 6e28 726f 6f74 2c20  path.join(root, 
+0002a7f0: 7365 6c66 2e73 6d61 6c6c 6669 6c65 735f  self.smallfiles_
+0002a800: 7461 725f 6669 6c65 6e61 6d65 290a 0a20  tar_filename).. 
+0002a810: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002a820: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+0002a830: 2874 6172 5f70 6174 6829 3a0a 2020 2020  (tar_path):.    
+0002a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a850: 7072 696e 7428 2720 2020 2055 6e74 6172  print('    Untar
+0002a860: 7269 6e67 2046 726f 7374 6572 2e73 6d61  ring Froster.sma
+0002a870: 6c6c 6669 6c65 732e 7461 722e 2e2e 2027  llfiles.tar... '
+0002a880: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+0002a890: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0002a8a0: 7468 2074 6172 6669 6c65 2e6f 7065 6e28  th tarfile.open(
+0002a8b0: 7461 725f 7061 7468 2c20 2272 2229 2061  tar_path, "r") a
+0002a8c0: 7320 7461 723a 0a20 2020 2020 2020 2020  s tar:.         
+0002a8d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002a8e0: 6172 2e65 7874 7261 6374 616c 6c28 7061  ar.extractall(pa
+0002a8f0: 7468 3d72 6f6f 7429 0a20 2020 2020 2020  th=root).       
+0002a900: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002a910: 6e74 2827 646f 6e65 2e27 290a 0a20 2020  nt('done.')..   
+0002a920: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0002a930: 2066 696c 6520 696e 2073 656c 662e 6469   file in self.di
+0002a940: 726d 6574 6166 696c 6573 3a0a 2020 2020  rmetafiles:.    
+0002a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a960: 6465 6c66 696c 6520 3d20 6f73 2e70 6174  delfile = os.pat
+0002a970: 682e 6a6f 696e 2872 6f6f 742c 2066 696c  h.join(root, fil
+0002a980: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0002a990: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
+0002a9a0: 2020 2052 656d 6f76 696e 6720 7b66 696c     Removing {fil
+0002a9b0: 657d 2e2e 2e20 272c 2065 6e64 3d27 2729  e}... ', end='')
+0002a9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a9d0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+0002a9e0: 6578 6973 7473 2864 656c 6669 6c65 293a  exists(delfile):
+0002a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002aa00: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+0002aa10: 7665 2864 656c 6669 6c65 290a 2020 2020  ve(delfile).    
+0002aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa30: 2020 2020 7072 696e 7428 2764 6f6e 6527      print('done'
+0002aa40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002aa50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa70: 2020 2020 7072 696e 7428 276e 6f74 6869      print('nothi
+0002aa80: 6e67 2074 6f20 7265 6d6f 7665 2729 0a0a  ng to remove')..
+0002aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aaa0: 7072 696e 7428 6627 2e2e 2e66 6f6c 6465  print(f'...folde
+0002aab0: 7220 7b72 6f6f 747d 2072 6573 6574 2073  r {root} reset s
+0002aac0: 7563 6365 7373 6675 6c6c 795c 6e27 290a  uccessfully\n').
+0002aad0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0002aae0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0002aaf0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002ab00: 7269 6e74 5f65 7272 6f72 2829 0a0a 2020  rint_error()..  
+0002ab10: 2020 6465 6620 5f69 735f 736d 616c 6c5f    def _is_small_
+0002ab20: 6669 6c65 5f69 6e5f 6469 7228 7365 6c66  file_in_dir(self
+0002ab30: 2c20 6469 722c 2073 6d61 6c6c 3d31 3032  , dir, small=102
+0002ab40: 3429 3a0a 2020 2020 2020 2020 2320 4765  4):.        # Ge
+0002ab50: 7420 616c 6c20 6669 6c65 7320 696e 2074  t all files in t
+0002ab60: 6865 2073 7065 6369 6669 6564 2064 6972  he specified dir
+0002ab70: 6563 746f 7279 0a20 2020 2020 2020 2066  ectory.        f
+0002ab80: 696c 6573 203d 205b 6f73 2e70 6174 682e  iles = [os.path.
+0002ab90: 6a6f 696e 2864 6972 2c20 6629 2066 6f72  join(dir, f) for
+0002aba0: 2066 2069 6e20 6f73 2e6c 6973 7464 6972   f in os.listdir
+0002abb0: 280a 2020 2020 2020 2020 2020 2020 6469  (.            di
+0002abc0: 7229 2069 6620 6f73 2e70 6174 682e 6973  r) if os.path.is
+0002abd0: 6669 6c65 286f 732e 7061 7468 2e6a 6f69  file(os.path.joi
+0002abe0: 6e28 6469 722c 2066 2929 5d0a 2020 2020  n(dir, f))].    
+0002abf0: 2020 2020 2320 7072 696e 7428 222a 2a20      # print("** 
+0002ac00: 6669 6c65 733a 222c 6669 6c65 7329 0a20  files:",files). 
+0002ac10: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+0002ac20: 6620 7468 6572 6527 7320 616e 7920 6669  f there's any fi
+0002ac30: 6c65 206c 6573 7320 7468 616e 2073 6d61  le less than sma
+0002ac40: 6c6c 0a20 2020 2020 2020 2069 735f 7468  ll.        is_th
+0002ac50: 6572 655f 736d 616c 6c5f 6669 6c65 203d  ere_small_file =
+0002ac60: 2046 616c 7365 0a20 2020 2020 2020 2066   False.        f
+0002ac70: 6f72 2066 2069 6e20 6669 6c65 733a 0a20  or f in files:. 
+0002ac80: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0002ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aca0: 732c 202a 5f20 3d20 7365 6c66 2e5f 6765  s, *_ = self._ge
+0002acb0: 745f 6669 6c65 5f73 7461 7473 2866 290a  t_file_stats(f).
+0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acd0: 6966 2073 203c 2073 6d61 6c6c 2a31 3032  if s < small*102
+0002ace0: 343a 0a20 2020 2020 2020 2020 2020 2020  4:.             
+0002acf0: 2020 2020 2020 2069 735f 7468 6572 655f         is_there_
+0002ad00: 736d 616c 6c5f 6669 6c65 203d 2054 7275  small_file = Tru
+0002ad10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002ad20: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0002ad30: 2020 2020 2020 2020 6578 6365 7074 2046          except F
+0002ad40: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
+0002ad50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002ad60: 2020 2320 4861 6e64 6c65 2074 6865 2065    # Handle the e
+0002ad70: 7272 6f72 2028 652e 672e 2c20 7072 696e  rror (e.g., prin
+0002ad80: 7420 6120 6d65 7373 6167 6520 6f72 2063  t a message or c
+0002ad90: 6f6e 7469 6e75 6520 746f 2074 6865 206e  ontinue to the n
+0002ada0: 6578 7420 6669 6c65 290a 2020 2020 2020  ext file).      
+0002adb0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002adc0: 6622 4669 6c65 206e 6f74 2066 6f75 6e64  f"File not found
+0002add0: 3a20 7b66 7d22 290a 2020 2020 2020 2020  : {f}").        
+0002ade0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0002adf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002ae00: 6973 5f74 6865 7265 5f73 6d61 6c6c 5f66  is_there_small_f
+0002ae10: 696c 650a 0a20 2020 2064 6566 205f 6765  ile..    def _ge
+0002ae20: 745f 6669 6c65 5f73 7461 7473 2873 656c  t_file_stats(sel
+0002ae30: 662c 2066 696c 6570 6174 6829 3a0a 2020  f, filepath):.  
+0002ae40: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0002ae50: 2020 2020 2020 2023 2055 7365 206c 7374         # Use lst
+0002ae60: 6174 2074 6f20 6765 7420 7374 6174 7320  at to get stats 
+0002ae70: 6f66 2073 796d 6c69 6e6b 2069 7473 656c  of symlink itsel
+0002ae80: 662c 206e 6f74 2074 6865 2066 696c 6520  f, not the file 
+0002ae90: 6974 2070 6f69 6e74 7320 746f 0a20 2020  it points to.   
+0002aea0: 2020 2020 2020 2020 2073 7461 7473 203d           stats =
+0002aeb0: 206f 732e 6c73 7461 7428 6669 6c65 7061   os.lstat(filepa
+0002aec0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+0002aed0: 7265 7475 726e 2073 7461 7473 2e73 745f  return stats.st_
+0002aee0: 7369 7a65 2c20 7374 6174 732e 7374 5f6d  size, stats.st_m
+0002aef0: 7469 6d65 2c20 7374 6174 732e 7374 5f61  time, stats.st_a
+0002af00: 7469 6d65 0a20 2020 2020 2020 2065 7863  time.        exc
+0002af10: 6570 7420 4669 6c65 4e6f 7446 6f75 6e64  ept FileNotFound
+0002af20: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0002af30: 2020 2070 7269 6e74 2866 227b 6669 6c65     print(f"{file
+0002af40: 7061 7468 7d20 6e6f 7420 666f 756e 642e  path} not found.
+0002af50: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0002af60: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
+0002af70: 2c20 4e6f 6e65 0a0a 2020 2020 6465 6620  , None..    def 
+0002af80: 5f64 656c 6574 655f 6c6f 6361 6c6c 7928  _delete_locally(
+0002af90: 7365 6c66 2c20 666f 6c64 6572 5f74 6f5f  self, folder_to_
+0002afa0: 6465 6c65 7465 293a 0a20 2020 2020 2020  delete):.       
+0002afb0: 2027 2727 4465 6c65 7465 2074 6865 2067   '''Delete the g
+0002afc0: 6976 656e 2066 6f6c 6465 7227 2727 0a0a  iven folder'''..
+0002afd0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+0002afe0: 5c6e 4445 4c45 5449 4e47 207b 666f 6c64  \nDELETING {fold
+0002aff0: 6572 5f74 6f5f 6465 6c65 7465 7d2e 2e2e  er_to_delete}...
+0002b000: 2729 0a0a 2020 2020 2020 2020 2320 4368  ')..        # Ch
+0002b010: 6563 6b20 6966 2074 6865 2066 6f6c 6465  eck if the folde
+0002b020: 7220 6973 2061 6c72 6561 6479 2061 7263  r is already arc
+0002b030: 6869 7665 640a 2020 2020 2020 2020 7768  hived.        wh
+0002b040: 6572 655f 6469 645f 6669 6c65 735f 676f  ere_did_files_go
+0002b050: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0002b060: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
+0002b070: 6465 725f 746f 5f64 656c 6574 652c 2073  der_to_delete, s
+0002b080: 656c 662e 7768 6572 655f 6469 645f 7468  elf.where_did_th
+0002b090: 655f 6669 6c65 735f 676f 5f66 696c 656e  e_files_go_filen
+0002b0a0: 616d 6529 0a20 2020 2020 2020 2069 6620  ame).        if 
+0002b0b0: 6f73 2e70 6174 682e 6973 6669 6c65 2877  os.path.isfile(w
+0002b0c0: 6865 7265 5f64 6964 5f66 696c 6573 5f67  here_did_files_g
+0002b0d0: 6f29 3a0a 2020 2020 2020 2020 2020 2020  o):.            
+0002b0e0: 7072 696e 7428 6627 2020 2020 2e2e 2e61  print(f'    ...a
+0002b0f0: 6c72 6561 6479 2064 656c 6574 6564 5c6e  lready deleted\n
+0002b100: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
+0002b110: 6574 7572 6e0a 0a20 2020 2020 2020 2061  eturn..        a
+0002b120: 7263 6869 7665 645f 666f 6c64 6572 5f69  rchived_folder_i
+0002b130: 6e66 6f20 3d20 7365 6c66 2e66 726f 7374  nfo = self.frost
+0002b140: 6572 5f61 7263 6869 7665 735f 6765 745f  er_archives_get_
+0002b150: 656e 7472 7928 0a20 2020 2020 2020 2020  entry(.         
+0002b160: 2020 2066 6f6c 6465 725f 746f 5f64 656c     folder_to_del
+0002b170: 6574 6529 0a0a 2020 2020 2020 2020 6966  ete)..        if
+0002b180: 2061 7263 6869 7665 645f 666f 6c64 6572   archived_folder
+0002b190: 5f69 6e66 6f20 6973 204e 6f6e 653a 0a20  _info is None:. 
+0002b1a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002b1b0: 2866 275c 6e46 6f6c 6465 7220 7b66 6f6c  (f'\nFolder {fol
+0002b1c0: 6465 725f 746f 5f64 656c 6574 657d 2069  der_to_delete} i
+0002b1d0: 7320 6e6f 7420 6172 6368 6976 6564 2729  s not archived')
 0002b1e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0002b1f0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0002b200: 2020 2020 6627 6672 6f73 7465 722d 6d6f      f'froster-mo
-0002b210: 6e69 746f 7220 287b 6e6f 7773 7472 7d29  nitor ({nowstr})
-0002b220: 3a20 4465 7374 726f 7969 6e67 2063 7572  : Destroying cur
-0002b230: 7265 6e74 2069 646c 696e 6720 6d61 6368  rent idling mach
-0002b240: 696e 6520 7b70 7562 6c69 635f 6970 7d20  ine {public_ip} 
-0002b250: 287b 696e 7374 616e 6365 5f69 647d 2920  ({instance_id}) 
-0002b260: 2e2e 2e27 290a 2020 2020 2020 2020 2020  ...').          
-0002b270: 2020 6966 2070 7562 6c69 635f 6970 3a0a    if public_ip:.
-0002b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b290: 626f 6479 5f74 6578 7420 3d20 2249 6e73  body_text = "Ins
-0002b2a0: 7461 6e63 6520 7761 7320 6465 7465 6374  tance was detect
-0002b2b0: 6564 2061 7320 6964 6c65 2061 6e64 2074  ed as idle and t
-0002b2c0: 6572 6d69 6e61 7465 6422 0a20 2020 2020  erminated".     
-0002b2d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002b2e0: 7365 6e64 5f65 6d61 696c 5f73 6573 2873  send_email_ses(s
-0002b2f0: 656c 662e 6366 672e 656d 6169 6c2c 2073  elf.cfg.email, s
-0002b300: 656c 662e 6366 672e 656d 6169 6c2c 0a20  elf.cfg.email,. 
-0002b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b330: 2020 2066 2754 6572 6d69 6e61 7469 6e67     f'Terminating
-0002b340: 2069 646c 6520 696e 7374 616e 6365 207b   idle instance {
-0002b350: 7075 626c 6963 5f69 707d 2028 7b69 6e73  public_ip} ({ins
-0002b360: 7461 6e63 655f 6964 7d29 272c 2062 6f64  tance_id})', bod
-0002b370: 795f 7465 7874 290a 2020 2020 2020 2020  y_text).        
-0002b380: 2020 2020 2020 2020 7365 6c66 2e65 6332          self.ec2
-0002b390: 5f74 6572 6d69 6e61 7465 5f69 6e73 7461  _terminate_insta
-0002b3a0: 6e63 6528 7075 626c 6963 5f69 7029 0a20  nce(public_ip). 
-0002b3b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002b3c0: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-0002b3d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002b3e0: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-0002b3f0: 6f75 6c64 206e 6f74 2072 6574 7269 6576  ould not retriev
-0002b400: 6520 6d65 7461 6461 7461 2028 4950 2927  e metadata (IP)'
-0002b410: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002b420: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0002b430: 2020 6375 7272 656e 745f 7469 6d65 203d    current_time =
-0002b440: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-0002b450: 6d65 2e6e 6f77 2829 2e74 696d 6528 290a  me.now().time().
-0002b460: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
-0002b470: 6d65 203d 2064 6174 6574 696d 652e 6461  me = datetime.da
-0002b480: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
-0002b490: 2232 333a 3030 3a30 3022 2c20 2225 483a  "23:00:00", "%H:
-0002b4a0: 254d 3a25 5322 292e 7469 6d65 2829 0a20  %M:%S").time(). 
-0002b4b0: 2020 2020 2020 2065 6e64 5f74 696d 6520         end_time 
-0002b4c0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
-0002b4d0: 696d 652e 7374 7270 7469 6d65 2822 3233  ime.strptime("23
-0002b4e0: 3a35 393a 3539 222c 2022 2548 3a25 4d3a  :59:59", "%H:%M:
-0002b4f0: 2553 2229 2e74 696d 6528 290a 2020 2020  %S").time().    
-0002b500: 2020 2020 6966 2073 7461 7274 5f74 696d      if start_tim
-0002b510: 6520 3e3d 2063 7572 7265 6e74 5f74 696d  e >= current_tim
-0002b520: 6520 6f72 2063 7572 7265 6e74 5f74 696d  e or current_tim
-0002b530: 6520 3e20 656e 645f 7469 6d65 3a0a 2020  e > end_time:.  
-0002b540: 2020 2020 2020 2020 2020 2320 6f6e 6c79            # only
-0002b550: 2072 756e 2063 6f73 7420 656d 6169 6c73   run cost emails
-0002b560: 206f 6e63 6520 6120 6461 790a 2020 2020   once a day.    
-0002b570: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0002b580: 2020 2020 2020 2020 6d6f 6e74 686c 795f          monthly_
-0002b590: 636f 7374 2c20 6d6f 6e74 686c 795f 756e  cost, monthly_un
-0002b5a0: 6974 2c20 6461 696c 795f 636f 7374 735f  it, daily_costs_
-0002b5b0: 6279 5f69 6e73 7461 6e63 652c 2075 7365  by_instance, use
-0002b5c0: 725f 6d6f 6e74 686c 795f 636f 7374 2c20  r_monthly_cost, 
-0002b5d0: 7573 6572 5f6d 6f6e 7468 6c79 5f75 6e69  user_monthly_uni
-0002b5e0: 742c 205c 0a20 2020 2020 2020 2020 2020  t, \.           
-0002b5f0: 2075 7365 725f 6461 696c 795f 636f 7374   user_daily_cost
-0002b600: 2c20 7573 6572 5f64 6169 6c79 5f75 6e69  , user_daily_uni
-0002b610: 742c 2075 7365 725f 6e61 6d65 203d 2073  t, user_name = s
-0002b620: 656c 662e 5f6d 6f6e 6974 6f72 5f67 6574  elf._monitor_get
-0002b630: 5f65 6332 5f63 6f73 7473 2829 0a0a 2020  _ec2_costs()..  
-0002b640: 2020 2020 2020 626f 6479 203d 205b 5d0a        body = [].
-0002b650: 2020 2020 2020 2020 626f 6479 2e61 7070          body.app
-0002b660: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-0002b670: 2066 227b 6d6f 6e74 686c 795f 636f 7374   f"{monthly_cost
-0002b680: 3a2e 3266 7d20 7b6d 6f6e 7468 6c79 5f75  :.2f} {monthly_u
-0002b690: 6e69 747d 2074 6f74 616c 2061 6363 6f75  nit} total accou
-0002b6a0: 6e74 2063 6f73 7420 666f 7220 7468 6520  nt cost for the 
-0002b6b0: 6375 7272 656e 7420 6d6f 6e74 682e 2229  current month.")
-0002b6c0: 0a20 2020 2020 2020 2062 6f64 792e 6170  .        body.ap
-0002b6d0: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-0002b6e0: 2020 6622 7b75 7365 725f 6d6f 6e74 686c    f"{user_monthl
-0002b6f0: 795f 636f 7374 3a2e 3266 7d20 7b75 7365  y_cost:.2f} {use
-0002b700: 725f 6d6f 6e74 686c 795f 756e 6974 7d20  r_monthly_unit} 
-0002b710: 636f 7374 206f 6620 7573 6572 207b 7573  cost of user {us
-0002b720: 6572 5f6e 616d 657d 2066 6f72 2074 6865  er_name} for the
-0002b730: 2063 7572 7265 6e74 206d 6f6e 7468 2e22   current month."
-0002b740: 290a 2020 2020 2020 2020 626f 6479 2e61  ).        body.a
-0002b750: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-0002b760: 2020 2066 227b 7573 6572 5f64 6169 6c79     f"{user_daily
-0002b770: 5f63 6f73 743a 2e32 667d 207b 7573 6572  _cost:.2f} {user
-0002b780: 5f64 6169 6c79 5f75 6e69 747d 2063 6f73  _daily_unit} cos
-0002b790: 7420 6f66 2075 7365 7220 7b75 7365 725f  t of user {user_
-0002b7a0: 6e61 6d65 7d20 696e 2074 6865 206c 6173  name} in the las
-0002b7b0: 7420 3234 2068 6f75 7273 2e22 290a 2020  t 24 hours.").  
-0002b7c0: 2020 2020 2020 626f 6479 2e61 7070 656e        body.appen
-0002b7d0: 6428 2243 6f73 7420 666f 7220 6561 6368  d("Cost for each
-0002b7e0: 2045 4332 2069 6e73 7461 6e63 6520 7479   EC2 instance ty
-0002b7f0: 7065 2069 6e20 7468 6520 6c61 7374 2032  pe in the last 2
-0002b800: 3420 686f 7572 733a 2229 0a20 2020 2020  4 hours:").     
-0002b810: 2020 2066 6f72 2069 6e73 7461 6e63 655f     for instance_
-0002b820: 742c 2028 636f 7374 2c20 756e 6974 2920  t, (cost, unit) 
-0002b830: 696e 2064 6169 6c79 5f63 6f73 7473 5f62  in daily_costs_b
-0002b840: 795f 696e 7374 616e 6365 2e69 7465 6d73  y_instance.items
-0002b850: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0002b860: 6966 2069 6e73 7461 6e63 655f 7420 213d  if instance_t !=
-0002b870: 2027 4e6f 496e 7374 616e 6365 5479 7065   'NoInstanceType
-0002b880: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-0002b890: 2020 2062 6f64 792e 6170 7065 6e64 2866     body.append(f
-0002b8a0: 2220 207b 696e 7374 616e 6365 5f74 3a31  "  {instance_t:1
-0002b8b0: 327d 3a20 247b 636f 7374 3a2e 3266 7d20  2}: ${cost:.2f} 
-0002b8c0: 7b75 6e69 747d 2229 0a20 2020 2020 2020  {unit}").       
-0002b8d0: 2062 6f64 795f 7465 7874 203d 2022 5c6e   body_text = "\n
-0002b8e0: 222e 6a6f 696e 2862 6f64 7929 0a20 2020  ".join(body).   
-0002b8f0: 2020 2020 2073 656c 662e 7365 6e64 5f65       self.send_e
-0002b900: 6d61 696c 5f73 6573 2873 656c 662e 6366  mail_ses(self.cf
-0002b910: 672e 656d 6169 6c2c 2073 656c 662e 6366  g.email, self.cf
-0002b920: 672e 656d 6169 6c2c 0a20 2020 2020 2020  g.email,.       
-0002b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b940: 2020 2020 2066 2746 726f 7374 6572 2041       f'Froster A
-0002b950: 5753 2063 6f73 7420 7265 706f 7274 2028  WS cost report (
-0002b960: 7b69 6e73 7461 6e63 655f 6964 7d29 272c  {instance_id})',
-0002b970: 2062 6f64 795f 7465 7874 290a 0a20 2020   body_text)..   
-0002b980: 2064 6566 205f 6d6f 6e69 746f 725f 7573   def _monitor_us
-0002b990: 6572 735f 6c6f 6767 6564 5f69 6e28 7365  ers_logged_in(se
-0002b9a0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0002b9b0: 4368 6563 6b20 6966 2061 6e79 2075 7365  Check if any use
-0002b9c0: 7273 2061 7265 206c 6f67 6765 6420 696e  rs are logged in
-0002b9d0: 2e22 2222 0a20 2020 2020 2020 2074 7279  .""".        try
-0002b9e0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-0002b9f0: 7470 7574 203d 2073 7562 7072 6f63 6573  tput = subproces
-0002ba00: 732e 6368 6563 6b5f 6f75 7470 7574 280a  s.check_output(.
-0002ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba20: 5b27 7768 6f27 5d29 2e64 6563 6f64 6528  ['who']).decode(
-0002ba30: 2775 7466 2d38 272c 2065 7272 6f72 733d  'utf-8', errors=
-0002ba40: 2769 676e 6f72 6527 290a 2020 2020 2020  'ignore').      
-0002ba50: 2020 2020 2020 6966 206f 7574 7075 743a        if output:
-0002ba60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ba70: 2070 7269 6e74 2827 6672 6f73 7465 722d   print('froster-
-0002ba80: 6d6f 6e69 746f 723a 204e 6f74 2069 646c  monitor: Not idl
-0002ba90: 652c 206c 6f67 6765 6420 696e 3a27 2c20  e, logged in:', 
-0002baa0: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
-0002bab0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0002bac0: 7275 6520 2023 2055 7365 7273 2061 7265  rue  # Users are
-0002bad0: 206c 6f67 6765 6420 696e 0a20 2020 2020   logged in.     
-0002bae0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0002baf0: 6c73 650a 2020 2020 2020 2020 6578 6365  lse.        exce
-0002bb00: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0002bb10: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0002bb20: 7269 6e74 2866 274f 7468 6572 2045 7272  rint(f'Other Err
-0002bb30: 6f72 3a20 7b65 7d27 290a 2020 2020 2020  or: {e}').      
-0002bb40: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0002bb50: 650a 0a20 2020 2064 6566 205f 6d6f 6e69  e..    def _moni
-0002bb60: 746f 725f 6973 5f69 646c 6528 7365 6c66  tor_is_idle(self
-0002bb70: 2c20 696e 7465 7276 616c 3d36 302c 206d  , interval=60, m
-0002bb80: 696e 5f69 646c 655f 636e 743d 3732 293a  in_idle_cnt=72):
-0002bb90: 0a0a 2020 2020 2020 2020 2320 6561 6368  ..        # each
-0002bba0: 2072 756e 2063 6865 636b 7320 6964 6c65   run checks idle
-0002bbb0: 2074 696d 6520 666f 7220 3630 2073 6563   time for 60 sec
-0002bbc0: 6f6e 6473 2028 696e 7465 7276 616c 290a  onds (interval).
-0002bbd0: 2020 2020 2020 2020 2320 6966 2074 6865          # if the
-0002bbe0: 2073 7973 7465 6d20 6861 7320 6265 656e   system has been
-0002bbf0: 2069 646c 6520 666f 7220 3732 2063 6f6e   idle for 72 con
-0002bc00: 7365 6375 7469 7665 2072 756e 730a 2020  secutive runs.  
-0002bc10: 2020 2020 2020 2320 7468 6520 6675 636e        # the fucn
-0002bc20: 7469 6f6e 2077 696c 6c20 7265 7475 726e  tion will return
-0002bc30: 2069 646c 6520 7374 6174 6520 6166 7465   idle state afte
-0002bc40: 7220 3320 6461 7973 0a20 2020 2020 2020  r 3 days.       
-0002bc50: 2023 2069 6620 7468 6520 6372 6f6e 206a   # if the cron j
-0002bc60: 6f62 2069 7320 7275 6e6e 696e 6720 686f  ob is running ho
-0002bc70: 7572 6c79 0a0a 2020 2020 2020 2020 2320  urly..        # 
-0002bc80: 436f 6e73 7461 6e74 730a 2020 2020 2020  Constants.      
-0002bc90: 2020 4350 555f 5448 5245 5348 4f4c 4420    CPU_THRESHOLD 
-0002bca0: 3d20 3230 2020 2320 7065 7263 656e 740a  = 20  # percent.
-0002bcb0: 2020 2020 2020 2020 4e45 545f 5245 4144          NET_READ
-0002bcc0: 5f54 4852 4553 484f 4c44 203d 2031 3030  _THRESHOLD = 100
-0002bcd0: 3020 2023 2062 7974 6573 2070 6572 2073  0  # bytes per s
-0002bce0: 6563 6f6e 640a 2020 2020 2020 2020 4e45  econd.        NE
-0002bcf0: 545f 5752 4954 455f 5448 5245 5348 4f4c  T_WRITE_THRESHOL
-0002bd00: 4420 3d20 3130 3030 2020 2320 6279 7465  D = 1000  # byte
-0002bd10: 7320 7065 7220 7365 636f 6e64 0a20 2020  s per second.   
-0002bd20: 2020 2020 2044 4953 4b5f 5752 4954 455f       DISK_WRITE_
-0002bd30: 5448 5245 5348 4f4c 4420 3d20 3130 3030  THRESHOLD = 1000
-0002bd40: 3030 2020 2320 6279 7465 7320 7065 7220  00  # bytes per 
-0002bd50: 7365 636f 6e64 0a20 2020 2020 2020 2050  second.        P
-0002bd60: 524f 4345 5353 5f43 5055 5f54 4852 4553  ROCESS_CPU_THRES
-0002bd70: 484f 4c44 203d 2031 3020 2023 2070 6572  HOLD = 10  # per
-0002bd80: 6365 6e74 2028 666f 7220 696e 6469 7669  cent (for indivi
-0002bd90: 6475 616c 2070 726f 6365 7373 6573 290a  dual processes).
-0002bda0: 2020 2020 2020 2020 5052 4f43 4553 535f          PROCESS_
-0002bdb0: 4d45 4d5f 5448 5245 5348 4f4c 4420 3d20  MEM_THRESHOLD = 
-0002bdc0: 3130 2020 2320 7065 7263 656e 7420 2866  10  # percent (f
-0002bdd0: 6f72 2069 6e64 6976 6964 7561 6c20 7072  or individual pr
-0002bde0: 6f63 6573 7365 7329 0a20 2020 2020 2020  ocesses).       
-0002bdf0: 2044 4953 4b5f 5752 4954 455f 4558 434c   DISK_WRITE_EXCL
-0002be00: 5553 494f 4e53 203d 205b 2273 7973 7465  USIONS = ["syste
-0002be10: 6d64 222c 2022 7379 7374 656d 642d 6a6f  md", "systemd-jo
-0002be20: 7572 6e61 6c64 222c 0a20 2020 2020 2020  urnald",.       
-0002be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002be40: 2020 2020 2020 2020 2020 2263 6872 6f6e            "chron
-0002be50: 7964 222c 2022 7373 6864 222c 2022 6175  yd", "sshd", "au
-0002be60: 6469 7464 222c 2022 6167 6574 7479 225d  ditd", "agetty"]
-0002be70: 0a0a 2020 2020 2020 2020 2320 4e6f 7420  ..        # Not 
-0002be80: 6964 6c65 2069 6620 616e 7920 7573 6572  idle if any user
-0002be90: 7320 6172 6520 6c6f 6767 6564 2069 6e0a  s are logged in.
-0002bea0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002beb0: 5f6d 6f6e 6974 6f72 5f75 7365 7273 5f6c  _monitor_users_l
-0002bec0: 6f67 6765 645f 696e 2829 3a0a 2020 2020  ogged_in():.    
-0002bed0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-0002bee0: 6672 6f73 7465 722d 6d6f 6e69 746f 723a  froster-monitor:
-0002bef0: 204e 6f74 2069 646c 653a 2075 7365 7228   Not idle: user(
-0002bf00: 7329 206c 6f67 6765 6420 696e 2729 0a20  s) logged in'). 
-0002bf10: 2020 2020 2020 2020 2020 2023 2072 6574             # ret
-0002bf20: 7572 6e20 7365 6c66 2e5f 6d6f 6e69 746f  urn self._monito
-0002bf30: 725f 7361 7665 5f69 646c 655f 7374 6174  r_save_idle_stat
-0002bf40: 6528 4661 6c73 652c 206d 696e 5f69 646c  e(False, min_idl
-0002bf50: 655f 636e 7429 0a0a 2020 2020 2020 2020  e_cnt)..        
-0002bf60: 2320 4350 552c 2054 696d 6520 492f 4f20  # CPU, Time I/O 
-0002bf70: 616e 6420 4e65 7477 6f72 6b20 4163 7469  and Network Acti
-0002bf80: 7669 7479 0a20 2020 2020 2020 2069 6f5f  vity.        io_
-0002bf90: 7374 6172 7420 3d20 7073 7574 696c 2e64  start = psutil.d
-0002bfa0: 6973 6b5f 696f 5f63 6f75 6e74 6572 7328  isk_io_counters(
-0002bfb0: 290a 2020 2020 2020 2020 6e65 745f 7374  ).        net_st
-0002bfc0: 6172 7420 3d20 7073 7574 696c 2e6e 6574  art = psutil.net
-0002bfd0: 5f69 6f5f 636f 756e 7465 7273 2829 0a20  _io_counters(). 
-0002bfe0: 2020 2020 2020 2063 7075 5f70 6572 6365         cpu_perce
-0002bff0: 6e74 203d 2070 7375 7469 6c2e 6370 755f  nt = psutil.cpu_
-0002c000: 7065 7263 656e 7428 696e 7465 7276 616c  percent(interval
-0002c010: 3d69 6e74 6572 7661 6c29 0a20 2020 2020  =interval).     
-0002c020: 2020 2069 6f5f 656e 6420 3d20 7073 7574     io_end = psut
-0002c030: 696c 2e64 6973 6b5f 696f 5f63 6f75 6e74  il.disk_io_count
-0002c040: 6572 7328 290a 2020 2020 2020 2020 6e65  ers().        ne
-0002c050: 745f 656e 6420 3d20 7073 7574 696c 2e6e  t_end = psutil.n
-0002c060: 6574 5f69 6f5f 636f 756e 7465 7273 2829  et_io_counters()
-0002c070: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-0002c080: 6627 6672 6f73 7465 722d 6d6f 6e69 746f  f'froster-monito
-0002c090: 723a 2043 7572 7265 6e74 2043 5055 2520  r: Current CPU% 
-0002c0a0: 7b63 7075 5f70 6572 6365 6e74 7d27 290a  {cpu_percent}').
-0002c0b0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0002c0c0: 2043 5055 2055 7469 6c69 7a61 7469 6f6e   CPU Utilization
-0002c0d0: 0a20 2020 2020 2020 2069 6620 6370 755f  .        if cpu_
-0002c0e0: 7065 7263 656e 7420 3e20 4350 555f 5448  percent > CPU_TH
-0002c0f0: 5245 5348 4f4c 443a 0a20 2020 2020 2020  RESHOLD:.       
-0002c100: 2020 2020 2070 7269 6e74 2866 2766 726f       print(f'fro
-0002c110: 7374 6572 2d6d 6f6e 6974 6f72 3a20 4e6f  ster-monitor: No
-0002c120: 7420 6964 6c65 3a20 4350 5525 207b 6370  t idle: CPU% {cp
-0002c130: 755f 7065 7263 656e 747d 2729 0a20 2020  u_percent}').   
-0002c140: 2020 2020 2020 2020 2023 2072 6574 7572           # retur
-0002c150: 6e20 7365 6c66 2e5f 6d6f 6e69 746f 725f  n self._monitor_
-0002c160: 7361 7665 5f69 646c 655f 7374 6174 6528  save_idle_state(
-0002c170: 4661 6c73 652c 206d 696e 5f69 646c 655f  False, min_idle_
-0002c180: 636e 7429 0a0a 2020 2020 2020 2020 2320  cnt)..        # 
-0002c190: 4368 6563 6b20 492f 4f20 4163 7469 7669  Check I/O Activi
-0002c1a0: 7479 0a20 2020 2020 2020 2077 7269 7465  ty.        write
-0002c1b0: 5f64 6966 6620 3d20 696f 5f65 6e64 2e77  _diff = io_end.w
-0002c1c0: 7269 7465 5f62 7974 6573 202d 2069 6f5f  rite_bytes - io_
-0002c1d0: 7374 6172 742e 7772 6974 655f 6279 7465  start.write_byte
-0002c1e0: 730a 2020 2020 2020 2020 7772 6974 655f  s.        write_
-0002c1f0: 7065 725f 7365 636f 6e64 203d 2077 7269  per_second = wri
-0002c200: 7465 5f64 6966 6620 2f20 696e 7465 7276  te_diff / interv
-0002c210: 616c 0a0a 2020 2020 2020 2020 6966 2077  al..        if w
-0002c220: 7269 7465 5f70 6572 5f73 6563 6f6e 6420  rite_per_second 
-0002c230: 3e20 4449 534b 5f57 5249 5445 5f54 4852  > DISK_WRITE_THR
-0002c240: 4553 484f 4c44 3a0a 2020 2020 2020 2020  ESHOLD:.        
-0002c250: 2020 2020 666f 7220 7072 6f63 2069 6e20      for proc in 
-0002c260: 7073 7574 696c 2e70 726f 6365 7373 5f69  psutil.process_i
-0002c270: 7465 7228 5b27 6e61 6d65 275d 293a 0a20  ter(['name']):. 
-0002c280: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002c290: 6620 7072 6f63 2e69 6e66 6f5b 276e 616d  f proc.info['nam
-0002c2a0: 6527 5d20 696e 2044 4953 4b5f 5752 4954  e'] in DISK_WRIT
-0002c2b0: 455f 4558 434c 5553 494f 4e53 3a0a 2020  E_EXCLUSIONS:.  
-0002c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c2d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0002c2e0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0002c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c300: 2020 2020 6966 2070 726f 632e 696f 5f63      if proc.io_c
-0002c310: 6f75 6e74 6572 7328 292e 7772 6974 655f  ounters().write_
-0002c320: 6279 7465 7320 3e20 303a 0a20 2020 2020  bytes > 0:.     
-0002c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c340: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0002c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c360: 2020 2020 2020 6627 6672 6f73 7465 722d        f'froster-
-0002c370: 6d6f 6e69 746f 723a 696f 2062 7974 6573  monitor:io bytes
-0002c380: 2077 7269 7474 656e 3a20 7b70 726f 632e   written: {proc.
-0002c390: 696f 5f63 6f75 6e74 6572 7328 292e 7772  io_counters().wr
-0002c3a0: 6974 655f 6279 7465 737d 2729 0a20 2020  ite_bytes}').   
-0002c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c3c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002c3d0: 2e5f 6d6f 6e69 746f 725f 7361 7665 5f69  ._monitor_save_i
-0002c3e0: 646c 655f 7374 6174 6528 4661 6c73 652c  dle_state(False,
-0002c3f0: 206d 696e 5f69 646c 655f 636e 7429 0a20   min_idle_cnt). 
-0002c400: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002c410: 7863 6570 7420 2870 7375 7469 6c2e 4e6f  xcept (psutil.No
-0002c420: 5375 6368 5072 6f63 6573 732c 2070 7375  SuchProcess, psu
-0002c430: 7469 6c2e 4163 6365 7373 4465 6e69 6564  til.AccessDenied
-0002c440: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002c450: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
-0002c460: 2020 2020 2023 2043 6865 636b 204e 6574       # Check Net
-0002c470: 776f 726b 2041 6374 6976 6974 790a 2020  work Activity.  
-0002c480: 2020 2020 2020 6279 7465 735f 7365 6e74        bytes_sent
-0002c490: 5f64 6966 6620 3d20 6e65 745f 656e 642e  _diff = net_end.
-0002c4a0: 6279 7465 735f 7365 6e74 202d 206e 6574  bytes_sent - net
-0002c4b0: 5f73 7461 7274 2e62 7974 6573 5f73 656e  _start.bytes_sen
-0002c4c0: 740a 2020 2020 2020 2020 6279 7465 735f  t.        bytes_
-0002c4d0: 7265 6376 5f64 6966 6620 3d20 6e65 745f  recv_diff = net_
-0002c4e0: 656e 642e 6279 7465 735f 7265 6376 202d  end.bytes_recv -
-0002c4f0: 206e 6574 5f73 7461 7274 2e62 7974 6573   net_start.bytes
-0002c500: 5f72 6563 760a 0a20 2020 2020 2020 2062  _recv..        b
-0002c510: 7974 6573 5f73 656e 745f 7065 725f 7365  ytes_sent_per_se
-0002c520: 636f 6e64 203d 2062 7974 6573 5f73 656e  cond = bytes_sen
-0002c530: 745f 6469 6666 202f 2069 6e74 6572 7661  t_diff / interva
-0002c540: 6c0a 2020 2020 2020 2020 6279 7465 735f  l.        bytes_
-0002c550: 7265 6376 5f70 6572 5f73 6563 6f6e 6420  recv_per_second 
-0002c560: 3d20 6279 7465 735f 7265 6376 5f64 6966  = bytes_recv_dif
-0002c570: 6620 2f20 696e 7465 7276 616c 0a0a 2020  f / interval..  
-0002c580: 2020 2020 2020 6966 2062 7974 6573 5f73        if bytes_s
-0002c590: 656e 745f 7065 725f 7365 636f 6e64 203e  ent_per_second >
-0002c5a0: 204e 4554 5f57 5249 5445 5f54 4852 4553   NET_WRITE_THRES
-0002c5b0: 484f 4c44 206f 7220 5c0a 2020 2020 2020  HOLD or \.      
-0002c5c0: 2020 2020 2020 2020 2020 6279 7465 735f            bytes_
-0002c5d0: 7265 6376 5f70 6572 5f73 6563 6f6e 6420  recv_per_second 
-0002c5e0: 3e20 4e45 545f 5245 4144 5f54 4852 4553  > NET_READ_THRES
-0002c5f0: 484f 4c44 3a0a 2020 2020 2020 2020 2020  HOLD:.          
-0002c600: 2020 7072 696e 7428 6627 6672 6f73 7465    print(f'froste
-0002c610: 722d 6d6f 6e69 746f 723a 6e65 7420 6279  r-monitor:net by
-0002c620: 7465 7320 7265 6376 3a20 7b62 7974 6573  tes recv: {bytes
-0002c630: 5f72 6563 765f 7065 725f 7365 636f 6e64  _recv_per_second
-0002c640: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-0002c650: 7265 7475 726e 2073 656c 662e 5f6d 6f6e  return self._mon
-0002c660: 6974 6f72 5f73 6176 655f 6964 6c65 5f73  itor_save_idle_s
-0002c670: 7461 7465 2846 616c 7365 2c20 6d69 6e5f  tate(False, min_
-0002c680: 6964 6c65 5f63 6e74 290a 0a20 2020 2020  idle_cnt)..     
-0002c690: 2020 2023 2045 7861 6d69 6e65 2052 756e     # Examine Run
-0002c6a0: 6e69 6e67 2050 726f 6365 7373 6573 2066  ning Processes f
-0002c6b0: 6f72 2043 5055 2061 6e64 204d 656d 6f72  or CPU and Memor
-0002c6c0: 7920 5573 6167 650a 2020 2020 2020 2020  y Usage.        
-0002c6d0: 666f 7220 7072 6f63 2069 6e20 7073 7574  for proc in psut
-0002c6e0: 696c 2e70 726f 6365 7373 5f69 7465 7228  il.process_iter(
-0002c6f0: 5b27 6e61 6d65 272c 2027 6370 755f 7065  ['name', 'cpu_pe
-0002c700: 7263 656e 7427 2c20 276d 656d 6f72 795f  rcent', 'memory_
-0002c710: 7065 7263 656e 7427 5d29 3a0a 2020 2020  percent']):.    
-0002c720: 2020 2020 2020 2020 6966 2070 726f 632e          if proc.
-0002c730: 696e 666f 5b27 6e61 6d65 275d 206e 6f74  info['name'] not
-0002c740: 2069 6e20 4449 534b 5f57 5249 5445 5f45   in DISK_WRITE_E
-0002c750: 5843 4c55 5349 4f4e 533a 0a20 2020 2020  XCLUSIONS:.     
-0002c760: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-0002c770: 6f63 2e69 6e66 6f5b 2763 7075 5f70 6572  oc.info['cpu_per
-0002c780: 6365 6e74 275d 203e 2050 524f 4345 5353  cent'] > PROCESS
-0002c790: 5f43 5055 5f54 4852 4553 484f 4c44 3a0a  _CPU_THRESHOLD:.
-0002c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c7b0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0002c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c7d0: 2020 2066 2766 726f 7374 6572 2d6d 6f6e     f'froster-mon
-0002c7e0: 6974 6f72 3a20 4e6f 7420 6964 6c65 3a20  itor: Not idle: 
-0002c7f0: 4350 5525 207b 7072 6f63 2e69 6e66 6f5b  CPU% {proc.info[
-0002c800: 2263 7075 5f70 6572 6365 6e74 225d 7d27  "cpu_percent"]}'
-0002c810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002c820: 2020 2020 2020 2320 7265 7475 726e 2046        # return F
-0002c830: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0002c840: 2020 2020 2023 2064 6973 6162 6c65 6420       # disabled 
-0002c850: 7468 6973 2069 646c 6520 6368 6563 6b65  this idle checke
-0002c860: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0002c870: 2020 2320 6966 2070 726f 632e 696e 666f    # if proc.info
-0002c880: 5b27 6d65 6d6f 7279 5f70 6572 6365 6e74  ['memory_percent
-0002c890: 275d 203e 2050 524f 4345 5353 5f4d 454d  '] > PROCESS_MEM
-0002c8a0: 5f54 4852 4553 484f 4c44 3a0a 2020 2020  _THRESHOLD:.    
-0002c8b0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0002c8c0: 2070 7269 6e74 2866 2766 726f 7374 6572   print(f'froster
-0002c8d0: 2d6d 6f6e 6974 6f72 3a20 4e6f 7420 6964  -monitor: Not id
-0002c8e0: 6c65 3a20 4d45 4d25 207b 7072 6f63 2e69  le: MEM% {proc.i
-0002c8f0: 6e66 6f5b 226d 656d 6f72 795f 7065 7263  nfo["memory_perc
-0002c900: 656e 7422 5d7d 2729 0a20 2020 2020 2020  ent"]}').       
-0002c910: 2020 2020 2020 2020 2023 2020 2020 7265           #    re
-0002c920: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-0002c930: 2020 2020 2320 5772 6974 6520 6964 6c65      # Write idle
-0002c940: 2073 7461 7465 2061 6e64 2072 6561 6420   state and read 
-0002c950: 636f 6e73 6563 7574 6976 6520 6964 6c65  consecutive idle
-0002c960: 2068 6f75 7273 0a20 2020 2020 2020 2070   hours.        p
-0002c970: 7269 6e74 2866 2766 726f 7374 6572 2d6d  rint(f'froster-m
-0002c980: 6f6e 6974 6f72 3a20 4964 6c65 2073 7461  onitor: Idle sta
-0002c990: 7465 2064 6574 6563 7465 6427 290a 2020  te detected').  
-0002c9a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002c9b0: 662e 5f6d 6f6e 6974 6f72 5f73 6176 655f  f._monitor_save_
-0002c9c0: 6964 6c65 5f73 7461 7465 2854 7275 652c  idle_state(True,
-0002c9d0: 206d 696e 5f69 646c 655f 636e 7429 0a0a   min_idle_cnt)..
-0002c9e0: 2020 2020 6465 6620 5f6d 6f6e 6974 6f72      def _monitor
-0002c9f0: 5f73 6176 655f 6964 6c65 5f73 7461 7465  _save_idle_state
-0002ca00: 2873 656c 662c 2069 735f 7379 7374 656d  (self, is_system
-0002ca10: 5f69 646c 652c 206d 696e 5f69 646c 655f  _idle, min_idle_
-0002ca20: 636e 7429 3a0a 2020 2020 2020 2020 4944  cnt):.        ID
-0002ca30: 4c45 5f53 5441 5445 5f46 494c 4520 3d20  LE_STATE_FILE = 
-0002ca40: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
-0002ca50: 6765 7465 6e76 2827 544d 5044 4952 272c  getenv('TMPDIR',
-0002ca60: 2027 2f74 6d70 2729 2c0a 2020 2020 2020   '/tmp'),.      
-0002ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca90: 2027 6672 6f73 7465 725f 6964 6c65 5f73   'froster_idle_s
-0002caa0: 7461 7465 2e74 7874 2729 0a20 2020 2020  tate.txt').     
-0002cab0: 2020 2077 6974 6820 6f70 656e 2849 444c     with open(IDL
-0002cac0: 455f 5354 4154 455f 4649 4c45 2c20 2761  E_STATE_FILE, 'a
-0002cad0: 2729 2061 7320 6669 6c65 3a0a 2020 2020  ') as file:.    
-0002cae0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0002caf0: 7465 2827 315c 6e27 2069 6620 6973 5f73  te('1\n' if is_s
-0002cb00: 7973 7465 6d5f 6964 6c65 2065 6c73 6520  ystem_idle else 
-0002cb10: 2730 5c6e 2729 0a20 2020 2020 2020 2077  '0\n').        w
-0002cb20: 6974 6820 6f70 656e 2849 444c 455f 5354  ith open(IDLE_ST
-0002cb30: 4154 455f 4649 4c45 2c20 2772 2729 2061  ATE_FILE, 'r') a
-0002cb40: 7320 6669 6c65 3a0a 2020 2020 2020 2020  s file:.        
-0002cb50: 2020 2020 7374 6174 6573 203d 2066 696c      states = fil
-0002cb60: 652e 7265 6164 6c69 6e65 7328 290a 2020  e.readlines().  
-0002cb70: 2020 2020 2020 636f 756e 7420 3d20 300a        count = 0.
-0002cb80: 2020 2020 2020 2020 666f 7220 7374 6174          for stat
-0002cb90: 6520 696e 2072 6576 6572 7365 6428 7374  e in reversed(st
-0002cba0: 6174 6573 293a 0a20 2020 2020 2020 2020  ates):.         
-0002cbb0: 2020 2069 6620 7374 6174 652e 7374 7269     if state.stri
-0002cbc0: 7028 2920 3d3d 2027 3127 3a0a 2020 2020  p() == '1':.    
-0002cbd0: 2020 2020 2020 2020 2020 2020 636f 756e              coun
-0002cbe0: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-0002cbf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002cc00: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0002cc10: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-0002cc20: 756e 7420 3e3d 206d 696e 5f69 646c 655f  unt >= min_idle_
-0002cc30: 636e 740a 0a20 2020 2064 6566 205f 6d6f  cnt..    def _mo
-0002cc40: 6e69 746f 725f 6765 745f 6563 325f 636f  nitor_get_ec2_co
-0002cc50: 7374 7328 7365 6c66 293a 0a0a 2020 2020  sts(self):..    
-0002cc60: 2020 2020 2320 4964 656e 7469 6679 2063      # Identify c
-0002cc70: 7572 7265 6e74 2075 7365 722f 6163 636f  urrent user/acco
-0002cc80: 756e 740a 2020 2020 2020 2020 6964 656e  unt.        iden
-0002cc90: 7469 7479 203d 2073 656c 662e 7374 735f  tity = self.sts_
-0002cca0: 636c 6965 6e74 2e67 6574 5f63 616c 6c65  client.get_calle
-0002ccb0: 725f 6964 656e 7469 7479 2829 0a20 2020  r_identity().   
-0002ccc0: 2020 2020 2075 7365 725f 6172 6e20 3d20       user_arn = 
-0002ccd0: 6964 656e 7469 7479 5b27 4172 6e27 5d0a  identity['Arn'].
-0002cce0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0002ccf0: 2069 6620 6974 2773 2074 6865 2072 6f6f   if it's the roo
-0002cd00: 7420 7573 6572 0a20 2020 2020 2020 2069  t user.        i
-0002cd10: 735f 726f 6f74 203d 2022 3a72 6f6f 7422  s_root = ":root"
-0002cd20: 2069 6e20 7573 6572 5f61 726e 0a0a 2020   in user_arn..  
-0002cd30: 2020 2020 2020 2320 4461 7465 7320 666f        # Dates fo
-0002cd40: 7220 7468 6520 6375 7272 656e 7420 6d6f  r the current mo
-0002cd50: 6e74 6820 616e 6420 7468 6520 6c61 7374  nth and the last
-0002cd60: 2032 3420 686f 7572 730a 2020 2020 2020   24 hours.      
-0002cd70: 2020 746f 6461 7920 3d20 6461 7465 7469    today = dateti
-0002cd80: 6d65 2e64 6174 6574 696d 652e 746f 6461  me.datetime.toda
-0002cd90: 7928 290a 2020 2020 2020 2020 6669 7273  y().        firs
-0002cda0: 745f 6461 795f 6f66 5f6d 6f6e 7468 203d  t_day_of_month =
-0002cdb0: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-0002cdc0: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-0002cdd0: 746f 6461 792e 7965 6172 2c20 746f 6461  today.year, toda
-0002cde0: 792e 6d6f 6e74 682c 2031 292e 6461 7465  y.month, 1).date
-0002cdf0: 2829 0a20 2020 2020 2020 2079 6573 7465  ().        yeste
-0002ce00: 7264 6179 203d 2028 746f 6461 7920 2d20  rday = (today - 
-0002ce10: 6461 7465 7469 6d65 2e74 696d 6564 656c  datetime.timedel
-0002ce20: 7461 2864 6179 733d 3129 292e 6461 7465  ta(days=1)).date
-0002ce30: 2829 0a0a 2020 2020 2020 2020 2320 4665  ()..        # Fe
-0002ce40: 7463 6820 4543 3220 636f 7374 206f 6620  tch EC2 cost of 
-0002ce50: 7468 6520 6375 7272 656e 7420 6d6f 6e74  the current mont
-0002ce60: 680a 2020 2020 2020 2020 6d6f 6e74 686c  h.        monthl
-0002ce70: 795f 7265 7370 6f6e 7365 203d 2073 656c  y_response = sel
-0002ce80: 662e 6365 5f63 6c69 656e 742e 6765 745f  f.ce_client.get_
-0002ce90: 636f 7374 5f61 6e64 5f75 7361 6765 280a  cost_and_usage(.
-0002cea0: 2020 2020 2020 2020 2020 2020 5469 6d65              Time
-0002ceb0: 5065 7269 6f64 3d7b 0a20 2020 2020 2020  Period={.       
-0002cec0: 2020 2020 2020 2020 2027 5374 6172 7427           'Start'
-0002ced0: 3a20 7374 7228 6669 7273 745f 6461 795f  : str(first_day_
-0002cee0: 6f66 5f6d 6f6e 7468 292c 0a20 2020 2020  of_month),.     
-0002cef0: 2020 2020 2020 2020 2020 2027 456e 6427             'End'
-0002cf00: 3a20 7374 7228 746f 6461 792e 6461 7465  : str(today.date
-0002cf10: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-0002cf20: 7d2c 0a20 2020 2020 2020 2020 2020 2046  },.            F
-0002cf30: 696c 7465 723d 7b0a 2020 2020 2020 2020  ilter={.        
-0002cf40: 2020 2020 2020 2020 2744 696d 656e 7369          'Dimensi
-0002cf50: 6f6e 7327 3a20 7b0a 2020 2020 2020 2020  ons': {.        
-0002cf60: 2020 2020 2020 2020 2020 2020 274b 6579              'Key
-0002cf70: 273a 2027 5345 5256 4943 4527 2c0a 2020  ': 'SERVICE',.  
+0002b1f0: 6e74 2866 274e 6f20 656e 7472 7920 666f  nt(f'No entry fo
+0002b200: 756e 6420 696e 2066 726f 7374 6572 2d61  und in froster-a
+0002b210: 7263 6869 7665 732e 6a73 6f6e 5c6e 2729  rchives.json\n')
+0002b220: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002b230: 7572 6e0a 0a20 2020 2020 2020 2074 7279  urn..        try
+0002b240: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002b250: 2047 6574 2074 6865 2070 6174 6820 746f   Get the path to
+0002b260: 2074 6865 2068 6173 6820 6669 6c65 0a20   the hash file. 
+0002b270: 2020 2020 2020 2020 2020 2068 6173 6866             hashf
+0002b280: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
+0002b290: 696e 2866 6f6c 6465 725f 746f 5f64 656c  in(folder_to_del
+0002b2a0: 6574 652c 2073 656c 662e 6d64 3573 756d  ete, self.md5sum
+0002b2b0: 5f66 696c 656e 616d 6529 0a0a 2020 2020  _filename)..    
+0002b2c0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0002b2d0: 6966 2074 6865 2068 6173 6866 696c 6520  if the hashfile 
+0002b2e0: 6578 6973 7473 0a20 2020 2020 2020 2020  exists.         
+0002b2f0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0002b300: 682e 6578 6973 7473 2868 6173 6866 696c  h.exists(hashfil
+0002b310: 6529 3a0a 0a20 2020 2020 2020 2020 2020  e):..           
+0002b320: 2020 2020 2023 2052 6567 756c 6172 2068       # Regular h
+0002b330: 6173 6866 696c 6520 646f 6573 206e 6f74  ashfile does not
+0002b340: 2065 7869 7374 2c20 6368 6563 6b20 6966   exist, check if
+0002b350: 2074 6865 2072 6573 746f 7265 6420 6861   the restored ha
+0002b360: 7368 6669 6c65 2065 7869 7374 730a 2020  shfile exists.  
+0002b370: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0002b380: 7368 6669 6c65 203d 206f 732e 7061 7468  shfile = os.path
+0002b390: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
+0002b3a0: 2020 2020 2020 2020 2020 2066 6f6c 6465             folde
+0002b3b0: 725f 746f 5f64 656c 6574 652c 2073 656c  r_to_delete, sel
+0002b3c0: 662e 6d64 3573 756d 5f72 6573 746f 7265  f.md5sum_restore
+0002b3d0: 645f 6669 6c65 6e61 6d65 290a 0a20 2020  d_filename)..   
+0002b3e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002b3f0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0002b400: 7473 2868 6173 6866 696c 6529 3a0a 2020  ts(hashfile):.  
+0002b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b420: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0002b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b440: 2066 2754 6865 7265 2069 7320 6e6f 2068   f'There is no h
+0002b450: 6173 6866 696c 6520 7468 6572 6566 6f72  ashfile therefor
+0002b460: 6520 6361 6e6e 6f74 2064 656c 6574 6520  e cannot delete 
+0002b470: 6669 6c65 7320 696e 207b 666f 6c64 6572  files in {folder
+0002b480: 5f74 6f5f 6465 6c65 7465 7d27 290a 2020  _to_delete}').  
+0002b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4a0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0002b4b0: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
+0002b4c0: 7375 6266 6f6c 6465 7220 7061 7468 0a20  subfolder path. 
+0002b4d0: 2020 2020 2020 2020 2020 2073 7562 666f             subfo
+0002b4e0: 6c64 6572 5f70 6174 6820 3d20 666f 6c64  lder_path = fold
+0002b4f0: 6572 5f74 6f5f 6465 6c65 7465 2e72 6570  er_to_delete.rep
+0002b500: 6c61 6365 280a 2020 2020 2020 2020 2020  lace(.          
+0002b510: 2020 2020 2020 6172 6368 6976 6564 5f66        archived_f
+0002b520: 6f6c 6465 725f 696e 666f 5b27 6c6f 6361  older_info['loca
+0002b530: 6c5f 666f 6c64 6572 275d 2c20 2727 290a  l_folder'], '').
+0002b540: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
+0002b550: 6574 2074 6865 2070 6174 6820 746f 2074  et the path to t
+0002b560: 6865 2053 3320 6465 7374 696e 6174 696f  he S3 destinatio
+0002b570: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
+0002b580: 5269 736b 792c 2062 7574 206f 732e 7061  Risky, but os.pa
+0002b590: 6874 2e6a 6f69 6e20 646f 6573 206e 6f74  ht.join does not
+0002b5a0: 2077 6f72 6b20 7769 7468 203a 7333 3a20   work with :s3: 
+0002b5b0: 7061 7468 730a 2020 2020 2020 2020 2020  paths.          
+0002b5c0: 2020 7333 5f64 6573 7420 3d20 6172 6368    s3_dest = arch
+0002b5d0: 6976 6564 5f66 6f6c 6465 725f 696e 666f  ived_folder_info
+0002b5e0: 5b27 6172 6368 6976 655f 666f 6c64 6572  ['archive_folder
+0002b5f0: 275d 202b 2073 7562 666f 6c64 6572 5f70  '] + subfolder_p
+0002b600: 6174 680a 0a20 2020 2020 2020 2020 2020  ath..           
+0002b610: 2070 7269 6e74 2866 275c 6e20 2020 2056   print(f'\n    V
+0002b620: 6572 6966 7969 6e67 2063 6865 636b 7375  erifying checksu
+0002b630: 6d73 2e2e 2e27 290a 2020 2020 2020 2020  ms...').        
+0002b640: 2020 2020 7263 6c6f 6e65 203d 2052 636c      rclone = Rcl
+0002b650: 6f6e 6528 7365 6c66 2e61 7267 732c 2073  one(self.args, s
+0002b660: 656c 662e 6366 6729 0a20 2020 2020 2020  elf.cfg).       
+0002b670: 2020 2020 2072 6574 203d 2072 636c 6f6e       ret = rclon
+0002b680: 652e 6368 6563 6b73 756d 2868 6173 6866  e.checksum(hashf
+0002b690: 696c 652c 2073 335f 6465 7374 2c20 272d  ile, s3_dest, '-
+0002b6a0: 2d6d 6178 2d64 6570 7468 272c 2027 3127  -max-depth', '1'
+0002b6b0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0002b6c0: 4368 6563 6b20 6966 2074 6865 2063 6865  Check if the che
+0002b6d0: 636b 7375 6d73 2061 7265 2063 6f72 7265  cksums are corre
+0002b6e0: 6374 0a20 2020 2020 2020 2020 2020 2069  ct.            i
+0002b6f0: 6620 7265 743a 0a20 2020 2020 2020 2020  f ret:.         
+0002b700: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+0002b710: 2020 2020 2020 2e2e 2e64 6f6e 6527 290a        ...done').
+0002b720: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002b730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b740: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0002b750: 2020 2020 2020 6465 6c65 7465 645f 6669        deleted_fi
+0002b760: 6c65 7320 3d20 5b5d 0a0a 2020 2020 2020  les = []..      
+0002b770: 2020 2020 2020 2320 4465 6c65 7465 2074        # Delete t
+0002b780: 6865 2066 696c 6573 0a20 2020 2020 2020  he files.       
+0002b790: 2020 2020 2066 6f72 2072 6f6f 742c 2064       for root, d
+0002b7a0: 6972 732c 2066 696c 6573 2069 6e20 7365  irs, files in se
+0002b7b0: 6c66 2e5f 7761 6c6b 6572 2866 6f6c 6465  lf._walker(folde
+0002b7c0: 725f 746f 5f64 656c 6574 6529 3a0a 2020  r_to_delete):.  
+0002b7d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002b7e0: 2072 6f6f 7420 213d 2066 6f6c 6465 725f   root != folder_
+0002b7f0: 746f 5f64 656c 6574 653a 0a20 2020 2020  to_delete:.     
+0002b800: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0002b810: 7265 616b 0a0a 2020 2020 2020 2020 2020  reak..          
+0002b820: 2020 2020 2020 7072 696e 7428 6627 5c6e        print(f'\n
+0002b830: 2020 2020 4465 6c65 7469 6e67 2066 696c      Deleting fil
+0002b840: 6573 2e2e 2e27 290a 2020 2020 2020 2020  es...').        
+0002b850: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+0002b860: 2069 6e20 6669 6c65 733a 0a20 2020 2020   in files:.     
+0002b870: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002b880: 6620 6669 6c65 203d 3d20 7365 6c66 2e6d  f file == self.m
+0002b890: 6435 7375 6d5f 6669 6c65 6e61 6d65 206f  d5sum_filename o
+0002b8a0: 7220 6669 6c65 203d 3d20 7365 6c66 2e6d  r file == self.m
+0002b8b0: 6435 7375 6d5f 7265 7374 6f72 6564 5f66  d5sum_restored_f
+0002b8c0: 696c 656e 616d 6520 6f72 2066 696c 6520  ilename or file 
+0002b8d0: 3d3d 2073 656c 662e 616c 6c66 696c 6573  == self.allfiles
+0002b8e0: 5f63 7376 5f66 696c 656e 616d 6520 6f72  _csv_filename or
+0002b8f0: 2066 696c 6520 3d3d 2073 656c 662e 7768   file == self.wh
+0002b900: 6572 655f 6469 645f 7468 655f 6669 6c65  ere_did_the_file
+0002b910: 735f 676f 5f66 696c 656e 616d 653a 0a20  s_go_filename:. 
+0002b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b930: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0002b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b970: 2020 6669 6c65 5f70 6174 6820 3d20 6f73    file_path = os
+0002b980: 2e70 6174 682e 6a6f 696e 2872 6f6f 742c  .path.join(root,
+0002b990: 2066 696c 6529 0a20 2020 2020 2020 2020   file).         
+0002b9a0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0002b9b0: 732e 7265 6d6f 7665 2866 696c 655f 7061  s.remove(file_pa
+0002b9c0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+0002b9d0: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
+0002b9e0: 7465 645f 6669 6c65 732e 6170 7065 6e64  ted_files.append
+0002b9f0: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
+0002ba00: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
+0002ba10: 2020 2020 2020 202e 2e2e 646f 6e65 2729         ...done')
+0002ba20: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0002ba30: 5772 6974 6520 6120 7265 6164 6d65 2066  Write a readme f
+0002ba40: 696c 6520 7769 7468 2074 6865 206d 6574  ile with the met
+0002ba50: 6164 6174 610a 2020 2020 2020 2020 2020  adata.          
+0002ba60: 2020 656d 6169 6c20 3d20 7365 6c66 2e63    email = self.c
+0002ba70: 6667 2e65 6d61 696c 0a20 2020 2020 2020  fg.email.       
+0002ba80: 2020 2020 2072 6561 646d 6520 3d20 6f73       readme = os
+0002ba90: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+0002baa0: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
+0002bab0: 6572 5f74 6f5f 6465 6c65 7465 2c20 7365  er_to_delete, se
+0002bac0: 6c66 2e77 6865 7265 5f64 6964 5f74 6865  lf.where_did_the
+0002bad0: 5f66 696c 6573 5f67 6f5f 6669 6c65 6e61  _files_go_filena
+0002bae0: 6d65 290a 0a20 2020 2020 2020 2020 2020  me)..           
+0002baf0: 2077 6974 6820 6f70 656e 2872 6561 646d   with open(readm
+0002bb00: 652c 2027 7727 2920 6173 2072 6d65 3a0a  e, 'w') as rme:.
+0002bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bb20: 726d 652e 7772 6974 6528 0a20 2020 2020  rme.write(.     
+0002bb30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002bb40: 2754 6865 2066 696c 6573 2069 6e20 7468  'The files in th
+0002bb50: 6973 2066 6f6c 6465 7220 6861 7665 2062  is folder have b
+0002bb60: 6565 6e20 6d6f 7665 6420 746f 2061 6e20  een moved to an 
+0002bb70: 4157 5320 5333 2061 7263 6869 7665 215c  AWS S3 archive!\
+0002bb80: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0002bb90: 2020 2020 726d 652e 7772 6974 6528 6627      rme.write(f'
+0002bba0: 5c6e 4172 6368 6976 6520 6c6f 6361 7469  \nArchive locati
+0002bbb0: 6f6e 3a20 7b73 335f 6465 7374 7d5c 6e27  on: {s3_dest}\n'
+0002bbc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002bbd0: 2020 726d 652e 7772 6974 6528 0a20 2020    rme.write(.   
+0002bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bbf0: 2066 2241 7263 6869 7665 2070 726f 6669   f"Archive profi
+0002bc00: 6c65 2028 7e2f 2e61 7773 293a 207b 6172  le (~/.aws): {ar
+0002bc10: 6368 6976 6564 5f66 6f6c 6465 725f 696e  chived_folder_in
+0002bc20: 666f 5b27 7072 6f66 696c 6527 5d7d 5c6e  fo['profile']}\n
+0002bc30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002bc40: 2020 2072 6d65 2e77 7269 7465 2866 2241     rme.write(f"A
+0002bc50: 7263 6869 7665 7220 7573 6572 3a20 7b61  rchiver user: {a
+0002bc60: 7263 6869 7665 645f 666f 6c64 6572 5f69  rchived_folder_i
+0002bc70: 6e66 6f5b 2775 7365 7227 5d7d 5c6e 2229  nfo['user']}\n")
+0002bc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bc90: 2072 6d65 2e77 7269 7465 2866 2741 7263   rme.write(f'Arc
+0002bca0: 6869 7665 7220 656d 6169 6c3a 207b 7365  hiver email: {se
+0002bcb0: 6c66 2e63 6667 2e65 6d61 696c 7d5c 6e27  lf.cfg.email}\n'
+0002bcc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002bcd0: 2020 726d 652e 7772 6974 6528 0a20 2020    rme.write(.   
+0002bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bcf0: 2066 2741 7263 6869 7665 2074 6f6f 6c3a   f'Archive tool:
+0002bd00: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+0002bd10: 636f 6d2f 6469 726b 7065 7465 7273 656e  com/dirkpetersen
+0002bd20: 2f66 726f 7374 6572 5c6e 2729 0a20 2020  /froster\n').   
+0002bd30: 2020 2020 2020 2020 2020 2020 2072 6d65               rme
+0002bd40: 2e77 7269 7465 280a 2020 2020 2020 2020  .write(.        
+0002bd50: 2020 2020 2020 2020 2020 2020 6627 5265              f'Re
+0002bd60: 7374 6f72 6520 636f 6d6d 616e 643a 2066  store command: f
+0002bd70: 726f 7374 6572 2072 6573 746f 7265 2022  roster restore "
+0002bd80: 7b66 6f6c 6465 725f 746f 5f64 656c 6574  {folder_to_delet
+0002bd90: 657d 225c 6e27 290a 2020 2020 2020 2020  e}"\n').        
+0002bda0: 2020 2020 2020 2020 726d 652e 7772 6974          rme.writ
+0002bdb0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0002bdc0: 2020 2020 2020 2066 2744 656c 6574 696f         f'Deletio
+0002bdd0: 6e20 6461 7465 3a20 7b64 6174 6574 696d  n date: {datetim
+0002bde0: 652e 6461 7465 7469 6d65 2e6e 6f77 2829  e.datetime.now()
+0002bdf0: 7d5c 6e27 290a 2020 2020 2020 2020 2020  }\n').          
+0002be00: 2020 2020 2020 726d 652e 7772 6974 6528        rme.write(
+0002be10: 6627 5c6e 5c6e 4669 7273 7420 3130 2066  f'\n\nFirst 10 f
+0002be20: 696c 6573 2064 656c 6574 6564 2074 6869  iles deleted thi
+0002be30: 7320 7469 6d65 3a5c 6e27 290a 2020 2020  s time:\n').    
+0002be40: 2020 2020 2020 2020 2020 2020 726d 652e              rme.
+0002be50: 7772 6974 6528 272c 2027 2e6a 6f69 6e28  write(', '.join(
+0002be60: 6465 6c65 7465 645f 6669 6c65 735b 3a31  deleted_files[:1
+0002be70: 305d 2929 0a20 2020 2020 2020 2020 2020  0])).           
+0002be80: 2020 2020 2072 6d65 2e77 7269 7465 280a       rme.write(.
+0002be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bea0: 2020 2020 6627 5c6e 5c6e 506c 6561 7365      f'\n\nPlease
+0002beb0: 2073 6565 206d 6f72 6520 6d65 7461 6461   see more metada
+0002bec0: 7461 2069 6e20 4672 6f73 7465 722e 616c  ta in Froster.al
+0002bed0: 6c66 696c 6573 2e63 7376 2066 696c 655c  lfiles.csv file\
+0002bee0: 6e27 290a 0a20 2020 2020 2020 2020 2020  n')..           
+0002bef0: 2070 7269 6e74 2866 275c 6e44 454c 4554   print(f'\nDELET
+0002bf00: 494e 4720 5355 4343 4553 5346 554c 4c59  ING SUCCESSFULLY
+0002bf10: 2043 4f4d 504c 4554 4544 5c6e 2729 0a0a   COMPLETED\n')..
+0002bf20: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
+0002bf30: 696e 7420 7468 6520 6669 6e61 6c20 6d65  int the final me
+0002bf40: 7373 6167 650a 2020 2020 2020 2020 2020  ssage.          
+0002bf50: 2020 7072 696e 7428 6627 2020 2020 4c4f    print(f'    LO
+0002bf60: 4341 4c20 4445 4c45 5445 4420 464f 4c44  CAL DELETED FOLD
+0002bf70: 4552 3a20 2020 7b66 6f6c 6465 725f 746f  ER:   {folder_to
+0002bf80: 5f64 656c 6574 657d 2729 0a20 2020 2020  _delete}').     
+0002bf90: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
+0002bfa0: 2020 2041 5753 2053 3320 4445 5354 494e     AWS S3 DESTIN
+0002bfb0: 4154 494f 4e3a 2020 2020 207b 7333 5f64  ATION:     {s3_d
+0002bfc0: 6573 747d 5c6e 2729 0a20 2020 2020 2020  est}\n').       
+0002bfd0: 2020 2020 2070 7269 6e74 2866 2720 2020       print(f'   
+0002bfe0: 2054 6f74 616c 2066 696c 6573 2064 656c   Total files del
+0002bff0: 6574 6564 3a20 2020 207b 6c65 6e28 6465  eted:    {len(de
+0002c000: 6c65 7465 645f 6669 6c65 7329 7d5c 6e27  leted_files)}\n'
+0002c010: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0002c020: 696e 7428 6627 2020 2020 4d61 6e69 6665  int(f'    Manife
+0002c030: 7374 3a20 2020 2020 2020 2020 2020 2020  st:             
+0002c040: 2020 7b72 6561 646d 657d 5c6e 2729 0a0a    {readme}\n')..
+0002c050: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0002c060: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0002c070: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002c080: 5f65 7272 6f72 2829 0a20 2020 2020 2020  _error().       
+0002c090: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0002c0a0: 2064 6566 2064 656c 6574 6528 7365 6c66   def delete(self
+0002c0b0: 2c20 666f 6c64 6572 7329 3a0a 0a20 2020  , folders):..   
+0002c0c0: 2020 2020 2023 2043 6c65 616e 2074 6865       # Clean the
+0002c0d0: 2070 726f 7669 6465 6420 7061 7468 730a   provided paths.
+0002c0e0: 2020 2020 2020 2020 666f 6c64 6572 7320          folders 
+0002c0f0: 3d20 636c 6561 6e5f 7061 7468 5f6c 6973  = clean_path_lis
+0002c100: 7428 666f 6c64 6572 7329 0a0a 2020 2020  t(folders)..    
+0002c110: 2020 2020 2320 5365 7420 666c 6167 730a      # Set flags.
+0002c120: 2020 2020 2020 2020 6973 5f72 6563 7572          is_recur
+0002c130: 7369 7665 203d 2073 656c 662e 6172 6773  sive = self.args
+0002c140: 2e72 6563 7572 7369 7665 0a0a 2020 2020  .recursive..    
+0002c150: 2020 2020 6966 2069 735f 7265 6375 7273      if is_recurs
+0002c160: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
+0002c170: 2069 6620 7365 6c66 2e5f 6973 5f72 6563   if self._is_rec
+0002c180: 7572 7369 7665 5f63 6f6c 6c69 7369 6f6e  ursive_collision
+0002c190: 2866 6f6c 6465 7273 293a 0a20 2020 2020  (folders):.     
+0002c1a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002c1b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002c1c0: 2020 2020 2020 6627 5c6e 4572 726f 723a        f'\nError:
+0002c1d0: 2059 6f75 2063 616e 6e6f 7420 6465 6c65   You cannot dele
+0002c1e0: 7465 2066 6f6c 6465 7273 2072 6563 7572  te folders recur
+0002c1f0: 7369 7665 6c79 2069 6620 7468 6572 6520  sively if there 
+0002c200: 6973 2061 2064 6570 656e 6465 6e63 7920  is a dependency 
+0002c210: 6265 7477 6565 6e20 7468 656d 2e5c 6e27  between them.\n'
+0002c220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002c230: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+0002c240: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+0002c250: 6620 7765 2063 616e 2072 6561 6420 2620  f we can read & 
+0002c260: 7772 6974 6520 616c 6c20 6669 6c65 7320  write all files 
+0002c270: 616e 6420 666f 6c64 6572 730a 2020 2020  and folders.    
+0002c280: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0002c290: 5f69 735f 636f 7272 6563 745f 6669 6c65  _is_correct_file
+0002c2a0: 735f 666f 6c64 6572 735f 7065 726d 6973  s_folders_permis
+0002c2b0: 7369 6f6e 7328 666f 6c64 6572 732c 2069  sions(folders, i
+0002c2c0: 735f 7265 6375 7273 6976 6529 3a0a 2020  s_recursive):.  
+0002c2d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002c2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c2f0: 2027 5c6e 4572 726f 723a 2043 616e 6e6f   '\nError: Canno
+0002c300: 7420 7265 6164 206f 7220 7772 6974 6520  t read or write 
+0002c310: 746f 2061 6c6c 2066 696c 6573 2061 6e64  to all files and
+0002c320: 2066 6f6c 6465 7273 2e5c 6e27 2c20 6669   folders.\n', fi
+0002c330: 6c65 3d73 7973 2e73 7464 6572 7229 0a20  le=sys.stderr). 
+0002c340: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002c350: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002c360: 2020 6627 596f 7520 6361 6e20 6368 6563    f'You can chec
+0002c370: 6b20 7468 6520 7065 726d 6973 7369 6f6e  k the permission
+0002c380: 7320 6f66 2074 6865 2066 696c 6573 2061  s of the files a
+0002c390: 6e64 2066 6f6c 6465 7273 2075 7369 6e67  nd folders using
+0002c3a0: 2074 6865 2063 6f6d 6d61 6e64 3a27 2c20   the command:', 
+0002c3b0: 6669 6c65 3d73 7973 2e73 7464 6572 7229  file=sys.stderr)
+0002c3c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0002c3d0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0002c3e0: 2020 2020 6627 2020 2020 6672 6f73 7465      f'    froste
+0002c3f0: 7220 6172 6368 6976 6520 2d2d 7065 726d  r archive --perm
+0002c400: 6973 7369 6f6e 7320 222f 796f 7572 2f66  issions "/your/f
+0002c410: 6f6c 6465 722f 746f 2f61 7263 6869 7665  older/to/archive
+0002c420: 225c 6e27 2c20 6669 6c65 3d73 7973 2e73  "\n', file=sys.s
+0002c430: 7464 6572 7229 0a20 2020 2020 2020 2020  tderr).         
+0002c440: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
+0002c450: 2020 2020 2020 2020 6966 2075 7365 5f73          if use_s
+0002c460: 6c75 726d 2873 656c 662e 6172 6773 2e6e  lurm(self.args.n
+0002c470: 6f73 6c75 726d 293a 0a20 2020 2020 2020  oslurm):.       
+0002c480: 2020 2020 2073 656c 662e 5f73 6c75 726d       self._slurm
+0002c490: 5f63 6d64 2866 6f6c 6465 7273 3d66 6f6c  _cmd(folders=fol
+0002c4a0: 6465 7273 2c20 636d 645f 7479 7065 3d27  ders, cmd_type='
+0002c4b0: 6465 6c65 7465 2729 0a20 2020 2020 2020  delete').       
+0002c4c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002c4d0: 2020 2066 6f72 2066 6f6c 6465 7220 696e     for folder in
+0002c4e0: 2066 6f6c 6465 7273 3a0a 2020 2020 2020   folders:.      
+0002c4f0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+0002c500: 7265 6375 7273 6976 653a 0a20 2020 2020  recursive:.     
+0002c510: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002c520: 6f72 2072 6f6f 742c 2064 6972 732c 2066  or root, dirs, f
+0002c530: 696c 6573 2069 6e20 7365 6c66 2e5f 7761  iles in self._wa
+0002c540: 6c6b 6572 2866 6f6c 6465 7229 3a0a 2020  lker(folder):.  
+0002c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c560: 2020 2020 2020 7365 6c66 2e5f 6465 6c65        self._dele
+0002c570: 7465 5f6c 6f63 616c 6c79 2872 6f6f 7429  te_locally(root)
+0002c580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c590: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002c5a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002c5b0: 5f64 656c 6574 655f 6c6f 6361 6c6c 7928  _delete_locally(
+0002c5c0: 666f 6c64 6572 290a 0a20 2020 2064 6566  folder)..    def
+0002c5d0: 205f 6465 6c65 7465 5f74 6172 5f63 6f6e   _delete_tar_con
+0002c5e0: 7465 6e74 2873 656c 662c 2064 6972 6563  tent(self, direc
+0002c5f0: 746f 7279 2c20 6669 6c65 7329 3a0a 2020  tory, files):.  
+0002c600: 2020 2020 2020 6465 6c65 7465 6420 3d20        deleted = 
+0002c610: 5b5d 0a20 2020 2020 2020 2066 6f72 2066  [].        for f
+0002c620: 2069 6e20 6669 6c65 733a 0a20 2020 2020   in files:.     
+0002c630: 2020 2020 2020 2066 7020 3d20 6f73 2e70         fp = os.p
+0002c640: 6174 682e 6a6f 696e 2864 6972 6563 746f  ath.join(directo
+0002c650: 7279 2c20 6629 0a0a 2020 2020 2020 2020  ry, f)..        
+0002c660: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
+0002c670: 7366 696c 6528 6670 2920 6f72 206f 732e  sfile(fp) or os.
+0002c680: 7061 7468 2e69 736c 696e 6b28 6670 293a  path.islink(fp):
+0002c690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c6a0: 206f 732e 7265 6d6f 7665 2866 7029 0a20   os.remove(fp). 
+0002c6b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002c6c0: 656c 6574 6564 2e61 7070 656e 6428 6629  eleted.append(f)
+0002c6d0: 0a20 2020 2020 2020 2070 7269 6e74 6462  .        printdb
+0002c6e0: 6728 0a20 2020 2020 2020 2020 2020 2066  g(.            f
+0002c6f0: 2746 696c 6573 2064 656c 6574 6564 2069  'Files deleted i
+0002c700: 6e20 5f64 656c 6574 655f 7461 725f 636f  n _delete_tar_co
+0002c710: 6e74 656e 743a 207b 222c 2022 2e6a 6f69  ntent: {", ".joi
+0002c720: 6e28 6465 6c65 7465 6429 7d27 290a 0a20  n(deleted)}').. 
+0002c730: 2020 2020 2020 2072 6574 7572 6e20 6465         return de
+0002c740: 6c65 7465 640a 0a20 2020 2064 6566 205f  leted..    def _
+0002c750: 6765 745f 7461 725f 636f 6e74 656e 7428  get_tar_content(
+0002c760: 7365 6c66 2c20 6469 7265 6374 6f72 7929  self, directory)
+0002c770: 3a0a 2020 2020 2020 2020 6669 6c65 7320  :.        files 
+0002c780: 3d20 5b5d 0a20 2020 2020 2020 2074 6172  = [].        tar
+0002c790: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+0002c7a0: 6a6f 696e 2864 6972 6563 746f 7279 2c20  join(directory, 
+0002c7b0: 2746 726f 7374 6572 2e73 6d61 6c6c 6669  'Froster.smallfi
+0002c7c0: 6c65 732e 7461 7227 290a 2020 2020 2020  les.tar').      
+0002c7d0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0002c7e0: 7374 7328 7461 725f 7061 7468 293a 0a20  sts(tar_path):. 
+0002c7f0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0002c800: 7461 7266 696c 652e 6f70 656e 2874 6172  tarfile.open(tar
+0002c810: 5f70 6174 682c 2027 7227 2920 6173 2074  _path, 'r') as t
+0002c820: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
+0002c830: 2020 2020 666f 7220 6d65 6d62 6572 2069      for member i
+0002c840: 6e20 7461 722e 6765 746d 656d 6265 7273  n tar.getmembers
+0002c850: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0002c860: 2020 2020 2020 2020 6669 6c65 732e 6170          files.ap
+0002c870: 7065 6e64 286d 656d 6265 722e 6e61 6d65  pend(member.name
+0002c880: 290a 2020 2020 2020 2020 6373 765f 7061  ).        csv_pa
+0002c890: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
+0002c8a0: 6e28 6469 7265 6374 6f72 792c 2027 4672  n(directory, 'Fr
+0002c8b0: 6f73 7465 722e 616c 6c66 696c 6573 2e63  oster.allfiles.c
+0002c8c0: 7376 2729 0a20 2020 2020 2020 2069 6620  sv').        if 
+0002c8d0: 6f73 2e70 6174 682e 6578 6973 7473 2863  os.path.exists(c
+0002c8e0: 7376 5f70 6174 6829 3a0a 2020 2020 2020  sv_path):.      
+0002c8f0: 2020 2020 2020 6669 6c65 5f6c 6973 7420        file_list 
+0002c900: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0002c910: 2077 6974 6820 6f70 656e 2863 7376 5f70   with open(csv_p
+0002c920: 6174 682c 2027 7227 2920 6173 2063 7376  ath, 'r') as csv
+0002c930: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+0002c940: 2020 2020 2020 2320 5573 6520 6373 7620        # Use csv 
+0002c950: 7265 6164 6572 0a20 2020 2020 2020 2020  reader.         
+0002c960: 2020 2020 2020 2072 6561 6465 7220 3d20         reader = 
+0002c970: 6373 762e 4469 6374 5265 6164 6572 2863  csv.DictReader(c
+0002c980: 7376 6669 6c65 290a 2020 2020 2020 2020  svfile).        
+0002c990: 2020 2020 2020 2020 2320 4974 6572 6174          # Iterat
+0002c9a0: 6520 6f76 6572 2065 6163 6820 726f 7720  e over each row 
+0002c9b0: 696e 2074 6865 2063 7376 0a20 2020 2020  in the csv.     
+0002c9c0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0002c9d0: 6f77 2069 6e20 7265 6164 6572 3a0a 2020  ow in reader:.  
+0002c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9f0: 2020 2320 4966 2022 5461 7272 6564 2220    # If "Tarred" 
+0002ca00: 6973 2022 5965 7322 2c20 6170 7065 6e64  is "Yes", append
+0002ca10: 2074 6865 2022 4669 6c65 2220 746f 2074   the "File" to t
+0002ca20: 6865 206c 6973 740a 2020 2020 2020 2020  he list.        
+0002ca30: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0002ca40: 6f77 5b27 5461 7272 6564 275d 203d 3d20  ow['Tarred'] == 
+0002ca50: 2759 6573 273a 0a20 2020 2020 2020 2020  'Yes':.         
+0002ca60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002ca70: 6620 6e6f 7420 726f 775b 2746 696c 6527  f not row['File'
+0002ca80: 5d20 696e 2066 696c 6573 3a0a 2020 2020  ] in files:.    
+0002ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002caa0: 2020 2020 2020 2020 6669 6c65 732e 6170          files.ap
+0002cab0: 7065 6e64 2872 6f77 5b27 4669 6c65 275d  pend(row['File']
+0002cac0: 290a 2020 2020 2020 2020 7072 696e 7464  ).        printd
+0002cad0: 6267 280a 2020 2020 2020 2020 2020 2020  bg(.            
+0002cae0: 6627 4669 6c65 7320 666f 756e 6473 2069  f'Files founds i
+0002caf0: 6e20 5f67 6574 5f74 6172 5f63 6f6e 7465  n _get_tar_conte
+0002cb00: 6e74 3a20 7b22 2c20 222e 6a6f 696e 2866  nt: {", ".join(f
+0002cb10: 696c 6573 297d 2729 0a20 2020 2020 2020  iles)}').       
+0002cb20: 2072 6574 7572 6e20 6669 6c65 730a 0a20   return files.. 
+0002cb30: 2020 2064 6566 205f 646f 776e 6c6f 6164     def _download
+0002cb40: 2873 656c 662c 2066 6f6c 6465 7229 3a0a  (self, folder):.
+0002cb50: 0a20 2020 2020 2020 2023 2047 6574 2074  .        # Get t
+0002cb60: 6865 2062 7563 6b65 7420 616e 6420 7072  he bucket and pr
+0002cb70: 6566 6978 0a20 2020 2020 2020 2062 7563  efix.        buc
+0002cb80: 6b65 742c 2070 7265 6669 782c 202a 5f20  ket, prefix, *_ 
+0002cb90: 3d20 7365 6c66 2e61 7263 6869 7665 5f67  = self.archive_g
+0002cba0: 6574 5f62 7563 6b65 745f 696e 666f 2866  et_bucket_info(f
+0002cbb0: 6f6c 6465 7229 0a0a 2020 2020 2020 2020  older)..        
+0002cbc0: 6966 206e 6f74 2062 7563 6b65 743a 0a20  if not bucket:. 
+0002cbd0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002cbe0: 2866 275c 6e46 6f6c 6465 7220 7b66 6f6c  (f'\nFolder {fol
+0002cbf0: 6465 727d 2069 7320 6e6f 7420 7265 6769  der} is not regi
+0002cc00: 7374 6572 6564 2061 7320 6172 6368 6976  stered as archiv
+0002cc10: 6564 2729 0a20 2020 2020 2020 2020 2020  ed').           
+0002cc20: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+0002cc30: 2023 2041 6c6c 2072 6574 7269 6576 616c   # All retrieval
+0002cc40: 7320 6172 6520 646f 6e65 2c20 6e6f 7720  s are done, now 
+0002cc50: 7765 2063 616e 2064 6f77 6e6c 6f61 6420  we can download 
+0002cc60: 7468 6520 6669 6c65 730a 2020 2020 2020  the files.      
+0002cc70: 2020 736f 7572 6365 203d 2027 3a73 333a    source = ':s3:
+0002cc80: 2720 2b20 6275 636b 6574 202b 2027 2f27  ' + bucket + '/'
+0002cc90: 202b 2070 7265 6669 780a 2020 2020 2020   + prefix.      
+0002cca0: 2020 7461 7267 6574 203d 2066 6f6c 6465    target = folde
+0002ccb0: 720a 0a20 2020 2020 2020 2023 2044 6f77  r..        # Dow
+0002ccc0: 6e6c 6f61 6420 7468 6520 7265 7374 6f72  nload the restor
+0002ccd0: 6564 2066 696c 6573 0a20 2020 2020 2020  ed files.       
+0002cce0: 2070 7269 6e74 2866 2744 6f77 6e6c 6f61   print(f'Downloa
+0002ccf0: 6469 6e67 2066 696c 6573 2e2e 2e27 290a  ding files...').
+0002cd00: 2020 2020 2020 2020 7263 6c6f 6e65 203d          rclone =
+0002cd10: 2052 636c 6f6e 6528 7365 6c66 2e61 7267   Rclone(self.arg
+0002cd20: 732c 2073 656c 662e 6366 6729 0a20 2020  s, self.cfg).   
+0002cd30: 2020 2020 2069 6620 7263 6c6f 6e65 2e63       if rclone.c
+0002cd40: 6f70 7928 736f 7572 6365 2c20 7461 7267  opy(source, targ
+0002cd50: 6574 2c20 272d 2d6d 6178 2d64 6570 7468  et, '--max-depth
+0002cd60: 272c 2027 3127 293a 0a20 2020 2020 2020  ', '1'):.       
+0002cd70: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+0002cd80: 2e2e 2e64 6f6e 655c 6e27 290a 2020 2020  ...done\n').    
+0002cd90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002cda0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+0002cdb0: 202e 2e2e 4641 494c 4544 5c6e 2729 0a0a   ...FAILED\n')..
+0002cdc0: 2020 2020 2020 2020 2320 6368 6563 6b73          # checks
+0002cdd0: 756d 2076 6572 6966 6963 6174 696f 6e0a  um verification.
+0002cde0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+0002cdf0: 7374 6f72 655f 7665 7269 6679 2873 6f75  store_verify(sou
+0002ce00: 7263 652c 2074 6172 6765 7429 0a0a 2020  rce, target)..  
+0002ce10: 2020 6465 6620 5f72 6573 746f 7265 5f6c    def _restore_l
+0002ce20: 6f63 616c 6c79 2873 656c 662c 2066 6f6c  ocally(self, fol
+0002ce30: 6465 722c 2061 7773 3a20 4157 5342 6f74  der, aws: AWSBot
+0002ce40: 6f29 3a0a 2020 2020 2020 2020 7472 793a  o):.        try:
+0002ce50: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0002ce60: 696e 7428 6627 5c6e 5265 7374 6f72 696e  int(f'\nRestorin
+0002ce70: 6720 666f 6c64 6572 2022 7b66 6f6c 6465  g folder "{folde
+0002ce80: 727d 2e2e 2e22 5c6e 2729 0a0a 2020 2020  r}..."\n')..    
+0002ce90: 2020 2020 2020 2020 2320 4765 7420 666f          # Get fo
+0002cea0: 6c64 6572 2069 6e66 6f0a 2020 2020 2020  lder info.      
+0002ceb0: 2020 2020 2020 6275 636b 6574 2c20 7072        bucket, pr
+0002cec0: 6566 6978 2c20 6973 5f72 6563 7572 7369  efix, is_recursi
+0002ced0: 7665 2c20 6973 5f67 6c61 6369 6572 2c20  ve, is_glacier, 
+0002cee0: 7072 6f66 696c 652c 2075 7365 7220 3d20  profile, user = 
+0002cef0: 7365 6c66 2e61 7263 6869 7665 5f67 6574  self.archive_get
+0002cf00: 5f62 7563 6b65 745f 696e 666f 280a 2020  _bucket_info(.  
+0002cf10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0002cf20: 6c64 6572 290a 0a20 2020 2020 2020 2020  lder)..         
+0002cf30: 2020 2069 6620 6973 5f67 6c61 6369 6572     if is_glacier
+0002cf40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002cf50: 2020 7472 6967 2c20 7265 7374 2c20 646f    trig, rest, do
+0002cf60: 6e65 2c20 6e6f 7467 203d 2061 7773 2e67  ne, notg = aws.g
+0002cf70: 6c61 6369 6572 5f72 6573 746f 7265 280a  lacier_restore(.
 0002cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf90: 2020 2756 616c 7565 7327 3a20 5b27 416d    'Values': ['Am
-0002cfa0: 617a 6f6e 2045 6c61 7374 6963 2043 6f6d  azon Elastic Com
-0002cfb0: 7075 7465 2043 6c6f 7564 202d 2043 6f6d  pute Cloud - Com
-0002cfc0: 7075 7465 275d 0a20 2020 2020 2020 2020  pute'].         
-0002cfd0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0002cfe0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
-0002cff0: 2020 2020 4772 616e 756c 6172 6974 793d      Granularity=
-0002d000: 274d 4f4e 5448 4c59 272c 0a20 2020 2020  'MONTHLY',.     
-0002d010: 2020 2020 2020 204d 6574 7269 6373 3d5b         Metrics=[
-0002d020: 2755 6e62 6c65 6e64 6564 436f 7374 275d  'UnblendedCost']
-0002d030: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-0002d040: 2020 2020 6d6f 6e74 686c 795f 636f 7374      monthly_cost
-0002d050: 203d 2066 6c6f 6174 280a 2020 2020 2020   = float(.      
-0002d060: 2020 2020 2020 6d6f 6e74 686c 795f 7265        monthly_re
-0002d070: 7370 6f6e 7365 5b27 5265 7375 6c74 7342  sponse['ResultsB
-0002d080: 7954 696d 6527 5d5b 305d 5b27 546f 7461  yTime'][0]['Tota
-0002d090: 6c27 5d5b 2755 6e62 6c65 6e64 6564 436f  l']['UnblendedCo
-0002d0a0: 7374 275d 5b27 416d 6f75 6e74 275d 290a  st']['Amount']).
-0002d0b0: 2020 2020 2020 2020 6d6f 6e74 686c 795f          monthly_
-0002d0c0: 756e 6974 203d 206d 6f6e 7468 6c79 5f72  unit = monthly_r
-0002d0d0: 6573 706f 6e73 655b 2752 6573 756c 7473  esponse['Results
-0002d0e0: 4279 5469 6d65 275d 5b30 5d5b 2754 6f74  ByTime'][0]['Tot
-0002d0f0: 616c 275d 5b27 556e 626c 656e 6465 6443  al']['UnblendedC
-0002d100: 6f73 7427 5d5b 2755 6e69 7427 5d0a 0a20  ost']['Unit'].. 
-0002d110: 2020 2020 2020 2023 2049 6620 6974 2773         # If it's
-0002d120: 2074 6865 2072 6f6f 7420 7573 6572 2c20   the root user, 
-0002d130: 7468 6520 7768 6f6c 6520 6163 636f 756e  the whole accoun
-0002d140: 7427 7320 636f 7374 7320 6172 6520 6173  t's costs are as
-0002d150: 7375 6d65 6420 746f 2062 6520 6361 7573  sumed to be caus
-0002d160: 6564 2062 7920 726f 6f74 2e0a 2020 2020  ed by root..    
-0002d170: 2020 2020 6966 2069 735f 726f 6f74 3a0a      if is_root:.
-0002d180: 2020 2020 2020 2020 2020 2020 7573 6572              user
-0002d190: 5f6e 616d 6520 3d20 2772 6f6f 7427 0a20  _name = 'root'. 
-0002d1a0: 2020 2020 2020 2020 2020 2075 7365 725f             user_
-0002d1b0: 6d6f 6e74 686c 795f 636f 7374 203d 206d  monthly_cost = m
-0002d1c0: 6f6e 7468 6c79 5f63 6f73 740a 2020 2020  onthly_cost.    
-0002d1d0: 2020 2020 2020 2020 7573 6572 5f6d 6f6e          user_mon
-0002d1e0: 7468 6c79 5f75 6e69 7420 3d20 6d6f 6e74  thly_unit = mont
-0002d1f0: 686c 795f 756e 6974 0a20 2020 2020 2020  hly_unit.       
-0002d200: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002d210: 2020 2023 2041 7373 756d 696e 6720 6120     # Assuming a 
-0002d220: 7461 6720 6043 7265 6174 6564 4279 6020  tag `CreatedBy` 
-0002d230: 2863 6861 6e67 6520 6173 2070 6572 2079  (change as per y
-0002d240: 6f75 7220 7461 6767 696e 6720 7379 7374  our tagging syst
-0002d250: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
-0002d260: 7573 6572 5f6e 616d 6520 3d20 7573 6572  user_name = user
-0002d270: 5f61 726e 2e73 706c 6974 2827 2f27 295b  _arn.split('/')[
-0002d280: 2d31 5d0a 2020 2020 2020 2020 2020 2020  -1].            
-0002d290: 7573 6572 5f6d 6f6e 7468 6c79 5f72 6573  user_monthly_res
-0002d2a0: 706f 6e73 6520 3d20 7365 6c66 2e63 655f  ponse = self.ce_
-0002d2b0: 636c 6965 6e74 2e67 6574 5f63 6f73 745f  client.get_cost_
-0002d2c0: 616e 645f 7573 6167 6528 0a20 2020 2020  and_usage(.     
-0002d2d0: 2020 2020 2020 2020 2020 2054 696d 6550             TimeP
-0002d2e0: 6572 696f 643d 7b0a 2020 2020 2020 2020  eriod={.        
-0002d2f0: 2020 2020 2020 2020 2020 2020 2753 7461              'Sta
-0002d300: 7274 273a 2073 7472 2866 6972 7374 5f64  rt': str(first_d
-0002d310: 6179 5f6f 665f 6d6f 6e74 6829 2c0a 2020  ay_of_month),.  
-0002d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d330: 2020 2745 6e64 273a 2073 7472 2874 6f64    'End': str(tod
-0002d340: 6179 2e64 6174 6528 2929 0a20 2020 2020  ay.date()).     
-0002d350: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-0002d360: 2020 2020 2020 2020 2020 2020 2020 4669                Fi
-0002d370: 6c74 6572 3d7b 0a20 2020 2020 2020 2020  lter={.         
-0002d380: 2020 2020 2020 2020 2020 2022 416e 6422             "And"
-0002d390: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
-0002d3a0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-0002d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d3c0: 2020 2020 2020 2020 2020 2744 696d 656e            'Dimen
-0002d3d0: 7369 6f6e 7327 3a20 7b0a 2020 2020 2020  sions': {.      
-0002d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d3f0: 2020 2020 2020 2020 2020 274b 6579 273a            'Key':
-0002d400: 2027 5345 5256 4943 4527 2c0a 2020 2020   'SERVICE',.    
-0002d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d420: 2020 2020 2020 2020 2020 2020 2756 616c              'Val
-0002d430: 7565 7327 3a20 5b27 416d 617a 6f6e 2045  ues': ['Amazon E
-0002d440: 6c61 7374 6963 2043 6f6d 7075 7465 2043  lastic Compute C
-0002d450: 6c6f 7564 202d 2043 6f6d 7075 7465 275d  loud - Compute']
-0002d460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d470: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-0002d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d490: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-0002d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d4b0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-0002d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d4d0: 2754 6167 7327 3a20 7b0a 2020 2020 2020  'Tags': {.      
+0002cf90: 2020 2020 6275 636b 6574 2c20 7072 6566      bucket, pref
+0002cfa0: 6978 2c20 7365 6c66 2e61 7267 732e 6461  ix, self.args.da
+0002cfb0: 7973 2c20 7365 6c66 2e61 7267 732e 7265  ys, self.args.re
+0002cfc0: 7472 6965 7665 6f70 7429 0a0a 2020 2020  trieveopt)..    
+0002cfd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002cfe0: 7428 6627 2020 2020 5472 6967 6765 7265  t(f'    Triggere
+0002cff0: 6420 476c 6163 6965 7220 7265 7472 6965  d Glacier retrie
+0002d000: 7661 6c73 3a20 7b6c 656e 2874 7269 6729  vals: {len(trig)
+0002d010: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+0002d020: 2020 2020 7072 696e 7428 6627 2020 2020      print(f'    
+0002d030: 4375 7272 656e 746c 7920 7265 7472 6965  Currently retrie
+0002d040: 7669 6e67 2066 726f 6d20 476c 6163 6965  ving from Glacie
+0002d050: 723a 207b 6c65 6e28 7265 7374 297d 2729  r: {len(rest)}')
+0002d060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d070: 2070 7269 6e74 2866 2720 2020 2052 6574   print(f'    Ret
+0002d080: 7269 6576 6564 2066 726f 6d20 476c 6163  rieved from Glac
+0002d090: 6965 723a 207b 6c65 6e28 646f 6e65 297d  ier: {len(done)}
+0002d0a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002d0b0: 2020 2070 7269 6e74 2866 2720 2020 204e     print(f'    N
+0002d0c0: 6f74 2069 6e20 476c 6163 6965 723a 207b  ot in Glacier: {
+0002d0d0: 6c65 6e28 6e6f 7467 297d 5c6e 2729 0a0a  len(notg)}\n')..
+0002d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0f0: 6966 206c 656e 2874 7269 6729 203e 2030  if len(trig) > 0
+0002d100: 206f 7220 6c65 6e28 7265 7374 2920 3e20   or len(rest) > 
+0002d110: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0002d120: 2020 2020 2020 2023 2067 6c61 6369 6572         # glacier
+0002d130: 2069 7320 7374 696c 6c20 6f6e 676f 696e   is still ongoin
+0002d140: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+0002d150: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0002d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d170: 2020 2020 2066 275c 6e20 2020 2047 6c61       f'\n    Gla
+0002d180: 6369 6572 2072 6574 7269 6576 616c 7320  cier retrievals 
+0002d190: 7065 6e64 696e 672e 2044 6570 656e 6469  pending. Dependi
+0002d1a0: 6e67 206f 6e20 7468 6520 7374 6f72 6167  ng on the storag
+0002d1b0: 6520 636c 6173 7320 616e 6420 7265 7374  e class and rest
+0002d1c0: 6f72 6520 6d6f 6465 2072 756e 2074 6869  ore mode run thi
+0002d1d0: 7320 636f 6d6d 616e 6420 6167 6169 6e20  s command again 
+0002d1e0: 696e 3a27 290a 2020 2020 2020 2020 2020  in:').          
+0002d1f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002d200: 6627 2020 2020 2020 2020 4578 7065 6469  f'        Expedi
+0002d210: 7465 6420 6d6f 6465 3a20 7e20 3520 6d69  ted mode: ~ 5 mi
+0002d220: 6e75 7473 5c6e 2729 0a20 2020 2020 2020  nuts\n').       
+0002d230: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002d240: 6e74 2866 2720 2020 2020 2020 2053 7461  nt(f'        Sta
+0002d250: 6e64 6172 6420 6d6f 6465 3a20 7e20 3132  ndard mode: ~ 12
+0002d260: 2068 6f75 7273 5c6e 2729 0a20 2020 2020   hours\n').     
+0002d270: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002d280: 7269 6e74 2866 2720 2020 2020 2020 2042  rint(f'        B
+0002d290: 756c 6b20 6d6f 6465 3a20 7e20 3438 2068  ulk mode: ~ 48 h
+0002d2a0: 6f75 7273 5c6e 2729 0a20 2020 2020 2020  ours\n').       
+0002d2b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002d2c0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0002d2d0: 2020 2020 2020 2020 2020 2020 6627 2020              f'  
+0002d2e0: 2020 2020 2020 5c6e 4e4f 5445 3a20 596f        \nNOTE: Yo
+0002d2f0: 7520 6361 6e20 6368 6563 6b20 6d6f 7265  u can check more
+0002d300: 2061 6363 7572 6174 6520 7469 6d65 7320   accurate times 
+0002d310: 696e 2074 6865 2041 5753 2053 3320 636f  in the AWS S3 co
+0002d320: 6e73 6f6c 655c 6e27 290a 2020 2020 2020  nsole\n').      
+0002d330: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002d340: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0002d350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002d360: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002d370: 6e74 2866 272e 2e2e 6e6f 2067 6c61 6369  nt(f'...no glaci
+0002d380: 6572 2072 6573 746f 7265 206e 6565 6465  er restore neede
+0002d390: 645c 6e27 290a 0a20 2020 2020 2020 2020  d\n')..         
+0002d3a0: 2020 2070 7269 6e74 2866 272e 2e2e 666f     print(f'...fo
+0002d3b0: 6c64 6572 2072 6573 746f 7265 645c 6e27  lder restored\n'
+0002d3c0: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0002d3d0: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+0002d3e0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0002d3f0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0002d400: 2020 7072 696e 745f 6572 726f 7228 290a    print_error().
+0002d410: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0002d420: 6578 6974 2831 290a 0a20 2020 2064 6566  exit(1)..    def
+0002d430: 205f 636f 6e74 6169 6e73 5f6e 6f6e 5f66   _contains_non_f
+0002d440: 726f 7374 6572 5f66 696c 6573 2873 656c  roster_files(sel
+0002d450: 662c 2066 6f6c 6465 7229 3a0a 2020 2020  f, folder):.    
+0002d460: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0002d470: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+0002d480: 7468 6520 666f 6c64 6572 2068 6173 2061  the folder has a
+0002d490: 6e79 206e 6f6e 2d66 726f 7374 6572 2066  ny non-froster f
+0002d4a0: 696c 650a 0a20 2020 2020 2020 2020 2020  ile..           
+0002d4b0: 2066 6f72 2072 6f6f 742c 2064 6972 732c   for root, dirs,
+0002d4c0: 2066 696c 6573 2069 6e20 7365 6c66 2e5f   files in self._
+0002d4d0: 7761 6c6b 6572 2866 6f6c 6465 7229 3a0a  walker(folder):.
 0002d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d4f0: 2020 2020 2020 2020 2020 274b 6579 273a            'Key':
-0002d500: 2027 4372 6561 7465 6442 7927 2c0a 2020   'CreatedBy',.  
-0002d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d520: 2020 2020 2020 2020 2020 2020 2020 2756                'V
-0002d530: 616c 7565 7327 3a20 5b75 7365 725f 6e61  alues': [user_na
-0002d540: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
-0002d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d560: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0002d570: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0002d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d590: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0002d5a0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
-0002d5b0: 2020 2020 2047 7261 6e75 6c61 7269 7479       Granularity
-0002d5c0: 3d27 4d4f 4e54 484c 5927 2c0a 2020 2020  ='MONTHLY',.    
-0002d5d0: 2020 2020 2020 2020 2020 2020 4d65 7472              Metr
-0002d5e0: 6963 733d 5b27 556e 626c 656e 6465 6443  ics=['UnblendedC
-0002d5f0: 6f73 7427 5d2c 0a20 2020 2020 2020 2020  ost'],.         
-0002d600: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0002d610: 2075 7365 725f 6d6f 6e74 686c 795f 636f   user_monthly_co
-0002d620: 7374 203d 2066 6c6f 6174 280a 2020 2020  st = float(.    
-0002d630: 2020 2020 2020 2020 2020 2020 7573 6572              user
-0002d640: 5f6d 6f6e 7468 6c79 5f72 6573 706f 6e73  _monthly_respons
-0002d650: 655b 2752 6573 756c 7473 4279 5469 6d65  e['ResultsByTime
-0002d660: 275d 5b30 5d5b 2754 6f74 616c 275d 5b27  '][0]['Total']['
-0002d670: 556e 626c 656e 6465 6443 6f73 7427 5d5b  UnblendedCost'][
-0002d680: 2741 6d6f 756e 7427 5d29 0a20 2020 2020  'Amount']).     
-0002d690: 2020 2020 2020 2075 7365 725f 6d6f 6e74         user_mont
-0002d6a0: 686c 795f 756e 6974 203d 2075 7365 725f  hly_unit = user_
-0002d6b0: 6d6f 6e74 686c 795f 7265 7370 6f6e 7365  monthly_response
-0002d6c0: 5b27 5265 7375 6c74 7342 7954 696d 6527  ['ResultsByTime'
-0002d6d0: 5d5b 305d 5b27 546f 7461 6c27 5d5b 2755  ][0]['Total']['U
-0002d6e0: 6e62 6c65 6e64 6564 436f 7374 275d 5b27  nblendedCost']['
-0002d6f0: 556e 6974 275d 0a0a 2020 2020 2020 2020  Unit']..        
-0002d700: 2320 4665 7463 6820 636f 7374 206f 6620  # Fetch cost of 
-0002d710: 6561 6368 2045 4332 2069 6e73 7461 6e63  each EC2 instanc
-0002d720: 6520 7479 7065 2069 6e20 7468 6520 6c61  e type in the la
-0002d730: 7374 2032 3420 686f 7572 730a 2020 2020  st 24 hours.    
-0002d740: 2020 2020 6461 696c 795f 7265 7370 6f6e      daily_respon
-0002d750: 7365 203d 2073 656c 662e 6365 5f63 6c69  se = self.ce_cli
-0002d760: 656e 742e 6765 745f 636f 7374 5f61 6e64  ent.get_cost_and
-0002d770: 5f75 7361 6765 280a 2020 2020 2020 2020  _usage(.        
-0002d780: 2020 2020 5469 6d65 5065 7269 6f64 3d7b      TimePeriod={
-0002d790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d7a0: 2027 5374 6172 7427 3a20 7374 7228 7965   'Start': str(ye
-0002d7b0: 7374 6572 6461 7929 2c0a 2020 2020 2020  sterday),.      
-0002d7c0: 2020 2020 2020 2020 2020 2745 6e64 273a            'End':
-0002d7d0: 2073 7472 2874 6f64 6179 2e64 6174 6528   str(today.date(
-0002d7e0: 2929 0a20 2020 2020 2020 2020 2020 207d  )).            }
-0002d7f0: 2c0a 2020 2020 2020 2020 2020 2020 4669  ,.            Fi
-0002d800: 6c74 6572 3d7b 0a20 2020 2020 2020 2020  lter={.         
-0002d810: 2020 2020 2020 2027 4469 6d65 6e73 696f         'Dimensio
-0002d820: 6e73 273a 207b 0a20 2020 2020 2020 2020  ns': {.         
-0002d830: 2020 2020 2020 2020 2020 2027 4b65 7927             'Key'
-0002d840: 3a20 2753 4552 5649 4345 272c 0a20 2020  : 'SERVICE',.   
-0002d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d860: 2027 5661 6c75 6573 273a 205b 2741 6d61   'Values': ['Ama
-0002d870: 7a6f 6e20 456c 6173 7469 6320 436f 6d70  zon Elastic Comp
-0002d880: 7574 6520 436c 6f75 6420 2d20 436f 6d70  ute Cloud - Comp
-0002d890: 7574 6527 5d0a 2020 2020 2020 2020 2020  ute'].          
-0002d8a0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0002d8b0: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
-0002d8c0: 2020 2047 7261 6e75 6c61 7269 7479 3d27     Granularity='
-0002d8d0: 4441 494c 5927 2c0a 2020 2020 2020 2020  DAILY',.        
-0002d8e0: 2020 2020 4772 6f75 7042 793d 5b7b 2754      GroupBy=[{'T
-0002d8f0: 7970 6527 3a20 2744 494d 454e 5349 4f4e  ype': 'DIMENSION
-0002d900: 272c 2027 4b65 7927 3a20 2749 4e53 5441  ', 'Key': 'INSTA
-0002d910: 4e43 455f 5459 5045 277d 5d2c 0a20 2020  NCE_TYPE'}],.   
-0002d920: 2020 2020 2020 2020 204d 6574 7269 6373           Metrics
-0002d930: 3d5b 2755 6e62 6c65 6e64 6564 436f 7374  =['UnblendedCost
-0002d940: 275d 2c0a 2020 2020 2020 2020 290a 2020  '],.        ).  
-0002d950: 2020 2020 2020 6461 696c 795f 636f 7374        daily_cost
-0002d960: 735f 6279 5f69 6e73 7461 6e63 6520 3d20  s_by_instance = 
-0002d970: 7b67 726f 7570 5b27 4b65 7973 275d 5b30  {group['Keys'][0
-0002d980: 5d3a 2028 666c 6f61 7428 6772 6f75 705b  ]: (float(group[
-0002d990: 274d 6574 7269 6373 275d 5b27 556e 626c  'Metrics']['Unbl
-0002d9a0: 656e 6465 6443 6f73 7427 5d5b 2741 6d6f  endedCost']['Amo
-0002d9b0: 756e 7427 5d29 2c0a 2020 2020 2020 2020  unt']),.        
-0002d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d4f0: 6966 2072 6f6f 7420 213d 2066 6f6c 6465  if root != folde
+0002d500: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0002d510: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0002d520: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0002d530: 2066 696c 6520 696e 2066 696c 6573 3a0a   file in files:.
+0002d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d550: 2020 2020 6966 2066 696c 6520 6e6f 7420      if file not 
+0002d560: 696e 2073 656c 662e 6469 726d 6574 6166  in self.dirmetaf
+0002d570: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+0002d580: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002d590: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0002d5a0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0002d5b0: 7565 0a0a 2020 2020 2020 2020 6578 6365  ue..        exce
+0002d5c0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0002d5d0: 7072 696e 745f 6572 726f 7228 290a 2020  print_error().  
+0002d5e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002d5f0: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
+0002d600: 7265 7374 6f72 6528 7365 6c66 2c20 666f  restore(self, fo
+0002d610: 6c64 6572 732c 2061 7773 3a20 4157 5342  lders, aws: AWSB
+0002d620: 6f74 6f29 3a0a 2020 2020 2020 2020 2727  oto):.        ''
+0002d630: 2752 6573 746f 7265 2074 6865 2067 6976  'Restore the giv
+0002d640: 656e 2066 6f6c 6465 7227 2727 0a0a 2020  en folder'''..  
+0002d650: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0002d660: 2020 2020 2020 2023 2043 6c65 616e 2074         # Clean t
+0002d670: 6865 2070 726f 7669 6465 6420 7061 7468  he provided path
+0002d680: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+0002d690: 6c64 6572 7320 3d20 636c 6561 6e5f 7061  lders = clean_pa
+0002d6a0: 7468 5f6c 6973 7428 666f 6c64 6572 7329  th_list(folders)
+0002d6b0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0002d6c0: 5365 7420 666c 6167 730a 2020 2020 2020  Set flags.      
+0002d6d0: 2020 2020 2020 6973 5f72 6563 7572 7369        is_recursi
+0002d6e0: 7665 203d 2073 656c 662e 6172 6773 2e72  ve = self.args.r
+0002d6f0: 6563 7572 7369 7665 0a0a 2020 2020 2020  ecursive..      
+0002d700: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+0002d710: 2074 6865 7265 2069 7320 6120 636f 6e66   there is a conf
+0002d720: 6c69 6374 2062 6574 7765 656e 2066 6f6c  lict between fol
+0002d730: 6465 7273 2061 6e64 2072 6563 7572 7369  ders and recursi
+0002d740: 7665 2066 6c61 672c 0a20 2020 2020 2020  ve flag,.       
+0002d750: 2020 2020 2023 2069 2e65 2e20 7265 6375       # i.e. recu
+0002d760: 7273 6976 6520 666c 6167 2069 7320 7365  rsive flag is se
+0002d770: 7420 616e 6420 6120 666f 6c64 6572 2069  t and a folder i
+0002d780: 7320 6120 7375 6264 6972 6563 746f 7279  s a subdirectory
+0002d790: 206f 6620 616e 6f74 6865 7220 6f6e 650a   of another one.
+0002d7a0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0002d7b0: 735f 7265 6375 7273 6976 653a 0a20 2020  s_recursive:.   
+0002d7c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002d7d0: 7365 6c66 2e5f 6973 5f72 6563 7572 7369  self._is_recursi
+0002d7e0: 7665 5f63 6f6c 6c69 7369 6f6e 2866 6f6c  ve_collision(fol
+0002d7f0: 6465 7273 293a 0a20 2020 2020 2020 2020  ders):.         
+0002d800: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002d810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002d820: 2020 2020 2020 2020 2020 6627 5c6e 4572            f'\nEr
+0002d830: 726f 723a 2059 6f75 2063 616e 6e6f 7420  ror: You cannot 
+0002d840: 7265 7374 6f72 6520 666f 6c64 6572 7320  restore folders 
+0002d850: 7265 6375 7273 6976 656c 7920 6966 2074  recursively if t
+0002d860: 6865 7265 2069 7320 6120 6465 7065 6e64  here is a depend
+0002d870: 656e 6379 2062 6574 7765 656e 2074 6865  ency between the
+0002d880: 6d2e 5c6e 2729 0a20 2020 2020 2020 2020  m.\n').         
+0002d890: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0002d8a0: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
+0002d8b0: 2020 2020 2320 4368 6563 6b20 6966 2077      # Check if w
+0002d8c0: 6520 6361 6e20 7265 6164 2026 2077 7269  e can read & wri
+0002d8d0: 7465 2061 6c6c 2066 696c 6573 2061 6e64  te all files and
+0002d8e0: 2066 6f6c 6465 7273 0a20 2020 2020 2020   folders.       
+0002d8f0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0002d900: 2e5f 6973 5f63 6f72 7265 6374 5f66 696c  ._is_correct_fil
+0002d910: 6573 5f66 6f6c 6465 7273 5f70 6572 6d69  es_folders_permi
+0002d920: 7373 696f 6e73 2866 6f6c 6465 7273 2c20  ssions(folders, 
+0002d930: 6973 5f72 6563 7572 7369 7665 293a 0a20  is_recursive):. 
+0002d940: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002d950: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+0002d960: 2020 2020 2020 2020 2020 275c 6e45 7272            '\nErr
+0002d970: 6f72 3a20 4361 6e6e 6f74 2072 6561 6420  or: Cannot read 
+0002d980: 6f72 2077 7269 7465 2074 6f20 616c 6c20  or write to all 
+0002d990: 6669 6c65 7320 616e 6420 666f 6c64 6572  files and folder
+0002d9a0: 732e 5c6e 272c 2066 696c 653d 7379 732e  s.\n', file=sys.
+0002d9b0: 7374 6465 7272 290a 2020 2020 2020 2020  stderr).        
+0002d9c0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
 0002d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d9e0: 2020 2020 2020 2020 2020 2020 2020 6772                gr
-0002d9f0: 6f75 705b 274d 6574 7269 6373 275d 5b27  oup['Metrics']['
-0002da00: 556e 626c 656e 6465 6443 6f73 7427 5d5b  UnblendedCost'][
-0002da10: 2755 6e69 7427 5d29 2066 6f72 2067 726f  'Unit']) for gro
-0002da20: 7570 2069 6e20 6461 696c 795f 7265 7370  up in daily_resp
-0002da30: 6f6e 7365 5b27 5265 7375 6c74 7342 7954  onse['ResultsByT
-0002da40: 696d 6527 5d5b 305d 5b27 4772 6f75 7073  ime'][0]['Groups
-0002da50: 275d 7d0a 0a20 2020 2020 2020 2023 2046  ']}..        # F
-0002da60: 6574 6368 2063 6f73 7420 6361 7573 6564  etch cost caused
-0002da70: 2062 7920 7468 6520 6375 7272 656e 7420   by the current 
-0002da80: 7573 6572 2069 6e20 7468 6520 6c61 7374  user in the last
-0002da90: 2032 3420 686f 7572 730a 2020 2020 2020   24 hours.      
-0002daa0: 2020 6966 2069 735f 726f 6f74 3a0a 2020    if is_root:.  
-0002dab0: 2020 2020 2020 2020 2020 7573 6572 5f64            user_d
-0002dac0: 6169 6c79 5f63 6f73 7420 3d20 7375 6d28  aily_cost = sum(
-0002dad0: 5b63 6f73 745b 305d 0a20 2020 2020 2020  [cost[0].       
-0002dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002daf0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-0002db00: 6f73 7420 696e 2064 6169 6c79 5f63 6f73  ost in daily_cos
-0002db10: 7473 5f62 795f 696e 7374 616e 6365 2e76  ts_by_instance.v
-0002db20: 616c 7565 7328 295d 290a 2020 2020 2020  alues()]).      
-0002db30: 2020 2020 2020 2320 5573 696e 6720 6d6f        # Using mo
-0002db40: 6e74 686c 7920 756e 6974 2073 696e 6365  nthly unit since
-0002db50: 2069 7420 7368 6f75 6c64 2062 6520 7468   it should be th
-0002db60: 6520 7361 6d65 2066 6f72 2064 6169 6c79  e same for daily
-0002db70: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-0002db80: 725f 6461 696c 795f 756e 6974 203d 206d  r_daily_unit = m
-0002db90: 6f6e 7468 6c79 5f75 6e69 740a 2020 2020  onthly_unit.    
-0002dba0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002dbb0: 2020 2020 2020 7573 6572 5f64 6169 6c79        user_daily
-0002dbc0: 5f72 6573 706f 6e73 6520 3d20 7365 6c66  _response = self
-0002dbd0: 2e63 655f 636c 6965 6e74 2e67 6574 5f63  .ce_client.get_c
-0002dbe0: 6f73 745f 616e 645f 7573 6167 6528 0a20  ost_and_usage(. 
-0002dbf0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0002dc00: 696d 6550 6572 696f 643d 7b0a 2020 2020  imePeriod={.    
-0002dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc20: 2753 7461 7274 273a 2073 7472 2879 6573  'Start': str(yes
-0002dc30: 7465 7264 6179 292c 0a20 2020 2020 2020  terday),.       
-0002dc40: 2020 2020 2020 2020 2020 2020 2027 456e               'En
-0002dc50: 6427 3a20 7374 7228 746f 6461 792e 6461  d': str(today.da
-0002dc60: 7465 2829 290a 2020 2020 2020 2020 2020  te()).          
-0002dc70: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-0002dc80: 2020 2020 2020 2020 2046 696c 7465 723d           Filter=
-0002dc90: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0002dca0: 2020 2020 2020 2241 6e64 223a 205b 0a20        "And": [. 
+0002d9e0: 2020 2066 2759 6f75 2063 616e 2063 6865     f'You can che
+0002d9f0: 636b 2074 6865 2070 6572 6d69 7373 696f  ck the permissio
+0002da00: 6e73 206f 6620 7468 6520 6669 6c65 7320  ns of the files 
+0002da10: 616e 6420 666f 6c64 6572 7320 7573 696e  and folders usin
+0002da20: 6720 7468 6520 636f 6d6d 616e 643a 272c  g the command:',
+0002da30: 2066 696c 653d 7379 732e 7374 6465 7272   file=sys.stderr
+0002da40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002da50: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0002da60: 2020 2020 2020 2020 2020 2020 2066 2720               f' 
+0002da70: 2020 2066 726f 7374 6572 2061 7263 6869     froster archi
+0002da80: 7665 202d 2d70 6572 6d69 7373 696f 6e73  ve --permissions
+0002da90: 2022 2f79 6f75 722f 666f 6c64 6572 2f74   "/your/folder/t
+0002daa0: 6f2f 6172 6368 6976 6522 5c6e 272c 2066  o/archive"\n', f
+0002dab0: 696c 653d 7379 732e 7374 6465 7272 290a  ile=sys.stderr).
+0002dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dad0: 7379 732e 6578 6974 2831 290a 0a20 2020  sys.exit(1)..   
+0002dae0: 2020 2020 2020 2020 2069 6620 7573 655f           if use_
+0002daf0: 736c 7572 6d28 7365 6c66 2e61 7267 732e  slurm(self.args.
+0002db00: 6e6f 736c 7572 6d29 3a0a 2020 2020 2020  noslurm):.      
+0002db10: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0002db20: 736c 7572 6d5f 636d 6428 666f 6c64 6572  slurm_cmd(folder
+0002db30: 733d 666f 6c64 6572 732c 2063 6d64 5f74  s=folders, cmd_t
+0002db40: 7970 653d 2772 6573 746f 7265 2729 0a0a  ype='restore')..
+0002db50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002db60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002db70: 2020 2320 4172 6368 6976 6520 6c6f 6361    # Archive loca
+0002db80: 6c6c 7920 616c 6c20 666f 6c64 6572 732e  lly all folders.
+0002db90: 2049 6620 7265 6375 7273 6976 6520 666c   If recursive fl
+0002dba0: 6167 2073 6574 2c20 6172 6368 6976 6520  ag set, archive 
+0002dbb0: 616c 6c20 7375 6266 6f6c 6465 7273 2074  all subfolders t
+0002dbc0: 6f6f 2e0a 2020 2020 2020 2020 2020 2020  oo..            
+0002dbd0: 2020 2020 666f 7220 666f 6c64 6572 2069      for folder i
+0002dbe0: 6e20 666f 6c64 6572 733a 0a20 2020 2020  n folders:.     
+0002dbf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002dc00: 6f72 2072 6f6f 742c 2064 6972 732c 2066  or root, dirs, f
+0002dc10: 696c 6573 2069 6e20 7365 6c66 2e5f 7761  iles in self._wa
+0002dc20: 6c6b 6572 2866 6f6c 6465 7229 3a0a 0a20  lker(folder):.. 
+0002dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc40: 2020 2020 2020 2023 2042 7265 616b 2069         # Break i
+0002dc50: 6e20 6361 7365 206f 6620 6e6f 6e2d 7265  n case of non-re
+0002dc60: 6375 7273 6976 6520 7265 7374 6f72 650a  cursive restore.
+0002dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc80: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0002dc90: 735f 7265 6375 7273 6976 6520 616e 6420  s_recursive and 
+0002dca0: 726f 6f74 2021 3d20 666f 6c64 6572 3a0a  root != folder:.
 0002dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dcc0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-0002dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dce0: 2020 2020 2027 4469 6d65 6e73 696f 6e73       'Dimensions
-0002dcf0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-0002dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd10: 2020 2020 2027 4b65 7927 3a20 2753 4552       'Key': 'SER
-0002dd20: 5649 4345 272c 0a20 2020 2020 2020 2020  VICE',.         
-0002dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd40: 2020 2020 2020 2027 5661 6c75 6573 273a         'Values':
-0002dd50: 205b 2741 6d61 7a6f 6e20 456c 6173 7469   ['Amazon Elasti
-0002dd60: 6320 436f 6d70 7574 6520 436c 6f75 6420  c Compute Cloud 
-0002dd70: 2d20 436f 6d70 7574 6527 5d0a 2020 2020  - Compute'].    
+0002dcc0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0002dcd0: 6b0a 0a20 2020 2020 2020 2020 2020 2020  k..             
+0002dce0: 2020 2020 2020 2020 2020 2061 7263 6869             archi
+0002dcf0: 7665 645f 666f 6c64 6572 5f69 6e66 6f20  ved_folder_info 
+0002dd00: 3d20 7365 6c66 2e66 726f 7374 6572 5f61  = self.froster_a
+0002dd10: 7263 6869 7665 735f 6765 745f 656e 7472  rchives_get_entr
+0002dd20: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+0002dd30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002dd40: 6f6f 7429 0a0a 2020 2020 2020 2020 2020  oot)..          
+0002dd50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002dd60: 2061 7263 6869 7665 645f 666f 6c64 6572   archived_folder
+0002dd70: 5f69 6e66 6f20 6973 204e 6f6e 653a 0a20  _info is None:. 
 0002dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd90: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0002dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ddb0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
-0002ddc0: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+0002dd90: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002dda0: 2866 275c 6e46 6f6c 6465 7220 7b72 6f6f  (f'\nFolder {roo
+0002ddb0: 747d 2069 7320 6e6f 7420 6172 6368 6976  t} is not archiv
+0002ddc0: 6564 2729 0a20 2020 2020 2020 2020 2020  ed').           
 0002ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dde0: 2020 2020 2020 2020 2020 2027 5461 6773             'Tags
-0002ddf0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-0002de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de10: 2020 2020 2027 4b65 7927 3a20 2743 7265       'Key': 'Cre
-0002de20: 6174 6564 4279 272c 0a20 2020 2020 2020  atedBy',.       
-0002de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de40: 2020 2020 2020 2020 2027 5661 6c75 6573           'Values
-0002de50: 273a 205b 7573 6572 5f6e 616d 655d 0a20  ': [user_name]. 
-0002de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de70: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0002de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de90: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0002dea0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0002deb0: 2020 2020 2020 2020 2020 2020 207d 2c0a               },.
-0002dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ded0: 4772 616e 756c 6172 6974 793d 2744 4149  Granularity='DAI
-0002dee0: 4c59 272c 0a20 2020 2020 2020 2020 2020  LY',.           
-0002def0: 2020 2020 204d 6574 7269 6373 3d5b 2755       Metrics=['U
-0002df00: 6e62 6c65 6e64 6564 436f 7374 275d 2c0a  nblendedCost'],.
-0002df10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002df20: 2020 2020 2020 2020 2020 7573 6572 5f64            user_d
-0002df30: 6169 6c79 5f63 6f73 7420 3d20 666c 6f61  aily_cost = floa
-0002df40: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0002df50: 2020 2075 7365 725f 6461 696c 795f 7265     user_daily_re
-0002df60: 7370 6f6e 7365 5b27 5265 7375 6c74 7342  sponse['ResultsB
-0002df70: 7954 696d 6527 5d5b 305d 5b27 546f 7461  yTime'][0]['Tota
-0002df80: 6c27 5d5b 2755 6e62 6c65 6e64 6564 436f  l']['UnblendedCo
-0002df90: 7374 275d 5b27 416d 6f75 6e74 275d 290a  st']['Amount']).
-0002dfa0: 2020 2020 2020 2020 2020 2020 7573 6572              user
-0002dfb0: 5f64 6169 6c79 5f75 6e69 7420 3d20 7573  _daily_unit = us
-0002dfc0: 6572 5f64 6169 6c79 5f72 6573 706f 6e73  er_daily_respons
-0002dfd0: 655b 2752 6573 756c 7473 4279 5469 6d65  e['ResultsByTime
-0002dfe0: 275d 5b30 5d5b 2754 6f74 616c 275d 5b27  '][0]['Total']['
-0002dff0: 556e 626c 656e 6465 6443 6f73 7427 5d5b  UnblendedCost'][
-0002e000: 2755 6e69 7427 5d0a 0a20 2020 2020 2020  'Unit']..       
-0002e010: 2072 6574 7572 6e20 6d6f 6e74 686c 795f   return monthly_
-0002e020: 636f 7374 2c20 6d6f 6e74 686c 795f 756e  cost, monthly_un
-0002e030: 6974 2c20 6461 696c 795f 636f 7374 735f  it, daily_costs_
-0002e040: 6279 5f69 6e73 7461 6e63 652c 2075 7365  by_instance, use
-0002e050: 725f 6d6f 6e74 686c 795f 636f 7374 2c20  r_monthly_cost, 
-0002e060: 5c0a 2020 2020 2020 2020 2020 2020 7573  \.            us
-0002e070: 6572 5f6d 6f6e 7468 6c79 5f75 6e69 742c  er_monthly_unit,
-0002e080: 2075 7365 725f 6461 696c 795f 636f 7374   user_daily_cost
-0002e090: 2c20 7573 6572 5f64 6169 6c79 5f75 6e69  , user_daily_uni
-0002e0a0: 742c 2075 7365 725f 6e61 6d65 0a0a 0a63  t, user_name...c
-0002e0b0: 6c61 7373 2053 6372 6565 6e43 6f6e 6669  lass ScreenConfi
-0002e0c0: 726d 284d 6f64 616c 5363 7265 656e 5b62  rm(ModalScreen[b
-0002e0d0: 6f6f 6c5d 293a 0a20 2020 2044 4546 4155  ool]):.    DEFAU
-0002e0e0: 4c54 5f43 5353 203d 2022 2222 0a20 2020  LT_CSS = """.   
-0002e0f0: 2053 6372 6565 6e43 6f6e 6669 726d 207b   ScreenConfirm {
-0002e100: 0a20 2020 2020 2020 2061 6c69 676e 3a20  .        align: 
-0002e110: 6365 6e74 6572 206d 6964 646c 653b 0a20  center middle;. 
-0002e120: 2020 207d 0a0a 2020 2020 5363 7265 656e     }..    Screen
-0002e130: 436f 6e66 6972 6d20 3e20 5665 7274 6963  Confirm > Vertic
-0002e140: 616c 207b 0a20 2020 2020 2020 2062 6163  al {.        bac
-0002e150: 6b67 726f 756e 643a 2024 7365 636f 6e64  kground: $second
-0002e160: 6172 793b 0a20 2020 2020 2020 2077 6964  ary;.        wid
-0002e170: 7468 3a20 6175 746f 3b0a 2020 2020 2020  th: auto;.      
-0002e180: 2020 6865 6967 6874 3a20 6175 746f 3b0a    height: auto;.
-0002e190: 2020 2020 2020 2020 626f 7264 6572 3a20          border: 
-0002e1a0: 7468 6963 6b20 2470 7269 6d61 7279 3b0a  thick $primary;.
-0002e1b0: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
-0002e1c0: 2032 2034 3b0a 2020 2020 7d0a 0a20 2020   2 4;.    }..   
-0002e1d0: 2053 6372 6565 6e43 6f6e 6669 726d 203e   ScreenConfirm >
-0002e1e0: 2056 6572 7469 6361 6c20 3e20 2a20 7b0a   Vertical > * {.
-0002e1f0: 2020 2020 2020 2020 7769 6474 683a 2061          width: a
-0002e200: 7574 6f3b 0a20 2020 2020 2020 2068 6569  uto;.        hei
-0002e210: 6768 743a 2061 7574 6f3b 0a20 2020 207d  ght: auto;.    }
-0002e220: 0a0a 2020 2020 5363 7265 656e 436f 6e66  ..    ScreenConf
-0002e230: 6972 6d20 3e20 5665 7274 6963 616c 203e  irm > Vertical >
-0002e240: 204c 6162 656c 207b 0a20 2020 2020 2020   Label {.       
-0002e250: 2070 6164 6469 6e67 2d62 6f74 746f 6d3a   padding-bottom:
-0002e260: 2032 3b0a 2020 2020 7d0a 0a20 2020 2053   2;.    }..    S
-0002e270: 6372 6565 6e43 6f6e 6669 726d 203e 2056  creenConfirm > V
-0002e280: 6572 7469 6361 6c20 3e20 486f 7269 7a6f  ertical > Horizo
-0002e290: 6e74 616c 207b 0a20 2020 2020 2020 2061  ntal {.        a
-0002e2a0: 6c69 676e 3a20 7269 6768 7420 6d69 6464  lign: right midd
-0002e2b0: 6c65 3b0a 2020 2020 7d0a 0a20 2020 2053  le;.    }..    S
-0002e2c0: 6372 6565 6e43 6f6e 6669 726d 2042 7574  creenConfirm But
-0002e2d0: 746f 6e20 7b0a 2020 2020 2020 2020 6d61  ton {.        ma
-0002e2e0: 7267 696e 2d6c 6566 743a 2032 3b0a 2020  rgin-left: 2;.  
-0002e2f0: 2020 7d0a 2020 2020 2222 220a 0a20 2020    }.    """..   
-0002e300: 2064 6566 2063 6f6d 706f 7365 2873 656c   def compose(sel
-0002e310: 6629 202d 3e20 436f 6d70 6f73 6552 6573  f) -> ComposeRes
-0002e320: 756c 743a 0a20 2020 2020 2020 2077 6974  ult:.        wit
-0002e330: 6820 5665 7274 6963 616c 2829 3a0a 0a20  h Vertical():.. 
-0002e340: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0002e350: 204c 6162 656c 2822 446f 2079 6f75 2077   Label("Do you w
-0002e360: 616e 7420 746f 2073 7461 7274 2074 6869  ant to start thi
-0002e370: 7320 6172 6368 6976 696e 6720 6a6f 6220  s archiving job 
-0002e380: 6e6f 773f 5c6e 4368 6f6f 7365 2027 5175  now?\nChoose 'Qu
-0002e390: 6974 2720 6966 2079 6f75 2077 6f75 6c64  it' if you would
-0002e3a0: 206c 696b 6520 746f 2061 7263 6869 7665   like to archive
-0002e3b0: 2072 6563 7572 7369 7665 6c79 2229 0a20   recursively"). 
-0002e3c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0002e3d0: 486f 7269 7a6f 6e74 616c 2829 3a0a 2020  Horizontal():.  
-0002e3e0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0002e3f0: 656c 6420 4275 7474 6f6e 2822 5374 6172  eld Button("Star
-0002e400: 7420 4a6f 6222 2c20 6964 3d22 636f 6e74  t Job", id="cont
-0002e410: 696e 7565 2229 0a20 2020 2020 2020 2020  inue").         
-0002e420: 2020 2020 2020 2079 6965 6c64 2042 7574         yield But
-0002e430: 746f 6e28 2242 6163 6b20 746f 204c 6973  ton("Back to Lis
-0002e440: 7422 2c20 6964 3d22 7265 7475 726e 2229  t", id="return")
-0002e450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e460: 2079 6965 6c64 2042 7574 746f 6e28 2251   yield Button("Q
-0002e470: 7569 7420 746f 2043 4c49 222c 2069 643d  uit to CLI", id=
-0002e480: 2271 7569 7422 290a 0a20 2020 2064 6566  "quit")..    def
-0002e490: 206f 6e5f 6275 7474 6f6e 5f70 7265 7373   on_button_press
-0002e4a0: 6564 2873 656c 662c 2065 7665 6e74 3a20  ed(self, event: 
-0002e4b0: 4275 7474 6f6e 2e50 7265 7373 6564 2920  Button.Pressed) 
-0002e4c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0002e4d0: 2023 2073 656c 662e 6469 736d 6973 7328   # self.dismiss(
-0002e4e0: 7265 7375 6c74 3d65 7665 6e74 2e62 7574  result=event.but
-0002e4f0: 746f 6e2e 6964 203d 3d20 2263 6f6e 7469  ton.id == "conti
-0002e500: 6e75 6522 290a 2020 2020 2020 2020 7365  nue").        se
-0002e510: 6c66 2e64 6973 6d69 7373 2872 6573 756c  lf.dismiss(resul
-0002e520: 743d 6576 656e 742e 6275 7474 6f6e 2e69  t=event.button.i
-0002e530: 6429 0a0a 0a63 6c61 7373 2054 6162 6c65  d)...class Table
-0002e540: 486f 7473 706f 7473 2841 7070 5b6c 6973  Hotspots(App[lis
-0002e550: 745d 293a 0a0a 2020 2020 4249 4e44 494e  t]):..    BINDIN
-0002e560: 4753 203d 205b 2822 7122 2c20 2272 6571  GS = [("q", "req
-0002e570: 7565 7374 5f71 7569 7422 2c20 2251 7569  uest_quit", "Qui
-0002e580: 7422 295d 0a0a 2020 2020 6465 6620 5f5f  t")]..    def __
-0002e590: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
-0002e5a0: 6529 3a0a 2020 2020 2020 2020 7375 7065  e):.        supe
-0002e5b0: 7228 292e 5f5f 696e 6974 5f5f 2829 0a20  r().__init__(). 
-0002e5c0: 2020 2020 2020 2073 656c 662e 6d79 726f         self.myro
-0002e5d0: 7720 3d20 5b5d 0a20 2020 2020 2020 2073  w = [].        s
-0002e5e0: 656c 662e 6669 6c65 203d 2066 696c 650a  elf.file = file.
-0002e5f0: 0a20 2020 2064 6566 2063 6f6d 706f 7365  .    def compose
-0002e600: 2873 656c 6629 202d 3e20 436f 6d70 6f73  (self) -> Compos
-0002e610: 6552 6573 756c 743a 0a20 2020 2020 2020  eResult:.       
-0002e620: 2074 6162 6c65 203d 2044 6174 6154 6162   table = DataTab
-0002e630: 6c65 2829 0a20 2020 2020 2020 2074 6162  le().        tab
-0002e640: 6c65 2e66 6f63 7573 2829 0a20 2020 2020  le.focus().     
-0002e650: 2020 2074 6162 6c65 2e7a 6562 7261 5f73     table.zebra_s
-0002e660: 7472 6970 6573 203d 2054 7275 650a 2020  tripes = True.  
-0002e670: 2020 2020 2020 7461 626c 652e 6375 7273        table.curs
-0002e680: 6f72 5f74 7970 6520 3d20 2272 6f77 220a  or_type = "row".
-0002e690: 2020 2020 2020 2020 7461 626c 652e 7374          table.st
-0002e6a0: 796c 6573 2e6d 6178 5f68 6569 6768 7420  yles.max_height 
-0002e6b0: 3d20 2239 3976 6822 0a20 2020 2020 2020  = "99vh".       
-0002e6c0: 2079 6965 6c64 2074 6162 6c65 0a20 2020   yield table.   
-0002e6d0: 2020 2020 2023 2079 6965 6c64 2046 6f6f       # yield Foo
-0002e6e0: 7465 7228 290a 0a20 2020 2064 6566 206f  ter()..    def o
-0002e6f0: 6e5f 6d6f 756e 7428 7365 6c66 2920 2d3e  n_mount(self) ->
-0002e700: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
-0002e710: 6162 6c65 203d 2073 656c 662e 7175 6572  able = self.quer
-0002e720: 795f 6f6e 6528 4461 7461 5461 626c 6529  y_one(DataTable)
-0002e730: 0a20 2020 2020 2020 2066 6820 3d20 6f70  .        fh = op
-0002e740: 656e 2873 656c 662e 6669 6c65 2c20 2772  en(self.file, 'r
-0002e750: 2729 0a20 2020 2020 2020 2072 6f77 7320  ').        rows 
-0002e760: 3d20 6373 762e 7265 6164 6572 2866 6829  = csv.reader(fh)
-0002e770: 0a20 2020 2020 2020 2074 6162 6c65 2e61  .        table.a
-0002e780: 6464 5f63 6f6c 756d 6e73 282a 6e65 7874  dd_columns(*next
-0002e790: 2872 6f77 7329 290a 2020 2020 2020 2020  (rows)).        
-0002e7a0: 7461 626c 652e 6164 645f 726f 7773 2869  table.add_rows(i
-0002e7b0: 7465 7274 6f6f 6c73 2e69 736c 6963 6528  tertools.islice(
-0002e7c0: 726f 7773 2c20 4d41 5848 4f54 5350 4f54  rows, MAXHOTSPOT
-0002e7d0: 5329 290a 0a20 2020 2064 6566 2061 6363  S))..    def acc
-0002e7e0: 6570 745f 616e 7377 6572 2873 656c 662c  ept_answer(self,
-0002e7f0: 2061 6e73 7765 723a 2073 7472 2920 2d3e   answer: str) ->
-0002e800: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-0002e810: 2061 6464 7320 7965 736e 6f20 616e 7377   adds yesno answ
-0002e820: 6572 2061 7320 6c61 7374 2065 6c65 6d65  er as last eleme
-0002e830: 6e74 2069 6e20 6c69 7374 0a20 2020 2020  nt in list.     
-0002e840: 2020 2069 6620 616e 7377 6572 203d 3d20     if answer == 
-0002e850: 2763 6f6e 7469 6e75 6527 3a0a 2020 2020  'continue':.    
-0002e860: 2020 2020 2020 2020 7365 6c66 2e65 7869          self.exi
-0002e870: 7428 7365 6c66 2e6d 7972 6f77 2b5b 5472  t(self.myrow+[Tr
-0002e880: 7565 5d29 0a20 2020 2020 2020 2065 6c69  ue]).        eli
-0002e890: 6620 616e 7377 6572 203d 3d20 2771 7569  f answer == 'qui
-0002e8a0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-0002e8b0: 7365 6c66 2e65 7869 7428 7365 6c66 2e6d  self.exit(self.m
-0002e8c0: 7972 6f77 2b5b 4661 6c73 655d 290a 0a20  yrow+[False]).. 
-0002e8d0: 2020 2064 6566 206f 6e5f 6461 7461 5f74     def on_data_t
-0002e8e0: 6162 6c65 5f72 6f77 5f73 656c 6563 7465  able_row_selecte
-0002e8f0: 6428 7365 6c66 2c20 6576 656e 743a 2044  d(self, event: D
-0002e900: 6174 6154 6162 6c65 2e52 6f77 5365 6c65  ataTable.RowSele
-0002e910: 6374 6564 2920 2d3e 204e 6f6e 653a 0a20  cted) -> None:. 
-0002e920: 2020 2020 2020 2073 656c 662e 6d79 726f         self.myro
-0002e930: 7720 3d20 7365 6c66 2e71 7565 7279 5f6f  w = self.query_o
-0002e940: 6e65 2844 6174 6154 6162 6c65 292e 6765  ne(DataTable).ge
-0002e950: 745f 726f 7728 6576 656e 742e 726f 775f  t_row(event.row_
-0002e960: 6b65 7929 0a20 2020 2020 2020 2023 2073  key).        # s
-0002e970: 656c 662e 6578 6974 2873 656c 662e 6d79  elf.exit(self.my
-0002e980: 726f 7729 0a20 2020 2020 2020 2073 656c  row).        sel
-0002e990: 662e 7075 7368 5f73 6372 6565 6e28 5363  f.push_screen(Sc
-0002e9a0: 7265 656e 436f 6e66 6972 6d28 292c 2063  reenConfirm(), c
-0002e9b0: 616c 6c62 6163 6b3d 7365 6c66 2e61 6363  allback=self.acc
-0002e9c0: 6570 745f 616e 7377 6572 290a 0a20 2020  ept_answer)..   
-0002e9d0: 2064 6566 2061 6374 696f 6e5f 7265 7175   def action_requ
-0002e9e0: 6573 745f 7175 6974 2873 656c 6629 202d  est_quit(self) -
-0002e9f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0002ea00: 7365 6c66 2e61 7070 2e65 7869 7428 290a  self.app.exit().
-0002ea10: 0a0a 636c 6173 7320 5465 7874 7561 6c53  ..class TextualS
-0002ea20: 7472 696e 674c 6973 7453 656c 6563 746f  tringListSelecto
-0002ea30: 7228 4170 705b 6c69 7374 5d29 3a0a 0a20  r(App[list]):.. 
-0002ea40: 2020 2042 494e 4449 4e47 5320 3d20 5b28     BINDINGS = [(
-0002ea50: 2271 222c 2022 7265 7175 6573 745f 7175  "q", "request_qu
-0002ea60: 6974 222c 2022 5175 6974 2229 5d0a 0a20  it", "Quit")].. 
-0002ea70: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0002ea80: 7365 6c66 2c20 7469 746c 653a 2073 7472  self, title: str
-0002ea90: 2c20 6974 656d 733a 206c 6973 745b 7374  , items: list[st
-0002eaa0: 725d 293a 0a20 2020 2020 2020 2073 7570  r]):.        sup
-0002eab0: 6572 2829 2e5f 5f69 6e69 745f 5f28 290a  er().__init__().
-0002eac0: 2020 2020 2020 2020 7365 6c66 2e74 6974          self.tit
-0002ead0: 6c65 203d 2074 6974 6c65 0a20 2020 2020  le = title.     
-0002eae0: 2020 2073 656c 662e 6974 656d 7320 3d20     self.items = 
-0002eaf0: 6974 656d 730a 0a20 2020 2064 6566 2063  items..    def c
-0002eb00: 6f6d 706f 7365 2873 656c 6629 202d 3e20  ompose(self) -> 
-0002eb10: 436f 6d70 6f73 6552 6573 756c 743a 0a20  ComposeResult:. 
-0002eb20: 2020 2020 2020 2074 6162 6c65 203d 2044         table = D
-0002eb30: 6174 6154 6162 6c65 2829 0a20 2020 2020  ataTable().     
-0002eb40: 2020 2074 6162 6c65 2e66 6f63 7573 2829     table.focus()
-0002eb50: 0a20 2020 2020 2020 2074 6162 6c65 2e7a  .        table.z
-0002eb60: 6562 7261 5f73 7472 6970 6573 203d 2054  ebra_stripes = T
-0002eb70: 7275 650a 2020 2020 2020 2020 7461 626c  rue.        tabl
-0002eb80: 652e 6375 7273 6f72 5f74 7970 6520 3d20  e.cursor_type = 
-0002eb90: 2272 6f77 220a 2020 2020 2020 2020 7461  "row".        ta
-0002eba0: 626c 652e 7374 796c 6573 2e6d 6178 5f68  ble.styles.max_h
-0002ebb0: 6569 6768 7420 3d20 2239 3976 6822 0a20  eight = "99vh". 
-0002ebc0: 2020 2020 2020 2079 6965 6c64 2074 6162         yield tab
-0002ebd0: 6c65 0a20 2020 2020 2020 2079 6965 6c64  le.        yield
-0002ebe0: 2046 6f6f 7465 7228 290a 0a20 2020 2064   Footer()..    d
-0002ebf0: 6566 206f 6e5f 6d6f 756e 7428 7365 6c66  ef on_mount(self
-0002ec00: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0002ec10: 2020 2074 6162 6c65 203d 2073 656c 662e     table = self.
-0002ec20: 7175 6572 795f 6f6e 6528 4461 7461 5461  query_one(DataTa
-0002ec30: 626c 6529 0a20 2020 2020 2020 2074 6162  ble).        tab
-0002ec40: 6c65 2e61 6464 5f63 6f6c 756d 6e73 2873  le.add_columns(s
-0002ec50: 656c 662e 7469 746c 6529 0a20 2020 2020  elf.title).     
-0002ec60: 2020 2066 6f72 2069 7465 6d20 696e 2073     for item in s
-0002ec70: 656c 662e 6974 656d 733a 0a20 2020 2020  elf.items:.     
-0002ec80: 2020 2020 2020 2074 6162 6c65 2e61 6464         table.add
-0002ec90: 5f72 6f77 2869 7465 6d29 0a0a 2020 2020  _row(item)..    
-0002eca0: 6465 6620 6f6e 5f64 6174 615f 7461 626c  def on_data_tabl
-0002ecb0: 655f 726f 775f 7365 6c65 6374 6564 2873  e_row_selected(s
-0002ecc0: 656c 662c 2065 7665 6e74 3a20 4461 7461  elf, event: Data
-0002ecd0: 5461 626c 652e 526f 7753 656c 6563 7465  Table.RowSelecte
-0002ece0: 6429 202d 3e20 4e6f 6e65 3a0a 2020 2020  d) -> None:.    
-0002ecf0: 2020 2020 7365 6c66 2e65 7869 7428 7365      self.exit(se
-0002ed00: 6c66 2e71 7565 7279 5f6f 6e65 2844 6174  lf.query_one(Dat
-0002ed10: 6154 6162 6c65 292e 6765 745f 726f 7728  aTable).get_row(
-0002ed20: 6576 656e 742e 726f 775f 6b65 7929 290a  event.row_key)).
-0002ed30: 0a20 2020 2064 6566 2061 6374 696f 6e5f  .    def action_
-0002ed40: 7265 7175 6573 745f 7175 6974 2873 656c  request_quit(sel
-0002ed50: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0002ed60: 2020 2020 7365 6c66 2e61 7070 2e65 7869      self.app.exi
-0002ed70: 7428 290a 0a0a 636c 6173 7320 5461 626c  t()...class Tabl
-0002ed80: 6541 7263 6869 7665 2841 7070 5b6c 6973  eArchive(App[lis
-0002ed90: 745d 293a 0a0a 2020 2020 4249 4e44 494e  t]):..    BINDIN
-0002eda0: 4753 203d 205b 2822 7122 2c20 2272 6571  GS = [("q", "req
-0002edb0: 7565 7374 5f71 7569 7422 2c20 2251 7569  uest_quit", "Qui
-0002edc0: 7422 295d 0a0a 2020 2020 6465 6620 5f5f  t")]..    def __
-0002edd0: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
-0002ede0: 6573 3a20 6c69 7374 5b73 7472 5d29 3a0a  es: list[str]):.
-0002edf0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-0002ee00: 5f5f 696e 6974 5f5f 2829 0a20 2020 2020  __init__().     
-0002ee10: 2020 2073 656c 662e 6669 6c65 7320 3d20     self.files = 
-0002ee20: 6669 6c65 730a 0a20 2020 2064 6566 2063  files..    def c
-0002ee30: 6f6d 706f 7365 2873 656c 6629 202d 3e20  ompose(self) -> 
-0002ee40: 436f 6d70 6f73 6552 6573 756c 743a 0a20  ComposeResult:. 
-0002ee50: 2020 2020 2020 2074 6162 6c65 203d 2044         table = D
-0002ee60: 6174 6154 6162 6c65 2829 0a20 2020 2020  ataTable().     
-0002ee70: 2020 2074 6162 6c65 2e66 6f63 7573 2829     table.focus()
-0002ee80: 0a20 2020 2020 2020 2074 6162 6c65 2e7a  .        table.z
-0002ee90: 6562 7261 5f73 7472 6970 6573 203d 2054  ebra_stripes = T
-0002eea0: 7275 650a 2020 2020 2020 2020 7461 626c  rue.        tabl
-0002eeb0: 652e 6375 7273 6f72 5f74 7970 6520 3d20  e.cursor_type = 
-0002eec0: 2272 6f77 220a 2020 2020 2020 2020 7461  "row".        ta
-0002eed0: 626c 652e 7374 796c 6573 2e6d 6178 5f68  ble.styles.max_h
-0002eee0: 6569 6768 7420 3d20 2239 3976 6822 0a20  eight = "99vh". 
-0002eef0: 2020 2020 2020 2023 2074 6162 6c65 2e66         # table.f
-0002ef00: 6978 6564 5f72 6f77 7320 3d20 310a 2020  ixed_rows = 1.  
-0002ef10: 2020 2020 2020 7969 656c 6420 7461 626c        yield tabl
-0002ef20: 650a 2020 2020 2020 2020 7969 656c 6420  e.        yield 
-0002ef30: 466f 6f74 6572 2829 0a0a 2020 2020 6465  Footer()..    de
-0002ef40: 6620 6f6e 5f6d 6f75 6e74 2873 656c 6629  f on_mount(self)
-0002ef50: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0002ef60: 2020 7461 626c 6520 3d20 7365 6c66 2e71    table = self.q
-0002ef70: 7565 7279 5f6f 6e65 2844 6174 6154 6162  uery_one(DataTab
-0002ef80: 6c65 290a 2020 2020 2020 2020 726f 7773  le).        rows
-0002ef90: 203d 2063 7376 2e72 6561 6465 7228 696f   = csv.reader(io
-0002efa0: 2e53 7472 696e 6749 4f28 7365 6c66 2e66  .StringIO(self.f
-0002efb0: 696c 6573 2929 0a20 2020 2020 2020 2074  iles)).        t
-0002efc0: 6162 6c65 2e61 6464 5f63 6f6c 756d 6e73  able.add_columns
-0002efd0: 282a 6e65 7874 2872 6f77 7329 290a 2020  (*next(rows)).  
-0002efe0: 2020 2020 2020 7461 626c 652e 6164 645f        table.add_
-0002eff0: 726f 7773 2869 7465 7274 6f6f 6c73 2e69  rows(itertools.i
-0002f000: 736c 6963 6528 726f 7773 2c20 4d41 5848  slice(rows, MAXH
-0002f010: 4f54 5350 4f54 5329 290a 0a20 2020 2064  OTSPOTS))..    d
-0002f020: 6566 206f 6e5f 6461 7461 5f74 6162 6c65  ef on_data_table
-0002f030: 5f72 6f77 5f73 656c 6563 7465 6428 7365  _row_selected(se
-0002f040: 6c66 2c20 6576 656e 743a 2044 6174 6154  lf, event: DataT
-0002f050: 6162 6c65 2e52 6f77 5365 6c65 6374 6564  able.RowSelected
-0002f060: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0002f070: 2020 2073 656c 662e 6578 6974 2873 656c     self.exit(sel
-0002f080: 662e 7175 6572 795f 6f6e 6528 4461 7461  f.query_one(Data
-0002f090: 5461 626c 6529 2e67 6574 5f72 6f77 2865  Table).get_row(e
-0002f0a0: 7665 6e74 2e72 6f77 5f6b 6579 2929 0a0a  vent.row_key))..
-0002f0b0: 2020 2020 6465 6620 6163 7469 6f6e 5f72      def action_r
-0002f0c0: 6571 7565 7374 5f71 7569 7428 7365 6c66  equest_quit(self
-0002f0d0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0002f0e0: 2020 2073 656c 662e 6170 702e 6578 6974     self.app.exit
-0002f0f0: 2829 0a0a 0a63 6c61 7373 2054 6162 6c65  ()...class Table
-0002f100: 4e49 4847 7261 6e74 7328 4170 705b 6c69  NIHGrants(App[li
-0002f110: 7374 5d29 3a0a 0a20 2020 2044 4546 4155  st]):..    DEFAU
-0002f120: 4c54 5f43 5353 203d 2022 2222 0a20 2020  LT_CSS = """.   
-0002f130: 2049 6e70 7574 2e2d 7661 6c69 6420 7b0a   Input.-valid {.
-0002f140: 2020 2020 2020 2020 626f 7264 6572 3a20          border: 
-0002f150: 7461 6c6c 2024 7375 6363 6573 7320 3630  tall $success 60
-0002f160: 253b 0a20 2020 207d 0a20 2020 2049 6e70  %;.    }.    Inp
-0002f170: 7574 2e2d 7661 6c69 643a 666f 6375 7320  ut.-valid:focus 
-0002f180: 7b0a 2020 2020 2020 2020 626f 7264 6572  {.        border
-0002f190: 3a20 7461 6c6c 2024 7375 6363 6573 733b  : tall $success;
-0002f1a0: 0a20 2020 207d 0a20 2020 2049 6e70 7574  .    }.    Input
-0002f1b0: 207b 0a20 2020 2020 2020 206d 6172 6769   {.        margi
-0002f1c0: 6e3a 2031 2031 3b0a 2020 2020 7d0a 2020  n: 1 1;.    }.  
-0002f1d0: 2020 4c61 6265 6c20 7b0a 2020 2020 2020    Label {.      
-0002f1e0: 2020 6d61 7267 696e 3a20 3120 323b 0a20    margin: 1 2;. 
-0002f1f0: 2020 207d 0a20 2020 2044 6174 6154 6162     }.    DataTab
-0002f200: 6c65 207b 0a20 2020 2020 2020 206d 6172  le {.        mar
-0002f210: 6769 6e3a 2031 2032 3b0a 2020 2020 7d0a  gin: 1 2;.    }.
-0002f220: 2020 2020 2222 220a 0a20 2020 2042 494e      """..    BIN
-0002f230: 4449 4e47 5320 3d20 5b28 2271 222c 2022  DINGS = [("q", "
-0002f240: 7265 7175 6573 745f 7175 6974 222c 2022  request_quit", "
-0002f250: 5175 6974 2229 5d0a 0a20 2020 2064 6566  Quit")]..    def
-0002f260: 2063 6f6d 706f 7365 2873 656c 6629 202d   compose(self) -
-0002f270: 3e20 436f 6d70 6f73 6552 6573 756c 743a  > ComposeResult:
-0002f280: 0a20 2020 2020 2020 2079 6965 6c64 204c  .        yield L
-0002f290: 6162 656c 2822 456e 7465 7220 7365 6172  abel("Enter sear
-0002f2a0: 6368 2074 6f20 6c69 6e6b 2079 6f75 7220  ch to link your 
-0002f2b0: 6461 7461 2077 6974 6820 6d65 7461 6461  data with metada
-0002f2c0: 7461 206f 6620 616e 204e 4948 2067 7261  ta of an NIH gra
-0002f2d0: 6e74 2f70 726f 6a65 6374 2229 0a20 2020  nt/project").   
-0002f2e0: 2020 2020 2079 6965 6c64 2049 6e70 7574       yield Input
-0002f2f0: 280a 2020 2020 2020 2020 2020 2020 706c  (.            pl
-0002f300: 6163 6568 6f6c 6465 723d 2245 6e74 6572  aceholder="Enter
-0002f310: 2061 2070 6172 7420 6f66 2061 2047 7261   a part of a Gra
-0002f320: 6e74 204e 756d 6265 722c 2050 492c 2049  nt Number, PI, I
-0002f330: 6e73 7469 7475 7469 6f6e 206f 7220 4675  nstitution or Fu
-0002f340: 6c6c 2054 6578 7420 2854 6974 6c65 2c20  ll Text (Title, 
-0002f350: 4162 7374 7261 6374 2c20 5465 726d 7329  Abstract, Terms)
-0002f360: 202e 2e2e 222c 0a20 2020 2020 2020 2029   ...",.        )
-0002f370: 0a20 2020 2020 2020 2079 6965 6c64 204c  .        yield L
-0002f380: 6f61 6469 6e67 496e 6469 6361 746f 7228  oadingIndicator(
-0002f390: 290a 2020 2020 2020 2020 7461 626c 6520  ).        table 
-0002f3a0: 3d20 4461 7461 5461 626c 6528 290a 2020  = DataTable().  
-0002f3b0: 2020 2020 2020 2320 7461 626c 652e 666f        # table.fo
-0002f3c0: 6375 7328 290a 2020 2020 2020 2020 7461  cus().        ta
-0002f3d0: 626c 652e 7a65 6272 615f 7374 7269 7065  ble.zebra_stripe
-0002f3e0: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
-0002f3f0: 2074 6162 6c65 2e63 7572 736f 725f 7479   table.cursor_ty
-0002f400: 7065 203d 2022 726f 7722 0a20 2020 2020  pe = "row".     
-0002f410: 2020 2074 6162 6c65 2e73 7479 6c65 732e     table.styles.
-0002f420: 6d61 785f 6865 6967 6874 203d 2022 3939  max_height = "99
-0002f430: 7668 220a 2020 2020 2020 2020 7969 656c  vh".        yiel
-0002f440: 6420 7461 626c 650a 2020 2020 2020 2020  d table.        
-0002f450: 2320 7969 656c 6420 466f 6f74 6572 2829  # yield Footer()
-0002f460: 0a0a 2020 2020 6465 6620 6f6e 5f6d 6f75  ..    def on_mou
-0002f470: 6e74 2873 656c 6629 202d 3e20 4e6f 6e65  nt(self) -> None
-0002f480: 3a0a 2020 2020 2020 2020 7365 6c66 2e71  :.        self.q
-0002f490: 7565 7279 5f6f 6e65 284c 6f61 6469 6e67  uery_one(Loading
-0002f4a0: 496e 6469 6361 746f 7229 2e64 6973 706c  Indicator).displ
-0002f4b0: 6179 203d 2046 616c 7365 0a20 2020 2020  ay = False.     
-0002f4c0: 2020 2073 656c 662e 7175 6572 795f 6f6e     self.query_on
-0002f4d0: 6528 4461 7461 5461 626c 6529 2e64 6973  e(DataTable).dis
-0002f4e0: 706c 6179 203d 2046 616c 7365 0a0a 2020  play = False..  
-0002f4f0: 2020 406f 6e28 496e 7075 742e 5375 626d    @on(Input.Subm
-0002f500: 6974 7465 6429 0a20 2020 2064 6566 2061  itted).    def a
-0002f510: 6374 696f 6e5f 7375 626d 6974 2873 656c  ction_submit(sel
-0002f520: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-0002f530: 2e71 7565 7279 5f6f 6e65 284c 6f61 6469  .query_one(Loadi
-0002f540: 6e67 496e 6469 6361 746f 7229 2e64 6973  ngIndicator).dis
-0002f550: 706c 6179 203d 2054 7275 650a 2020 2020  play = True.    
-0002f560: 2020 2020 7365 6c66 2e71 7565 7279 5f6f      self.query_o
-0002f570: 6e65 2844 6174 6154 6162 6c65 292e 6469  ne(DataTable).di
-0002f580: 7370 6c61 7920 3d20 4661 6c73 650a 2020  splay = False.  
-0002f590: 2020 2020 2020 696e 7020 3d20 7365 6c66        inp = self
-0002f5a0: 2e71 7565 7279 5f6f 6e65 2849 6e70 7574  .query_one(Input
-0002f5b0: 290a 2020 2020 2020 2020 6966 2069 6e70  ).        if inp
-0002f5c0: 2e76 616c 7565 3a0a 2020 2020 2020 2020  .value:.        
-0002f5d0: 2020 2020 7365 6c66 2e6c 6f61 645f 6461      self.load_da
-0002f5e0: 7461 2869 6e70 2e76 616c 7565 290a 2020  ta(inp.value).  
-0002f5f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002f600: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
-0002f610: 2e65 7869 7428 5b5d 290a 2020 2020 2020  .exit([]).      
-0002f620: 2020 696e 702e 666f 6375 7328 290a 0a20    inp.focus().. 
-0002f630: 2020 2064 6566 206f 6e5f 6461 7461 5f74     def on_data_t
-0002f640: 6162 6c65 5f72 6f77 5f73 656c 6563 7465  able_row_selecte
-0002f650: 6428 7365 6c66 2c20 6576 656e 743a 2044  d(self, event: D
-0002f660: 6174 6154 6162 6c65 2e52 6f77 5365 6c65  ataTable.RowSele
-0002f670: 6374 6564 2920 2d3e 204e 6f6e 653a 0a20  cted) -> None:. 
-0002f680: 2020 2020 2020 2073 656c 662e 6578 6974         self.exit
-0002f690: 2873 656c 662e 7175 6572 795f 6f6e 6528  (self.query_one(
-0002f6a0: 4461 7461 5461 626c 6529 2e67 6574 5f72  DataTable).get_r
-0002f6b0: 6f77 2865 7665 6e74 2e72 6f77 5f6b 6579  ow(event.row_key
-0002f6c0: 2929 0a0a 2020 2020 6465 6620 6163 7469  ))..    def acti
-0002f6d0: 6f6e 5f72 6571 7565 7374 5f71 7569 7428  on_request_quit(
-0002f6e0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0002f6f0: 2020 2020 2020 2073 656c 662e 6170 702e         self.app.
-0002f700: 6578 6974 285b 5d29 0a0a 2020 2020 4077  exit([])..    @w
-0002f710: 6f72 6b0a 2020 2020 6173 796e 6320 6465  ork.    async de
-0002f720: 6620 6c6f 6164 5f64 6174 6128 7365 6c66  f load_data(self
-0002f730: 2c20 7365 6172 6368 7374 7229 3a0a 2020  , searchstr):.  
-0002f740: 2020 2020 2020 7461 626c 6520 3d20 7365        table = se
-0002f750: 6c66 2e71 7565 7279 5f6f 6e65 2844 6174  lf.query_one(Dat
-0002f760: 6154 6162 6c65 290a 2020 2020 2020 2020  aTable).        
-0002f770: 7461 626c 652e 636c 6561 7228 636f 6c75  table.clear(colu
-0002f780: 6d6e 733d 5472 7565 290a 0a20 2020 2020  mns=True)..     
-0002f790: 2020 2061 7761 6974 2061 7379 6e63 696f     await asyncio
-0002f7a0: 2e73 6c65 6570 2830 2e31 290a 0a20 2020  .sleep(0.1)..   
-0002f7b0: 2020 2020 2072 6570 203d 204e 4948 5265       rep = NIHRe
-0002f7c0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
-0002f7d0: 2064 6174 6120 3d20 7265 702e 7365 6172   data = rep.sear
-0002f7e0: 6368 5f66 756c 6c28 7365 6172 6368 7374  ch_full(searchst
-0002f7f0: 7229 0a20 2020 2020 2020 2069 6620 6e6f  r).        if no
-0002f800: 7420 6461 7461 3a0a 2020 2020 2020 2020  t data:.        
-0002f810: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0002f820: 2020 2072 6f77 7320 3d20 6974 6572 2864     rows = iter(d
-0002f830: 6174 6129 0a0a 2020 2020 2020 2020 7461  ata)..        ta
-0002f840: 626c 652e 6164 645f 636f 6c75 6d6e 7328  ble.add_columns(
-0002f850: 2a6e 6578 7428 726f 7773 2929 0a20 2020  *next(rows)).   
-0002f860: 2020 2020 2074 6162 6c65 2e61 6464 5f72       table.add_r
-0002f870: 6f77 7328 726f 7773 290a 0a20 2020 2020  ows(rows)..     
-0002f880: 2020 2074 6162 6c65 2e64 6973 706c 6179     table.display
-0002f890: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0002f8a0: 7365 6c66 2e71 7565 7279 5f6f 6e65 284c  self.query_one(L
-0002f8b0: 6f61 6469 6e67 496e 6469 6361 746f 7229  oadingIndicator)
-0002f8c0: 2e64 6973 706c 6179 203d 2046 616c 7365  .display = False
-0002f8d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002f8e0: 0a0a 0a63 6c61 7373 2052 636c 6f6e 653a  ...class Rclone:
-0002f8f0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0002f900: 5f28 7365 6c66 2c20 6172 6773 3a20 6172  _(self, args: ar
-0002f910: 6770 6172 7365 2e4e 616d 6573 7061 6365  gparse.Namespace
-0002f920: 2c20 6366 673a 2043 6f6e 6669 674d 616e  , cfg: ConfigMan
-0002f930: 6167 6572 293a 0a20 2020 2020 2020 2027  ager):.        '
-0002f940: 2727 496e 6974 6961 6c69 7a65 2052 636c  ''Initialize Rcl
-0002f950: 6f6e 6520 6f62 6a65 6374 2727 270a 0a20  one object'''.. 
-0002f960: 2020 2020 2020 2023 2053 746f 7265 2074         # Store t
-0002f970: 6865 2061 7267 756d 656e 7473 2061 6e64  he arguments and
-0002f980: 2063 6f6e 6669 6775 7261 7469 6f6e 0a20   configuration. 
-0002f990: 2020 2020 2020 2073 656c 662e 6172 6773         self.args
-0002f9a0: 203d 2061 7267 730a 2020 2020 2020 2020   = args.        
-0002f9b0: 7365 6c66 2e63 6667 203d 2063 6667 0a0a  self.cfg = cfg..
-0002f9c0: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
-0002f9d0: 6520 5263 6c6f 6e65 2065 7865 6375 7461  e Rclone executa
-0002f9e0: 626c 6520 7061 7468 0a20 2020 2020 2020  ble path.       
-0002f9f0: 2073 656c 662e 7263 203d 206f 732e 7061   self.rc = os.pa
-0002fa00: 7468 2e6a 6f69 6e28 7379 732e 7072 6566  th.join(sys.pref
-0002fa10: 6978 2c20 2762 696e 272c 2027 7263 6c6f  ix, 'bin', 'rclo
-0002fa20: 6e65 2729 0a0a 2020 2020 2020 2020 2320  ne')..        # 
-0002fa30: 5365 7420 7468 6520 5263 6c6f 6e65 2065  Set the Rclone e
-0002fa40: 6e76 6972 6f6e 6d65 6e74 2076 6172 6961  nvironment varia
-0002fa50: 626c 6573 0a20 2020 2020 2020 2073 656c  bles.        sel
-0002fa60: 662e 656e 7672 6e20 3d20 7b7d 0a20 2020  f.envrn = {}.   
-0002fa70: 2020 2020 2073 656c 662e 656e 7672 6e5b       self.envrn[
-0002fa80: 2752 434c 4f4e 455f 5333 5f45 4e56 5f41  'RCLONE_S3_ENV_A
-0002fa90: 5554 4827 5d20 3d20 2774 7275 6527 0a20  UTH'] = 'true'. 
-0002faa0: 2020 2020 2020 2073 656c 662e 656e 7672         self.envr
-0002fab0: 6e5b 2752 434c 4f4e 455f 5333 5f50 524f  n['RCLONE_S3_PRO
-0002fac0: 5649 4445 5227 5d20 3d20 2741 5753 270a  VIDER'] = 'AWS'.
-0002fad0: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
-0002fae0: 726e 5b27 5243 4c4f 4e45 5f53 335f 5052  rn['RCLONE_S3_PR
-0002faf0: 4f46 494c 4527 5d20 3d20 7365 6c66 2e63  OFILE'] = self.c
-0002fb00: 6667 2e61 7773 5f70 726f 6669 6c65 0a20  fg.aws_profile. 
-0002fb10: 2020 2020 2020 2073 656c 662e 656e 7672         self.envr
-0002fb20: 6e5b 2752 434c 4f4e 455f 5333 5f52 4547  n['RCLONE_S3_REG
-0002fb30: 494f 4e27 5d20 3d20 7365 6c66 2e63 6667  ION'] = self.cfg
-0002fb40: 2e61 7773 5f72 6567 696f 6e0a 2020 2020  .aws_region.    
-0002fb50: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
-0002fb60: 5243 4c4f 4e45 5f53 335f 4c4f 4341 5449  RCLONE_S3_LOCATI
-0002fb70: 4f4e 5f43 4f4e 5354 5241 494e 5427 5d20  ON_CONSTRAINT'] 
-0002fb80: 3d20 7365 6c66 2e63 6667 2e61 7773 5f72  = self.cfg.aws_r
-0002fb90: 6567 696f 6e0a 2020 2020 2020 2020 7365  egion.        se
-0002fba0: 6c66 2e65 6e76 726e 5b27 5243 4c4f 4e45  lf.envrn['RCLONE
-0002fbb0: 5f53 335f 5354 4f52 4147 455f 434c 4153  _S3_STORAGE_CLAS
-0002fbc0: 5327 5d20 3d20 7365 6c66 2e63 6667 2e73  S'] = self.cfg.s
-0002fbd0: 746f 7261 6765 5f63 6c61 7373 0a0a 2020  torage_class..  
-0002fbe0: 2020 2320 656e 7375 7265 2074 6861 7420    # ensure that 
-0002fbf0: 6669 6c65 2065 7869 7374 7320 6f72 206e  file exists or n
-0002fc00: 6167 6769 6e67 202f 686f 6d65 2f64 702f  agging /home/dp/
-0002fc10: 2e63 6f6e 6669 672f 7263 6c6f 6e65 2f72  .config/rclone/r
-0002fc20: 636c 6f6e 652e 636f 6e66 0a0a 2020 2020  clone.conf..    
-0002fc30: 2320 6261 636b 7570 3a20 7263 6c6f 6e65  # backup: rclone
-0002fc40: 202d 2d76 6572 626f 7365 202d 2d66 696c   --verbose --fil
-0002fc50: 6573 2d66 726f 6d20 746d 7066 696c 6520  es-from tmpfile 
-0002fc60: 2d2d 7573 652d 6a73 6f6e 2d6c 6f67 2063  --use-json-log c
-0002fc70: 6f70 7920 2d2d 6d61 782d 6465 7074 6820  opy --max-depth 
-0002fc80: 3120 2e2f 7465 7374 732f 203a 7333 3a70  1 ./tests/ :s3:p
-0002fc90: 6f73 6978 2d64 702f 7465 7374 7334 2f20  osix-dp/tests4/ 
-0002fca0: 2d2d 6578 636c 7564 6520 2e66 726f 7374  --exclude .frost
-0002fcb0: 6572 2e6d 6435 7375 6d0a 2020 2020 2320  er.md5sum.    # 
-0002fcc0: 7265 7374 6f72 653a 2072 636c 6f6e 6520  restore: rclone 
-0002fcd0: 2d2d 7665 7262 6f73 6520 2d2d 7573 652d  --verbose --use-
-0002fce0: 6a73 6f6e 2d6c 6f67 2063 6f70 7920 2d2d  json-log copy --
-0002fcf0: 6d61 782d 6465 7074 6820 3120 3a73 333a  max-depth 1 :s3:
-0002fd00: 706f 7369 782d 6470 2f74 6573 7473 342f  posix-dp/tests4/
-0002fd10: 202e 2f74 6573 7473 320a 2020 2020 2320   ./tests2.    # 
-0002fd20: 7263 6c6f 6e65 2063 6f70 7920 2d2d 7665  rclone copy --ve
-0002fd30: 7262 6f73 6520 2d2d 7573 652d 6a73 6f6e  rbose --use-json
-0002fd40: 2d6c 6f67 202d 2d6d 6178 2d64 6570 7468  -log --max-depth
-0002fd50: 2031 2020 3a73 333a 706f 7369 782d 6470   1  :s3:posix-dp
-0002fd60: 2f74 6573 7473 352f 202e 2f74 6573 7473  /tests5/ ./tests
-0002fd70: 350a 2020 2020 2320 7263 6c6f 6e65 202d  5.    # rclone -
-0002fd80: 2d75 7365 2d6a 736f 6e2d 6c6f 6720 6368  -use-json-log ch
-0002fd90: 6563 6b73 756d 206d 6435 202e 2f74 6573  ecksum md5 ./tes
-0002fda0: 7473 2f2e 6672 6f73 7465 722e 6d64 3573  ts/.froster.md5s
-0002fdb0: 756d 203a 7333 3a70 6f73 6978 2d64 702f  um :s3:posix-dp/
-0002fdc0: 7465 7374 7332 2f0a 2020 2020 2320 7374  tests2/.    # st
-0002fdd0: 6f72 6167 6520 7469 6572 2066 6f72 2065  orage tier for e
-0002fde0: 6163 6820 6669 6c65 0a20 2020 2023 2072  ach file.    # r
-0002fdf0: 636c 6f6e 6520 6c73 6620 2d2d 6373 7620  clone lsf --csv 
-0002fe00: 3a73 333a 706f 7369 782d 6470 2f74 6573  :s3:posix-dp/tes
-0002fe10: 7473 342f 202d 2d66 6f72 6d61 743d 7054  ts4/ --format=pT
-0002fe20: 0a20 2020 2023 206c 6973 7420 7769 7468  .    # list with
-0002fe30: 6f75 7420 7375 6264 6972 0a20 2020 2023  out subdir.    #
-0002fe40: 2072 636c 6f6e 6520 6c73 6a73 6f6e 202d   rclone lsjson -
-0002fe50: 2d6d 6574 6164 6174 6120 2d2d 6e6f 2d6d  -metadata --no-m
-0002fe60: 696d 6574 7970 6520 2d2d 6e6f 2d6d 6f64  imetype --no-mod
-0002fe70: 7469 6d65 202d 2d68 6173 6820 3a73 333a  time --hash :s3:
-0002fe80: 706f 7369 782d 6470 2f74 6573 7473 340a  posix-dp/tests4.
-0002fe90: 2020 2020 2320 7263 6c6f 6e65 2063 6865      # rclone che
-0002fea0: 636b 7375 6d20 6d64 3520 2e2f 7465 7374  cksum md5 ./test
-0002feb0: 732f 2e66 726f 7374 6572 2e6d 6435 7375  s/.froster.md5su
-0002fec0: 6d20 2d2d 7665 7262 6f73 6520 2d2d 7573  m --verbose --us
-0002fed0: 652d 6a73 6f6e 2d6c 6f67 203a 7333 3a70  e-json-log :s3:p
-0002fee0: 6f73 6978 2d64 702f 6172 6368 6976 652f  osix-dp/archive/
-0002fef0: 686f 6d65 2f64 702f 6768 2f66 726f 7374  home/dp/gh/frost
-0002ff00: 6572 2f74 6573 7473 0a0a 2020 2020 6465  er/tests..    de
-0002ff10: 6620 5f72 756e 5f72 636c 6f6e 655f 636f  f _run_rclone_co
-0002ff20: 6d6d 616e 6428 7365 6c66 2c20 636f 6d6d  mmand(self, comm
-0002ff30: 616e 6429 3a0a 2020 2020 2020 2020 2727  and):.        ''
-0002ff40: 2752 756e 2052 636c 6f6e 6520 636f 6d6d  'Run Rclone comm
-0002ff50: 616e 6427 2727 0a0a 2020 2020 2020 2020  and'''..        
-0002ff60: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0002ff70: 2023 2041 6464 206f 7074 696f 6e73 2074   # Add options t
-0002ff80: 6f20 5263 6c6f 6e65 2063 6f6d 6d61 6e64  o Rclone command
-0002ff90: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0002ffa0: 6d61 6e64 203d 2073 656c 662e 5f61 6464  mand = self._add
-0002ffb0: 5f6f 7074 2863 6f6d 6d61 6e64 2c20 272d  _opt(command, '-
-0002ffc0: 2d76 6572 626f 7365 2729 0a20 2020 2020  -verbose').     
-0002ffd0: 2020 2020 2020 2063 6f6d 6d61 6e64 203d         command =
-0002ffe0: 2073 656c 662e 5f61 6464 5f6f 7074 2863   self._add_opt(c
-0002fff0: 6f6d 6d61 6e64 2c20 272d 2d75 7365 2d6a  ommand, '--use-j
-00030000: 736f 6e2d 6c6f 6727 290a 2020 2020 2020  son-log').      
-00030010: 2020 2020 2020 636f 6d6d 616e 6420 3d20        command = 
-00030020: 7365 6c66 2e5f 6164 645f 6f70 7428 636f  self._add_opt(co
-00030030: 6d6d 616e 642c 2027 2d2d 7072 6f67 7265  mmand, '--progre
-00030040: 7373 2729 0a0a 2020 2020 2020 2020 2020  ss')..          
-00030050: 2020 2320 5275 6e20 7468 6520 636f 6d6d    # Run the comm
-00030060: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-00030070: 7265 7420 3d20 7375 6270 726f 6365 7373  ret = subprocess
-00030080: 2e72 756e 2863 6f6d 6d61 6e64 2c20 6361  .run(command, ca
-00030090: 7074 7572 655f 6f75 7470 7574 3d54 7275  pture_output=Tru
-000300a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000300b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000300c0: 2020 2020 7465 7874 3d54 7275 652c 2065      text=True, e
-000300d0: 6e76 3d73 656c 662e 656e 7672 6e29 0a0a  nv=self.envrn)..
-000300e0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-000300f0: 6563 6b20 6966 2074 6865 2063 6f6d 6d61  eck if the comma
-00030100: 6e64 2077 6173 2073 7563 6365 7373 6675  nd was successfu
-00030110: 6c0a 2020 2020 2020 2020 2020 2020 6966  l.            if
-00030120: 2072 6574 2e72 6574 7572 6e63 6f64 6520   ret.returncode 
-00030130: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00030140: 2020 2020 2020 2320 4578 6563 7574 696f        # Executio
-00030150: 6e20 7375 6363 6573 7366 756c 6c0a 2020  n successfull.  
-00030160: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00030170: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
-00030180: 2020 2020 2020 2023 2045 7865 6375 7469         # Executi
-00030190: 6f6e 2066 6169 6c65 640a 2020 2020 2020  on failed.      
-000301a0: 2020 2020 2020 6578 6974 5f63 6f64 6573        exit_codes
-000301b0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-000301c0: 2020 2020 2030 3a20 2253 7563 6365 7373       0: "Success
-000301d0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000301e0: 2020 2031 3a20 2253 796e 7461 7820 6f72     1: "Syntax or
-000301f0: 2075 7361 6765 2065 7272 6f72 222c 0a20   usage error",. 
-00030200: 2020 2020 2020 2020 2020 2020 2020 2032                 2
-00030210: 3a20 2245 7272 6f72 206e 6f74 206f 7468  : "Error not oth
-00030220: 6572 7769 7365 2063 6174 6567 6f72 6973  erwise categoris
-00030230: 6564 222c 0a20 2020 2020 2020 2020 2020  ed",.           
-00030240: 2020 2020 2033 3a20 2244 6972 6563 746f       3: "Directo
-00030250: 7279 206e 6f74 2066 6f75 6e64 222c 0a20  ry not found",. 
-00030260: 2020 2020 2020 2020 2020 2020 2020 2034                 4
-00030270: 3a20 2246 696c 6520 6e6f 7420 666f 756e  : "File not foun
-00030280: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00030290: 2020 2020 353a 2022 5465 6d70 6f72 6172      5: "Temporar
-000302a0: 7920 6572 726f 7220 286f 6e65 2074 6861  y error (one tha
-000302b0: 7420 6d6f 7265 2072 6574 7269 6573 206d  t more retries m
-000302c0: 6967 6874 2066 6978 2920 2852 6574 7279  ight fix) (Retry
-000302d0: 2065 7272 6f72 7329 222c 0a20 2020 2020   errors)",.     
-000302e0: 2020 2020 2020 2020 2020 2036 3a20 224c             6: "L
-000302f0: 6573 7320 7365 7269 6f75 7320 6572 726f  ess serious erro
-00030300: 7273 2028 6c69 6b65 2034 3631 2065 7272  rs (like 461 err
-00030310: 6f72 7320 6672 6f6d 2064 726f 7062 6f78  ors from dropbox
-00030320: 2920 284e 6f52 6574 7279 2065 7272 6f72  ) (NoRetry error
-00030330: 7329 222c 0a20 2020 2020 2020 2020 2020  s)",.           
-00030340: 2020 2020 2037 3a20 2246 6174 616c 2065       7: "Fatal e
-00030350: 7272 6f72 2028 6f6e 6520 7468 6174 206d  rror (one that m
-00030360: 6f72 6520 7265 7472 6965 7320 776f 6e27  ore retries won'
-00030370: 7420 6669 782c 206c 696b 6520 6163 636f  t fix, like acco
-00030380: 756e 7420 7375 7370 656e 6465 6429 2028  unt suspended) (
-00030390: 4661 7461 6c20 6572 726f 7273 2922 2c0a  Fatal errors)",.
-000303a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000303b0: 383a 2022 5472 616e 7366 6572 2065 7863  8: "Transfer exc
-000303c0: 6565 6465 6420 2d20 6c69 6d69 7420 7365  eeded - limit se
-000303d0: 7420 6279 202d 2d6d 6178 2d74 7261 6e73  t by --max-trans
-000303e0: 6665 7220 7265 6163 6865 6422 2c0a 2020  fer reached",.  
-000303f0: 2020 2020 2020 2020 2020 2020 2020 393a                9:
-00030400: 2022 4f70 6572 6174 696f 6e20 7375 6363   "Operation succ
-00030410: 6573 7366 756c 2c20 6275 7420 6e6f 2066  essful, but no f
-00030420: 696c 6573 2074 7261 6e73 6665 7272 6564  iles transferred
-00030430: 222c 0a20 2020 2020 2020 2020 2020 207d  ",.            }
-00030440: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00030450: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-00030460: 2020 2020 2066 275c 6e20 2020 2020 2020       f'\n       
-00030470: 2045 7272 6f72 3a20 5263 6c6f 6e65 207b   Error: Rclone {
-00030480: 636f 6d6d 616e 645b 315d 7d20 636f 6d6d  command[1]} comm
-00030490: 616e 6420 6661 696c 6564 272c 2066 696c  and failed', fil
-000304a0: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
-000304b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000304c0: 6627 2020 2020 2020 2020 436f 6d6d 616e  f'        Comman
-000304d0: 643a 207b 2220 222e 6a6f 696e 2863 6f6d  d: {" ".join(com
-000304e0: 6d61 6e64 297d 272c 2066 696c 653d 7379  mand)}', file=sy
-000304f0: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
-00030500: 2020 2020 2020 7072 696e 7428 6627 2020        print(f'  
-00030510: 2020 2020 2020 5265 7475 726e 2063 6f64        Return cod
-00030520: 653a 207b 7265 742e 7265 7475 726e 636f  e: {ret.returnco
-00030530: 6465 7d27 2c20 6669 6c65 3d73 7973 2e73  de}', file=sys.s
-00030540: 7464 6572 7229 0a20 2020 2020 2020 2020  tderr).         
-00030550: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00030560: 2020 2020 2020 2020 2020 6627 2020 2020            f'    
-00030570: 2020 2020 5265 7475 726e 2063 6f64 6520      Return code 
-00030580: 6d65 616e 696e 673a 207b 6578 6974 5f63  meaning: {exit_c
-00030590: 6f64 6573 5b72 6574 2e72 6574 7572 6e63  odes[ret.returnc
-000305a0: 6f64 655d 7d5c 6e27 2c20 6669 6c65 3d73  ode]}\n', file=s
-000305b0: 7973 2e73 7464 6572 7229 0a0a 2020 2020  ys.stderr)..    
-000305c0: 2020 2020 2020 2020 6f75 742c 2065 7272          out, err
-000305d0: 203d 2072 6574 2e73 7464 6f75 742e 7374   = ret.stdout.st
-000305e0: 7269 7028 292c 2072 6574 2e73 7464 6572  rip(), ret.stder
-000305f0: 722e 7374 7269 7028 290a 2020 2020 2020  r.strip().      
-00030600: 2020 2020 2020 7374 6174 732c 206f 7073        stats, ops
-00030610: 203d 2073 656c 662e 5f70 6172 7365 5f6c   = self._parse_l
-00030620: 6f67 2865 7272 290a 2020 2020 2020 2020  og(err).        
-00030630: 2020 2020 7265 7420 3d20 7374 6174 735b      ret = stats[
-00030640: 2d31 5d20 2023 2072 6574 7572 6e20 7468  -1]  # return th
-00030650: 6520 7374 6174 730a 2020 2020 2020 2020  e stats.        
-00030660: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-00030670: 2020 2020 2020 2020 2020 2066 2220 2020             f"   
-00030680: 2020 2020 2045 7272 6f72 206d 6573 7361       Error messa
-00030690: 6765 3a20 7b72 6574 5b27 7374 6174 7327  ge: {ret['stats'
-000306a0: 5d5b 276c 6173 7445 7272 6f72 275d 7d5c  ]['lastError']}\
-000306b0: 6e22 2c20 6669 6c65 3d73 7973 2e73 7464  n", file=sys.std
-000306c0: 6572 7229 0a0a 2020 2020 2020 2020 2020  err)..          
-000306d0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-000306e0: 2020 2020 2020 2020 6578 6365 7074 2073          except s
-000306f0: 7562 7072 6f63 6573 732e 4361 6c6c 6564  ubprocess.Called
-00030700: 5072 6f63 6573 7345 7272 6f72 3a0a 2020  ProcessError:.  
-00030710: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00030720: 662e 6172 6773 2e64 6562 7567 3a0a 2020  f.args.debug:.  
-00030730: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00030740: 696e 745f 6572 726f 7228 290a 2020 2020  int_error().    
-00030750: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00030760: 616c 7365 0a20 2020 2020 2020 2065 7863  alse.        exc
-00030770: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00030780: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00030790: 6c66 2e61 7267 732e 6465 6275 673a 0a20  lf.args.debug:. 
-000307a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000307b0: 7269 6e74 5f65 7272 6f72 2829 0a20 2020  rint_error().   
-000307c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000307d0: 4661 6c73 650a 0a20 2020 2064 6566 205f  False..    def _
-000307e0: 7275 6e5f 626b 2873 656c 662c 2063 6f6d  run_bk(self, com
-000307f0: 6d61 6e64 293a 0a20 2020 2020 2020 2023  mand):.        #
-00030800: 2063 6f6d 6d61 6e64 203d 2073 656c 662e   command = self.
-00030810: 5f61 6464 5f6f 7074 2863 6f6d 6d61 6e64  _add_opt(command
-00030820: 2c20 272d 2d76 6572 626f 7365 2729 0a20  , '--verbose'). 
-00030830: 2020 2020 2020 2023 2063 6f6d 6d61 6e64         # command
-00030840: 203d 2073 656c 662e 5f61 6464 5f6f 7074   = self._add_opt
-00030850: 2863 6f6d 6d61 6e64 2c20 272d 2d75 7365  (command, '--use
-00030860: 2d6a 736f 6e2d 6c6f 6727 290a 2020 2020  -json-log').    
-00030870: 2020 2020 636d 646c 696e 6520 3d20 2220      cmdline = " 
-00030880: 222e 6a6f 696e 2863 6f6d 6d61 6e64 290a  ".join(command).
-00030890: 2020 2020 2020 2020 7072 696e 7464 6267          printdbg
-000308a0: 2827 5263 6c6f 6e65 2063 6f6d 6d61 6e64  ('Rclone command
-000308b0: 3a27 2c20 636d 646c 696e 6529 0a20 2020  :', cmdline).   
-000308c0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000308d0: 2020 2020 2020 7265 7420 3d20 7375 6270        ret = subp
-000308e0: 726f 6365 7373 2e50 6f70 656e 2863 6f6d  rocess.Popen(com
-000308f0: 6d61 6e64 2c20 7072 6565 7865 635f 666e  mand, preexec_fn
-00030900: 3d6f 732e 7365 7473 6964 2c20 7374 6469  =os.setsid, stdi
-00030910: 6e3d 7375 6270 726f 6365 7373 2e50 4950  n=subprocess.PIP
-00030920: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-00030930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030940: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
-00030950: 7072 6f63 6573 732e 5049 5045 2c20 7465  process.PIPE, te
-00030960: 7874 3d54 7275 652c 2065 6e76 3d73 656c  xt=True, env=sel
-00030970: 662e 6366 672e 656e 7672 6e29 0a20 2020  f.cfg.envrn).   
-00030980: 2020 2020 2020 2020 2023 205f 2c20 7374           # _, st
-00030990: 6465 7272 203d 2072 6574 2e63 6f6d 6d75  derr = ret.commu
-000309a0: 6e69 6361 7465 2874 696d 656f 7574 3d33  nicate(timeout=3
-000309b0: 2920 2023 2054 6869 7320 646f 6573 206e  )  # This does n
-000309c0: 6f74 2077 6f72 6b20 7769 7468 2072 636c  ot work with rcl
-000309d0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000309e0: 6966 2072 6574 2e73 7464 6572 723a 0a20  if ret.stderr:. 
-000309f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00030a00: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00030a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030a20: 2020 2020 2066 272a 2a2a 2045 7272 6f72       f'*** Error
-00030a30: 2069 6e20 636f 6d6d 616e 6420 227b 636d   in command "{cm
-00030a40: 646c 696e 657d 223a 5c6e 207b 7265 742e  dline}":\n {ret.
-00030a50: 7374 6465 7272 7d20 2729 0a20 2020 2020  stderr} ').     
-00030a60: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00030a70: 742e 7069 640a 2020 2020 2020 2020 6578  t.pid.        ex
-00030a80: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00030a90: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00030aa0: 2070 7269 6e74 2866 2752 636c 6f6e 6520   print(f'Rclone 
-00030ab0: 4572 726f 723a 207b 7374 7228 6529 7d27  Error: {str(e)}'
-00030ac0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00030ad0: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
-00030ae0: 6566 2063 6f70 7928 7365 6c66 2c20 7372  ef copy(self, sr
-00030af0: 632c 2064 7374 2c20 2a61 7267 7329 3a0a  c, dst, *args):.
-00030b00: 2020 2020 2020 2020 2727 2743 6f70 7920          '''Copy 
-00030b10: 6669 6c65 7320 6672 6f6d 2073 6f75 7263  files from sourc
-00030b20: 6520 746f 2064 6573 7469 6e61 7469 6f6e  e to destination
-00030b30: 2075 7369 6e67 2052 636c 6f6e 6527 2727   using Rclone'''
-00030b40: 0a0a 2020 2020 2020 2020 2320 4275 696c  ..        # Buil
-00030b50: 6420 7468 6520 636f 7079 2063 6f6d 6d61  d the copy comma
-00030b60: 6e64 0a20 2020 2020 2020 2063 6f6d 6d61  nd.        comma
-00030b70: 6e64 203d 205b 7365 6c66 2e72 632c 2027  nd = [self.rc, '
-00030b80: 636f 7079 275d 202b 206c 6973 7428 6172  copy'] + list(ar
-00030b90: 6773 290a 2020 2020 2020 2020 636f 6d6d  gs).        comm
-00030ba0: 616e 642e 6170 7065 6e64 2873 7263 290a  and.append(src).
-00030bb0: 2020 2020 2020 2020 636f 6d6d 616e 642e          command.
-00030bc0: 6170 7065 6e64 2864 7374 290a 0a20 2020  append(dst)..   
-00030bd0: 2020 2020 2023 2052 756e 2074 6865 2063       # Run the c
-00030be0: 6f70 7920 636f 6d6d 616e 6420 616e 6420  opy command and 
-00030bf0: 7265 7475 726e 2069 6620 6974 2077 6173  return if it was
-00030c00: 2073 7563 6365 7373 6675 6c0a 2020 2020   successful.    
-00030c10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00030c20: 5f72 756e 5f72 636c 6f6e 655f 636f 6d6d  _run_rclone_comm
-00030c30: 616e 6428 636f 6d6d 616e 6429 0a0a 2020  and(command)..  
-00030c40: 2020 6465 6620 6368 6563 6b73 756d 2873    def checksum(s
-00030c50: 656c 662c 206d 6435 6669 6c65 2c20 6473  elf, md5file, ds
-00030c60: 742c 202a 6172 6773 293a 0a20 2020 2020  t, *args):.     
-00030c70: 2020 2027 2727 4368 6563 6b20 7468 6520     '''Check the 
-00030c80: 6368 6563 6b73 756d 206f 6620 6120 6669  checksum of a fi
-00030c90: 6c65 2075 7369 6e67 2052 636c 6f6e 6527  le using Rclone'
-00030ca0: 2727 0a0a 2020 2020 2020 2020 636f 6d6d  ''..        comm
-00030cb0: 616e 6420 3d20 5b73 656c 662e 7263 2c20  and = [self.rc, 
-00030cc0: 2763 6865 636b 7375 6d27 5d20 2b20 6c69  'checksum'] + li
-00030cd0: 7374 2861 7267 7329 0a20 2020 2020 2020  st(args).       
-00030ce0: 2063 6f6d 6d61 6e64 2e61 7070 656e 6428   command.append(
-00030cf0: 276d 6435 2729 0a20 2020 2020 2020 2063  'md5').        c
-00030d00: 6f6d 6d61 6e64 2e61 7070 656e 6428 6d64  ommand.append(md
-00030d10: 3566 696c 6529 0a20 2020 2020 2020 2063  5file).        c
-00030d20: 6f6d 6d61 6e64 2e61 7070 656e 6428 6473  ommand.append(ds
-00030d30: 7429 0a0a 2020 2020 2020 2020 7265 7475  t)..        retu
-00030d40: 726e 2073 656c 662e 5f72 756e 5f72 636c  rn self._run_rcl
-00030d50: 6f6e 655f 636f 6d6d 616e 6428 636f 6d6d  one_command(comm
-00030d60: 616e 6429 0a0a 2020 2020 6465 6620 6d6f  and)..    def mo
-00030d70: 756e 7428 7365 6c66 2c20 7572 6c2c 206d  unt(self, url, m
-00030d80: 6f75 6e74 706f 696e 742c 202a 6172 6773  ountpoint, *args
-00030d90: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-00030da0: 7420 7368 7574 696c 2e77 6869 6368 2827  t shutil.which('
-00030db0: 6675 7365 726d 6f75 6e74 3327 293a 0a20  fusermount3'):. 
-00030dc0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00030dd0: 2827 436f 756c 6420 6e6f 7420 6669 6e64  ('Could not find
-00030de0: 2022 6675 7365 726d 6f75 6e74 3322 2e20   "fusermount3". 
-00030df0: 506c 6561 7365 2069 6e73 7461 6c6c 2074  Please install t
-00030e00: 6865 2022 6675 7365 3322 204f 5320 7061  he "fuse3" OS pa
-00030e10: 636b 6167 6527 290a 2020 2020 2020 2020  ckage').        
-00030e20: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00030e30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00030e40: 7572 6c2e 656e 6473 7769 7468 2827 2f27  url.endswith('/'
-00030e50: 293a 0a20 2020 2020 2020 2020 2020 2075  ):.            u
-00030e60: 726c 2b27 2f27 0a20 2020 2020 2020 206d  rl+'/'.        m
-00030e70: 6f75 6e74 706f 696e 7420 3d20 6d6f 756e  ountpoint = moun
-00030e80: 7470 6f69 6e74 2e72 7374 7269 7028 6f73  tpoint.rstrip(os
-00030e90: 2e70 6174 682e 7365 7029 0a20 2020 2020  .path.sep).     
-00030ea0: 2020 2063 6f6d 6d61 6e64 203d 205b 7365     command = [se
-00030eb0: 6c66 2e72 632c 2027 6d6f 756e 7427 5d20  lf.rc, 'mount'] 
-00030ec0: 2b20 6c69 7374 2861 7267 7329 0a20 2020  + list(args).   
-00030ed0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00030ee0: 2020 2020 2020 6375 7272 656e 745f 7065        current_pe
-00030ef0: 726d 6973 7369 6f6e 7320 3d20 6f73 2e6c  rmissions = os.l
-00030f00: 7374 6174 286d 6f75 6e74 706f 696e 7429  stat(mountpoint)
-00030f10: 2e73 745f 6d6f 6465 0a20 2020 2020 2020  .st_mode.       
-00030f20: 2020 2020 206e 6577 5f70 6572 6d69 7373       new_permiss
-00030f30: 696f 6e73 203d 2028 6375 7272 656e 745f  ions = (current_
-00030f40: 7065 726d 6973 7369 6f6e 7320 2620 7e30  permissions & ~0
-00030f50: 6f30 3729 207c 2030 6f30 350a 2020 2020  o07) | 0o05.    
-00030f60: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
-00030f70: 286d 6f75 6e74 706f 696e 742c 206e 6577  (mountpoint, new
-00030f80: 5f70 6572 6d69 7373 696f 6e73 290a 2020  _permissions).  
-00030f90: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00030fa0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00030fb0: 2020 2020 2020 2063 6f6d 6d61 6e64 2e61         command.a
-00030fc0: 7070 656e 6428 272d 2d61 6c6c 6f77 2d6e  ppend('--allow-n
-00030fd0: 6f6e 2d65 6d70 7479 2729 0a20 2020 2020  on-empty').     
-00030fe0: 2020 2063 6f6d 6d61 6e64 2e61 7070 656e     command.appen
-00030ff0: 6428 272d 2d64 6566 6175 6c74 2d70 6572  d('--default-per
-00031000: 6d69 7373 696f 6e73 2729 0a20 2020 2020  missions').     
-00031010: 2020 2063 6f6d 6d61 6e64 2e61 7070 656e     command.appen
-00031020: 6428 272d 2d72 6561 642d 6f6e 6c79 2729  d('--read-only')
-00031030: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
-00031040: 2e61 7070 656e 6428 272d 2d6e 6f2d 6368  .append('--no-ch
-00031050: 6563 6b73 756d 2729 0a20 2020 2020 2020  ecksum').       
-00031060: 2063 6f6d 6d61 6e64 2e61 7070 656e 6428   command.append(
-00031070: 272d 2d71 7569 6574 2729 0a20 2020 2020  '--quiet').     
-00031080: 2020 2063 6f6d 6d61 6e64 2e61 7070 656e     command.appen
-00031090: 6428 7572 6c29 0a20 2020 2020 2020 2063  d(url).        c
-000310a0: 6f6d 6d61 6e64 2e61 7070 656e 6428 6d6f  ommand.append(mo
-000310b0: 756e 7470 6f69 6e74 290a 2020 2020 2020  untpoint).      
-000310c0: 2020 7069 6420 3d20 7365 6c66 2e5f 7275    pid = self._ru
-000310d0: 6e5f 626b 2863 6f6d 6d61 6e64 290a 2020  n_bk(command).  
-000310e0: 2020 2020 2020 7265 7475 726e 2070 6964        return pid
-000310f0: 0a0a 2020 2020 6465 6620 756e 6d6f 756e  ..    def unmoun
-00031100: 7428 7365 6c66 2c20 6d6f 756e 7470 6f69  t(self, mountpoi
-00031110: 6e74 2c20 7761 6974 3d46 616c 7365 293a  nt, wait=False):
-00031120: 0a20 2020 2020 2020 206d 6f75 6e74 706f  .        mountpo
-00031130: 696e 7420 3d20 6d6f 756e 7470 6f69 6e74  int = mountpoint
-00031140: 2e72 7374 7269 7028 6f73 2e70 6174 682e  .rstrip(os.path.
-00031150: 7365 7029 0a20 2020 2020 2020 2069 6620  sep).        if 
-00031160: 7365 6c66 2e5f 6973 5f6d 6f75 6e74 6564  self._is_mounted
-00031170: 286d 6f75 6e74 706f 696e 7429 3a0a 2020  (mountpoint):.  
-00031180: 2020 2020 2020 2020 2020 6966 2073 6875            if shu
-00031190: 7469 6c2e 7768 6963 6828 2766 7573 6572  til.which('fuser
-000311a0: 6d6f 756e 7433 2729 3a0a 2020 2020 2020  mount3'):.      
-000311b0: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
-000311c0: 5b27 6675 7365 726d 6f75 6e74 3327 2c20  ['fusermount3', 
-000311d0: 272d 7527 2c20 6d6f 756e 7470 6f69 6e74  '-u', mountpoint
-000311e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000311f0: 2020 7265 7420 3d20 7375 6270 726f 6365    ret = subproce
-00031200: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
-00031210: 2020 2020 2020 2020 2020 2020 636d 642c              cmd,
-00031220: 2063 6170 7475 7265 5f6f 7574 7075 743d   capture_output=
-00031230: 4661 6c73 652c 2074 6578 743d 5472 7565  False, text=True
-00031240: 2c20 656e 763d 7365 6c66 2e63 6667 2e65  , env=self.cfg.e
-00031250: 6e76 726e 290a 2020 2020 2020 2020 2020  nvrn).          
-00031260: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00031270: 2020 2020 2020 2020 7263 6c6f 6e65 5f70          rclone_p
-00031280: 6964 7320 3d20 7365 6c66 2e5f 6765 745f  ids = self._get_
-00031290: 7069 6473 2827 7263 6c6f 6e65 2729 0a20  pids('rclone'). 
-000312a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000312b0: 6c64 5f70 6964 7320 3d20 7365 6c66 2e5f  ld_pids = self._
-000312c0: 6765 745f 7069 6473 286d 6f75 6e74 706f  get_pids(mountpo
-000312d0: 696e 742c 2054 7275 6529 0a20 2020 2020  int, True).     
-000312e0: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
-000312f0: 6e5f 7069 6473 203d 205b 0a20 2020 2020  n_pids = [.     
-00031300: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00031310: 616c 7565 2066 6f72 2076 616c 7565 2069  alue for value i
-00031320: 6e20 7263 6c6f 6e65 5f70 6964 7320 6966  n rclone_pids if
-00031330: 2076 616c 7565 2069 6e20 666c 645f 7069   value in fld_pi
-00031340: 6473 5d0a 2020 2020 2020 2020 2020 2020  ds].            
-00031350: 2020 2020 666f 7220 7069 6420 696e 2063      for pid in c
-00031360: 6f6d 6d6f 6e5f 7069 6473 3a0a 2020 2020  ommon_pids:.    
-00031370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031380: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00031390: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-000313a0: 6b69 6c6c 2870 6964 2c20 7369 676e 616c  kill(pid, signal
-000313b0: 2e53 4947 5445 524d 290a 2020 2020 2020  .SIGTERM).      
-000313c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313d0: 2020 6966 2077 6169 743a 0a20 2020 2020    if wait:.     
-000313e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313f0: 2020 2020 2020 205f 2c20 5f20 3d20 6f73         _, _ = os
-00031400: 2e77 6169 7470 6964 2869 6e74 2870 6964  .waitpid(int(pid
-00031410: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
-00031420: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00031430: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-00031440: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00031450: 6365 7074 2050 6572 6d69 7373 696f 6e45  cept PermissionE
-00031460: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00031470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00031480: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-00031490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000314a0: 2066 2750 6572 6d69 7373 696f 6e20 6465   f'Permission de
-000314b0: 6e69 6564 2077 6865 6e20 7472 7969 6e67  nied when trying
-000314c0: 2074 6f20 7365 6e64 2073 6967 6e61 6c20   to send signal 
-000314d0: 5349 4754 4552 4d20 746f 2072 636c 6f6e  SIGTERM to rclon
-000314e0: 6520 7072 6f63 6573 7320 7769 7468 2050  e process with P
-000314f0: 4944 207b 7069 647d 2e27 290a 2020 2020  ID {pid}.').    
-00031500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031510: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00031520: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00031530: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00031540: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-00031550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031560: 2020 6627 416e 2075 6e65 7870 6563 7465    f'An unexpecte
-00031570: 6420 6572 726f 7220 6f63 6375 7272 6564  d error occurred
-00031580: 2077 6865 6e20 7472 7969 6e67 2074 6f20   when trying to 
-00031590: 7365 6e64 2073 6967 6e61 6c20 5349 4754  send signal SIGT
-000315a0: 4552 4d20 746f 2072 636c 6f6e 6520 7072  ERM to rclone pr
-000315b0: 6f63 6573 7320 7769 7468 2050 4944 207b  ocess with PID {
-000315c0: 7069 647d 3a20 7b65 7d27 290a 2020 2020  pid}: {e}').    
-000315d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000315e0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-000315f0: 2020 2020 2020 2020 2020 2020 2066 275c               f'\
-00031600: 6e45 7272 6f72 3a20 466f 6c64 6572 207b  nError: Folder {
-00031610: 6d6f 756e 7470 6f69 6e74 7d20 6973 2063  mountpoint} is c
-00031620: 7572 7265 6e74 6c79 206e 6f74 2075 7365  urrently not use
-00031630: 6420 6173 2061 206d 6f75 6e74 706f 696e  d as a mountpoin
-00031640: 7420 6279 2072 636c 6f6e 652e 2729 0a0a  t by rclone.')..
-00031650: 2020 2020 6465 6620 7665 7273 696f 6e28      def version(
-00031660: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
-00031670: 6f6d 6d61 6e64 203d 205b 7365 6c66 2e72  ommand = [self.r
-00031680: 632c 2027 7665 7273 696f 6e27 5d0a 2020  c, 'version'].  
-00031690: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000316a0: 662e 5f72 756e 5f72 636c 6f6e 655f 636f  f._run_rclone_co
-000316b0: 6d6d 616e 6428 636f 6d6d 616e 6429 0a0a  mmand(command)..
-000316c0: 2020 2020 6465 6620 6765 745f 6d6f 756e      def get_moun
-000316d0: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
-000316e0: 2020 6d6f 756e 7473 203d 205b 5d0a 2020    mounts = [].  
-000316f0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00031700: 272f 7072 6f63 2f6d 6f75 6e74 7327 2c20  '/proc/mounts', 
-00031710: 2772 2729 2061 7320 663a 0a20 2020 2020  'r') as f:.     
-00031720: 2020 2020 2020 2066 6f72 206c 696e 6520         for line 
-00031730: 696e 2066 3a0a 2020 2020 2020 2020 2020  in f:.          
-00031740: 2020 2020 2020 7061 7274 7320 3d20 6c69        parts = li
-00031750: 6e65 2e73 706c 6974 2829 0a20 2020 2020  ne.split().     
-00031760: 2020 2020 2020 2020 2020 206d 6f75 6e74             mount
-00031770: 5f70 6f69 6e74 2c20 6673 5f74 7970 6520  _point, fs_type 
-00031780: 3d20 7061 7274 735b 315d 2c20 7061 7274  = parts[1], part
-00031790: 735b 325d 0a20 2020 2020 2020 2020 2020  s[2].           
-000317a0: 2020 2020 2069 6620 6673 5f74 7970 652e       if fs_type.
-000317b0: 7374 6172 7473 7769 7468 2827 6675 7365  startswith('fuse
-000317c0: 2e72 636c 6f6e 6527 293a 0a20 2020 2020  .rclone'):.     
-000317d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000317e0: 6f75 6e74 732e 6170 7065 6e64 286d 6f75  ounts.append(mou
-000317f0: 6e74 5f70 6f69 6e74 290a 2020 2020 2020  nt_point).      
-00031800: 2020 7265 7475 726e 206d 6f75 6e74 730a    return mounts.
-00031810: 0a20 2020 2064 6566 205f 6765 745f 7069  .    def _get_pi
-00031820: 6473 2873 656c 662c 2070 726f 6365 7373  ds(self, process
-00031830: 2c20 6675 6c6c 3d46 616c 7365 293a 0a20  , full=False):. 
-00031840: 2020 2020 2020 2070 726f 6365 7373 203d         process =
-00031850: 2070 726f 6365 7373 2e72 7374 7269 7028   process.rstrip(
-00031860: 6f73 2e70 6174 682e 7365 7029 0a20 2020  os.path.sep).   
-00031870: 2020 2020 2069 6620 6675 6c6c 3a0a 2020       if full:.  
-00031880: 2020 2020 2020 2020 2020 636f 6d6d 616e            comman
-00031890: 6420 3d20 5b27 7067 7265 7027 2c20 272d  d = ['pgrep', '-
-000318a0: 6627 2c20 7072 6f63 6573 735d 0a20 2020  f', process].   
-000318b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000318c0: 2020 2020 2020 2063 6f6d 6d61 6e64 203d         command =
-000318d0: 205b 2770 6772 6570 272c 2070 726f 6365   ['pgrep', proce
-000318e0: 7373 5d0a 2020 2020 2020 2020 7472 793a  ss].        try:
-000318f0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00031900: 7075 7420 3d20 7375 6270 726f 6365 7373  put = subprocess
-00031910: 2e63 6865 636b 5f6f 7574 7075 7428 636f  .check_output(co
-00031920: 6d6d 616e 6429 0a20 2020 2020 2020 2020  mmand).         
-00031930: 2020 2070 6964 7320 3d20 5b69 6e74 2870     pids = [int(p
-00031940: 6964 2920 666f 7220 7069 6420 696e 206f  id) for pid in o
-00031950: 7574 7075 742e 6465 636f 6465 280a 2020  utput.decode(.  
-00031960: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00031970: 726f 7273 3d27 6967 6e6f 7265 2729 2e73  rors='ignore').s
-00031980: 706c 6974 2827 5c6e 2729 2069 6620 7069  plit('\n') if pi
-00031990: 645d 0a20 2020 2020 2020 2020 2020 2072  d].            r
-000319a0: 6574 7572 6e20 7069 6473 0a20 2020 2020  eturn pids.     
-000319b0: 2020 2065 7863 6570 7420 7375 6270 726f     except subpro
-000319c0: 6365 7373 2e43 616c 6c65 6450 726f 6365  cess.CalledProce
-000319d0: 7373 4572 726f 723a 0a20 2020 2020 2020  ssError:.       
-000319e0: 2020 2020 2023 204e 6f20 7263 6c6f 6e65       # No rclone
-000319f0: 2070 726f 6365 7373 6573 2066 6f75 6e64   processes found
-00031a00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00031a10: 7572 6e20 5b5d 0a0a 2020 2020 6465 6620  urn []..    def 
-00031a20: 5f69 735f 6d6f 756e 7465 6428 7365 6c66  _is_mounted(self
-00031a30: 2c20 666f 6c64 6572 5f70 6174 6829 3a0a  , folder_path):.
-00031a40: 2020 2020 2020 2020 2320 5265 736f 6c76          # Resolv
-00031a50: 6520 616e 7920 7379 6d62 6f6c 6963 206c  e any symbolic l
-00031a60: 696e 6b73 0a20 2020 2020 2020 2066 6f6c  inks.        fol
-00031a70: 6465 725f 7061 7468 203d 206f 732e 7061  der_path = os.pa
-00031a80: 7468 2e72 6561 6c70 6174 6828 666f 6c64  th.realpath(fold
-00031a90: 6572 5f70 6174 6829 0a20 2020 2020 2020  er_path).       
-00031aa0: 2077 6974 6820 6f70 656e 2827 2f70 726f   with open('/pro
-00031ab0: 632f 6d6f 756e 7473 272c 2027 7227 2920  c/mounts', 'r') 
-00031ac0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00031ad0: 2020 666f 7220 6c69 6e65 2069 6e20 663a    for line in f:
-00031ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031af0: 2070 6172 7473 203d 206c 696e 652e 7370   parts = line.sp
-00031b00: 6c69 7428 290a 2020 2020 2020 2020 2020  lit().          
-00031b10: 2020 2020 2020 6d6f 756e 745f 706f 696e        mount_poin
-00031b20: 742c 2066 735f 7479 7065 203d 2070 6172  t, fs_type = par
-00031b30: 7473 5b31 5d2c 2070 6172 7473 5b32 5d0a  ts[1], parts[2].
-00031b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b50: 6966 206d 6f75 6e74 5f70 6f69 6e74 203d  if mount_point =
-00031b60: 3d20 666f 6c64 6572 5f70 6174 6820 616e  = folder_path an
-00031b70: 6420 6673 5f74 7970 652e 7374 6172 7473  d fs_type.starts
-00031b80: 7769 7468 2827 6675 7365 2e72 636c 6f6e  with('fuse.rclon
-00031b90: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
-00031ba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00031bb0: 5472 7565 0a0a 2020 2020 6465 6620 5f61  True..    def _a
-00031bc0: 6464 5f6f 7074 2873 656c 662c 2063 6d64  dd_opt(self, cmd
-00031bd0: 2c20 6f70 7469 6f6e 2c20 7661 6c75 653d  , option, value=
-00031be0: 4e6f 6e65 293a 0a20 2020 2020 2020 2027  None):.        '
-00031bf0: 2727 4164 6420 616e 206f 7074 696f 6e20  ''Add an option 
-00031c00: 746f 2074 6865 2063 6f6d 6d61 6e64 2069  to the command i
-00031c10: 6620 6974 2069 7320 6e6f 7420 616c 7265  f it is not alre
-00031c20: 6164 7920 7072 6573 656e 7427 2727 0a0a  ady present'''..
-00031c30: 2020 2020 2020 2020 6966 206f 7074 696f          if optio
-00031c40: 6e20 6e6f 7420 696e 2063 6d64 3a0a 2020  n not in cmd:.  
-00031c50: 2020 2020 2020 2020 2020 636d 642e 6170            cmd.ap
-00031c60: 7065 6e64 286f 7074 696f 6e29 0a20 2020  pend(option).   
-00031c70: 2020 2020 2020 2020 2069 6620 7661 6c75           if valu
-00031c80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00031c90: 2020 2063 6d64 2e61 7070 656e 6428 7661     cmd.append(va
-00031ca0: 6c75 6529 0a0a 2020 2020 2020 2020 7265  lue)..        re
-00031cb0: 7475 726e 2063 6d64 0a0a 2020 2020 6465  turn cmd..    de
-00031cc0: 6620 5f70 6172 7365 5f6c 6f67 2873 656c  f _parse_log(sel
-00031cd0: 662c 2073 7472 7374 6465 7272 293a 0a20  f, strstderr):. 
-00031ce0: 2020 2020 2020 206c 696e 6573 203d 2073         lines = s
-00031cf0: 7472 7374 6465 7272 2e73 706c 6974 2827  trstderr.split('
-00031d00: 5c6e 2729 0a20 2020 2020 2020 2064 6174  \n').        dat
-00031d10: 6120 3d20 5b6a 736f 6e2e 6c6f 6164 7328  a = [json.loads(
-00031d20: 6c69 6e65 2e72 7374 7269 7028 2929 2066  line.rstrip()) f
-00031d30: 6f72 206c 696e 6520 696e 206c 696e 6573  or line in lines
-00031d40: 2069 6620 6c69 6e65 5b30 5d20 3d3d 2022   if line[0] == "
-00031d50: 7b22 5d0a 2020 2020 2020 2020 7374 6174  {"].        stat
-00031d60: 7320 3d20 5b5d 0a20 2020 2020 2020 206f  s = [].        o
-00031d70: 7065 7261 7469 6f6e 7320 3d20 5b5d 0a20  perations = []. 
-00031d80: 2020 2020 2020 2066 6f72 206f 626a 2069         for obj i
-00031d90: 6e20 6461 7461 3a0a 2020 2020 2020 2020  n data:.        
-00031da0: 2020 2020 6966 2027 6163 636f 756e 7469      if 'accounti
-00031db0: 6e67 2f73 7461 7473 2720 696e 206f 626a  ng/stats' in obj
-00031dc0: 5b27 736f 7572 6365 275d 3a0a 2020 2020  ['source']:.    
-00031dd0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-00031de0: 732e 6170 7065 6e64 286f 626a 290a 2020  s.append(obj).  
-00031df0: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
-00031e00: 6f70 6572 6174 696f 6e73 2f6f 7065 7261  operations/opera
-00031e10: 7469 6f6e 7327 2069 6e20 6f62 6a5b 2773  tions' in obj['s
-00031e20: 6f75 7263 6527 5d3a 0a20 2020 2020 2020  ource']:.       
-00031e30: 2020 2020 2020 2020 206f 7065 7261 7469           operati
-00031e40: 6f6e 732e 6170 7065 6e64 286f 626a 290a  ons.append(obj).
-00031e50: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00031e60: 7461 7473 2c20 6f70 6572 6174 696f 6e73  tats, operations
-00031e70: 0a0a 2020 2020 2020 2020 2320 7374 6174  ..        # stat
-00031e80: 7322 3a7b 2262 7974 6573 223a 302c 2263  s":{"bytes":0,"c
-00031e90: 6865 636b 7322 3a30 2c22 6465 6c65 7465  hecks":0,"delete
-00031ea0: 6444 6972 7322 3a30 2c22 6465 6c65 7465  dDirs":0,"delete
-00031eb0: 7322 3a30 2c22 656c 6170 7365 6454 696d  s":0,"elapsedTim
-00031ec0: 6522 3a34 2e31 3231 3438 3937 3835 2c22  e":4.121489785,"
-00031ed0: 6572 726f 7273 223a 3132 2c22 6574 6122  errors":12,"eta"
-00031ee0: 3a6e 756c 6c2c 2266 6174 616c 4572 726f  :null,"fatalErro
-00031ef0: 7222 3a66 616c 7365 2c0a 2020 2020 2020  r":false,.      
-00031f00: 2020 2320 226c 6173 7445 7272 6f72 223a    # "lastError":
-00031f10: 2266 6169 6c65 6420 746f 206f 7065 6e20  "failed to open 
-00031f20: 736f 7572 6365 206f 626a 6563 743a 204f  source object: O
-00031f30: 626a 6563 7420 696e 2047 4c41 4349 4552  bject in GLACIER
-00031f40: 2c20 7265 7374 6f72 6520 6669 7273 743a  , restore first:
-00031f50: 2062 7563 6b65 743d 5c22 706f 7369 782d   bucket=\"posix-
-00031f60: 6470 5c22 2c20 6b65 793d 5c22 7465 7374  dp\", key=\"test
-00031f70: 7334 2f74 6162 6c65 5f65 7861 6d70 6c65  s4/table_example
-00031f80: 2e70 795c 2222 2c0a 2020 2020 2020 2020  .py\"",.        
-00031f90: 2320 2272 656e 616d 6573 223a 302c 2272  # "renames":0,"r
-00031fa0: 6574 7279 4572 726f 7222 3a74 7275 652c  etryError":true,
-00031fb0: 2273 7065 6564 223a 302c 2274 6f74 616c  "speed":0,"total
-00031fc0: 4279 7465 7322 3a30 2c22 746f 7461 6c43  Bytes":0,"totalC
-00031fd0: 6865 636b 7322 3a30 2c22 746f 7461 6c54  hecks":0,"totalT
-00031fe0: 7261 6e73 6665 7273 223a 302c 2274 7261  ransfers":0,"tra
-00031ff0: 6e73 6665 7254 696d 6522 3a30 2c22 7472  nsferTime":0,"tr
-00032000: 616e 7366 6572 7322 3a30 7d2c 0a20 2020  ansfers":0},.   
-00032010: 2020 2020 2023 2022 7469 6d65 223a 2232       # "time":"2
-00032020: 3032 332d 3034 2d31 3654 3130 3a31 383a  023-04-16T10:18:
-00032030: 3436 2e31 3231 3932 312d 3037 3a30 3022  46.121921-07:00"
-00032040: 7d0a 0a0a 636c 6173 7320 536c 7572 6d45  }...class SlurmE
-00032050: 7373 656e 7469 616c 733a 0a20 2020 2023  ssentials:.    #
-00032060: 2065 7869 7420 636f 6465 2036 3420 6361   exit code 64 ca
-00032070: 7573 6573 2053 6c75 726d 2074 6f20 2d2d  uses Slurm to --
-00032080: 7265 7175 6575 652c 2065 2e67 2e20 7379  requeue, e.g. sy
-00032090: 732e 6578 6974 2836 3429 0a20 2020 2023  s.exit(64).    #
-000320a0: 2054 4f44 4f3a 2074 6865 7365 2076 6172   TODO: these var
-000320b0: 6961 626c 6573 2061 7265 206e 6f74 2052  iables are not R
-000320c0: 4541 4420 6672 6f6d 2074 6865 2063 6f6e  EAD from the con
-000320d0: 6669 6720 6669 6c65 0a20 2020 2064 6566  fig file.    def
-000320e0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000320f0: 6172 6773 2c20 6366 673a 2043 6f6e 6669  args, cfg: Confi
-00032100: 674d 616e 6167 6572 293a 0a20 2020 2020  gManager):.     
-00032110: 2020 2073 656c 662e 7363 7269 7074 5f6c     self.script_l
-00032120: 696e 6573 203d 205b 2223 212f 6269 6e2f  ines = ["#!/bin/
-00032130: 6261 7368 225d 0a20 2020 2020 2020 2073  bash"].        s
-00032140: 656c 662e 6366 6720 3d20 6366 670a 2020  elf.cfg = cfg.  
-00032150: 2020 2020 2020 7365 6c66 2e61 7267 7320        self.args 
-00032160: 3d20 6172 6773 0a20 2020 2020 2020 2073  = args.        s
-00032170: 656c 662e 7371 7565 7565 5f6f 7574 7075  elf.squeue_outpu
-00032180: 745f 666f 726d 6174 203d 2027 2225 6922  t_format = '"%i"
-00032190: 2c22 256a 222c 2225 7422 2c22 254d 222c  ,"%j","%t","%M",
-000321a0: 2225 4c22 2c22 2544 222c 2225 4322 2c22  "%L","%D","%C","
-000321b0: 256d 222c 2225 6222 2c22 2552 2227 0a20  %m","%b","%R"'. 
-000321c0: 2020 2020 2020 2073 656c 662e 6a6f 6273         self.jobs
-000321d0: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
-000321e0: 6c66 2e6a 6f62 5f69 6e66 6f20 3d20 7b7d  lf.job_info = {}
-000321f0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00032200: 7274 6974 696f 6e20 3d20 6366 672e 736c  rtition = cfg.sl
-00032210: 7572 6d5f 7061 7274 6974 696f 6e0a 2020  urm_partition.  
-00032220: 2020 2020 2020 7365 6c66 2e71 6f73 203d        self.qos =
-00032230: 2063 6667 2e73 6c75 726d 5f71 6f73 0a20   cfg.slurm_qos. 
-00032240: 2020 2020 2020 2073 656c 662e 7761 6c6c         self.wall
-00032250: 7469 6d65 203d 2066 277b 6366 672e 736c  time = f'{cfg.sl
-00032260: 7572 6d5f 7761 6c6c 7469 6d65 5f64 6179  urm_walltime_day
-00032270: 737d 2d7b 6366 672e 736c 7572 6d5f 7761  s}-{cfg.slurm_wa
-00032280: 6c6c 7469 6d65 5f68 6f75 7273 7d27 0a20  lltime_hours}'. 
-00032290: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
-000322a0: 5f6c 696e 6573 5f66 726f 6d5f 6366 6728  _lines_from_cfg(
-000322b0: 290a 0a20 2020 2064 6566 2061 6464 5f6c  )..    def add_l
-000322c0: 696e 6528 7365 6c66 2c20 6c69 6e65 293a  ine(self, line):
-000322d0: 0a20 2020 2020 2020 2069 6620 6c69 6e65  .        if line
-000322e0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000322f0: 6c66 2e73 6372 6970 745f 6c69 6e65 732e  lf.script_lines.
-00032300: 6170 7065 6e64 286c 696e 6529 0a0a 2020  append(line)..  
-00032310: 2020 6465 6620 6765 745f 6675 7475 7265    def get_future
-00032320: 5f73 7461 7274 5f74 696d 6528 7365 6c66  _start_time(self
-00032330: 2c20 6164 645f 686f 7572 7329 3a0a 2020  , add_hours):.  
-00032340: 2020 2020 2020 6e6f 7720 3d20 6461 7465        now = date
-00032350: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
-00032360: 7728 290a 2020 2020 2020 2020 6675 7475  w().        futu
-00032370: 7265 5f74 696d 6520 3d20 6e6f 7720 2b20  re_time = now + 
-00032380: 6461 7465 7469 6d65 2e74 696d 6564 656c  datetime.timedel
-00032390: 7461 2868 6f75 7273 3d61 6464 5f68 6f75  ta(hours=add_hou
-000323a0: 7273 290a 2020 2020 2020 2020 7265 7475  rs).        retu
-000323b0: 726e 2066 7574 7572 655f 7469 6d65 2e73  rn future_time.s
-000323c0: 7472 6674 696d 6528 2225 592d 256d 2d25  trftime("%Y-%m-%
-000323d0: 6454 2548 3a25 4d22 290a 0a20 2020 2064  dT%H:%M")..    d
-000323e0: 6566 205f 6164 645f 6c69 6e65 735f 6672  ef _add_lines_fr
-000323f0: 6f6d 5f63 6667 2873 656c 6629 3a0a 2020  om_cfg(self):.  
-00032400: 2020 2020 2020 736c 7572 6d5f 6c73 6372        slurm_lscr
-00032410: 6174 6368 203d 2073 656c 662e 6366 672e  atch = self.cfg.
-00032420: 736c 7572 6d5f 6c73 6372 6174 6368 0a20  slurm_lscratch. 
-00032430: 2020 2020 2020 206c 7363 7261 7463 685f         lscratch_
-00032440: 6d6b 6469 7220 3d20 7365 6c66 2e63 6667  mkdir = self.cfg
-00032450: 2e6c 7363 7261 7463 685f 6d6b 6469 720a  .lscratch_mkdir.
-00032460: 2020 2020 2020 2020 6c73 6372 6174 6368          lscratch
-00032470: 5f72 6f6f 7420 3d20 7365 6c66 2e63 6667  _root = self.cfg
-00032480: 2e6c 7363 7261 7463 685f 726f 6f74 0a20  .lscratch_root. 
-00032490: 2020 2020 2020 2069 6620 736c 7572 6d5f         if slurm_
-000324a0: 6c73 6372 6174 6368 3a0a 2020 2020 2020  lscratch:.      
-000324b0: 2020 2020 2020 7365 6c66 2e61 6464 5f6c        self.add_l
-000324c0: 696e 6528 6627 2353 4241 5443 4820 7b73  ine(f'#SBATCH {s
-000324d0: 6c75 726d 5f6c 7363 7261 7463 687d 2729  lurm_lscratch}')
-000324e0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-000324f0: 645f 6c69 6e65 2866 277b 6c73 6372 6174  d_line(f'{lscrat
-00032500: 6368 5f6d 6b64 6972 7d27 290a 2020 2020  ch_mkdir}').    
-00032510: 2020 2020 6966 206c 7363 7261 7463 685f      if lscratch_
-00032520: 726f 6f74 3a0a 2020 2020 2020 2020 2020  root:.          
-00032530: 2020 7365 6c66 2e61 6464 5f6c 696e 6528    self.add_line(
-00032540: 2765 7870 6f72 7420 544d 5044 4952 3d25  'export TMPDIR=%
-00032550: 732f 247b 534c 5552 4d5f 4a4f 425f 4944  s/${SLURM_JOB_ID
-00032560: 7d27 2025 206c 7363 7261 7463 685f 726f  }' % lscratch_ro
-00032570: 6f74 290a 0a20 2020 2064 6566 205f 7265  ot)..    def _re
-00032580: 6f72 6465 725f 7362 6174 6368 5f6c 696e  order_sbatch_lin
-00032590: 6573 2873 656c 662c 2073 6372 6970 745f  es(self, script_
-000325a0: 6275 6666 6572 293a 0a20 2020 2020 2020  buffer):.       
-000325b0: 2023 2077 6520 6e65 6564 2074 6f20 6d61   # we need to ma
-000325c0: 6b65 2073 7572 6520 7468 6174 2061 6c6c  ke sure that all
-000325d0: 2023 4241 5443 4820 6172 6520 6174 2074   #BATCH are at t
-000325e0: 6865 2074 6f70 0a20 2020 2020 2020 2073  he top.        s
-000325f0: 6372 6970 745f 6275 6666 6572 2e73 6565  cript_buffer.see
-00032600: 6b28 3029 0a20 2020 2020 2020 206c 696e  k(0).        lin
-00032610: 6573 203d 2073 6372 6970 745f 6275 6666  es = script_buff
-00032620: 6572 2e72 6561 646c 696e 6573 2829 0a20  er.readlines(). 
-00032630: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
-00032640: 7468 6520 7368 6562 616e 6720 6c69 6e65  the shebang line
-00032650: 2066 726f 6d20 7468 6520 6c69 7374 206f   from the list o
-00032660: 6620 6c69 6e65 730a 2020 2020 2020 2020  f lines.        
-00032670: 7368 6562 616e 675f 6c69 6e65 203d 206c  shebang_line = l
-00032680: 696e 6573 2e70 6f70 2830 290a 2020 2020  ines.pop(0).    
-00032690: 2020 2020 7362 6174 6368 5f6c 696e 6573      sbatch_lines
-000326a0: 203d 205b 6c69 6e65 2066 6f72 206c 696e   = [line for lin
-000326b0: 6520 696e 206c 696e 6573 2069 6620 6c69  e in lines if li
-000326c0: 6e65 2e73 7461 7274 7377 6974 6828 2223  ne.startswith("#
-000326d0: 5342 4154 4348 2229 5d0a 2020 2020 2020  SBATCH")].      
-000326e0: 2020 6e6f 6e5f 7362 6174 6368 5f6c 696e    non_sbatch_lin
-000326f0: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
-00032700: 2020 206c 696e 6520 666f 7220 6c69 6e65     line for line
-00032710: 2069 6e20 6c69 6e65 7320 6966 206e 6f74   in lines if not
-00032720: 206c 696e 652e 7374 6172 7473 7769 7468   line.startswith
-00032730: 2822 2353 4241 5443 4822 295d 0a20 2020  ("#SBATCH")].   
-00032740: 2020 2020 2072 656f 7264 6572 6564 5f73       reordered_s
-00032750: 6372 6970 7420 3d20 696f 2e53 7472 696e  cript = io.Strin
-00032760: 6749 4f28 290a 2020 2020 2020 2020 7265  gIO().        re
-00032770: 6f72 6465 7265 645f 7363 7269 7074 2e77  ordered_script.w
-00032780: 7269 7465 2873 6865 6261 6e67 5f6c 696e  rite(shebang_lin
-00032790: 6529 0a20 2020 2020 2020 2066 6f72 206c  e).        for l
-000327a0: 696e 6520 696e 2073 6261 7463 685f 6c69  ine in sbatch_li
-000327b0: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
-000327c0: 2072 656f 7264 6572 6564 5f73 6372 6970   reordered_scrip
-000327d0: 742e 7772 6974 6528 6c69 6e65 290a 2020  t.write(line).  
-000327e0: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-000327f0: 6e20 6e6f 6e5f 7362 6174 6368 5f6c 696e  n non_sbatch_lin
-00032800: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00032810: 7265 6f72 6465 7265 645f 7363 7269 7074  reordered_script
-00032820: 2e77 7269 7465 286c 696e 6529 0a20 2020  .write(line).   
-00032830: 2020 2020 2023 2061 6464 2061 206c 6f63       # add a loc
-00032840: 616c 2073 6372 6174 6368 2074 6561 7264  al scratch teard
-00032850: 6f77 6e2c 2069 6620 636f 6e66 6967 7572  own, if configur
-00032860: 6564 0a20 2020 2020 2020 2072 656f 7264  ed.        reord
-00032870: 6572 6564 5f73 6372 6970 742e 7772 6974  ered_script.writ
-00032880: 6528 7365 6c66 2e63 6667 2e6c 7363 7261  e(self.cfg.lscra
-00032890: 7463 685f 726d 6469 7229 0a20 2020 2020  tch_rmdir).     
-000328a0: 2020 2072 656f 7264 6572 6564 5f73 6372     reordered_scr
-000328b0: 6970 742e 7365 656b 2830 290a 2020 2020  ipt.seek(0).    
-000328c0: 2020 2020 7265 7475 726e 2072 656f 7264      return reord
-000328d0: 6572 6564 5f73 6372 6970 740a 0a20 2020  ered_script..   
-000328e0: 2064 6566 2073 6261 7463 6828 7365 6c66   def sbatch(self
-000328f0: 293a 0a20 2020 2020 2020 2073 6372 6970  ):.        scrip
-00032900: 7420 3d20 696f 2e53 7472 696e 6749 4f28  t = io.StringIO(
-00032910: 290a 2020 2020 2020 2020 666f 7220 6c69  ).        for li
-00032920: 6e65 2069 6e20 7365 6c66 2e73 6372 6970  ne in self.scrip
-00032930: 745f 6c69 6e65 733a 0a20 2020 2020 2020  t_lines:.       
-00032940: 2020 2020 2073 6372 6970 742e 7772 6974       script.writ
-00032950: 6528 6c69 6e65 202b 2022 5c6e 2229 0a20  e(line + "\n"). 
-00032960: 2020 2020 2020 2073 6372 6970 742e 7365         script.se
-00032970: 656b 2830 290a 2020 2020 2020 2020 6f73  ek(0).        os
-00032980: 6372 6970 7420 3d20 7365 6c66 2e5f 7265  cript = self._re
-00032990: 6f72 6465 725f 7362 6174 6368 5f6c 696e  order_sbatch_lin
-000329a0: 6573 2873 6372 6970 7429 0a20 2020 2020  es(script).     
-000329b0: 2020 2072 6573 756c 7420 3d20 7375 6270     result = subp
-000329c0: 726f 6365 7373 2e72 756e 285b 2273 6261  rocess.run(["sba
-000329d0: 7463 6822 5d2c 2074 6578 743d 5472 7565  tch"], text=True
-000329e0: 2c20 7368 656c 6c3d 5472 7565 2c20 696e  , shell=True, in
-000329f0: 7075 743d 6f73 6372 6970 742e 7265 6164  put=oscript.read
-00032a00: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00032a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032a20: 2020 2020 7374 646f 7574 3d73 7562 7072      stdout=subpr
-00032a30: 6f63 6573 732e 5049 5045 2c20 7374 6465  ocess.PIPE, stde
-00032a40: 7272 3d73 7562 7072 6f63 6573 732e 5049  rr=subprocess.PI
-00032a50: 5045 290a 2020 2020 2020 2020 6966 2072  PE).        if r
-00032a60: 6573 756c 742e 7265 7475 726e 636f 6465  esult.returncode
-00032a70: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-00032a80: 2020 2069 6620 2749 6e76 616c 6964 2067     if 'Invalid g
-00032a90: 656e 6572 6963 2072 6573 6f75 7263 6527  eneric resource'
-00032aa0: 2069 6e20 7265 7375 6c74 2e73 7464 6572   in result.stder
-00032ab0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00032ac0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00032ad0: 2020 2020 2020 2020 2020 2020 2020 2749                'I
-00032ae0: 6e76 616c 6964 2067 656e 6572 6963 2072  nvalid generic r
-00032af0: 6573 6f75 7263 6520 7265 7175 6573 742e  esource request.
-00032b00: 2050 6c65 6173 6520 6368 616e 6765 2063   Please change c
-00032b10: 6f6e 6669 6775 7261 7469 6f6e 206f 6620  onfiguration of 
-00032b20: 736c 7572 6d5f 6c73 6372 6174 6368 2729  slurm_lscratch')
-00032b30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00032b40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00032b50: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-00032b60: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00032b70: 2020 2020 2020 2020 2020 2066 2245 7272             f"Err
-00032b80: 6f72 2072 756e 6e69 6e67 2073 6261 7463  or running sbatc
-00032b90: 683a 207b 7265 7375 6c74 2e73 7464 6572  h: {result.stder
-00032ba0: 722e 7374 7269 7028 297d 2229 0a20 2020  r.strip()}").   
-00032bb0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00032bc0: 7428 3129 0a20 2020 2020 2020 206a 6f62  t(1).        job
-00032bd0: 5f69 6420 3d20 696e 7428 7265 7375 6c74  _id = int(result
-00032be0: 2e73 7464 6f75 742e 7370 6c69 7428 295b  .stdout.split()[
-00032bf0: 2d31 5d29 0a20 2020 2020 2020 2069 6620  -1]).        if 
-00032c00: 7365 6c66 2e61 7267 732e 6465 6275 673a  self.args.debug:
-00032c10: 0a20 2020 2020 2020 2020 2020 206f 7363  .            osc
-00032c20: 7269 7074 2e73 6565 6b28 3029 0a20 2020  ript.seek(0).   
-00032c30: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00032c40: 656e 2866 2773 7562 6d69 7474 6564 2d7b  en(f'submitted-{
-00032c50: 6a6f 625f 6964 7d2e 7368 272c 2022 7722  job_id}.sh', "w"
-00032c60: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
-00032c70: 3822 2920 6173 2066 696c 653a 0a20 2020  8") as file:.   
-00032c80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00032c90: 652e 7772 6974 6528 6f73 6372 6970 742e  e.write(oscript.
-00032ca0: 7265 6164 2829 290a 2020 2020 2020 2020  read()).        
-00032cb0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-00032cc0: 2044 6562 7567 2073 6372 6970 7420 6372   Debug script cr
-00032cd0: 6561 7465 643a 2073 7562 6d69 7474 6564  eated: submitted
-00032ce0: 2d7b 6a6f 625f 6964 7d2e 7368 2729 0a20  -{job_id}.sh'). 
-00032cf0: 2020 2020 2020 2072 6574 7572 6e20 6a6f         return jo
-00032d00: 625f 6964 0a0a 2020 2020 6465 6620 7371  b_id..    def sq
-00032d10: 7565 7565 2873 656c 6629 3a0a 2020 2020  ueue(self):.    
-00032d20: 2020 2020 7265 7375 6c74 203d 2073 7562      result = sub
-00032d30: 7072 6f63 6573 732e 7275 6e28 5b22 7371  process.run(["sq
-00032d40: 7565 7565 222c 2022 2d2d 6d65 222c 2022  ueue", "--me", "
-00032d50: 2d6f 222c 2073 656c 662e 7371 7565 7565  -o", self.squeue
-00032d60: 5f6f 7574 7075 745f 666f 726d 6174 5d2c  _output_format],
-00032d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d90: 2073 7464 6f75 743d 7375 6270 726f 6365   stdout=subproce
-00032da0: 7373 2e50 4950 452c 2073 7464 6572 723d  ss.PIPE, stderr=
-00032db0: 7375 6270 726f 6365 7373 2e50 4950 452c  subprocess.PIPE,
-00032dc0: 2074 6578 743d 5472 7565 290a 2020 2020   text=True).    
-00032dd0: 2020 2020 6966 2072 6573 756c 742e 7265      if result.re
-00032de0: 7475 726e 636f 6465 2021 3d20 303a 0a20  turncode != 0:. 
-00032df0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00032e00: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
-00032e10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00032e20: 2245 7272 6f72 2072 756e 6e69 6e67 2073  "Error running s
-00032e30: 7175 6575 653a 207b 7265 7375 6c74 2e73  queue: {result.s
-00032e40: 7464 6572 722e 7374 7269 7028 297d 2229  tderr.strip()}")
-00032e50: 0a20 2020 2020 2020 2073 656c 662e 6a6f  .        self.jo
-00032e60: 6273 203d 2073 656c 662e 5f70 6172 7365  bs = self._parse
-00032e70: 5f73 7175 6575 655f 6f75 7470 7574 2872  _squeue_output(r
-00032e80: 6573 756c 742e 7374 646f 7574 2e73 7472  esult.stdout.str
-00032e90: 6970 2829 290a 0a20 2020 2064 6566 205f  ip())..    def _
-00032ea0: 7061 7273 655f 7371 7565 7565 5f6f 7574  parse_squeue_out
-00032eb0: 7075 7428 7365 6c66 2c20 6f75 7470 7574  put(self, output
-00032ec0: 293a 0a20 2020 2020 2020 2063 7376 5f66  ):.        csv_f
-00032ed0: 696c 6520 3d20 696f 2e53 7472 696e 6749  ile = io.StringI
-00032ee0: 4f28 6f75 7470 7574 290a 2020 2020 2020  O(output).      
-00032ef0: 2020 7265 6164 6572 203d 2063 7376 2e44    reader = csv.D
-00032f00: 6963 7452 6561 6465 7228 6373 765f 6669  ictReader(csv_fi
-00032f10: 6c65 2c20 6465 6c69 6d69 7465 723d 272c  le, delimiter=',
-00032f20: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00032f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f40: 2020 2071 756f 7465 6368 6172 3d27 2227     quotechar='"'
-00032f50: 2c20 736b 6970 696e 6974 6961 6c73 7061  , skipinitialspa
-00032f60: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
-00032f70: 206a 6f62 7320 3d20 5b72 6f77 2066 6f72   jobs = [row for
-00032f80: 2072 6f77 2069 6e20 7265 6164 6572 5d0a   row in reader].
-00032f90: 2020 2020 2020 2020 7265 7475 726e 206a          return j
-00032fa0: 6f62 730a 0a20 2020 2064 6566 2070 7269  obs..    def pri
-00032fb0: 6e74 5f6a 6f62 7328 7365 6c66 293a 0a20  nt_jobs(self):. 
-00032fc0: 2020 2020 2020 2066 6f72 206a 6f62 2069         for job i
-00032fd0: 6e20 7365 6c66 2e6a 6f62 733a 0a20 2020  n self.jobs:.   
-00032fe0: 2020 2020 2020 2020 2070 7269 6e74 286a           print(j
-00032ff0: 6f62 290a 0a20 2020 2064 6566 206a 6f62  ob)..    def job
-00033000: 5f63 6f6d 6d65 6e74 5f72 6561 6428 7365  _comment_read(se
-00033010: 6c66 2c20 6a6f 625f 6964 293a 0a20 2020  lf, job_id):.   
-00033020: 2020 2020 206a 6f62 6469 6374 203d 2073       jobdict = s
-00033030: 656c 662e 5f73 636f 6e74 726f 6c5f 7368  elf._scontrol_sh
-00033040: 6f77 5f6a 6f62 286a 6f62 5f69 6429 0a20  ow_job(job_id). 
-00033050: 2020 2020 2020 2072 6574 7572 6e20 6a6f         return jo
-00033060: 6264 6963 745b 2743 6f6d 6d65 6e74 275d  bdict['Comment']
-00033070: 0a0a 2020 2020 6465 6620 6a6f 625f 636f  ..    def job_co
-00033080: 6d6d 656e 745f 7772 6974 6528 7365 6c66  mment_write(self
-00033090: 2c20 6a6f 625f 6964 2c20 636f 6d6d 656e  , job_id, commen
-000330a0: 7429 3a0a 2020 2020 2020 2020 2320 6120  t):.        # a 
-000330b0: 636f 6d6d 656e 7420 6361 6e20 6265 206d  comment can be m
-000330c0: 6178 696d 756d 2032 3530 2063 6861 7261  aximum 250 chara
-000330d0: 6374 6572 732c 2077 696c 6c20 6265 2063  cters, will be c
-000330e0: 686f 7070 6564 2061 7574 6f6d 6174 6963  hopped automatic
-000330f0: 616c 6c79 0a20 2020 2020 2020 2061 7267  ally.        arg
-00033100: 7320 3d20 5b27 7570 6461 7465 272c 2066  s = ['update', f
-00033110: 274a 6f62 4964 3d7b 7374 7228 6a6f 625f  'JobId={str(job_
-00033120: 6964 297d 272c 0a20 2020 2020 2020 2020  id)}',.         
-00033130: 2020 2020 2020 2066 2743 6f6d 6d65 6e74         f'Comment
-00033140: 3d7b 636f 6d6d 656e 747d 272c 2073 7472  ={comment}', str
-00033150: 286a 6f62 5f69 6429 5d0a 2020 2020 2020  (job_id)].      
-00033160: 2020 7265 7375 6c74 203d 2073 7562 7072    result = subpr
-00033170: 6f63 6573 732e 7275 6e28 5b27 7363 6f6e  ocess.run(['scon
-00033180: 7472 6f6c 275d 202b 2061 7267 732c 0a20  trol'] + args,. 
-00033190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000331b0: 7464 6f75 743d 7375 6270 726f 6365 7373  tdout=subprocess
-000331c0: 2e50 4950 452c 2073 7464 6572 723d 7375  .PIPE, stderr=su
-000331d0: 6270 726f 6365 7373 2e50 4950 452c 2074  bprocess.PIPE, t
-000331e0: 6578 743d 5472 7565 290a 2020 2020 2020  ext=True).      
-000331f0: 2020 6966 2072 6573 756c 742e 7265 7475    if result.retu
-00033200: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
-00033210: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-00033220: 756e 7469 6d65 4572 726f 7228 0a20 2020  untimeError(.   
-00033230: 2020 2020 2020 2020 2020 2020 2066 2245               f"E
-00033240: 7272 6f72 2072 756e 6e69 6e67 2073 636f  rror running sco
-00033250: 6e74 726f 6c3a 207b 7265 7375 6c74 2e73  ntrol: {result.s
-00033260: 7464 6572 722e 7374 7269 7028 297d 2229  tderr.strip()}")
-00033270: 0a0a 2020 2020 6465 6620 5f73 636f 6e74  ..    def _scont
-00033280: 726f 6c5f 7368 6f77 5f6a 6f62 2873 656c  rol_show_job(sel
-00033290: 662c 206a 6f62 5f69 6429 3a0a 2020 2020  f, job_id):.    
-000332a0: 2020 2020 6172 6773 203d 205b 222d 2d6f      args = ["--o
-000332b0: 6e65 6c69 6e65 7222 2c20 2273 686f 7722  neliner", "show"
-000332c0: 2c20 226a 6f62 222c 2073 7472 286a 6f62  , "job", str(job
-000332d0: 5f69 6429 5d0a 2020 2020 2020 2020 7265  _id)].        re
-000332e0: 7375 6c74 203d 2073 7562 7072 6f63 6573  sult = subproces
-000332f0: 732e 7275 6e28 5b27 7363 6f6e 7472 6f6c  s.run(['scontrol
-00033300: 275d 202b 2061 7267 732c 0a20 2020 2020  '] + args,.     
-00033310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033320: 2020 2020 2020 2020 2020 2073 7464 6f75             stdou
-00033330: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
-00033340: 452c 2073 7464 6572 723d 7375 6270 726f  E, stderr=subpro
-00033350: 6365 7373 2e50 4950 452c 2074 6578 743d  cess.PIPE, text=
-00033360: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
-00033370: 2072 6573 756c 742e 7265 7475 726e 636f   result.returnco
-00033380: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
-00033390: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-000333a0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-000333b0: 2020 2020 2020 2020 2066 2245 7272 6f72           f"Error
-000333c0: 2072 756e 6e69 6e67 2073 636f 6e74 726f   running scontro
-000333d0: 6c3a 207b 7265 7375 6c74 2e73 7464 6572  l: {result.stder
-000333e0: 722e 7374 7269 7028 297d 2229 0a20 2020  r.strip()}").   
-000333f0: 2020 2020 2073 656c 662e 6a6f 625f 696e       self.job_in
-00033400: 666f 203d 2073 656c 662e 5f70 6172 7365  fo = self._parse
-00033410: 5f73 636f 6e74 726f 6c5f 6f75 7470 7574  _scontrol_output
-00033420: 2872 6573 756c 742e 7374 646f 7574 290a  (result.stdout).
-00033430: 0a20 2020 2064 6566 205f 7061 7273 655f  .    def _parse_
-00033440: 7363 6f6e 7472 6f6c 5f6f 7574 7075 7428  scontrol_output(
-00033450: 7365 6c66 2c20 6f75 7470 7574 293a 0a20  self, output):. 
-00033460: 2020 2020 2020 2066 6965 6c64 7320 3d20         fields = 
-00033470: 6f75 7470 7574 2e73 7472 6970 2829 2e73  output.strip().s
-00033480: 706c 6974 2829 0a20 2020 2020 2020 206a  plit().        j
-00033490: 6f62 5f69 6e66 6f20 3d20 7b7d 0a20 2020  ob_info = {}.   
-000334a0: 2020 2020 2066 6f72 2066 6965 6c64 2069       for field i
-000334b0: 6e20 6669 656c 6473 3a0a 2020 2020 2020  n fields:.      
-000334c0: 2020 2020 2020 6b65 792c 2076 616c 7565        key, value
-000334d0: 203d 2066 6965 6c64 2e73 706c 6974 2827   = field.split('
-000334e0: 3d27 2c20 3129 0a20 2020 2020 2020 2020  =', 1).         
-000334f0: 2020 206a 6f62 5f69 6e66 6f5b 6b65 795d     job_info[key]
-00033500: 203d 2076 616c 7565 0a20 2020 2020 2020   = value.       
-00033510: 2072 6574 7572 6e20 6a6f 625f 696e 666f   return job_info
-00033520: 0a0a 2020 2020 6465 6620 5f70 6172 7365  ..    def _parse
-00033530: 5f74 6162 756c 6172 5f64 6174 6128 7365  _tabular_data(se
-00033540: 6c66 2c20 6461 7461 5f73 7472 2c20 7365  lf, data_str, se
-00033550: 7061 7261 746f 723d 227c 2229 3a0a 2020  parator="|"):.  
-00033560: 2020 2020 2020 2222 2250 6172 7365 2064        """Parse d
-00033570: 6174 6120 2865 2e67 2e20 6163 6374 6d67  ata (e.g. acctmg
-00033580: 7229 2070 7265 7365 6e74 6564 2069 6e20  r) presented in 
-00033590: 6120 7461 6275 6c61 7220 666f 726d 6174  a tabular format
-000335a0: 2069 6e74 6f20 6120 6c69 7374 206f 6620   into a list of 
-000335b0: 6469 6374 696f 6e61 7269 6573 2e22 2222  dictionaries."""
-000335c0: 0a20 2020 2020 2020 206c 696e 6573 203d  .        lines =
-000335d0: 2064 6174 615f 7374 722e 7374 7269 7028   data_str.strip(
-000335e0: 292e 7370 6c69 746c 696e 6573 2829 0a20  ).splitlines(). 
-000335f0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-00033600: 206c 696e 6573 5b30 5d2e 7370 6c69 7428   lines[0].split(
-00033610: 7365 7061 7261 746f 7229 0a20 2020 2020  separator).     
-00033620: 2020 2064 6174 6120 3d20 5b5d 0a20 2020     data = [].   
-00033630: 2020 2020 2066 6f72 206c 696e 6520 696e       for line in
-00033640: 206c 696e 6573 5b31 3a5d 3a0a 2020 2020   lines[1:]:.    
-00033650: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-00033660: 206c 696e 652e 7370 6c69 7428 7365 7061   line.split(sepa
-00033670: 7261 746f 7229 0a20 2020 2020 2020 2020  rator).         
-00033680: 2020 2064 6174 612e 6170 7065 6e64 2864     data.append(d
-00033690: 6963 7428 7a69 7028 6865 6164 6572 732c  ict(zip(headers,
-000336a0: 2076 616c 7565 7329 2929 0a20 2020 2020   values))).     
-000336b0: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
-000336c0: 2020 2020 6465 6620 5f70 6172 7365 5f70      def _parse_p
-000336d0: 6172 7469 7469 6f6e 5f64 6174 6128 7365  artition_data(se
-000336e0: 6c66 2c20 6461 7461 5f73 7472 293a 0a20  lf, data_str):. 
-000336f0: 2020 2020 2020 2022 2222 5061 7273 6520         """Parse 
-00033700: 6461 7461 2070 7265 7365 6e74 6564 2069  data presented i
-00033710: 6e20 6120 7461 6275 6c61 7220 666f 726d  n a tabular form
-00033720: 6174 2069 6e74 6f20 6120 6c69 7374 206f  at into a list o
-00033730: 6620 6469 6374 696f 6e61 7269 6573 2e22  f dictionaries."
-00033740: 2222 0a20 2020 2020 2020 206c 696e 6573  "".        lines
-00033750: 203d 2064 6174 615f 7374 722e 7374 7269   = data_str.stri
-00033760: 7028 292e 7370 6c69 7428 275c 6e27 290a  p().split('\n').
-00033770: 2020 2020 2020 2020 2320 5061 7273 6520          # Parse 
-00033780: 6561 6368 206c 696e 6520 696e 746f 2061  each line into a
-00033790: 2064 6963 7469 6f6e 6172 790a 2020 2020   dictionary.    
-000337a0: 2020 2020 7061 7274 6974 696f 6e73 203d      partitions =
-000337b0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-000337c0: 6c69 6e65 2069 6e20 6c69 6e65 733a 0a20  line in lines:. 
-000337d0: 2020 2020 2020 2020 2020 2070 6172 7473             parts
-000337e0: 203d 206c 696e 652e 7370 6c69 7428 290a   = line.split().
-000337f0: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00033800: 6974 696f 6e5f 6469 6374 203d 207b 7d0a  ition_dict = {}.
-00033810: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00033820: 7061 7274 2069 6e20 7061 7274 733a 0a20  part in parts:. 
-00033830: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00033840: 6579 2c20 7661 6c75 6520 3d20 7061 7274  ey, value = part
-00033850: 2e73 706c 6974 2822 3d22 2c20 3129 0a20  .split("=", 1). 
-00033860: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00033870: 6172 7469 7469 6f6e 5f64 6963 745b 6b65  artition_dict[ke
-00033880: 795d 203d 2076 616c 7565 0a20 2020 2020  y] = value.     
-00033890: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-000338a0: 732e 6170 7065 6e64 2870 6172 7469 7469  s.append(partiti
-000338b0: 6f6e 5f64 6963 7429 0a20 2020 2020 2020  on_dict).       
-000338c0: 2072 6574 7572 6e20 7061 7274 6974 696f   return partitio
-000338d0: 6e73 0a0a 2020 2020 6465 6620 5f67 6574  ns..    def _get
-000338e0: 5f75 7365 725f 6772 6f75 7073 2873 656c  _user_groups(sel
-000338f0: 6629 3a0a 2020 2020 2020 2020 2222 2247  f):.        """G
-00033900: 6574 2074 6865 2067 726f 7570 7320 7468  et the groups th
-00033910: 6520 6375 7272 656e 7420 556e 6978 2075  e current Unix u
-00033920: 7365 7220 6973 2061 206d 656d 6265 7220  ser is a member 
-00033930: 6f66 2e22 2222 0a20 2020 2020 2020 2067  of.""".        g
-00033940: 726f 7570 7320 3d20 5b67 7270 2e67 6574  roups = [grp.get
-00033950: 6772 6769 6428 6769 6429 2e67 725f 6e61  grgid(gid).gr_na
-00033960: 6d65 2066 6f72 2067 6964 2069 6e20 6f73  me for gid in os
-00033970: 2e67 6574 6772 6f75 7073 2829 5d0a 2020  .getgroups()].  
-00033980: 2020 2020 2020 7265 7475 726e 2067 726f        return gro
-00033990: 7570 730a 0a20 2020 2064 6566 205f 6765  ups..    def _ge
-000339a0: 745f 6f75 7470 7574 2873 656c 662c 2063  t_output(self, c
-000339b0: 6f6d 6d61 6e64 293a 0a20 2020 2020 2020  ommand):.       
-000339c0: 2022 2222 4578 6563 7574 6520 6120 7368   """Execute a sh
-000339d0: 656c 6c20 636f 6d6d 616e 6420 616e 6420  ell command and 
-000339e0: 7265 7475 726e 2069 7473 206f 7574 7075  return its outpu
-000339f0: 742e 2222 220a 2020 2020 2020 2020 7265  t.""".        re
-00033a00: 7375 6c74 203d 2073 7562 7072 6f63 6573  sult = subproces
-00033a10: 732e 7275 6e28 636f 6d6d 616e 642c 2073  s.run(command, s
-00033a20: 6865 6c6c 3d54 7275 652c 2074 6578 743d  hell=True, text=
-00033a30: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00033a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a50: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
-00033a60: 7072 6f63 6573 732e 5049 5045 2c20 7374  process.PIPE, st
-00033a70: 6465 7272 3d73 7562 7072 6f63 6573 732e  derr=subprocess.
-00033a80: 5049 5045 290a 2020 2020 2020 2020 6966  PIPE).        if
-00033a90: 2072 6573 756c 742e 7265 7475 726e 636f   result.returnco
-00033aa0: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
-00033ab0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-00033ac0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-00033ad0: 2020 2020 2020 2020 2066 2245 7272 6f72           f"Error
-00033ae0: 2072 756e 6e69 6e67 207b 636f 6d6d 616e   running {comman
-00033af0: 647d 3a20 7b72 6573 756c 742e 7374 6465  d}: {result.stde
-00033b00: 7272 2e73 7472 6970 2829 7d22 290a 2020  rr.strip()}").  
-00033b10: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00033b20: 756c 742e 7374 646f 7574 2e73 7472 6970  ult.stdout.strip
-00033b30: 2829 0a0a 2020 2020 6465 6620 5f67 6574  ()..    def _get
-00033b40: 5f64 6566 6175 6c74 5f61 6363 6f75 6e74  _default_account
-00033b50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00033b60: 7265 7475 726e 2073 656c 662e 5f67 6574  return self._get
-00033b70: 5f6f 7574 7075 7428 6627 7361 6363 746d  _output(f'sacctm
-00033b80: 6772 202d 2d6e 6f68 6561 6465 7220 2d2d  gr --noheader --
-00033b90: 7061 7273 6162 6c65 3220 7368 6f77 2075  parsable2 show u
-00033ba0: 7365 7220 7b73 656c 662e 6366 672e 7768  ser {self.cfg.wh
-00033bb0: 6f61 6d69 7d20 666f 726d 6174 3d44 6566  oami} format=Def
-00033bc0: 6175 6c74 4163 636f 756e 7427 290a 0a20  aultAccount').. 
-00033bd0: 2020 2064 6566 205f 6765 745f 6173 736f     def _get_asso
-00033be0: 6369 6174 696f 6e73 2873 656c 6629 3a0a  ciations(self):.
-00033bf0: 2020 2020 2020 2020 6d79 7374 7220 3d20          mystr = 
-00033c00: 7365 6c66 2e5f 6765 745f 6f75 7470 7574  self._get_output
-00033c10: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-00033c20: 7361 6363 746d 6772 2073 686f 7720 6173  sacctmgr show as
-00033c30: 736f 6369 6174 696f 6e73 2077 6865 7265  sociations where
-00033c40: 2075 7365 723d 7b73 656c 662e 6366 672e   user={self.cfg.
-00033c50: 7768 6f61 6d69 7d20 666f 726d 6174 3d41  whoami} format=A
-00033c60: 6363 6f75 6e74 2c51 4f53 202d 2d70 6172  ccount,QOS --par
-00033c70: 7361 626c 6532 2229 0a20 2020 2020 2020  sable2").       
-00033c80: 2061 7373 6f20 3d20 7b69 7465 6d5b 2741   asso = {item['A
-00033c90: 6363 6f75 6e74 275d 3a20 6974 656d 5b27  ccount']: item['
-00033ca0: 514f 5327 5d2e 7370 6c69 7428 0a20 2020  QOS'].split(.   
-00033cb0: 2020 2020 2020 2020 2022 2c22 2920 666f           ",") fo
-00033cc0: 7220 6974 656d 2069 6e20 7365 6c66 2e5f  r item in self._
-00033cd0: 7061 7273 655f 7461 6275 6c61 725f 6461  parse_tabular_da
-00033ce0: 7461 286d 7973 7472 2920 6966 2027 4163  ta(mystr) if 'Ac
-00033cf0: 636f 756e 7427 2069 6e20 6974 656d 7d0a  count' in item}.
-00033d00: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00033d10: 7373 6f0a 0a20 2020 2064 6566 2067 6574  sso..    def get
-00033d20: 5f61 6c6c 6f77 6564 5f70 6172 7469 7469  _allowed_partiti
-00033d30: 6f6e 735f 616e 645f 716f 7328 7365 6c66  ons_and_qos(self
-00033d40: 2c20 6163 636f 756e 743d 4e6f 6e65 293a  , account=None):
-00033d50: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00033d60: 6120 6469 6374 696f 6e61 7279 2077 6974  a dictionary wit
-00033d70: 6820 6b65 7973 203d 2070 6172 7469 7469  h keys = partiti
-00033d80: 6f6e 7320 616e 6420 7661 6c75 6573 203d  ons and values =
-00033d90: 2051 4f53 7320 7468 6520 7573 6572 2069   QOSs the user i
-00033da0: 7320 616c 6c6f 7765 6420 746f 2075 7365  s allowed to use
-00033db0: 2e22 2222 0a20 2020 2020 2020 2062 6163  .""".        bac
-00033dc0: 6320 3d20 6f73 2e65 6e76 6972 6f6e 2e67  c = os.environ.g
-00033dd0: 6574 2827 5342 4154 4348 5f41 4343 4f55  et('SBATCH_ACCOU
-00033de0: 4e54 272c 2027 2729 0a20 2020 2020 2020  NT', '').       
-00033df0: 2061 6363 6f75 6e74 203d 2062 6163 6320   account = bacc 
-00033e00: 6966 2062 6163 6320 656c 7365 2061 6363  if bacc else acc
-00033e10: 6f75 6e74 0a20 2020 2020 2020 2073 6163  ount.        sac
-00033e20: 6320 3d20 6f73 2e65 6e76 6972 6f6e 2e67  c = os.environ.g
-00033e30: 6574 2827 534c 5552 4d5f 4143 434f 554e  et('SLURM_ACCOUN
-00033e40: 5427 2c20 2727 290a 2020 2020 2020 2020  T', '').        
-00033e50: 6163 636f 756e 7420 3d20 7361 6363 2069  account = sacc i
-00033e60: 6620 7361 6363 2065 6c73 6520 6163 636f  f sacc else acco
-00033e70: 756e 740a 2020 2020 2020 2020 616c 6c6f  unt.        allo
-00033e80: 7765 645f 7061 7274 6974 696f 6e73 203d  wed_partitions =
-00033e90: 207b 7d0a 2020 2020 2020 2020 7061 7274   {}.        part
-00033ea0: 6974 696f 6e5f 7374 7220 3d20 7365 6c66  ition_str = self
-00033eb0: 2e5f 6765 745f 6f75 7470 7574 2822 7363  ._get_output("sc
-00033ec0: 6f6e 7472 6f6c 2073 686f 7720 7061 7274  ontrol show part
-00033ed0: 6974 696f 6e20 2d2d 6f6e 656c 696e 6572  ition --oneliner
-00033ee0: 2229 0a20 2020 2020 2020 2070 6172 7469  ").        parti
-00033ef0: 7469 6f6e 7320 3d20 7365 6c66 2e5f 7061  tions = self._pa
-00033f00: 7273 655f 7061 7274 6974 696f 6e5f 6461  rse_partition_da
-00033f10: 7461 2870 6172 7469 7469 6f6e 5f73 7472  ta(partition_str
-00033f20: 290a 2020 2020 2020 2020 7573 6572 5f67  ).        user_g
-00033f30: 726f 7570 7320 3d20 7365 6c66 2e5f 6765  roups = self._ge
-00033f40: 745f 7573 6572 5f67 726f 7570 7328 290a  t_user_groups().
-00033f50: 2020 2020 2020 2020 6966 2061 6363 6f75          if accou
-00033f60: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-00033f70: 2020 2020 2020 2020 6163 636f 756e 7420          account 
-00033f80: 3d20 7365 6c66 2e5f 6765 745f 6465 6661  = self._get_defa
-00033f90: 756c 745f 6163 636f 756e 7428 290a 2020  ult_account().  
-00033fa0: 2020 2020 2020 666f 7220 7061 7274 6974        for partit
-00033fb0: 696f 6e20 696e 2070 6172 7469 7469 6f6e  ion in partition
-00033fc0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00033fd0: 6e61 6d65 203d 2070 6172 7469 7469 6f6e  name = partition
-00033fe0: 5b27 5061 7274 6974 696f 6e4e 616d 6527  ['PartitionName'
-00033ff0: 5d0a 2020 2020 2020 2020 2020 2020 6164  ].            ad
-00034000: 645f 7061 7274 6974 696f 6e20 3d20 4661  d_partition = Fa
-00034010: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00034020: 6966 2070 6172 7469 7469 6f6e 2e67 6574  if partition.get
-00034030: 2827 5374 6174 6527 2c20 2727 2920 213d  ('State', '') !=
-00034040: 2027 5550 273a 0a20 2020 2020 2020 2020   'UP':.         
-00034050: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00034060: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00034070: 6e79 2867 726f 7570 2069 6e20 7573 6572  ny(group in user
-00034080: 5f67 726f 7570 7320 666f 7220 6772 6f75  _groups for grou
-00034090: 7020 696e 2070 6172 7469 7469 6f6e 2e67  p in partition.g
-000340a0: 6574 2827 4465 6e79 4772 6f75 7073 272c  et('DenyGroups',
-000340b0: 2027 2729 2e73 706c 6974 2827 2c27 2929   '').split(','))
-000340c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000340d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-000340e0: 2020 2020 2020 2069 6620 6163 636f 756e         if accoun
-000340f0: 7420 696e 2070 6172 7469 7469 6f6e 2e67  t in partition.g
-00034100: 6574 2827 4465 6e79 4163 636f 756e 7473  et('DenyAccounts
-00034110: 272c 2027 2729 2e73 706c 6974 2827 2c27  ', '').split(','
-00034120: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00034130: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00034140: 2020 2020 2020 2020 616c 6c6f 7765 6461          alloweda
-00034150: 6363 6f75 6e74 7320 3d20 7061 7274 6974  ccounts = partit
-00034160: 696f 6e2e 6765 7428 2741 6c6c 6f77 4163  ion.get('AllowAc
-00034170: 636f 756e 7473 272c 2027 2729 2e73 706c  counts', '').spl
-00034180: 6974 2827 2c27 290a 2020 2020 2020 2020  it(',').        
-00034190: 2020 2020 6966 2061 6c6c 6f77 6564 6163      if allowedac
-000341a0: 636f 756e 7473 2021 3d20 5b27 275d 3a0a  counts != ['']:.
-000341b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000341c0: 6966 2061 6363 6f75 6e74 2069 6e20 616c  if account in al
-000341d0: 6c6f 7765 6461 6363 6f75 6e74 7320 6f72  lowedaccounts or
-000341e0: 2027 414c 4c27 2069 6e20 616c 6c6f 7765   'ALL' in allowe
-000341f0: 6461 6363 6f75 6e74 733a 0a20 2020 2020  daccounts:.     
-00034200: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00034210: 6464 5f70 6172 7469 7469 6f6e 203d 2054  dd_partition = T
-00034220: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00034230: 656c 6966 2061 6e79 2867 726f 7570 2069  elif any(group i
-00034240: 6e20 7573 6572 5f67 726f 7570 7320 666f  n user_groups fo
-00034250: 7220 6772 6f75 7020 696e 2070 6172 7469  r group in parti
-00034260: 7469 6f6e 2e67 6574 2827 416c 6c6f 7747  tion.get('AllowG
-00034270: 726f 7570 7327 2c20 2727 292e 7370 6c69  roups', '').spli
-00034280: 7428 272c 2729 293a 0a20 2020 2020 2020  t(',')):.       
-00034290: 2020 2020 2020 2020 2061 6464 5f70 6172           add_par
-000342a0: 7469 7469 6f6e 203d 2054 7275 650a 2020  tition = True.  
-000342b0: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
-000342c0: 6172 7469 7469 6f6e 2e67 6574 2827 416c  artition.get('Al
-000342d0: 6c6f 7747 726f 7570 7327 2c20 2727 2920  lowGroups', '') 
-000342e0: 3d3d 2027 414c 4c27 3a0a 2020 2020 2020  == 'ALL':.      
-000342f0: 2020 2020 2020 2020 2020 6164 645f 7061            add_pa
-00034300: 7274 6974 696f 6e20 3d20 5472 7565 0a20  rtition = True. 
-00034310: 2020 2020 2020 2020 2020 2069 6620 6164             if ad
-00034320: 645f 7061 7274 6974 696f 6e3a 0a20 2020  d_partition:.   
-00034330: 2020 2020 2020 2020 2020 2020 2070 5f64               p_d
-00034340: 656e 6965 6471 6f73 203d 2070 6172 7469  eniedqos = parti
-00034350: 7469 6f6e 2e67 6574 2827 4465 6e79 516f  tion.get('DenyQo
-00034360: 7327 2c20 2727 292e 7370 6c69 7428 272c  s', '').split(',
-00034370: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00034380: 2020 2070 5f61 6c6c 6f77 6564 716f 7320     p_allowedqos 
-00034390: 3d20 7061 7274 6974 696f 6e2e 6765 7428  = partition.get(
-000343a0: 2741 6c6c 6f77 516f 7327 2c20 2727 292e  'AllowQos', '').
-000343b0: 7370 6c69 7428 272c 2729 0a20 2020 2020  split(',').     
-000343c0: 2020 2020 2020 2020 2020 2061 7373 6f63             assoc
-000343d0: 6961 7469 6f6e 7320 3d20 7365 6c66 2e5f  iations = self._
-000343e0: 6765 745f 6173 736f 6369 6174 696f 6e73  get_associations
-000343f0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00034400: 2020 2061 6363 6f75 6e74 5f71 6f73 203d     account_qos =
-00034410: 2061 7373 6f63 6961 7469 6f6e 732e 6765   associations.ge
-00034420: 7428 6163 636f 756e 742c 205b 5d29 0a20  t(account, []). 
-00034430: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00034440: 6620 705f 6465 6e69 6564 716f 7320 213d  f p_deniedqos !=
-00034450: 205b 2727 5d3a 0a20 2020 2020 2020 2020   ['']:.         
-00034460: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
-00034470: 6564 5f71 6f73 203d 205b 0a20 2020 2020  ed_qos = [.     
-00034480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034490: 2020 2071 2066 6f72 2071 2069 6e20 6163     q for q in ac
-000344a0: 636f 756e 745f 716f 7320 6966 2071 206e  count_qos if q n
-000344b0: 6f74 2069 6e20 705f 6465 6e69 6564 716f  ot in p_deniedqo
-000344c0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
-000344d0: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-000344e0: 2270 5f64 656e 6965 6471 6f73 3a20 616c  "p_deniedqos: al
-000344f0: 6c6f 7765 645f 716f 7320 696e 207b 706e  lowed_qos in {pn
-00034500: 616d 657d 3a22 2c20 616c 6c6f 7765 645f  ame}:", allowed_
-00034510: 716f 7329 0a20 2020 2020 2020 2020 2020  qos).           
-00034520: 2020 2020 2065 6c69 6620 705f 616c 6c6f       elif p_allo
-00034530: 7765 6471 6f73 203d 3d20 5b27 414c 4c27  wedqos == ['ALL'
-00034540: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00034550: 2020 2020 2020 2061 6c6c 6f77 6564 5f71         allowed_q
-00034560: 6f73 203d 2061 6363 6f75 6e74 5f71 6f73  os = account_qos
-00034570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034580: 2020 2020 2023 2070 7269 6e74 2866 2270       # print(f"p
-00034590: 5f61 6c6c 6f77 6564 716f 7320 3d20 414c  _allowedqos = AL
-000345a0: 4c20 696e 207b 706e 616d 657d 3a22 2c20  L in {pname}:", 
-000345b0: 616c 6c6f 7765 645f 716f 7329 0a20 2020  allowed_qos).   
-000345c0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000345d0: 6620 705f 616c 6c6f 7765 6471 6f73 2021  f p_allowedqos !
-000345e0: 3d20 5b27 275d 3a0a 2020 2020 2020 2020  = ['']:.        
-000345f0: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-00034600: 7765 645f 716f 7320 3d20 5b71 2066 6f72  wed_qos = [q for
-00034610: 2071 2069 6e20 6163 636f 756e 745f 716f   q in account_qo
-00034620: 7320 6966 2071 2069 6e20 705f 616c 6c6f  s if q in p_allo
-00034630: 7765 6471 6f73 5d0a 2020 2020 2020 2020  wedqos].        
-00034640: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00034650: 696e 7428 6622 705f 616c 6c6f 7765 6471  int(f"p_allowedq
-00034660: 6f73 3a20 616c 6c6f 7765 645f 716f 7320  os: allowed_qos 
-00034670: 696e 207b 706e 616d 657d 3a22 2c20 616c  in {pname}:", al
-00034680: 6c6f 7765 645f 716f 7329 0a20 2020 2020  lowed_qos).     
-00034690: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000346a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000346b0: 2020 2020 2061 6c6c 6f77 6564 5f71 6f73       allowed_qos
-000346c0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-000346d0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-000346e0: 7428 6622 705f 616c 6c6f 7765 6471 6f73  t(f"p_allowedqos
-000346f0: 203d 205b 5d20 696e 207b 706e 616d 657d   = [] in {pname}
-00034700: 3a22 2c20 616c 6c6f 7765 645f 716f 7329  :", allowed_qos)
-00034710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034720: 2061 6c6c 6f77 6564 5f70 6172 7469 7469   allowed_partiti
-00034730: 6f6e 735b 706e 616d 655d 203d 2061 6c6c  ons[pname] = all
-00034740: 6f77 6564 5f71 6f73 0a20 2020 2020 2020  owed_qos.       
-00034750: 2072 6574 7572 6e20 616c 6c6f 7765 645f   return allowed_
-00034760: 7061 7274 6974 696f 6e73 0a0a 2020 2020  partitions..    
-00034770: 6465 6620 6469 7370 6c61 795f 6a6f 625f  def display_job_
-00034780: 696e 666f 2873 656c 6629 3a0a 2020 2020  info(self):.    
-00034790: 2020 2020 7072 696e 7428 7365 6c66 2e6a      print(self.j
-000347a0: 6f62 5f69 6e66 6f29 0a0a 0a63 6c61 7373  ob_info)...class
-000347b0: 204e 4948 5265 706f 7274 6572 3a0a 2020   NIHReporter:.  
-000347c0: 2020 2320 6966 2077 6520 7573 6520 2d2d    # if we use --
-000347d0: 6e69 6820 6173 2061 6e20 6172 6775 6d65  nih as an argume
-000347e0: 6e74 2077 6520 7175 6572 7920 4e49 4820  nt we query NIH 
-000347f0: 5265 706f 7274 6572 0a20 2020 2023 2066  Reporter.    # f
-00034800: 6f72 206d 6574 6164 6174 610a 0a20 2020  or metadata..   
-00034810: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00034820: 6c66 2c20 7665 7262 6f73 653d 4661 6c73  lf, verbose=Fals
-00034830: 652c 2061 6374 6976 653d 4661 6c73 652c  e, active=False,
-00034840: 2079 6561 7273 3d4e 6f6e 6529 3a0a 2020   years=None):.  
-00034850: 2020 2020 2020 2320 7365 6c66 2e61 7267        # self.arg
-00034860: 7320 3d20 6172 6773 0a20 2020 2020 2020  s = args.       
-00034870: 2073 656c 662e 7665 7262 6f73 6520 3d20   self.verbose = 
-00034880: 7665 7262 6f73 650a 2020 2020 2020 2020  verbose.        
-00034890: 7365 6c66 2e61 6374 6976 6520 3d20 6163  self.active = ac
-000348a0: 7469 7665 0a20 2020 2020 2020 2073 656c  tive.        sel
-000348b0: 662e 7965 6172 7320 3d20 7965 6172 730a  f.years = years.
-000348c0: 2020 2020 2020 2020 7365 6c66 2e75 726c          self.url
-000348d0: 203d 2027 6874 7470 733a 2f2f 6170 692e   = 'https://api.
-000348e0: 7265 706f 7274 6572 2e6e 6968 2e67 6f76  reporter.nih.gov
-000348f0: 2f76 322f 7072 6f6a 6563 7473 2f73 6561  /v2/projects/sea
-00034900: 7263 6827 0a20 2020 2020 2020 2073 656c  rch'.        sel
-00034910: 662e 6578 636c 7564 655f 6669 656c 6473  f.exclude_fields
-00034920: 203d 205b 2754 6572 6d73 272c 2027 4162   = ['Terms', 'Ab
-00034930: 7374 7261 6374 5465 7874 272c 0a20 2020  stractText',.   
-00034940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034950: 2020 2020 2020 2020 2020 2020 2750 6872              'Phr
-00034960: 5465 7874 275d 2020 2320 7072 6566 5f74  Text']  # pref_t
-00034970: 6572 6d73 2073 7469 6c6c 2069 6e63 6c75  erms still inclu
-00034980: 6465 640a 2020 2020 2020 2020 7365 6c66  ded.        self
-00034990: 2e67 7261 6e74 7320 3d20 5b5d 0a0a 2020  .grants = []..  
-000349a0: 2020 6465 6620 7365 6172 6368 5f66 756c    def search_ful
-000349b0: 6c28 7365 6c66 2c20 7365 6172 6368 7374  l(self, searchst
-000349c0: 7229 3a0a 2020 2020 2020 2020 7365 6172  r):.        sear
-000349d0: 6368 7374 7220 3d20 7365 6c66 2e5f 636c  chstr = self._cl
-000349e0: 6561 6e5f 7374 7269 6e67 2873 6561 7263  ean_string(searc
-000349f0: 6873 7472 290a 2020 2020 2020 2020 6966  hstr).        if
-00034a00: 206e 6f74 2073 6561 7263 6873 7472 3a0a   not searchstr:.
-00034a10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00034a20: 726e 205b 5d0a 0a20 2020 2020 2020 2023  rn []..        #
-00034a30: 2053 6561 7263 6820 6279 2050 490a 2020   Search by PI.  
-00034a40: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00034a50: 662e 5f69 735f 6e75 6d62 6572 2873 6561  f._is_number(sea
-00034a60: 7263 6873 7472 293a 0a20 2020 2020 2020  rchstr):.       
-00034a70: 2020 2020 2070 7269 6e74 2827 5049 2073       print('PI s
-00034a80: 6561 7263 6820 2e2e 2e27 290a 2020 2020  earch ...').    
-00034a90: 2020 2020 2020 2020 6372 6974 6572 6961          criteria
-00034aa0: 203d 207b 2270 695f 6e61 6d65 7322 3a20   = {"pi_names": 
-00034ab0: 5b7b 2261 6e79 5f6e 616d 6522 3a20 7365  [{"any_name": se
-00034ac0: 6172 6368 7374 727d 5d7d 0a20 2020 2020  archstr}]}.     
-00034ad0: 2020 2020 2020 2073 656c 662e 5f70 6f73         self._pos
-00034ae0: 745f 7265 7175 6573 7428 6372 6974 6572  t_request(criter
-00034af0: 6961 290a 2020 2020 2020 2020 2020 2020  ia).            
-00034b00: 7072 696e 7428 272a 2023 2047 7261 6e74  print('* # Grant
-00034b10: 733a 272c 206c 656e 2873 656c 662e 6772  s:', len(self.gr
-00034b20: 616e 7473 2929 0a0a 2020 2020 2020 2020  ants))..        
-00034b30: 6966 206e 6f74 2073 656c 662e 6772 616e  if not self.gran
-00034b40: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00034b50: 2320 5365 6172 6368 2062 7920 5072 6f6a  # Search by Proj
-00034b60: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
-00034b70: 7072 696e 7428 2750 726f 6a65 6374 2073  print('Project s
-00034b80: 6561 7263 6820 2e2e 2e27 290a 2020 2020  earch ...').    
-00034b90: 2020 2020 2020 2020 6372 6974 6572 6961          criteria
-00034ba0: 203d 207b 2770 726f 6a65 6374 5f6e 756d   = {'project_num
-00034bb0: 7327 3a20 5b73 6561 7263 6873 7472 5d7d  s': [searchstr]}
-00034bc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00034bd0: 662e 5f70 6f73 745f 7265 7175 6573 7428  f._post_request(
-00034be0: 6372 6974 6572 6961 290a 2020 2020 2020  criteria).      
-00034bf0: 2020 2020 2020 7072 696e 7428 272a 2023        print('* #
-00034c00: 2047 7261 6e74 733a 272c 206c 656e 2873   Grants:', len(s
-00034c10: 656c 662e 6772 616e 7473 2929 0a0a 2020  elf.grants))..  
-00034c20: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00034c30: 662e 6772 616e 7473 2061 6e64 206e 6f74  f.grants and not
-00034c40: 2073 656c 662e 5f69 735f 6e75 6d62 6572   self._is_number
-00034c50: 2873 6561 7263 6873 7472 293a 0a20 2020  (searchstr):.   
-00034c60: 2020 2020 2020 2020 2023 2053 6561 7263           # Searc
-00034c70: 6820 6279 204f 7267 616e 697a 6174 696f  h by Organizatio
-00034c80: 6e73 0a20 2020 2020 2020 2020 2020 2070  ns.            p
-00034c90: 7269 6e74 2827 4f72 6720 7365 6172 6368  rint('Org search
-00034ca0: 202e 2e2e 2729 0a20 2020 2020 2020 2020   ...').         
-00034cb0: 2020 2063 7269 7465 7269 6120 3d20 7b27     criteria = {'
-00034cc0: 6f72 675f 6e61 6d65 7327 3a20 5b73 6561  org_names': [sea
-00034cd0: 7263 6873 7472 5d7d 0a20 2020 2020 2020  rchstr]}.       
-00034ce0: 2020 2020 2073 656c 662e 5f70 6f73 745f       self._post_
-00034cf0: 7265 7175 6573 7428 6372 6974 6572 6961  request(criteria
-00034d00: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00034d10: 696e 7428 272a 2023 2047 7261 6e74 733a  int('* # Grants:
-00034d20: 272c 206c 656e 2873 656c 662e 6772 616e  ', len(self.gran
-00034d30: 7473 2929 0a0a 2020 2020 2020 2020 2320  ts))..        # 
-00034d40: 5365 6172 6368 2062 7920 7465 7874 2069  Search by text i
-00034d50: 6e20 2022 7072 6f6a 6563 7474 6974 6c65  n  "projecttitle
-00034d60: 222c 2022 7465 726d 7322 2c20 616e 6420  ", "terms", and 
-00034d70: 2261 6273 7472 6163 7474 6578 7422 0a20  "abstracttext". 
-00034d80: 2020 2020 2020 2070 7269 6e74 2827 5465         print('Te
-00034d90: 7874 2073 6561 7263 6820 2e2e 2e27 290a  xt search ...').
-00034da0: 2020 2020 2020 2020 6372 6974 6572 6961          criteria
-00034db0: 203d 207b 2761 6476 616e 6365 645f 7465   = {'advanced_te
-00034dc0: 7874 5f73 6561 7263 6827 3a0a 2020 2020  xt_search':.    
-00034dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034de0: 7b27 6f70 6572 6174 6f72 273a 2027 616e  {'operator': 'an
-00034df0: 6427 2c20 2773 6561 7263 685f 6669 656c  d', 'search_fiel
-00034e00: 6427 3a20 2761 6c6c 272c 0a20 2020 2020  d': 'all',.     
-00034e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034e20: 2773 6561 7263 685f 7465 7874 273a 2073  'search_text': s
-00034e30: 6561 7263 6873 7472 7d0a 2020 2020 2020  earchstr}.      
-00034e40: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00034e50: 2020 2020 2020 2020 7365 6c66 2e5f 706f          self._po
-00034e60: 7374 5f72 6571 7565 7374 2863 7269 7465  st_request(crite
-00034e70: 7269 6129 0a20 2020 2020 2020 2070 7269  ria).        pri
-00034e80: 6e74 2827 2a20 2320 4772 616e 7473 3a27  nt('* # Grants:'
-00034e90: 2c20 6c65 6e28 7365 6c66 2e67 7261 6e74  , len(self.grant
-00034ea0: 7329 290a 0a20 2020 2020 2020 2072 6574  s))..        ret
-00034eb0: 7572 6e20 7365 6c66 2e5f 7265 7375 6c74  urn self._result
-00034ec0: 5f73 6574 7328 5472 7565 290a 0a20 2020  _sets(True)..   
-00034ed0: 2064 6566 2073 6561 7263 685f 6f6e 6528   def search_one(
-00034ee0: 7365 6c66 2c20 6372 6974 6572 6961 2c20  self, criteria, 
-00034ef0: 6865 6164 6572 3d46 616c 7365 293a 0a20  header=False):. 
-00034f00: 2020 2020 2020 2073 6561 7263 6873 7472         searchstr
-00034f10: 203d 2073 656c 662e 5f63 6c65 616e 5f73   = self._clean_s
-00034f20: 7472 696e 6728 7365 6172 6368 7374 7229  tring(searchstr)
-00034f30: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-00034f40: 6f73 745f 7265 7175 6573 7428 6372 6974  ost_request(crit
-00034f50: 6572 6961 290a 2020 2020 2020 2020 7265  eria).        re
-00034f60: 7475 726e 2073 656c 662e 5f72 6573 756c  turn self._resul
-00034f70: 745f 7365 7473 2868 6561 6465 7229 0a0a  t_sets(header)..
-00034f80: 2020 2020 6465 6620 5f69 735f 6e75 6d62      def _is_numb
-00034f90: 6572 2873 656c 662c 2073 7472 696e 6729  er(self, string)
-00034fa0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-00034fb0: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-00034fc0: 2873 7472 696e 6729 0a20 2020 2020 2020  (string).       
-00034fd0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00034fe0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00034ff0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-00035000: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00035010: 616c 7365 0a0a 2020 2020 6465 6620 5f63  alse..    def _c
-00035020: 6c65 616e 5f73 7472 696e 6728 7365 6c66  lean_string(self
-00035030: 2c20 6d79 7374 7269 6e67 293a 0a20 2020  , mystring):.   
-00035040: 2020 2020 206d 7963 6861 7273 203d 2022       mychars = "
-00035050: 2c3a 3f27 245e 2526 2a21 607e 2b3d 7b7d  ,:?'$^%&*!`~+={}
-00035060: 5c5c 5b5d 222b 2722 270a 2020 2020 2020  \\[]"+'"'.      
-00035070: 2020 666f 7220 6920 696e 206d 7963 6861    for i in mycha
-00035080: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00035090: 6d79 7374 7269 6e67 203d 206d 7973 7472  mystring = mystr
-000350a0: 696e 672e 7265 706c 6163 6528 692c 2027  ing.replace(i, '
-000350b0: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
-000350c0: 2320 7072 696e 7428 276d 7973 7472 696e  # print('mystrin
-000350d0: 673a 272c 206d 7973 7472 696e 6729 0a20  g:', mystring). 
-000350e0: 2020 2020 2020 2072 6574 7572 6e20 6d79         return my
-000350f0: 7374 7269 6e67 0a0a 2020 2020 6465 6620  string..    def 
-00035100: 5f70 6f73 745f 7265 7175 6573 7428 7365  _post_request(se
-00035110: 6c66 2c20 6372 6974 6572 6961 293a 0a20  lf, criteria):. 
-00035120: 2020 2020 2020 2023 206d 616b 6520 7265         # make re
-00035130: 7175 6573 7420 7769 7468 2072 6574 7269  quest with retri
-00035140: 6573 0a20 2020 2020 2020 206f 6666 7365  es.        offse
-00035150: 7420 3d20 300a 2020 2020 2020 2020 7469  t = 0.        ti
-00035160: 6d65 6f75 7420 3d20 3330 0a20 2020 2020  meout = 30.     
-00035170: 2020 206c 696d 6974 203d 2032 3530 0a20     limit = 250. 
-00035180: 2020 2020 2020 206d 6178 203d 2032 3530         max = 250
-00035190: 0a20 2020 2020 2020 206d 6178 5f72 6574  .        max_ret
-000351a0: 7269 6573 203d 2035 0a20 2020 2020 2020  ries = 5.       
-000351b0: 2072 6574 7279 5f64 656c 6179 203d 2031   retry_delay = 1
-000351c0: 0a20 2020 2020 2020 2072 6574 7279 5f63  .        retry_c
-000351d0: 6f75 6e74 203d 2030 0a20 2020 2020 2020  ount = 0.       
-000351e0: 2074 6f74 616c 203d 206d 6178 0a20 2020   total = max.   
-000351f0: 2020 2020 2023 2066 6f72 2072 6574 7279       # for retry
-00035200: 5f63 6f75 6e74 2069 6e20 7261 6e67 6528  _count in range(
-00035210: 6d61 785f 7265 7472 6965 7329 3a0a 2020  max_retries):.  
-00035220: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00035230: 2020 2020 2020 2077 6869 6c65 206f 6666         while off
-00035240: 7365 7420 3c20 6d61 783a 0a20 2020 2020  set < max:.     
-00035250: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00035260: 7320 3d20 7b27 6f66 6673 6574 273a 206f  s = {'offset': o
-00035270: 6666 7365 742c 2027 6c69 6d69 7427 3a20  ffset, 'limit': 
-00035280: 6c69 6d69 742c 2027 6372 6974 6572 6961  limit, 'criteria
-00035290: 273a 2063 7269 7465 7269 612c 0a20 2020  ': criteria,.   
-000352a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000352b0: 2020 2020 2020 2027 6578 636c 7564 655f         'exclude_
-000352c0: 6669 656c 6473 273a 2073 656c 662e 6578  fields': self.ex
-000352d0: 636c 7564 655f 6669 656c 6473 7d0a 2020  clude_fields}.  
-000352e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000352f0: 6d61 6b65 2072 6571 7565 7374 0a20 2020  make request.   
-00035300: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00035310: 6e74 2827 5061 7261 6d73 3a27 2c20 7061  nt('Params:', pa
-00035320: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
-00035330: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
-00035340: 2072 6571 7565 7374 732e 706f 7374 280a   requests.post(.
-00035350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035360: 2020 2020 7365 6c66 2e75 726c 2c20 6a73      self.url, js
-00035370: 6f6e 3d70 6172 616d 732c 2074 696d 656f  on=params, timeo
-00035380: 7574 3d74 696d 656f 7574 290a 2020 2020  ut=timeout).    
-00035390: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-000353a0: 6563 6b20 7374 6174 7573 2063 6f64 6520  eck status code 
-000353b0: 2d20 656c 7365 2072 6574 7572 6e20 6461  - else return da
-000353c0: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
-000353d0: 2020 2069 6620 7265 7370 6f6e 7365 2e73     if response.s
-000353e0: 7461 7475 735f 636f 6465 203e 3d20 3430  tatus_code >= 40
-000353f0: 3020 616e 6420 7265 7370 6f6e 7365 2e73  0 and response.s
-00035400: 7461 7475 735f 636f 6465 203c 2035 3030  tatus_code < 500
-00035410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00035420: 2020 2020 2020 7072 696e 7428 6622 4261        print(f"Ba
-00035430: 6420 7265 7175 6573 743a 207b 7265 7370  d request: {resp
-00035440: 6f6e 7365 2e74 6578 747d 2229 0a20 2020  onse.text}").   
-00035450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035460: 2069 6620 7265 7472 795f 636f 756e 7420   if retry_count 
-00035470: 3c20 6d61 785f 7265 7472 6965 7320 2d20  < max_retries - 
-00035480: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00035490: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000354a0: 2866 2252 6574 7279 696e 6720 6166 7465  (f"Retrying afte
-000354b0: 7220 7b72 6574 7279 5f64 656c 6179 7d20  r {retry_delay} 
-000354c0: 7365 636f 6e64 732e 2e2e 2229 0a20 2020  seconds...").   
-000354d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000354e0: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
-000354f0: 7265 7472 795f 6465 6c61 7929 0a20 2020  retry_delay).   
-00035500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035510: 2020 2020 2072 6574 7279 5f63 6f75 6e74       retry_count
-00035520: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00035530: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00035540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035550: 2020 2020 2020 2020 2320 7261 6973 6520          # raise 
-00035560: 4578 6365 7074 696f 6e28 6622 4661 696c  Exception(f"Fail
-00035570: 6564 2074 6f20 636f 6d70 6c65 7465 2050  ed to complete P
-00035580: 4f53 5420 7265 7175 6573 7420 6166 7465  OST request afte
-00035590: 7220 7b6d 6178 5f72 6574 7269 6573 7d20  r {max_retries} 
-000355a0: 6174 7465 6d70 7473 2229 0a20 2020 2020  attempts").     
-000355b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000355c0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-000355d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000355e0: 2020 2020 2020 6622 4661 696c 6564 2074        f"Failed t
-000355f0: 6f20 636f 6d70 6c65 7465 2050 4f53 5420  o complete POST 
-00035600: 7265 7175 6573 7420 6166 7465 7220 7b6d  request after {m
-00035610: 6178 5f72 6574 7269 6573 7d20 6174 7465  ax_retries} atte
-00035620: 6d70 7473 2229 0a20 2020 2020 2020 2020  mpts").         
-00035630: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00035640: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00035650: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00035660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00035670: 2020 2020 2020 6a73 6f6e 203d 2072 6573        json = res
-00035680: 706f 6e73 652e 6a73 6f6e 2829 0a20 2020  ponse.json().   
-00035690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000356a0: 2074 6f74 616c 203d 206a 736f 6e5b 276d   total = json['m
-000356b0: 6574 6127 5d5b 2774 6f74 616c 275d 0a20  eta']['total']. 
-000356c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000356d0: 2020 2069 6620 746f 7461 6c20 3d3d 2030     if total == 0
-000356e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000356f0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00035700: 662e 7665 7262 6f73 653a 0a20 2020 2020  f.verbose:.     
-00035710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035720: 2020 2020 2020 2070 7269 6e74 2822 4e6f         print("No
-00035730: 2072 6563 6f72 6473 2066 6f72 2063 7269   records for cri
-00035740: 7465 7269 6120 277b 7d27 222e 666f 726d  teria '{}'".form
-00035750: 6174 2863 7269 7465 7269 6129 290a 2020  at(criteria)).  
-00035760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035770: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00035780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035790: 2069 6620 746f 7461 6c20 3c20 6d61 783a   if total < max:
-000357a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000357b0: 2020 2020 2020 2020 206d 6178 203d 2074           max = t
-000357c0: 6f74 616c 0a20 2020 2020 2020 2020 2020  otal.           
-000357d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000357e0: 2e76 6572 626f 7365 3a0a 2020 2020 2020  .verbose:.      
-000357f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035800: 2020 7072 696e 7428 2246 6f75 6e64 207b    print("Found {
-00035810: 307d 2072 6563 6f72 6473 2066 6f72 2063  0} records for c
-00035820: 7269 7465 7269 6120 277b 317d 2722 2e66  riteria '{1}'".f
-00035830: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-00035840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035850: 2020 2074 6f74 616c 2c20 6372 6974 6572     total, criter
-00035860: 6961 2929 0a20 2020 2020 2020 2020 2020  ia)).           
-00035870: 2020 2020 2020 2020 2073 656c 662e 6772           self.gr
-00035880: 616e 7473 202b 3d20 5b67 2066 6f72 2067  ants += [g for g
-00035890: 2069 6e20 6a73 6f6e 5b27 7265 7375 6c74   in json['result
-000358a0: 7327 5d5d 0a20 2020 2020 2020 2020 2020  s']].           
-000358b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000358c0: 2e76 6572 626f 7365 3a0a 2020 2020 2020  .verbose:.      
-000358d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000358e0: 2020 7072 696e 7428 227b 307d 2072 6563    print("{0} rec
-000358f0: 6f72 6473 206f 6666 207b 317d 2074 6f74  ords off {1} tot
-00035900: 616c 2072 6574 7572 6e65 6420 2e2e 2e22  al returned ..."
-00035910: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-00035920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035930: 2020 2020 206f 6666 7365 742c 2074 6f74       offset, tot
-00035940: 616c 292c 2066 696c 653d 7379 732e 7374  al), file=sys.st
-00035950: 6465 7272 290a 2020 2020 2020 2020 2020  derr).          
-00035960: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-00035970: 202b 3d20 6c69 6d69 740a 2020 2020 2020   += limit.      
-00035980: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00035990: 206f 6666 7365 7420 3d3d 2031 3530 3030   offset == 15000
-000359a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000359b0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-000359c0: 203d 3d20 3134 3939 390a 2020 2020 2020   == 14999.      
-000359d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000359e0: 6966 206f 6666 7365 7420 3e20 3135 3030  if offset > 1500
-000359f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00035a00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00035a10: 6e0a 2020 2020 2020 2020 6578 6365 7074  n.        except
-00035a20: 2072 6571 7565 7374 732e 6578 6365 7074   requests.except
-00035a30: 696f 6e73 2e52 6571 7565 7374 4578 6365  ions.RequestExce
-00035a40: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00035a50: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00035a60: 504f 5354 2072 6571 7565 7374 2066 6169  POST request fai
-00035a70: 6c65 643a 207b 657d 2229 0a20 2020 2020  led: {e}").     
-00035a80: 2020 2020 2020 2069 6620 7265 7472 795f         if retry_
-00035a90: 636f 756e 7420 3c20 6d61 785f 7265 7472  count < max_retr
-00035aa0: 6965 7320 2d20 313a 0a20 2020 2020 2020  ies - 1:.       
-00035ab0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00035ac0: 2252 6574 7279 696e 6720 6166 7465 7220  "Retrying after 
-00035ad0: 7b72 6574 7279 5f64 656c 6179 7d20 7365  {retry_delay} se
-00035ae0: 636f 6e64 732e 2e2e 2229 0a20 2020 2020  conds...").     
-00035af0: 2020 2020 2020 2020 2020 2072 6574 7279             retry
-00035b00: 5f63 6f75 6e74 202b 3d20 310a 2020 2020  _count += 1.    
-00035b10: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-00035b20: 2e73 6c65 6570 2872 6574 7279 5f64 656c  .sleep(retry_del
-00035b30: 6179 290a 2020 2020 2020 2020 2020 2020  ay).            
-00035b40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00035b50: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00035b60: 2020 2020 2023 2072 6169 7365 2045 7863       # raise Exc
-00035b70: 6570 7469 6f6e 2866 2246 6169 6c65 6420  eption(f"Failed 
-00035b80: 746f 2063 6f6d 706c 6574 6520 504f 5354  to complete POST
-00035b90: 2072 6571 7565 7374 2061 6674 6572 207b   request after {
-00035ba0: 6d61 785f 7265 7472 6965 737d 2061 7474  max_retries} att
-00035bb0: 656d 7074 7322 290a 0a20 2020 2064 6566  empts")..    def
-00035bc0: 205f 7265 7375 6c74 5f73 6574 7328 7365   _result_sets(se
-00035bd0: 6c66 2c20 6865 6164 6572 3d46 616c 7365  lf, header=False
-00035be0: 293a 0a20 2020 2020 2020 2073 6574 7320  ):.        sets 
-00035bf0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
-00035c00: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-00035c10: 2020 2020 7365 7473 2e61 7070 656e 6428      sets.append(
-00035c20: 2827 7072 6f6a 6563 745f 6e75 6d27 2c20  ('project_num', 
-00035c30: 2773 7461 7274 272c 2027 656e 6427 2c20  'start', 'end', 
-00035c40: 2763 6f6e 7461 6374 5f70 695f 6e61 6d65  'contact_pi_name
-00035c50: 272c 2027 7072 6f6a 6563 745f 7469 746c  ', 'project_titl
-00035c60: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
-00035c70: 2020 2020 2020 2020 2020 2020 276f 7267              'org
-00035c80: 5f6e 616d 6527 2c20 2770 726f 6a65 6374  _name', 'project
-00035c90: 5f64 6574 6169 6c5f 7572 6c27 2c20 2770  _detail_url', 'p
-00035ca0: 695f 7072 6f66 696c 655f 6964 2729 290a  i_profile_id')).
-00035cb0: 2020 2020 2020 2020 6772 616e 7473 203d          grants =
-00035cc0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00035cd0: 6720 696e 2073 656c 662e 6772 616e 7473  g in self.grants
-00035ce0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00035cf0: 7072 696e 7428 6a73 6f6e 2e64 756d 7073  print(json.dumps
-00035d00: 2867 2c20 696e 6465 6e74 3d32 2929 0a20  (g, indent=2)). 
-00035d10: 2020 2020 2020 2020 2020 2023 2072 6574             # ret
-00035d20: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-00035d30: 636f 7265 5f70 726f 6a65 6374 5f6e 756d  core_project_num
-00035d40: 203d 2073 7472 2867 2e67 6574 2827 636f   = str(g.get('co
-00035d50: 7265 5f70 726f 6a65 6374 5f6e 756d 272c  re_project_num',
-00035d60: 2027 2729 292e 7374 7269 7028 290a 2020   '')).strip().  
-00035d70: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
-00035d80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00035d90: 2020 2063 6f72 655f 7072 6f6a 6563 745f     core_project_
-00035da0: 6e75 6d2c 0a20 2020 2020 2020 2020 2020  num,.           
-00035db0: 2020 2020 2073 7472 2867 2e67 6574 2827       str(g.get('
-00035dc0: 7072 6f6a 6563 745f 7374 6172 745f 6461  project_start_da
-00035dd0: 7465 272c 2027 2729 292e 7374 7269 7028  te', '')).strip(
-00035de0: 295b 3a31 305d 2c0a 2020 2020 2020 2020  )[:10],.        
-00035df0: 2020 2020 2020 2020 7374 7228 672e 6765          str(g.ge
-00035e00: 7428 2770 726f 6a65 6374 5f65 6e64 5f64  t('project_end_d
-00035e10: 6174 6527 2c20 2727 2929 2e73 7472 6970  ate', '')).strip
-00035e20: 2829 5b3a 3130 5d2c 0a20 2020 2020 2020  ()[:10],.       
-00035e30: 2020 2020 2020 2020 2073 7472 2867 2e67           str(g.g
-00035e40: 6574 2827 636f 6e74 6163 745f 7069 5f6e  et('contact_pi_n
-00035e50: 616d 6527 2c20 2727 2929 2e73 7472 6970  ame', '')).strip
-00035e60: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00035e70: 2020 2020 7374 7228 672e 6765 7428 2770      str(g.get('p
-00035e80: 726f 6a65 6374 5f74 6974 6c65 272c 2027  roject_title', '
-00035e90: 2729 292e 7374 7269 7028 2920 2023 205b  ')).strip()  # [
-00035ea0: 3a35 305d 0a20 2020 2020 2020 2020 2020  :50].           
-00035eb0: 2029 0a20 2020 2020 2020 2020 2020 206f   ).            o
-00035ec0: 7267 203d 2022 220a 2020 2020 2020 2020  rg = "".        
-00035ed0: 2020 2020 6966 2067 5b27 6f72 6761 6e69      if g['organi
-00035ee0: 7a61 7469 6f6e 275d 5b27 6f72 675f 6e61  zation']['org_na
-00035ef0: 6d65 275d 3a0a 2020 2020 2020 2020 2020  me']:.          
-00035f00: 2020 2020 2020 6f72 6720 3d20 675b 276f        org = g['o
-00035f10: 7267 616e 697a 6174 696f 6e27 5d5b 276f  rganization']['o
-00035f20: 7267 5f6e 616d 6527 5d0a 2020 2020 2020  rg_name'].      
-00035f30: 2020 2020 2020 6c69 6e65 202b 3d20 280a        line += (.
-00035f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035f50: 7374 7228 6f72 672e 656e 636f 6465 2827  str(org.encode('
-00035f60: 7574 662d 3827 292c 2027 7574 662d 3827  utf-8'), 'utf-8'
-00035f70: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00035f80: 2020 2067 2e67 6574 2827 7072 6f6a 6563     g.get('projec
-00035f90: 745f 6465 7461 696c 5f75 726c 272c 2027  t_detail_url', '
-00035fa0: 2729 0a20 2020 2020 2020 2020 2020 2029  ').            )
-00035fb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00035fc0: 2070 2069 6e20 675b 2770 7269 6e63 6970   p in g['princip
-00035fd0: 616c 5f69 6e76 6573 7469 6761 746f 7273  al_investigators
-00035fe0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00035ff0: 2020 2020 6966 2070 2e67 6574 2827 6973      if p.get('is
-00036000: 5f63 6f6e 7461 6374 5f70 6927 2c20 4661  _contact_pi', Fa
-00036010: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-00036020: 2020 2020 2020 2020 2020 6c69 6e65 202b            line +
-00036030: 3d20 2873 7472 2870 2e67 6574 2827 7072  = (str(p.get('pr
-00036040: 6f66 696c 655f 6964 272c 2027 2729 292c  ofile_id', '')),
-00036050: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00036060: 206e 6f74 2063 6f72 655f 7072 6f6a 6563   not core_projec
-00036070: 745f 6e75 6d20 696e 2067 7261 6e74 733a  t_num in grants:
-00036080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036090: 2067 7261 6e74 735b 636f 7265 5f70 726f   grants[core_pro
-000360a0: 6a65 6374 5f6e 756d 5d20 3d20 6c69 6e65  ject_num] = line
-000360b0: 0a20 2020 2020 2020 2066 6f72 2067 2069  .        for g i
-000360c0: 6e20 6772 616e 7473 2e76 616c 7565 7328  n grants.values(
-000360d0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-000360e0: 6574 732e 6170 7065 6e64 2867 290a 2020  ets.append(g).  
-000360f0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-00036100: 7428 6729 0a20 2020 2020 2020 2023 2070  t(g).        # p
-00036110: 7269 6e74 2822 7b30 7d20 746f 7461 6c20  rint("{0} total 
-00036120: 2320 6f66 2067 7261 6e74 732e 2e2e 222e  # of grants...".
-00036130: 666f 726d 6174 286c 656e 2867 7261 6e74  format(len(grant
-00036140: 7329 292c 6669 6c65 3d73 7973 2e73 7464  s)),file=sys.std
-00036150: 6572 7229 0a20 2020 2020 2020 2072 6574  err).        ret
-00036160: 7572 6e20 7365 7473 0a0a 0a64 6566 2070  urn sets...def p
-00036170: 7269 6e74 5f76 6572 7369 6f6e 2829 3a0a  rint_version():.
-00036180: 0a20 2020 2070 7269 6e74 2866 2766 726f  .    print(f'fro
-00036190: 7374 6572 2076 7b5f 5f76 6572 7369 6f6e  ster v{__version
-000361a0: 5f5f 7d5c 6e27 290a 2020 2020 7072 696e  __}\n').    prin
-000361b0: 7428 6627 546f 6f6c 7320 7665 7273 696f  t(f'Tools versio
-000361c0: 6e3a 2729 0a20 2020 2070 7269 6e74 2866  n:').    print(f
-000361d0: 2720 2020 2070 7974 686f 6e20 767b 706c  '    python v{pl
-000361e0: 6174 666f 726d 2e70 7974 686f 6e5f 7665  atform.python_ve
-000361f0: 7273 696f 6e28 297d 2729 0a20 2020 2070  rsion()}').    p
-00036200: 7269 6e74 2827 2020 2020 7077 616c 6b20  rint('    pwalk 
-00036210: 272c 2027 7627 2b73 7562 7072 6f63 6573  ', 'v'+subproces
-00036220: 732e 7275 6e28 5b6f 732e 7061 7468 2e6a  s.run([os.path.j
-00036230: 6f69 6e28 7379 732e 7072 6566 6978 2c20  oin(sys.prefix, 
-00036240: 2762 696e 272c 2027 7077 616c 6b27 292c  'bin', 'pwalk'),
-00036250: 2027 2d2d 7665 7273 696f 6e27 5d2c 0a20   '--version'],. 
-00036260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036280: 2020 2020 2020 2020 2020 7374 646f 7574            stdout
-00036290: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
-000362a0: 2c20 7374 6465 7272 3d73 7562 7072 6f63  , stderr=subproc
-000362b0: 6573 732e 5049 5045 2c20 7465 7874 3d54  ess.PIPE, text=T
-000362c0: 7275 6529 2e73 7464 6572 722e 7370 6c69  rue).stderr.spli
-000362d0: 7428 275c 6e27 295b 305d 2e73 706c 6974  t('\n')[0].split
-000362e0: 2829 5b32 5d29 0a20 2020 2070 7269 6e74  ()[2]).    print
-000362f0: 2827 2020 2027 2c20 7375 6270 726f 6365  ('   ', subproce
-00036300: 7373 2e72 756e 285b 6f73 2e70 6174 682e  ss.run([os.path.
-00036310: 6a6f 696e 2873 7973 2e70 7265 6669 782c  join(sys.prefix,
-00036320: 2027 6269 6e27 2c20 2772 636c 6f6e 6527   'bin', 'rclone'
-00036330: 292c 2027 2d2d 7665 7273 696f 6e27 5d2c  ), '--version'],
-00036340: 0a20 2020 2020 2020 2020 2073 7464 6f75  .          stdou
-00036350: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
-00036360: 452c 2073 7464 6572 723d 7375 6270 726f  E, stderr=subpro
-00036370: 6365 7373 2e50 4950 452c 2074 6578 743d  cess.PIPE, text=
-00036380: 5472 7565 292e 7374 646f 7574 2e73 706c  True).stdout.spl
-00036390: 6974 2827 5c6e 2729 5b30 5d29 0a0a 2020  it('\n')[0])..  
-000363a0: 2020 7072 696e 7428 7465 7874 7772 6170    print(textwrap
-000363b0: 2e64 6564 656e 7428 6627 2727 0a20 2020  .dedent(f'''.   
-000363c0: 2020 2020 2041 7574 686f 7273 3a0a 2020       Authors:.  
-000363d0: 2020 2020 2020 2020 2020 5772 6974 7465            Writte
-000363e0: 6e20 6279 2044 6972 6b20 5065 7465 7273  n by Dirk Peters
-000363f0: 656e 2061 6e64 2048 7063 204e 6f77 2043  en and Hpc Now C
-00036400: 6f6e 7375 6c74 696e 6720 534c 0a0a 2020  onsulting SL..  
-00036410: 2020 2020 2020 5265 706f 7369 746f 7279        Repository
-00036420: 3a0a 2020 2020 2020 2020 2020 2020 6874  :.            ht
-00036430: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00036440: 2f64 6972 6b70 6574 6572 7365 6e2f 6672  /dirkpetersen/fr
-00036450: 6f73 7465 720a 0a0a 2020 2020 2020 2020  oster...        
-00036460: 436f 7079 7269 6768 7420 2843 2920 3230  Copyright (C) 20
-00036470: 3234 204f 7265 676f 6e20 4865 616c 7468  24 Oregon Health
-00036480: 2026 2053 6369 656e 6365 2055 6e69 7665   & Science Unive
-00036490: 7273 6974 7920 284f 5348 5529 0a0a 2020  rsity (OSHU)..  
-000364a0: 2020 2020 2020 4c69 6365 6e73 6564 2075        Licensed u
-000364b0: 6e64 6572 2074 6865 2041 7061 6368 6520  nder the Apache 
-000364c0: 4c69 6365 6e73 652c 2056 6572 7369 6f6e  License, Version
-000364d0: 2032 2e30 2028 7468 6520 224c 6963 656e   2.0 (the "Licen
-000364e0: 7365 2229 3b0a 2020 2020 2020 2020 796f  se");.        yo
-000364f0: 7520 6d61 7920 6e6f 7420 7573 6520 7468  u may not use th
-00036500: 6973 2066 696c 6520 6578 6365 7074 2069  is file except i
-00036510: 6e20 636f 6d70 6c69 616e 6365 2077 6974  n compliance wit
-00036520: 6820 7468 6520 4c69 6365 6e73 652e 0a20  h the License.. 
-00036530: 2020 2020 2020 2059 6f75 206d 6179 206f         You may o
-00036540: 6274 6169 6e20 6120 636f 7079 206f 6620  btain a copy of 
-00036550: 7468 6520 4c69 6365 6e73 6520 6174 0a0a  the License at..
-00036560: 2020 2020 2020 2020 2020 2020 6874 7470              http
-00036570: 3a2f 2f77 7777 2e61 7061 6368 652e 6f72  ://www.apache.or
-00036580: 672f 6c69 6365 6e73 6573 2f4c 4943 454e  g/licenses/LICEN
-00036590: 5345 2d32 2e30 0a0a 2020 2020 2020 2020  SE-2.0..        
-000365a0: 556e 6c65 7373 2072 6571 7569 7265 6420  Unless required 
-000365b0: 6279 2061 7070 6c69 6361 626c 6520 6c61  by applicable la
-000365c0: 7720 6f72 2061 6772 6565 6420 746f 2069  w or agreed to i
-000365d0: 6e20 7772 6974 696e 672c 2073 6f66 7477  n writing, softw
-000365e0: 6172 650a 2020 2020 2020 2020 6469 7374  are.        dist
-000365f0: 7269 6275 7465 6420 756e 6465 7220 7468  ributed under th
-00036600: 6520 4c69 6365 6e73 6520 6973 2064 6973  e License is dis
-00036610: 7472 6962 7574 6564 206f 6e20 616e 2022  tributed on an "
-00036620: 4153 2049 5322 2042 4153 4953 2c0a 2020  AS IS" BASIS,.  
-00036630: 2020 2020 2020 5749 5448 4f55 5420 5741        WITHOUT WA
-00036640: 5252 414e 5449 4553 204f 5220 434f 4e44  RRANTIES OR COND
-00036650: 4954 494f 4e53 204f 4620 414e 5920 4b49  ITIONS OF ANY KI
-00036660: 4e44 2c20 6569 7468 6572 2065 7870 7265  ND, either expre
-00036670: 7373 206f 7220 696d 706c 6965 642e 0a20  ss or implied.. 
-00036680: 2020 2020 2020 2053 6565 2074 6865 204c         See the L
-00036690: 6963 656e 7365 2066 6f72 2074 6865 2073  icense for the s
-000366a0: 7065 6369 6669 6320 6c61 6e67 7561 6765  pecific language
-000366b0: 2067 6f76 6572 6e69 6e67 2070 6572 6d69   governing permi
-000366c0: 7373 696f 6e73 2061 6e64 0a20 2020 2020  ssions and.     
-000366d0: 2020 206c 696d 6974 6174 696f 6e73 2075     limitations u
-000366e0: 6e64 6572 2074 6865 204c 6963 656e 7365  nder the License
-000366f0: 2e0a 2020 2020 2020 2020 2727 2729 290a  ..        ''')).
-00036700: 0a0a 6465 6620 7375 6263 6d64 5f63 6f6e  ..def subcmd_con
-00036710: 6669 6728 6172 6773 2c20 6366 673a 2043  fig(args, cfg: C
-00036720: 6f6e 6669 674d 616e 6167 6572 2c20 6177  onfigManager, aw
-00036730: 733a 2041 5753 426f 746f 293a 0a20 2020  s: AWSBoto):.   
-00036740: 2027 2727 436f 6e66 6967 7572 6520 4672   '''Configure Fr
-00036750: 6f73 7465 7220 7365 7474 696e 6773 2e27  oster settings.'
-00036760: 2727 0a0a 2020 2020 6966 2061 7267 732e  ''..    if args.
-00036770: 7573 6572 3a0a 2020 2020 2020 2020 6366  user:.        cf
-00036780: 672e 7365 745f 7573 6572 2829 0a20 2020  g.set_user().   
-00036790: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-000367a0: 2069 6620 6172 6773 2e61 7773 3a0a 2020   if args.aws:.  
-000367b0: 2020 2020 2020 6366 672e 7365 745f 6177        cfg.set_aw
-000367c0: 7328 6177 7329 0a20 2020 2020 2020 2072  s(aws).        r
-000367d0: 6574 7572 6e0a 0a20 2020 2069 6620 6172  eturn..    if ar
-000367e0: 6773 2e73 6861 7265 643a 0a20 2020 2020  gs.shared:.     
-000367f0: 2020 2063 6667 2e73 6574 5f73 6861 7265     cfg.set_share
-00036800: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
-00036810: 726e 0a0a 2020 2020 6966 2061 7267 732e  rn..    if args.
-00036820: 6e69 683a 0a20 2020 2020 2020 2063 6667  nih:.        cfg
-00036830: 2e73 6574 5f6e 6968 2829 0a20 2020 2020  .set_nih().     
-00036840: 2020 2072 6574 7572 6e0a 0a20 2020 2069     return..    i
-00036850: 6620 6172 6773 2e73 333a 0a20 2020 2020  f args.s3:.     
-00036860: 2020 2063 6667 2e73 6574 5f73 3328 6177     cfg.set_s3(aw
-00036870: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00036880: 6e0a 0a20 2020 2069 6620 6172 6773 2e73  n..    if args.s
-00036890: 6c75 726d 3a0a 2020 2020 2020 2020 6366  lurm:.        cf
-000368a0: 672e 7365 745f 736c 7572 6d28 6172 6773  g.set_slurm(args
-000368b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000368c0: 0a0a 2020 2020 6966 2061 7267 732e 7072  ..    if args.pr
-000368d0: 696e 743a 0a20 2020 2020 2020 2063 6667  int:.        cfg
-000368e0: 2e70 7269 6e74 5f63 6f6e 6669 6728 290a  .print_config().
-000368f0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00036900: 2020 2020 6966 2061 7267 732e 6d6f 6e69      if args.moni
-00036910: 746f 723a 0a20 2020 2020 2020 2066 726f  tor:.        fro
-00036920: 7374 6572 5f62 696e 6172 7920 3d20 6f73  ster_binary = os
-00036930: 2e70 6174 682e 6a6f 696e 2863 6667 2e62  .path.join(cfg.b
-00036940: 696e 5f64 6972 2c20 2766 726f 7374 6572  in_dir, 'froster
-00036950: 2729 0a20 2020 2020 2020 2063 6667 2e61  ').        cfg.a
-00036960: 6464 5f73 7973 7465 6d64 5f63 726f 6e5f  dd_systemd_cron_
-00036970: 6a6f 6228 6627 7b66 726f 7374 6572 5f62  job(f'{froster_b
-00036980: 696e 6172 797d 2072 6573 746f 7265 202d  inary} restore -
-00036990: 2d6d 6f6e 6974 6f72 272c 2027 3330 2729  -monitor', '30')
-000369a0: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-000369b0: 0a20 2020 2070 7269 6e74 2866 275c 6e2a  .    print(f'\n*
-000369c0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-000369d0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2729 0a20  ************'). 
-000369e0: 2020 2070 7269 6e74 2866 272a 2a2a 2046     print(f'*** F
-000369f0: 524f 5354 4552 2043 4f4e 4649 4755 5241  ROSTER CONFIGURA
-00036a00: 5449 4f4e 202a 2a2a 2729 0a20 2020 2070  TION ***').    p
-00036a10: 7269 6e74 2866 272a 2a2a 2a2a 2a2a 2a2a  rint(f'*********
-00036a20: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036a30: 2a2a 2a2a 5c6e 2729 0a0a 2020 2020 2320  ****\n')..    # 
-00036a40: 4368 6563 6b20 6966 2074 6865 2063 6f6e  Check if the con
-00036a50: 6669 6775 7261 7469 6f6e 2066 696c 6520  figuration file 
-00036a60: 6578 6973 7473 2061 6e64 2061 736b 2066  exists and ask f
-00036a70: 6f72 206f 7665 7277 7269 7465 0a20 2020  or overwrite.   
-00036a80: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00036a90: 7473 2863 6667 2e63 6f6e 6669 675f 6669  ts(cfg.config_fi
-00036aa0: 6c65 293a 0a20 2020 2020 2020 2069 735f  le):.        is_
-00036ab0: 6f76 6572 7772 6974 6520 3d20 696e 7175  overwrite = inqu
-00036ac0: 6972 6572 2e63 6f6e 6669 726d 280a 2020  irer.confirm(.  
-00036ad0: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-00036ae0: 653d 6622 5741 524e 494e 473a 2059 6f75  e=f"WARNING: You
-00036af0: 2061 7265 2061 626f 7574 2074 6f20 6f76   are about to ov
-00036b00: 6572 7772 6974 6520 7b63 6667 2e63 6f6e  erwrite {cfg.con
-00036b10: 6669 675f 6669 6c65 7d2e 2044 6f20 796f  fig_file}. Do yo
-00036b20: 7520 7761 6e74 2074 6f20 636f 6e74 696e  u want to contin
-00036b30: 7565 3f22 2c20 6465 6661 756c 743d 4661  ue?", default=Fa
-00036b40: 6c73 6529 0a0a 2020 2020 2020 2020 6966  lse)..        if
-00036b50: 2069 735f 6f76 6572 7772 6974 653a 0a20   is_overwrite:. 
-00036b60: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
-00036b70: 6d6f 7665 2863 6667 2e63 6f6e 6669 675f  move(cfg.config_
-00036b80: 6669 6c65 290a 2020 2020 2020 2020 656c  file).        el
-00036b90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00036ba0: 7265 7475 726e 0a0a 2020 2020 6366 672e  return..    cfg.
-00036bb0: 7365 745f 7573 6572 2829 0a20 2020 2063  set_user().    c
-00036bc0: 6667 2e73 6574 5f61 7773 2861 7773 290a  fg.set_aws(aws).
-00036bd0: 2020 2020 6366 672e 7365 745f 7368 6172      cfg.set_shar
-00036be0: 6564 2829 0a0a 2020 2020 2320 4966 2073  ed()..    # If s
-00036bf0: 6861 7265 6420 636f 6e66 6967 7572 6174  hared configurat
-00036c00: 696f 6e20 616e 6420 7368 6172 6564 5f63  ion and shared_c
-00036c10: 6f6e 6669 672e 696e 6920 6669 6c65 2065  onfig.ini file e
-00036c20: 7869 7374 732c 2074 6865 6e20 7573 6520  xists, then use 
-00036c30: 6974 0a20 2020 2069 6620 6366 672e 6973  it.    if cfg.is
-00036c40: 5f73 6861 7265 6420 616e 6420 6f73 2e70  _shared and os.p
-00036c50: 6174 682e 6578 6973 7473 2863 6667 2e73  ath.exists(cfg.s
-00036c60: 6861 7265 645f 636f 6e66 6967 5f66 696c  hared_config_fil
-00036c70: 6529 3a0a 2020 2020 2020 2020 7072 696e  e):.        prin
-00036c80: 7428 6627 5c6e 2a2a 2a2a 2a2a 2a2a 2a2a  t(f'\n**********
-00036c90: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036ca0: 2a2a 2a2a 2a2a 2a2a 2729 0a20 2020 2020  ********').     
-00036cb0: 2020 2070 7269 6e74 2866 272a 2a2a 2046     print(f'*** F
-00036cc0: 524f 5354 4552 2043 4f4e 4649 4755 5241  ROSTER CONFIGURA
-00036cd0: 5449 4f4e 2044 4f4e 4520 2a2a 2a27 290a  TION DONE ***').
-00036ce0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-00036cf0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036d00: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036d10: 2a2a 5c6e 2729 0a0a 2020 2020 2020 2020  **\n')..        
-00036d20: 7072 696e 7428 7465 7874 7772 6170 2e64  print(textwrap.d
-00036d30: 6564 656e 7428 6627 2727 0a20 2020 2020  edent(f'''.     
-00036d40: 2020 2020 2020 204c 6f63 616c 2063 6f6e         Local con
-00036d50: 6669 6775 7261 7469 6f6e 3a20 7b63 6667  figuration: {cfg
-00036d60: 2e63 6f6e 6669 675f 6669 6c65 7d0a 2020  .config_file}.  
-00036d70: 2020 2020 2020 2020 2020 5368 6172 6564            Shared
-00036d80: 2063 6f6e 6669 6775 7261 7469 6f6e 3a20   configuration: 
-00036d90: 7b63 6667 2e73 6861 7265 645f 636f 6e66  {cfg.shared_conf
-00036da0: 6967 5f66 696c 657d 0a0a 2020 2020 2020  ig_file}..      
-00036db0: 2020 2020 2020 596f 7520 6361 6e20 6f76        You can ov
-00036dc0: 6572 7772 6974 6520 7370 6563 6966 6963  erwrite specific
-00036dd0: 2063 6f6e 6669 6775 7261 7469 6f6e 2073   configuration s
-00036de0: 6563 7469 6f6e 732e 2043 6865 636b 206f  ections. Check o
-00036df0: 7074 696f 6e73 2075 7369 6e67 2074 6865  ptions using the
-00036e00: 2063 6f6d 6d61 6e64 3a0a 2020 2020 2020   command:.      
-00036e10: 2020 2020 2020 2020 2020 6672 6f73 7465            froste
-00036e20: 7220 636f 6e66 6967 202d 2d68 656c 705c  r config --help\
-00036e30: 6e0a 2020 2020 2020 2020 2020 2020 2727  n.            ''
-00036e40: 2729 290a 2020 2020 2020 2020 7379 732e  ')).        sys.
-00036e50: 6578 6974 2830 290a 2020 2020 656c 7365  exit(0).    else
-00036e60: 3a0a 0a20 2020 2020 2020 2063 6667 2e73  :..        cfg.s
-00036e70: 6574 5f6e 6968 2829 0a20 2020 2020 2020  et_nih().       
-00036e80: 2063 6667 2e73 6574 5f73 3328 6177 7329   cfg.set_s3(aws)
-00036e90: 0a20 2020 2020 2020 2063 6667 2e73 6574  .        cfg.set
-00036ea0: 5f73 6c75 726d 2861 7267 7329 0a0a 2020  _slurm(args)..  
-00036eb0: 2020 7072 696e 7428 6627 5c6e 2a2a 2a2a    print(f'\n****
-00036ec0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036ed0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2729  **************')
-00036ee0: 0a20 2020 2070 7269 6e74 2866 272a 2a2a  .    print(f'***
-00036ef0: 2046 524f 5354 4552 2043 4f4e 4649 4755   FROSTER CONFIGU
-00036f00: 5241 5449 4f4e 2044 4f4e 4520 2a2a 2a27  RATION DONE ***'
-00036f10: 290a 2020 2020 7072 696e 7428 6627 2a2a  ).    print(f'**
-00036f20: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036f30: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-00036f40: 5c6e 2729 0a0a 2020 2020 7072 696e 7428  \n')..    print(
-00036f50: 6627 5c6e 596f 7520 6361 6e20 7072 696e  f'\nYou can prin
-00036f60: 7420 7468 6520 6375 7272 656e 7420 636f  t the current co
-00036f70: 6e66 6967 7572 6174 696f 6e20 7573 696e  nfiguration usin
-00036f80: 6720 7468 6520 636f 6d6d 616e 643a 2729  g the command:')
-00036f90: 0a20 2020 2070 7269 6e74 2866 2720 2020  .    print(f'   
-00036fa0: 2066 726f 7374 6572 2063 6f6e 6669 6720   froster config 
-00036fb0: 2d2d 7072 696e 745c 6e27 290a 0a0a 6465  --print\n')...de
-00036fc0: 6620 7375 6263 6d64 5f69 6e64 6578 2861  f subcmd_index(a
-00036fd0: 7267 733a 2061 7267 7061 7273 652e 4e61  rgs: argparse.Na
-00036fe0: 6d65 7370 6163 652c 2063 6667 3a20 436f  mespace, cfg: Co
-00036ff0: 6e66 6967 4d61 6e61 6765 722c 2061 7263  nfigManager, arc
-00037000: 683a 2041 7263 6869 7665 7229 3a0a 2020  h: Archiver):.  
-00037010: 2020 2727 2749 6e64 6578 2066 6f6c 6465    '''Index folde
-00037020: 7273 2066 6f72 2046 726f 7374 6572 2e27  rs for Froster.'
-00037030: 2727 0a0a 2020 2020 2320 4368 6563 6b20  ''..    # Check 
-00037040: 6966 2075 7365 7220 7072 6f76 6964 6564  if user provided
-00037050: 2061 7420 6c65 6173 7420 6f6e 6520 6172   at least one ar
-00037060: 6775 6d65 6e74 0a20 2020 2069 6620 6e6f  gument.    if no
-00037070: 7420 6172 6773 2e66 6f6c 6465 7273 3a0a  t args.folders:.
-00037080: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00037090: 6e45 7272 6f72 3a20 466f 6c64 6572 206e  nError: Folder n
-000370a0: 6f74 2070 726f 7669 6465 642e 2043 6865  ot provided. Che
-000370b0: 636b 2074 6865 2069 6e64 6578 2063 6f6d  ck the index com
-000370c0: 6d61 6e64 2075 7361 6765 2077 6974 6820  mand usage with 
-000370d0: 2266 726f 7374 6572 2069 6e64 6578 202d  "froster index -
-000370e0: 2d68 656c 7022 5c6e 2729 0a20 2020 2020  -help"\n').     
-000370f0: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
-00037100: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
-00037110: 6865 2070 726f 7669 6465 6420 7077 616c  he provided pwal
-00037120: 6b20 636f 7079 2066 6f6c 6465 7220 6578  k copy folder ex
-00037130: 6973 7473 0a20 2020 2069 6620 6172 6773  ists.    if args
-00037140: 2e70 7761 6c6b 636f 7079 2061 6e64 206e  .pwalkcopy and n
-00037150: 6f74 206f 732e 7061 7468 2e69 7364 6972  ot os.path.isdir
-00037160: 2861 7267 732e 7077 616c 6b63 6f70 7929  (args.pwalkcopy)
-00037170: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00037180: 6627 5c6e 4572 726f 723a 2046 6f6c 6465  f'\nError: Folde
-00037190: 7220 227b 6172 6773 2e70 7761 6c6b 636f  r "{args.pwalkco
-000371a0: 7079 7d22 2064 6f65 7320 6e6f 7420 6578  py}" does not ex
-000371b0: 6973 742e 5c6e 2729 0a20 2020 2020 2020  ist.\n').       
-000371c0: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
-000371d0: 2020 2320 4368 6563 6b20 6966 2061 6c6c    # Check if all
-000371e0: 2074 6865 2070 726f 7669 6465 6420 666f   the provided fo
-000371f0: 6c64 6572 7320 6578 6973 740a 2020 2020  lders exist.    
-00037200: 666f 7220 666f 6c64 6572 2069 6e20 6172  for folder in ar
-00037210: 6773 2e66 6f6c 6465 7273 3a0a 2020 2020  gs.folders:.    
-00037220: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00037230: 7468 2e69 7364 6972 2866 6f6c 6465 7229  th.isdir(folder)
-00037240: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00037250: 696e 7428 6627 5c6e 4572 726f 723a 2054  int(f'\nError: T
-00037260: 6865 2066 6f6c 6465 7220 7b66 6f6c 6465  he folder {folde
-00037270: 727d 2064 6f65 7320 6e6f 7420 6578 6973  r} does not exis
-00037280: 742e 5c6e 2729 0a20 2020 2020 2020 2020  t.\n').         
-00037290: 2020 2073 7973 2e65 7869 7428 3129 0a0a     sys.exit(1)..
-000372a0: 2020 2020 2320 436c 6561 6e20 7468 6520      # Clean the 
-000372b0: 7072 6f76 6964 6564 2070 6174 6873 0a20  provided paths. 
-000372c0: 2020 2066 6f6c 6465 7273 203d 2063 6c65     folders = cle
-000372d0: 616e 5f70 6174 6873 2861 7267 732e 666f  an_paths(args.fo
-000372e0: 6c64 6572 7329 0a0a 2020 2020 2320 496e  lders)..    # In
-000372f0: 6465 7820 7468 6520 6769 7665 6e20 666f  dex the given fo
-00037300: 6c64 6572 730a 2020 2020 6172 6368 2e69  lders.    arch.i
-00037310: 6e64 6578 2866 6f6c 6465 7273 290a 0a0a  ndex(folders)...
-00037320: 6465 6620 7375 6263 6d64 5f61 7263 6869  def subcmd_archi
-00037330: 7665 2861 7267 733a 2061 7267 7061 7273  ve(args: argpars
-00037340: 652e 4e61 6d65 7370 6163 652c 2061 7263  e.Namespace, arc
-00037350: 683a 2041 7263 6869 7665 7229 3a0a 2020  h: Archiver):.  
-00037360: 2020 2727 2743 6865 636b 2063 6f6d 6d61    '''Check comma
-00037370: 6e64 2066 6f72 2061 7263 6869 7669 6e67  nd for archiving
-00037380: 2066 6f6c 6465 7273 2066 6f72 2046 726f   folders for Fro
-00037390: 7374 6572 2e27 2727 0a0a 2020 2020 6966  ster.'''..    if
-000373a0: 2061 7267 732e 6f6c 6465 7220 3e20 3020   args.older > 0 
-000373b0: 616e 6420 6172 6773 2e6e 6577 6572 203e  and args.newer >
-000373c0: 2030 3a0a 2020 2020 2020 2020 7072 696e   0:.        prin
-000373d0: 7428 275c 6e45 7272 6f72 3a20 4361 6e6e  t('\nError: Cann
-000373e0: 6f74 2075 7365 2062 6f74 6820 2d2d 6f6c  ot use both --ol
-000373f0: 6465 7220 616e 6420 2d2d 6e65 7765 7220  der and --newer 
-00037400: 666c 6167 7320 746f 6765 7468 6572 2e5c  flags together.\
-00037410: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
-00037420: 6572 7229 0a20 2020 2020 2020 2073 7973  err).        sys
-00037430: 2e65 7869 7428 3129 0a0a 2020 2020 2320  .exit(1)..    # 
-00037440: 4368 6563 6b20 6966 2074 6865 2075 7365  Check if the use
-00037450: 7220 7072 6f76 6964 6564 2074 6865 2070  r provided the p
-00037460: 6572 6d69 7373 696f 6e73 2061 7267 756d  ermissions argum
-00037470: 656e 740a 2020 2020 6966 2061 7267 732e  ent.    if args.
-00037480: 7065 726d 6973 7369 6f6e 733a 0a20 2020  permissions:.   
-00037490: 2020 2020 2069 6620 6e6f 7420 6172 6773       if not args
-000374a0: 2e66 6f6c 6465 7273 3a0a 2020 2020 2020  .folders:.      
-000374b0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-000374c0: 2020 2020 2020 2020 2020 2020 2027 5c6e               '\n
-000374d0: 4572 726f 723a 2046 6f6c 6465 7220 6e6f  Error: Folder no
-000374e0: 7420 7072 6f76 6964 6564 2e20 4368 6563  t provided. Chec
-000374f0: 6b20 7468 6520 6172 6368 6976 6520 636f  k the archive co
-00037500: 6d6d 616e 6420 7573 6167 6520 7769 7468  mmand usage with
-00037510: 2022 6672 6f73 7465 7220 6172 6368 6976   "froster archiv
-00037520: 6520 2d2d 6865 6c70 225c 6e27 2c20 6669  e --help"\n', fi
-00037530: 6c65 3d73 7973 2e73 7464 6572 7229 0a20  le=sys.stderr). 
-00037540: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00037550: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
-00037560: 2320 5072 696e 7420 7468 6520 7065 726d  # Print the perm
-00037570: 6973 7369 6f6e 7320 6f66 2074 6865 2070  issions of the p
-00037580: 726f 7669 6465 6420 666f 6c64 6572 730a  rovided folders.
-00037590: 2020 2020 2020 2020 6172 6368 2e70 7269          arch.pri
-000375a0: 6e74 5f70 6174 6873 5f72 775f 696e 666f  nt_paths_rw_info
-000375b0: 2861 7267 732e 666f 6c64 6572 290a 2020  (args.folder).  
-000375c0: 2020 2020 2020 7379 732e 6578 6974 2830        sys.exit(0
-000375d0: 290a 0a20 2020 2023 2043 6865 636b 2069  )..    # Check i
-000375e0: 6620 7468 6520 7573 6572 2070 726f 7669  f the user provi
-000375f0: 6465 6420 7468 6520 7265 7365 7420 6172  ded the reset ar
-00037600: 6775 6d65 6e74 0a20 2020 2069 6620 6172  gument.    if ar
-00037610: 6773 2e72 6573 6574 3a0a 2020 2020 2020  gs.reset:.      
-00037620: 2020 666f 7220 666f 6c64 6572 2069 6e20    for folder in 
-00037630: 6172 6773 2e66 6f6c 6465 7273 3a0a 2020  args.folders:.  
-00037640: 2020 2020 2020 2020 2020 6172 6368 2e72            arch.r
-00037650: 6573 6574 5f66 6f6c 6465 7228 666f 6c64  eset_folder(fold
-00037660: 6572 2c20 6172 6773 2e72 6563 7572 7369  er, args.recursi
-00037670: 7665 290a 2020 2020 2020 2020 7379 732e  ve).        sys.
-00037680: 6578 6974 2830 290a 0a20 2020 2023 2043  exit(0)..    # C
-00037690: 6865 636b 2069 6620 7468 6520 7573 6572  heck if the user
-000376a0: 2070 726f 7669 6465 6420 7468 6520 686f   provided the ho
-000376b0: 7473 706f 7473 2061 7267 756d 656e 740a  tspots argument.
-000376c0: 2020 2020 6966 2061 7267 732e 686f 7473      if args.hots
-000376d0: 706f 7473 3a0a 2020 2020 2020 2020 6966  pots:.        if
-000376e0: 2061 7267 732e 666f 6c64 6572 733a 0a20   args.folders:. 
-000376f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00037700: 2827 5c6e 4572 726f 723a 2049 6e63 6f72  ('\nError: Incor
-00037710: 7265 6374 2022 6672 6f73 7465 7220 6172  rect "froster ar
-00037720: 6368 6976 6522 2075 7361 6765 2e20 4368  chive" usage. Ch
-00037730: 6f6f 7365 2062 6574 7765 656e 3a27 290a  oose between:').
-00037740: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00037750: 7428 2720 2020 2055 7369 6e67 202d 2d68  t('    Using --h
-00037760: 6f74 7370 6f74 7320 666c 6167 2074 6f20  otspots flag to 
-00037770: 7365 6c65 6374 2068 6f74 7370 6f73 7473  select hotsposts
-00037780: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-00037790: 7269 6e74 2827 2020 2020 5072 6f76 6964  rint('    Provid
-000377a0: 6520 666f 6c64 6572 2873 2920 746f 2061  e folder(s) to a
-000377b0: 7263 6869 7665 5c6e 2729 0a20 2020 2020  rchive\n').     
-000377c0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000377d0: 3129 0a0a 2020 2020 2020 2020 656c 7365  1)..        else
-000377e0: 3a0a 2020 2020 2020 2020 2020 2020 6172  :.            ar
-000377f0: 6368 2e61 7263 6869 7665 5f73 656c 6563  ch.archive_selec
-00037800: 745f 686f 7473 706f 7473 2829 0a20 2020  t_hotspots().   
-00037810: 2065 6c73 653a 0a20 2020 2020 2020 2069   else:.        i
-00037820: 6620 6e6f 7420 6172 6773 2e66 6f6c 6465  f not args.folde
-00037830: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00037840: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00037850: 2020 2020 2020 2027 5c6e 4572 726f 723a         '\nError:
-00037860: 2046 6f6c 6465 7220 6e6f 7420 7072 6f76   Folder not prov
-00037870: 6964 6564 2e20 4368 6563 6b20 7468 6520  ided. Check the 
-00037880: 6172 6368 6976 6520 636f 6d6d 616e 6420  archive command 
-00037890: 7573 6167 6520 7769 7468 2022 6672 6f73  usage with "fros
-000378a0: 7465 7220 6172 6368 6976 6520 2d2d 6865  ter archive --he
-000378b0: 6c70 225c 6e27 290a 2020 2020 2020 2020  lp"\n').        
-000378c0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-000378d0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000378e0: 2020 2020 2020 2020 2020 2023 2041 7263             # Arc
-000378f0: 6869 7665 2074 6865 2067 6976 656e 2066  hive the given f
-00037900: 6f6c 6465 7273 0a20 2020 2020 2020 2020  olders.         
-00037910: 2020 2061 7263 682e 6172 6368 6976 6528     arch.archive(
-00037920: 6172 6773 2e66 6f6c 6465 7273 290a 0a0a  args.folders)...
-00037930: 6465 6620 7375 6263 6d64 5f72 6573 746f  def subcmd_resto
-00037940: 7265 2861 7267 733a 2061 7267 7061 7273  re(args: argpars
-00037950: 652e 4e61 6d65 7370 6163 652c 2063 6667  e.Namespace, cfg
-00037960: 3a20 436f 6e66 6967 4d61 6e61 6765 722c  : ConfigManager,
-00037970: 2061 7263 683a 2041 7263 6869 7665 722c   arch: Archiver,
-00037980: 2061 7773 3a20 4157 5342 6f74 6f29 3a0a   aws: AWSBoto):.
-00037990: 2020 2020 2320 544f 444f 3a20 6675 6e63      # TODO: func
-000379a0: 7469 6f6e 2070 656e 6469 6e74 2074 6f20  tion pendint to 
-000379b0: 7265 7669 6577 0a20 2020 2070 7269 6e74  review.    print
-000379c0: 2866 2754 4f44 4f3a 2066 756e 6374 696f  (f'TODO: functio
-000379d0: 6e20 7b69 6e73 7065 6374 2e73 7461 636b  n {inspect.stack
-000379e0: 2829 5b30 5d5b 335d 7d20 7065 6e64 696e  ()[0][3]} pendin
-000379f0: 6720 746f 2072 6576 6965 7727 290a 2020  g to review').  
-00037a00: 2020 6578 6974 2831 290a 0a20 2020 2070    exit(1)..    p
-00037a10: 7269 6e74 6462 6728 2272 6573 746f 7265  rintdbg("restore
-00037a20: 3a22 2c20 6172 6773 2e63 6f72 6573 2c20  :", args.cores, 
-00037a30: 6172 6773 2e61 7773 5f70 726f 6669 6c65  args.aws_profile
-00037a40: 2c20 6172 6773 2e6e 6f73 6c75 726d 2c0a  , args.noslurm,.
-00037a50: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-00037a60: 732e 6461 7973 2c20 6172 6773 2e72 6574  s.days, args.ret
-00037a70: 7269 6576 656f 7074 2c20 6172 6773 2e6e  rieveopt, args.n
-00037a80: 6f64 6f77 6e6c 6f61 642c 2061 7267 732e  odownload, args.
-00037a90: 666f 6c64 6572 7329 0a20 2020 2066 6c64  folders).    fld
-00037aa0: 203d 2027 2220 2227 2e6a 6f69 6e28 6172   = '" "'.join(ar
-00037ab0: 6773 2e66 6f6c 6465 7273 290a 2020 2020  gs.folders).    
-00037ac0: 7072 696e 7464 6267 2866 2764 6566 6175  printdbg(f'defau
-00037ad0: 6c74 2063 6d64 6c69 6e65 3a20 6672 6f73  lt cmdline: fros
-00037ae0: 7465 7220 7265 7374 6f72 6520 227b 666c  ter restore "{fl
-00037af0: 647d 2227 290a 0a20 2020 2023 202a 2a2a  d}"')..    # ***
-00037b00: 2a2a 2a2a 2a2a 0a20 2020 2069 6620 6172  ******.    if ar
-00037b10: 6773 2e6d 6f6e 6974 6f72 3a0a 2020 2020  gs.monitor:.    
-00037b20: 2020 2020 2320 6177 7320 696e 6163 7469      # aws inacti
-00037b30: 7669 7479 2061 6e64 2063 6f73 7420 6d6f  vity and cost mo
-00037b40: 6e69 746f 7269 6e67 0a20 2020 2020 2020  nitoring.       
-00037b50: 2061 7773 2e6d 6f6e 6974 6f72 5f65 6332   aws.monitor_ec2
-00037b60: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00037b70: 6e20 5472 7565 0a0a 2020 2020 6966 206e  n True..    if n
-00037b80: 6f74 2061 7267 732e 666f 6c64 6572 733a  ot args.folders:
-00037b90: 0a20 2020 2020 2020 2066 696c 6573 203d  .        files =
-00037ba0: 2061 7263 682e 6172 6368 6976 655f 6a73   arch.archive_js
-00037bb0: 6f6e 5f67 6574 5f63 7376 280a 2020 2020  on_get_csv(.    
-00037bc0: 2020 2020 2020 2020 5b27 6c6f 6361 6c5f          ['local_
-00037bd0: 666f 6c64 6572 272c 2027 7333 5f73 746f  folder', 's3_sto
-00037be0: 7261 6765 5f63 6c61 7373 272c 2027 7072  rage_class', 'pr
-00037bf0: 6f66 696c 6527 2c20 2761 7263 6869 7665  ofile', 'archive
-00037c00: 5f6d 6f64 6527 5d29 0a20 2020 2020 2020  _mode']).       
-00037c10: 2069 6620 6669 6c65 7320 3d3d 204e 6f6e   if files == Non
-00037c20: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00037c30: 7269 6e74 2822 4e6f 2061 7263 6869 7665  rint("No archive
-00037c40: 7320 6176 6169 6c61 626c 652e 2229 0a20  s available."). 
-00037c50: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00037c60: 7869 7428 3029 0a20 2020 2020 2020 2061  xit(0).        a
-00037c70: 7070 203d 2054 6162 6c65 4172 6368 6976  pp = TableArchiv
-00037c80: 6528 6669 6c65 7329 0a20 2020 2020 2020  e(files).       
-00037c90: 2072 6574 6c69 6e65 203d 2061 7070 2e72   retline = app.r
-00037ca0: 756e 2829 0a20 2020 2020 2020 2069 6620  un().        if 
-00037cb0: 6e6f 7420 7265 746c 696e 653a 0a20 2020  not retline:.   
-00037cc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00037cd0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00037ce0: 206c 656e 2872 6574 6c69 6e65 2920 3c20   len(retline) < 
-00037cf0: 323a 0a20 2020 2020 2020 2020 2020 2070  2:.            p
-00037d00: 7269 6e74 2827 4572 726f 723a 2066 726f  rint('Error: fro
-00037d10: 7374 6572 2d61 7263 6869 7665 7320 7461  ster-archives ta
-00037d20: 626c 6520 6469 6420 6e6f 7420 7265 7475  ble did not retu
-00037d30: 726e 2072 6573 756c 7427 2c20 6669 6c65  rn result', file
-00037d40: 3d73 7973 2e73 7464 6572 7229 0a20 2020  =sys.stderr).   
-00037d50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00037d60: 4661 6c73 650a 2020 2020 2020 2020 7072  False.        pr
-00037d70: 696e 7464 6267 2822 7375 6263 6d64 5f72  intdbg("subcmd_r
-00037d80: 6573 746f 7265 2064 6961 6c6f 6720 7265  estore dialog re
-00037d90: 7475 726e 733a 222c 2072 6574 6c69 6e65  turns:", retline
-00037da0: 290a 2020 2020 2020 2020 6172 6773 2e66  ).        args.f
-00037db0: 6f6c 6465 7273 2e61 7070 656e 6428 7265  olders.append(re
-00037dc0: 746c 696e 655b 305d 290a 2020 2020 2020  tline[0]).      
-00037dd0: 2020 6966 2072 6574 6c69 6e65 5b32 5d3a    if retline[2]:
-00037de0: 0a20 2020 2020 2020 2020 2020 2063 6667  .            cfg
-00037df0: 2e61 7773 5f70 726f 6669 6c65 203d 2072  .aws_profile = r
-00037e00: 6574 6c69 6e65 5b32 5d0a 2020 2020 2020  etline[2].      
-00037e10: 2020 2020 2020 6172 6773 2e61 7773 5f70        args.aws_p
-00037e20: 726f 6669 6c65 203d 2063 6667 2e61 7773  rofile = cfg.aws
-00037e30: 5f70 726f 6669 6c65 0a20 2020 2020 2020  _profile.       
-00037e40: 2020 2020 2063 6667 2e73 6574 5f65 6e76       cfg.set_env
-00037e50: 5f76 6172 7328 6366 672e 6177 735f 7072  _vars(cfg.aws_pr
-00037e60: 6f66 696c 6529 0a20 2020 2020 2020 2020  ofile).         
-00037e70: 2020 2070 7269 6e74 6462 6728 2241 5753     printdbg("AWS
-00037e80: 2070 726f 6669 6c65 3a22 2c20 6366 672e   profile:", cfg.
-00037e90: 6177 735f 7072 6f66 696c 6529 0a20 2020  aws_profile).   
-00037ea0: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
-00037eb0: 6173 730a 2020 2020 2020 2020 2320 7765  ass.        # we
-00037ec0: 2061 6374 7561 6c6c 7920 7761 6e74 2074   actually want t
-00037ed0: 6f20 7375 7070 6f72 7420 7379 6d6c 696e  o support symlin
-00037ee0: 6b73 0a20 2020 2020 2020 2023 2061 7267  ks.        # arg
-00037ef0: 732e 666f 6c64 6572 7320 3d20 636c 6561  s.folders = clea
-00037f00: 6e5f 7061 7468 7328 6172 6773 2e66 6f6c  n_paths(args.fol
-00037f10: 6465 7273 290a 0a20 2020 2069 6620 6172  ders)..    if ar
-00037f20: 6773 2e61 7773 5f70 726f 6669 6c65 2061  gs.aws_profile a
-00037f30: 6e64 2061 7267 732e 6177 735f 7072 6f66  nd args.aws_prof
-00037f40: 696c 6520 6e6f 7420 696e 2063 6667 2e67  ile not in cfg.g
-00037f50: 6574 5f61 7773 5f70 726f 6669 6c65 7328  et_aws_profiles(
-00037f60: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-00037f70: 2866 2750 726f 6669 6c65 2022 7b61 7267  (f'Profile "{arg
-00037f80: 732e 6177 735f 7072 6f66 696c 657d 2220  s.aws_profile}" 
-00037f90: 6e6f 7420 666f 756e 642e 2729 0a20 2020  not found.').   
-00037fa0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00037fb0: 650a 2020 2020 6966 206e 6f74 2061 7773  e.    if not aws
-00037fc0: 2e63 6865 636b 5f62 7563 6b65 745f 6163  .check_bucket_ac
-00037fd0: 6365 7373 5f66 6f6c 6465 7273 2861 7267  cess_folders(arg
-00037fe0: 732e 666f 6c64 6572 7329 3a0a 2020 2020  s.folders):.    
-00037ff0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00038000: 0a0a 2020 2020 6966 2061 7267 732e 6177  ..    if args.aw
-00038010: 733a 0a20 2020 2020 2020 2023 2072 756e  s:.        # run
-00038020: 2065 6332 5f64 6570 6c6f 7928 7365 6c66   ec2_deploy(self
-00038030: 2c20 6275 636b 6574 3d27 272c 2070 7265  , bucket='', pre
-00038040: 6669 783d 2727 2c20 7265 6375 7273 6976  fix='', recursiv
-00038050: 653d 4661 6c73 652c 2070 726f 6669 6c65  e=False, profile
-00038060: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00038070: 7265 7420 3d20 6177 732e 6563 325f 6465  ret = aws.ec2_de
-00038080: 706c 6f79 2861 7267 732e 666f 6c64 6572  ploy(args.folder
-00038090: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-000380a0: 6e20 5472 7565 0a0a 2020 2020 6966 206e  n True..    if n
-000380b0: 6f74 2073 6875 7469 6c2e 7768 6963 6828  ot shutil.which(
-000380c0: 2773 6261 7463 6827 2920 6f72 2061 7267  'sbatch') or arg
-000380d0: 732e 6e6f 736c 7572 6d20 6f72 206f 732e  s.noslurm or os.
-000380e0: 6765 7465 6e76 2827 534c 5552 4d5f 4a4f  getenv('SLURM_JO
-000380f0: 425f 4944 2729 3a0a 2020 2020 2020 2020  B_ID'):.        
-00038100: 2320 6569 7468 6572 206e 6f20 736c 7572  # either no slur
-00038110: 6d20 6f72 2061 6c72 6561 6479 2072 756e  m or already run
-00038120: 6e69 6e67 2069 6e73 6964 6520 6120 736c  ning inside a sl
-00038130: 7572 6d20 6a6f 620a 2020 2020 2020 2020  urm job.        
-00038140: 666f 7220 666c 6420 696e 2061 7267 732e  for fld in args.
-00038150: 666f 6c64 6572 733a 0a20 2020 2020 2020  folders:.       
-00038160: 2020 2020 2066 6c64 203d 2066 6c64 2e72       fld = fld.r
-00038170: 7374 7269 7028 6f73 2e70 6174 682e 7365  strip(os.path.se
-00038180: 7029 0a20 2020 2020 2020 2020 2020 2070  p).            p
-00038190: 7269 6e74 2866 2752 6573 746f 7269 6e67  rint(f'Restoring
-000381a0: 2066 6f6c 6465 7220 7b66 6c64 7d2c 2070   folder {fld}, p
-000381b0: 6c65 6173 6520 7761 6974 202e 2e2e 272c  lease wait ...',
-000381c0: 2066 6c75 7368 3d54 7275 6529 0a20 2020   flush=True).   
-000381d0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-000381e0: 2069 6620 7472 6967 6765 7265 6420 6120   if triggered a 
-000381f0: 7265 7374 6f72 6520 6672 6f6d 2067 6c61  restore from gla
-00038200: 6369 6572 2061 6e64 206f 7468 6572 2063  cier and other c
-00038210: 6f6e 6469 7469 6f6e 730a 2020 2020 2020  onditions.      
-00038220: 2020 2020 2020 6966 2061 7263 682e 7265        if arch.re
-00038230: 7374 6f72 6528 666c 6429 203e 2030 3a0a  store(fld) > 0:.
-00038240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038250: 6966 2073 6875 7469 6c2e 7768 6963 6828  if shutil.which(
-00038260: 2773 6261 7463 6827 2920 616e 6420 5c0a  'sbatch') and \.
-00038270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038280: 2020 2020 2020 2020 6172 6773 2e6e 6f73          args.nos
-00038290: 6c75 726d 203d 3d20 4661 6c73 6520 616e  lurm == False an
-000382a0: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
-000382b0: 2020 2020 2020 2020 2020 2020 6172 6773              args
-000382c0: 2e6e 6f64 6f77 6e6c 6f61 6420 3d3d 2046  .nodownload == F
-000382d0: 616c 7365 3a0a 2020 2020 2020 2020 2020  alse:.          
-000382e0: 2020 2020 2020 2020 2020 2320 7374 6172            # star
-000382f0: 7420 6120 6675 7475 7265 2053 6c75 726d  t a future Slurm
-00038300: 206a 6f62 206a 7573 7420 666f 7220 7468   job just for th
-00038310: 6520 646f 776e 6c6f 6164 0a20 2020 2020  e download.     
-00038320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00038330: 6520 3d20 536c 7572 6d45 7373 656e 7469  e = SlurmEssenti
-00038340: 616c 7328 6172 6773 2c20 6366 6729 0a20  als(args, cfg). 
-00038350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038360: 2020 2023 2067 6574 2061 206a 6f62 2073     # get a job s
-00038370: 7461 7274 2074 696d 6520 3132 2068 6f75  tart time 12 hou
-00038380: 7273 2066 726f 6d20 6e6f 770a 2020 2020  rs from now.    
-00038390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000383a0: 6675 745f 7469 6d65 203d 2073 652e 6765  fut_time = se.ge
-000383b0: 745f 6675 7475 7265 5f73 7461 7274 5f74  t_future_start_t
-000383c0: 696d 6528 3132 290a 2020 2020 2020 2020  ime(12).        
-000383d0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-000383e0: 6c20 3d20 666c 642e 7265 706c 6163 6528  l = fld.replace(
-000383f0: 272f 272c 2027 2b27 290a 2020 2020 2020  '/', '+').      
-00038400: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00038410: 6265 6c20 3d20 6c61 6265 6c2e 7265 706c  bel = label.repl
-00038420: 6163 6528 2720 272c 2027 5f27 290a 2020  ace(' ', '_').  
-00038430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038440: 2020 7368 6f72 746c 6162 656c 203d 206f    shortlabel = o
-00038450: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00038460: 666c 6429 0a20 2020 2020 2020 2020 2020  fld).           
-00038470: 2020 2020 2020 2020 206d 796a 6f62 6e61           myjobna
-00038480: 6d65 203d 2066 2766 726f 7374 6572 3a72  me = f'froster:r
-00038490: 6573 746f 7265 3a7b 7368 6f72 746c 6162  estore:{shortlab
-000384a0: 656c 7d27 0a20 2020 2020 2020 2020 2020  el}'.           
-000384b0: 2020 2020 2020 2020 2065 6d61 696c 203d           email =
-000384c0: 2063 6667 2e65 6d61 696c 0a20 2020 2020   cfg.email.     
-000384d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000384e0: 652e 6164 645f 6c69 6e65 2866 2723 5342  e.add_line(f'#SB
-000384f0: 4154 4348 202d 2d6a 6f62 2d6e 616d 653d  ATCH --job-name=
-00038500: 7b6d 796a 6f62 6e61 6d65 7d27 290a 2020  {myjobname}').  
-00038510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038520: 2020 7365 2e61 6464 5f6c 696e 6528 6627    se.add_line(f'
-00038530: 2353 4241 5443 4820 2d2d 6265 6769 6e3d  #SBATCH --begin=
-00038540: 7b66 7574 5f74 696d 657d 2729 0a20 2020  {fut_time}').   
-00038550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038560: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-00038570: 5342 4154 4348 202d 2d63 7075 732d 7065  SBATCH --cpus-pe
-00038580: 722d 7461 736b 3d7b 6172 6773 2e63 6f72  r-task={args.cor
-00038590: 6573 7d27 290a 2020 2020 2020 2020 2020  es}').          
-000385a0: 2020 2020 2020 2020 2020 7365 2e61 6464            se.add
-000385b0: 5f6c 696e 6528 6627 2353 4241 5443 4820  _line(f'#SBATCH 
-000385c0: 2d2d 6d65 6d3d 3634 4727 290a 2020 2020  --mem=64G').    
-000385d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000385e0: 7365 2e61 6464 5f6c 696e 6528 6627 2353  se.add_line(f'#S
-000385f0: 4241 5443 4820 2d2d 7265 7175 6575 6527  BATCH --requeue'
-00038600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00038610: 2020 2020 2020 7365 2e61 6464 5f6c 696e        se.add_lin
-00038620: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00038630: 2020 2020 2020 2020 2020 2066 2723 5342             f'#SB
-00038640: 4154 4348 202d 2d6f 7574 7075 743d 6672  ATCH --output=fr
-00038650: 6f73 7465 722d 646f 776e 6c6f 6164 2d7b  oster-download-{
-00038660: 6c61 6265 6c7d 2d25 4a2e 6f75 7427 290a  label}-%J.out').
-00038670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038680: 2020 2020 7365 2e61 6464 5f6c 696e 6528      se.add_line(
-00038690: 6627 2353 4241 5443 4820 2d2d 6d61 696c  f'#SBATCH --mail
-000386a0: 2d74 7970 653d 4641 494c 2c52 4551 5545  -type=FAIL,REQUE
-000386b0: 5545 2c45 4e44 2729 0a20 2020 2020 2020  UE,END').       
-000386c0: 2020 2020 2020 2020 2020 2020 2073 652e               se.
-000386d0: 6164 645f 6c69 6e65 2866 2723 5342 4154  add_line(f'#SBAT
-000386e0: 4348 202d 2d6d 6169 6c2d 7573 6572 3d7b  CH --mail-user={
-000386f0: 656d 6169 6c7d 2729 0a20 2020 2020 2020  email}').       
-00038700: 2020 2020 2020 2020 2020 2020 2073 652e               se.
-00038710: 6164 645f 6c69 6e65 2866 2723 5342 4154  add_line(f'#SBAT
-00038720: 4348 202d 2d74 696d 653d 7b73 652e 7761  CH --time={se.wa
-00038730: 6c6c 7469 6d65 7d27 290a 2020 2020 2020  lltime}').      
-00038740: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00038750: 2073 652e 7061 7274 6974 696f 6e3a 0a20   se.partition:. 
-00038760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038770: 2020 2020 2020 2073 652e 6164 645f 6c69         se.add_li
-00038780: 6e65 2866 2723 5342 4154 4348 202d 2d70  ne(f'#SBATCH --p
-00038790: 6172 7469 7469 6f6e 3d7b 7365 2e70 6172  artition={se.par
-000387a0: 7469 7469 6f6e 7d27 290a 2020 2020 2020  tition}').      
-000387b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000387c0: 2073 652e 716f 733a 0a20 2020 2020 2020   se.qos:.       
-000387d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387e0: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-000387f0: 5342 4154 4348 202d 2d71 6f73 3d7b 7365  SBATCH --qos={se
-00038800: 2e71 6f73 7d27 290a 2020 2020 2020 2020  .qos}').        
-00038810: 2020 2020 2020 2020 2020 2020 2320 6f72              # or
-00038820: 6967 696e 616c 2063 6d64 6c69 6e65 0a20  iginal cmdline. 
-00038830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038840: 2020 2063 6d64 6c69 6e65 203d 2022 2022     cmdline = " "
-00038850: 2e6a 6f69 6e28 6d61 7028 7368 6c65 782e  .join(map(shlex.
-00038860: 7175 6f74 652c 2073 7973 2e61 7267 7629  quote, sys.argv)
-00038870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00038880: 2020 2020 2020 6966 206e 6f74 2022 2d2d        if not "--
-00038890: 7072 6f66 696c 6522 2069 6e20 636d 646c  profile" in cmdl
-000388a0: 696e 6520 616e 6420 6172 6773 2e61 7773  ine and args.aws
-000388b0: 5f70 726f 6669 6c65 3a0a 2020 2020 2020  _profile:.      
-000388c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388d0: 2020 636d 646c 696e 6520 3d20 636d 646c    cmdline = cmdl
-000388e0: 696e 652e 7265 706c 6163 6528 0a20 2020  ine.replace(.   
-000388f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038900: 2020 2020 2020 2020 2027 2f66 726f 7374           '/frost
-00038910: 6572 2e70 7920 272c 2066 272f 6672 6f73  er.py ', f'/fros
-00038920: 7465 7220 2d2d 7072 6f66 696c 6520 7b61  ter --profile {a
-00038930: 7267 732e 6177 735f 7072 6f66 696c 657d  rgs.aws_profile}
-00038940: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
-00038950: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00038960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038970: 2020 2020 2020 636d 646c 696e 6520 3d20        cmdline = 
-00038980: 636d 646c 696e 652e 7265 706c 6163 6528  cmdline.replace(
-00038990: 272f 6672 6f73 7465 722e 7079 2027 2c20  '/froster.py ', 
-000389a0: 272f 6672 6f73 7465 7220 2729 0a20 2020  '/froster ').   
-000389b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000389c0: 2069 6620 6e6f 7420 666c 6420 696e 2063   if not fld in c
-000389d0: 6d64 6c69 6e65 3a0a 2020 2020 2020 2020  mdline:.        
-000389e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000389f0: 636d 646c 696e 6520 3d20 6627 7b63 6d64  cmdline = f'{cmd
-00038a00: 6c69 6e65 7d20 227b 666c 647d 2227 0a20  line} "{fld}"'. 
-00038a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038a20: 2020 2070 7269 6e74 6462 6728 6627 436f     printdbg(f'Co
-00038a30: 6d6d 616e 6420 6c69 6e65 2070 6173 7365  mmand line passe
-00038a40: 6420 746f 2053 6c75 726d 3a5c 6e7b 636d  d to Slurm:\n{cm
-00038a50: 646c 696e 657d 2729 0a20 2020 2020 2020  dline}').       
-00038a60: 2020 2020 2020 2020 2020 2020 2073 652e               se.
-00038a70: 6164 645f 6c69 6e65 2863 6d64 6c69 6e65  add_line(cmdline
-00038a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00038a90: 2020 2020 2020 6a6f 6269 6420 3d20 7365        jobid = se
-00038aa0: 2e73 6261 7463 6828 290a 2020 2020 2020  .sbatch().      
-00038ab0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00038ac0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-00038ad0: 2020 2020 2020 2020 2020 2020 2066 2753               f'S
-00038ae0: 7562 6d69 7474 6564 2066 726f 7374 6572  ubmitted froster
-00038af0: 2064 6f77 6e6c 6f61 6420 6a6f 6220 746f   download job to
-00038b00: 2072 756e 2069 6e20 3132 2068 6f75 7273   run in 12 hours
-00038b10: 3a20 7b6a 6f62 6964 7d27 290a 2020 2020  : {jobid}').    
-00038b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b30: 7072 696e 7428 6627 4368 6563 6b20 4a6f  print(f'Check Jo
-00038b40: 6220 4f75 7470 7574 3a27 290a 2020 2020  b Output:').    
-00038b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b60: 7072 696e 7428 6627 2074 6169 6c20 2d66  print(f' tail -f
-00038b70: 2066 726f 7374 6572 2d64 6f77 6e6c 6f61   froster-downloa
-00038b80: 642d 7b6c 6162 656c 7d2d 7b6a 6f62 6964  d-{label}-{jobid
-00038b90: 7d2e 6f75 7427 290a 2020 2020 2020 2020  }.out').        
-00038ba0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00038bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038bc0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-00038bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038be0: 2066 275c 6e47 6c61 6369 6572 2072 6574   f'\nGlacier ret
-00038bf0: 7269 6576 616c 7320 7065 6e64 696e 672c  rievals pending,
-00038c00: 2072 756e 2074 6869 7320 6167 6169 6e20   run this again 
-00038c10: 696e 2035 2d31 3220 686f 7572 735c 6e27  in 5-12 hours\n'
-00038c20: 290a 0a20 2020 2065 6c73 653a 0a20 2020  )..    else:.   
-00038c30: 2020 2020 2073 6520 3d20 536c 7572 6d45       se = SlurmE
-00038c40: 7373 656e 7469 616c 7328 6172 6773 2c20  ssentials(args, 
-00038c50: 6366 6729 0a20 2020 2020 2020 206c 6162  cfg).        lab
-00038c60: 656c 203d 2061 7267 732e 666f 6c64 6572  el = args.folder
-00038c70: 735b 305d 2e72 6570 6c61 6365 2827 2f27  s[0].replace('/'
-00038c80: 2c20 272b 2729 0a20 2020 2020 2020 206c  , '+').        l
-00038c90: 6162 656c 203d 206c 6162 656c 2e72 6570  abel = label.rep
-00038ca0: 6c61 6365 2827 2027 2c20 275f 2729 0a20  lace(' ', '_'). 
-00038cb0: 2020 2020 2020 2073 686f 7274 6c61 6265         shortlabe
-00038cc0: 6c20 3d20 6f73 2e70 6174 682e 6261 7365  l = os.path.base
-00038cd0: 6e61 6d65 2861 7267 732e 666f 6c64 6572  name(args.folder
-00038ce0: 735b 305d 290a 2020 2020 2020 2020 6d79  s[0]).        my
-00038cf0: 6a6f 626e 616d 6520 3d20 6627 6672 6f73  jobname = f'fros
-00038d00: 7465 723a 7265 7374 6f72 653a 7b73 686f  ter:restore:{sho
-00038d10: 7274 6c61 6265 6c7d 270a 2020 2020 2020  rtlabel}'.      
-00038d20: 2020 656d 6169 6c20 3d20 6366 672e 656d    email = cfg.em
-00038d30: 6169 6c0a 2020 2020 2020 2020 7365 2e61  ail.        se.a
-00038d40: 6464 5f6c 696e 6528 6627 2353 4241 5443  dd_line(f'#SBATC
-00038d50: 4820 2d2d 6a6f 622d 6e61 6d65 3d7b 6d79  H --job-name={my
-00038d60: 6a6f 626e 616d 657d 2729 0a20 2020 2020  jobname}').     
-00038d70: 2020 2073 652e 6164 645f 6c69 6e65 2866     se.add_line(f
-00038d80: 2723 5342 4154 4348 202d 2d63 7075 732d  '#SBATCH --cpus-
-00038d90: 7065 722d 7461 736b 3d7b 6172 6773 2e63  per-task={args.c
-00038da0: 6f72 6573 7d27 290a 2020 2020 2020 2020  ores}').        
-00038db0: 7365 2e61 6464 5f6c 696e 6528 6627 2353  se.add_line(f'#S
-00038dc0: 4241 5443 4820 2d2d 6d65 6d3d 3634 4727  BATCH --mem=64G'
-00038dd0: 290a 2020 2020 2020 2020 7365 2e61 6464  ).        se.add
-00038de0: 5f6c 696e 6528 6627 2353 4241 5443 4820  _line(f'#SBATCH 
-00038df0: 2d2d 7265 7175 6575 6527 290a 2020 2020  --requeue').    
-00038e00: 2020 2020 7365 2e61 6464 5f6c 696e 6528      se.add_line(
-00038e10: 6627 2353 4241 5443 4820 2d2d 6f75 7470  f'#SBATCH --outp
-00038e20: 7574 3d66 726f 7374 6572 2d72 6573 746f  ut=froster-resto
-00038e30: 7265 2d7b 6c61 6265 6c7d 2d25 4a2e 6f75  re-{label}-%J.ou
-00038e40: 7427 290a 2020 2020 2020 2020 7365 2e61  t').        se.a
-00038e50: 6464 5f6c 696e 6528 6627 2353 4241 5443  dd_line(f'#SBATC
-00038e60: 4820 2d2d 6d61 696c 2d74 7970 653d 4641  H --mail-type=FA
-00038e70: 494c 2c52 4551 5545 5545 2c45 4e44 2729  IL,REQUEUE,END')
-00038e80: 0a20 2020 2020 2020 2073 652e 6164 645f  .        se.add_
-00038e90: 6c69 6e65 2866 2723 5342 4154 4348 202d  line(f'#SBATCH -
-00038ea0: 2d6d 6169 6c2d 7573 6572 3d7b 656d 6169  -mail-user={emai
-00038eb0: 6c7d 2729 0a20 2020 2020 2020 2073 652e  l}').        se.
-00038ec0: 6164 645f 6c69 6e65 2866 2723 5342 4154  add_line(f'#SBAT
-00038ed0: 4348 202d 2d74 696d 653d 7b73 652e 7761  CH --time={se.wa
-00038ee0: 6c6c 7469 6d65 7d27 290a 2020 2020 2020  lltime}').      
-00038ef0: 2020 6966 2073 652e 7061 7274 6974 696f    if se.partitio
-00038f00: 6e3a 0a20 2020 2020 2020 2020 2020 2073  n:.            s
-00038f10: 652e 6164 645f 6c69 6e65 2866 2723 5342  e.add_line(f'#SB
-00038f20: 4154 4348 202d 2d70 6172 7469 7469 6f6e  ATCH --partition
-00038f30: 3d7b 7365 2e70 6172 7469 7469 6f6e 7d27  ={se.partition}'
-00038f40: 290a 2020 2020 2020 2020 6966 2073 652e  ).        if se.
-00038f50: 716f 733a 0a20 2020 2020 2020 2020 2020  qos:.           
-00038f60: 2073 652e 6164 645f 6c69 6e65 2866 2723   se.add_line(f'#
-00038f70: 5342 4154 4348 202d 2d71 6f73 3d7b 7365  SBATCH --qos={se
-00038f80: 2e71 6f73 7d27 290a 2020 2020 2020 2020  .qos}').        
-00038f90: 636d 646c 696e 6520 3d20 2220 222e 6a6f  cmdline = " ".jo
-00038fa0: 696e 286d 6170 2873 686c 6578 2e71 756f  in(map(shlex.quo
-00038fb0: 7465 2c20 7379 732e 6172 6776 2929 2020  te, sys.argv))  
-00038fc0: 2320 6f72 6967 696e 616c 2063 6d64 6c69  # original cmdli
-00038fd0: 6e65 0a20 2020 2020 2020 2069 6620 6e6f  ne.        if no
-00038fe0: 7420 222d 2d70 726f 6669 6c65 2220 696e  t "--profile" in
-00038ff0: 2063 6d64 6c69 6e65 2061 6e64 2061 7267   cmdline and arg
-00039000: 732e 6177 735f 7072 6f66 696c 653a 0a20  s.aws_profile:. 
-00039010: 2020 2020 2020 2020 2020 2063 6d64 6c69             cmdli
-00039020: 6e65 203d 2063 6d64 6c69 6e65 2e72 6570  ne = cmdline.rep
-00039030: 6c61 6365 280a 2020 2020 2020 2020 2020  lace(.          
-00039040: 2020 2020 2020 272f 6672 6f73 7465 722e        '/froster.
-00039050: 7079 2027 2c20 6627 2f66 726f 7374 6572  py ', f'/froster
-00039060: 202d 2d70 726f 6669 6c65 207b 6172 6773   --profile {args
-00039070: 2e61 7773 5f70 726f 6669 6c65 7d20 2729  .aws_profile} ')
-00039080: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00039090: 2020 2020 2020 2020 2020 2063 6d64 6c69             cmdli
-000390a0: 6e65 203d 2063 6d64 6c69 6e65 2e72 6570  ne = cmdline.rep
-000390b0: 6c61 6365 2827 2f66 726f 7374 6572 2e70  lace('/froster.p
-000390c0: 7920 272c 2027 2f66 726f 7374 6572 2027  y ', '/froster '
-000390d0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-000390e0: 2061 7267 732e 666f 6c64 6572 735b 305d   args.folders[0]
-000390f0: 2069 6e20 636d 646c 696e 653a 0a20 2020   in cmdline:.   
-00039100: 2020 2020 2020 2020 2066 6f6c 6465 7273           folders
-00039110: 203d 2027 2220 2227 2e6a 6f69 6e28 6172   = '" "'.join(ar
-00039120: 6773 2e66 6f6c 6465 7273 290a 2020 2020  gs.folders).    
-00039130: 2020 2020 2020 2020 636d 646c 696e 6520          cmdline 
-00039140: 3d20 6627 7b63 6d64 6c69 6e65 7d20 227b  = f'{cmdline} "{
-00039150: 666f 6c64 6572 737d 2227 0a20 2020 2020  folders}"'.     
-00039160: 2020 2070 7269 6e74 6462 6728 6627 436f     printdbg(f'Co
-00039170: 6d6d 616e 6420 6c69 6e65 2070 6173 7365  mmand line passe
-00039180: 6420 746f 2053 6c75 726d 3a5c 6e7b 636d  d to Slurm:\n{cm
-00039190: 646c 696e 657d 2729 0a20 2020 2020 2020  dline}').       
-000391a0: 2073 652e 6164 645f 6c69 6e65 2863 6d64   se.add_line(cmd
-000391b0: 6c69 6e65 290a 2020 2020 2020 2020 6a6f  line).        jo
-000391c0: 6269 6420 3d20 7365 2e73 6261 7463 6828  bid = se.sbatch(
-000391d0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-000391e0: 6627 5375 626d 6974 7465 6420 6672 6f73  f'Submitted fros
-000391f0: 7465 7220 7265 7374 6f72 6520 6a6f 623a  ter restore job:
-00039200: 207b 6a6f 6269 647d 2729 0a20 2020 2020   {jobid}').     
-00039210: 2020 2070 7269 6e74 2866 2743 6865 636b     print(f'Check
-00039220: 204a 6f62 204f 7574 7075 743a 2729 0a20   Job Output:'). 
-00039230: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
-00039240: 7461 696c 202d 6620 6672 6f73 7465 722d  tail -f froster-
-00039250: 7265 7374 6f72 652d 7b6c 6162 656c 7d2d  restore-{label}-
-00039260: 7b6a 6f62 6964 7d2e 6f75 7427 290a 0a0a  {jobid}.out')...
-00039270: 6465 6620 7375 6263 6d64 5f64 656c 6574  def subcmd_delet
-00039280: 6528 6172 6773 3a20 6172 6770 6172 7365  e(args: argparse
-00039290: 2e4e 616d 6573 7061 6365 2c20 6172 6368  .Namespace, arch
-000392a0: 3a20 4172 6368 6976 6572 293a 0a20 2020  : Archiver):.   
-000392b0: 2074 7279 3a0a 2020 2020 2020 2020 6966   try:.        if
-000392c0: 206e 6f74 2061 7267 732e 666f 6c64 6572   not args.folder
-000392d0: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
-000392e0: 2320 4765 7420 7468 6520 6c69 7374 206f  # Get the list o
-000392f0: 6620 666f 6c64 6572 7320 6672 6f6d 2074  f folders from t
-00039300: 6865 2061 7263 6869 7665 0a20 2020 2020  he archive.     
-00039310: 2020 2020 2020 2066 696c 6573 203d 2061         files = a
-00039320: 7263 682e 6172 6368 6976 655f 6a73 6f6e  rch.archive_json
-00039330: 5f67 6574 5f63 7376 280a 2020 2020 2020  _get_csv(.      
-00039340: 2020 2020 2020 2020 2020 5b27 6c6f 6361            ['loca
-00039350: 6c5f 666f 6c64 6572 272c 2027 7333 5f73  l_folder', 's3_s
-00039360: 746f 7261 6765 5f63 6c61 7373 272c 2027  torage_class', '
-00039370: 7072 6f66 696c 6527 2c20 2764 656c 6574  profile', 'delet
-00039380: 6564 275d 290a 0a20 2020 2020 2020 2020  ed'])..         
-00039390: 2020 2069 6620 6e6f 7420 6669 6c65 733a     if not files:
-000393a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000393b0: 2070 7269 6e74 2822 4e6f 2061 7263 6869   print("No archi
-000393c0: 7665 7320 6176 6169 6c61 626c 652e 2229  ves available.")
-000393d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000393e0: 2073 7973 2e65 7869 7428 3029 0a0a 2020   sys.exit(0)..  
-000393f0: 2020 2020 2020 2020 2020 6170 7020 3d20            app = 
-00039400: 5461 626c 6541 7263 6869 7665 2866 696c  TableArchive(fil
-00039410: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00039420: 7265 746c 696e 6520 3d20 6170 702e 7275  retline = app.ru
-00039430: 6e28 290a 0a20 2020 2020 2020 2020 2020  n()..           
-00039440: 2069 6620 6e6f 7420 7265 746c 696e 653a   if not retline:
-00039450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039460: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00039470: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00039480: 2872 6574 6c69 6e65 2920 3c20 323a 0a20  (retline) < 2:. 
-00039490: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000394a0: 7269 6e74 2866 275c 6e4e 6f20 6172 6368  rint(f'\nNo arch
-000394b0: 6976 6564 2066 6f6c 6465 7273 2066 6f75  ived folders fou
-000394c0: 6e64 5c6e 2729 0a20 2020 2020 2020 2020  nd\n').         
-000394d0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000394e0: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
-000394f0: 6172 6773 2e66 6f6c 6465 7273 203d 205b  args.folders = [
-00039500: 7265 746c 696e 655b 305d 5d0a 0a20 2020  retline[0]]..   
-00039510: 2020 2020 2061 7263 682e 6465 6c65 7465       arch.delete
-00039520: 2861 7267 732e 666f 6c64 6572 7329 0a0a  (args.folders)..
-00039530: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00039540: 7469 6f6e 3a0a 2020 2020 2020 2020 7072  tion:.        pr
-00039550: 696e 745f 6572 726f 7228 290a 0a0a 6465  int_error()...de
-00039560: 6620 7375 6263 6d64 5f6d 6f75 6e74 2861  f subcmd_mount(a
-00039570: 7267 732c 2063 6667 2c20 6172 6368 2c20  rgs, cfg, arch, 
-00039580: 6177 7329 3a0a 2020 2020 2320 544f 444f  aws):.    # TODO
-00039590: 3a20 6675 6e63 7469 6f6e 2070 656e 6469  : function pendi
-000395a0: 6e74 2074 6f20 7265 7669 6577 0a20 2020  nt to review.   
-000395b0: 2070 7269 6e74 2866 2754 4f44 4f3a 2066   print(f'TODO: f
-000395c0: 756e 6374 696f 6e20 7b69 6e73 7065 6374  unction {inspect
-000395d0: 2e73 7461 636b 2829 5b30 5d5b 335d 7d20  .stack()[0][3]} 
-000395e0: 7065 6e64 696e 6720 746f 2072 6576 6965  pending to revie
-000395f0: 7727 290a 2020 2020 6578 6974 2831 290a  w').    exit(1).
-00039600: 0a20 2020 2070 7269 6e74 6462 6728 226d  .    printdbg("m
-00039610: 6f75 6e74 3a22 2c20 6172 6773 2e61 7773  ount:", args.aws
-00039620: 5f70 726f 6669 6c65 2c20 6172 6773 2e6d  _profile, args.m
-00039630: 6f75 6e74 706f 696e 742c 2061 7267 732e  ountpoint, args.
-00039640: 666f 6c64 6572 7329 0a20 2020 2066 6c64  folders).    fld
-00039650: 203d 2027 2220 2227 2e6a 6f69 6e28 6172   = '" "'.join(ar
-00039660: 6773 2e66 6f6c 6465 7273 290a 2020 2020  gs.folders).    
-00039670: 7072 696e 7464 6267 2866 2764 6566 6175  printdbg(f'defau
-00039680: 6c74 2063 6d64 6c69 6e65 3a20 6672 6f73  lt cmdline: fros
-00039690: 7465 7220 6d6f 756e 7420 227b 666c 647d  ter mount "{fld}
-000396a0: 2227 290a 0a20 2020 2069 6e74 6572 6163  "')..    interac
-000396b0: 7469 7665 203d 2046 616c 7365 0a20 2020  tive = False.   
-000396c0: 2069 6620 6e6f 7420 6172 6773 2e66 6f6c   if not args.fol
-000396d0: 6465 7273 3a0a 2020 2020 2020 2020 696e  ders:.        in
-000396e0: 7465 7261 6374 6976 6520 3d20 5472 7565  teractive = True
-000396f0: 0a20 2020 2020 2020 2066 696c 6573 203d  .        files =
-00039700: 2061 7263 682e 6172 6368 6976 655f 6a73   arch.archive_js
-00039710: 6f6e 5f67 6574 5f63 7376 280a 2020 2020  on_get_csv(.    
-00039720: 2020 2020 2020 2020 5b27 6c6f 6361 6c5f          ['local_
-00039730: 666f 6c64 6572 272c 2027 7333 5f73 746f  folder', 's3_sto
-00039740: 7261 6765 5f63 6c61 7373 272c 2027 7072  rage_class', 'pr
-00039750: 6f66 696c 6527 2c20 2761 7263 6869 7665  ofile', 'archive
-00039760: 5f6d 6f64 6527 5d29 0a20 2020 2020 2020  _mode']).       
-00039770: 2069 6620 6e6f 7420 6669 6c65 733a 0a20   if not files:. 
-00039780: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00039790: 2822 4e6f 2061 7263 6869 7665 7320 6176  ("No archives av
-000397a0: 6169 6c61 626c 652e 2229 0a20 2020 2020  ailable.").     
-000397b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000397c0: 6c73 650a 2020 2020 2020 2020 6170 7020  lse.        app 
-000397d0: 3d20 5461 626c 6541 7263 6869 7665 2866  = TableArchive(f
-000397e0: 696c 6573 290a 2020 2020 2020 2020 7265  iles).        re
-000397f0: 746c 696e 6520 3d20 6170 702e 7275 6e28  tline = app.run(
-00039800: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00039810: 2072 6574 6c69 6e65 3a0a 2020 2020 2020   retline:.      
-00039820: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00039830: 7365 0a20 2020 2020 2020 2069 6620 6c65  se.        if le
-00039840: 6e28 7265 746c 696e 6529 203c 2032 3a0a  n(retline) < 2:.
-00039850: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00039860: 7428 2745 7272 6f72 3a20 6672 6f73 7465  t('Error: froste
-00039870: 722d 6172 6368 6976 6573 2074 6162 6c65  r-archives table
-00039880: 2064 6964 206e 6f74 2072 6574 7572 6e20   did not return 
-00039890: 7265 7375 6c74 272c 0a20 2020 2020 2020  result',.       
-000398a0: 2020 2020 2020 2020 2020 2066 696c 653d             file=
-000398b0: 7379 732e 7374 6465 7272 290a 2020 2020  sys.stderr).    
-000398c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000398d0: 616c 7365 0a20 2020 2020 2020 2070 7269  alse.        pri
-000398e0: 6e74 6462 6728 2264 6961 6c6f 6720 7265  ntdbg("dialog re
-000398f0: 7475 726e 733a 222c 2072 6574 6c69 6e65  turns:", retline
-00039900: 290a 2020 2020 2020 2020 6172 6773 2e66  ).        args.f
-00039910: 6f6c 6465 7273 2e61 7070 656e 6428 7265  olders.append(re
-00039920: 746c 696e 655b 305d 290a 2020 2020 2020  tline[0]).      
-00039930: 2020 6966 2072 6574 6c69 6e65 5b32 5d3a    if retline[2]:
-00039940: 0a20 2020 2020 2020 2020 2020 2063 6667  .            cfg
-00039950: 2e61 7773 5f70 726f 6669 6c65 203d 2072  .aws_profile = r
-00039960: 6574 6c69 6e65 5b32 5d0a 2020 2020 2020  etline[2].      
-00039970: 2020 2020 2020 6172 6773 2e61 7773 5f70        args.aws_p
-00039980: 726f 6669 6c65 203d 2063 6667 2e61 7773  rofile = cfg.aws
-00039990: 5f70 726f 6669 6c65 0a20 2020 2020 2020  _profile.       
-000399a0: 2020 2020 2063 6667 2e73 6574 5f65 6e76       cfg.set_env
-000399b0: 5f76 6172 7328 6366 672e 6177 735f 7072  _vars(cfg.aws_pr
-000399c0: 6f66 696c 6529 0a20 2020 2065 6c73 653a  ofile).    else:
-000399d0: 0a20 2020 2020 2020 2070 6173 730a 2020  .        pass.  
-000399e0: 2020 2020 2020 2320 7765 2061 6374 7561        # we actua
-000399f0: 6c6c 7920 7761 6e74 2074 6f20 7375 7070  lly want to supp
-00039a00: 6f72 7420 7379 6d6c 696e 6b73 0a20 2020  ort symlinks.   
-00039a10: 2020 2020 2023 2061 7267 732e 666f 6c64       # args.fold
-00039a20: 6572 7320 3d20 636c 6561 6e5f 7061 7468  ers = clean_path
-00039a30: 7328 6172 6773 2e66 6f6c 6465 7273 290a  s(args.folders).
-00039a40: 0a20 2020 2069 6620 6172 6773 2e61 7773  .    if args.aws
-00039a50: 5f70 726f 6669 6c65 2061 6e64 2061 7267  _profile and arg
-00039a60: 732e 6177 735f 7072 6f66 696c 6520 6e6f  s.aws_profile no
-00039a70: 7420 696e 2063 6667 2e67 6574 5f61 7773  t in cfg.get_aws
-00039a80: 5f70 726f 6669 6c65 7328 293a 0a20 2020  _profiles():.   
-00039a90: 2020 2020 2070 7269 6e74 2866 2750 726f       print(f'Pro
-00039aa0: 6669 6c65 2022 7b61 7267 732e 6177 735f  file "{args.aws_
-00039ab0: 7072 6f66 696c 657d 2220 6e6f 7420 666f  profile}" not fo
-00039ac0: 756e 642e 2729 0a20 2020 2020 2020 2072  und.').        r
-00039ad0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00039ae0: 6966 206e 6f74 2061 7773 2e63 6865 636b  if not aws.check
-00039af0: 5f62 7563 6b65 745f 6163 6365 7373 5f66  _bucket_access_f
-00039b00: 6f6c 6465 7273 2861 7267 732e 666f 6c64  olders(args.fold
-00039b10: 6572 7329 3a0a 2020 2020 2020 2020 7265  ers):.        re
-00039b20: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-00039b30: 6966 2061 7267 732e 6177 733a 0a20 2020  if args.aws:.   
-00039b40: 2020 2020 2063 6667 2e63 7265 6174 655f       cfg.create_
-00039b50: 6563 325f 696e 7374 616e 6365 2829 0a20  ec2_instance(). 
-00039b60: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00039b70: 7565 0a0a 2020 2020 686f 7374 6e61 6d65  ue..    hostname
-00039b80: 203d 2070 6c61 7466 6f72 6d2e 6e6f 6465   = platform.node
-00039b90: 2829 0a20 2020 2072 636c 6f6e 6520 3d20  ().    rclone = 
-00039ba0: 5263 6c6f 6e65 2861 7267 732c 2063 6667  Rclone(args, cfg
-00039bb0: 290a 2020 2020 666f 7220 666c 6420 696e  ).    for fld in
-00039bc0: 2061 7267 732e 666f 6c64 6572 733a 0a20   args.folders:. 
-00039bd0: 2020 2020 2020 2066 6c64 203d 2066 6c64         fld = fld
-00039be0: 2e72 7374 7269 7028 6f73 2e70 6174 682e  .rstrip(os.path.
-00039bf0: 7365 7029 0a20 2020 2020 2020 2069 6620  sep).        if 
-00039c00: 666c 6420 3d3d 206f 732e 7061 7468 2e72  fld == os.path.r
-00039c10: 6561 6c70 6174 6828 6f73 2e67 6574 6377  ealpath(os.getcw
-00039c20: 6428 2929 3a0a 2020 2020 2020 2020 2020  d()):.          
-00039c30: 2020 7072 696e 7428 6627 2043 616e 6e6f    print(f' Canno
-00039c40: 7420 6d6f 756e 7420 6375 7272 656e 7420  t mount current 
-00039c50: 776f 726b 696e 6720 6469 7265 6374 6f72  working director
-00039c60: 7920 7b66 6c64 7d27 290a 2020 2020 2020  y {fld}').      
-00039c70: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00039c80: 2020 2020 2020 2023 2067 6574 2061 7263         # get arc
-00039c90: 6869 7665 2073 746f 7261 6765 206c 6f63  hive storage loc
-00039ca0: 6174 696f 6e0a 2020 2020 2020 2020 726f  ation.        ro
-00039cb0: 7764 6963 7420 3d20 6172 6368 2e61 7263  wdict = arch.arc
-00039cc0: 6869 7665 5f6a 736f 6e5f 6765 745f 726f  hive_json_get_ro
-00039cd0: 7728 666c 6429 0a20 2020 2020 2020 2069  w(fld).        i
-00039ce0: 6620 726f 7764 6963 7420 3d3d 204e 6f6e  f rowdict == Non
-00039cf0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00039d00: 7269 6e74 2866 2746 6f6c 6465 7220 227b  rint(f'Folder "{
-00039d10: 666c 647d 2220 6e6f 7420 696e 2061 7263  fld}" not in arc
-00039d20: 6869 7665 2e27 290a 2020 2020 2020 2020  hive.').        
-00039d30: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00039d40: 2020 2020 2061 7263 6869 7665 5f66 6f6c       archive_fol
-00039d50: 6465 7220 3d20 726f 7764 6963 745b 2761  der = rowdict['a
-00039d60: 7263 6869 7665 5f66 6f6c 6465 7227 5d0a  rchive_folder'].
-00039d70: 0a20 2020 2020 2020 2069 6620 6172 6773  .        if args
-00039d80: 2e6d 6f75 6e74 706f 696e 7420 616e 6420  .mountpoint and 
-00039d90: 6f73 2e70 6174 682e 6973 6469 7228 6172  os.path.isdir(ar
-00039da0: 6773 2e6d 6f75 6e74 706f 696e 7429 3a0a  gs.mountpoint):.
-00039db0: 2020 2020 2020 2020 2020 2020 666c 6420              fld 
-00039dc0: 3d20 6172 6773 2e6d 6f75 6e74 706f 696e  = args.mountpoin
-00039dd0: 740a 0a20 2020 2020 2020 2070 7269 6e74  t..        print
-00039de0: 2866 274d 6f75 6e74 696e 6720 6172 6368  (f'Mounting arch
-00039df0: 6976 6520 666f 6c64 6572 2061 7420 7b66  ive folder at {f
-00039e00: 6c64 7d20 2e2e 2e20 272c 2066 6c75 7368  ld} ... ', flush
-00039e10: 3d54 7275 652c 2065 6e64 3d22 2229 0a20  =True, end=""). 
-00039e20: 2020 2020 2020 2070 6964 203d 2072 636c         pid = rcl
-00039e30: 6f6e 652e 6d6f 756e 7428 6172 6368 6976  one.mount(archiv
-00039e40: 655f 666f 6c64 6572 2c20 666c 6429 0a20  e_folder, fld). 
-00039e50: 2020 2020 2020 2070 7269 6e74 2827 446f         print('Do
-00039e60: 6e65 2127 2c20 666c 7573 683d 5472 7565  ne!', flush=True
-00039e70: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
-00039e80: 6572 6163 7469 7665 3a0a 2020 2020 2020  eractive:.      
-00039e90: 2020 2020 2020 7072 696e 7428 7465 7874        print(text
-00039ea0: 7772 6170 2e64 6564 656e 7428 6627 2727  wrap.dedent(f'''
-00039eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039ec0: 204e 6f74 6520 7468 6174 2074 6869 7320   Note that this 
-00039ed0: 6d6f 756e 7420 706f 696e 7420 7769 6c6c  mount point will
-00039ee0: 206f 6e6c 7920 776f 726b 206f 6e20 7468   only work on th
-00039ef0: 6520 6375 7272 656e 7420 6d61 6368 696e  e current machin
-00039f00: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00039f10: 2020 2069 6620 796f 7520 776f 756c 6420     if you would 
-00039f20: 6c69 6b65 2074 6f20 6861 7665 2074 6869  like to have thi
-00039f30: 7320 776f 726b 2069 6e20 6120 6261 7463  s work in a batc
-00039f40: 6820 6a6f 6220 796f 7520 6e65 6564 2074  h job you need t
-00039f50: 6f20 656e 7465 720a 2020 2020 2020 2020  o enter.        
-00039f60: 2020 2020 2020 2020 7468 6573 6520 636f          these co
-00039f70: 6d6d 616e 6473 2069 6e20 7468 6520 6265  mmands in the be
-00039f80: 6769 6e6e 696e 6720 616e 6420 7468 6520  ginning and the 
-00039f90: 656e 6420 6f66 2061 2062 6174 6368 2073  end of a batch s
-00039fa0: 6372 6970 743a 0a20 2020 2020 2020 2020  cript:.         
-00039fb0: 2020 2020 2020 2066 726f 7374 6572 206d         froster m
-00039fc0: 6f75 6e74 207b 666c 647d 0a20 2020 2020  ount {fld}.     
-00039fd0: 2020 2020 2020 2020 2020 2066 726f 7374             frost
-00039fe0: 6572 2075 6d6f 756e 7420 7b66 6c64 7d0a  er umount {fld}.
-00039ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a000: 2727 2729 290a 2020 2020 2020 2020 6966  ''')).        if
-0003a010: 2061 7267 732e 6d6f 756e 7470 6f69 6e74   args.mountpoint
-0003a020: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0003a030: 7765 2063 616e 206f 6e6c 7920 6d6f 756e  we can only moun
-0003a040: 7420 6120 7369 6e67 6c65 2066 6f6c 6465  t a single folde
-0003a050: 7220 6966 206d 6f75 6e74 706f 696e 7420  r if mountpoint 
-0003a060: 6973 2073 6574 0a20 2020 2020 2020 2020  is set.         
-0003a070: 2020 2062 7265 616b 0a0a 0a64 6566 2073     break...def s
-0003a080: 7562 636d 645f 756d 6f75 6e74 2861 7267  ubcmd_umount(arg
-0003a090: 732c 2063 6667 293a 0a0a 2020 2020 7263  s, cfg):..    rc
-0003a0a0: 6c6f 6e65 203d 2052 636c 6f6e 6528 6172  lone = Rclone(ar
-0003a0b0: 6773 2c20 6366 6729 0a20 2020 206d 6f75  gs, cfg).    mou
-0003a0c0: 6e74 7320 3d20 7263 6c6f 6e65 2e67 6574  nts = rclone.get
-0003a0d0: 5f6d 6f75 6e74 7328 290a 2020 2020 6966  _mounts().    if
-0003a0e0: 206c 656e 286d 6f75 6e74 7329 203d 3d20   len(mounts) == 
-0003a0f0: 303a 0a20 2020 2020 2020 2070 7269 6e74  0:.        print
-0003a100: 2822 4e6f 2052 636c 6f6e 6520 6d6f 756e  ("No Rclone moun
-0003a110: 7473 206f 6e20 7468 6973 2063 6f6d 7075  ts on this compu
-0003a120: 7465 722e 2229 0a20 2020 2020 2020 2072  ter.").        r
-0003a130: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0003a140: 666f 6c64 6572 7320 3d20 636c 6561 6e5f  folders = clean_
-0003a150: 7061 7468 7328 6172 6773 2e66 6f6c 6465  paths(args.folde
-0003a160: 7273 290a 2020 2020 6966 206c 656e 2866  rs).    if len(f
-0003a170: 6f6c 6465 7273 2920 3d3d 2030 3a0a 2020  olders) == 0:.  
-0003a180: 2020 2020 2020 6669 6c65 7320 3d20 225c        files = "\
-0003a190: 6e22 2e6a 6f69 6e28 6d6f 756e 7473 290a  n".join(mounts).
-0003a1a0: 2020 2020 2020 2020 6669 6c65 7320 3d20          files = 
-0003a1b0: 224d 6f75 6e74 706f 696e 745c 6e22 2b66  "Mountpoint\n"+f
-0003a1c0: 696c 6573 0a20 2020 2020 2020 2061 7070  iles.        app
-0003a1d0: 203d 2054 6162 6c65 4172 6368 6976 6528   = TableArchive(
-0003a1e0: 6669 6c65 7329 0a20 2020 2020 2020 2072  files).        r
-0003a1f0: 6574 6c69 6e65 203d 2061 7070 2e72 756e  etline = app.run
-0003a200: 2829 0a20 2020 2020 2020 2066 6f6c 6465  ().        folde
-0003a210: 7273 2e61 7070 656e 6428 7265 746c 696e  rs.append(retlin
-0003a220: 655b 305d 290a 2020 2020 666f 7220 666c  e[0]).    for fl
-0003a230: 6420 696e 2066 6f6c 6465 7273 3a0a 2020  d in folders:.  
-0003a240: 2020 2020 2020 7072 696e 7428 6627 556e        print(f'Un
-0003a250: 6d6f 756e 7469 6e67 2066 6f6c 6465 7220  mounting folder 
-0003a260: 7b66 6c64 7d20 2e2e 2e20 272c 2066 6c75  {fld} ... ', flu
-0003a270: 7368 3d54 7275 652c 2065 6e64 3d22 2229  sh=True, end="")
-0003a280: 0a20 2020 2020 2020 2072 636c 6f6e 652e  .        rclone.
-0003a290: 756e 6d6f 756e 7428 666c 6429 0a20 2020  unmount(fld).   
-0003a2a0: 2020 2020 2070 7269 6e74 2827 446f 6e65       print('Done
-0003a2b0: 2127 2c20 666c 7573 683d 5472 7565 290a  !', flush=True).
-0003a2c0: 0a0a 6465 6620 7375 6263 6d64 5f73 7368  ..def subcmd_ssh
-0003a2d0: 2861 7267 732c 2063 6667 3a20 436f 6e66  (args, cfg: Conf
-0003a2e0: 6967 4d61 6e61 6765 722c 2061 7773 3a20  igManager, aws: 
-0003a2f0: 4157 5342 6f74 6f29 3a0a 0a20 2020 2069  AWSBoto):..    i
-0003a300: 6c69 7374 203d 2061 7773 2e65 6332 5f6c  list = aws.ec2_l
-0003a310: 6973 745f 696e 7374 616e 6365 7328 274e  ist_instances('N
-0003a320: 616d 6527 2c20 2746 726f 7374 6572 5365  ame', 'FrosterSe
-0003a330: 6c66 4465 7374 7275 6374 2729 0a20 2020  lfDestruct').   
-0003a340: 2069 7073 203d 205b 7375 626c 6973 745b   ips = [sublist[
-0003a350: 305d 2066 6f72 2073 7562 6c69 7374 2069  0] for sublist i
-0003a360: 6e20 696c 6973 7420 6966 2073 7562 6c69  n ilist if subli
-0003a370: 7374 5d0a 2020 2020 6966 2061 7267 732e  st].    if args.
-0003a380: 6c69 7374 3a0a 2020 2020 2020 2020 6966  list:.        if
-0003a390: 2069 7073 3a0a 2020 2020 2020 2020 2020   ips:.          
-0003a3a0: 2020 7072 696e 7428 2252 756e 6e69 6e67    print("Running
-0003a3b0: 2041 5753 2045 4332 2049 6e73 7461 6e63   AWS EC2 Instanc
-0003a3c0: 6573 3a22 290a 2020 2020 2020 2020 2020  es:").          
-0003a3d0: 2020 666f 7220 726f 7720 696e 2069 6c69    for row in ili
-0003a3e0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-0003a3f0: 2020 2020 7072 696e 7428 2720 2d20 272e      print(' - '.
-0003a400: 6a6f 696e 2872 6f77 2929 0a20 2020 2020  join(row)).     
-0003a410: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003a420: 2020 2020 2070 7269 6e74 2827 4e6f 2072       print('No r
-0003a430: 756e 6e69 6e67 2069 6e73 7461 6e63 6573  unning instances
-0003a440: 2064 6574 6563 7465 6427 290a 2020 2020   detected').    
-0003a450: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-0003a460: 2020 2020 6966 2061 7267 732e 7465 726d      if args.term
-0003a470: 696e 6174 653a 0a20 2020 2020 2020 2061  inate:.        a
-0003a480: 7773 2e65 6332 5f74 6572 6d69 6e61 7465  ws.ec2_terminate
-0003a490: 5f69 6e73 7461 6e63 6528 6172 6773 2e74  _instance(args.t
-0003a4a0: 6572 6d69 6e61 7465 290a 2020 2020 2020  erminate).      
-0003a4b0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0003a4c0: 2020 6966 2061 7267 732e 7373 6861 7267    if args.ssharg
-0003a4d0: 733a 0a20 2020 2020 2020 2069 6620 273a  s:.        if ':
-0003a4e0: 2720 696e 2061 7267 732e 7373 6861 7267  ' in args.ssharg
-0003a4f0: 735b 305d 3a0a 2020 2020 2020 2020 2020  s[0]:.          
-0003a500: 2020 6d79 686f 7374 2c20 7265 6d6f 7465    myhost, remote
-0003a510: 5f70 6174 6820 3d20 6172 6773 2e73 7368  _path = args.ssh
-0003a520: 6172 6773 5b30 5d2e 7370 6c69 7428 273a  args[0].split(':
-0003a530: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
-0003a540: 0a20 2020 2020 2020 2020 2020 206d 7968  .            myh
-0003a550: 6f73 7420 3d20 6172 6773 2e73 7368 6172  ost = args.sshar
-0003a560: 6773 5b30 5d0a 2020 2020 2020 2020 2020  gs[0].          
-0003a570: 2020 7265 6d6f 7465 5f70 6174 6820 3d20    remote_path = 
-0003a580: 2727 0a20 2020 2065 6c73 653a 0a20 2020  ''.    else:.   
-0003a590: 2020 2020 206d 7968 6f73 7420 3d20 6366       myhost = cf
-0003a5a0: 672e 6563 325f 6c61 7374 5f69 6e73 7461  g.ec2_last_insta
-0003a5b0: 6e63 650a 2020 2020 6966 2069 7073 2061  nce.    if ips a
-0003a5c0: 6e64 206e 6f74 206d 7968 6f73 7420 696e  nd not myhost in
-0003a5d0: 2069 7073 3a0a 2020 2020 2020 2020 7072   ips:.        pr
-0003a5e0: 696e 7428 6627 7b6d 7968 6f73 747d 2069  int(f'{myhost} i
-0003a5f0: 7320 6e6f 206c 6f6e 6765 7220 7275 6e6e  s no longer runn
-0003a600: 696e 672c 2072 6570 6c61 6369 6e67 2077  ing, replacing w
-0003a610: 6974 6820 7b69 7073 5b2d 315d 7d27 290a  ith {ips[-1]}').
-0003a620: 2020 2020 2020 2020 6d79 686f 7374 203d          myhost =
-0003a630: 2069 7073 5b2d 315d 0a20 2020 2069 6620   ips[-1].    if 
-0003a640: 6172 6773 2e73 7562 636d 6420 3d3d 2027  args.subcmd == '
-0003a650: 7373 6827 3a0a 2020 2020 2020 2020 7072  ssh':.        pr
-0003a660: 696e 7428 6627 436f 6e6e 6563 7469 6e67  int(f'Connecting
-0003a670: 2074 6f20 7b6d 7968 6f73 747d 202e 2e2e   to {myhost} ...
-0003a680: 2729 0a20 2020 2020 2020 2061 7773 2e73  ').        aws.s
-0003a690: 7368 5f65 7865 6375 7465 2827 6563 322d  sh_execute('ec2-
-0003a6a0: 7573 6572 272c 206d 7968 6f73 7429 0a20  user', myhost). 
-0003a6b0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0003a6c0: 7565 0a20 2020 2065 6c69 6620 6172 6773  ue.    elif args
-0003a6d0: 2e73 7562 636d 6420 3d3d 2027 7363 7027  .subcmd == 'scp'
-0003a6e0: 3a0a 2020 2020 2020 2020 6966 206c 656e  :.        if len
-0003a6f0: 2861 7267 732e 7373 6861 7267 7329 2021  (args.sshargs) !
-0003a700: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0003a710: 2070 7269 6e74 2827 5468 6520 2273 6370   print('The "scp
-0003a720: 2220 7375 6220 636f 6d6d 616e 6420 7375  " sub command su
-0003a730: 7070 6f72 7473 2063 7572 7265 6e74 6c79  pports currently
-0003a740: 2032 2061 7267 756d 656e 7473 2729 0a20   2 arguments'). 
-0003a750: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0003a760: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-0003a770: 686f 7374 6c6f 6320 3d20 6e65 7874 2828  hostloc = next((
-0003a780: 6920 666f 7220 692c 2069 7465 6d20 696e  i for i, item in
-0003a790: 2065 6e75 6d65 7261 7465 280a 2020 2020   enumerate(.    
-0003a7a0: 2020 2020 2020 2020 6172 6773 2e73 7368          args.ssh
-0003a7b0: 6172 6773 2920 6966 2022 3a22 2069 6e20  args) if ":" in 
-0003a7c0: 6974 656d 292c 204e 6f6e 6529 0a20 2020  item), None).   
-0003a7d0: 2020 2020 2069 6620 686f 7374 6c6f 6320       if hostloc 
-0003a7e0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0003a7f0: 2020 2320 7468 6520 686f 7374 6e61 6d65    # the hostname
-0003a800: 2069 7320 696e 2074 6865 2066 6972 7374   is in the first
-0003a810: 2061 7267 756d 656e 743a 2064 6f77 6e6c   argument: downl
-0003a820: 6f61 640a 2020 2020 2020 2020 2020 2020  oad.            
-0003a830: 686f 7374 2c20 7265 6d6f 7465 5f70 6174  host, remote_pat
-0003a840: 6820 3d20 6172 6773 2e73 7368 6172 6773  h = args.sshargs
-0003a850: 5b30 5d2e 7370 6c69 7428 273a 2729 0a20  [0].split(':'). 
-0003a860: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0003a870: 2061 7773 2e73 7368 5f64 6f77 6e6c 6f61   aws.ssh_downloa
-0003a880: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-0003a890: 2020 2027 6563 322d 7573 6572 272c 2068     'ec2-user', h
-0003a8a0: 6f73 742c 2072 656d 6f74 655f 7061 7468  ost, remote_path
-0003a8b0: 2c20 6172 6773 2e73 7368 6172 6773 5b31  , args.sshargs[1
-0003a8c0: 5d29 0a20 2020 2020 2020 2065 6c69 6620  ]).        elif 
-0003a8d0: 686f 7374 6c6f 6320 3d3d 2031 3a0a 2020  hostloc == 1:.  
-0003a8e0: 2020 2020 2020 2020 2020 2320 7468 6520            # the 
-0003a8f0: 686f 7374 6e61 6d65 2069 7320 696e 2074  hostname is in t
-0003a900: 6865 2073 6563 6f6e 6420 6172 6775 6d65  he second argume
-0003a910: 6e74 3a20 7570 6c6f 6161 640a 2020 2020  nt: uploaad.    
-0003a920: 2020 2020 2020 2020 686f 7374 2c20 7265          host, re
-0003a930: 6d6f 7465 5f70 6174 6820 3d20 6172 6773  mote_path = args
-0003a940: 2e73 7368 6172 6773 5b31 5d2e 7370 6c69  .sshargs[1].spli
-0003a950: 7428 273a 2729 0a20 2020 2020 2020 2020  t(':').         
-0003a960: 2020 2072 6574 203d 2061 7773 2e73 7368     ret = aws.ssh
-0003a970: 5f75 706c 6f61 6428 0a20 2020 2020 2020  _upload(.       
-0003a980: 2020 2020 2020 2020 2027 6563 322d 7573           'ec2-us
-0003a990: 6572 272c 2068 6f73 742c 2061 7267 732e  er', host, args.
-0003a9a0: 7373 6861 7267 735b 305d 2c20 7265 6d6f  sshargs[0], remo
-0003a9b0: 7465 5f70 6174 6829 0a20 2020 2020 2020  te_path).       
-0003a9c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003a9d0: 2020 2070 7269 6e74 2827 5468 6520 2273     print('The "s
-0003a9e0: 6370 2220 7375 6220 636f 6d6d 616e 6420  cp" sub command 
-0003a9f0: 7375 7070 6f72 7473 2063 7572 7265 6e74  supports current
-0003aa00: 6c79 2032 2061 7267 756d 656e 7473 2729  ly 2 arguments')
-0003aa10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003aa20: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0003aa30: 2020 7072 696e 7428 7265 742e 7374 646f    print(ret.stdo
-0003aa40: 7574 2c20 7265 742e 7374 6465 7272 290a  ut, ret.stderr).
-0003aa50: 0a0a 6465 6620 7375 6263 6d64 5f63 7265  ..def subcmd_cre
-0003aa60: 6465 6e74 6961 6c73 2861 7267 732c 2061  dentials(args, a
-0003aa70: 7773 3a20 4157 5342 6f74 6f29 3a0a 2020  ws: AWSBoto):.  
-0003aa80: 2020 7072 696e 7428 225c 6e43 6865 636b    print("\nCheck
-0003aa90: 696e 6720 4157 5320 6372 6564 656e 7469  ing AWS credenti
-0003aaa0: 616c 732e 2e2e 2229 0a0a 2020 2020 6966  als...")..    if
-0003aab0: 2061 7773 2e76 616c 6964 5f73 6573 7369   aws.valid_sessi
-0003aac0: 6f6e 3a0a 2020 2020 2020 2020 7072 696e  on:.        prin
-0003aad0: 7428 2720 2020 202e 2e2e 4157 5320 6372  t('    ...AWS cr
-0003aae0: 6564 656e 7469 616c 7320 6172 6520 7661  edentials are va
-0003aaf0: 6c69 645c 6e27 290a 2020 2020 656c 7365  lid\n').    else
-0003ab00: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0003ab10: 2720 2020 202e 2e2e 4157 5320 6372 6564  '    ...AWS cred
-0003ab20: 656e 7469 616c 7320 6172 6520 4e4f 5420  entials are NOT 
-0003ab30: 7661 6c69 645c 6e27 290a 2020 2020 2020  valid\n').      
-0003ab40: 2020 7072 696e 7428 275c 6e59 6f75 2063    print('\nYou c
-0003ab50: 616e 2063 6f6e 6669 6775 7265 2041 5753  an configure AWS
-0003ab60: 2063 7265 6465 6e74 6961 6c73 2075 7369   credentials usi
-0003ab70: 6e67 2074 6865 2063 6f6d 6d61 6e64 3a27  ng the command:'
-0003ab80: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0003ab90: 2720 2020 2066 726f 7374 6572 2063 6f6e  '    froster con
-0003aba0: 6669 6720 2d2d 6177 735c 6e27 290a 2020  fig --aws\n').  
-0003abb0: 2020 2020 2020 7379 732e 6578 6974 2830        sys.exit(0
-0003abc0: 290a 0a20 2020 2061 7773 2e63 6865 636b  )..    aws.check
-0003abd0: 5f62 7563 6b65 745f 6163 6365 7373 5f66  _bucket_access_f
-0003abe0: 6f6c 6465 7273 2861 7267 732e 666f 6c64  olders(args.fold
-0003abf0: 6572 7329 0a0a 0a64 6566 2070 6172 7365  ers)...def parse
-0003ac00: 5f61 7267 756d 656e 7473 2829 3a0a 2020  _arguments():.  
-0003ac10: 2020 2727 2747 6174 6865 7220 616e 6420    '''Gather and 
-0003ac20: 7061 7273 6520 636f 6d6d 616e 642d 6c69  parse command-li
-0003ac30: 6e65 2061 7267 756d 656e 7473 2727 270a  ne arguments'''.
-0003ac40: 0a20 2020 2070 6172 7365 7220 3d20 6172  .    parser = ar
-0003ac50: 6770 6172 7365 2e41 7267 756d 656e 7450  gparse.ArgumentP
-0003ac60: 6172 7365 7228 7072 6f67 3d27 6672 6f73  arser(prog='fros
-0003ac70: 7465 7220 272c 0a20 2020 2020 2020 2020  ter ',.         
-0003ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac90: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-0003aca0: 7269 7074 696f 6e3d 2741 2028 6d6f 7374  ription='A (most
-0003acb0: 6c79 2920 6175 746f 6d61 7465 6420 746f  ly) automated to
-0003acc0: 6f6c 2066 6f72 2061 7263 6869 7669 6e67  ol for archiving
-0003acd0: 206c 6172 6765 2073 6361 6c65 2064 6174   large scale dat
-0003ace0: 6120 2720 2b0a 2020 2020 2020 2020 2020  a ' +.          
-0003acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ad00: 2020 2020 2020 2020 2020 2027 6166 7465             'afte
-0003ad10: 7220 6669 6e64 696e 6720 666f 6c64 6572  r finding folder
-0003ad20: 7320 696e 2074 6865 2066 696c 6520 7379  s in the file sy
-0003ad30: 7374 656d 2074 6861 7420 6172 6520 776f  stem that are wo
-0003ad40: 7274 6820 6172 6368 6976 696e 672e 2729  rth archiving.')
-0003ad50: 0a0a 2020 2020 2320 2a2a 2a0a 0a20 2020  ..    # ***..   
-0003ad60: 2070 6172 7365 722e 6164 645f 6172 6775   parser.add_argu
-0003ad70: 6d65 6e74 2827 2d64 272c 2027 2d2d 6465  ment('-d', '--de
-0003ad80: 6275 6727 2c20 6465 7374 3d27 6465 6275  bug', dest='debu
-0003ad90: 6727 2c20 6163 7469 6f6e 3d27 7374 6f72  g', action='stor
-0003ada0: 655f 7472 7565 272c 2064 6566 6175 6c74  e_true', default
-0003adb0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0003adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003add0: 6865 6c70 3d22 7665 7262 6f73 6520 6f75  help="verbose ou
-0003ade0: 7470 7574 2066 6f72 2061 6c6c 2063 6f6d  tput for all com
-0003adf0: 6d61 6e64 7322 290a 2020 2020 7061 7273  mands").    pars
-0003ae00: 6572 2e61 6464 5f61 7267 756d 656e 7428  er.add_argument(
-0003ae10: 272d 6e27 2c20 272d 2d6e 6f2d 736c 7572  '-n', '--no-slur
-0003ae20: 6d27 2c20 6465 7374 3d27 6e6f 736c 7572  m', dest='noslur
-0003ae30: 6d27 2c20 6163 7469 6f6e 3d27 7374 6f72  m', action='stor
-0003ae40: 655f 7472 7565 272c 2064 6566 6175 6c74  e_true', default
-0003ae50: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0003ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ae70: 6865 6c70 3d22 646f 206e 6f74 2073 7562  help="do not sub
-0003ae80: 6d69 7420 6120 536c 7572 6d20 6a6f 622c  mit a Slurm job,
-0003ae90: 2065 7865 6375 7465 2069 6e20 7468 6520   execute in the 
-0003aea0: 666f 7265 6772 6f75 6e64 2e20 2229 0a20  foreground. "). 
-0003aeb0: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-0003aec0: 6775 6d65 6e74 2827 2d63 272c 2027 2d2d  gument('-c', '--
-0003aed0: 636f 7265 7327 2c20 6465 7374 3d27 636f  cores', dest='co
-0003aee0: 7265 7327 2c20 6163 7469 6f6e 3d27 7374  res', action='st
-0003aef0: 6f72 655f 7472 7565 272c 2064 6566 6175  ore_true', defau
-0003af00: 6c74 3d27 3427 2c0a 2020 2020 2020 2020  lt='4',.        
-0003af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af20: 6865 6c70 3d27 4e75 6d62 6572 206f 6620  help='Number of 
-0003af30: 636f 7265 7320 746f 2062 6520 616c 6c6f  cores to be allo
-0003af40: 6361 7465 6420 666f 7220 7468 6520 6d61  cated for the ma
-0003af50: 6368 696e 652e 2028 6465 6661 756c 743d  chine. (default=
-0003af60: 3429 2729 0a20 2020 2070 6172 7365 722e  4)').    parser.
-0003af70: 6164 645f 6172 6775 6d65 6e74 2827 2d70  add_argument('-p
-0003af80: 272c 2027 2d2d 7072 6f66 696c 6527 2c20  ', '--profile', 
-0003af90: 6465 7374 3d27 6177 735f 7072 6f66 696c  dest='aws_profil
-0003afa0: 6527 2c20 6163 7469 6f6e 3d27 7374 6f72  e', action='stor
-0003afb0: 655f 7472 7565 272c 2064 6566 6175 6c74  e_true', default
-0003afc0: 3d27 272c 0a20 2020 2020 2020 2020 2020  ='',.           
-0003afd0: 2020 2020 2020 2020 2020 2020 2068 656c               hel
-0003afe0: 703d 2777 6869 6368 2041 5753 2070 726f  p='which AWS pro
-0003aff0: 6669 6c65 2069 6e20 7e2f 2e61 7773 2f20  file in ~/.aws/ 
-0003b000: 7368 6f75 6c64 2062 6520 7573 6564 2e20  should be used. 
-0003b010: 6465 6661 756c 743d 2261 7773 2227 290a  default="aws"').
-0003b020: 2020 2020 7061 7273 6572 2e61 6464 5f61      parser.add_a
-0003b030: 7267 756d 656e 7428 272d 7627 2c20 272d  rgument('-v', '-
-0003b040: 2d76 6572 7369 6f6e 272c 2064 6573 743d  -version', dest=
-0003b050: 2776 6572 7369 6f6e 272c 2061 6374 696f  'version', actio
-0003b060: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
-0003b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b080: 2020 2020 2020 2020 6865 6c70 3d27 7072          help='pr
-0003b090: 696e 7420 6672 6f73 7465 7220 616e 6420  int froster and 
-0003b0a0: 7061 636b 6167 6573 2076 6572 7369 6f6e  packages version
-0003b0b0: 2069 6e66 6f27 290a 0a20 2020 2073 7562   info')..    sub
-0003b0c0: 7061 7273 6572 7320 3d20 7061 7273 6572  parsers = parser
-0003b0d0: 2e61 6464 5f73 7562 7061 7273 6572 7328  .add_subparsers(
-0003b0e0: 6465 7374 3d22 7375 6263 6d64 222c 2068  dest="subcmd", h
-0003b0f0: 656c 703d 2773 7562 2d63 6f6d 6d61 6e64  elp='sub-command
-0003b100: 2068 656c 7027 290a 0a20 2020 2023 202a   help')..    # *
-0003b110: 2a2a 0a0a 2020 2020 7061 7273 6572 5f63  **..    parser_c
-0003b120: 7265 6465 6e74 6961 6c73 203d 2073 7562  redentials = sub
-0003b130: 7061 7273 6572 732e 6164 645f 7061 7273  parsers.add_pars
-0003b140: 6572 2827 6372 6564 656e 7469 616c 7327  er('credentials'
-0003b150: 2c20 616c 6961 7365 733d 5b27 6372 6427  , aliases=['crd'
-0003b160: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0002dde0: 2070 7269 6e74 2866 274e 6f20 656e 7472   print(f'No entr
+0002ddf0: 7920 666f 756e 6420 696e 2066 726f 7374  y found in frost
+0002de00: 6572 2d61 7263 6869 7665 732e 6a73 6f6e  er-archives.json
+0002de10: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+0002de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de30: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+0002de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de50: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+0002de60: 636f 6e74 6169 6e73 5f6e 6f6e 5f66 726f  contains_non_fro
+0002de70: 7374 6572 5f66 696c 6573 2872 6f6f 7429  ster_files(root)
+0002de80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002de90: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0002dea0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0002deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dec0: 2020 2020 2066 275c 6e57 4152 4e49 4e47       f'\nWARNING
+0002ded0: 3a20 466f 6c64 6572 207b 726f 6f74 7d20  : Folder {root} 
+0002dee0: 636f 6e74 6169 6e73 206e 6f6e 2d66 726f  contains non-fro
+0002def0: 7374 6572 2066 696c 6573 2e20 506c 6561  ster files. Plea
+0002df00: 7365 2065 6d70 7479 2074 6865 2066 6f6c  se empty the fol
+0002df10: 6465 7220 6265 666f 7265 2072 6573 746f  der before resto
+0002df20: 7269 6e67 2e5c 6e27 290a 2020 2020 2020  ring.\n').      
+0002df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002df40: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+0002df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002df60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0002df70: 5f72 6573 746f 7265 5f6c 6f63 616c 6c79  _restore_locally
+0002df80: 2872 6f6f 742c 2061 7773 293a 0a0a 2020  (root, aws):..  
+0002df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dfa0: 2020 2020 2020 2020 2020 2320 4966 206e            # If n
+0002dfb0: 6f64 6f77 6e6c 6f61 6420 666c 6167 2069  odownload flag i
+0002dfc0: 7320 7365 7420 7765 2061 7265 2064 6f6e  s set we are don
+0002dfd0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002dfe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002dff0: 2073 656c 662e 6172 6773 2e6e 6f64 6f77   self.args.nodow
+0002e000: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
+0002e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e020: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0002e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e050: 2020 6627 5c6e 466f 6c64 6572 2072 6573    f'\nFolder res
+0002e060: 746f 7265 6420 6275 7420 6e6f 7420 646f  tored but not do
+0002e070: 776e 6c6f 6164 6564 2028 2d2d 6e6f 2d64  wnloaded (--no-d
+0002e080: 6f77 6e6c 6f61 6420 666c 6167 2073 6574  ownload flag set
+0002e090: 295c 6e27 290a 2020 2020 2020 2020 2020  )\n').          
+0002e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0b0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0002e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002e100: 656c 662e 5f64 6f77 6e6c 6f61 6428 726f  elf._download(ro
+0002e110: 6f74 290a 0a20 2020 2020 2020 2065 7863  ot)..        exc
+0002e120: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0002e130: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002e140: 5f65 7272 6f72 2829 0a0a 2020 2020 6465  _error()..    de
+0002e150: 6620 5f72 6573 746f 7265 5f76 6572 6966  f _restore_verif
+0002e160: 7928 7365 6c66 2c20 736f 7572 6365 2c20  y(self, source, 
+0002e170: 7461 7267 6574 293a 0a20 2020 2020 2020  target):.       
+0002e180: 2027 2727 5665 7269 6679 2074 6865 2072   '''Verify the r
+0002e190: 6573 746f 7265 6420 6669 6c65 7327 2727  estored files'''
+0002e1a0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0002e1b0: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
+0002e1c0: 6f74 2c20 6469 7273 2c20 6669 6c65 7320  ot, dirs, files 
+0002e1d0: 696e 2073 656c 662e 5f77 616c 6b65 7228  in self._walker(
+0002e1e0: 7461 7267 6574 293a 0a20 2020 2020 2020  target):.       
+0002e1f0: 2020 2020 2020 2020 2069 6620 726f 6f74           if root
+0002e200: 2021 3d20 7461 7267 6574 3a0a 2020 2020   != target:.    
+0002e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e220: 6272 6561 6b0a 0a20 2020 2020 2020 2020  break..         
+0002e230: 2020 2020 2020 2072 6573 7470 6174 6820         restpath 
+0002e240: 3d20 726f 6f74 0a20 2020 2020 2020 2020  = root.         
+0002e250: 2020 2020 2020 2069 6620 726f 6f74 2021         if root !
+0002e260: 3d20 7461 7267 6574 3a0a 2020 2020 2020  = target:.      
+0002e270: 2020 2020 2020 2020 2020 2020 2020 736f                so
+0002e280: 7572 6365 203d 2073 6f75 7263 6520 2b20  urce = source + 
+0002e290: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0002e2a0: 2872 6f6f 7429 202b 2027 2f27 0a0a 2020  (root) + '/'..  
+0002e2b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002e2c0: 4765 6e65 7261 7465 206d 6435 2063 6865  Generate md5 che
+0002e2d0: 636b 7375 6d73 2066 6f72 2061 6c6c 2066  cksums for all f
+0002e2e0: 696c 6573 2069 6e20 7468 6520 666f 6c64  iles in the fold
+0002e2f0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0002e300: 2020 2070 7269 6e74 2866 2747 656e 6572     print(f'Gener
+0002e310: 6174 696e 6720 6368 6563 6b73 756d 732e  ating checksums.
+0002e320: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
+0002e330: 2020 2020 2069 6620 7365 6c66 2e5f 6765       if self._ge
+0002e340: 6e5f 6d64 3573 756d 7328 7265 7374 7061  n_md5sums(restpa
+0002e350: 7468 2c20 7365 6c66 2e6d 6435 7375 6d5f  th, self.md5sum_
+0002e360: 7265 7374 6f72 6564 5f66 696c 656e 616d  restored_filenam
+0002e370: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0002e380: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+0002e390: 2020 202e 2e2e 646f 6e65 2729 0a20 2020     ...done').   
+0002e3a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002e3b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002e3c0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+0002e3d0: 2020 2e2e 2e46 4149 4c45 445c 6e27 290a    ...FAILED\n').
+0002e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e3f0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0002e400: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+0002e410: 7420 7468 6520 7061 7468 2074 6f20 7468  t the path to th
+0002e420: 6520 6861 7368 6669 6c65 0a20 2020 2020  e hashfile.     
+0002e430: 2020 2020 2020 2020 2020 2068 6173 6866             hashf
+0002e440: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
+0002e450: 696e 2872 6573 7470 6174 682c 2027 2e66  in(restpath, '.f
+0002e460: 726f 7374 6572 2d72 6573 746f 7265 642e  roster-restored.
+0002e470: 6d64 3573 756d 2729 0a0a 2020 2020 2020  md5sum')..      
+0002e480: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
+0002e490: 7465 2074 6865 2052 636c 6f6e 6520 6f62  te the Rclone ob
+0002e4a0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+0002e4b0: 2020 2020 2072 636c 6f6e 6520 3d20 5263       rclone = Rc
+0002e4c0: 6c6f 6e65 2873 656c 662e 6172 6773 2c20  lone(self.args, 
+0002e4d0: 7365 6c66 2e63 6667 290a 0a20 2020 2020  self.cfg)..     
+0002e4e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002e4f0: 2866 275c 6e56 6572 6966 7969 6e67 2063  (f'\nVerifying c
+0002e500: 6865 636b 7375 6d73 2e2e 2e27 290a 2020  hecksums...').  
+0002e510: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002e520: 2072 636c 6f6e 652e 6368 6563 6b73 756d   rclone.checksum
+0002e530: 2868 6173 6866 696c 652c 2073 6f75 7263  (hashfile, sourc
+0002e540: 652c 2027 2d2d 6d61 782d 6465 7074 6827  e, '--max-depth'
+0002e550: 2c20 2731 2729 3a0a 2020 2020 2020 2020  , '1'):.        
+0002e560: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002e570: 7428 2720 2020 202e 2e2e 646f 6e65 2729  t('    ...done')
+0002e580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e590: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002e5a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002e5b0: 2827 2020 2020 2e2e 2e46 4149 4c45 445c  ('    ...FAILED\
+0002e5c0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0002e5d0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0002e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e5f0: 2320 4368 6563 6b20 6966 2046 726f 7374  # Check if Frost
+0002e600: 6572 2e73 6d61 6c6c 6669 6c65 732e 7461  er.smallfiles.ta
+0002e610: 7220 6578 6973 7473 0a20 2020 2020 2020  r exists.       
+0002e620: 2020 2020 2020 2020 2074 6172 5f70 6174           tar_pat
+0002e630: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+0002e640: 2874 6172 6765 742c 2027 4672 6f73 7465  (target, 'Froste
+0002e650: 722e 736d 616c 6c66 696c 6573 2e74 6172  r.smallfiles.tar
+0002e660: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002e670: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+0002e680: 6973 7473 2874 6172 5f70 6174 6829 3a0a  ists(tar_path):.
+0002e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e6a0: 2020 2020 7072 696e 7428 6627 5c6e 556e      print(f'\nUn
+0002e6b0: 7461 7272 696e 6720 4672 6f73 7465 722e  tarring Froster.
+0002e6c0: 736d 616c 6c66 696c 6573 2e74 6172 2e2e  smallfiles.tar..
+0002e6d0: 2e20 2729 0a20 2020 2020 2020 2020 2020  . ').           
+0002e6e0: 2020 2020 2020 2020 2077 6974 6820 7461           with ta
+0002e6f0: 7266 696c 652e 6f70 656e 2874 6172 5f70  rfile.open(tar_p
+0002e700: 6174 682c 2022 7222 2920 6173 2074 6172  ath, "r") as tar
+0002e710: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002e720: 2020 2020 2020 2020 2020 7461 722e 6578            tar.ex
+0002e730: 7472 6163 7461 6c6c 2870 6174 683d 7461  tractall(path=ta
+0002e740: 7267 6574 290a 2020 2020 2020 2020 2020  rget).          
+0002e750: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
+0002e760: 6f76 6528 7461 725f 7061 7468 290a 2020  ove(tar_path).  
+0002e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e780: 2020 7072 696e 7428 2720 2020 202e 2e2e    print('    ...
+0002e790: 646f 6e65 5c6e 2729 0a0a 2020 2020 2020  done\n')..      
+0002e7a0: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
+0002e7b0: 6f76 6528 7365 6c66 2e77 6865 7265 5f64  ove(self.where_d
+0002e7c0: 6964 5f74 6865 5f66 696c 6573 5f67 6f5f  id_the_files_go_
+0002e7d0: 6669 6c65 6e61 6d65 290a 0a20 2020 2020  filename)..     
+0002e7e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002e7f0: 2866 2752 6573 746f 7261 7469 6f6e 206f  (f'Restoration o
+0002e800: 6620 7b72 6f6f 747d 2063 6f6d 706c 6574  f {root} complet
+0002e810: 6564 2073 7563 6365 7373 6675 6c6c 795c  ed successfully\
+0002e820: 6e27 290a 0a20 2020 2020 2020 2065 7863  n')..        exc
+0002e830: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0002e840: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002e850: 5f65 7272 6f72 2829 0a0a 2020 2020 6465  _error()..    de
+0002e860: 6620 6d64 3573 756d 6578 2873 656c 662c  f md5sumex(self,
+0002e870: 2066 696c 655f 7061 7468 293a 0a20 2020   file_path):.   
+0002e880: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0002e890: 2020 2020 2020 636d 6420 3d20 6627 6d64        cmd = f'md
+0002e8a0: 3573 756d 207b 6669 6c65 5f70 6174 687d  5sum {file_path}
+0002e8b0: 270a 2020 2020 2020 2020 2020 2020 7265  '.            re
+0002e8c0: 7420 3d20 7375 6270 726f 6365 7373 2e72  t = subprocess.r
+0002e8d0: 756e 2863 6d64 2c20 7374 646f 7574 3d73  un(cmd, stdout=s
+0002e8e0: 7562 7072 6f63 6573 732e 5049 5045 2c0a  ubprocess.PIPE,.
+0002e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e910: 2073 7464 6572 723d 7375 6270 726f 6365   stderr=subproce
+0002e920: 7373 2e50 4950 452c 2073 6865 6c6c 3d54  ss.PIPE, shell=T
+0002e930: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0002e940: 2069 6620 7265 742e 7265 7475 726e 636f   if ret.returnco
+0002e950: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
+0002e960: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0002e970: 276d 6435 7375 6d20 7265 7475 726e 2063  'md5sum return c
+0002e980: 6f64 6520 3e20 303a 207b 636d 647d 2045  ode > 0: {cmd} E
+0002e990: 7272 6f72 3a5c 6e7b 7265 742e 7374 6465  rror:\n{ret.stde
+0002e9a0: 7272 7d27 290a 2020 2020 2020 2020 2020  rr}').          
+0002e9b0: 2020 7265 7475 726e 2072 6574 2e73 7464    return ret.std
+0002e9c0: 6f75 742e 7374 7269 7028 2920 2023 202c  out.strip()  # ,
+0002e9d0: 2072 6574 2e73 7464 6572 722e 7374 7269   ret.stderr.stri
+0002e9e0: 7028 290a 0a20 2020 2020 2020 2065 7863  p()..        exc
+0002e9f0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0002ea00: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0002ea10: 7072 696e 7428 6627 6d64 3573 756d 2045  print(f'md5sum E
+0002ea20: 7272 6f72 3a20 7b73 7472 2865 297d 2729  rror: {str(e)}')
+0002ea30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002ea40: 7572 6e20 4e6f 6e65 2c20 7374 7228 6529  urn None, str(e)
+0002ea50: 0a0a 2020 2020 6465 6620 6d64 3573 756d  ..    def md5sum
+0002ea60: 2873 656c 662c 2066 696c 655f 7061 7468  (self, file_path
+0002ea70: 293a 0a20 2020 2020 2020 2027 2727 4361  ):.        '''Ca
+0002ea80: 6c63 756c 6174 6520 6d64 3573 756d 206f  lculate md5sum o
+0002ea90: 6620 6120 6669 6c65 2727 270a 0a20 2020  f a file'''..   
+0002eaa0: 2020 2020 206d 6435 5f68 6173 6820 3d20       md5_hash = 
+0002eab0: 6861 7368 6c69 622e 6d64 3528 290a 2020  hashlib.md5().  
+0002eac0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+0002ead0: 6669 6c65 5f70 6174 682c 2022 7262 2229  file_path, "rb")
+0002eae0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+0002eaf0: 2020 2066 6f72 2063 6875 6e6b 2069 6e20     for chunk in 
+0002eb00: 6974 6572 286c 616d 6264 613a 2066 2e72  iter(lambda: f.r
+0002eb10: 6561 6428 3430 3936 292c 2062 2222 293a  ead(4096), b""):
+0002eb20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002eb30: 206d 6435 5f68 6173 682e 7570 6461 7465   md5_hash.update
+0002eb40: 2863 6875 6e6b 290a 2020 2020 2020 2020  (chunk).        
+0002eb50: 7265 7475 726e 206d 6435 5f68 6173 682e  return md5_hash.
+0002eb60: 6865 7864 6967 6573 7428 290a 0a20 2020  hexdigest()..   
+0002eb70: 2064 6566 2075 6964 3275 7365 7228 7365   def uid2user(se
+0002eb80: 6c66 2c20 7569 6429 3a0a 2020 2020 2020  lf, uid):.      
+0002eb90: 2020 2320 7472 7920 746f 2063 6f6e 7665    # try to conve
+0002eba0: 7274 2075 6964 2074 6f20 7573 6572 206e  rt uid to user n
+0002ebb0: 616d 650a 2020 2020 2020 2020 7472 793a  ame.        try:
+0002ebc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002ebd0: 7572 6e20 7077 642e 6765 7470 7775 6964  urn pwd.getpwuid
+0002ebe0: 2875 6964 295b 305d 0a20 2020 2020 2020  (uid)[0].       
+0002ebf0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+0002ec00: 2020 2020 2070 7269 6e74 6462 6728 6627       printdbg(f'
+0002ec10: 7569 6432 7573 6572 3a20 4572 726f 7220  uid2user: Error 
+0002ec20: 636f 6e76 6572 7469 6e67 2075 6964 207b  converting uid {
+0002ec30: 7569 647d 2729 0a20 2020 2020 2020 2020  uid}').         
+0002ec40: 2020 2072 6574 7572 6e20 7569 640a 0a20     return uid.. 
+0002ec50: 2020 2064 6566 2067 6964 3267 726f 7570     def gid2group
+0002ec60: 2873 656c 662c 2067 6964 293a 0a20 2020  (self, gid):.   
+0002ec70: 2020 2020 2023 2074 7279 2074 6f20 636f       # try to co
+0002ec80: 6e76 6572 7420 6769 6420 746f 2067 726f  nvert gid to gro
+0002ec90: 7570 206e 616d 650a 2020 2020 2020 2020  up name.        
+0002eca0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0002ecb0: 2072 6574 7572 6e20 6772 702e 6765 7467   return grp.getg
+0002ecc0: 7267 6964 2867 6964 295b 305d 0a20 2020  rgid(gid)[0].   
+0002ecd0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+0002ece0: 2020 2020 2020 2020 2070 7269 6e74 6462           printdb
+0002ecf0: 6728 6627 6769 6432 6772 6f75 703a 2045  g(f'gid2group: E
+0002ed00: 7272 6f72 2063 6f6e 7665 7274 696e 6720  rror converting 
+0002ed10: 6769 6420 7b67 6964 7d27 290a 2020 2020  gid {gid}').    
+0002ed20: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+0002ed30: 6964 0a0a 2020 2020 6465 6620 6461 7973  id..    def days
+0002ed40: 6167 6f28 7365 6c66 2c20 756e 6978 7469  ago(self, unixti
+0002ed50: 6d65 293a 0a20 2020 2020 2020 2023 2068  me):.        # h
+0002ed60: 6f77 206d 616e 7920 6461 7973 2061 676f  ow many days ago
+0002ed70: 2069 7320 7468 6973 2065 706f 6368 2074   is this epoch t
+0002ed80: 696d 6520 3f0a 2020 2020 2020 2020 6966  ime ?.        if
+0002ed90: 206e 6f74 2075 6e69 7874 696d 653a 0a20   not unixtime:. 
+0002eda0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002edb0: 6462 6728 0a20 2020 2020 2020 2020 2020  dbg(.           
+0002edc0: 2020 2020 2027 6461 7973 6167 6f3a 2061       'daysago: a
+0002edd0: 6e20 696e 7465 6765 7220 6973 2072 6571  n integer is req
+0002ede0: 7569 7265 6420 2867 6f74 2074 7970 6520  uired (got type 
+0002edf0: 4e6f 6e65 5479 7065 2927 290a 2020 2020  NoneType)').    
+0002ee00: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
+0002ee10: 0a20 2020 2020 2020 2064 6966 6620 3d20  .        diff = 
+0002ee20: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+0002ee30: 652e 6e6f 7728 292d 6461 7465 7469 6d65  e.now()-datetime
+0002ee40: 2e64 6174 6574 696d 652e 6672 6f6d 7469  .datetime.fromti
+0002ee50: 6d65 7374 616d 7028 756e 6978 7469 6d65  mestamp(unixtime
+0002ee60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0002ee70: 2064 6966 662e 6461 7973 0a0a 2020 2020   diff.days..    
+0002ee80: 6465 6620 636f 6e76 6572 745f 7369 7a65  def convert_size
+0002ee90: 2873 656c 662c 2073 697a 655f 6279 7465  (self, size_byte
+0002eea0: 7329 3a0a 2020 2020 2020 2020 6966 2073  s):.        if s
+0002eeb0: 697a 655f 6279 7465 7320 3d3d 2030 3a0a  ize_bytes == 0:.
+0002eec0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002eed0: 726e 2022 3042 220a 2020 2020 2020 2020  rn "0B".        
+0002eee0: 7369 7a65 5f6e 616d 6520 3d20 2822 4222  size_name = ("B"
+0002eef0: 2c20 224b 6942 222c 2022 4d69 4222 2c20  , "KiB", "MiB", 
+0002ef00: 2247 6942 222c 2022 5469 4222 2c20 2250  "GiB", "TiB", "P
+0002ef10: 6942 222c 2022 4569 4222 290a 2020 2020  iB", "EiB").    
+0002ef20: 2020 2020 6920 3d20 696e 7428 6d61 7468      i = int(math
+0002ef30: 2e66 6c6f 6f72 286d 6174 682e 6c6f 6728  .floor(math.log(
+0002ef40: 7369 7a65 5f62 7974 6573 2c20 3130 3234  size_bytes, 1024
+0002ef50: 2929 290a 2020 2020 2020 2020 7020 3d20  ))).        p = 
+0002ef60: 6d61 7468 2e70 6f77 2831 3032 342c 2069  math.pow(1024, i
+0002ef70: 290a 2020 2020 2020 2020 7320 3d20 726f  ).        s = ro
+0002ef80: 756e 6428 7369 7a65 5f62 7974 6573 2f70  und(size_bytes/p
+0002ef90: 2c20 3329 0a20 2020 2020 2020 2072 6574  , 3).        ret
+0002efa0: 7572 6e20 6622 7b73 7d20 7b73 697a 655f  urn f"{s} {size_
+0002efb0: 6e61 6d65 5b69 5d7d 220a 0a20 2020 2064  name[i]}"..    d
+0002efc0: 6566 205f 6172 6368 6976 655f 6a73 6f6e  ef _archive_json
+0002efd0: 5f61 6464 5f65 6e74 7279 2873 656c 662c  _add_entry(self,
+0002efe0: 206b 6579 2c20 7661 6c75 6529 3a0a 2020   key, value):.  
+0002eff0: 2020 2020 2020 2727 2741 6464 2061 206e        '''Add a n
+0002f000: 6577 2065 6e74 7279 2074 6f20 7468 6520  ew entry to the 
+0002f010: 6172 6368 6976 6520 4a53 4f4e 2066 696c  archive JSON fil
+0002f020: 6527 2727 0a20 2020 2020 2020 2074 7279  e'''.        try
+0002f030: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002f040: 2049 6e69 7469 616c 697a 6520 7468 6520   Initialize the 
+0002f050: 6461 7461 2064 6963 7469 6f6e 6172 7920  data dictionary 
+0002f060: 696e 2063 6173 6520 6172 6368 6976 655f  in case archive_
+0002f070: 6a73 6f6e 2064 6f65 7320 6e6f 7420 6578  json does not ex
+0002f080: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+0002f090: 6461 7461 203d 207b 7d0a 0a20 2020 2020  data = {}..     
+0002f0a0: 2020 2020 2020 2023 2052 6561 6420 7468         # Read th
+0002f0b0: 6520 6172 6368 6976 6520 4a53 4f4e 2066  e archive JSON f
+0002f0c0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+0002f0d0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+0002f0e0: 6528 7365 6c66 2e61 7263 6869 7665 5f6a  e(self.archive_j
+0002f0f0: 736f 6e29 3a0a 2020 2020 2020 2020 2020  son):.          
+0002f100: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+0002f110: 7365 6c66 2e61 7263 6869 7665 5f6a 736f  self.archive_jso
+0002f120: 6e2c 2027 7227 2920 6173 2066 696c 653a  n, 'r') as file:
+0002f130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f140: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0002f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f160: 2020 6461 7461 203d 206a 736f 6e2e 6c6f    data = json.lo
+0002f170: 6164 2866 696c 6529 0a20 2020 2020 2020  ad(file).       
+0002f180: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0002f190: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0002f1a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0002f1b0: 6e74 2827 4572 726f 7220 696e 2041 7263  nt('Error in Arc
+0002f1c0: 6869 7665 722e 5f61 7263 6869 7665 5f6a  hiver._archive_j
+0002f1d0: 736f 6e5f 6164 645f 656e 7472 7928 293a  son_add_entry():
+0002f1e0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002f1f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002f200: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002f210: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0002f220: 4361 6e6e 6f74 2072 6561 6420 7b73 656c  Cannot read {sel
+0002f230: 662e 6172 6368 6976 655f 6a73 6f6e 7d2c  f.archive_json},
+0002f240: 2066 696c 6520 636f 7272 7570 743f 2729   file corrupt?')
+0002f250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f260: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0002f270: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+0002f280: 6464 2074 6865 206e 6577 2065 6e74 7279  dd the new entry
+0002f290: 2074 6f20 7468 6520 6461 7461 2064 6963   to the data dic
+0002f2a0: 7469 6f6e 6172 790a 2020 2020 2020 2020  tionary.        
+0002f2b0: 2020 2020 6461 7461 5b6b 6579 5d20 3d20      data[key] = 
+0002f2c0: 7661 6c75 650a 0a20 2020 2020 2020 2020  value..         
+0002f2d0: 2020 2023 2043 7265 6174 6520 7468 6520     # Create the 
+0002f2e0: 6469 7265 6374 6f72 7920 666f 7220 7468  directory for th
+0002f2f0: 6520 6172 6368 6976 6520 4a53 4f4e 2066  e archive JSON f
+0002f300: 696c 6520 6966 2069 7420 646f 6573 206e  ile if it does n
+0002f310: 6f74 2065 7869 7374 0a20 2020 2020 2020  ot exist.       
+0002f320: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
+0002f330: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
+0002f340: 2873 656c 662e 6172 6368 6976 655f 6a73  (self.archive_js
+0002f350: 6f6e 292c 2065 7869 7374 5f6f 6b3d 5472  on), exist_ok=Tr
+0002f360: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
+0002f370: 2023 2057 7269 7465 2074 6865 2075 7064   # Write the upd
+0002f380: 6174 6564 2064 6174 6120 6469 6374 696f  ated data dictio
+0002f390: 6e61 7279 2074 6f20 7468 6520 6172 6368  nary to the arch
+0002f3a0: 6976 6520 4a53 4f4e 2066 696c 650a 2020  ive JSON file.  
+0002f3b0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0002f3c0: 7065 6e28 7365 6c66 2e61 7263 6869 7665  pen(self.archive
+0002f3d0: 5f6a 736f 6e2c 2027 7727 2920 6173 2066  _json, 'w') as f
+0002f3e0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0002f3f0: 2020 2020 206a 736f 6e2e 6475 6d70 2864       json.dump(d
+0002f400: 6174 612c 2066 696c 652c 2069 6e64 656e  ata, file, inden
+0002f410: 743d 3429 0a20 2020 2020 2020 2065 7863  t=4).        exc
+0002f420: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0002f430: 2070 7269 6e74 5f65 7272 6f72 2829 0a0a   print_error()..
+0002f440: 2020 2020 6465 6620 5f69 735f 666f 6c64      def _is_fold
+0002f450: 6572 5f61 7263 6869 7665 6428 7365 6c66  er_archived(self
+0002f460: 2c20 666f 6c64 6572 293a 0a20 2020 2020  , folder):.     
+0002f470: 2020 2027 2727 4368 6563 6b20 6966 2061     '''Check if a
+0002f480: 6e20 656e 7472 7920 6578 6973 7473 2069  n entry exists i
+0002f490: 6e20 7468 6520 6172 6368 6976 6520 4a53  n the archive JS
+0002f4a0: 4f4e 2066 696c 6527 2727 0a0a 2020 2020  ON file'''..    
+0002f4b0: 2020 2020 7265 7475 726e 2028 7365 6c66      return (self
+0002f4c0: 2e66 726f 7374 6572 5f61 7263 6869 7665  .froster_archive
+0002f4d0: 735f 6765 745f 656e 7472 7928 666f 6c64  s_get_entry(fold
+0002f4e0: 6572 2920 213d 204e 6f6e 6529 0a0a 2020  er) != None)..  
+0002f4f0: 2020 6465 6620 6172 6368 6976 655f 6765    def archive_ge
+0002f500: 745f 6275 636b 6574 5f69 6e66 6f28 7365  t_bucket_info(se
+0002f510: 6c66 2c20 666f 6c64 6572 293a 0a20 2020  lf, folder):.   
+0002f520: 2020 2020 2027 2727 4765 7420 7468 6520       '''Get the 
+0002f530: 6275 636b 6574 2061 6e64 2070 7265 6669  bucket and prefi
+0002f540: 7820 6f66 2061 6e20 6172 6368 6976 6564  x of an archived
+0002f550: 2066 6f6c 6465 7227 2727 0a0a 2020 2020   folder'''..    
+0002f560: 2020 2020 6973 5f67 6c61 6369 6572 203d      is_glacier =
+0002f570: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
+0002f580: 735f 7265 6375 7273 6976 6520 3d20 4661  s_recursive = Fa
+0002f590: 6c73 650a 0a20 2020 2020 2020 2023 2047  lse..        # G
+0002f5a0: 6574 2074 6865 2066 6f6c 6465 7220 6172  et the folder ar
+0002f5b0: 6368 6976 696e 6720 696e 666f 2066 726f  chiving info fro
+0002f5c0: 6d20 6672 6f73 7465 722d 6172 6368 6976  m froster-archiv
+0002f5d0: 6573 2e6a 736f 6e20 6669 6c65 0a20 2020  es.json file.   
+0002f5e0: 2020 2020 2061 7263 6869 7665 5f66 6f6c       archive_fol
+0002f5f0: 6465 725f 696e 666f 203d 2073 656c 662e  der_info = self.
+0002f600: 6672 6f73 7465 725f 6172 6368 6976 6573  froster_archives
+0002f610: 5f67 6574 5f65 6e74 7279 2866 6f6c 6465  _get_entry(folde
+0002f620: 7229 0a0a 2020 2020 2020 2020 2320 4368  r)..        # Ch
+0002f630: 6563 6b20 7468 6520 666f 6c64 6572 2069  eck the folder i
+0002f640: 7320 6172 6368 6976 6564 0a20 2020 2020  s archived.     
+0002f650: 2020 2069 6620 6e6f 7420 6172 6368 6976     if not archiv
+0002f660: 655f 666f 6c64 6572 5f69 6e66 6f3a 0a20  e_folder_info:. 
+0002f670: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002f680: 2866 275c 6e46 6f6c 6465 7220 7b66 6f6c  (f'\nFolder {fol
+0002f690: 6465 727d 2069 7320 6e6f 7420 7265 6769  der} is not regi
+0002f6a0: 7374 6572 6564 2061 7320 6172 6368 6976  stered as archiv
+0002f6b0: 6564 2729 0a20 2020 2020 2020 2020 2020  ed').           
+0002f6c0: 2072 6574 7572 6e20 4e6f 6e65 2c20 4e6f   return None, No
+0002f6d0: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ne, None, None, 
+0002f6e0: 4e6f 6e65 2c20 4e6f 6e65 0a0a 2020 2020  None, None..    
+0002f6f0: 2020 2020 2320 4765 7420 7468 6520 6172      # Get the ar
+0002f700: 6368 6976 6520 666f 6c64 6572 0a20 2020  chive folder.   
+0002f710: 2020 2020 206c 6f63 616c 5f66 6f6c 6465       local_folde
+0002f720: 7220 3d20 6172 6368 6976 655f 666f 6c64  r = archive_fold
+0002f730: 6572 5f69 6e66 6f5b 276c 6f63 616c 5f66  er_info['local_f
+0002f740: 6f6c 6465 7227 5d0a 2020 2020 2020 2020  older'].        
+0002f750: 6172 6368 6976 655f 666f 6c64 6572 203d  archive_folder =
+0002f760: 2061 7263 6869 7665 5f66 6f6c 6465 725f   archive_folder_
+0002f770: 696e 666f 5b27 6172 6368 6976 655f 666f  info['archive_fo
+0002f780: 6c64 6572 275d 0a20 2020 2020 2020 2073  lder'].        s
+0002f790: 335f 7374 6f72 6167 655f 636c 6173 7320  3_storage_class 
+0002f7a0: 3d20 6172 6368 6976 655f 666f 6c64 6572  = archive_folder
+0002f7b0: 5f69 6e66 6f5b 2773 335f 7374 6f72 6167  _info['s3_storag
+0002f7c0: 655f 636c 6173 7327 5d0a 2020 2020 2020  e_class'].      
+0002f7d0: 2020 7072 6f66 696c 6520 3d20 6172 6368    profile = arch
+0002f7e0: 6976 655f 666f 6c64 6572 5f69 6e66 6f5b  ive_folder_info[
+0002f7f0: 2770 726f 6669 6c65 275d 0a20 2020 2020  'profile'].     
+0002f800: 2020 2061 7263 6869 7665 5f6d 6f64 6520     archive_mode 
+0002f810: 3d20 6172 6368 6976 655f 666f 6c64 6572  = archive_folder
+0002f820: 5f69 6e66 6f5b 2761 7263 6869 7665 5f6d  _info['archive_m
+0002f830: 6f64 6527 5d0a 2020 2020 2020 2020 7573  ode'].        us
+0002f840: 6572 203d 2061 7263 6869 7665 5f66 6f6c  er = archive_fol
+0002f850: 6465 725f 696e 666f 5b27 7573 6572 275d  der_info['user']
+0002f860: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
+0002f870: 7468 6520 6275 636b 6574 2061 6e64 2070  the bucket and p
+0002f880: 7265 6669 780a 2020 2020 2020 2020 6275  refix.        bu
+0002f890: 636b 6574 2c20 7072 6566 6978 203d 2061  cket, prefix = a
+0002f8a0: 7263 6869 7665 5f66 6f6c 6465 722e 7370  rchive_folder.sp
+0002f8b0: 6c69 7428 272f 272c 2031 290a 0a20 2020  lit('/', 1)..   
+0002f8c0: 2020 2020 2023 2043 6c65 616e 2062 7563       # Clean buc
+0002f8d0: 6b65 740a 2020 2020 2020 2020 6275 636b  ket.        buck
+0002f8e0: 6574 203d 2062 7563 6b65 742e 7265 706c  et = bucket.repl
+0002f8f0: 6163 6528 273a 7333 3a27 2c20 2727 290a  ace(':s3:', '').
+0002f900: 0a20 2020 2020 2020 2023 2043 6c65 616e  .        # Clean
+0002f910: 2070 7265 6669 7820 736f 2069 7420 776f   prefix so it wo
+0002f920: 726b 7320 6576 656e 2069 6620 666f 6c64  rks even if fold
+0002f930: 6572 2069 7320 6120 7375 6266 6f6c 6465  er is a subfolde
+0002f940: 7220 6f66 2061 6e20 7374 6f72 6564 2070  r of an stored p
+0002f950: 6172 656e 740a 2020 2020 2020 2020 7072  arent.        pr
+0002f960: 6566 6978 203d 2070 7265 6669 782e 7265  efix = prefix.re
+0002f970: 706c 6163 6528 6c6f 6361 6c5f 666f 6c64  place(local_fold
+0002f980: 6572 2c20 2727 290a 2020 2020 2020 2020  er, '').        
+0002f990: 7072 6566 6978 203d 2070 7265 6669 7820  prefix = prefix 
+0002f9a0: 2b20 666f 6c64 6572 202b 2027 2f27 0a0a  + folder + '/'..
+0002f9b0: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
+0002f9c0: 6520 6172 6368 6976 6564 206d 6f64 650a  e archived mode.
+0002f9d0: 2020 2020 2020 2020 6966 2061 7263 6869          if archi
+0002f9e0: 7665 5f6d 6f64 6520 3d3d 2022 5265 6375  ve_mode == "Recu
+0002f9f0: 7273 6976 6522 3a0a 2020 2020 2020 2020  rsive":.        
+0002fa00: 2020 2020 6973 5f72 6563 7572 7369 7665      is_recursive
+0002fa10: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+0002fa20: 2023 2047 6574 2074 6865 2053 3320 7374   # Get the S3 st
+0002fa30: 6f72 6167 6520 636c 6173 730a 2020 2020  orage class.    
+0002fa40: 2020 2020 6966 2073 335f 7374 6f72 6167      if s3_storag
+0002fa50: 655f 636c 6173 7320 696e 205b 2744 4545  e_class in ['DEE
+0002fa60: 505f 4152 4348 4956 4527 2c20 2747 4c41  P_ARCHIVE', 'GLA
+0002fa70: 4349 4552 275d 3a0a 2020 2020 2020 2020  CIER']:.        
+0002fa80: 2020 2020 6973 5f67 6c61 6369 6572 203d      is_glacier =
+0002fa90: 2054 7275 650a 0a20 2020 2020 2020 2072   True..        r
+0002faa0: 6574 7572 6e20 6275 636b 6574 2c20 7072  eturn bucket, pr
+0002fab0: 6566 6978 2c20 6973 5f72 6563 7572 7369  efix, is_recursi
+0002fac0: 7665 2c20 6973 5f67 6c61 6369 6572 2c20  ve, is_glacier, 
+0002fad0: 7072 6f66 696c 652c 2075 7365 720a 0a20  profile, user.. 
+0002fae0: 2020 2064 6566 2066 726f 7374 6572 5f61     def froster_a
+0002faf0: 7263 6869 7665 735f 6765 745f 656e 7472  rchives_get_entr
+0002fb00: 7928 7365 6c66 2c20 666f 6c64 6572 293a  y(self, folder):
+0002fb10: 0a20 2020 2020 2020 2027 2727 4765 7420  .        '''Get 
+0002fb20: 616e 2065 6e74 7279 2066 726f 6d20 7468  an entry from th
+0002fb30: 6520 6172 6368 6976 6520 4a53 4f4e 2066  e archive JSON f
+0002fb40: 696c 6527 2727 0a0a 2020 2020 2020 2020  ile'''..        
+0002fb50: 2320 4966 2074 6865 2061 7263 6869 7665  # If the archive
+0002fb60: 204a 534f 4e20 6669 6c65 2064 6f65 7320   JSON file does 
+0002fb70: 6e6f 7420 6578 6973 742c 2074 6865 2065  not exist, the e
+0002fb80: 6e74 7279 2064 6f65 7320 6e6f 7420 6578  ntry does not ex
+0002fb90: 6973 740a 2020 2020 2020 2020 6966 206e  ist.        if n
+0002fba0: 6f74 206f 732e 7061 7468 2e69 7366 696c  ot os.path.isfil
+0002fbb0: 6528 7365 6c66 2e61 7263 6869 7665 5f6a  e(self.archive_j
+0002fbc0: 736f 6e29 3a0a 2020 2020 2020 2020 2020  son):.          
+0002fbd0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+0002fbe0: 2020 2020 2020 2023 2052 6561 6420 7468         # Read th
+0002fbf0: 6520 6172 6368 6976 6520 4a53 4f4e 2066  e archive JSON f
+0002fc00: 696c 650a 2020 2020 2020 2020 7769 7468  ile.        with
+0002fc10: 206f 7065 6e28 7365 6c66 2e61 7263 6869   open(self.archi
+0002fc20: 7665 5f6a 736f 6e2c 2027 7227 2920 6173  ve_json, 'r') as
+0002fc30: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
+0002fc40: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0002fc50: 2020 2020 2020 2020 6461 7461 203d 206a          data = j
+0002fc60: 736f 6e2e 6c6f 6164 2866 696c 6529 0a20  son.load(file). 
+0002fc70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0002fc80: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0002fc90: 2020 2070 7269 6e74 2827 4572 726f 7220     print('Error 
+0002fca0: 696e 2041 7263 6869 7665 722e 5f61 7263  in Archiver._arc
+0002fcb0: 6869 7665 5f6a 736f 6e5f 656e 7472 795f  hive_json_entry_
+0002fcc0: 6578 6973 7473 2829 3a27 290a 2020 2020  exists():').    
+0002fcd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002fce0: 7428 6627 4361 6e6e 6f74 2072 6561 6420  t(f'Cannot read 
+0002fcf0: 7b73 656c 662e 6172 6368 6976 655f 6a73  {self.archive_js
+0002fd00: 6f6e 7d2c 2066 696c 6520 636f 7272 7570  on}, file corrup
+0002fd10: 743f 2729 0a20 2020 2020 2020 2020 2020  t?').           
+0002fd20: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0002fd30: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+0002fd40: 6b20 6966 2074 6865 2065 6e74 7279 2065  k if the entry e
+0002fd50: 7869 7374 7320 696e 2074 6865 2064 6174  xists in the dat
+0002fd60: 6120 6469 6374 696f 6e61 7279 0a20 2020  a dictionary.   
+0002fd70: 2020 2020 2069 6620 666f 6c64 6572 2069       if folder i
+0002fd80: 6e20 6461 7461 3a0a 2020 2020 2020 2020  n data:.        
+0002fd90: 2020 2020 7265 7475 726e 2064 6174 615b      return data[
+0002fda0: 666f 6c64 6572 5d0a 2020 2020 2020 2020  folder].        
+0002fdb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002fdc0: 2020 2320 4368 6563 6b20 6966 2061 2070    # Check if a p
+0002fdd0: 6172 656e 7420 666f 6c64 6572 2065 7869  arent folder exi
+0002fde0: 7374 7320 696e 2074 6865 2064 6174 6120  sts in the data 
+0002fdf0: 6469 6374 696f 6e61 7279 2077 6974 6820  dictionary with 
+0002fe00: 7265 6375 7273 6976 6520 6172 6368 6976  recursive archiv
+0002fe10: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0002fe20: 7061 7468 203d 2050 6174 6828 666f 6c64  path = Path(fold
+0002fe30: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
+0002fe40: 2066 6f72 2070 6172 656e 7420 696e 2070   for parent in p
+0002fe50: 6174 682e 7061 7265 6e74 733a 0a20 2020  ath.parents:.   
+0002fe60: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0002fe70: 656e 7420 3d20 7374 7228 7061 7265 6e74  ent = str(parent
+0002fe80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002fe90: 2020 6966 2070 6172 656e 7420 696e 2064    if parent in d
+0002fea0: 6174 6120 616e 6420 6461 7461 5b70 6172  ata and data[par
+0002feb0: 656e 745d 5b27 6172 6368 6976 655f 6d6f  ent]['archive_mo
+0002fec0: 6465 275d 203d 3d20 2752 6563 7572 7369  de'] == 'Recursi
+0002fed0: 7665 273a 0a20 2020 2020 2020 2020 2020  ve':.           
+0002fee0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002fef0: 6461 7461 5b70 6172 656e 745d 0a0a 2020  data[parent]..  
+0002ff00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002ff10: 204e 6f6e 650a 0a20 2020 2064 6566 2061   None..    def a
+0002ff20: 7263 6869 7665 5f6a 736f 6e5f 6765 745f  rchive_json_get_
+0002ff30: 6373 7628 7365 6c66 2c20 636f 6c75 6d6e  csv(self, column
+0002ff40: 7329 3a0a 0a20 2020 2020 2020 2069 6620  s):..        if 
+0002ff50: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0002ff60: 7473 2873 656c 662e 6172 6368 6976 655f  ts(self.archive_
+0002ff70: 6a73 6f6e 293a 0a20 2020 2020 2020 2020  json):.         
+0002ff80: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0002ff90: 2020 2077 6974 6820 6f70 656e 2873 656c     with open(sel
+0002ffa0: 662e 6172 6368 6976 655f 6a73 6f6e 2c20  f.archive_json, 
+0002ffb0: 2772 2729 2061 7320 6669 6c65 3a0a 2020  'r') as file:.  
+0002ffc0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0002ffd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002ffe0: 6174 6120 3d20 6a73 6f6e 2e6c 6f61 6428  ata = json.load(
+0002fff0: 6669 6c65 290a 0a20 2020 2020 2020 2020  file)..         
+00030000: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+00030010: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00030020: 2827 4572 726f 7220 696e 2041 7263 6869  ('Error in Archi
+00030030: 7665 722e 5f61 7263 6869 7665 5f6a 736f  ver._archive_jso
+00030040: 6e5f 6765 745f 6373 7628 293a 2729 0a20  n_get_csv():'). 
+00030050: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00030060: 7269 6e74 2866 2743 616e 6e6f 7420 7265  rint(f'Cannot re
+00030070: 6164 207b 7365 6c66 2e61 7263 6869 7665  ad {self.archive
+00030080: 5f6a 736f 6e7d 2c20 6669 6c65 2063 6f72  _json}, file cor
+00030090: 7275 7074 3f27 290a 2020 2020 2020 2020  rupt?').        
+000300a0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+000300b0: 2020 2020 2020 2020 2320 536f 7274 2064          # Sort d
+000300c0: 6174 6120 6279 2074 696d 6573 7461 6d70  ata by timestamp
+000300d0: 2069 6e20 7265 7665 7273 6520 6f72 6465   in reverse orde
+000300e0: 720a 2020 2020 2020 2020 736f 7274 6564  r.        sorted
+000300f0: 5f64 6174 6120 3d20 736f 7274 6564 280a  _data = sorted(.
+00030100: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00030110: 2e69 7465 6d73 2829 2c20 6b65 793d 6c61  .items(), key=la
+00030120: 6d62 6461 2078 3a20 785b 315d 5b27 7469  mbda x: x[1]['ti
+00030130: 6d65 7374 616d 7027 5d2c 2072 6576 6572  mestamp'], rever
+00030140: 7365 3d54 7275 6529 0a0a 2020 2020 2020  se=True)..      
+00030150: 2020 2320 5072 6570 6172 6520 4353 5620    # Prepare CSV 
+00030160: 6461 7461 0a20 2020 2020 2020 2063 7376  data.        csv
+00030170: 5f64 6174 6120 3d20 5b63 6f6c 756d 6e73  _data = [columns
+00030180: 5d0a 0a20 2020 2020 2020 2066 6f72 2070  ]..        for p
+00030190: 6174 685f 6e61 6d65 2c20 726f 775f 6461  ath_name, row_da
+000301a0: 7461 2069 6e20 736f 7274 6564 5f64 6174  ta in sorted_dat
+000301b0: 613a 0a20 2020 2020 2020 2020 2020 2063  a:.            c
+000301c0: 7376 5f72 6f77 203d 205b 726f 775f 6461  sv_row = [row_da
+000301d0: 7461 5b63 6f6c 5d20 666f 7220 636f 6c20  ta[col] for col 
+000301e0: 696e 2063 6f6c 756d 6e73 2069 6620 636f  in columns if co
+000301f0: 6c20 696e 2072 6f77 5f64 6174 615d 0a20  l in row_data]. 
+00030200: 2020 2020 2020 2020 2020 2063 7376 5f64             csv_d
+00030210: 6174 612e 6170 7065 6e64 2863 7376 5f72  ata.append(csv_r
+00030220: 6f77 290a 0a20 2020 2020 2020 2023 2043  ow)..        # C
+00030230: 6f6e 7665 7274 2043 5356 2064 6174 6120  onvert CSV data 
+00030240: 746f 2061 2043 5356 2073 7472 696e 670a  to a CSV string.
+00030250: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+00030260: 2069 6f2e 5374 7269 6e67 494f 2829 0a0a   io.StringIO()..
+00030270: 2020 2020 2020 2020 7772 6974 6572 203d          writer =
+00030280: 2063 7376 2e77 7269 7465 7228 6f75 7470   csv.writer(outp
+00030290: 7574 2c20 6469 616c 6563 743d 2765 7863  ut, dialect='exc
+000302a0: 656c 2729 0a20 2020 2020 2020 2077 7269  el').        wri
+000302b0: 7465 722e 7772 6974 6572 6f77 7328 6373  ter.writerows(cs
+000302c0: 765f 6461 7461 290a 2020 2020 2020 2020  v_data).        
+000302d0: 6373 765f 7374 7269 6e67 203d 206f 7574  csv_string = out
+000302e0: 7075 742e 6765 7476 616c 7565 2829 0a0a  put.getvalue()..
+000302f0: 2020 2020 2020 2020 6f75 7470 7574 2e63          output.c
+00030300: 6c6f 7365 2829 0a0a 2020 2020 2020 2020  lose()..        
+00030310: 7265 7475 726e 2063 7376 5f73 7472 696e  return csv_strin
+00030320: 670a 0a20 2020 2064 6566 205f 6765 745f  g..    def _get_
+00030330: 6e65 7765 7374 5f66 696c 655f 6174 696d  newest_file_atim
+00030340: 6528 7365 6c66 2c20 666f 6c64 6572 5f70  e(self, folder_p
+00030350: 6174 682c 2066 6f6c 6465 725f 6174 696d  ath, folder_atim
+00030360: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+00030370: 2023 2042 6563 6175 7365 2074 6865 2066   # Because the f
+00030380: 6f6c 6465 7220 6174 696d 6520 6973 2072  older atime is r
+00030390: 6573 6574 2077 6865 6e20 6372 6177 6c69  eset when crawli
+000303a0: 6e67 2077 6520 6e65 6564 0a20 2020 2020  ng we need.     
+000303b0: 2020 2023 2074 6f20 6c6f 6f6b 7570 2074     # to lookup t
+000303c0: 6865 2061 7469 6d65 206f 6620 7468 6520  he atime of the 
+000303d0: 6c61 7374 2061 6363 6573 7365 6420 6669  last accessed fi
+000303e0: 6c65 2069 6e20 7468 6973 2066 6f6c 6465  le in this folde
+000303f0: 720a 2020 2020 2020 2020 6966 206e 6f74  r.        if not
+00030400: 2066 6f6c 6465 725f 7061 7468 206f 7220   folder_path or 
+00030410: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00030420: 7473 2866 6f6c 6465 725f 7061 7468 293a  ts(folder_path):
+00030430: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00030440: 6e74 2866 2220 496e 7661 6c69 6420 666f  nt(f" Invalid fo
+00030450: 6c64 6572 2070 6174 683a 207b 666f 6c64  lder path: {fold
+00030460: 6572 5f70 6174 687d 2229 0a20 2020 2020  er_path}").     
+00030470: 2020 2020 2020 2072 6574 7572 6e20 666f         return fo
+00030480: 6c64 6572 5f61 7469 6d65 0a20 2020 2020  lder_atime.     
+00030490: 2020 206c 6173 745f 6163 6365 7373 6564     last_accessed
+000304a0: 5f74 696d 6520 3d20 4e6f 6e65 0a20 2020  _time = None.   
+000304b0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000304c0: 2020 2020 2020 7375 626f 626a 6563 7473        subobjects
+000304d0: 203d 206f 732e 6c69 7374 6469 7228 666f   = os.listdir(fo
+000304e0: 6c64 6572 5f70 6174 6829 0a20 2020 2020  lder_path).     
+000304f0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00030500: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00030510: 2020 2020 2020 7072 696e 7428 6627 4572        print(f'Er
+00030520: 726f 7220 6163 6365 7373 696e 6720 666f  ror accessing fo
+00030530: 6c64 6572 207b 666f 6c64 6572 5f70 6174  lder {folder_pat
+00030540: 687d 3a5c 6e7b 657d 2729 0a20 2020 2020  h}:\n{e}').     
+00030550: 2020 2020 2020 2072 6574 7572 6e20 666f         return fo
+00030560: 6c64 6572 5f61 7469 6d65 0a20 2020 2020  lder_atime.     
+00030570: 2020 2066 6f72 2066 696c 655f 6e61 6d65     for file_name
+00030580: 2069 6e20 7375 626f 626a 6563 7473 3a0a   in subobjects:.
+00030590: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+000305a0: 696c 655f 6e61 6d65 2069 6e20 7365 6c66  ile_name in self
+000305b0: 2e64 6972 6d65 7461 6669 6c65 733a 0a20  .dirmetafiles:. 
+000305c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000305d0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+000305e0: 2020 2020 6669 6c65 5f70 6174 6820 3d20      file_path = 
+000305f0: 6f73 2e70 6174 682e 6a6f 696e 2866 6f6c  os.path.join(fol
+00030600: 6465 725f 7061 7468 2c20 6669 6c65 5f6e  der_path, file_n
+00030610: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00030620: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+00030630: 6c65 2866 696c 655f 7061 7468 293a 0a20  le(file_path):. 
+00030640: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00030650: 6363 6573 7365 645f 7469 6d65 203d 206f  ccessed_time = o
+00030660: 732e 7061 7468 2e67 6574 6174 696d 6528  s.path.getatime(
+00030670: 6669 6c65 5f70 6174 6829 0a20 2020 2020  file_path).     
+00030680: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+00030690: 7374 5f61 6363 6573 7365 645f 7469 6d65  st_accessed_time
+000306a0: 2069 7320 4e6f 6e65 206f 7220 6163 6365   is None or acce
+000306b0: 7373 6564 5f74 696d 6520 3e20 6c61 7374  ssed_time > last
+000306c0: 5f61 6363 6573 7365 645f 7469 6d65 3a0a  _accessed_time:.
+000306d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000306e0: 2020 2020 6c61 7374 5f61 6363 6573 7365      last_accesse
+000306f0: 645f 7469 6d65 203d 2061 6363 6573 7365  d_time = accesse
+00030700: 645f 7469 6d65 0a20 2020 2020 2020 2069  d_time.        i
+00030710: 6620 6c61 7374 5f61 6363 6573 7365 645f  f last_accessed_
+00030720: 7469 6d65 203d 3d20 4e6f 6e65 3a0a 2020  time == None:.  
+00030730: 2020 2020 2020 2020 2020 6c61 7374 5f61            last_a
+00030740: 6363 6573 7365 645f 7469 6d65 203d 2066  ccessed_time = f
+00030750: 6f6c 6465 725f 6174 696d 650a 2020 2020  older_atime.    
+00030760: 2020 2020 7265 7475 726e 206c 6173 745f      return last_
+00030770: 6163 6365 7373 6564 5f74 696d 650a 0a20  accessed_time.. 
+00030780: 2020 2064 6566 205f 6765 745f 6e65 7765     def _get_newe
+00030790: 7374 5f66 696c 655f 6d74 696d 6528 7365  st_file_mtime(se
+000307a0: 6c66 2c20 666f 6c64 6572 5f70 6174 682c  lf, folder_path,
+000307b0: 2066 6f6c 6465 725f 6d74 696d 653d 4e6f   folder_mtime=No
+000307c0: 6e65 293a 0a20 2020 2020 2020 2023 2042  ne):.        # B
+000307d0: 6563 6175 7365 2074 6865 2066 6f6c 6465  ecause the folde
+000307e0: 7220 6174 696d 6520 6973 2072 6573 6574  r atime is reset
+000307f0: 2077 6865 6e20 6372 6177 6c69 6e67 2077   when crawling w
+00030800: 6520 6e65 6564 0a20 2020 2020 2020 2023  e need.        #
+00030810: 2074 6f20 6c6f 6f6b 7570 2074 6865 2061   to lookup the a
+00030820: 7469 6d65 206f 6620 7468 6520 6c61 7374  time of the last
+00030830: 206d 6f64 6966 6965 6420 6669 6c65 2069   modified file i
+00030840: 6e20 7468 6973 2066 6f6c 6465 720a 2020  n this folder.  
+00030850: 2020 2020 2020 6966 206e 6f74 2066 6f6c        if not fol
+00030860: 6465 725f 7061 7468 206f 7220 6e6f 7420  der_path or not 
+00030870: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+00030880: 6f6c 6465 725f 7061 7468 293a 0a20 2020  older_path):.   
+00030890: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+000308a0: 2220 496e 7661 6c69 6420 666f 6c64 6572  " Invalid folder
+000308b0: 2070 6174 683a 207b 666f 6c64 6572 5f70   path: {folder_p
+000308c0: 6174 687d 2229 0a20 2020 2020 2020 2020  ath}").         
+000308d0: 2020 2072 6574 7572 6e20 666f 6c64 6572     return folder
+000308e0: 5f6d 7469 6d65 0a0a 2020 2020 2020 2020  _mtime..        
+000308f0: 6c61 7374 5f6d 6f64 6966 6965 645f 7469  last_modified_ti
+00030900: 6d65 203d 204e 6f6e 650a 2020 2020 2020  me = None.      
+00030910: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00030920: 2020 2073 7562 6f62 6a65 6374 7320 3d20     subobjects = 
+00030930: 6f73 2e6c 6973 7464 6972 2866 6f6c 6465  os.listdir(folde
+00030940: 725f 7061 7468 290a 2020 2020 2020 2020  r_path).        
+00030950: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00030960: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00030970: 2020 2070 7269 6e74 2866 2745 7272 6f72     print(f'Error
+00030980: 2061 6363 6573 7369 6e67 2066 6f6c 6465   accessing folde
+00030990: 7220 7b66 6f6c 6465 725f 7061 7468 7d3a  r {folder_path}:
+000309a0: 5c6e 7b65 7d27 290a 2020 2020 2020 2020  \n{e}').        
+000309b0: 2020 2020 7265 7475 726e 2066 6f6c 6465      return folde
+000309c0: 725f 6d74 696d 650a 2020 2020 2020 2020  r_mtime.        
+000309d0: 666f 7220 6669 6c65 5f6e 616d 6520 696e  for file_name in
+000309e0: 2073 7562 6f62 6a65 6374 733a 0a20 2020   subobjects:.   
+000309f0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00030a00: 5f6e 616d 6520 696e 2073 656c 662e 6469  _name in self.di
+00030a10: 726d 6574 6166 696c 6573 3a0a 2020 2020  rmetafiles:.    
+00030a20: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00030a30: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00030a40: 2066 696c 655f 7061 7468 203d 206f 732e   file_path = os.
+00030a50: 7061 7468 2e6a 6f69 6e28 666f 6c64 6572  path.join(folder
+00030a60: 5f70 6174 682c 2066 696c 655f 6e61 6d65  _path, file_name
+00030a70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00030a80: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
+00030a90: 6669 6c65 5f70 6174 6829 3a0a 2020 2020  file_path):.    
+00030aa0: 2020 2020 2020 2020 2020 2020 6d6f 6469              modi
+00030ab0: 6669 6564 5f74 696d 6520 3d20 6f73 2e70  fied_time = os.p
+00030ac0: 6174 682e 6765 746d 7469 6d65 2866 696c  ath.getmtime(fil
+00030ad0: 655f 7061 7468 290a 2020 2020 2020 2020  e_path).        
+00030ae0: 2020 2020 2020 2020 6966 206c 6173 745f          if last_
+00030af0: 6d6f 6469 6669 6564 5f74 696d 6520 6973  modified_time is
+00030b00: 204e 6f6e 6520 6f72 206d 6f64 6966 6965   None or modifie
+00030b10: 645f 7469 6d65 203e 206c 6173 745f 6d6f  d_time > last_mo
+00030b20: 6469 6669 6564 5f74 696d 653a 0a20 2020  dified_time:.   
+00030b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b40: 206c 6173 745f 6d6f 6469 6669 6564 5f74   last_modified_t
+00030b50: 696d 6520 3d20 6d6f 6469 6669 6564 5f74  ime = modified_t
+00030b60: 696d 650a 2020 2020 2020 2020 6966 206c  ime.        if l
+00030b70: 6173 745f 6d6f 6469 6669 6564 5f74 696d  ast_modified_tim
+00030b80: 6520 3d3d 204e 6f6e 653a 0a20 2020 2020  e == None:.     
+00030b90: 2020 2020 2020 206c 6173 745f 6d6f 6469         last_modi
+00030ba0: 6669 6564 5f74 696d 6520 3d20 666f 6c64  fied_time = fold
+00030bb0: 6572 5f6d 7469 6d65 0a20 2020 2020 2020  er_mtime.       
+00030bc0: 2072 6574 7572 6e20 6c61 7374 5f6d 6f64   return last_mod
+00030bd0: 6966 6965 645f 7469 6d65 0a0a 2020 2020  ified_time..    
+00030be0: 6465 6620 6765 745f 686f 7473 706f 7473  def get_hotspots
+00030bf0: 5f70 6174 6828 7365 6c66 2c20 666f 6c64  _path(self, fold
+00030c00: 6572 293a 0a20 2020 2020 2020 2027 2727  er):.        '''
+00030c10: 2047 6574 2061 2066 756c 6c20 7061 7468   Get a full path
+00030c20: 206e 616d 6520 6f66 2061 206e 6577 2068   name of a new h
+00030c30: 6f74 7370 6f74 7320 6669 6c65 2727 270a  otspots file'''.
+00030c40: 0a20 2020 2020 2020 2023 2054 616b 6520  .        # Take 
+00030c50: 7468 6520 636f 7272 6563 7420 686f 7473  the correct hots
+00030c60: 706f 7473 2064 6972 6563 746f 7279 0a20  pots directory. 
+00030c70: 2020 2020 2020 2068 6f74 7370 6f74 6469         hotspotdi
+00030c80: 7220 3d20 7365 6c66 2e63 6667 2e73 6861  r = self.cfg.sha
+00030c90: 7265 645f 686f 7473 706f 7473 5f64 6972  red_hotspots_dir
+00030ca0: 2069 6620 7365 6c66 2e63 6667 2e69 735f   if self.cfg.is_
+00030cb0: 7368 6172 6564 2065 6c73 6520 7365 6c66  shared else self
+00030cc0: 2e63 6667 2e68 6f74 7370 6f74 735f 6469  .cfg.hotspots_di
+00030cd0: 720a 0a20 2020 2020 2020 2023 2063 7265  r..        # cre
+00030ce0: 6174 6520 686f 7473 706f 7473 2064 6972  ate hotspots dir
+00030cf0: 6563 746f 7279 2069 6620 6974 2064 6f65  ectory if it doe
+00030d00: 7320 6e6f 7420 6578 6973 740a 2020 2020  s not exist.    
+00030d10: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00030d20: 686f 7473 706f 7464 6972 2c20 6578 6973  hotspotdir, exis
+00030d30: 745f 6f6b 3d54 7275 652c 206d 6f64 653d  t_ok=True, mode=
+00030d40: 306f 3737 3529 0a0a 2020 2020 2020 2020  0o775)..        
+00030d50: 2320 4765 7420 7468 6520 6675 6c6c 2070  # Get the full p
+00030d60: 6174 6820 6e61 6d65 206f 6620 7468 6520  ath name of the 
+00030d70: 6e65 7720 686f 7473 706f 7473 2066 696c  new hotspots fil
+00030d80: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00030d90: 206f 732e 7061 7468 2e6a 6f69 6e28 686f   os.path.join(ho
+00030da0: 7473 706f 7464 6972 2c20 7365 6c66 2e5f  tspotdir, self._
+00030db0: 6765 745f 686f 7473 706f 7473 5f66 696c  get_hotspots_fil
+00030dc0: 656e 616d 6528 666f 6c64 6572 2929 0a0a  ename(folder))..
+00030dd0: 2020 2020 6465 6620 5f67 6574 5f68 6f74      def _get_hot
+00030de0: 7370 6f74 735f 6669 6c65 6e61 6d65 2873  spots_filename(s
+00030df0: 656c 662c 2066 6f6c 6465 7229 3a0a 2020  elf, folder):.  
+00030e00: 2020 2020 2020 2320 6765 7420 6120 6675        # get a fu
+00030e10: 6c6c 2070 6174 6820 6e61 6d65 206f 6620  ll path name of 
+00030e20: 6120 6e65 7720 686f 7473 706f 7473 2066  a new hotspots f
+00030e30: 696c 650a 2020 2020 2020 2020 2320 6261  ile.        # ba
+00030e40: 7365 6420 6f6e 2061 2066 6f6c 6465 7220  sed on a folder 
+00030e50: 6e61 6d65 2074 6861 7420 6861 7320 6265  name that has be
+00030e60: 656e 2063 7261 776c 6564 0a20 2020 2020  en crawled.     
+00030e70: 2020 206d 6f75 6e74 6c69 7374 203d 2073     mountlist = s
+00030e80: 656c 662e 5f67 6574 5f6d 6f75 6e74 5f69  elf._get_mount_i
+00030e90: 6e66 6f28 290a 0a20 2020 2020 2020 2066  nfo()..        f
+00030ea0: 6f72 206d 6e74 2069 6e20 6d6f 756e 746c  or mnt in mountl
+00030eb0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00030ec0: 2069 6620 666f 6c64 6572 2e73 7461 7274   if folder.start
+00030ed0: 7377 6974 6828 6d6e 745b 276d 6f75 6e74  swith(mnt['mount
+00030ee0: 5f70 6f69 6e74 275d 293a 0a20 2020 2020  _point']):.     
+00030ef0: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
+00030f00: 2074 6865 206c 6173 7420 6469 7265 6374   the last direct
+00030f10: 6f72 7920 696e 2074 6865 2070 6174 680a  ory in the path.
+00030f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030f30: 7472 6169 6c64 6972 203d 2073 656c 662e  traildir = self.
+00030f40: 5f67 6574 5f6c 6173 745f 6469 7265 6374  _get_last_direct
+00030f50: 6f72 7928 6d6e 745b 276d 6f75 6e74 5f70  ory(mnt['mount_p
+00030f60: 6f69 6e74 275d 290a 0a20 2020 2020 2020  oint'])..       
+00030f70: 2020 2020 2020 2020 2023 2042 7569 6c64           # Build
+00030f80: 2074 6865 2068 6f74 7370 6f74 7320 6669   the hotspots fi
+00030f90: 6c65 206e 616d 650a 2020 2020 2020 2020  le name.        
+00030fa0: 2020 2020 2020 2020 6873 6669 6c65 203d          hsfile =
+00030fb0: 2066 6f6c 6465 722e 7265 706c 6163 6528   folder.replace(
+00030fc0: 6d6e 745b 276d 6f75 6e74 5f70 6f69 6e74  mnt['mount_point
+00030fd0: 275d 2c20 2727 290a 2020 2020 2020 2020  '], '').        
+00030fe0: 2020 2020 2020 2020 6873 6669 6c65 203d          hsfile =
+00030ff0: 2066 2740 7b74 7261 696c 6469 727d 7b68   f'@{traildir}{h
+00031000: 7366 696c 657d 270a 0a20 2020 2020 2020  sfile}'..       
+00031010: 2020 2020 2020 2020 2023 2053 686f 7274           # Short
+00031020: 656e 2074 6865 206c 656e 6774 6820 6f66  en the length of
+00031030: 2074 6865 2066 696c 6520 6966 2069 7420   the file if it 
+00031040: 6973 2074 6f6f 206c 6f6e 670a 2020 2020  is too long.    
+00031050: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00031060: 656e 2868 7366 696c 6529 203e 2032 3535  en(hsfile) > 255
+00031070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00031080: 2020 2020 2020 6873 6669 6c65 203d 2066        hsfile = f
+00031090: 277b 6873 6669 6c65 5b3a 3235 5d7d 2e2e  '{hsfile[:25]}..
+000310a0: 2e2e 2e7b 6873 6669 6c65 5b2d 3232 353a  ...{hsfile[-225:
+000310b0: 5d7d 270a 0a20 2020 2020 2020 2068 7366  ]}'..        hsf
+000310c0: 696c 6520 3d20 666f 6c64 6572 2e72 6570  ile = folder.rep
+000310d0: 6c61 6365 2827 2f27 2c20 272b 2729 202b  lace('/', '+') +
+000310e0: 2027 2e63 7376 270a 0a20 2020 2020 2020   '.csv'..       
+000310f0: 2072 6574 7572 6e20 6873 6669 6c65 0a0a   return hsfile..
+00031100: 2020 2020 6465 6620 5f77 616c 6b65 7228      def _walker(
+00031110: 7365 6c66 2c20 746f 702c 2073 6b69 7064  self, top, skipd
+00031120: 6972 733d 5b27 2e73 6e61 7073 686f 7427  irs=['.snapshot'
+00031130: 2c5d 293a 0a20 2020 2020 2020 2022 2222  ,]):.        """
+00031140: 2072 6574 7572 6e73 2073 7562 7365 7420   returns subset 
+00031150: 6f66 206f 732e 7761 6c6b 2020 2222 220a  of os.walk  """.
+00031160: 2020 2020 2020 2020 666f 7220 726f 6f74          for root
+00031170: 2c20 6469 7273 2c20 6669 6c65 7320 696e  , dirs, files in
+00031180: 206f 732e 7761 6c6b 2874 6f70 2c20 746f   os.walk(top, to
+00031190: 7064 6f77 6e3d 5472 7565 2c20 6f6e 6572  pdown=True, oner
+000311a0: 726f 723d 7365 6c66 2e5f 7761 6c6b 6572  ror=self._walker
+000311b0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000311c0: 666f 7220 736b 6970 6469 7220 696e 2073  for skipdir in s
+000311d0: 6b69 7064 6972 733a 0a20 2020 2020 2020  kipdirs:.       
+000311e0: 2020 2020 2020 2020 2069 6620 736b 6970           if skip
+000311f0: 6469 7220 696e 2064 6972 733a 0a20 2020  dir in dirs:.   
+00031200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031210: 2064 6972 732e 7265 6d6f 7665 2873 6b69   dirs.remove(ski
+00031220: 7064 6972 2920 2023 2064 6f6e 2774 2076  pdir)  # don't v
+00031230: 6973 6974 2074 6869 7320 6469 7265 6374  isit this direct
+00031240: 6f72 790a 2020 2020 2020 2020 2020 2020  ory.            
+00031250: 7969 656c 6420 726f 6f74 2c20 6469 7273  yield root, dirs
+00031260: 2c20 6669 6c65 730a 0a20 2020 2064 6566  , files..    def
+00031270: 205f 7761 6c6b 6572 7228 7365 6c66 2c20   _walkerr(self, 
+00031280: 6f73 6572 7229 3a0a 2020 2020 2020 2020  oserr):.        
+00031290: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+000312a0: 2873 7472 286f 7365 7272 2929 0a20 2020  (str(oserr)).   
+000312b0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+000312c0: 7772 6974 6528 275c 6e27 290a 0a20 2020  write('\n')..   
+000312d0: 2064 6566 205f 6765 745f 6c61 7374 5f64   def _get_last_d
+000312e0: 6972 6563 746f 7279 2873 656c 662c 2070  irectory(self, p
+000312f0: 6174 6829 3a0a 0a20 2020 2020 2020 2023  ath):..        #
+00031300: 2052 656d 6f76 6520 616e 7920 7472 6169   Remove any trai
+00031310: 6c69 6e67 2073 6c61 7368 6573 0a20 2020  ling slashes.   
+00031320: 2020 2020 2070 6174 6820 3d20 7061 7468       path = path
+00031330: 2e72 7374 7269 7028 6f73 2e70 6174 682e  .rstrip(os.path.
+00031340: 7365 7029 0a0a 2020 2020 2020 2020 2320  sep)..        # 
+00031350: 5370 6c69 7420 7468 6520 7061 7468 2062  Split the path b
+00031360: 7920 7468 6520 7365 7061 7261 746f 720a  y the separator.
+00031370: 2020 2020 2020 2020 7061 7468 5f70 6172          path_par
+00031380: 7473 203d 2070 6174 682e 7370 6c69 7428  ts = path.split(
+00031390: 6f73 2e70 6174 682e 7365 7029 0a0a 2020  os.path.sep)..  
+000313a0: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
+000313b0: 6865 206c 6173 7420 6469 7265 6374 6f72  he last director
+000313c0: 790a 2020 2020 2020 2020 7265 7475 726e  y.        return
+000313d0: 2070 6174 685f 7061 7274 735b 2d31 5d0a   path_parts[-1].
+000313e0: 0a20 2020 2064 6566 205f 6765 745f 6d6f  .    def _get_mo
+000313f0: 756e 745f 696e 666f 2873 656c 6629 3a0a  unt_info(self):.
+00031400: 2020 2020 2020 2020 6669 6c65 5f70 6174          file_pat
+00031410: 6820 3d20 272f 7072 6f63 2f73 656c 662f  h = '/proc/self/
+00031420: 6d6f 756e 7469 6e66 6f27 0a0a 2020 2020  mountinfo'..    
+00031430: 2020 2020 6673 5f74 7970 6573 203d 207b      fs_types = {
+00031440: 276e 6673 272c 2027 6e66 7334 272c 2027  'nfs', 'nfs4', '
+00031450: 6369 6673 272c 2027 736d 6227 2c20 2761  cifs', 'smb', 'a
+00031460: 6673 272c 2027 6e63 7027 2c0a 2020 2020  fs', 'ncp',.    
+00031470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031480: 276e 6370 6673 272c 2027 676c 7573 7465  'ncpfs', 'gluste
+00031490: 7266 7327 2c20 2763 6570 6827 2c20 2762  rfs', 'ceph', 'b
+000314a0: 6565 6766 7327 2c0a 2020 2020 2020 2020  eegfs',.        
+000314b0: 2020 2020 2020 2020 2020 2020 276c 7573              'lus
+000314c0: 7472 6527 2c20 276f 7261 6e67 6566 7327  tre', 'orangefs'
+000314d0: 2c20 2777 656b 6166 7327 2c20 2767 7066  , 'wekafs', 'gpf
+000314e0: 7327 7d0a 0a20 2020 2020 2020 206d 6f75  s'}..        mou
+000314f0: 6e74 696e 666f 5f6c 6973 7420 3d20 5b5d  ntinfo_list = []
+00031500: 0a0a 2020 2020 2020 2020 7769 7468 206f  ..        with o
+00031510: 7065 6e28 6669 6c65 5f70 6174 682c 2027  pen(file_path, '
+00031520: 7227 2920 6173 2066 3a0a 2020 2020 2020  r') as f:.      
+00031530: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
+00031540: 6e20 663a 0a20 2020 2020 2020 2020 2020  n f:.           
+00031550: 2020 2020 2066 6965 6c64 7320 3d20 6c69       fields = li
+00031560: 6e65 2e73 7472 6970 2829 2e73 706c 6974  ne.strip().split
+00031570: 2827 2027 290a 2020 2020 2020 2020 2020  (' ').          
+00031580: 2020 2020 2020 5f2c 205f 2c20 5f2c 205f        _, _, _, _
+00031590: 2c20 6d6f 756e 745f 706f 696e 742c 205f  , mount_point, _
+000315a0: 203d 2066 6965 6c64 735b 3a36 5d0a 2020   = fields[:6].  
+000315b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000315c0: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
+000315d0: 735b 363a 5d3a 0a20 2020 2020 2020 2020  s[6:]:.         
+000315e0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+000315f0: 656c 6420 3d3d 2027 2d27 3a0a 2020 2020  eld == '-':.    
+00031600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031610: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00031620: 2020 2020 2020 2020 2020 6673 5f74 7970            fs_typ
+00031630: 652c 206d 6f75 6e74 5f73 6f75 7263 652c  e, mount_source,
+00031640: 205f 203d 2066 6965 6c64 735b 2d33 3a5d   _ = fields[-3:]
+00031650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031660: 206d 6f75 6e74 5f73 6f75 7263 655f 666f   mount_source_fo
+00031670: 6c64 6572 203d 206d 6f75 6e74 5f73 6f75  lder = mount_sou
+00031680: 7263 652e 7370 6c69 7428 0a20 2020 2020  rce.split(.     
+00031690: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000316a0: 3a27 295b 2d31 5d20 6966 2027 3a27 2069  :')[-1] if ':' i
+000316b0: 6e20 6d6f 756e 745f 736f 7572 6365 2065  n mount_source e
+000316c0: 6c73 6520 2727 0a20 2020 2020 2020 2020  lse ''.         
+000316d0: 2020 2020 2020 2069 6620 6673 5f74 7970         if fs_typ
+000316e0: 6520 696e 2066 735f 7479 7065 733a 0a20  e in fs_types:. 
+000316f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031700: 2020 206d 6f75 6e74 696e 666f 5f6c 6973     mountinfo_lis
+00031710: 742e 6170 7065 6e64 287b 0a20 2020 2020  t.append({.     
+00031720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031730: 2020 2027 6d6f 756e 745f 736f 7572 6365     'mount_source
+00031740: 5f66 6f6c 6465 7227 3a20 6d6f 756e 745f  _folder': mount_
+00031750: 736f 7572 6365 5f66 6f6c 6465 722c 0a20  source_folder,. 
+00031760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031770: 2020 2020 2020 2027 6d6f 756e 745f 706f         'mount_po
+00031780: 696e 7427 3a20 6d6f 756e 745f 706f 696e  int': mount_poin
+00031790: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+000317a0: 2020 2020 2020 2020 2020 2027 6673 5f74             'fs_t
+000317b0: 7970 6527 3a20 6673 5f74 7970 652c 0a20  ype': fs_type,. 
+000317c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000317d0: 2020 2020 2020 2027 6d6f 756e 745f 736f         'mount_so
+000317e0: 7572 6365 273a 206d 6f75 6e74 5f73 6f75  urce': mount_sou
+000317f0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
+00031800: 2020 2020 2020 2020 207d 290a 2020 2020           }).    
+00031810: 2020 2020 7265 7475 726e 206d 6f75 6e74      return mount
+00031820: 696e 666f 5f6c 6973 740a 0a20 2020 2064  info_list..    d
+00031830: 6566 2064 6f77 6e6c 6f61 645f 7265 7374  ef download_rest
+00031840: 6f72 6564 5f66 696c 6528 7365 6c66 2c20  ored_file(self, 
+00031850: 6275 636b 6574 5f6e 616d 652c 206f 626a  bucket_name, obj
+00031860: 6563 745f 6b65 792c 206c 6f63 616c 5f70  ect_key, local_p
+00031870: 6174 6829 3a0a 2020 2020 2020 2020 7333  ath):.        s3
+00031880: 203d 2062 6f74 6f33 2e72 6573 6f75 7263   = boto3.resourc
+00031890: 6528 2773 3327 290a 2020 2020 2020 2020  e('s3').        
+000318a0: 7333 2e42 7563 6b65 7428 6275 636b 6574  s3.Bucket(bucket
+000318b0: 5f6e 616d 6529 2e64 6f77 6e6c 6f61 645f  _name).download_
+000318c0: 6669 6c65 286f 626a 6563 745f 6b65 792c  file(object_key,
+000318d0: 206c 6f63 616c 5f70 6174 6829 0a20 2020   local_path).   
+000318e0: 2020 2020 2070 7269 6e74 2866 2744 6f77       print(f'Dow
+000318f0: 6e6c 6f61 6465 6420 7b6f 626a 6563 745f  nloaded {object_
+00031900: 6b65 797d 2074 6f20 7b6c 6f63 616c 5f70  key} to {local_p
+00031910: 6174 687d 2e27 290a 0a20 2020 2064 6566  ath}.')..    def
+00031920: 205f 7570 6c6f 6164 5f66 696c 655f 746f   _upload_file_to
+00031930: 5f73 3328 7365 6c66 2c20 6669 6c65 6e61  _s3(self, filena
+00031940: 6d65 2c20 6275 636b 6574 2c20 6f62 6a65  me, bucket, obje
+00031950: 6374 5f6e 616d 653d 4e6f 6e65 2c20 7072  ct_name=None, pr
+00031960: 6f66 696c 653d 4e6f 6e65 293a 0a20 2020  ofile=None):.   
+00031970: 2020 2020 2073 6573 7369 6f6e 203d 2062       session = b
+00031980: 6f74 6f33 2e53 6573 7369 6f6e 280a 2020  oto3.Session(.  
+00031990: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
+000319a0: 655f 6e61 6d65 3d70 726f 6669 6c65 2920  e_name=profile) 
+000319b0: 6966 2070 726f 6669 6c65 2065 6c73 6520  if profile else 
+000319c0: 626f 746f 332e 5365 7373 696f 6e28 290a  boto3.Session().
+000319d0: 2020 2020 2020 2020 7333 203d 2073 6573          s3 = ses
+000319e0: 7369 6f6e 2e63 6c69 656e 7428 2773 3327  sion.client('s3'
+000319f0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+00031a00: 5333 206f 626a 6563 745f 6e61 6d65 2077  S3 object_name w
+00031a10: 6173 206e 6f74 2073 7065 6369 6669 6564  as not specified
+00031a20: 2c20 7573 6520 7468 6520 6669 6c65 6e61  , use the filena
+00031a30: 6d65 0a20 2020 2020 2020 2069 6620 6f62  me.        if ob
+00031a40: 6a65 6374 5f6e 616d 6520 6973 204e 6f6e  ject_name is Non
+00031a50: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+00031a60: 626a 6563 745f 6e61 6d65 203d 206f 732e  bject_name = os.
+00031a70: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
+00031a80: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00031a90: 7472 793a 0a0a 2020 2020 2020 2020 2020  try:..          
+00031aa0: 2020 2320 5570 6c6f 6164 2074 6865 2066    # Upload the f
+00031ab0: 696c 6520 7769 7468 2049 6e74 656c 6c69  ile with Intelli
+00031ac0: 6765 6e74 2d54 6965 7269 6e67 2073 746f  gent-Tiering sto
+00031ad0: 7261 6765 2063 6c61 7373 0a20 2020 2020  rage class.     
+00031ae0: 2020 2020 2020 2073 332e 7570 6c6f 6164         s3.upload
+00031af0: 5f66 696c 6528 6669 6c65 6e61 6d65 2c20  _file(filename, 
+00031b00: 6275 636b 6574 2c20 6f62 6a65 6374 5f6e  bucket, object_n
+00031b10: 616d 652c 2045 7874 7261 4172 6773 3d7b  ame, ExtraArgs={
+00031b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031b30: 2020 2020 2020 2020 2020 2020 2753 746f              'Sto
+00031b40: 7261 6765 436c 6173 7327 3a20 2749 4e54  rageClass': 'INT
+00031b50: 454c 4c49 4745 4e54 5f54 4945 5249 4e47  ELLIGENT_TIERING
+00031b60: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
+00031b70: 7072 696e 7464 6267 280a 2020 2020 2020  printdbg(.      
+00031b80: 2020 2020 2020 2020 2020 6622 4669 6c65            f"File
+00031b90: 207b 6f62 6a65 6374 5f6e 616d 657d 2075   {object_name} u
+00031ba0: 706c 6f61 6465 6420 746f 2049 6e74 656c  ploaded to Intel
+00031bb0: 6c69 6765 6e74 2d54 6965 7269 6e67 2073  ligent-Tiering s
+00031bc0: 746f 7261 6765 2063 6c61 7373 2122 290a  torage class!").
+00031bd0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+00031be0: 696e 7428 6622 4669 6c65 207b 6669 6c65  int(f"File {file
+00031bf0: 6e61 6d65 7d20 7570 6c6f 6164 6564 2073  name} uploaded s
+00031c00: 7563 6365 7373 6675 6c6c 7920 746f 2049  uccessfully to I
+00031c10: 6e74 656c 6c69 6765 6e74 2d54 6965 7269  ntelligent-Tieri
+00031c20: 6e67 2073 746f 7261 6765 2063 6c61 7373  ng storage class
+00031c30: 2122 290a 2020 2020 2020 2020 6578 6365  !").        exce
+00031c40: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00031c50: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00031c60: 7269 6e74 2866 2241 6e20 6572 726f 7220  rint(f"An error 
+00031c70: 6f63 6375 7272 6564 3a20 7b65 7d22 290a  occurred: {e}").
+00031c80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00031c90: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00031ca0: 2072 6574 7572 6e20 5472 7565 0a0a 0a63   return True...c
+00031cb0: 6c61 7373 2053 6372 6565 6e43 6f6e 6669  lass ScreenConfi
+00031cc0: 726d 284d 6f64 616c 5363 7265 656e 5b62  rm(ModalScreen[b
+00031cd0: 6f6f 6c5d 293a 0a20 2020 2044 4546 4155  ool]):.    DEFAU
+00031ce0: 4c54 5f43 5353 203d 2022 2222 0a20 2020  LT_CSS = """.   
+00031cf0: 2053 6372 6565 6e43 6f6e 6669 726d 207b   ScreenConfirm {
+00031d00: 0a20 2020 2020 2020 2061 6c69 676e 3a20  .        align: 
+00031d10: 6365 6e74 6572 206d 6964 646c 653b 0a20  center middle;. 
+00031d20: 2020 207d 0a0a 2020 2020 5363 7265 656e     }..    Screen
+00031d30: 436f 6e66 6972 6d20 3e20 5665 7274 6963  Confirm > Vertic
+00031d40: 616c 207b 0a20 2020 2020 2020 2062 6163  al {.        bac
+00031d50: 6b67 726f 756e 643a 2024 7365 636f 6e64  kground: $second
+00031d60: 6172 793b 0a20 2020 2020 2020 2077 6964  ary;.        wid
+00031d70: 7468 3a20 6175 746f 3b0a 2020 2020 2020  th: auto;.      
+00031d80: 2020 6865 6967 6874 3a20 6175 746f 3b0a    height: auto;.
+00031d90: 2020 2020 2020 2020 626f 7264 6572 3a20          border: 
+00031da0: 7468 6963 6b20 2470 7269 6d61 7279 3b0a  thick $primary;.
+00031db0: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
+00031dc0: 2032 2034 3b0a 2020 2020 7d0a 0a20 2020   2 4;.    }..   
+00031dd0: 2053 6372 6565 6e43 6f6e 6669 726d 203e   ScreenConfirm >
+00031de0: 2056 6572 7469 6361 6c20 3e20 2a20 7b0a   Vertical > * {.
+00031df0: 2020 2020 2020 2020 7769 6474 683a 2061          width: a
+00031e00: 7574 6f3b 0a20 2020 2020 2020 2068 6569  uto;.        hei
+00031e10: 6768 743a 2061 7574 6f3b 0a20 2020 207d  ght: auto;.    }
+00031e20: 0a0a 2020 2020 5363 7265 656e 436f 6e66  ..    ScreenConf
+00031e30: 6972 6d20 3e20 5665 7274 6963 616c 203e  irm > Vertical >
+00031e40: 204c 6162 656c 207b 0a20 2020 2020 2020   Label {.       
+00031e50: 2070 6164 6469 6e67 2d62 6f74 746f 6d3a   padding-bottom:
+00031e60: 2032 3b0a 2020 2020 7d0a 0a20 2020 2053   2;.    }..    S
+00031e70: 6372 6565 6e43 6f6e 6669 726d 203e 2056  creenConfirm > V
+00031e80: 6572 7469 6361 6c20 3e20 486f 7269 7a6f  ertical > Horizo
+00031e90: 6e74 616c 207b 0a20 2020 2020 2020 2061  ntal {.        a
+00031ea0: 6c69 676e 3a20 7269 6768 7420 6d69 6464  lign: right midd
+00031eb0: 6c65 3b0a 2020 2020 7d0a 0a20 2020 2053  le;.    }..    S
+00031ec0: 6372 6565 6e43 6f6e 6669 726d 2042 7574  creenConfirm But
+00031ed0: 746f 6e20 7b0a 2020 2020 2020 2020 6d61  ton {.        ma
+00031ee0: 7267 696e 2d6c 6566 743a 2032 3b0a 2020  rgin-left: 2;.  
+00031ef0: 2020 7d0a 2020 2020 2222 220a 0a20 2020    }.    """..   
+00031f00: 2064 6566 2063 6f6d 706f 7365 2873 656c   def compose(sel
+00031f10: 6629 202d 3e20 436f 6d70 6f73 6552 6573  f) -> ComposeRes
+00031f20: 756c 743a 0a20 2020 2020 2020 2077 6974  ult:.        wit
+00031f30: 6820 5665 7274 6963 616c 2829 3a0a 0a20  h Vertical():.. 
+00031f40: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00031f50: 204c 6162 656c 2822 446f 2079 6f75 2077   Label("Do you w
+00031f60: 616e 7420 746f 2073 7461 7274 2074 6869  ant to start thi
+00031f70: 7320 6172 6368 6976 696e 6720 6a6f 6220  s archiving job 
+00031f80: 6e6f 773f 5c6e 4368 6f6f 7365 2027 5175  now?\nChoose 'Qu
+00031f90: 6974 2720 6966 2079 6f75 2077 6f75 6c64  it' if you would
+00031fa0: 206c 696b 6520 746f 2061 7263 6869 7665   like to archive
+00031fb0: 2072 6563 7572 7369 7665 6c79 2229 0a20   recursively"). 
+00031fc0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00031fd0: 486f 7269 7a6f 6e74 616c 2829 3a0a 2020  Horizontal():.  
+00031fe0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00031ff0: 656c 6420 4275 7474 6f6e 2822 5374 6172  eld Button("Star
+00032000: 7420 4a6f 6222 2c20 6964 3d22 636f 6e74  t Job", id="cont
+00032010: 696e 7565 2229 0a20 2020 2020 2020 2020  inue").         
+00032020: 2020 2020 2020 2079 6965 6c64 2042 7574         yield But
+00032030: 746f 6e28 2242 6163 6b20 746f 204c 6973  ton("Back to Lis
+00032040: 7422 2c20 6964 3d22 7265 7475 726e 2229  t", id="return")
+00032050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032060: 2079 6965 6c64 2042 7574 746f 6e28 2251   yield Button("Q
+00032070: 7569 7420 746f 2043 4c49 222c 2069 643d  uit to CLI", id=
+00032080: 2271 7569 7422 290a 0a20 2020 2064 6566  "quit")..    def
+00032090: 206f 6e5f 6275 7474 6f6e 5f70 7265 7373   on_button_press
+000320a0: 6564 2873 656c 662c 2065 7665 6e74 3a20  ed(self, event: 
+000320b0: 4275 7474 6f6e 2e50 7265 7373 6564 2920  Button.Pressed) 
+000320c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000320d0: 2023 2073 656c 662e 6469 736d 6973 7328   # self.dismiss(
+000320e0: 7265 7375 6c74 3d65 7665 6e74 2e62 7574  result=event.but
+000320f0: 746f 6e2e 6964 203d 3d20 2263 6f6e 7469  ton.id == "conti
+00032100: 6e75 6522 290a 2020 2020 2020 2020 7365  nue").        se
+00032110: 6c66 2e64 6973 6d69 7373 2872 6573 756c  lf.dismiss(resul
+00032120: 743d 6576 656e 742e 6275 7474 6f6e 2e69  t=event.button.i
+00032130: 6429 0a0a 0a63 6c61 7373 2054 6162 6c65  d)...class Table
+00032140: 486f 7473 706f 7473 2841 7070 5b6c 6973  Hotspots(App[lis
+00032150: 745d 293a 0a0a 2020 2020 4249 4e44 494e  t]):..    BINDIN
+00032160: 4753 203d 205b 2822 7122 2c20 2272 6571  GS = [("q", "req
+00032170: 7565 7374 5f71 7569 7422 2c20 2251 7569  uest_quit", "Qui
+00032180: 7422 295d 0a0a 2020 2020 6465 6620 5f5f  t")]..    def __
+00032190: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
+000321a0: 6529 3a0a 2020 2020 2020 2020 7375 7065  e):.        supe
+000321b0: 7228 292e 5f5f 696e 6974 5f5f 2829 0a20  r().__init__(). 
+000321c0: 2020 2020 2020 2073 656c 662e 6d79 726f         self.myro
+000321d0: 7720 3d20 5b5d 0a20 2020 2020 2020 2073  w = [].        s
+000321e0: 656c 662e 6669 6c65 203d 2066 696c 650a  elf.file = file.
+000321f0: 0a20 2020 2064 6566 2063 6f6d 706f 7365  .    def compose
+00032200: 2873 656c 6629 202d 3e20 436f 6d70 6f73  (self) -> Compos
+00032210: 6552 6573 756c 743a 0a20 2020 2020 2020  eResult:.       
+00032220: 2074 6162 6c65 203d 2044 6174 6154 6162   table = DataTab
+00032230: 6c65 2829 0a20 2020 2020 2020 2074 6162  le().        tab
+00032240: 6c65 2e66 6f63 7573 2829 0a20 2020 2020  le.focus().     
+00032250: 2020 2074 6162 6c65 2e7a 6562 7261 5f73     table.zebra_s
+00032260: 7472 6970 6573 203d 2054 7275 650a 2020  tripes = True.  
+00032270: 2020 2020 2020 7461 626c 652e 6375 7273        table.curs
+00032280: 6f72 5f74 7970 6520 3d20 2272 6f77 220a  or_type = "row".
+00032290: 2020 2020 2020 2020 7461 626c 652e 7374          table.st
+000322a0: 796c 6573 2e6d 6178 5f68 6569 6768 7420  yles.max_height 
+000322b0: 3d20 2239 3976 6822 0a20 2020 2020 2020  = "99vh".       
+000322c0: 2079 6965 6c64 2074 6162 6c65 0a20 2020   yield table.   
+000322d0: 2020 2020 2023 2079 6965 6c64 2046 6f6f       # yield Foo
+000322e0: 7465 7228 290a 0a20 2020 2064 6566 206f  ter()..    def o
+000322f0: 6e5f 6d6f 756e 7428 7365 6c66 2920 2d3e  n_mount(self) ->
+00032300: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
+00032310: 6162 6c65 203d 2073 656c 662e 7175 6572  able = self.quer
+00032320: 795f 6f6e 6528 4461 7461 5461 626c 6529  y_one(DataTable)
+00032330: 0a20 2020 2020 2020 2066 6820 3d20 6f70  .        fh = op
+00032340: 656e 2873 656c 662e 6669 6c65 2c20 2772  en(self.file, 'r
+00032350: 2729 0a20 2020 2020 2020 2072 6f77 7320  ').        rows 
+00032360: 3d20 6373 762e 7265 6164 6572 2866 6829  = csv.reader(fh)
+00032370: 0a20 2020 2020 2020 2074 6162 6c65 2e61  .        table.a
+00032380: 6464 5f63 6f6c 756d 6e73 282a 6e65 7874  dd_columns(*next
+00032390: 2872 6f77 7329 290a 2020 2020 2020 2020  (rows)).        
+000323a0: 7461 626c 652e 6164 645f 726f 7773 2869  table.add_rows(i
+000323b0: 7465 7274 6f6f 6c73 2e69 736c 6963 6528  tertools.islice(
+000323c0: 726f 7773 2c20 4d41 5848 4f54 5350 4f54  rows, MAXHOTSPOT
+000323d0: 5329 290a 0a20 2020 2064 6566 2061 6363  S))..    def acc
+000323e0: 6570 745f 616e 7377 6572 2873 656c 662c  ept_answer(self,
+000323f0: 2061 6e73 7765 723a 2073 7472 2920 2d3e   answer: str) ->
+00032400: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+00032410: 2061 6464 7320 7965 736e 6f20 616e 7377   adds yesno answ
+00032420: 6572 2061 7320 6c61 7374 2065 6c65 6d65  er as last eleme
+00032430: 6e74 2069 6e20 6c69 7374 0a20 2020 2020  nt in list.     
+00032440: 2020 2069 6620 616e 7377 6572 203d 3d20     if answer == 
+00032450: 2763 6f6e 7469 6e75 6527 3a0a 2020 2020  'continue':.    
+00032460: 2020 2020 2020 2020 7365 6c66 2e65 7869          self.exi
+00032470: 7428 7365 6c66 2e6d 7972 6f77 2b5b 5472  t(self.myrow+[Tr
+00032480: 7565 5d29 0a20 2020 2020 2020 2065 6c69  ue]).        eli
+00032490: 6620 616e 7377 6572 203d 3d20 2771 7569  f answer == 'qui
+000324a0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+000324b0: 7365 6c66 2e65 7869 7428 7365 6c66 2e6d  self.exit(self.m
+000324c0: 7972 6f77 2b5b 4661 6c73 655d 290a 0a20  yrow+[False]).. 
+000324d0: 2020 2064 6566 206f 6e5f 6461 7461 5f74     def on_data_t
+000324e0: 6162 6c65 5f72 6f77 5f73 656c 6563 7465  able_row_selecte
+000324f0: 6428 7365 6c66 2c20 6576 656e 743a 2044  d(self, event: D
+00032500: 6174 6154 6162 6c65 2e52 6f77 5365 6c65  ataTable.RowSele
+00032510: 6374 6564 2920 2d3e 204e 6f6e 653a 0a20  cted) -> None:. 
+00032520: 2020 2020 2020 2073 656c 662e 6d79 726f         self.myro
+00032530: 7720 3d20 7365 6c66 2e71 7565 7279 5f6f  w = self.query_o
+00032540: 6e65 2844 6174 6154 6162 6c65 292e 6765  ne(DataTable).ge
+00032550: 745f 726f 7728 6576 656e 742e 726f 775f  t_row(event.row_
+00032560: 6b65 7929 0a20 2020 2020 2020 2023 2073  key).        # s
+00032570: 656c 662e 6578 6974 2873 656c 662e 6d79  elf.exit(self.my
+00032580: 726f 7729 0a20 2020 2020 2020 2073 656c  row).        sel
+00032590: 662e 7075 7368 5f73 6372 6565 6e28 5363  f.push_screen(Sc
+000325a0: 7265 656e 436f 6e66 6972 6d28 292c 2063  reenConfirm(), c
+000325b0: 616c 6c62 6163 6b3d 7365 6c66 2e61 6363  allback=self.acc
+000325c0: 6570 745f 616e 7377 6572 290a 0a20 2020  ept_answer)..   
+000325d0: 2064 6566 2061 6374 696f 6e5f 7265 7175   def action_requ
+000325e0: 6573 745f 7175 6974 2873 656c 6629 202d  est_quit(self) -
+000325f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00032600: 7365 6c66 2e61 7070 2e65 7869 7428 290a  self.app.exit().
+00032610: 0a0a 636c 6173 7320 5465 7874 7561 6c53  ..class TextualS
+00032620: 7472 696e 674c 6973 7453 656c 6563 746f  tringListSelecto
+00032630: 7228 4170 705b 6c69 7374 5d29 3a0a 0a20  r(App[list]):.. 
+00032640: 2020 2042 494e 4449 4e47 5320 3d20 5b28     BINDINGS = [(
+00032650: 2271 222c 2022 7265 7175 6573 745f 7175  "q", "request_qu
+00032660: 6974 222c 2022 5175 6974 2229 5d0a 0a20  it", "Quit")].. 
+00032670: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00032680: 7365 6c66 2c20 7469 746c 653a 2073 7472  self, title: str
+00032690: 2c20 6974 656d 733a 206c 6973 745b 7374  , items: list[st
+000326a0: 725d 293a 0a20 2020 2020 2020 2073 7570  r]):.        sup
+000326b0: 6572 2829 2e5f 5f69 6e69 745f 5f28 290a  er().__init__().
+000326c0: 2020 2020 2020 2020 7365 6c66 2e74 6974          self.tit
+000326d0: 6c65 203d 2074 6974 6c65 0a20 2020 2020  le = title.     
+000326e0: 2020 2073 656c 662e 6974 656d 7320 3d20     self.items = 
+000326f0: 6974 656d 730a 0a20 2020 2064 6566 2063  items..    def c
+00032700: 6f6d 706f 7365 2873 656c 6629 202d 3e20  ompose(self) -> 
+00032710: 436f 6d70 6f73 6552 6573 756c 743a 0a20  ComposeResult:. 
+00032720: 2020 2020 2020 2074 6162 6c65 203d 2044         table = D
+00032730: 6174 6154 6162 6c65 2829 0a20 2020 2020  ataTable().     
+00032740: 2020 2074 6162 6c65 2e66 6f63 7573 2829     table.focus()
+00032750: 0a20 2020 2020 2020 2074 6162 6c65 2e7a  .        table.z
+00032760: 6562 7261 5f73 7472 6970 6573 203d 2054  ebra_stripes = T
+00032770: 7275 650a 2020 2020 2020 2020 7461 626c  rue.        tabl
+00032780: 652e 6375 7273 6f72 5f74 7970 6520 3d20  e.cursor_type = 
+00032790: 2272 6f77 220a 2020 2020 2020 2020 7461  "row".        ta
+000327a0: 626c 652e 7374 796c 6573 2e6d 6178 5f68  ble.styles.max_h
+000327b0: 6569 6768 7420 3d20 2239 3976 6822 0a20  eight = "99vh". 
+000327c0: 2020 2020 2020 2079 6965 6c64 2074 6162         yield tab
+000327d0: 6c65 0a20 2020 2020 2020 2079 6965 6c64  le.        yield
+000327e0: 2046 6f6f 7465 7228 290a 0a20 2020 2064   Footer()..    d
+000327f0: 6566 206f 6e5f 6d6f 756e 7428 7365 6c66  ef on_mount(self
+00032800: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00032810: 2020 2074 6162 6c65 203d 2073 656c 662e     table = self.
+00032820: 7175 6572 795f 6f6e 6528 4461 7461 5461  query_one(DataTa
+00032830: 626c 6529 0a20 2020 2020 2020 2074 6162  ble).        tab
+00032840: 6c65 2e61 6464 5f63 6f6c 756d 6e73 2873  le.add_columns(s
+00032850: 656c 662e 7469 746c 6529 0a20 2020 2020  elf.title).     
+00032860: 2020 2066 6f72 2069 7465 6d20 696e 2073     for item in s
+00032870: 656c 662e 6974 656d 733a 0a20 2020 2020  elf.items:.     
+00032880: 2020 2020 2020 2074 6162 6c65 2e61 6464         table.add
+00032890: 5f72 6f77 2869 7465 6d29 0a0a 2020 2020  _row(item)..    
+000328a0: 6465 6620 6f6e 5f64 6174 615f 7461 626c  def on_data_tabl
+000328b0: 655f 726f 775f 7365 6c65 6374 6564 2873  e_row_selected(s
+000328c0: 656c 662c 2065 7665 6e74 3a20 4461 7461  elf, event: Data
+000328d0: 5461 626c 652e 526f 7753 656c 6563 7465  Table.RowSelecte
+000328e0: 6429 202d 3e20 4e6f 6e65 3a0a 2020 2020  d) -> None:.    
+000328f0: 2020 2020 7365 6c66 2e65 7869 7428 7365      self.exit(se
+00032900: 6c66 2e71 7565 7279 5f6f 6e65 2844 6174  lf.query_one(Dat
+00032910: 6154 6162 6c65 292e 6765 745f 726f 7728  aTable).get_row(
+00032920: 6576 656e 742e 726f 775f 6b65 7929 290a  event.row_key)).
+00032930: 0a20 2020 2064 6566 2061 6374 696f 6e5f  .    def action_
+00032940: 7265 7175 6573 745f 7175 6974 2873 656c  request_quit(sel
+00032950: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00032960: 2020 2020 7365 6c66 2e61 7070 2e65 7869      self.app.exi
+00032970: 7428 290a 0a0a 636c 6173 7320 5461 626c  t()...class Tabl
+00032980: 6541 7263 6869 7665 2841 7070 5b6c 6973  eArchive(App[lis
+00032990: 745d 293a 0a0a 2020 2020 4249 4e44 494e  t]):..    BINDIN
+000329a0: 4753 203d 205b 2822 7122 2c20 2272 6571  GS = [("q", "req
+000329b0: 7565 7374 5f71 7569 7422 2c20 2251 7569  uest_quit", "Qui
+000329c0: 7422 295d 0a0a 2020 2020 6465 6620 5f5f  t")]..    def __
+000329d0: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
+000329e0: 6573 3a20 6c69 7374 5b73 7472 5d29 3a0a  es: list[str]):.
+000329f0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00032a00: 5f5f 696e 6974 5f5f 2829 0a20 2020 2020  __init__().     
+00032a10: 2020 2073 656c 662e 6669 6c65 7320 3d20     self.files = 
+00032a20: 6669 6c65 730a 0a20 2020 2064 6566 2063  files..    def c
+00032a30: 6f6d 706f 7365 2873 656c 6629 202d 3e20  ompose(self) -> 
+00032a40: 436f 6d70 6f73 6552 6573 756c 743a 0a20  ComposeResult:. 
+00032a50: 2020 2020 2020 2074 6162 6c65 203d 2044         table = D
+00032a60: 6174 6154 6162 6c65 2829 0a20 2020 2020  ataTable().     
+00032a70: 2020 2074 6162 6c65 2e66 6f63 7573 2829     table.focus()
+00032a80: 0a20 2020 2020 2020 2074 6162 6c65 2e7a  .        table.z
+00032a90: 6562 7261 5f73 7472 6970 6573 203d 2054  ebra_stripes = T
+00032aa0: 7275 650a 2020 2020 2020 2020 7461 626c  rue.        tabl
+00032ab0: 652e 6375 7273 6f72 5f74 7970 6520 3d20  e.cursor_type = 
+00032ac0: 2272 6f77 220a 2020 2020 2020 2020 7461  "row".        ta
+00032ad0: 626c 652e 7374 796c 6573 2e6d 6178 5f68  ble.styles.max_h
+00032ae0: 6569 6768 7420 3d20 2239 3976 6822 0a20  eight = "99vh". 
+00032af0: 2020 2020 2020 2023 2074 6162 6c65 2e66         # table.f
+00032b00: 6978 6564 5f72 6f77 7320 3d20 310a 2020  ixed_rows = 1.  
+00032b10: 2020 2020 2020 7969 656c 6420 7461 626c        yield tabl
+00032b20: 650a 2020 2020 2020 2020 7969 656c 6420  e.        yield 
+00032b30: 466f 6f74 6572 2829 0a0a 2020 2020 6465  Footer()..    de
+00032b40: 6620 6f6e 5f6d 6f75 6e74 2873 656c 6629  f on_mount(self)
+00032b50: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00032b60: 2020 7461 626c 6520 3d20 7365 6c66 2e71    table = self.q
+00032b70: 7565 7279 5f6f 6e65 2844 6174 6154 6162  uery_one(DataTab
+00032b80: 6c65 290a 2020 2020 2020 2020 726f 7773  le).        rows
+00032b90: 203d 2063 7376 2e72 6561 6465 7228 696f   = csv.reader(io
+00032ba0: 2e53 7472 696e 6749 4f28 7365 6c66 2e66  .StringIO(self.f
+00032bb0: 696c 6573 2929 0a20 2020 2020 2020 2074  iles)).        t
+00032bc0: 6162 6c65 2e61 6464 5f63 6f6c 756d 6e73  able.add_columns
+00032bd0: 282a 6e65 7874 2872 6f77 7329 290a 2020  (*next(rows)).  
+00032be0: 2020 2020 2020 7461 626c 652e 6164 645f        table.add_
+00032bf0: 726f 7773 2869 7465 7274 6f6f 6c73 2e69  rows(itertools.i
+00032c00: 736c 6963 6528 726f 7773 2c20 4d41 5848  slice(rows, MAXH
+00032c10: 4f54 5350 4f54 5329 290a 0a20 2020 2064  OTSPOTS))..    d
+00032c20: 6566 206f 6e5f 6461 7461 5f74 6162 6c65  ef on_data_table
+00032c30: 5f72 6f77 5f73 656c 6563 7465 6428 7365  _row_selected(se
+00032c40: 6c66 2c20 6576 656e 743a 2044 6174 6154  lf, event: DataT
+00032c50: 6162 6c65 2e52 6f77 5365 6c65 6374 6564  able.RowSelected
+00032c60: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00032c70: 2020 2073 656c 662e 6578 6974 2873 656c     self.exit(sel
+00032c80: 662e 7175 6572 795f 6f6e 6528 4461 7461  f.query_one(Data
+00032c90: 5461 626c 6529 2e67 6574 5f72 6f77 2865  Table).get_row(e
+00032ca0: 7665 6e74 2e72 6f77 5f6b 6579 2929 0a0a  vent.row_key))..
+00032cb0: 2020 2020 6465 6620 6163 7469 6f6e 5f72      def action_r
+00032cc0: 6571 7565 7374 5f71 7569 7428 7365 6c66  equest_quit(self
+00032cd0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00032ce0: 2020 2073 656c 662e 6170 702e 6578 6974     self.app.exit
+00032cf0: 2829 0a0a 0a63 6c61 7373 2054 6162 6c65  ()...class Table
+00032d00: 4e49 4847 7261 6e74 7328 4170 705b 6c69  NIHGrants(App[li
+00032d10: 7374 5d29 3a0a 0a20 2020 2044 4546 4155  st]):..    DEFAU
+00032d20: 4c54 5f43 5353 203d 2022 2222 0a20 2020  LT_CSS = """.   
+00032d30: 2049 6e70 7574 2e2d 7661 6c69 6420 7b0a   Input.-valid {.
+00032d40: 2020 2020 2020 2020 626f 7264 6572 3a20          border: 
+00032d50: 7461 6c6c 2024 7375 6363 6573 7320 3630  tall $success 60
+00032d60: 253b 0a20 2020 207d 0a20 2020 2049 6e70  %;.    }.    Inp
+00032d70: 7574 2e2d 7661 6c69 643a 666f 6375 7320  ut.-valid:focus 
+00032d80: 7b0a 2020 2020 2020 2020 626f 7264 6572  {.        border
+00032d90: 3a20 7461 6c6c 2024 7375 6363 6573 733b  : tall $success;
+00032da0: 0a20 2020 207d 0a20 2020 2049 6e70 7574  .    }.    Input
+00032db0: 207b 0a20 2020 2020 2020 206d 6172 6769   {.        margi
+00032dc0: 6e3a 2031 2031 3b0a 2020 2020 7d0a 2020  n: 1 1;.    }.  
+00032dd0: 2020 4c61 6265 6c20 7b0a 2020 2020 2020    Label {.      
+00032de0: 2020 6d61 7267 696e 3a20 3120 323b 0a20    margin: 1 2;. 
+00032df0: 2020 207d 0a20 2020 2044 6174 6154 6162     }.    DataTab
+00032e00: 6c65 207b 0a20 2020 2020 2020 206d 6172  le {.        mar
+00032e10: 6769 6e3a 2031 2032 3b0a 2020 2020 7d0a  gin: 1 2;.    }.
+00032e20: 2020 2020 2222 220a 0a20 2020 2042 494e      """..    BIN
+00032e30: 4449 4e47 5320 3d20 5b28 2271 222c 2022  DINGS = [("q", "
+00032e40: 7265 7175 6573 745f 7175 6974 222c 2022  request_quit", "
+00032e50: 5175 6974 2229 5d0a 0a20 2020 2064 6566  Quit")]..    def
+00032e60: 2063 6f6d 706f 7365 2873 656c 6629 202d   compose(self) -
+00032e70: 3e20 436f 6d70 6f73 6552 6573 756c 743a  > ComposeResult:
+00032e80: 0a20 2020 2020 2020 2079 6965 6c64 204c  .        yield L
+00032e90: 6162 656c 2822 456e 7465 7220 7365 6172  abel("Enter sear
+00032ea0: 6368 2074 6f20 6c69 6e6b 2079 6f75 7220  ch to link your 
+00032eb0: 6461 7461 2077 6974 6820 6d65 7461 6461  data with metada
+00032ec0: 7461 206f 6620 616e 204e 4948 2067 7261  ta of an NIH gra
+00032ed0: 6e74 2f70 726f 6a65 6374 2061 6e64 2070  nt/project and p
+00032ee0: 7265 7373 2045 6e74 6572 2229 0a20 2020  ress Enter").   
+00032ef0: 2020 2020 2079 6965 6c64 2049 6e70 7574       yield Input
+00032f00: 280a 2020 2020 2020 2020 2020 2020 706c  (.            pl
+00032f10: 6163 6568 6f6c 6465 723d 2245 6e74 6572  aceholder="Enter
+00032f20: 2061 2070 6172 7420 6f66 2061 2047 7261   a part of a Gra
+00032f30: 6e74 204e 756d 6265 722c 2050 492c 2049  nt Number, PI, I
+00032f40: 6e73 7469 7475 7469 6f6e 206f 7220 4675  nstitution or Fu
+00032f50: 6c6c 2054 6578 7420 2854 6974 6c65 2c20  ll Text (Title, 
+00032f60: 4162 7374 7261 6374 2c20 5465 726d 7329  Abstract, Terms)
+00032f70: 202e 2e2e 222c 0a20 2020 2020 2020 2029   ...",.        )
+00032f80: 0a20 2020 2020 2020 2079 6965 6c64 204c  .        yield L
+00032f90: 6f61 6469 6e67 496e 6469 6361 746f 7228  oadingIndicator(
+00032fa0: 290a 2020 2020 2020 2020 7461 626c 6520  ).        table 
+00032fb0: 3d20 4461 7461 5461 626c 6528 290a 2020  = DataTable().  
+00032fc0: 2020 2020 2020 2320 7461 626c 652e 666f        # table.fo
+00032fd0: 6375 7328 290a 2020 2020 2020 2020 7461  cus().        ta
+00032fe0: 626c 652e 7a65 6272 615f 7374 7269 7065  ble.zebra_stripe
+00032ff0: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
+00033000: 2074 6162 6c65 2e63 7572 736f 725f 7479   table.cursor_ty
+00033010: 7065 203d 2022 726f 7722 0a20 2020 2020  pe = "row".     
+00033020: 2020 2074 6162 6c65 2e73 7479 6c65 732e     table.styles.
+00033030: 6d61 785f 6865 6967 6874 203d 2022 3939  max_height = "99
+00033040: 7668 220a 2020 2020 2020 2020 7969 656c  vh".        yiel
+00033050: 6420 7461 626c 650a 2020 2020 2020 2020  d table.        
+00033060: 2320 7969 656c 6420 466f 6f74 6572 2829  # yield Footer()
+00033070: 0a0a 2020 2020 6465 6620 6f6e 5f6d 6f75  ..    def on_mou
+00033080: 6e74 2873 656c 6629 202d 3e20 4e6f 6e65  nt(self) -> None
+00033090: 3a0a 2020 2020 2020 2020 7365 6c66 2e71  :.        self.q
+000330a0: 7565 7279 5f6f 6e65 284c 6f61 6469 6e67  uery_one(Loading
+000330b0: 496e 6469 6361 746f 7229 2e64 6973 706c  Indicator).displ
+000330c0: 6179 203d 2046 616c 7365 0a20 2020 2020  ay = False.     
+000330d0: 2020 2073 656c 662e 7175 6572 795f 6f6e     self.query_on
+000330e0: 6528 4461 7461 5461 626c 6529 2e64 6973  e(DataTable).dis
+000330f0: 706c 6179 203d 2046 616c 7365 0a0a 2020  play = False..  
+00033100: 2020 406f 6e28 496e 7075 742e 5375 626d    @on(Input.Subm
+00033110: 6974 7465 6429 0a20 2020 2064 6566 2061  itted).    def a
+00033120: 6374 696f 6e5f 7375 626d 6974 2873 656c  ction_submit(sel
+00033130: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00033140: 2e71 7565 7279 5f6f 6e65 284c 6f61 6469  .query_one(Loadi
+00033150: 6e67 496e 6469 6361 746f 7229 2e64 6973  ngIndicator).dis
+00033160: 706c 6179 203d 2054 7275 650a 2020 2020  play = True.    
+00033170: 2020 2020 7365 6c66 2e71 7565 7279 5f6f      self.query_o
+00033180: 6e65 2844 6174 6154 6162 6c65 292e 6469  ne(DataTable).di
+00033190: 7370 6c61 7920 3d20 4661 6c73 650a 2020  splay = False.  
+000331a0: 2020 2020 2020 696e 7020 3d20 7365 6c66        inp = self
+000331b0: 2e71 7565 7279 5f6f 6e65 2849 6e70 7574  .query_one(Input
+000331c0: 290a 2020 2020 2020 2020 6966 2069 6e70  ).        if inp
+000331d0: 2e76 616c 7565 3a0a 2020 2020 2020 2020  .value:.        
+000331e0: 2020 2020 7365 6c66 2e6c 6f61 645f 6461      self.load_da
+000331f0: 7461 2869 6e70 2e76 616c 7565 290a 2020  ta(inp.value).  
+00033200: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00033210: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
+00033220: 2e65 7869 7428 5b5d 290a 2020 2020 2020  .exit([]).      
+00033230: 2020 696e 702e 666f 6375 7328 290a 0a20    inp.focus().. 
+00033240: 2020 2064 6566 206f 6e5f 6461 7461 5f74     def on_data_t
+00033250: 6162 6c65 5f72 6f77 5f73 656c 6563 7465  able_row_selecte
+00033260: 6428 7365 6c66 2c20 6576 656e 743a 2044  d(self, event: D
+00033270: 6174 6154 6162 6c65 2e52 6f77 5365 6c65  ataTable.RowSele
+00033280: 6374 6564 2920 2d3e 204e 6f6e 653a 0a20  cted) -> None:. 
+00033290: 2020 2020 2020 2073 656c 662e 6578 6974         self.exit
+000332a0: 2873 656c 662e 7175 6572 795f 6f6e 6528  (self.query_one(
+000332b0: 4461 7461 5461 626c 6529 2e67 6574 5f72  DataTable).get_r
+000332c0: 6f77 2865 7665 6e74 2e72 6f77 5f6b 6579  ow(event.row_key
+000332d0: 2929 0a0a 2020 2020 6465 6620 6163 7469  ))..    def acti
+000332e0: 6f6e 5f72 6571 7565 7374 5f71 7569 7428  on_request_quit(
+000332f0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00033300: 2020 2020 2020 2073 656c 662e 6170 702e         self.app.
+00033310: 6578 6974 285b 5d29 0a0a 2020 2020 4077  exit([])..    @w
+00033320: 6f72 6b0a 2020 2020 6173 796e 6320 6465  ork.    async de
+00033330: 6620 6c6f 6164 5f64 6174 6128 7365 6c66  f load_data(self
+00033340: 2c20 7365 6172 6368 7374 7229 3a0a 2020  , searchstr):.  
+00033350: 2020 2020 2020 7461 626c 6520 3d20 7365        table = se
+00033360: 6c66 2e71 7565 7279 5f6f 6e65 2844 6174  lf.query_one(Dat
+00033370: 6154 6162 6c65 290a 2020 2020 2020 2020  aTable).        
+00033380: 7461 626c 652e 636c 6561 7228 636f 6c75  table.clear(colu
+00033390: 6d6e 733d 5472 7565 290a 0a20 2020 2020  mns=True)..     
+000333a0: 2020 2061 7761 6974 2061 7379 6e63 696f     await asyncio
+000333b0: 2e73 6c65 6570 2830 2e31 290a 0a20 2020  .sleep(0.1)..   
+000333c0: 2020 2020 2072 6570 203d 204e 4948 5265       rep = NIHRe
+000333d0: 706f 7274 6572 2829 0a20 2020 2020 2020  porter().       
+000333e0: 2064 6174 6120 3d20 7265 702e 7365 6172   data = rep.sear
+000333f0: 6368 5f66 756c 6c28 7365 6172 6368 7374  ch_full(searchst
+00033400: 7229 0a20 2020 2020 2020 2069 6620 6e6f  r).        if no
+00033410: 7420 6461 7461 3a0a 2020 2020 2020 2020  t data:.        
+00033420: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00033430: 2020 2072 6f77 7320 3d20 6974 6572 2864     rows = iter(d
+00033440: 6174 6129 0a0a 2020 2020 2020 2020 7461  ata)..        ta
+00033450: 626c 652e 6164 645f 636f 6c75 6d6e 7328  ble.add_columns(
+00033460: 2a6e 6578 7428 726f 7773 2929 0a20 2020  *next(rows)).   
+00033470: 2020 2020 2074 6162 6c65 2e61 6464 5f72       table.add_r
+00033480: 6f77 7328 726f 7773 290a 0a20 2020 2020  ows(rows)..     
+00033490: 2020 2074 6162 6c65 2e64 6973 706c 6179     table.display
+000334a0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000334b0: 7365 6c66 2e71 7565 7279 5f6f 6e65 284c  self.query_one(L
+000334c0: 6f61 6469 6e67 496e 6469 6361 746f 7229  oadingIndicator)
+000334d0: 2e64 6973 706c 6179 203d 2046 616c 7365  .display = False
+000334e0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000334f0: 0a0a 0a63 6c61 7373 2052 636c 6f6e 653a  ...class Rclone:
+00033500: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00033510: 5f28 7365 6c66 2c20 6172 6773 3a20 6172  _(self, args: ar
+00033520: 6770 6172 7365 2e4e 616d 6573 7061 6365  gparse.Namespace
+00033530: 2c20 6366 673a 2043 6f6e 6669 674d 616e  , cfg: ConfigMan
+00033540: 6167 6572 293a 0a20 2020 2020 2020 2027  ager):.        '
+00033550: 2727 496e 6974 6961 6c69 7a65 2052 636c  ''Initialize Rcl
+00033560: 6f6e 6520 6f62 6a65 6374 2727 270a 0a20  one object'''.. 
+00033570: 2020 2020 2020 2023 2053 746f 7265 2074         # Store t
+00033580: 6865 2061 7267 756d 656e 7473 2061 6e64  he arguments and
+00033590: 2063 6f6e 6669 6775 7261 7469 6f6e 0a20   configuration. 
+000335a0: 2020 2020 2020 2073 656c 662e 6172 6773         self.args
+000335b0: 203d 2061 7267 730a 2020 2020 2020 2020   = args.        
+000335c0: 7365 6c66 2e63 6667 203d 2063 6667 0a0a  self.cfg = cfg..
+000335d0: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
+000335e0: 6520 5263 6c6f 6e65 2065 7865 6375 7461  e Rclone executa
+000335f0: 626c 6520 7061 7468 0a20 2020 2020 2020  ble path.       
+00033600: 2073 656c 662e 7263 203d 206f 732e 7061   self.rc = os.pa
+00033610: 7468 2e6a 6f69 6e28 7379 732e 7072 6566  th.join(sys.pref
+00033620: 6978 2c20 2762 696e 272c 2027 7263 6c6f  ix, 'bin', 'rclo
+00033630: 6e65 2729 0a0a 2020 2020 2020 2020 2320  ne')..        # 
+00033640: 5365 7420 7468 6520 5263 6c6f 6e65 2065  Set the Rclone e
+00033650: 6e76 6972 6f6e 6d65 6e74 2076 6172 6961  nvironment varia
+00033660: 626c 6573 0a20 2020 2020 2020 2023 204e  bles.        # N
+00033670: 6f74 653a 204b 6579 7320 6172 6520 7365  ote: Keys are se
+00033680: 7420 696e 2074 6865 2041 5753 2042 6f74  t in the AWS Bot
+00033690: 6f20 5f5f 696e 6974 5f5f 2066 756e 6374  o __init__ funct
+000336a0: 696f 6e0a 2020 2020 2020 2020 7365 6c66  ion.        self
+000336b0: 2e65 6e76 726e 203d 207b 7d0a 2020 2020  .envrn = {}.    
+000336c0: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
+000336d0: 5243 4c4f 4e45 5f53 335f 454e 565f 4155  RCLONE_S3_ENV_AU
+000336e0: 5448 275d 203d 2027 7472 7565 270a 2020  TH'] = 'true'.  
+000336f0: 2020 2020 2020 7365 6c66 2e65 6e76 726e        self.envrn
+00033700: 5b27 5243 4c4f 4e45 5f53 335f 5052 4f56  ['RCLONE_S3_PROV
+00033710: 4944 4552 275d 203d 2027 4157 5327 0a20  IDER'] = 'AWS'. 
+00033720: 2020 2020 2020 2073 656c 662e 656e 7672         self.envr
+00033730: 6e5b 2752 434c 4f4e 455f 5333 5f52 4547  n['RCLONE_S3_REG
+00033740: 494f 4e27 5d20 3d20 7365 6c66 2e63 6667  ION'] = self.cfg
+00033750: 2e61 7773 5f72 6567 696f 6e0a 2020 2020  .aws_region.    
+00033760: 2020 2020 7365 6c66 2e65 6e76 726e 5b27      self.envrn['
+00033770: 5243 4c4f 4e45 5f53 335f 4c4f 4341 5449  RCLONE_S3_LOCATI
+00033780: 4f4e 5f43 4f4e 5354 5241 494e 5427 5d20  ON_CONSTRAINT'] 
+00033790: 3d20 7365 6c66 2e63 6667 2e61 7773 5f72  = self.cfg.aws_r
+000337a0: 6567 696f 6e0a 2020 2020 2020 2020 7365  egion.        se
+000337b0: 6c66 2e65 6e76 726e 5b27 5243 4c4f 4e45  lf.envrn['RCLONE
+000337c0: 5f53 335f 5354 4f52 4147 455f 434c 4153  _S3_STORAGE_CLAS
+000337d0: 5327 5d20 3d20 7365 6c66 2e63 6667 2e73  S'] = self.cfg.s
+000337e0: 746f 7261 6765 5f63 6c61 7373 0a0a 2020  torage_class..  
+000337f0: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
+00033800: 6372 6564 656e 7469 616c 7320 666f 7220  credentials for 
+00033810: 4157 530a 2020 2020 2020 2020 6966 2073  AWS.        if s
+00033820: 656c 662e 6366 672e 6177 735f 696e 6974  elf.cfg.aws_init
+00033830: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00033840: 2043 7265 6174 6520 6120 436f 6e66 6967   Create a Config
+00033850: 5061 7273 6572 206f 626a 6563 740a 2020  Parser object.  
+00033860: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00033870: 203d 2063 6f6e 6669 6770 6172 7365 722e   = configparser.
+00033880: 436f 6e66 6967 5061 7273 6572 2829 0a0a  ConfigParser()..
+00033890: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+000338a0: 6164 2041 5753 2043 7265 6465 6e74 6961  ad AWS Credentia
+000338b0: 6c73 2066 696c 650a 2020 2020 2020 2020  ls file.        
+000338c0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+000338d0: 7869 7374 7328 7365 6c66 2e63 6667 2e61  xists(self.cfg.a
+000338e0: 7773 5f63 7265 6465 6e74 6961 6c73 5f66  ws_credentials_f
+000338f0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+00033900: 2020 2020 2020 636f 6e66 6967 2e72 6561        config.rea
+00033910: 6428 7365 6c66 2e63 6667 2e61 7773 5f63  d(self.cfg.aws_c
+00033920: 7265 6465 6e74 6961 6c73 5f66 696c 6529  redentials_file)
+00033930: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00033940: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
+00033950: 2041 5753 2070 726f 6669 6c65 2065 7869   AWS profile exi
+00033960: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
+00033970: 2020 2020 6966 2063 6f6e 6669 672e 6861      if config.ha
+00033980: 735f 7365 6374 696f 6e28 7365 6c66 2e63  s_section(self.c
+00033990: 6667 2e61 7773 5f70 726f 6669 6c65 293a  fg.aws_profile):
+000339a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000339b0: 2020 2020 2023 2053 6574 2074 6865 2065       # Set the e
+000339c0: 6e76 6972 6f6e 6d65 6e74 2076 6172 6961  nvironment varia
+000339d0: 626c 6573 2066 6f72 2063 7265 6473 0a20  bles for creds. 
+000339e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000339f0: 2020 2073 656c 662e 656e 7672 6e5b 2741     self.envrn['A
+00033a00: 5753 5f41 4343 4553 535f 4b45 595f 4944  WS_ACCESS_KEY_ID
+00033a10: 275d 203d 2063 6f6e 6669 672e 6765 7428  '] = config.get(
+00033a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033a30: 2020 2020 2020 2020 2073 656c 662e 6366           self.cf
+00033a40: 672e 6177 735f 7072 6f66 696c 652c 2027  g.aws_profile, '
+00033a50: 6177 735f 6163 6365 7373 5f6b 6579 5f69  aws_access_key_i
+00033a60: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+00033a70: 2020 2020 2020 2020 7365 6c66 2e65 6e76          self.env
+00033a80: 726e 5b27 4157 535f 5345 4352 4554 5f41  rn['AWS_SECRET_A
+00033a90: 4343 4553 535f 4b45 5927 5d20 3d20 636f  CCESS_KEY'] = co
+00033aa0: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
+00033ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ac0: 2020 7365 6c66 2e63 6667 2e61 7773 5f70    self.cfg.aws_p
+00033ad0: 726f 6669 6c65 2c20 2761 7773 5f73 6563  rofile, 'aws_sec
+00033ae0: 7265 745f 6163 6365 7373 5f6b 6579 2729  ret_access_key')
+00033af0: 0a0a 2020 2020 2320 656e 7375 7265 2074  ..    # ensure t
+00033b00: 6861 7420 6669 6c65 2065 7869 7374 7320  hat file exists 
+00033b10: 6f72 206e 6167 6769 6e67 202f 686f 6d65  or nagging /home
+00033b20: 2f64 702f 2e63 6f6e 6669 672f 7263 6c6f  /dp/.config/rclo
+00033b30: 6e65 2f72 636c 6f6e 652e 636f 6e66 0a0a  ne/rclone.conf..
+00033b40: 2020 2020 2320 6261 636b 7570 3a20 7263      # backup: rc
+00033b50: 6c6f 6e65 202d 2d76 6572 626f 7365 202d  lone --verbose -
+00033b60: 2d66 696c 6573 2d66 726f 6d20 746d 7066  -files-from tmpf
+00033b70: 696c 6520 2d2d 7573 652d 6a73 6f6e 2d6c  ile --use-json-l
+00033b80: 6f67 2063 6f70 7920 2d2d 6d61 782d 6465  og copy --max-de
+00033b90: 7074 6820 3120 2e2f 7465 7374 732f 203a  pth 1 ./tests/ :
+00033ba0: 7333 3a70 6f73 6978 2d64 702f 7465 7374  s3:posix-dp/test
+00033bb0: 7334 2f20 2d2d 6578 636c 7564 6520 2e66  s4/ --exclude .f
+00033bc0: 726f 7374 6572 2e6d 6435 7375 6d0a 2020  roster.md5sum.  
+00033bd0: 2020 2320 7265 7374 6f72 653a 2072 636c    # restore: rcl
+00033be0: 6f6e 6520 2d2d 7665 7262 6f73 6520 2d2d  one --verbose --
+00033bf0: 7573 652d 6a73 6f6e 2d6c 6f67 2063 6f70  use-json-log cop
+00033c00: 7920 2d2d 6d61 782d 6465 7074 6820 3120  y --max-depth 1 
+00033c10: 3a73 333a 706f 7369 782d 6470 2f74 6573  :s3:posix-dp/tes
+00033c20: 7473 342f 202e 2f74 6573 7473 320a 2020  ts4/ ./tests2.  
+00033c30: 2020 2320 7263 6c6f 6e65 2063 6f70 7920    # rclone copy 
+00033c40: 2d2d 7665 7262 6f73 6520 2d2d 7573 652d  --verbose --use-
+00033c50: 6a73 6f6e 2d6c 6f67 202d 2d6d 6178 2d64  json-log --max-d
+00033c60: 6570 7468 2031 2020 3a73 333a 706f 7369  epth 1  :s3:posi
+00033c70: 782d 6470 2f74 6573 7473 352f 202e 2f74  x-dp/tests5/ ./t
+00033c80: 6573 7473 350a 2020 2020 2320 7263 6c6f  ests5.    # rclo
+00033c90: 6e65 202d 2d75 7365 2d6a 736f 6e2d 6c6f  ne --use-json-lo
+00033ca0: 6720 6368 6563 6b73 756d 206d 6435 202e  g checksum md5 .
+00033cb0: 2f74 6573 7473 2f2e 6672 6f73 7465 722e  /tests/.froster.
+00033cc0: 6d64 3573 756d 203a 7333 3a70 6f73 6978  md5sum :s3:posix
+00033cd0: 2d64 702f 7465 7374 7332 2f0a 2020 2020  -dp/tests2/.    
+00033ce0: 2320 7374 6f72 6167 6520 7469 6572 2066  # storage tier f
+00033cf0: 6f72 2065 6163 6820 6669 6c65 0a20 2020  or each file.   
+00033d00: 2023 2072 636c 6f6e 6520 6c73 6620 2d2d   # rclone lsf --
+00033d10: 6373 7620 3a73 333a 706f 7369 782d 6470  csv :s3:posix-dp
+00033d20: 2f74 6573 7473 342f 202d 2d66 6f72 6d61  /tests4/ --forma
+00033d30: 743d 7054 0a20 2020 2023 206c 6973 7420  t=pT.    # list 
+00033d40: 7769 7468 6f75 7420 7375 6264 6972 0a20  without subdir. 
+00033d50: 2020 2023 2072 636c 6f6e 6520 6c73 6a73     # rclone lsjs
+00033d60: 6f6e 202d 2d6d 6574 6164 6174 6120 2d2d  on --metadata --
+00033d70: 6e6f 2d6d 696d 6574 7970 6520 2d2d 6e6f  no-mimetype --no
+00033d80: 2d6d 6f64 7469 6d65 202d 2d68 6173 6820  -modtime --hash 
+00033d90: 3a73 333a 706f 7369 782d 6470 2f74 6573  :s3:posix-dp/tes
+00033da0: 7473 340a 2020 2020 2320 7263 6c6f 6e65  ts4.    # rclone
+00033db0: 2063 6865 636b 7375 6d20 6d64 3520 2e2f   checksum md5 ./
+00033dc0: 7465 7374 732f 2e66 726f 7374 6572 2e6d  tests/.froster.m
+00033dd0: 6435 7375 6d20 2d2d 7665 7262 6f73 6520  d5sum --verbose 
+00033de0: 2d2d 7573 652d 6a73 6f6e 2d6c 6f67 203a  --use-json-log :
+00033df0: 7333 3a70 6f73 6978 2d64 702f 6172 6368  s3:posix-dp/arch
+00033e00: 6976 652f 686f 6d65 2f64 702f 6768 2f66  ive/home/dp/gh/f
+00033e10: 726f 7374 6572 2f74 6573 7473 0a0a 2020  roster/tests..  
+00033e20: 2020 6465 6620 5f72 756e 5f72 636c 6f6e    def _run_rclon
+00033e30: 655f 636f 6d6d 616e 6428 7365 6c66 2c20  e_command(self, 
+00033e40: 636f 6d6d 616e 642c 2062 6163 6b67 726f  command, backgro
+00033e50: 756e 643d 4661 6c73 6529 3a0a 2020 2020  und=False):.    
+00033e60: 2020 2020 2727 2752 756e 2052 636c 6f6e      '''Run Rclon
+00033e70: 6520 636f 6d6d 616e 6427 2727 0a20 2020  e command'''.   
+00033e80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00033e90: 2020 2020 2020 2320 4164 6420 6f70 7469        # Add opti
+00033ea0: 6f6e 7320 746f 2052 636c 6f6e 6520 636f  ons to Rclone co
+00033eb0: 6d6d 616e 640a 2020 2020 2020 2020 2020  mmand.          
+00033ec0: 2020 636f 6d6d 616e 6420 3d20 7365 6c66    command = self
+00033ed0: 2e5f 6164 645f 6f70 7428 636f 6d6d 616e  ._add_opt(comman
+00033ee0: 642c 2027 2d2d 7665 7262 6f73 6527 290a  d, '--verbose').
+00033ef0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+00033f00: 616e 6420 3d20 7365 6c66 2e5f 6164 645f  and = self._add_
+00033f10: 6f70 7428 636f 6d6d 616e 642c 2027 2d2d  opt(command, '--
+00033f20: 7573 652d 6a73 6f6e 2d6c 6f67 2729 0a20  use-json-log'). 
+00033f30: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
+00033f40: 6e64 203d 2073 656c 662e 5f61 6464 5f6f  nd = self._add_o
+00033f50: 7074 2863 6f6d 6d61 6e64 2c20 272d 2d70  pt(command, '--p
+00033f60: 726f 6772 6573 7327 290a 0a20 2020 2020  rogress')..     
+00033f70: 2020 2020 2020 2023 2052 756e 2074 6865         # Run the
+00033f80: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+00033f90: 2020 2020 2069 6620 6261 636b 6772 6f75       if backgrou
+00033fa0: 6e64 3a0a 0a20 2020 2020 2020 2020 2020  nd:..           
+00033fb0: 2020 2020 2023 2054 6869 7320 6973 2074       # This is t
+00033fc0: 6865 2073 6f6c 7574 696f 6e20 6920 666f  he solution i fo
+00033fd0: 756e 6420 746f 2070 7265 7665 6e74 2074  und to prevent t
+00033fe0: 6865 2070 6f70 656e 2073 7562 7072 6f63  he popen subproc
+00033ff0: 6573 7320 746f 2074 6872 6f77 2065 7272  ess to throw err
+00034000: 6f72 7320 6475 650a 2020 2020 2020 2020  ors due.        
+00034010: 2020 2020 2020 2020 2320 6f75 7220 7061          # our pa
+00034020: 7274 6963 756c 6172 2075 7361 6765 206f  rticular usage o
+00034030: 6620 7263 6c6f 6e65 2e0a 2020 2020 2020  f rclone..      
+00034040: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00034050: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+00034060: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+00034070: 7075 743a 0a20 2020 2020 2020 2020 2020  put:.           
+00034080: 2020 2020 2020 2020 2023 2050 7269 6e74           # Print
+00034090: 206f 7574 7075 7420 696e 2073 7464 6f75   output in stdou
+000340a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000340b0: 2020 2020 2020 7265 7420 3d20 7375 6270        ret = subp
+000340c0: 726f 6365 7373 2e50 6f70 656e 280a 2020  rocess.Popen(.  
+000340d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000340e0: 2020 2020 2020 636f 6d6d 616e 642c 2073        command, s
+000340f0: 7464 696e 3d73 7562 7072 6f63 6573 732e  tdin=subprocess.
+00034100: 5049 5045 2c20 7374 646f 7574 3d73 7562  PIPE, stdout=sub
+00034110: 7072 6f63 6573 732e 5049 5045 2c20 7465  process.PIPE, te
+00034120: 7874 3d54 7275 652c 2065 6e76 3d73 656c  xt=True, env=sel
+00034130: 662e 656e 7672 6e29 0a0a 2020 2020 2020  f.envrn)..      
+00034140: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00034150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034160: 2020 2020 2320 444f 206e 6f74 2070 7269      # DO not pri
+00034170: 6e74 206f 7574 7075 740a 2020 2020 2020  nt output.      
+00034180: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00034190: 7468 206f 7065 6e28 6f73 2e64 6576 6e75  th open(os.devnu
+000341a0: 6c6c 2c20 2777 2729 2061 7320 6465 766e  ll, 'w') as devn
+000341b0: 756c 6c3a 0a20 2020 2020 2020 2020 2020  ull:.           
+000341c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000341d0: 203d 2073 7562 7072 6f63 6573 732e 506f   = subprocess.Po
+000341e0: 7065 6e28 0a20 2020 2020 2020 2020 2020  pen(.           
+000341f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034200: 2063 6f6d 6d61 6e64 2c20 7374 646f 7574   command, stdout
+00034210: 3d64 6576 6e75 6c6c 2c20 7374 6465 7272  =devnull, stderr
+00034220: 3d64 6576 6e75 6c6c 2c20 7465 7874 3d54  =devnull, text=T
+00034230: 7275 652c 2065 6e76 3d73 656c 662e 656e  rue, env=self.en
+00034240: 7672 6e29 0a0a 2020 2020 2020 2020 2020  vrn)..          
+00034250: 2020 2020 2020 2320 4966 2077 6520 6861        # If we ha
+00034260: 7665 2061 2070 6964 2077 6520 6173 7375  ve a pid we assu
+00034270: 6d65 2074 6865 2063 6f6d 6d61 6e64 2077  me the command w
+00034280: 6173 2073 7563 6365 7373 6675 6c0a 2020  as successful.  
+00034290: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000342a0: 2072 6574 2e70 6964 3a0a 2020 2020 2020   ret.pid:.      
+000342b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000342c0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+000342d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000342e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000342f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00034300: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00034310: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00034320: 2020 2020 7265 7420 3d20 7375 6270 726f      ret = subpro
+00034330: 6365 7373 2e72 756e 280a 2020 2020 2020  cess.run(.      
+00034340: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00034350: 6d6d 616e 642c 2063 6170 7475 7265 5f6f  mmand, capture_o
+00034360: 7574 7075 743d 5472 7565 2c20 7465 7874  utput=True, text
+00034370: 3d54 7275 652c 2065 6e76 3d73 656c 662e  =True, env=self.
+00034380: 656e 7672 6e29 0a0a 2020 2020 2020 2020  envrn)..        
+00034390: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+000343a0: 6966 2074 6865 2063 6f6d 6d61 6e64 2077  if the command w
+000343b0: 6173 2073 7563 6365 7373 6675 6c0a 2020  as successful.  
+000343c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000343d0: 2072 6574 2e72 6574 7572 6e63 6f64 6520   ret.returncode 
+000343e0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+000343f0: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
+00034400: 7574 696f 6e20 7375 6363 6573 7366 756c  ution successful
+00034410: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00034420: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00034430: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00034440: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00034450: 2020 2020 2020 2020 2020 2020 2320 4578              # Ex
+00034460: 6563 7574 696f 6e20 6661 696c 6564 0a20  ecution failed. 
+00034470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034480: 2020 2065 7869 745f 636f 6465 7320 3d20     exit_codes = 
+00034490: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000344a0: 2020 2020 2020 2020 2020 303a 2022 5375            0: "Su
+000344b0: 6363 6573 7322 2c0a 2020 2020 2020 2020  ccess",.        
+000344c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000344d0: 313a 2022 5379 6e74 6178 206f 7220 7573  1: "Syntax or us
+000344e0: 6167 6520 6572 726f 7222 2c0a 2020 2020  age error",.    
+000344f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034500: 2020 2020 323a 2022 4572 726f 7220 6e6f      2: "Error no
+00034510: 7420 6f74 6865 7277 6973 6520 6361 7465  t otherwise cate
+00034520: 676f 7269 7365 6422 2c0a 2020 2020 2020  gorised",.      
+00034530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034540: 2020 333a 2022 4469 7265 6374 6f72 7920    3: "Directory 
+00034550: 6e6f 7420 666f 756e 6422 2c0a 2020 2020  not found",.    
+00034560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034570: 2020 2020 343a 2022 4669 6c65 206e 6f74      4: "File not
+00034580: 2066 6f75 6e64 222c 0a20 2020 2020 2020   found",.       
+00034590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000345a0: 2035 3a20 2254 656d 706f 7261 7279 2065   5: "Temporary e
+000345b0: 7272 6f72 2028 6f6e 6520 7468 6174 206d  rror (one that m
+000345c0: 6f72 6520 7265 7472 6965 7320 6d69 6768  ore retries migh
+000345d0: 7420 6669 7829 2028 5265 7472 7920 6572  t fix) (Retry er
+000345e0: 726f 7273 2922 2c0a 2020 2020 2020 2020  rors)",.        
+000345f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034600: 363a 2022 4c65 7373 2073 6572 696f 7573  6: "Less serious
+00034610: 2065 7272 6f72 7320 286c 696b 6520 3436   errors (like 46
+00034620: 3120 6572 726f 7273 2066 726f 6d20 6472  1 errors from dr
+00034630: 6f70 626f 7829 2028 4e6f 5265 7472 7920  opbox) (NoRetry 
+00034640: 6572 726f 7273 2922 2c0a 2020 2020 2020  errors)",.      
+00034650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034660: 2020 373a 2022 4661 7461 6c20 6572 726f    7: "Fatal erro
+00034670: 7220 286f 6e65 2074 6861 7420 6d6f 7265  r (one that more
+00034680: 2072 6574 7269 6573 2077 6f6e 2774 2066   retries won't f
+00034690: 6978 2c20 6c69 6b65 2061 6363 6f75 6e74  ix, like account
+000346a0: 2073 7573 7065 6e64 6564 2920 2846 6174   suspended) (Fat
+000346b0: 616c 2065 7272 6f72 7329 222c 0a20 2020  al errors)",.   
+000346c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000346d0: 2020 2020 2038 3a20 2254 7261 6e73 6665       8: "Transfe
+000346e0: 7220 6578 6365 6564 6564 202d 206c 696d  r exceeded - lim
+000346f0: 6974 2073 6574 2062 7920 2d2d 6d61 782d  it set by --max-
+00034700: 7472 616e 7366 6572 2072 6561 6368 6564  transfer reached
+00034710: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00034720: 2020 2020 2020 2020 2020 2039 3a20 224f             9: "O
+00034730: 7065 7261 7469 6f6e 2073 7563 6365 7373  peration success
+00034740: 6675 6c2c 2062 7574 206e 6f20 6669 6c65  ful, but no file
+00034750: 7320 7472 616e 7366 6572 7265 6422 2c0a  s transferred",.
+00034760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034770: 2020 2020 7d0a 0a20 2020 2020 2020 2020      }..         
+00034780: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00034790: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000347a0: 2020 2020 2020 2020 2020 6627 5c6e 2020            f'\n  
+000347b0: 2020 2020 2020 4572 726f 723a 2052 636c        Error: Rcl
+000347c0: 6f6e 6520 7b63 6f6d 6d61 6e64 5b31 5d7d  one {command[1]}
+000347d0: 2063 6f6d 6d61 6e64 2066 6169 6c65 6427   command failed'
+000347e0: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
+000347f0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00034800: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00034810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034820: 2020 2020 2020 6627 2020 2020 2020 2020        f'        
+00034830: 436f 6d6d 616e 643a 207b 2220 222e 6a6f  Command: {" ".jo
+00034840: 696e 2863 6f6d 6d61 6e64 297d 272c 2066  in(command)}', f
+00034850: 696c 653d 7379 732e 7374 6465 7272 290a  ile=sys.stderr).
+00034860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034870: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00034880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034890: 2020 2066 2720 2020 2020 2020 2052 6574     f'        Ret
+000348a0: 7572 6e20 636f 6465 3a20 7b72 6574 2e72  urn code: {ret.r
+000348b0: 6574 7572 6e63 6f64 657d 272c 2066 696c  eturncode}', fil
+000348c0: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
+000348d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000348e0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+000348f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034900: 2066 2720 2020 2020 2020 2052 6574 7572   f'        Retur
+00034910: 6e20 636f 6465 206d 6561 6e69 6e67 3a20  n code meaning: 
+00034920: 7b65 7869 745f 636f 6465 735b 7265 742e  {exit_codes[ret.
+00034930: 7265 7475 726e 636f 6465 5d7d 5c6e 272c  returncode]}\n',
+00034940: 2066 696c 653d 7379 732e 7374 6465 7272   file=sys.stderr
+00034950: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00034960: 2020 2020 2020 206f 7574 2c20 6572 7220         out, err 
+00034970: 3d20 7265 742e 7374 646f 7574 2e73 7472  = ret.stdout.str
+00034980: 6970 2829 2c20 7265 742e 7374 6465 7272  ip(), ret.stderr
+00034990: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+000349a0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+000349b0: 7473 2c20 6f70 7320 3d20 7365 6c66 2e5f  ts, ops = self._
+000349c0: 7061 7273 655f 6c6f 6728 6572 7229 0a20  parse_log(err). 
+000349d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000349e0: 2020 2072 6574 203d 2073 7461 7473 5b2d     ret = stats[-
+000349f0: 315d 2020 2320 7265 7475 726e 2074 6865  1]  # return the
+00034a00: 2073 7461 7473 0a20 2020 2020 2020 2020   stats.         
+00034a10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00034a20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00034a30: 2020 2020 2020 2020 2020 6622 2020 2020            f"    
+00034a40: 2020 2020 4572 726f 7220 6d65 7373 6167      Error messag
+00034a50: 653a 207b 7265 745b 2773 7461 7473 275d  e: {ret['stats']
+00034a60: 5b27 6c61 7374 4572 726f 7227 5d7d 5c6e  ['lastError']}\n
+00034a70: 222c 2066 696c 653d 7379 732e 7374 6465  ", file=sys.stde
+00034a80: 7272 290a 0a20 2020 2020 2020 2020 2020  rr)..           
+00034a90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00034aa0: 4661 6c73 650a 0a20 2020 2020 2020 2065  False..        e
+00034ab0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00034ac0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00034ad0: 6e74 5f65 7272 6f72 2829 0a20 2020 2020  nt_error().     
+00034ae0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00034af0: 6c73 650a 0a20 2020 2064 6566 2063 6f70  lse..    def cop
+00034b00: 7928 7365 6c66 2c20 7372 632c 2064 7374  y(self, src, dst
+00034b10: 2c20 2a61 7267 7329 3a0a 2020 2020 2020  , *args):.      
+00034b20: 2020 2727 2743 6f70 7920 6669 6c65 7320    '''Copy files 
+00034b30: 6672 6f6d 2073 6f75 7263 6520 746f 2064  from source to d
+00034b40: 6573 7469 6e61 7469 6f6e 2075 7369 6e67  estination using
+00034b50: 2052 636c 6f6e 6527 2727 0a0a 2020 2020   Rclone'''..    
+00034b60: 2020 2020 2320 4275 696c 6420 7468 6520      # Build the 
+00034b70: 636f 7079 2063 6f6d 6d61 6e64 0a20 2020  copy command.   
+00034b80: 2020 2020 2063 6f6d 6d61 6e64 203d 205b       command = [
+00034b90: 7365 6c66 2e72 632c 2027 636f 7079 275d  self.rc, 'copy']
+00034ba0: 202b 206c 6973 7428 6172 6773 290a 2020   + list(args).  
+00034bb0: 2020 2020 2020 636f 6d6d 616e 642e 6170        command.ap
+00034bc0: 7065 6e64 2873 7263 290a 2020 2020 2020  pend(src).      
+00034bd0: 2020 636f 6d6d 616e 642e 6170 7065 6e64    command.append
+00034be0: 2864 7374 290a 0a20 2020 2020 2020 2023  (dst)..        #
+00034bf0: 2052 756e 2074 6865 2063 6f70 7920 636f   Run the copy co
+00034c00: 6d6d 616e 6420 616e 6420 7265 7475 726e  mmand and return
+00034c10: 2069 6620 6974 2077 6173 2073 7563 6365   if it was succe
+00034c20: 7373 6675 6c0a 2020 2020 2020 2020 7265  ssful.        re
+00034c30: 7475 726e 2073 656c 662e 5f72 756e 5f72  turn self._run_r
+00034c40: 636c 6f6e 655f 636f 6d6d 616e 6428 636f  clone_command(co
+00034c50: 6d6d 616e 6429 0a0a 2020 2020 6465 6620  mmand)..    def 
+00034c60: 6368 6563 6b73 756d 2873 656c 662c 206d  checksum(self, m
+00034c70: 6435 6669 6c65 2c20 6473 742c 202a 6172  d5file, dst, *ar
+00034c80: 6773 293a 0a20 2020 2020 2020 2027 2727  gs):.        '''
+00034c90: 4368 6563 6b20 7468 6520 6368 6563 6b73  Check the checks
+00034ca0: 756d 206f 6620 6120 6669 6c65 2075 7369  um of a file usi
+00034cb0: 6e67 2052 636c 6f6e 6527 2727 0a0a 2020  ng Rclone'''..  
+00034cc0: 2020 2020 2020 636f 6d6d 616e 6420 3d20        command = 
+00034cd0: 5b73 656c 662e 7263 2c20 2763 6865 636b  [self.rc, 'check
+00034ce0: 7375 6d27 5d20 2b20 6c69 7374 2861 7267  sum'] + list(arg
+00034cf0: 7329 0a20 2020 2020 2020 2063 6f6d 6d61  s).        comma
+00034d00: 6e64 2e61 7070 656e 6428 276d 6435 2729  nd.append('md5')
+00034d10: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
+00034d20: 2e61 7070 656e 6428 6d64 3566 696c 6529  .append(md5file)
+00034d30: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
+00034d40: 2e61 7070 656e 6428 6473 7429 0a0a 2020  .append(dst)..  
+00034d50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00034d60: 662e 5f72 756e 5f72 636c 6f6e 655f 636f  f._run_rclone_co
+00034d70: 6d6d 616e 6428 636f 6d6d 616e 6429 0a0a  mmand(command)..
+00034d80: 2020 2020 6465 6620 6d6f 756e 7428 7365      def mount(se
+00034d90: 6c66 2c20 7372 632c 2064 7374 2c20 2a61  lf, src, dst, *a
+00034da0: 7267 7329 3a0a 2020 2020 2020 2020 2727  rgs):.        ''
+00034db0: 274d 6f75 6e74 2066 696c 6573 2066 726f  'Mount files fro
+00034dc0: 6d20 7572 6c20 746f 206f 6e2d 7072 656d  m url to on-prem
+00034dd0: 6973 6573 2075 7369 6e67 2052 636c 6f6e  ises using Rclon
+00034de0: 6527 2727 0a0a 2020 2020 2020 2020 6966  e'''..        if
+00034df0: 206e 6f74 2073 6875 7469 6c2e 7768 6963   not shutil.whic
+00034e00: 6828 2766 7573 6572 6d6f 756e 7433 2729  h('fusermount3')
+00034e10: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00034e20: 696e 7428 2743 6f75 6c64 206e 6f74 2066  int('Could not f
+00034e30: 696e 6420 2266 7573 6572 6d6f 756e 7433  ind "fusermount3
+00034e40: 222e 2050 6c65 6173 6520 696e 7374 616c  ". Please instal
+00034e50: 6c20 7468 6520 2266 7573 6533 2220 4f53  l the "fuse3" OS
+00034e60: 2070 6163 6b61 6765 2729 0a20 2020 2020   package').     
+00034e70: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00034e80: 3129 0a0a 2020 2020 2020 2020 2320 4275  1)..        # Bu
+00034e90: 696c 6420 7468 6520 636f 7079 2063 6f6d  ild the copy com
+00034ea0: 6d61 6e64 0a20 2020 2020 2020 2063 6f6d  mand.        com
+00034eb0: 6d61 6e64 203d 205b 7365 6c66 2e72 632c  mand = [self.rc,
+00034ec0: 2027 6d6f 756e 7427 5d20 2b20 6c69 7374   'mount'] + list
+00034ed0: 2861 7267 7329 0a20 2020 2020 2020 2063  (args).        c
+00034ee0: 6f6d 6d61 6e64 2e61 7070 656e 6428 272d  ommand.append('-
+00034ef0: 2d61 6c6c 6f77 2d6e 6f6e 2d65 6d70 7479  -allow-non-empty
+00034f00: 2729 0a20 2020 2020 2020 2063 6f6d 6d61  ').        comma
+00034f10: 6e64 2e61 7070 656e 6428 272d 2d64 6566  nd.append('--def
+00034f20: 6175 6c74 2d70 6572 6d69 7373 696f 6e73  ault-permissions
+00034f30: 2729 0a20 2020 2020 2020 2063 6f6d 6d61  ').        comma
+00034f40: 6e64 2e61 7070 656e 6428 272d 2d72 6561  nd.append('--rea
+00034f50: 642d 6f6e 6c79 2729 0a20 2020 2020 2020  d-only').       
+00034f60: 2063 6f6d 6d61 6e64 2e61 7070 656e 6428   command.append(
+00034f70: 272d 2d6e 6f2d 6368 6563 6b73 756d 2729  '--no-checksum')
+00034f80: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
+00034f90: 2e61 7070 656e 6428 7372 6329 0a20 2020  .append(src).   
+00034fa0: 2020 2020 2063 6f6d 6d61 6e64 2e61 7070       command.app
+00034fb0: 656e 6428 6473 7429 0a0a 2020 2020 2020  end(dst)..      
+00034fc0: 2020 2320 5275 6e20 7468 6520 636f 7079    # Run the copy
+00034fd0: 2063 6f6d 6d61 6e64 2061 6e64 2072 6574   command and ret
+00034fe0: 7572 6e20 6966 2069 7420 7761 7320 7375  urn if it was su
+00034ff0: 6363 6573 7366 756c 0a20 2020 2020 2020  ccessful.       
+00035000: 2072 6574 7572 6e20 7365 6c66 2e5f 7275   return self._ru
+00035010: 6e5f 7263 6c6f 6e65 5f63 6f6d 6d61 6e64  n_rclone_command
+00035020: 2863 6f6d 6d61 6e64 2c20 6261 636b 6772  (command, backgr
+00035030: 6f75 6e64 3d54 7275 6529 0a0a 2020 2020  ound=True)..    
+00035040: 6465 6620 756e 6d6f 756e 7428 7365 6c66  def unmount(self
+00035050: 2c20 6d6f 756e 7470 6f69 6e74 2c20 7761  , mountpoint, wa
+00035060: 6974 3d46 616c 7365 293a 0a0a 2020 2020  it=False):..    
+00035070: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00035080: 2020 2020 2069 6620 6e6f 7420 7368 7574       if not shut
+00035090: 696c 2e77 6869 6368 2827 6675 7365 726d  il.which('fuserm
+000350a0: 6f75 6e74 3327 293a 0a20 2020 2020 2020  ount3'):.       
+000350b0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+000350c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000350d0: 2020 2020 2743 6f75 6c64 206e 6f74 2066      'Could not f
+000350e0: 696e 6420 2266 7573 6572 6d6f 756e 7433  ind "fusermount3
+000350f0: 222e 2050 6c65 6173 6520 696e 7374 616c  ". Please instal
+00035100: 6c20 7468 6520 2266 7573 6533 2220 4f53  l the "fuse3" OS
+00035110: 2070 6163 6b61 6765 2729 0a20 2020 2020   package').     
+00035120: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00035130: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
+00035140: 2020 2020 2320 4275 696c 6420 636f 6d6d      # Build comm
+00035150: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
+00035160: 636d 6420 3d20 5b27 6675 7365 726d 6f75  cmd = ['fusermou
+00035170: 6e74 3327 2c20 272d 7527 2c20 6d6f 756e  nt3', '-u', moun
+00035180: 7470 6f69 6e74 5d0a 2020 2020 2020 2020  tpoint].        
+00035190: 2020 2020 7265 7420 3d20 7375 6270 726f      ret = subpro
+000351a0: 6365 7373 2e72 756e 2863 6d64 2c20 6361  cess.run(cmd, ca
+000351b0: 7074 7572 655f 6f75 7470 7574 3d46 616c  pture_output=Fal
+000351c0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000351d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000351e0: 2020 2020 2074 6578 743d 5472 7565 2c20       text=True, 
+000351f0: 656e 763d 7365 6c66 2e65 6e76 726e 290a  env=self.envrn).
+00035200: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00035210: 7265 742e 7265 7475 726e 636f 6465 203d  ret.returncode =
+00035220: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00035230: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00035240: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00035250: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00035260: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00035270: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00035280: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00035290: 2020 2020 2020 2070 7269 6e74 5f65 7272         print_err
+000352a0: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
+000352b0: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
+000352c0: 2020 6465 6620 7665 7273 696f 6e28 7365    def version(se
+000352d0: 6c66 293a 0a20 2020 2020 2020 2063 6f6d  lf):.        com
+000352e0: 6d61 6e64 203d 205b 7365 6c66 2e72 632c  mand = [self.rc,
+000352f0: 2027 7665 7273 696f 6e27 5d0a 2020 2020   'version'].    
+00035300: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00035310: 5f72 756e 5f72 636c 6f6e 655f 636f 6d6d  _run_rclone_comm
+00035320: 616e 6428 636f 6d6d 616e 6429 0a0a 2020  and(command)..  
+00035330: 2020 6465 6620 6765 745f 6d6f 756e 7473    def get_mounts
+00035340: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00035350: 6d6f 756e 7473 203d 205b 5d0a 2020 2020  mounts = [].    
+00035360: 2020 2020 7769 7468 206f 7065 6e28 272f      with open('/
+00035370: 7072 6f63 2f6d 6f75 6e74 7327 2c20 2772  proc/mounts', 'r
+00035380: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00035390: 2020 2020 2066 6f72 206c 696e 6520 696e       for line in
+000353a0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+000353b0: 2020 2020 7061 7274 7320 3d20 6c69 6e65      parts = line
+000353c0: 2e73 706c 6974 2829 0a20 2020 2020 2020  .split().       
+000353d0: 2020 2020 2020 2020 206d 6f75 6e74 5f70           mount_p
+000353e0: 6f69 6e74 2c20 6673 5f74 7970 6520 3d20  oint, fs_type = 
+000353f0: 7061 7274 735b 315d 2c20 7061 7274 735b  parts[1], parts[
+00035400: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+00035410: 2020 2069 6620 6673 5f74 7970 652e 7374     if fs_type.st
+00035420: 6172 7473 7769 7468 2827 6675 7365 2e72  artswith('fuse.r
+00035430: 636c 6f6e 6527 293a 0a20 2020 2020 2020  clone'):.       
+00035440: 2020 2020 2020 2020 2020 2020 206d 6f75               mou
+00035450: 6e74 732e 6170 7065 6e64 286d 6f75 6e74  nts.append(mount
+00035460: 5f70 6f69 6e74 290a 2020 2020 2020 2020  _point).        
+00035470: 7265 7475 726e 206d 6f75 6e74 730a 0a20  return mounts.. 
+00035480: 2020 2064 6566 205f 6765 745f 7069 6473     def _get_pids
+00035490: 2873 656c 662c 2070 726f 6365 7373 2c20  (self, process, 
+000354a0: 6675 6c6c 3d46 616c 7365 293a 0a20 2020  full=False):.   
+000354b0: 2020 2020 2070 726f 6365 7373 203d 2070       process = p
+000354c0: 726f 6365 7373 2e72 7374 7269 7028 6f73  rocess.rstrip(os
+000354d0: 2e70 6174 682e 7365 7029 0a20 2020 2020  .path.sep).     
+000354e0: 2020 2069 6620 6675 6c6c 3a0a 2020 2020     if full:.    
+000354f0: 2020 2020 2020 2020 636f 6d6d 616e 6420          command 
+00035500: 3d20 5b27 7067 7265 7027 2c20 272d 6627  = ['pgrep', '-f'
+00035510: 2c20 7072 6f63 6573 735d 0a20 2020 2020  , process].     
+00035520: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00035530: 2020 2020 2063 6f6d 6d61 6e64 203d 205b       command = [
+00035540: 2770 6772 6570 272c 2070 726f 6365 7373  'pgrep', process
+00035550: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
+00035560: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00035570: 7420 3d20 7375 6270 726f 6365 7373 2e63  t = subprocess.c
+00035580: 6865 636b 5f6f 7574 7075 7428 636f 6d6d  heck_output(comm
+00035590: 616e 6429 0a20 2020 2020 2020 2020 2020  and).           
+000355a0: 2070 6964 7320 3d20 5b69 6e74 2870 6964   pids = [int(pid
+000355b0: 2920 666f 7220 7069 6420 696e 206f 7574  ) for pid in out
+000355c0: 7075 742e 6465 636f 6465 280a 2020 2020  put.decode(.    
+000355d0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000355e0: 7273 3d27 6967 6e6f 7265 2729 2e73 706c  rs='ignore').spl
+000355f0: 6974 2827 5c6e 2729 2069 6620 7069 645d  it('\n') if pid]
+00035600: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00035610: 7572 6e20 7069 6473 0a20 2020 2020 2020  urn pids.       
+00035620: 2065 7863 6570 7420 7375 6270 726f 6365   except subproce
+00035630: 7373 2e43 616c 6c65 6450 726f 6365 7373  ss.CalledProcess
+00035640: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00035650: 2020 2023 204e 6f20 7263 6c6f 6e65 2070     # No rclone p
+00035660: 726f 6365 7373 6573 2066 6f75 6e64 0a20  rocesses found. 
+00035670: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00035680: 6e20 5b5d 0a0a 2020 2020 6465 6620 5f61  n []..    def _a
+00035690: 6464 5f6f 7074 2873 656c 662c 2063 6d64  dd_opt(self, cmd
+000356a0: 2c20 6f70 7469 6f6e 2c20 7661 6c75 653d  , option, value=
+000356b0: 4e6f 6e65 293a 0a20 2020 2020 2020 2027  None):.        '
+000356c0: 2727 4164 6420 616e 206f 7074 696f 6e20  ''Add an option 
+000356d0: 746f 2074 6865 2063 6f6d 6d61 6e64 2069  to the command i
+000356e0: 6620 6974 2069 7320 6e6f 7420 616c 7265  f it is not alre
+000356f0: 6164 7920 7072 6573 656e 7427 2727 0a0a  ady present'''..
+00035700: 2020 2020 2020 2020 6966 206f 7074 696f          if optio
+00035710: 6e20 6e6f 7420 696e 2063 6d64 3a0a 2020  n not in cmd:.  
+00035720: 2020 2020 2020 2020 2020 636d 642e 6170            cmd.ap
+00035730: 7065 6e64 286f 7074 696f 6e29 0a20 2020  pend(option).   
+00035740: 2020 2020 2020 2020 2069 6620 7661 6c75           if valu
+00035750: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00035760: 2020 2063 6d64 2e61 7070 656e 6428 7661     cmd.append(va
+00035770: 6c75 6529 0a0a 2020 2020 2020 2020 7265  lue)..        re
+00035780: 7475 726e 2063 6d64 0a0a 2020 2020 6465  turn cmd..    de
+00035790: 6620 5f70 6172 7365 5f6c 6f67 2873 656c  f _parse_log(sel
+000357a0: 662c 2073 7472 7374 6465 7272 293a 0a20  f, strstderr):. 
+000357b0: 2020 2020 2020 206c 696e 6573 203d 2073         lines = s
+000357c0: 7472 7374 6465 7272 2e73 706c 6974 2827  trstderr.split('
+000357d0: 5c6e 2729 0a20 2020 2020 2020 2064 6174  \n').        dat
+000357e0: 6120 3d20 5b6a 736f 6e2e 6c6f 6164 7328  a = [json.loads(
+000357f0: 6c69 6e65 2e72 7374 7269 7028 2929 2066  line.rstrip()) f
+00035800: 6f72 206c 696e 6520 696e 206c 696e 6573  or line in lines
+00035810: 2069 6620 6c69 6e65 5b30 5d20 3d3d 2022   if line[0] == "
+00035820: 7b22 5d0a 2020 2020 2020 2020 7374 6174  {"].        stat
+00035830: 7320 3d20 5b5d 0a20 2020 2020 2020 206f  s = [].        o
+00035840: 7065 7261 7469 6f6e 7320 3d20 5b5d 0a20  perations = []. 
+00035850: 2020 2020 2020 2066 6f72 206f 626a 2069         for obj i
+00035860: 6e20 6461 7461 3a0a 2020 2020 2020 2020  n data:.        
+00035870: 2020 2020 6966 2027 6163 636f 756e 7469      if 'accounti
+00035880: 6e67 2f73 7461 7473 2720 696e 206f 626a  ng/stats' in obj
+00035890: 5b27 736f 7572 6365 275d 3a0a 2020 2020  ['source']:.    
+000358a0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+000358b0: 732e 6170 7065 6e64 286f 626a 290a 2020  s.append(obj).  
+000358c0: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
+000358d0: 6f70 6572 6174 696f 6e73 2f6f 7065 7261  operations/opera
+000358e0: 7469 6f6e 7327 2069 6e20 6f62 6a5b 2773  tions' in obj['s
+000358f0: 6f75 7263 6527 5d3a 0a20 2020 2020 2020  ource']:.       
+00035900: 2020 2020 2020 2020 206f 7065 7261 7469           operati
+00035910: 6f6e 732e 6170 7065 6e64 286f 626a 290a  ons.append(obj).
+00035920: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00035930: 7461 7473 2c20 6f70 6572 6174 696f 6e73  tats, operations
+00035940: 0a0a 2020 2020 2020 2020 2320 7374 6174  ..        # stat
+00035950: 7322 3a7b 2262 7974 6573 223a 302c 2263  s":{"bytes":0,"c
+00035960: 6865 636b 7322 3a30 2c22 6465 6c65 7465  hecks":0,"delete
+00035970: 6444 6972 7322 3a30 2c22 6465 6c65 7465  dDirs":0,"delete
+00035980: 7322 3a30 2c22 656c 6170 7365 6454 696d  s":0,"elapsedTim
+00035990: 6522 3a34 2e31 3231 3438 3937 3835 2c22  e":4.121489785,"
+000359a0: 6572 726f 7273 223a 3132 2c22 6574 6122  errors":12,"eta"
+000359b0: 3a6e 756c 6c2c 2266 6174 616c 4572 726f  :null,"fatalErro
+000359c0: 7222 3a66 616c 7365 2c0a 2020 2020 2020  r":false,.      
+000359d0: 2020 2320 226c 6173 7445 7272 6f72 223a    # "lastError":
+000359e0: 2266 6169 6c65 6420 746f 206f 7065 6e20  "failed to open 
+000359f0: 736f 7572 6365 206f 626a 6563 743a 204f  source object: O
+00035a00: 626a 6563 7420 696e 2047 4c41 4349 4552  bject in GLACIER
+00035a10: 2c20 7265 7374 6f72 6520 6669 7273 743a  , restore first:
+00035a20: 2062 7563 6b65 743d 5c22 706f 7369 782d   bucket=\"posix-
+00035a30: 6470 5c22 2c20 6b65 793d 5c22 7465 7374  dp\", key=\"test
+00035a40: 7334 2f74 6162 6c65 5f65 7861 6d70 6c65  s4/table_example
+00035a50: 2e70 795c 2222 2c0a 2020 2020 2020 2020  .py\"",.        
+00035a60: 2320 2272 656e 616d 6573 223a 302c 2272  # "renames":0,"r
+00035a70: 6574 7279 4572 726f 7222 3a74 7275 652c  etryError":true,
+00035a80: 2273 7065 6564 223a 302c 2274 6f74 616c  "speed":0,"total
+00035a90: 4279 7465 7322 3a30 2c22 746f 7461 6c43  Bytes":0,"totalC
+00035aa0: 6865 636b 7322 3a30 2c22 746f 7461 6c54  hecks":0,"totalT
+00035ab0: 7261 6e73 6665 7273 223a 302c 2274 7261  ransfers":0,"tra
+00035ac0: 6e73 6665 7254 696d 6522 3a30 2c22 7472  nsferTime":0,"tr
+00035ad0: 616e 7366 6572 7322 3a30 7d2c 0a20 2020  ansfers":0},.   
+00035ae0: 2020 2020 2023 2022 7469 6d65 223a 2232       # "time":"2
+00035af0: 3032 332d 3034 2d31 3654 3130 3a31 383a  023-04-16T10:18:
+00035b00: 3436 2e31 3231 3932 312d 3037 3a30 3022  46.121921-07:00"
+00035b10: 7d0a 0a0a 636c 6173 7320 536c 7572 6d45  }...class SlurmE
+00035b20: 7373 656e 7469 616c 733a 0a20 2020 2023  ssentials:.    #
+00035b30: 2065 7869 7420 636f 6465 2036 3420 6361   exit code 64 ca
+00035b40: 7573 6573 2053 6c75 726d 2074 6f20 2d2d  uses Slurm to --
+00035b50: 7265 7175 6575 652c 2065 2e67 2e20 7379  requeue, e.g. sy
+00035b60: 732e 6578 6974 2836 3429 0a20 2020 2023  s.exit(64).    #
+00035b70: 2054 4f44 4f3a 2074 6865 7365 2076 6172   TODO: these var
+00035b80: 6961 626c 6573 2061 7265 206e 6f74 2052  iables are not R
+00035b90: 4541 4420 6672 6f6d 2074 6865 2063 6f6e  EAD from the con
+00035ba0: 6669 6720 6669 6c65 0a20 2020 2064 6566  fig file.    def
+00035bb0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00035bc0: 6172 6773 2c20 6366 673a 2043 6f6e 6669  args, cfg: Confi
+00035bd0: 674d 616e 6167 6572 293a 0a0a 2020 2020  gManager):..    
+00035be0: 2020 2020 2320 4372 6561 7465 2074 6865      # Create the
+00035bf0: 2073 6c75 726d 2064 6972 6563 746f 7279   slurm directory
+00035c00: 2069 6620 6974 2064 6f65 7320 6e6f 7420   if it does not 
+00035c10: 6578 6973 740a 2020 2020 2020 2020 6f73  exist.        os
+00035c20: 2e6d 616b 6564 6972 7328 6366 672e 736c  .makedirs(cfg.sl
+00035c30: 7572 6d5f 6469 722c 2065 7869 7374 5f6f  urm_dir, exist_o
+00035c40: 6b3d 5472 7565 2c20 6d6f 6465 3d30 6f37  k=True, mode=0o7
+00035c50: 3735 290a 0a20 2020 2020 2020 2073 656c  75)..        sel
+00035c60: 662e 7363 7269 7074 5f6c 696e 6573 203d  f.script_lines =
+00035c70: 205b 2223 212f 6269 6e2f 6261 7368 225d   ["#!/bin/bash"]
+00035c80: 0a20 2020 2020 2020 2073 656c 662e 6366  .        self.cf
+00035c90: 6720 3d20 6366 670a 2020 2020 2020 2020  g = cfg.        
+00035ca0: 7365 6c66 2e61 7267 7320 3d20 6172 6773  self.args = args
+00035cb0: 0a20 2020 2020 2020 2073 656c 662e 7371  .        self.sq
+00035cc0: 7565 7565 5f6f 7574 7075 745f 666f 726d  ueue_output_form
+00035cd0: 6174 203d 2027 2225 6922 2c22 256a 222c  at = '"%i","%j",
+00035ce0: 2225 7422 2c22 254d 222c 2225 4c22 2c22  "%t","%M","%L","
+00035cf0: 2544 222c 2225 4322 2c22 256d 222c 2225  %D","%C","%m","%
+00035d00: 6222 2c22 2552 2227 0a20 2020 2020 2020  b","%R"'.       
+00035d10: 2073 656c 662e 6a6f 6273 203d 205b 5d0a   self.jobs = [].
+00035d20: 2020 2020 2020 2020 7365 6c66 2e6a 6f62          self.job
+00035d30: 5f69 6e66 6f20 3d20 7b7d 0a0a 2020 2020  _info = {}..    
+00035d40: 2020 2020 7365 6c66 2e70 6172 7469 7469      self.partiti
+00035d50: 6f6e 203d 2063 6667 2e73 6c75 726d 5f70  on = cfg.slurm_p
+00035d60: 6172 7469 7469 6f6e 2069 6620 6861 7361  artition if hasa
+00035d70: 7474 7228 0a20 2020 2020 2020 2020 2020  ttr(.           
+00035d80: 2063 6667 2c20 2773 6c75 726d 5f70 6172   cfg, 'slurm_par
+00035d90: 7469 7469 6f6e 2729 2065 6c73 6520 4e6f  tition') else No
+00035da0: 6e65 0a0a 2020 2020 2020 2020 6966 2073  ne..        if s
+00035db0: 656c 662e 7061 7274 6974 696f 6e20 6973  elf.partition is
+00035dc0: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
+00035dd0: 2020 2020 2020 2020 2320 4d61 6b65 2073          # Make s
+00035de0: 7572 6520 7765 2061 7265 206e 6f74 2065  ure we are not e
+00035df0: 7863 6565 6469 6e67 2074 6865 206e 756d  xceeding the num
+00035e00: 6265 7220 6f66 2063 6f72 6573 2061 7661  ber of cores ava
+00035e10: 696c 6162 6c65 0a20 2020 2020 2020 2020  ilable.         
+00035e20: 2020 2074 6f74 616c 5f63 7075 7320 3d20     total_cpus = 
+00035e30: 7365 6c66 2e67 6574 5f74 6f74 616c 5f63  self.get_total_c
+00035e40: 7075 7328 7365 6c66 2e70 6172 7469 7469  pus(self.partiti
+00035e50: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+00035e60: 6966 2073 656c 662e 6172 6773 2e63 6f72  if self.args.cor
+00035e70: 6573 203e 2074 6f74 616c 5f63 7075 733a  es > total_cpus:
+00035e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035e90: 2073 656c 662e 6172 6773 2e63 6f72 6573   self.args.cores
+00035ea0: 203d 2074 6f74 616c 5f63 7075 730a 0a20   = total_cpus.. 
+00035eb0: 2020 2020 2020 2020 2020 2023 2054 7261             # Tra
+00035ec0: 6e73 666f 726d 206d 656d 6f72 7920 6672  nsform memory fr
+00035ed0: 6f6d 2047 4220 746f 204d 420a 2020 2020  om GB to MB.    
+00035ee0: 2020 2020 2020 2020 7365 6c66 2e61 7267          self.arg
+00035ef0: 732e 6d65 6d6f 7279 202a 3d20 3130 3234  s.memory *= 1024
+00035f00: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00035f10: 4d61 6b65 2073 7572 6520 7765 2061 7265  Make sure we are
+00035f20: 206e 6f74 2065 7863 6565 6469 6e67 2074   not exceeding t
+00035f30: 6865 206d 656d 6f72 7920 6176 6169 6c61  he memory availa
+00035f40: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+00035f50: 6d61 785f 6d65 6d6f 7279 5f70 6572 5f6e  max_memory_per_n
+00035f60: 6f64 655f 696e 5f6d 6220 3d20 7365 6c66  ode_in_mb = self
+00035f70: 2e67 6574 5f6d 6178 5f6d 656d 6f72 795f  .get_max_memory_
+00035f80: 7065 725f 6e6f 6465 5f69 6e5f 6d62 2829  per_node_in_mb()
+00035f90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00035fa0: 7365 6c66 2e61 7267 732e 6d65 6d6f 7279  self.args.memory
+00035fb0: 203e 206d 6178 5f6d 656d 6f72 795f 7065   > max_memory_pe
+00035fc0: 725f 6e6f 6465 5f69 6e5f 6d62 3a0a 2020  r_node_in_mb:.  
+00035fd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00035fe0: 6c66 2e61 7267 732e 6d65 6d6f 7279 203d  lf.args.memory =
+00035ff0: 206d 6178 5f6d 656d 6f72 795f 7065 725f   max_memory_per_
+00036000: 6e6f 6465 5f69 6e5f 6d62 0a0a 2020 2020  node_in_mb..    
+00036010: 2020 2020 7365 6c66 2e71 6f73 203d 2063      self.qos = c
+00036020: 6667 2e73 6c75 726d 5f71 6f73 2069 6620  fg.slurm_qos if 
+00036030: 6861 7361 7474 7228 6366 672c 2027 736c  hasattr(cfg, 'sl
+00036040: 7572 6d5f 716f 7327 2920 656c 7365 204e  urm_qos') else N
+00036050: 6f6e 650a 0a20 2020 2020 2020 2077 616c  one..        wal
+00036060: 6c74 696d 655f 6461 7973 203d 2063 6667  ltime_days = cfg
+00036070: 2e73 6c75 726d 5f77 616c 6c74 696d 655f  .slurm_walltime_
+00036080: 6461 7973 2069 6620 6861 7361 7474 7228  days if hasattr(
+00036090: 0a20 2020 2020 2020 2020 2020 2063 6667  .            cfg
+000360a0: 2c20 2773 6c75 726d 5f77 616c 6c74 696d  , 'slurm_walltim
+000360b0: 655f 6461 7973 2729 2065 6c73 6520 4e6f  e_days') else No
+000360c0: 6e65 0a0a 2020 2020 2020 2020 7761 6c6c  ne..        wall
+000360d0: 7469 6d65 5f68 6f75 7273 203d 2063 6667  time_hours = cfg
+000360e0: 2e73 6c75 726d 5f77 616c 6c74 696d 655f  .slurm_walltime_
+000360f0: 686f 7572 7320 6966 2068 6173 6174 7472  hours if hasattr
+00036100: 280a 2020 2020 2020 2020 2020 2020 6366  (.            cf
+00036110: 672c 2027 736c 7572 6d5f 7761 6c6c 7469  g, 'slurm_wallti
+00036120: 6d65 5f68 6f75 7273 2729 2065 6c73 6520  me_hours') else 
+00036130: 4e6f 6e65 0a0a 2020 2020 2020 2020 6966  None..        if
+00036140: 2077 616c 6c74 696d 655f 6461 7973 2069   walltime_days i
+00036150: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2077  s not None and w
+00036160: 616c 6c74 696d 655f 686f 7572 7320 6973  alltime_hours is
+00036170: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00036180: 2020 2020 2020 2073 656c 662e 7761 6c6c         self.wall
+00036190: 7469 6d65 203d 2066 277b 7761 6c6c 7469  time = f'{wallti
+000361a0: 6d65 5f64 6179 737d 2d7b 7761 6c6c 7469  me_days}-{wallti
+000361b0: 6d65 5f68 6f75 7273 7d27 0a20 2020 2020  me_hours}'.     
+000361c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000361d0: 2020 2020 2073 656c 662e 7761 6c6c 7469       self.wallti
+000361e0: 6d65 203d 2027 372d 3027 0a0a 2020 2020  me = '7-0'..    
+000361f0: 2020 2020 7365 6c66 2e73 6c75 726d 5f6c      self.slurm_l
+00036200: 7363 7261 7463 6820 3d20 6366 672e 736c  scratch = cfg.sl
+00036210: 7572 6d5f 6c73 6372 6174 6368 2069 6620  urm_lscratch if 
+00036220: 6861 7361 7474 7228 0a20 2020 2020 2020  hasattr(.       
+00036230: 2020 2020 2063 6667 2c20 2773 6c75 726d       cfg, 'slurm
+00036240: 5f6c 7363 7261 7463 6827 2920 656c 7365  _lscratch') else
+00036250: 204e 6f6e 650a 0a20 2020 2020 2020 2073   None..        s
+00036260: 656c 662e 6c73 6372 6174 6368 5f6d 6b64  elf.lscratch_mkd
+00036270: 6972 203d 2063 6667 2e6c 7363 7261 7463  ir = cfg.lscratc
+00036280: 685f 6d6b 6469 7220 6966 2068 6173 6174  h_mkdir if hasat
+00036290: 7472 280a 2020 2020 2020 2020 2020 2020  tr(.            
+000362a0: 6366 672c 2027 6c73 6372 6174 6368 5f6d  cfg, 'lscratch_m
+000362b0: 6b64 6972 2729 2065 6c73 6520 4e6f 6e65  kdir') else None
+000362c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+000362d0: 7363 7261 7463 685f 726f 6f74 203d 2063  scratch_root = c
+000362e0: 6667 2e6c 7363 7261 7463 685f 726f 6f74  fg.lscratch_root
+000362f0: 2069 6620 6861 7361 7474 7228 0a20 2020   if hasattr(.   
+00036300: 2020 2020 2020 2020 2063 6667 2c20 276c           cfg, 'l
+00036310: 7363 7261 7463 685f 726f 6f74 2729 2065  scratch_root') e
+00036320: 6c73 6520 4e6f 6e65 0a0a 2020 2020 2020  lse None..      
+00036330: 2020 6966 2073 656c 662e 736c 7572 6d5f    if self.slurm_
+00036340: 6c73 6372 6174 6368 3a0a 2020 2020 2020  lscratch:.      
+00036350: 2020 2020 2020 7365 6c66 2e61 6464 5f6c        self.add_l
+00036360: 696e 6528 6627 2353 4241 5443 4820 7b73  ine(f'#SBATCH {s
+00036370: 656c 662e 736c 7572 6d5f 6c73 6372 6174  elf.slurm_lscrat
+00036380: 6368 7d27 290a 0a20 2020 2020 2020 2073  ch}')..        s
+00036390: 656c 662e 6164 645f 6c69 6e65 2866 277b  elf.add_line(f'{
+000363a0: 7365 6c66 2e6c 7363 7261 7463 685f 6d6b  self.lscratch_mk
+000363b0: 6469 727d 2729 0a0a 2020 2020 2020 2020  dir}')..        
+000363c0: 6966 2073 656c 662e 6c73 6372 6174 6368  if self.lscratch
+000363d0: 5f72 6f6f 743a 0a20 2020 2020 2020 2020  _root:.         
+000363e0: 2020 2073 656c 662e 6164 645f 6c69 6e65     self.add_line
+000363f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00036400: 2020 2765 7870 6f72 7420 544d 5044 4952    'export TMPDIR
+00036410: 3d25 732f 247b 534c 5552 4d5f 4a4f 425f  =%s/${SLURM_JOB_
+00036420: 4944 7d27 2025 2073 656c 662e 6c73 6372  ID}' % self.lscr
+00036430: 6174 6368 5f72 6f6f 7429 0a0a 2020 2020  atch_root)..    
+00036440: 6465 6620 6164 645f 6c69 6e65 2873 656c  def add_line(sel
+00036450: 662c 206c 696e 6529 3a0a 2020 2020 2020  f, line):.      
+00036460: 2020 6966 206c 696e 653a 0a20 2020 2020    if line:.     
+00036470: 2020 2020 2020 2073 656c 662e 7363 7269         self.scri
+00036480: 7074 5f6c 696e 6573 2e61 7070 656e 6428  pt_lines.append(
+00036490: 6c69 6e65 290a 0a20 2020 2064 6566 2067  line)..    def g
+000364a0: 6574 5f66 7574 7572 655f 7374 6172 745f  et_future_start_
+000364b0: 7469 6d65 2873 656c 662c 2061 6464 5f68  time(self, add_h
+000364c0: 6f75 7273 293a 0a20 2020 2020 2020 206e  ours):.        n
+000364d0: 6f77 203d 2064 6174 6574 696d 652e 6461  ow = datetime.da
+000364e0: 7465 7469 6d65 2e6e 6f77 2829 0a20 2020  tetime.now().   
+000364f0: 2020 2020 2066 7574 7572 655f 7469 6d65       future_time
+00036500: 203d 206e 6f77 202b 2064 6174 6574 696d   = now + datetim
+00036510: 652e 7469 6d65 6465 6c74 6128 686f 7572  e.timedelta(hour
+00036520: 733d 6164 645f 686f 7572 7329 0a20 2020  s=add_hours).   
+00036530: 2020 2020 2072 6574 7572 6e20 6675 7475       return futu
+00036540: 7265 5f74 696d 652e 7374 7266 7469 6d65  re_time.strftime
+00036550: 2822 2559 2d25 6d2d 2564 5425 483a 254d  ("%Y-%m-%dT%H:%M
+00036560: 2229 0a0a 2020 2020 6465 6620 6765 745f  ")..    def get_
+00036570: 746f 7461 6c5f 6370 7573 2873 656c 662c  total_cpus(self,
+00036580: 2070 6172 7469 7469 6f6e 293a 0a20 2020   partition):.   
+00036590: 2020 2020 2063 6d64 203d 205b 2773 696e       cmd = ['sin
+000365a0: 666f 272c 2027 2d4e 272c 2027 2d70 272c  fo', '-N', '-p',
+000365b0: 2070 6172 7469 7469 6f6e 2c20 272d 2d66   partition, '--f
+000365c0: 6f72 6d61 743d 2225 6e20 2563 2227 5d0a  ormat="%n %c"'].
+000365d0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000365e0: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
+000365f0: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00036600: 2c20 7374 646f 7574 3d73 7562 7072 6f63  , stdout=subproc
+00036610: 6573 732e 5049 5045 2c20 7374 6465 7272  ess.PIPE, stderr
+00036620: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
+00036630: 2c20 7465 7874 3d54 7275 6529 0a20 2020  , text=True).   
+00036640: 2020 2020 2069 6620 7265 7375 6c74 2e72       if result.r
+00036650: 6574 7572 6e63 6f64 6520 213d 2030 3a0a  eturncode != 0:.
+00036660: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00036670: 6520 4578 6365 7074 696f 6e28 6627 4572  e Exception(f'Er
+00036680: 726f 7220 6578 6563 7574 696e 6720 636f  ror executing co
+00036690: 6d6d 616e 643a 207b 7265 7375 6c74 2e73  mmand: {result.s
+000366a0: 7464 6572 727d 2729 0a20 2020 2020 2020  tderr}').       
+000366b0: 206c 696e 6573 203d 2072 6573 756c 742e   lines = result.
+000366c0: 7374 646f 7574 2e73 706c 6974 2827 5c6e  stdout.split('\n
+000366d0: 2729 0a20 2020 2020 2020 2074 6f74 616c  ').        total
+000366e0: 5f63 7075 7320 3d20 300a 2020 2020 2020  _cpus = 0.      
+000366f0: 2020 666f 7220 6c69 6e65 2069 6e20 6c69    for line in li
+00036700: 6e65 735b 313a 5d3a 2020 2320 536b 6970  nes[1:]:  # Skip
+00036710: 2074 6865 2068 6561 6465 7220 6c69 6e65   the header line
+00036720: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00036730: 6c69 6e65 3a20 2023 2053 6b69 7020 656d  line:  # Skip em
+00036740: 7074 7920 6c69 6e65 730a 2020 2020 2020  pty lines.      
+00036750: 2020 2020 2020 2020 2020 6e6f 6465 2c20            node, 
+00036760: 6370 7573 203d 206c 696e 652e 7370 6c69  cpus = line.spli
+00036770: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00036780: 2020 2020 6370 7573 203d 2063 7075 732e      cpus = cpus.
+00036790: 7265 706c 6163 6528 2722 272c 2027 2729  replace('"', '')
+000367a0: 2e72 6570 6c61 6365 2822 2722 2c20 2727  .replace("'", ''
+000367b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000367c0: 2020 746f 7461 6c5f 6370 7573 202b 3d20    total_cpus += 
+000367d0: 696e 7428 6370 7573 290a 2020 2020 2020  int(cpus).      
+000367e0: 2020 7265 7475 726e 2074 6f74 616c 5f63    return total_c
+000367f0: 7075 730a 0a20 2020 2064 6566 2067 6574  pus..    def get
+00036800: 5f6d 6178 5f6d 656d 6f72 795f 7065 725f  _max_memory_per_
+00036810: 6e6f 6465 5f69 6e5f 6d62 2873 656c 6629  node_in_mb(self)
+00036820: 3a0a 2020 2020 2020 2020 2727 2747 6574  :.        '''Get
+00036830: 2074 6865 206d 6178 696d 756d 206d 656d   the maximum mem
+00036840: 6f72 7920 7065 7220 6e6f 6465 2069 6e20  ory per node in 
+00036850: 4d42 2e27 2727 0a20 2020 2020 2020 2023  MB.'''.        #
+00036860: 2052 756e 2074 6865 2073 696e 666f 2063   Run the sinfo c
+00036870: 6f6d 6d61 6e64 2061 6e64 2063 6170 7475  ommand and captu
+00036880: 7265 2069 7473 206f 7574 7075 740a 2020  re its output.  
+00036890: 2020 2020 2020 7369 6e66 6f5f 6f75 7470        sinfo_outp
+000368a0: 7574 203d 2073 7562 7072 6f63 6573 732e  ut = subprocess.
+000368b0: 6368 6563 6b5f 6f75 7470 7574 280a 2020  check_output(.  
+000368c0: 2020 2020 2020 2020 2020 2273 696e 666f            "sinfo
+000368d0: 202d 4e20 2d6f 2027 256d 2722 2c20 7368   -N -o '%m'", sh
+000368e0: 656c 6c3d 5472 7565 292e 6465 636f 6465  ell=True).decode
+000368f0: 2827 7574 662d 3827 290a 0a20 2020 2020  ('utf-8')..     
+00036900: 2020 2023 2054 6865 206f 7574 7075 7420     # The output 
+00036910: 6973 2061 2073 7472 696e 6720 7769 7468  is a string with
+00036920: 206f 6e65 206c 696e 6520 7065 7220 6e6f   one line per no
+00036930: 6465 2c20 736f 2073 706c 6974 2069 7420  de, so split it 
+00036940: 696e 746f 206c 696e 6573 0a20 2020 2020  into lines.     
+00036950: 2020 206c 696e 6573 203d 2073 696e 666f     lines = sinfo
+00036960: 5f6f 7574 7075 742e 7370 6c69 7428 275c  _output.split('\
+00036970: 6e27 290a 0a20 2020 2020 2020 2023 2054  n')..        # T
+00036980: 6865 2066 6972 7374 206c 696e 6520 6973  he first line is
+00036990: 2061 2068 6561 6465 722c 2073 6f20 6967   a header, so ig
+000369a0: 6e6f 7265 2069 742e 2054 6865 2072 6573  nore it. The res
+000369b0: 7420 6f66 2074 6865 206c 696e 6573 2061  t of the lines a
+000369c0: 7265 2074 6865 206d 656d 6f72 7920 7661  re the memory va
+000369d0: 6c75 6573 2e0a 2020 2020 2020 2020 2320  lues..        # 
+000369e0: 436f 6e76 6572 7420 7468 6573 6520 7661  Convert these va
+000369f0: 6c75 6573 2074 6f20 696e 7465 6765 7273  lues to integers
+00036a00: 2061 6e64 2066 696e 6420 7468 6520 6d69   and find the mi
+00036a10: 6e69 6d75 6d20 7661 6c75 652e 0a20 2020  nimum value..   
+00036a20: 2020 2020 206d 6178 5f6d 656d 6f72 795f       max_memory_
+00036a30: 7065 725f 6e6f 6465 203d 206d 696e 2869  per_node = min(i
+00036a40: 6e74 286c 696e 6529 2066 6f72 206c 696e  nt(line) for lin
+00036a50: 6520 696e 206c 696e 6573 5b31 3a5d 2069  e in lines[1:] i
+00036a60: 6620 6c69 6e65 290a 0a20 2020 2020 2020  f line)..       
+00036a70: 2072 6574 7572 6e20 6d61 785f 6d65 6d6f   return max_memo
+00036a80: 7279 5f70 6572 5f6e 6f64 650a 0a20 2020  ry_per_node..   
+00036a90: 2064 6566 205f 7265 6f72 6465 725f 7362   def _reorder_sb
+00036aa0: 6174 6368 5f6c 696e 6573 2873 656c 662c  atch_lines(self,
+00036ab0: 2073 6372 6970 745f 6275 6666 6572 293a   script_buffer):
+00036ac0: 0a20 2020 2020 2020 2023 2077 6520 6e65  .        # we ne
+00036ad0: 6564 2074 6f20 6d61 6b65 2073 7572 6520  ed to make sure 
+00036ae0: 7468 6174 2061 6c6c 2023 4241 5443 4820  that all #BATCH 
+00036af0: 6172 6520 6174 2074 6865 2074 6f70 0a20  are at the top. 
+00036b00: 2020 2020 2020 2073 6372 6970 745f 6275         script_bu
+00036b10: 6666 6572 2e73 6565 6b28 3029 0a20 2020  ffer.seek(0).   
+00036b20: 2020 2020 206c 696e 6573 203d 2073 6372       lines = scr
+00036b30: 6970 745f 6275 6666 6572 2e72 6561 646c  ipt_buffer.readl
+00036b40: 696e 6573 2829 0a20 2020 2020 2020 2023  ines().        #
+00036b50: 2052 656d 6f76 6520 7468 6520 7368 6562   Remove the sheb
+00036b60: 616e 6720 6c69 6e65 2066 726f 6d20 7468  ang line from th
+00036b70: 6520 6c69 7374 206f 6620 6c69 6e65 730a  e list of lines.
+00036b80: 2020 2020 2020 2020 7368 6562 616e 675f          shebang_
+00036b90: 6c69 6e65 203d 206c 696e 6573 2e70 6f70  line = lines.pop
+00036ba0: 2830 290a 2020 2020 2020 2020 7362 6174  (0).        sbat
+00036bb0: 6368 5f6c 696e 6573 203d 205b 6c69 6e65  ch_lines = [line
+00036bc0: 2066 6f72 206c 696e 6520 696e 206c 696e   for line in lin
+00036bd0: 6573 2069 6620 6c69 6e65 2e73 7461 7274  es if line.start
+00036be0: 7377 6974 6828 2223 5342 4154 4348 2229  swith("#SBATCH")
+00036bf0: 5d0a 2020 2020 2020 2020 6e6f 6e5f 7362  ].        non_sb
+00036c00: 6174 6368 5f6c 696e 6573 203d 205b 0a20  atch_lines = [. 
+00036c10: 2020 2020 2020 2020 2020 206c 696e 6520             line 
+00036c20: 666f 7220 6c69 6e65 2069 6e20 6c69 6e65  for line in line
+00036c30: 7320 6966 206e 6f74 206c 696e 652e 7374  s if not line.st
+00036c40: 6172 7473 7769 7468 2822 2353 4241 5443  artswith("#SBATC
+00036c50: 4822 295d 0a20 2020 2020 2020 2072 656f  H")].        reo
+00036c60: 7264 6572 6564 5f73 6372 6970 7420 3d20  rdered_script = 
+00036c70: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
+00036c80: 2020 2020 2020 7265 6f72 6465 7265 645f        reordered_
+00036c90: 7363 7269 7074 2e77 7269 7465 2873 6865  script.write(she
+00036ca0: 6261 6e67 5f6c 696e 6529 0a20 2020 2020  bang_line).     
+00036cb0: 2020 2066 6f72 206c 696e 6520 696e 2073     for line in s
+00036cc0: 6261 7463 685f 6c69 6e65 733a 0a20 2020  batch_lines:.   
+00036cd0: 2020 2020 2020 2020 2072 656f 7264 6572           reorder
+00036ce0: 6564 5f73 6372 6970 742e 7772 6974 6528  ed_script.write(
+00036cf0: 6c69 6e65 290a 2020 2020 2020 2020 666f  line).        fo
+00036d00: 7220 6c69 6e65 2069 6e20 6e6f 6e5f 7362  r line in non_sb
+00036d10: 6174 6368 5f6c 696e 6573 3a0a 2020 2020  atch_lines:.    
+00036d20: 2020 2020 2020 2020 7265 6f72 6465 7265          reordere
+00036d30: 645f 7363 7269 7074 2e77 7269 7465 286c  d_script.write(l
+00036d40: 696e 6529 0a20 2020 2020 2020 2023 2061  ine).        # a
+00036d50: 6464 2061 206c 6f63 616c 2073 6372 6174  dd a local scrat
+00036d60: 6368 2074 6561 7264 6f77 6e2c 2069 6620  ch teardown, if 
+00036d70: 636f 6e66 6967 7572 6564 0a20 2020 2020  configured.     
+00036d80: 2020 2072 656f 7264 6572 6564 5f73 6372     reordered_scr
+00036d90: 6970 742e 7772 6974 6528 7365 6c66 2e63  ipt.write(self.c
+00036da0: 6667 2e6c 7363 7261 7463 685f 726d 6469  fg.lscratch_rmdi
+00036db0: 7229 0a20 2020 2020 2020 2072 656f 7264  r).        reord
+00036dc0: 6572 6564 5f73 6372 6970 742e 7365 656b  ered_script.seek
+00036dd0: 2830 290a 2020 2020 2020 2020 7265 7475  (0).        retu
+00036de0: 726e 2072 656f 7264 6572 6564 5f73 6372  rn reordered_scr
+00036df0: 6970 740a 0a20 2020 2064 6566 2073 7562  ipt..    def sub
+00036e00: 6d69 745f 6a6f 6228 7365 6c66 2c20 636d  mit_job(self, cm
+00036e10: 642c 2063 6d64 5f74 7970 652c 206c 6162  d, cmd_type, lab
+00036e20: 656c 2c20 7368 6f72 746c 6162 656c 293a  el, shortlabel):
+00036e30: 0a20 2020 2020 2020 2027 2727 5375 626d  .        '''Subm
+00036e40: 6974 2061 2053 6c75 726d 206a 6f62 2727  it a Slurm job''
+00036e50: 270a 0a20 2020 2020 2020 2074 7279 3a0a  '..        try:.
+00036e60: 2020 2020 2020 2020 2020 2020 2320 4275              # Bu
+00036e70: 696c 6420 6f75 7470 7574 2073 6c75 726d  ild output slurm
+00036e80: 2064 6972 0a20 2020 2020 2020 2020 2020   dir.           
+00036e90: 206f 7574 7075 745f 6469 7220 3d20 6f73   output_dir = os
+00036ea0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+00036eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00036ec0: 2e63 6667 2e73 6c75 726d 5f64 6972 2c20  .cfg.slurm_dir, 
+00036ed0: 6627 6672 6f73 7465 722d 7b63 6d64 5f74  f'froster-{cmd_t
+00036ee0: 7970 657d 407b 6c61 6265 6c7d 2729 0a0a  ype}@{label}')..
+00036ef0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+00036f00: 6d70 696c 6520 7468 6520 536c 7572 6d20  mpile the Slurm 
+00036f10: 7363 7269 7074 0a20 2020 2020 2020 2020  script.         
+00036f20: 2020 2073 656c 662e 6164 645f 6c69 6e65     self.add_line
+00036f30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00036f40: 2020 6627 2353 4241 5443 4820 2d2d 6a6f    f'#SBATCH --jo
+00036f50: 622d 6e61 6d65 3d66 726f 7374 6572 3a7b  b-name=froster:{
+00036f60: 636d 645f 7479 7065 7d3a 7b73 686f 7274  cmd_type}:{short
+00036f70: 6c61 6265 6c7d 2729 0a20 2020 2020 2020  label}').       
+00036f80: 2020 2020 2073 656c 662e 6164 645f 6c69       self.add_li
+00036f90: 6e65 2866 2723 5342 4154 4348 202d 2d63  ne(f'#SBATCH --c
+00036fa0: 7075 732d 7065 722d 7461 736b 3d7b 7365  pus-per-task={se
+00036fb0: 6c66 2e61 7267 732e 636f 7265 737d 2729  lf.args.cores}')
+00036fc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00036fd0: 662e 6164 645f 6c69 6e65 2866 2723 5342  f.add_line(f'#SB
+00036fe0: 4154 4348 202d 2d6d 656d 3d7b 7365 6c66  ATCH --mem={self
+00036ff0: 2e61 7267 732e 6d65 6d6f 7279 7d27 290a  .args.memory}').
+00037000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00037010: 2e61 6464 5f6c 696e 6528 6627 2353 4241  .add_line(f'#SBA
+00037020: 5443 4820 2d2d 6f75 7470 7574 3d7b 6f75  TCH --output={ou
+00037030: 7470 7574 5f64 6972 7d2d 254a 2e6f 7574  tput_dir}-%J.out
+00037040: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+00037050: 656c 662e 6164 645f 6c69 6e65 2866 2723  elf.add_line(f'#
+00037060: 5342 4154 4348 202d 2d6d 6169 6c2d 7479  SBATCH --mail-ty
+00037070: 7065 3d46 4149 4c2c 5245 5155 4555 452c  pe=FAIL,REQUEUE,
+00037080: 454e 4427 290a 2020 2020 2020 2020 2020  END').          
+00037090: 2020 7365 6c66 2e61 6464 5f6c 696e 6528    self.add_line(
+000370a0: 6627 2353 4241 5443 4820 2d2d 6d61 696c  f'#SBATCH --mail
+000370b0: 2d75 7365 723d 7b73 656c 662e 6366 672e  -user={self.cfg.
+000370c0: 656d 6169 6c7d 2729 0a20 2020 2020 2020  email}').       
+000370d0: 2020 2020 2073 656c 662e 6164 645f 6c69       self.add_li
+000370e0: 6e65 2866 2723 5342 4154 4348 202d 2d74  ne(f'#SBATCH --t
+000370f0: 696d 653d 7b73 656c 662e 7761 6c6c 7469  ime={self.wallti
+00037100: 6d65 7d27 290a 2020 2020 2020 2020 2020  me}').          
+00037110: 2020 7365 6c66 2e61 6464 5f6c 696e 6528    self.add_line(
+00037120: 6627 2353 4241 5443 4820 2d2d 7061 7274  f'#SBATCH --part
+00037130: 6974 696f 6e3d 7b73 656c 662e 7061 7274  ition={self.part
+00037140: 6974 696f 6e7d 2729 0a20 2020 2020 2020  ition}').       
+00037150: 2020 2020 2073 656c 662e 6164 645f 6c69       self.add_li
+00037160: 6e65 2866 2723 5342 4154 4348 202d 2d71  ne(f'#SBATCH --q
+00037170: 6f73 3d7b 7365 6c66 2e71 6f73 7d27 290a  os={self.qos}').
+00037180: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+00037190: 652e 6164 645f 6c69 6e65 2866 276d 6c20  e.add_line(f'ml 
+000371a0: 7079 7468 6f6e 2729 0a0a 2020 2020 2020  python')..      
+000371b0: 2020 2020 2020 2320 5072 696e 7420 7468        # Print th
+000371c0: 6520 636f 6d6d 616e 6420 6c69 6e65 2074  e command line t
+000371d0: 6f20 6265 2065 7865 6375 7465 6420 6279  o be executed by
+000371e0: 2053 6c75 726d 0a20 2020 2020 2020 2020   Slurm.         
+000371f0: 2020 2069 6620 7365 6c66 2e61 7267 732e     if self.args.
+00037200: 6465 6275 673a 0a20 2020 2020 2020 2020  debug:.         
+00037210: 2020 2020 2020 2070 7269 6e74 2866 2743         print(f'C
+00037220: 6f6d 6d61 6e64 206c 696e 6520 7061 7373  ommand line pass
+00037230: 6564 2074 6f20 536c 7572 6d3a 5c6e 7b63  ed to Slurm:\n{c
+00037240: 6d64 7d27 290a 0a20 2020 2020 2020 2020  md}')..         
+00037250: 2020 2023 2041 6464 2074 6865 2063 6f6d     # Add the com
+00037260: 6d61 6e64 206c 696e 6520 746f 2074 6865  mand line to the
+00037270: 2053 6c75 726d 2073 6372 6970 740a 2020   Slurm script.  
+00037280: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00037290: 6464 5f6c 696e 6528 636d 6429 0a0a 2020  dd_line(cmd)..  
+000372a0: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
+000372b0: 7574 6520 7468 6520 536c 7572 6d20 7363  ute the Slurm sc
+000372c0: 7269 7074 0a20 2020 2020 2020 2020 2020  ript.           
+000372d0: 206a 6f62 6964 203d 2073 656c 662e 7362   jobid = self.sb
+000372e0: 6174 6368 2829 0a0a 2020 2020 2020 2020  atch()..        
+000372f0: 2020 2020 2320 5072 696e 7420 7468 6520      # Print the 
+00037300: 536c 7572 6d20 6a6f 6220 696e 666f 726d  Slurm job inform
+00037310: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00037320: 2020 7072 696e 7428 6627 5c6e 534c 5552    print(f'\nSLUR
+00037330: 4d20 4a4f 425c 6e27 290a 2020 2020 2020  M JOB\n').      
+00037340: 2020 2020 2020 7072 696e 7428 6627 2020        print(f'  
+00037350: 4944 3a20 7b6a 6f62 6964 7d27 290a 2020  ID: {jobid}').  
+00037360: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00037370: 6627 2020 5479 7065 3a20 7b63 6d64 5f74  f'  Type: {cmd_t
+00037380: 7970 657d 2729 0a20 2020 2020 2020 2020  ype}').         
+00037390: 2020 2070 7269 6e74 2866 2720 2043 6865     print(f'  Che
+000373a0: 636b 2073 7461 7475 733a 2022 7371 7565  ck status: "sque
+000373b0: 7565 202d 6a20 7b6a 6f62 6964 7d22 2729  ue -j {jobid}"')
+000373c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000373d0: 6e74 2866 2720 2043 6865 636b 206f 7574  nt(f'  Check out
+000373e0: 7075 743a 2022 6361 7420 7b6f 7574 7075  put: "cat {outpu
+000373f0: 745f 6469 727d 2d7b 6a6f 6269 647d 2e6f  t_dir}-{jobid}.o
+00037400: 7574 2227 290a 2020 2020 2020 2020 2020  ut"').          
+00037410: 2020 7072 696e 7428 6627 2020 4361 6e63    print(f'  Canc
+00037420: 656c 2074 6865 206a 6f62 3a20 2273 6361  el the job: "sca
+00037430: 6e63 656c 207b 6a6f 6269 647d 225c 6e27  ncel {jobid}"\n'
+00037440: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+00037450: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00037460: 7269 6e74 5f65 7272 6f72 2829 0a0a 2020  rint_error()..  
+00037470: 2020 6465 6620 7362 6174 6368 2873 656c    def sbatch(sel
+00037480: 6629 3a0a 2020 2020 2020 2020 7363 7269  f):.        scri
+00037490: 7074 203d 2069 6f2e 5374 7269 6e67 494f  pt = io.StringIO
+000374a0: 2829 0a20 2020 2020 2020 2066 6f72 206c  ().        for l
+000374b0: 696e 6520 696e 2073 656c 662e 7363 7269  ine in self.scri
+000374c0: 7074 5f6c 696e 6573 3a0a 2020 2020 2020  pt_lines:.      
+000374d0: 2020 2020 2020 7363 7269 7074 2e77 7269        script.wri
+000374e0: 7465 286c 696e 6520 2b20 225c 6e22 290a  te(line + "\n").
+000374f0: 2020 2020 2020 2020 7363 7269 7074 2e73          script.s
+00037500: 6565 6b28 3029 0a20 2020 2020 2020 206f  eek(0).        o
+00037510: 7363 7269 7074 203d 2073 656c 662e 5f72  script = self._r
+00037520: 656f 7264 6572 5f73 6261 7463 685f 6c69  eorder_sbatch_li
+00037530: 6e65 7328 7363 7269 7074 290a 2020 2020  nes(script).    
+00037540: 2020 2020 7363 7269 7074 203d 206f 7363      script = osc
+00037550: 7269 7074 2e72 6561 6428 290a 0a20 2020  ript.read()..   
+00037560: 2020 2020 2023 2050 7269 6e74 2074 6865       # Print the
+00037570: 2073 6372 6970 7420 746f 2062 6520 7375   script to be su
+00037580: 626d 6974 7465 640a 2020 2020 2020 2020  bmitted.        
+00037590: 7072 696e 7428 7363 7269 7074 290a 0a20  print(script).. 
+000375a0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000375b0: 7375 6270 726f 6365 7373 2e72 756e 285b  subprocess.run([
+000375c0: 2273 6261 7463 6822 5d2c 2074 6578 743d  "sbatch"], text=
+000375d0: 5472 7565 2c20 7368 656c 6c3d 5472 7565  True, shell=True
+000375e0: 2c20 696e 7075 743d 7363 7269 7074 2c0a  , input=script,.
+000375f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037610: 7374 646f 7574 3d73 7562 7072 6f63 6573  stdout=subproces
+00037620: 732e 5049 5045 2c20 7374 6465 7272 3d73  s.PIPE, stderr=s
+00037630: 7562 7072 6f63 6573 732e 5049 5045 290a  ubprocess.PIPE).
+00037640: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
+00037650: 742e 7265 7475 726e 636f 6465 2021 3d20  t.returncode != 
+00037660: 303a 0a20 2020 2020 2020 2020 2020 2069  0:.            i
+00037670: 6620 2749 6e76 616c 6964 2067 656e 6572  f 'Invalid gener
+00037680: 6963 2072 6573 6f75 7263 6527 2069 6e20  ic resource' in 
+00037690: 7265 7375 6c74 2e73 7464 6572 723a 0a20  result.stderr:. 
+000376a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000376b0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+000376c0: 2020 2020 2020 2020 2020 2749 6e76 616c            'Inval
+000376d0: 6964 2067 656e 6572 6963 2072 6573 6f75  id generic resou
+000376e0: 7263 6520 7265 7175 6573 742e 2050 6c65  rce request. Ple
+000376f0: 6173 6520 6368 616e 6765 2063 6f6e 6669  ase change confi
+00037700: 6775 7261 7469 6f6e 206f 6620 736c 7572  guration of slur
+00037710: 6d5f 6c73 6372 6174 6368 2729 0a20 2020  m_lscratch').   
+00037720: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00037730: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00037740: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+00037750: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00037760: 2020 2020 2020 2066 2245 7272 6f72 2072         f"Error r
+00037770: 756e 6e69 6e67 2073 6261 7463 683a 207b  unning sbatch: {
+00037780: 7265 7375 6c74 2e73 7464 6572 722e 7374  result.stderr.st
+00037790: 7269 7028 297d 2229 0a20 2020 2020 2020  rip()}").       
+000377a0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+000377b0: 0a20 2020 2020 2020 206a 6f62 5f69 6420  .        job_id 
+000377c0: 3d20 696e 7428 7265 7375 6c74 2e73 7464  = int(result.std
+000377d0: 6f75 742e 7370 6c69 7428 295b 2d31 5d29  out.split()[-1])
+000377e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000377f0: 2e61 7267 732e 6465 6275 673a 0a20 2020  .args.debug:.   
+00037800: 2020 2020 2020 2020 206f 7363 7269 7074           oscript
+00037810: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
+00037820: 2020 2020 2077 6974 6820 6f70 656e 2866       with open(f
+00037830: 2773 7562 6d69 7474 6564 2d7b 6a6f 625f  'submitted-{job_
+00037840: 6964 7d2e 7368 272c 2022 7722 2c20 656e  id}.sh', "w", en
+00037850: 636f 6469 6e67 3d22 7574 662d 3822 2920  coding="utf-8") 
+00037860: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
+00037870: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00037880: 6974 6528 6f73 6372 6970 742e 7265 6164  ite(oscript.read
+00037890: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+000378a0: 2020 2020 7072 696e 7428 6627 2044 6562      print(f' Deb
+000378b0: 7567 2073 6372 6970 7420 6372 6561 7465  ug script create
+000378c0: 643a 2073 7562 6d69 7474 6564 2d7b 6a6f  d: submitted-{jo
+000378d0: 625f 6964 7d2e 7368 2729 0a20 2020 2020  b_id}.sh').     
+000378e0: 2020 2072 6574 7572 6e20 6a6f 625f 6964     return job_id
+000378f0: 0a0a 2020 2020 6465 6620 7371 7565 7565  ..    def squeue
+00037900: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00037910: 7265 7375 6c74 203d 2073 7562 7072 6f63  result = subproc
+00037920: 6573 732e 7275 6e28 5b22 7371 7565 7565  ess.run(["squeue
+00037930: 222c 2022 2d2d 6d65 222c 2022 2d6f 222c  ", "--me", "-o",
+00037940: 2073 656c 662e 7371 7565 7565 5f6f 7574   self.squeue_out
+00037950: 7075 745f 666f 726d 6174 5d2c 0a20 2020  put_format],.   
+00037960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037970: 2020 2020 2020 2020 2020 2020 2073 7464               std
+00037980: 6f75 743d 7375 6270 726f 6365 7373 2e50  out=subprocess.P
+00037990: 4950 452c 2073 7464 6572 723d 7375 6270  IPE, stderr=subp
+000379a0: 726f 6365 7373 2e50 4950 452c 2074 6578  rocess.PIPE, tex
+000379b0: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
+000379c0: 6966 2072 6573 756c 742e 7265 7475 726e  if result.return
+000379d0: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
+000379e0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+000379f0: 7469 6d65 4572 726f 7228 0a20 2020 2020  timeError(.     
+00037a00: 2020 2020 2020 2020 2020 2066 2245 7272             f"Err
+00037a10: 6f72 2072 756e 6e69 6e67 2073 7175 6575  or running squeu
+00037a20: 653a 207b 7265 7375 6c74 2e73 7464 6572  e: {result.stder
+00037a30: 722e 7374 7269 7028 297d 2229 0a20 2020  r.strip()}").   
+00037a40: 2020 2020 2073 656c 662e 6a6f 6273 203d       self.jobs =
+00037a50: 2073 656c 662e 5f70 6172 7365 5f73 7175   self._parse_squ
+00037a60: 6575 655f 6f75 7470 7574 2872 6573 756c  eue_output(resul
+00037a70: 742e 7374 646f 7574 2e73 7472 6970 2829  t.stdout.strip()
+00037a80: 290a 0a20 2020 2064 6566 205f 7061 7273  )..    def _pars
+00037a90: 655f 7371 7565 7565 5f6f 7574 7075 7428  e_squeue_output(
+00037aa0: 7365 6c66 2c20 6f75 7470 7574 293a 0a20  self, output):. 
+00037ab0: 2020 2020 2020 2063 7376 5f66 696c 6520         csv_file 
+00037ac0: 3d20 696f 2e53 7472 696e 6749 4f28 6f75  = io.StringIO(ou
+00037ad0: 7470 7574 290a 2020 2020 2020 2020 7265  tput).        re
+00037ae0: 6164 6572 203d 2063 7376 2e44 6963 7452  ader = csv.DictR
+00037af0: 6561 6465 7228 6373 765f 6669 6c65 2c20  eader(csv_file, 
+00037b00: 6465 6c69 6d69 7465 723d 272c 272c 0a20  delimiter=',',. 
+00037b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037b20: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00037b30: 756f 7465 6368 6172 3d27 2227 2c20 736b  uotechar='"', sk
+00037b40: 6970 696e 6974 6961 6c73 7061 6365 3d54  ipinitialspace=T
+00037b50: 7275 6529 0a20 2020 2020 2020 206a 6f62  rue).        job
+00037b60: 7320 3d20 5b72 6f77 2066 6f72 2072 6f77  s = [row for row
+00037b70: 2069 6e20 7265 6164 6572 5d0a 2020 2020   in reader].    
+00037b80: 2020 2020 7265 7475 726e 206a 6f62 730a      return jobs.
+00037b90: 0a20 2020 2064 6566 2070 7269 6e74 5f6a  .    def print_j
+00037ba0: 6f62 7328 7365 6c66 293a 0a20 2020 2020  obs(self):.     
+00037bb0: 2020 2066 6f72 206a 6f62 2069 6e20 7365     for job in se
+00037bc0: 6c66 2e6a 6f62 733a 0a20 2020 2020 2020  lf.jobs:.       
+00037bd0: 2020 2020 2070 7269 6e74 286a 6f62 290a       print(job).
+00037be0: 0a20 2020 2064 6566 206a 6f62 5f63 6f6d  .    def job_com
+00037bf0: 6d65 6e74 5f72 6561 6428 7365 6c66 2c20  ment_read(self, 
+00037c00: 6a6f 625f 6964 293a 0a20 2020 2020 2020  job_id):.       
+00037c10: 206a 6f62 6469 6374 203d 2073 656c 662e   jobdict = self.
+00037c20: 5f73 636f 6e74 726f 6c5f 7368 6f77 5f6a  _scontrol_show_j
+00037c30: 6f62 286a 6f62 5f69 6429 0a20 2020 2020  ob(job_id).     
+00037c40: 2020 2072 6574 7572 6e20 6a6f 6264 6963     return jobdic
+00037c50: 745b 2743 6f6d 6d65 6e74 275d 0a0a 2020  t['Comment']..  
+00037c60: 2020 6465 6620 6a6f 625f 636f 6d6d 656e    def job_commen
+00037c70: 745f 7772 6974 6528 7365 6c66 2c20 6a6f  t_write(self, jo
+00037c80: 625f 6964 2c20 636f 6d6d 656e 7429 3a0a  b_id, comment):.
+00037c90: 2020 2020 2020 2020 2320 6120 636f 6d6d          # a comm
+00037ca0: 656e 7420 6361 6e20 6265 206d 6178 696d  ent can be maxim
+00037cb0: 756d 2032 3530 2063 6861 7261 6374 6572  um 250 character
+00037cc0: 732c 2077 696c 6c20 6265 2063 686f 7070  s, will be chopp
+00037cd0: 6564 2061 7574 6f6d 6174 6963 616c 6c79  ed automatically
+00037ce0: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
+00037cf0: 5b27 7570 6461 7465 272c 2066 274a 6f62  ['update', f'Job
+00037d00: 4964 3d7b 7374 7228 6a6f 625f 6964 297d  Id={str(job_id)}
+00037d10: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00037d20: 2020 2066 2743 6f6d 6d65 6e74 3d7b 636f     f'Comment={co
+00037d30: 6d6d 656e 747d 272c 2073 7472 286a 6f62  mment}', str(job
+00037d40: 5f69 6429 5d0a 2020 2020 2020 2020 7265  _id)].        re
+00037d50: 7375 6c74 203d 2073 7562 7072 6f63 6573  sult = subproces
+00037d60: 732e 7275 6e28 5b27 7363 6f6e 7472 6f6c  s.run(['scontrol
+00037d70: 275d 202b 2061 7267 732c 0a20 2020 2020  '] + args,.     
+00037d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037d90: 2020 2020 2020 2020 2020 2073 7464 6f75             stdou
+00037da0: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
+00037db0: 452c 2073 7464 6572 723d 7375 6270 726f  E, stderr=subpro
+00037dc0: 6365 7373 2e50 4950 452c 2074 6578 743d  cess.PIPE, text=
+00037dd0: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
+00037de0: 2072 6573 756c 742e 7265 7475 726e 636f   result.returnco
+00037df0: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
+00037e00: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+00037e10: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
+00037e20: 2020 2020 2020 2020 2066 2245 7272 6f72           f"Error
+00037e30: 2072 756e 6e69 6e67 2073 636f 6e74 726f   running scontro
+00037e40: 6c3a 207b 7265 7375 6c74 2e73 7464 6572  l: {result.stder
+00037e50: 722e 7374 7269 7028 297d 2229 0a0a 2020  r.strip()}")..  
+00037e60: 2020 6465 6620 5f73 636f 6e74 726f 6c5f    def _scontrol_
+00037e70: 7368 6f77 5f6a 6f62 2873 656c 662c 206a  show_job(self, j
+00037e80: 6f62 5f69 6429 3a0a 2020 2020 2020 2020  ob_id):.        
+00037e90: 6172 6773 203d 205b 222d 2d6f 6e65 6c69  args = ["--oneli
+00037ea0: 6e65 7222 2c20 2273 686f 7722 2c20 226a  ner", "show", "j
+00037eb0: 6f62 222c 2073 7472 286a 6f62 5f69 6429  ob", str(job_id)
+00037ec0: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
+00037ed0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00037ee0: 6e28 5b27 7363 6f6e 7472 6f6c 275d 202b  n(['scontrol'] +
+00037ef0: 2061 7267 732c 0a20 2020 2020 2020 2020   args,.         
+00037f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037f10: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
+00037f20: 6270 726f 6365 7373 2e50 4950 452c 2073  bprocess.PIPE, s
+00037f30: 7464 6572 723d 7375 6270 726f 6365 7373  tderr=subprocess
+00037f40: 2e50 4950 452c 2074 6578 743d 5472 7565  .PIPE, text=True
+00037f50: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
+00037f60: 756c 742e 7265 7475 726e 636f 6465 2021  ult.returncode !
+00037f70: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00037f80: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+00037f90: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00037fa0: 2020 2020 2066 2245 7272 6f72 2072 756e       f"Error run
+00037fb0: 6e69 6e67 2073 636f 6e74 726f 6c3a 207b  ning scontrol: {
+00037fc0: 7265 7375 6c74 2e73 7464 6572 722e 7374  result.stderr.st
+00037fd0: 7269 7028 297d 2229 0a20 2020 2020 2020  rip()}").       
+00037fe0: 2073 656c 662e 6a6f 625f 696e 666f 203d   self.job_info =
+00037ff0: 2073 656c 662e 5f70 6172 7365 5f73 636f   self._parse_sco
+00038000: 6e74 726f 6c5f 6f75 7470 7574 2872 6573  ntrol_output(res
+00038010: 756c 742e 7374 646f 7574 290a 0a20 2020  ult.stdout)..   
+00038020: 2064 6566 205f 7061 7273 655f 7363 6f6e   def _parse_scon
+00038030: 7472 6f6c 5f6f 7574 7075 7428 7365 6c66  trol_output(self
+00038040: 2c20 6f75 7470 7574 293a 0a20 2020 2020  , output):.     
+00038050: 2020 2066 6965 6c64 7320 3d20 6f75 7470     fields = outp
+00038060: 7574 2e73 7472 6970 2829 2e73 706c 6974  ut.strip().split
+00038070: 2829 0a20 2020 2020 2020 206a 6f62 5f69  ().        job_i
+00038080: 6e66 6f20 3d20 7b7d 0a20 2020 2020 2020  nfo = {}.       
+00038090: 2066 6f72 2066 6965 6c64 2069 6e20 6669   for field in fi
+000380a0: 656c 6473 3a0a 2020 2020 2020 2020 2020  elds:.          
+000380b0: 2020 6b65 792c 2076 616c 7565 203d 2066    key, value = f
+000380c0: 6965 6c64 2e73 706c 6974 2827 3d27 2c20  ield.split('=', 
+000380d0: 3129 0a20 2020 2020 2020 2020 2020 206a  1).            j
+000380e0: 6f62 5f69 6e66 6f5b 6b65 795d 203d 2076  ob_info[key] = v
+000380f0: 616c 7565 0a20 2020 2020 2020 2072 6574  alue.        ret
+00038100: 7572 6e20 6a6f 625f 696e 666f 0a0a 2020  urn job_info..  
+00038110: 2020 6465 6620 5f70 6172 7365 5f74 6162    def _parse_tab
+00038120: 756c 6172 5f64 6174 6128 7365 6c66 2c20  ular_data(self, 
+00038130: 6461 7461 5f73 7472 2c20 7365 7061 7261  data_str, separa
+00038140: 746f 723d 227c 2229 3a0a 2020 2020 2020  tor="|"):.      
+00038150: 2020 2222 2250 6172 7365 2064 6174 6120    """Parse data 
+00038160: 2865 2e67 2e20 6163 6374 6d67 7229 2070  (e.g. acctmgr) p
+00038170: 7265 7365 6e74 6564 2069 6e20 6120 7461  resented in a ta
+00038180: 6275 6c61 7220 666f 726d 6174 2069 6e74  bular format int
+00038190: 6f20 6120 6c69 7374 206f 6620 6469 6374  o a list of dict
+000381a0: 696f 6e61 7269 6573 2e22 2222 0a20 2020  ionaries.""".   
+000381b0: 2020 2020 206c 696e 6573 203d 2064 6174       lines = dat
+000381c0: 615f 7374 722e 7374 7269 7028 292e 7370  a_str.strip().sp
+000381d0: 6c69 746c 696e 6573 2829 0a20 2020 2020  litlines().     
+000381e0: 2020 2068 6561 6465 7273 203d 206c 696e     headers = lin
+000381f0: 6573 5b30 5d2e 7370 6c69 7428 7365 7061  es[0].split(sepa
+00038200: 7261 746f 7229 0a20 2020 2020 2020 2064  rator).        d
+00038210: 6174 6120 3d20 5b5d 0a20 2020 2020 2020  ata = [].       
+00038220: 2066 6f72 206c 696e 6520 696e 206c 696e   for line in lin
+00038230: 6573 5b31 3a5d 3a0a 2020 2020 2020 2020  es[1:]:.        
+00038240: 2020 2020 7661 6c75 6573 203d 206c 696e      values = lin
+00038250: 652e 7370 6c69 7428 7365 7061 7261 746f  e.split(separato
+00038260: 7229 0a20 2020 2020 2020 2020 2020 2064  r).            d
+00038270: 6174 612e 6170 7065 6e64 2864 6963 7428  ata.append(dict(
+00038280: 7a69 7028 6865 6164 6572 732c 2076 616c  zip(headers, val
+00038290: 7565 7329 2929 0a20 2020 2020 2020 2072  ues))).        r
+000382a0: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
+000382b0: 6465 6620 5f70 6172 7365 5f70 6172 7469  def _parse_parti
+000382c0: 7469 6f6e 5f64 6174 6128 7365 6c66 2c20  tion_data(self, 
+000382d0: 6461 7461 5f73 7472 293a 0a20 2020 2020  data_str):.     
+000382e0: 2020 2022 2222 5061 7273 6520 6461 7461     """Parse data
+000382f0: 2070 7265 7365 6e74 6564 2069 6e20 6120   presented in a 
+00038300: 7461 6275 6c61 7220 666f 726d 6174 2069  tabular format i
+00038310: 6e74 6f20 6120 6c69 7374 206f 6620 6469  nto a list of di
+00038320: 6374 696f 6e61 7269 6573 2e22 2222 0a20  ctionaries.""". 
+00038330: 2020 2020 2020 206c 696e 6573 203d 2064         lines = d
+00038340: 6174 615f 7374 722e 7374 7269 7028 292e  ata_str.strip().
+00038350: 7370 6c69 7428 275c 6e27 290a 2020 2020  split('\n').    
+00038360: 2020 2020 2320 5061 7273 6520 6561 6368      # Parse each
+00038370: 206c 696e 6520 696e 746f 2061 2064 6963   line into a dic
+00038380: 7469 6f6e 6172 790a 2020 2020 2020 2020  tionary.        
+00038390: 7061 7274 6974 696f 6e73 203d 205b 5d0a  partitions = [].
+000383a0: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
+000383b0: 2069 6e20 6c69 6e65 733a 0a20 2020 2020   in lines:.     
+000383c0: 2020 2020 2020 2070 6172 7473 203d 206c         parts = l
+000383d0: 696e 652e 7370 6c69 7428 290a 2020 2020  ine.split().    
+000383e0: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+000383f0: 6e5f 6469 6374 203d 207b 7d0a 2020 2020  n_dict = {}.    
+00038400: 2020 2020 2020 2020 666f 7220 7061 7274          for part
+00038410: 2069 6e20 7061 7274 733a 0a20 2020 2020   in parts:.     
+00038420: 2020 2020 2020 2020 2020 206b 6579 2c20             key, 
+00038430: 7661 6c75 6520 3d20 7061 7274 2e73 706c  value = part.spl
+00038440: 6974 2822 3d22 2c20 3129 0a20 2020 2020  it("=", 1).     
+00038450: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+00038460: 7469 6f6e 5f64 6963 745b 6b65 795d 203d  tion_dict[key] =
+00038470: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
+00038480: 2020 2070 6172 7469 7469 6f6e 732e 6170     partitions.ap
+00038490: 7065 6e64 2870 6172 7469 7469 6f6e 5f64  pend(partition_d
+000384a0: 6963 7429 0a20 2020 2020 2020 2072 6574  ict).        ret
+000384b0: 7572 6e20 7061 7274 6974 696f 6e73 0a0a  urn partitions..
+000384c0: 2020 2020 6465 6620 5f67 6574 5f75 7365      def _get_use
+000384d0: 725f 6772 6f75 7073 2873 656c 6629 3a0a  r_groups(self):.
+000384e0: 2020 2020 2020 2020 2222 2247 6574 2074          """Get t
+000384f0: 6865 2067 726f 7570 7320 7468 6520 6375  he groups the cu
+00038500: 7272 656e 7420 556e 6978 2075 7365 7220  rrent Unix user 
+00038510: 6973 2061 206d 656d 6265 7220 6f66 2e22  is a member of."
+00038520: 2222 0a20 2020 2020 2020 2067 726f 7570  "".        group
+00038530: 7320 3d20 5b67 7270 2e67 6574 6772 6769  s = [grp.getgrgi
+00038540: 6428 6769 6429 2e67 725f 6e61 6d65 2066  d(gid).gr_name f
+00038550: 6f72 2067 6964 2069 6e20 6f73 2e67 6574  or gid in os.get
+00038560: 6772 6f75 7073 2829 5d0a 2020 2020 2020  groups()].      
+00038570: 2020 7265 7475 726e 2067 726f 7570 730a    return groups.
+00038580: 0a20 2020 2064 6566 205f 6765 745f 6f75  .    def _get_ou
+00038590: 7470 7574 2873 656c 662c 2063 6f6d 6d61  tput(self, comma
+000385a0: 6e64 293a 0a20 2020 2020 2020 2022 2222  nd):.        """
+000385b0: 4578 6563 7574 6520 6120 7368 656c 6c20  Execute a shell 
+000385c0: 636f 6d6d 616e 6420 616e 6420 7265 7475  command and retu
+000385d0: 726e 2069 7473 206f 7574 7075 742e 2222  rn its output.""
+000385e0: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
+000385f0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00038600: 6e28 636f 6d6d 616e 642c 2073 6865 6c6c  n(command, shell
+00038610: 3d54 7275 652c 2074 6578 743d 5472 7565  =True, text=True
+00038620: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00038630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038640: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
+00038650: 6573 732e 5049 5045 2c20 7374 6465 7272  ess.PIPE, stderr
+00038660: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
+00038670: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
+00038680: 756c 742e 7265 7475 726e 636f 6465 2021  ult.returncode !
+00038690: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000386a0: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+000386b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+000386c0: 2020 2020 2066 2245 7272 6f72 2072 756e       f"Error run
+000386d0: 6e69 6e67 207b 636f 6d6d 616e 647d 3a20  ning {command}: 
+000386e0: 7b72 6573 756c 742e 7374 6465 7272 2e73  {result.stderr.s
+000386f0: 7472 6970 2829 7d22 290a 2020 2020 2020  trip()}").      
+00038700: 2020 7265 7475 726e 2072 6573 756c 742e    return result.
+00038710: 7374 646f 7574 2e73 7472 6970 2829 0a0a  stdout.strip()..
+00038720: 2020 2020 6465 6620 5f67 6574 5f64 6566      def _get_def
+00038730: 6175 6c74 5f61 6363 6f75 6e74 2873 656c  ault_account(sel
+00038740: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00038750: 726e 2073 656c 662e 5f67 6574 5f6f 7574  rn self._get_out
+00038760: 7075 7428 6627 7361 6363 746d 6772 202d  put(f'sacctmgr -
+00038770: 2d6e 6f68 6561 6465 7220 2d2d 7061 7273  -noheader --pars
+00038780: 6162 6c65 3220 7368 6f77 2075 7365 7220  able2 show user 
+00038790: 7b73 656c 662e 6366 672e 7768 6f61 6d69  {self.cfg.whoami
+000387a0: 7d20 666f 726d 6174 3d44 6566 6175 6c74  } format=Default
+000387b0: 4163 636f 756e 7427 290a 0a20 2020 2064  Account')..    d
+000387c0: 6566 205f 6765 745f 6173 736f 6369 6174  ef _get_associat
+000387d0: 696f 6e73 2873 656c 6629 3a0a 2020 2020  ions(self):.    
+000387e0: 2020 2020 6d79 7374 7220 3d20 7365 6c66      mystr = self
+000387f0: 2e5f 6765 745f 6f75 7470 7574 280a 2020  ._get_output(.  
+00038800: 2020 2020 2020 2020 2020 6622 7361 6363            f"sacc
+00038810: 746d 6772 2073 686f 7720 6173 736f 6369  tmgr show associ
+00038820: 6174 696f 6e73 2077 6865 7265 2075 7365  ations where use
+00038830: 723d 7b73 656c 662e 6366 672e 7768 6f61  r={self.cfg.whoa
+00038840: 6d69 7d20 666f 726d 6174 3d41 6363 6f75  mi} format=Accou
+00038850: 6e74 2c51 4f53 202d 2d70 6172 7361 626c  nt,QOS --parsabl
+00038860: 6532 2229 0a20 2020 2020 2020 2061 7373  e2").        ass
+00038870: 6f20 3d20 7b69 7465 6d5b 2741 6363 6f75  o = {item['Accou
+00038880: 6e74 275d 3a20 6974 656d 5b27 514f 5327  nt']: item['QOS'
+00038890: 5d2e 7370 6c69 7428 0a20 2020 2020 2020  ].split(.       
+000388a0: 2020 2020 2022 2c22 2920 666f 7220 6974       ",") for it
+000388b0: 656d 2069 6e20 7365 6c66 2e5f 7061 7273  em in self._pars
+000388c0: 655f 7461 6275 6c61 725f 6461 7461 286d  e_tabular_data(m
+000388d0: 7973 7472 2920 6966 2027 4163 636f 756e  ystr) if 'Accoun
+000388e0: 7427 2069 6e20 6974 656d 7d0a 2020 2020  t' in item}.    
+000388f0: 2020 2020 7265 7475 726e 2061 7373 6f0a      return asso.
+00038900: 0a20 2020 2064 6566 2067 6574 5f61 6c6c  .    def get_all
+00038910: 6f77 6564 5f70 6172 7469 7469 6f6e 735f  owed_partitions_
+00038920: 616e 645f 716f 7328 7365 6c66 293a 0a20  and_qos(self):. 
+00038930: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00038940: 2020 2020 2020 2020 2222 2247 6574 2061          """Get a
+00038950: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+00038960: 206b 6579 7320 3d20 7061 7274 6974 696f   keys = partitio
+00038970: 6e73 2061 6e64 2076 616c 7565 7320 3d20  ns and values = 
+00038980: 514f 5373 2074 6865 2075 7365 7220 6973  QOSs the user is
+00038990: 2061 6c6c 6f77 6564 2074 6f20 7573 652e   allowed to use.
+000389a0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+000389b0: 6261 6363 203d 206f 732e 656e 7669 726f  bacc = os.enviro
+000389c0: 6e2e 6765 7428 2753 4241 5443 485f 4143  n.get('SBATCH_AC
+000389d0: 434f 554e 5427 2c20 2727 290a 2020 2020  COUNT', '').    
+000389e0: 2020 2020 2020 2020 6163 636f 756e 7420          account 
+000389f0: 3d20 6261 6363 2069 6620 6261 6363 2065  = bacc if bacc e
+00038a00: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
+00038a10: 2020 2020 2073 6163 6320 3d20 6f73 2e65       sacc = os.e
+00038a20: 6e76 6972 6f6e 2e67 6574 2827 534c 5552  nviron.get('SLUR
+00038a30: 4d5f 4143 434f 554e 5427 2c20 2727 290a  M_ACCOUNT', '').
+00038a40: 2020 2020 2020 2020 2020 2020 6163 636f              acco
+00038a50: 756e 7420 3d20 7361 6363 2069 6620 7361  unt = sacc if sa
+00038a60: 6363 2065 6c73 6520 6163 636f 756e 740a  cc else account.
+00038a70: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00038a80: 7765 645f 7061 7274 6974 696f 6e73 203d  wed_partitions =
+00038a90: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+00038aa0: 7061 7274 6974 696f 6e5f 7374 7220 3d20  partition_str = 
+00038ab0: 7365 6c66 2e5f 6765 745f 6f75 7470 7574  self._get_output
+00038ac0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00038ad0: 2020 2273 636f 6e74 726f 6c20 7368 6f77    "scontrol show
+00038ae0: 2070 6172 7469 7469 6f6e 202d 2d6f 6e65   partition --one
+00038af0: 6c69 6e65 7222 290a 2020 2020 2020 2020  liner").        
+00038b00: 2020 2020 7061 7274 6974 696f 6e73 203d      partitions =
+00038b10: 2073 656c 662e 5f70 6172 7365 5f70 6172   self._parse_par
+00038b20: 7469 7469 6f6e 5f64 6174 6128 7061 7274  tition_data(part
+00038b30: 6974 696f 6e5f 7374 7229 0a20 2020 2020  ition_str).     
+00038b40: 2020 2020 2020 2075 7365 725f 6772 6f75         user_grou
+00038b50: 7073 203d 2073 656c 662e 5f67 6574 5f75  ps = self._get_u
+00038b60: 7365 725f 6772 6f75 7073 2829 0a20 2020  ser_groups().   
+00038b70: 2020 2020 2020 2020 2069 6620 6163 636f           if acco
+00038b80: 756e 7420 6973 204e 6f6e 653a 0a20 2020  unt is None:.   
+00038b90: 2020 2020 2020 2020 2020 2020 2061 6363               acc
+00038ba0: 6f75 6e74 203d 2073 656c 662e 5f67 6574  ount = self._get
+00038bb0: 5f64 6566 6175 6c74 5f61 6363 6f75 6e74  _default_account
+00038bc0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+00038bd0: 6f72 2070 6172 7469 7469 6f6e 2069 6e20  or partition in 
+00038be0: 7061 7274 6974 696f 6e73 3a0a 2020 2020  partitions:.    
+00038bf0: 2020 2020 2020 2020 2020 2020 706e 616d              pnam
+00038c00: 6520 3d20 7061 7274 6974 696f 6e5b 2750  e = partition['P
+00038c10: 6172 7469 7469 6f6e 4e61 6d65 275d 0a20  artitionName']. 
+00038c20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00038c30: 6464 5f70 6172 7469 7469 6f6e 203d 2046  dd_partition = F
+00038c40: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00038c50: 2020 2020 2069 6620 7061 7274 6974 696f       if partitio
+00038c60: 6e2e 6765 7428 2753 7461 7465 272c 2027  n.get('State', '
+00038c70: 2729 2021 3d20 2755 5027 3a0a 2020 2020  ') != 'UP':.    
+00038c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c90: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00038ca0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
+00038cb0: 6772 6f75 7020 696e 2075 7365 725f 6772  group in user_gr
+00038cc0: 6f75 7073 2066 6f72 2067 726f 7570 2069  oups for group i
+00038cd0: 6e20 7061 7274 6974 696f 6e2e 6765 7428  n partition.get(
+00038ce0: 2744 656e 7947 726f 7570 7327 2c20 2727  'DenyGroups', ''
+00038cf0: 292e 7370 6c69 7428 272c 2729 293a 0a20  ).split(',')):. 
+00038d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038d10: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00038d20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00038d30: 6363 6f75 6e74 2069 6e20 7061 7274 6974  ccount in partit
+00038d40: 696f 6e2e 6765 7428 2744 656e 7941 6363  ion.get('DenyAcc
+00038d50: 6f75 6e74 7327 2c20 2727 292e 7370 6c69  ounts', '').spli
+00038d60: 7428 272c 2729 3a0a 2020 2020 2020 2020  t(','):.        
+00038d70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00038d80: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00038d90: 2020 2020 2061 6c6c 6f77 6564 6163 636f       allowedacco
+00038da0: 756e 7473 203d 2070 6172 7469 7469 6f6e  unts = partition
+00038db0: 2e67 6574 2827 416c 6c6f 7741 6363 6f75  .get('AllowAccou
+00038dc0: 6e74 7327 2c20 2727 292e 7370 6c69 7428  nts', '').split(
+00038dd0: 272c 2729 0a20 2020 2020 2020 2020 2020  ',').           
+00038de0: 2020 2020 2069 6620 616c 6c6f 7765 6461       if alloweda
+00038df0: 6363 6f75 6e74 7320 213d 205b 2727 5d3a  ccounts != ['']:
+00038e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038e10: 2020 2020 2069 6620 6163 636f 756e 7420       if account 
+00038e20: 696e 2061 6c6c 6f77 6564 6163 636f 756e  in allowedaccoun
+00038e30: 7473 206f 7220 2741 4c4c 2720 696e 2061  ts or 'ALL' in a
+00038e40: 6c6c 6f77 6564 6163 636f 756e 7473 3a0a  llowedaccounts:.
+00038e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038e60: 2020 2020 2020 2020 6164 645f 7061 7274          add_part
+00038e70: 6974 696f 6e20 3d20 5472 7565 0a20 2020  ition = True.   
+00038e80: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00038e90: 6620 616e 7928 6772 6f75 7020 696e 2075  f any(group in u
+00038ea0: 7365 725f 6772 6f75 7073 2066 6f72 2067  ser_groups for g
+00038eb0: 726f 7570 2069 6e20 7061 7274 6974 696f  roup in partitio
+00038ec0: 6e2e 6765 7428 2741 6c6c 6f77 4772 6f75  n.get('AllowGrou
+00038ed0: 7073 272c 2027 2729 2e73 706c 6974 2827  ps', '').split('
+00038ee0: 2c27 2929 3a0a 2020 2020 2020 2020 2020  ,')):.          
+00038ef0: 2020 2020 2020 2020 2020 6164 645f 7061            add_pa
+00038f00: 7274 6974 696f 6e20 3d20 5472 7565 0a20  rtition = True. 
+00038f10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00038f20: 6c69 6620 7061 7274 6974 696f 6e2e 6765  lif partition.ge
+00038f30: 7428 2741 6c6c 6f77 4772 6f75 7073 272c  t('AllowGroups',
+00038f40: 2027 2729 203d 3d20 2741 4c4c 273a 0a20   '') == 'ALL':. 
+00038f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038f60: 2020 2061 6464 5f70 6172 7469 7469 6f6e     add_partition
+00038f70: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00038f80: 2020 2020 2020 2020 6966 2061 6464 5f70          if add_p
+00038f90: 6172 7469 7469 6f6e 3a0a 2020 2020 2020  artition:.      
+00038fa0: 2020 2020 2020 2020 2020 2020 2020 705f                p_
+00038fb0: 6465 6e69 6564 716f 7320 3d20 7061 7274  deniedqos = part
+00038fc0: 6974 696f 6e2e 6765 7428 2744 656e 7951  ition.get('DenyQ
+00038fd0: 6f73 272c 2027 2729 2e73 706c 6974 2827  os', '').split('
+00038fe0: 2c27 290a 2020 2020 2020 2020 2020 2020  ,').            
+00038ff0: 2020 2020 2020 2020 705f 616c 6c6f 7765          p_allowe
+00039000: 6471 6f73 203d 2070 6172 7469 7469 6f6e  dqos = partition
+00039010: 2e67 6574 2827 416c 6c6f 7751 6f73 272c  .get('AllowQos',
+00039020: 2027 2729 2e73 706c 6974 2827 2c27 290a   '').split(',').
+00039030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039040: 2020 2020 6173 736f 6369 6174 696f 6e73      associations
+00039050: 203d 2073 656c 662e 5f67 6574 5f61 7373   = self._get_ass
+00039060: 6f63 6961 7469 6f6e 7328 290a 2020 2020  ociations().    
+00039070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039080: 6163 636f 756e 745f 716f 7320 3d20 6173  account_qos = as
+00039090: 736f 6369 6174 696f 6e73 2e67 6574 2861  sociations.get(a
+000390a0: 6363 6f75 6e74 2c20 5b5d 290a 2020 2020  ccount, []).    
+000390b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000390c0: 6966 2070 5f64 656e 6965 6471 6f73 2021  if p_deniedqos !
+000390d0: 3d20 5b27 275d 3a0a 2020 2020 2020 2020  = ['']:.        
+000390e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000390f0: 616c 6c6f 7765 645f 716f 7320 3d20 5b0a  allowed_qos = [.
+00039100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039110: 2020 2020 2020 2020 2020 2020 7120 666f              q fo
+00039120: 7220 7120 696e 2061 6363 6f75 6e74 5f71  r q in account_q
+00039130: 6f73 2069 6620 7120 6e6f 7420 696e 2070  os if q not in p
+00039140: 5f64 656e 6965 6471 6f73 5d0a 2020 2020  _deniedqos].    
+00039150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039160: 2020 2020 2320 7072 696e 7428 6622 705f      # print(f"p_
+00039170: 6465 6e69 6564 716f 733a 2061 6c6c 6f77  deniedqos: allow
+00039180: 6564 5f71 6f73 2069 6e20 7b70 6e61 6d65  ed_qos in {pname
+00039190: 7d3a 222c 2061 6c6c 6f77 6564 5f71 6f73  }:", allowed_qos
+000391a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000391b0: 2020 2020 2020 656c 6966 2070 5f61 6c6c        elif p_all
+000391c0: 6f77 6564 716f 7320 3d3d 205b 2741 4c4c  owedqos == ['ALL
+000391d0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+000391e0: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+000391f0: 7765 645f 716f 7320 3d20 6163 636f 756e  wed_qos = accoun
+00039200: 745f 716f 730a 2020 2020 2020 2020 2020  t_qos.          
+00039210: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00039220: 7072 696e 7428 6622 705f 616c 6c6f 7765  print(f"p_allowe
+00039230: 6471 6f73 203d 2041 4c4c 2069 6e20 7b70  dqos = ALL in {p
+00039240: 6e61 6d65 7d3a 222c 2061 6c6c 6f77 6564  name}:", allowed
+00039250: 5f71 6f73 290a 2020 2020 2020 2020 2020  _qos).          
+00039260: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
+00039270: 5f61 6c6c 6f77 6564 716f 7320 213d 205b  _allowedqos != [
+00039280: 2727 5d3a 0a20 2020 2020 2020 2020 2020  '']:.           
+00039290: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
+000392a0: 6f77 6564 5f71 6f73 203d 205b 0a20 2020  owed_qos = [.   
+000392b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000392c0: 2020 2020 2020 2020 2071 2066 6f72 2071           q for q
+000392d0: 2069 6e20 6163 636f 756e 745f 716f 7320   in account_qos 
+000392e0: 6966 2071 2069 6e20 705f 616c 6c6f 7765  if q in p_allowe
+000392f0: 6471 6f73 5d0a 2020 2020 2020 2020 2020  dqos].          
+00039300: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00039310: 7072 696e 7428 6622 705f 616c 6c6f 7765  print(f"p_allowe
+00039320: 6471 6f73 3a20 616c 6c6f 7765 645f 716f  dqos: allowed_qo
+00039330: 7320 696e 207b 706e 616d 657d 3a22 2c20  s in {pname}:", 
+00039340: 616c 6c6f 7765 645f 716f 7329 0a20 2020  allowed_qos).   
+00039350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039360: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00039370: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00039380: 6c6c 6f77 6564 5f71 6f73 203d 205b 5d0a  llowed_qos = [].
+00039390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000393a0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+000393b0: 6622 705f 616c 6c6f 7765 6471 6f73 203d  f"p_allowedqos =
+000393c0: 205b 5d20 696e 207b 706e 616d 657d 3a22   [] in {pname}:"
+000393d0: 2c20 616c 6c6f 7765 645f 716f 7329 0a20  , allowed_qos). 
+000393e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000393f0: 2020 2061 6c6c 6f77 6564 5f70 6172 7469     allowed_parti
+00039400: 7469 6f6e 735b 706e 616d 655d 203d 2061  tions[pname] = a
+00039410: 6c6c 6f77 6564 5f71 6f73 0a20 2020 2020  llowed_qos.     
+00039420: 2020 2020 2020 2072 6574 7572 6e20 616c         return al
+00039430: 6c6f 7765 645f 7061 7274 6974 696f 6e73  lowed_partitions
+00039440: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00039450: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00039460: 6e74 5f65 7272 6f72 2829 0a20 2020 2020  nt_error().     
+00039470: 2020 2020 2020 2070 7269 6e74 2822 4172         print("Ar
+00039480: 6520 796f 7520 696e 2061 2043 6f6e 7472  e you in a Contr
+00039490: 6f6c 204e 6f64 653f 2229 0a20 2020 2020  ol Node?").     
+000394a0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+000394b0: 3129 0a0a 2020 2020 6465 6620 6469 7370  1)..    def disp
+000394c0: 6c61 795f 6a6f 625f 696e 666f 2873 656c  lay_job_info(sel
+000394d0: 6629 3a0a 2020 2020 2020 2020 7072 696e  f):.        prin
+000394e0: 7428 7365 6c66 2e6a 6f62 5f69 6e66 6f29  t(self.job_info)
+000394f0: 0a0a 0a63 6c61 7373 204e 4948 5265 706f  ...class NIHRepo
+00039500: 7274 6572 3a0a 2020 2020 2320 6966 2077  rter:.    # if w
+00039510: 6520 7573 6520 2d2d 6e69 6820 6173 2061  e use --nih as a
+00039520: 6e20 6172 6775 6d65 6e74 2077 6520 7175  n argument we qu
+00039530: 6572 7920 4e49 4820 5265 706f 7274 6572  ery NIH Reporter
+00039540: 0a20 2020 2023 2066 6f72 206d 6574 6164  .    # for metad
+00039550: 6174 610a 0a20 2020 2064 6566 205f 5f69  ata..    def __i
+00039560: 6e69 745f 5f28 7365 6c66 2c20 7665 7262  nit__(self, verb
+00039570: 6f73 653d 4661 6c73 652c 2061 6374 6976  ose=False, activ
+00039580: 653d 4661 6c73 652c 2079 6561 7273 3d4e  e=False, years=N
+00039590: 6f6e 6529 3a0a 2020 2020 2020 2020 2320  one):.        # 
+000395a0: 7365 6c66 2e61 7267 7320 3d20 6172 6773  self.args = args
+000395b0: 0a20 2020 2020 2020 2073 656c 662e 7665  .        self.ve
+000395c0: 7262 6f73 6520 3d20 7665 7262 6f73 650a  rbose = verbose.
+000395d0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+000395e0: 6976 6520 3d20 6163 7469 7665 0a20 2020  ive = active.   
+000395f0: 2020 2020 2073 656c 662e 7965 6172 7320       self.years 
+00039600: 3d20 7965 6172 730a 2020 2020 2020 2020  = years.        
+00039610: 7365 6c66 2e75 726c 203d 2027 6874 7470  self.url = 'http
+00039620: 733a 2f2f 6170 692e 7265 706f 7274 6572  s://api.reporter
+00039630: 2e6e 6968 2e67 6f76 2f76 322f 7072 6f6a  .nih.gov/v2/proj
+00039640: 6563 7473 2f73 6561 7263 6827 0a20 2020  ects/search'.   
+00039650: 2020 2020 2073 656c 662e 6578 636c 7564       self.exclud
+00039660: 655f 6669 656c 6473 203d 205b 2754 6572  e_fields = ['Ter
+00039670: 6d73 272c 2027 4162 7374 7261 6374 5465  ms', 'AbstractTe
+00039680: 7874 272c 0a20 2020 2020 2020 2020 2020  xt',.           
+00039690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000396a0: 2020 2020 2750 6872 5465 7874 275d 2020      'PhrText']  
+000396b0: 2320 7072 6566 5f74 6572 6d73 2073 7469  # pref_terms sti
+000396c0: 6c6c 2069 6e63 6c75 6465 640a 2020 2020  ll included.    
+000396d0: 2020 2020 7365 6c66 2e67 7261 6e74 7320      self.grants 
+000396e0: 3d20 5b5d 0a0a 2020 2020 6465 6620 7365  = []..    def se
+000396f0: 6172 6368 5f66 756c 6c28 7365 6c66 2c20  arch_full(self, 
+00039700: 7365 6172 6368 7374 7229 3a0a 2020 2020  searchstr):.    
+00039710: 2020 2020 7365 6172 6368 7374 7220 3d20      searchstr = 
+00039720: 7365 6c66 2e5f 636c 6561 6e5f 7374 7269  self._clean_stri
+00039730: 6e67 2873 6561 7263 6873 7472 290a 2020  ng(searchstr).  
+00039740: 2020 2020 2020 6966 206e 6f74 2073 6561        if not sea
+00039750: 7263 6873 7472 3a0a 2020 2020 2020 2020  rchstr:.        
+00039760: 2020 2020 7265 7475 726e 205b 5d0a 0a20      return [].. 
+00039770: 2020 2020 2020 2023 2053 6561 7263 6820         # Search 
+00039780: 6279 2050 490a 2020 2020 2020 2020 6966  by PI.        if
+00039790: 206e 6f74 2073 656c 662e 5f69 735f 6e75   not self._is_nu
+000397a0: 6d62 6572 2873 6561 7263 6873 7472 293a  mber(searchstr):
+000397b0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000397c0: 6e74 2827 5049 2073 6561 7263 6820 2e2e  nt('PI search ..
+000397d0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+000397e0: 6372 6974 6572 6961 203d 207b 2270 695f  criteria = {"pi_
+000397f0: 6e61 6d65 7322 3a20 5b7b 2261 6e79 5f6e  names": [{"any_n
+00039800: 616d 6522 3a20 7365 6172 6368 7374 727d  ame": searchstr}
+00039810: 5d7d 0a20 2020 2020 2020 2020 2020 2073  ]}.            s
+00039820: 656c 662e 5f70 6f73 745f 7265 7175 6573  elf._post_reques
+00039830: 7428 6372 6974 6572 6961 290a 2020 2020  t(criteria).    
+00039840: 2020 2020 2020 2020 7072 696e 7428 272a          print('*
+00039850: 2023 2047 7261 6e74 733a 272c 206c 656e   # Grants:', len
+00039860: 2873 656c 662e 6772 616e 7473 2929 0a0a  (self.grants))..
+00039870: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00039880: 656c 662e 6772 616e 7473 3a0a 2020 2020  elf.grants:.    
+00039890: 2020 2020 2020 2020 2320 5365 6172 6368          # Search
+000398a0: 2062 7920 5072 6f6a 6563 740a 2020 2020   by Project.    
+000398b0: 2020 2020 2020 2020 7072 696e 7428 2750          print('P
+000398c0: 726f 6a65 6374 2073 6561 7263 6820 2e2e  roject search ..
+000398d0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+000398e0: 6372 6974 6572 6961 203d 207b 2770 726f  criteria = {'pro
+000398f0: 6a65 6374 5f6e 756d 7327 3a20 5b73 6561  ject_nums': [sea
+00039900: 7263 6873 7472 5d7d 0a20 2020 2020 2020  rchstr]}.       
+00039910: 2020 2020 2073 656c 662e 5f70 6f73 745f       self._post_
+00039920: 7265 7175 6573 7428 6372 6974 6572 6961  request(criteria
+00039930: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00039940: 696e 7428 272a 2023 2047 7261 6e74 733a  int('* # Grants:
+00039950: 272c 206c 656e 2873 656c 662e 6772 616e  ', len(self.gran
+00039960: 7473 2929 0a0a 2020 2020 2020 2020 6966  ts))..        if
+00039970: 206e 6f74 2073 656c 662e 6772 616e 7473   not self.grants
+00039980: 2061 6e64 206e 6f74 2073 656c 662e 5f69   and not self._i
+00039990: 735f 6e75 6d62 6572 2873 6561 7263 6873  s_number(searchs
+000399a0: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+000399b0: 2023 2053 6561 7263 6820 6279 204f 7267   # Search by Org
+000399c0: 616e 697a 6174 696f 6e73 0a20 2020 2020  anizations.     
+000399d0: 2020 2020 2020 2070 7269 6e74 2827 4f72         print('Or
+000399e0: 6720 7365 6172 6368 202e 2e2e 2729 0a20  g search ...'). 
+000399f0: 2020 2020 2020 2020 2020 2063 7269 7465             crite
+00039a00: 7269 6120 3d20 7b27 6f72 675f 6e61 6d65  ria = {'org_name
+00039a10: 7327 3a20 5b73 6561 7263 6873 7472 5d7d  s': [searchstr]}
+00039a20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00039a30: 662e 5f70 6f73 745f 7265 7175 6573 7428  f._post_request(
+00039a40: 6372 6974 6572 6961 290a 2020 2020 2020  criteria).      
+00039a50: 2020 2020 2020 7072 696e 7428 272a 2023        print('* #
+00039a60: 2047 7261 6e74 733a 272c 206c 656e 2873   Grants:', len(s
+00039a70: 656c 662e 6772 616e 7473 2929 0a0a 2020  elf.grants))..  
+00039a80: 2020 2020 2020 2320 5365 6172 6368 2062        # Search b
+00039a90: 7920 7465 7874 2069 6e20 2022 7072 6f6a  y text in  "proj
+00039aa0: 6563 7474 6974 6c65 222c 2022 7465 726d  ecttitle", "term
+00039ab0: 7322 2c20 616e 6420 2261 6273 7472 6163  s", and "abstrac
+00039ac0: 7474 6578 7422 0a20 2020 2020 2020 2070  ttext".        p
+00039ad0: 7269 6e74 2827 5465 7874 2073 6561 7263  rint('Text searc
+00039ae0: 6820 2e2e 2e27 290a 2020 2020 2020 2020  h ...').        
+00039af0: 6372 6974 6572 6961 203d 207b 2761 6476  criteria = {'adv
+00039b00: 616e 6365 645f 7465 7874 5f73 6561 7263  anced_text_searc
+00039b10: 6827 3a0a 2020 2020 2020 2020 2020 2020  h':.            
+00039b20: 2020 2020 2020 2020 7b27 6f70 6572 6174          {'operat
+00039b30: 6f72 273a 2027 616e 6427 2c20 2773 6561  or': 'and', 'sea
+00039b40: 7263 685f 6669 656c 6427 3a20 2761 6c6c  rch_field': 'all
+00039b50: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00039b60: 2020 2020 2020 2020 2773 6561 7263 685f          'search_
+00039b70: 7465 7874 273a 2073 6561 7263 6873 7472  text': searchstr
+00039b80: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00039b90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00039ba0: 7365 6c66 2e5f 706f 7374 5f72 6571 7565  self._post_reque
+00039bb0: 7374 2863 7269 7465 7269 6129 0a20 2020  st(criteria).   
+00039bc0: 2020 2020 2070 7269 6e74 2827 2a20 2320       print('* # 
+00039bd0: 4772 616e 7473 3a27 2c20 6c65 6e28 7365  Grants:', len(se
+00039be0: 6c66 2e67 7261 6e74 7329 290a 0a20 2020  lf.grants))..   
+00039bf0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00039c00: 2e5f 7265 7375 6c74 5f73 6574 7328 5472  ._result_sets(Tr
+00039c10: 7565 290a 0a20 2020 2064 6566 2073 6561  ue)..    def sea
+00039c20: 7263 685f 6f6e 6528 7365 6c66 2c20 6372  rch_one(self, cr
+00039c30: 6974 6572 6961 2c20 6865 6164 6572 3d46  iteria, header=F
+00039c40: 616c 7365 293a 0a20 2020 2020 2020 2073  alse):.        s
+00039c50: 6561 7263 6873 7472 203d 2073 656c 662e  earchstr = self.
+00039c60: 5f63 6c65 616e 5f73 7472 696e 6728 7365  _clean_string(se
+00039c70: 6172 6368 7374 7229 0a20 2020 2020 2020  archstr).       
+00039c80: 2073 656c 662e 5f70 6f73 745f 7265 7175   self._post_requ
+00039c90: 6573 7428 6372 6974 6572 6961 290a 2020  est(criteria).  
+00039ca0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00039cb0: 662e 5f72 6573 756c 745f 7365 7473 2868  f._result_sets(h
+00039cc0: 6561 6465 7229 0a0a 2020 2020 6465 6620  eader)..    def 
+00039cd0: 5f69 735f 6e75 6d62 6572 2873 656c 662c  _is_number(self,
+00039ce0: 2073 7472 696e 6729 3a0a 2020 2020 2020   string):.      
+00039cf0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00039d00: 2020 2066 6c6f 6174 2873 7472 696e 6729     float(string)
+00039d10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00039d20: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00039d30: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00039d40: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00039d50: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+00039d60: 2020 6465 6620 5f63 6c65 616e 5f73 7472    def _clean_str
+00039d70: 696e 6728 7365 6c66 2c20 6d79 7374 7269  ing(self, mystri
+00039d80: 6e67 293a 0a20 2020 2020 2020 206d 7963  ng):.        myc
+00039d90: 6861 7273 203d 2022 2c3a 3f27 245e 2526  hars = ",:?'$^%&
+00039da0: 2a21 607e 2b3d 7b7d 5c5c 5b5d 222b 2722  *!`~+={}\\[]"+'"
+00039db0: 270a 2020 2020 2020 2020 666f 7220 6920  '.        for i 
+00039dc0: 696e 206d 7963 6861 7273 3a0a 2020 2020  in mychars:.    
+00039dd0: 2020 2020 2020 2020 6d79 7374 7269 6e67          mystring
+00039de0: 203d 206d 7973 7472 696e 672e 7265 706c   = mystring.repl
+00039df0: 6163 6528 692c 2027 2027 290a 2020 2020  ace(i, ' ').    
+00039e00: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00039e10: 276d 7973 7472 696e 673a 272c 206d 7973  'mystring:', mys
+00039e20: 7472 696e 6729 0a20 2020 2020 2020 2072  tring).        r
+00039e30: 6574 7572 6e20 6d79 7374 7269 6e67 0a0a  eturn mystring..
+00039e40: 2020 2020 6465 6620 5f70 6f73 745f 7265      def _post_re
+00039e50: 7175 6573 7428 7365 6c66 2c20 6372 6974  quest(self, crit
+00039e60: 6572 6961 293a 0a20 2020 2020 2020 2023  eria):.        #
+00039e70: 206d 616b 6520 7265 7175 6573 7420 7769   make request wi
+00039e80: 7468 2072 6574 7269 6573 0a20 2020 2020  th retries.     
+00039e90: 2020 206f 6666 7365 7420 3d20 300a 2020     offset = 0.  
+00039ea0: 2020 2020 2020 7469 6d65 6f75 7420 3d20        timeout = 
+00039eb0: 3330 0a20 2020 2020 2020 206c 696d 6974  30.        limit
+00039ec0: 203d 2032 3530 0a20 2020 2020 2020 206d   = 250.        m
+00039ed0: 6178 203d 2032 3530 0a20 2020 2020 2020  ax = 250.       
+00039ee0: 206d 6178 5f72 6574 7269 6573 203d 2035   max_retries = 5
+00039ef0: 0a20 2020 2020 2020 2072 6574 7279 5f64  .        retry_d
+00039f00: 656c 6179 203d 2031 0a20 2020 2020 2020  elay = 1.       
+00039f10: 2072 6574 7279 5f63 6f75 6e74 203d 2030   retry_count = 0
+00039f20: 0a20 2020 2020 2020 2074 6f74 616c 203d  .        total =
+00039f30: 206d 6178 0a20 2020 2020 2020 2023 2066   max.        # f
+00039f40: 6f72 2072 6574 7279 5f63 6f75 6e74 2069  or retry_count i
+00039f50: 6e20 7261 6e67 6528 6d61 785f 7265 7472  n range(max_retr
+00039f60: 6965 7329 3a0a 2020 2020 2020 2020 7472  ies):.        tr
+00039f70: 793a 0a20 2020 2020 2020 2020 2020 2077  y:.            w
+00039f80: 6869 6c65 206f 6666 7365 7420 3c20 6d61  hile offset < ma
+00039f90: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00039fa0: 2020 2070 6172 616d 7320 3d20 7b27 6f66     params = {'of
+00039fb0: 6673 6574 273a 206f 6666 7365 742c 2027  fset': offset, '
+00039fc0: 6c69 6d69 7427 3a20 6c69 6d69 742c 2027  limit': limit, '
+00039fd0: 6372 6974 6572 6961 273a 2063 7269 7465  criteria': crite
+00039fe0: 7269 612c 0a20 2020 2020 2020 2020 2020  ria,.           
+00039ff0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0003a000: 6578 636c 7564 655f 6669 656c 6473 273a  exclude_fields':
+0003a010: 2073 656c 662e 6578 636c 7564 655f 6669   self.exclude_fi
+0003a020: 656c 6473 7d0a 2020 2020 2020 2020 2020  elds}.          
+0003a030: 2020 2020 2020 2320 6d61 6b65 2072 6571        # make req
+0003a040: 7565 7374 0a20 2020 2020 2020 2020 2020  uest.           
+0003a050: 2020 2020 2070 7269 6e74 2827 5061 7261       print('Para
+0003a060: 6d73 3a27 2c20 7061 7261 6d73 290a 2020  ms:', params).  
+0003a070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003a080: 7370 6f6e 7365 203d 2072 6571 7565 7374  sponse = request
+0003a090: 732e 706f 7374 280a 2020 2020 2020 2020  s.post(.        
+0003a0a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003a0b0: 2e75 726c 2c20 6a73 6f6e 3d70 6172 616d  .url, json=param
+0003a0c0: 732c 2074 696d 656f 7574 3d74 696d 656f  s, timeout=timeo
+0003a0d0: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
+0003a0e0: 2020 2020 2320 6368 6563 6b20 7374 6174      # check stat
+0003a0f0: 7573 2063 6f64 6520 2d20 656c 7365 2072  us code - else r
+0003a100: 6574 7572 6e20 6461 7461 0a20 2020 2020  eturn data.     
+0003a110: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0003a120: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
+0003a130: 6465 203e 3d20 3430 3020 616e 6420 7265  de >= 400 and re
+0003a140: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
+0003a150: 6465 203c 2035 3030 3a0a 2020 2020 2020  de < 500:.      
+0003a160: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003a170: 696e 7428 6622 4261 6420 7265 7175 6573  int(f"Bad reques
+0003a180: 743a 207b 7265 7370 6f6e 7365 2e74 6578  t: {response.tex
+0003a190: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
+0003a1a0: 2020 2020 2020 2020 2069 6620 7265 7472           if retr
+0003a1b0: 795f 636f 756e 7420 3c20 6d61 785f 7265  y_count < max_re
+0003a1c0: 7472 6965 7320 2d20 313a 0a20 2020 2020  tries - 1:.     
+0003a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a1e0: 2020 2070 7269 6e74 2866 2252 6574 7279     print(f"Retry
+0003a1f0: 696e 6720 6166 7465 7220 7b72 6574 7279  ing after {retry
+0003a200: 5f64 656c 6179 7d20 7365 636f 6e64 732e  _delay} seconds.
+0003a210: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0003a220: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0003a230: 652e 736c 6565 7028 7265 7472 795f 6465  e.sleep(retry_de
+0003a240: 6c61 7929 0a20 2020 2020 2020 2020 2020  lay).           
+0003a250: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0003a260: 7279 5f63 6f75 6e74 202b 3d20 310a 2020  ry_count += 1.  
+0003a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a2a0: 2320 7261 6973 6520 4578 6365 7074 696f  # raise Exceptio
+0003a2b0: 6e28 6622 4661 696c 6564 2074 6f20 636f  n(f"Failed to co
+0003a2c0: 6d70 6c65 7465 2050 4f53 5420 7265 7175  mplete POST requ
+0003a2d0: 6573 7420 6166 7465 7220 7b6d 6178 5f72  est after {max_r
+0003a2e0: 6574 7269 6573 7d20 6174 7465 6d70 7473  etries} attempts
+0003a2f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0003a300: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0003a310: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0003a320: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0003a330: 4661 696c 6564 2074 6f20 636f 6d70 6c65  Failed to comple
+0003a340: 7465 2050 4f53 5420 7265 7175 6573 7420  te POST request 
+0003a350: 6166 7465 7220 7b6d 6178 5f72 6574 7269  after {max_retri
+0003a360: 6573 7d20 6174 7465 6d70 7473 2229 0a20  es} attempts"). 
+0003a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a380: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0003a390: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0003a3a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003a3b0: 2020 2020 2020 2020 2020 2020 2020 6a73                js
+0003a3c0: 6f6e 203d 2072 6573 706f 6e73 652e 6a73  on = response.js
+0003a3d0: 6f6e 2829 0a20 2020 2020 2020 2020 2020  on().           
+0003a3e0: 2020 2020 2020 2020 2074 6f74 616c 203d           total =
+0003a3f0: 206a 736f 6e5b 276d 6574 6127 5d5b 2774   json['meta']['t
+0003a400: 6f74 616c 275d 0a20 2020 2020 2020 2020  otal'].         
+0003a410: 2020 2020 2020 2020 2020 2069 6620 746f             if to
+0003a420: 7461 6c20 3d3d 2030 3a0a 2020 2020 2020  tal == 0:.      
+0003a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a440: 2020 6966 2073 656c 662e 7665 7262 6f73    if self.verbos
+0003a450: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003a460: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0003a470: 7269 6e74 2822 4e6f 2072 6563 6f72 6473  rint("No records
+0003a480: 2066 6f72 2063 7269 7465 7269 6120 277b   for criteria '{
+0003a490: 7d27 222e 666f 726d 6174 2863 7269 7465  }'".format(crite
+0003a4a0: 7269 6129 290a 2020 2020 2020 2020 2020  ria)).          
+0003a4b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003a4c0: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+0003a4d0: 2020 2020 2020 2020 2069 6620 746f 7461           if tota
+0003a4e0: 6c20 3c20 6d61 783a 0a20 2020 2020 2020  l < max:.       
+0003a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a500: 206d 6178 203d 2074 6f74 616c 0a20 2020   max = total.   
+0003a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a520: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
+0003a530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a540: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0003a550: 2246 6f75 6e64 207b 307d 2072 6563 6f72  "Found {0} recor
+0003a560: 6473 2066 6f72 2063 7269 7465 7269 6120  ds for criteria 
+0003a570: 277b 317d 2722 2e66 6f72 6d61 7428 0a20  '{1}'".format(. 
+0003a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a590: 2020 2020 2020 2020 2020 2074 6f74 616c             total
+0003a5a0: 2c20 6372 6974 6572 6961 2929 0a20 2020  , criteria)).   
+0003a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a5c0: 2073 656c 662e 6772 616e 7473 202b 3d20   self.grants += 
+0003a5d0: 5b67 2066 6f72 2067 2069 6e20 6a73 6f6e  [g for g in json
+0003a5e0: 5b27 7265 7375 6c74 7327 5d5d 0a20 2020  ['results']].   
+0003a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a600: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
+0003a610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a620: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0003a630: 227b 307d 2072 6563 6f72 6473 206f 6666  "{0} records off
+0003a640: 207b 317d 2074 6f74 616c 2072 6574 7572   {1} total retur
+0003a650: 6e65 6420 2e2e 2e22 2e66 6f72 6d61 7428  ned ...".format(
+0003a660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a670: 2020 2020 2020 2020 2020 2020 206f 6666               off
+0003a680: 7365 742c 2074 6f74 616c 292c 2066 696c  set, total), fil
+0003a690: 653d 7379 732e 7374 6465 7272 290a 2020  e=sys.stderr).  
+0003a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a6b0: 2020 6f66 6673 6574 202b 3d20 6c69 6d69    offset += limi
+0003a6c0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0003a6d0: 2020 2020 2020 6966 206f 6666 7365 7420        if offset 
+0003a6e0: 3d3d 2031 3530 3030 3a0a 2020 2020 2020  == 15000:.      
+0003a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a700: 2020 6f66 6673 6574 203d 3d20 3134 3939    offset == 1499
+0003a710: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
+0003a720: 2020 2020 2020 656c 6966 206f 6666 7365        elif offse
+0003a730: 7420 3e20 3135 3030 303a 0a20 2020 2020  t > 15000:.     
+0003a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a750: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0003a760: 2020 6578 6365 7074 2072 6571 7565 7374    except request
+0003a770: 732e 6578 6365 7074 696f 6e73 2e52 6571  s.exceptions.Req
+0003a780: 7565 7374 4578 6365 7074 696f 6e20 6173  uestException as
+0003a790: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0003a7a0: 7072 696e 7428 6622 504f 5354 2072 6571  print(f"POST req
+0003a7b0: 7565 7374 2066 6169 6c65 643a 207b 657d  uest failed: {e}
+0003a7c0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0003a7d0: 6620 7265 7472 795f 636f 756e 7420 3c20  f retry_count < 
+0003a7e0: 6d61 785f 7265 7472 6965 7320 2d20 313a  max_retries - 1:
+0003a7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a800: 2070 7269 6e74 2866 2252 6574 7279 696e   print(f"Retryin
+0003a810: 6720 6166 7465 7220 7b72 6574 7279 5f64  g after {retry_d
+0003a820: 656c 6179 7d20 7365 636f 6e64 732e 2e2e  elay} seconds...
+0003a830: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0003a840: 2020 2072 6574 7279 5f63 6f75 6e74 202b     retry_count +
+0003a850: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0003a860: 2020 2020 7469 6d65 2e73 6c65 6570 2872      time.sleep(r
+0003a870: 6574 7279 5f64 656c 6179 290a 2020 2020  etry_delay).    
+0003a880: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003a890: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003a8a0: 7475 726e 0a20 2020 2020 2020 2023 2072  turn.        # r
+0003a8b0: 6169 7365 2045 7863 6570 7469 6f6e 2866  aise Exception(f
+0003a8c0: 2246 6169 6c65 6420 746f 2063 6f6d 706c  "Failed to compl
+0003a8d0: 6574 6520 504f 5354 2072 6571 7565 7374  ete POST request
+0003a8e0: 2061 6674 6572 207b 6d61 785f 7265 7472   after {max_retr
+0003a8f0: 6965 737d 2061 7474 656d 7074 7322 290a  ies} attempts").
+0003a900: 0a20 2020 2064 6566 205f 7265 7375 6c74  .    def _result
+0003a910: 5f73 6574 7328 7365 6c66 2c20 6865 6164  _sets(self, head
+0003a920: 6572 3d46 616c 7365 293a 0a20 2020 2020  er=False):.     
+0003a930: 2020 2073 6574 7320 3d20 5b5d 0a20 2020     sets = [].   
+0003a940: 2020 2020 2069 6620 6865 6164 6572 3a0a       if header:.
+0003a950: 2020 2020 2020 2020 2020 2020 7365 7473              sets
+0003a960: 2e61 7070 656e 6428 2827 7072 6f6a 6563  .append(('projec
+0003a970: 745f 6e75 6d27 2c20 2773 7461 7274 272c  t_num', 'start',
+0003a980: 2027 656e 6427 2c20 2763 6f6e 7461 6374   'end', 'contact
+0003a990: 5f70 695f 6e61 6d65 272c 2027 7072 6f6a  _pi_name', 'proj
+0003a9a0: 6563 745f 7469 746c 6527 2c0a 2020 2020  ect_title',.    
+0003a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a9c0: 2020 2020 276f 7267 5f6e 616d 6527 2c20      'org_name', 
+0003a9d0: 2770 726f 6a65 6374 5f64 6574 6169 6c5f  'project_detail_
+0003a9e0: 7572 6c27 2c20 2770 695f 7072 6f66 696c  url', 'pi_profil
+0003a9f0: 655f 6964 2729 290a 2020 2020 2020 2020  e_id')).        
+0003aa00: 6772 616e 7473 203d 207b 7d0a 2020 2020  grants = {}.    
+0003aa10: 2020 2020 666f 7220 6720 696e 2073 656c      for g in sel
+0003aa20: 662e 6772 616e 7473 3a0a 2020 2020 2020  f.grants:.      
+0003aa30: 2020 2020 2020 2320 7072 696e 7428 6a73        # print(js
+0003aa40: 6f6e 2e64 756d 7073 2867 2c20 696e 6465  on.dumps(g, inde
+0003aa50: 6e74 3d32 2929 0a20 2020 2020 2020 2020  nt=2)).         
+0003aa60: 2020 2023 2072 6574 7572 6e0a 2020 2020     # return.    
+0003aa70: 2020 2020 2020 2020 636f 7265 5f70 726f          core_pro
+0003aa80: 6a65 6374 5f6e 756d 203d 2073 7472 2867  ject_num = str(g
+0003aa90: 2e67 6574 2827 636f 7265 5f70 726f 6a65  .get('core_proje
+0003aaa0: 6374 5f6e 756d 272c 2027 2729 292e 7374  ct_num', '')).st
+0003aab0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+0003aac0: 2020 6c69 6e65 203d 2028 0a20 2020 2020    line = (.     
+0003aad0: 2020 2020 2020 2020 2020 2063 6f72 655f             core_
+0003aae0: 7072 6f6a 6563 745f 6e75 6d2c 0a20 2020  project_num,.   
+0003aaf0: 2020 2020 2020 2020 2020 2020 2073 7472               str
+0003ab00: 2867 2e67 6574 2827 7072 6f6a 6563 745f  (g.get('project_
+0003ab10: 7374 6172 745f 6461 7465 272c 2027 2729  start_date', '')
+0003ab20: 292e 7374 7269 7028 295b 3a31 305d 2c0a  ).strip()[:10],.
+0003ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab40: 7374 7228 672e 6765 7428 2770 726f 6a65  str(g.get('proje
+0003ab50: 6374 5f65 6e64 5f64 6174 6527 2c20 2727  ct_end_date', ''
+0003ab60: 2929 2e73 7472 6970 2829 5b3a 3130 5d2c  )).strip()[:10],
+0003ab70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ab80: 2073 7472 2867 2e67 6574 2827 636f 6e74   str(g.get('cont
+0003ab90: 6163 745f 7069 5f6e 616d 6527 2c20 2727  act_pi_name', ''
+0003aba0: 2929 2e73 7472 6970 2829 2c0a 2020 2020  )).strip(),.    
+0003abb0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+0003abc0: 672e 6765 7428 2770 726f 6a65 6374 5f74  g.get('project_t
+0003abd0: 6974 6c65 272c 2027 2729 292e 7374 7269  itle', '')).stri
+0003abe0: 7028 2920 2023 205b 3a35 305d 0a20 2020  p()  # [:50].   
+0003abf0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0003ac00: 2020 2020 2020 206f 7267 203d 2022 220a         org = "".
+0003ac10: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+0003ac20: 5b27 6f72 6761 6e69 7a61 7469 6f6e 275d  ['organization']
+0003ac30: 5b27 6f72 675f 6e61 6d65 275d 3a0a 2020  ['org_name']:.  
+0003ac40: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0003ac50: 6720 3d20 675b 276f 7267 616e 697a 6174  g = g['organizat
+0003ac60: 696f 6e27 5d5b 276f 7267 5f6e 616d 6527  ion']['org_name'
+0003ac70: 5d0a 2020 2020 2020 2020 2020 2020 6c69  ].            li
+0003ac80: 6e65 202b 3d20 280a 2020 2020 2020 2020  ne += (.        
+0003ac90: 2020 2020 2020 2020 7374 7228 6f72 672e          str(org.
+0003aca0: 656e 636f 6465 2827 7574 662d 3827 292c  encode('utf-8'),
+0003acb0: 2027 7574 662d 3827 292c 0a20 2020 2020   'utf-8'),.     
+0003acc0: 2020 2020 2020 2020 2020 2067 2e67 6574             g.get
+0003acd0: 2827 7072 6f6a 6563 745f 6465 7461 696c  ('project_detail
+0003ace0: 5f75 726c 272c 2027 2729 0a20 2020 2020  _url', '').     
+0003acf0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0003ad00: 2020 2020 2066 6f72 2070 2069 6e20 675b       for p in g[
+0003ad10: 2770 7269 6e63 6970 616c 5f69 6e76 6573  'principal_inves
+0003ad20: 7469 6761 746f 7273 275d 3a0a 2020 2020  tigators']:.    
+0003ad30: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0003ad40: 2e67 6574 2827 6973 5f63 6f6e 7461 6374  .get('is_contact
+0003ad50: 5f70 6927 2c20 4661 6c73 6529 3a0a 2020  _pi', False):.  
+0003ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad70: 2020 6c69 6e65 202b 3d20 2873 7472 2870    line += (str(p
+0003ad80: 2e67 6574 2827 7072 6f66 696c 655f 6964  .get('profile_id
+0003ad90: 272c 2027 2729 292c 290a 2020 2020 2020  ', '')),).      
+0003ada0: 2020 2020 2020 6966 206e 6f74 2063 6f72        if not cor
+0003adb0: 655f 7072 6f6a 6563 745f 6e75 6d20 696e  e_project_num in
+0003adc0: 2067 7261 6e74 733a 0a20 2020 2020 2020   grants:.       
+0003add0: 2020 2020 2020 2020 2067 7261 6e74 735b           grants[
+0003ade0: 636f 7265 5f70 726f 6a65 6374 5f6e 756d  core_project_num
+0003adf0: 5d20 3d20 6c69 6e65 0a20 2020 2020 2020  ] = line.       
+0003ae00: 2066 6f72 2067 2069 6e20 6772 616e 7473   for g in grants
+0003ae10: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
+0003ae20: 2020 2020 2020 2073 6574 732e 6170 7065         sets.appe
+0003ae30: 6e64 2867 290a 2020 2020 2020 2020 2020  nd(g).          
+0003ae40: 2020 2320 7072 696e 7428 6729 0a20 2020    # print(g).   
+0003ae50: 2020 2020 2023 2070 7269 6e74 2822 7b30       # print("{0
+0003ae60: 7d20 746f 7461 6c20 2320 6f66 2067 7261  } total # of gra
+0003ae70: 6e74 732e 2e2e 222e 666f 726d 6174 286c  nts...".format(l
+0003ae80: 656e 2867 7261 6e74 7329 292c 6669 6c65  en(grants)),file
+0003ae90: 3d73 7973 2e73 7464 6572 7229 0a20 2020  =sys.stderr).   
+0003aea0: 2020 2020 2072 6574 7572 6e20 7365 7473       return sets
+0003aeb0: 0a0a 0a63 6c61 7373 2043 6f6d 6d61 6e64  ...class Command
+0003aec0: 733a 0a0a 2020 2020 6465 6620 5f5f 696e  s:..    def __in
+0003aed0: 6974 5f5f 2873 656c 6629 3a0a 0a20 2020  it__(self):..   
+0003aee0: 2020 2020 2023 2070 6172 7365 2061 7267       # parse arg
+0003aef0: 756d 656e 7473 2075 7369 6e67 2070 7974  uments using pyt
+0003af00: 686f 6e27 7320 696e 7465 726e 616c 206d  hon's internal m
+0003af10: 6f64 756c 6520 6172 6770 6172 7365 2e70  odule argparse.p
+0003af20: 790a 2020 2020 2020 2020 7365 6c66 2e70  y.        self.p
+0003af30: 6172 7365 7220 3d20 7365 6c66 2e70 6172  arser = self.par
+0003af40: 7365 5f61 7267 756d 656e 7473 2829 0a20  se_arguments(). 
+0003af50: 2020 2020 2020 2073 656c 662e 6172 6773         self.args
+0003af60: 203d 2073 656c 662e 7061 7273 6572 2e70   = self.parser.p
+0003af70: 6172 7365 5f61 7267 7328 290a 0a20 2020  arse_args()..   
+0003af80: 2020 2020 2023 2054 4f44 4f3a 204f 4853       # TODO: OHS
+0003af90: 552d 3936 3a20 546f 2062 6520 6368 616e  U-96: To be chan
+0003afa0: 6765 6420 666f 7220 6120 6c6f 6767 6572  ged for a logger
+0003afb0: 0a20 2020 2020 2020 2067 6c6f 6261 6c20  .        global 
+0003afc0: 6973 5f64 6562 7567 0a20 2020 2020 2020  is_debug.       
+0003afd0: 2069 735f 6465 6275 6720 3d20 7365 6c66   is_debug = self
+0003afe0: 2e61 7267 732e 6465 6275 670a 0a20 2020  .args.debug..   
+0003aff0: 2064 6566 2070 7269 6e74 5f68 656c 7028   def print_help(
+0003b000: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+0003b010: 656c 662e 7061 7273 6572 2e70 7269 6e74  elf.parser.print
+0003b020: 5f68 656c 7028 290a 0a20 2020 2064 6566  _help()..    def
+0003b030: 2070 7269 6e74 5f76 6572 7369 6f6e 2873   print_version(s
+0003b040: 656c 6629 3a0a 0a20 2020 2020 2020 2070  elf):..        p
+0003b050: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+0003b060: 2020 6627 6672 6f73 7465 7220 767b 706b    f'froster v{pk
+0003b070: 675f 7265 736f 7572 6365 732e 6765 745f  g_resources.get_
+0003b080: 6469 7374 7269 6275 7469 6f6e 2822 6672  distribution("fr
+0003b090: 6f73 7465 7222 292e 7665 7273 696f 6e7d  oster").version}
+0003b0a0: 5c6e 2729 0a20 2020 2020 2020 2070 7269  \n').        pri
+0003b0b0: 6e74 2866 2754 6f6f 6c73 2076 6572 7369  nt(f'Tools versi
+0003b0c0: 6f6e 3a27 290a 2020 2020 2020 2020 7072  on:').        pr
+0003b0d0: 696e 7428 6627 2020 2020 7079 7468 6f6e  int(f'    python
+0003b0e0: 2076 7b70 6c61 7466 6f72 6d2e 7079 7468   v{platform.pyth
+0003b0f0: 6f6e 5f76 6572 7369 6f6e 2829 7d27 290a  on_version()}').
+0003b100: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+0003b110: 2020 2070 7761 6c6b 2027 2c20 2776 272b     pwalk ', 'v'+
+0003b120: 7375 6270 726f 6365 7373 2e72 756e 285b  subprocess.run([
+0003b130: 6f73 2e70 6174 682e 6a6f 696e 2873 7973  os.path.join(sys
+0003b140: 2e70 7265 6669 782c 2027 6269 6e27 2c20  .prefix, 'bin', 
+0003b150: 2770 7761 6c6b 2729 2c20 272d 2d76 6572  'pwalk'), '--ver
+0003b160: 7369 6f6e 275d 2c0a 2020 2020 2020 2020  sion'],.        
 0003b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b190: 2020 6865 6c70 3d74 6578 7477 7261 702e    help=textwrap.
-0003b1a0: 6465 6465 6e74 2866 2727 270a 2020 2020  dedent(f'''.    
-0003b1b0: 2020 2020 2020 2020 4372 6564 656e 7469          Credenti
-0003b1c0: 616c 206d 616e 6167 6572 0a20 2020 2020  al manager.     
-0003b1d0: 2020 2027 2727 292c 2066 6f72 6d61 7474     '''), formatt
-0003b1e0: 6572 5f63 6c61 7373 3d61 7267 7061 7273  er_class=argpars
-0003b1f0: 652e 5261 7754 6578 7448 656c 7046 6f72  e.RawTextHelpFor
-0003b200: 6d61 7474 6572 290a 2020 2020 7061 7273  matter).    pars
-0003b210: 6572 5f63 7265 6465 6e74 6961 6c73 2e61  er_credentials.a
-0003b220: 6464 5f61 7267 756d 656e 7428 272d 6327  dd_argument('-c'
-0003b230: 2c20 272d 2d63 6865 636b 272c 2064 6573  , '--check', des
-0003b240: 743d 2763 7264 2d63 6865 636b 272c 2061  t='crd-check', a
-0003b250: 6374 696f 6e3d 2773 746f 7265 5f74 7275  ction='store_tru
-0003b260: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
-0003b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b280: 2020 2020 2020 2020 6865 6c70 3d22 4368          help="Ch
-0003b290: 6563 6b20 6966 2074 6865 7265 2061 7265  eck if there are
-0003b2a0: 2076 616c 6964 2063 7265 6465 6e74 6961   valid credentia
-0003b2b0: 6c73 206f 6e20 6465 6661 756c 7420 726f  ls on default ro
-0003b2c0: 7574 6573 2e22 290a 0a20 2020 2023 202a  utes.")..    # *
-0003b2d0: 2a2a 0a0a 2020 2020 7061 7273 6572 5f63  **..    parser_c
-0003b2e0: 6f6e 6669 6720 3d20 7375 6270 6172 7365  onfig = subparse
-0003b2f0: 7273 2e61 6464 5f70 6172 7365 7228 2763  rs.add_parser('c
-0003b300: 6f6e 6669 6727 2c20 616c 6961 7365 733d  onfig', aliases=
-0003b310: 5b27 636e 6627 5d2c 0a20 2020 2020 2020  ['cnf'],.       
-0003b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b340: 2020 2068 656c 703d 7465 7874 7772 6170     help=textwrap
-0003b350: 2e64 6564 656e 7428 6627 2727 0a20 2020  .dedent(f'''.   
-0003b360: 2020 2020 2020 2020 2042 6f6f 7473 7472           Bootstr
-0003b370: 6170 2074 6865 2063 6f6e 6669 6775 7274  ap the configurt
-0003b380: 696f 6e2c 2069 6e73 7461 6c6c 2064 6570  ion, install dep
-0003b390: 656e 6465 6e63 6965 7320 616e 6420 7365  endencies and se
-0003b3a0: 7475 7020 796f 7572 2065 6e76 6972 6f6e  tup your environ
-0003b3b0: 6d65 6e74 2e0a 2020 2020 2020 2020 2020  ment..          
-0003b3c0: 2020 596f 7520 7769 6c6c 206e 6565 6420    You will need 
-0003b3d0: 746f 2061 6e73 7765 7220 6120 6665 7720  to answer a few 
-0003b3e0: 7175 6573 7469 6f6e 7320 6162 6f75 7420  questions about 
-0003b3f0: 796f 7572 2063 6c6f 7564 2061 6e64 2068  your cloud and h
-0003b400: 7063 2073 6574 7570 2e0a 2020 2020 2020  pc setup..      
-0003b410: 2020 2727 2729 2c20 666f 726d 6174 7465    '''), formatte
-0003b420: 725f 636c 6173 733d 6172 6770 6172 7365  r_class=argparse
-0003b430: 2e52 6177 5465 7874 4865 6c70 466f 726d  .RawTextHelpForm
-0003b440: 6174 7465 7229 0a0a 2020 2020 7061 7273  atter)..    pars
-0003b450: 6572 5f63 6f6e 6669 672e 6164 645f 6172  er_config.add_ar
-0003b460: 6775 6d65 6e74 2827 2d61 272c 2027 2d2d  gument('-a', '--
-0003b470: 6177 7327 2c20 6465 7374 3d27 6177 7327  aws', dest='aws'
-0003b480: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
-0003b490: 7472 7565 272c 0a20 2020 2020 2020 2020  true',.         
-0003b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b4b0: 2020 2020 2020 6865 6c70 3d22 5365 7475        help="Setu
-0003b4c0: 7020 4157 5320 7072 6f66 696c 6522 290a  p AWS profile").
-0003b4d0: 0a20 2020 2070 6172 7365 725f 636f 6e66  .    parser_conf
-0003b4e0: 6967 2e61 6464 5f61 7267 756d 656e 7428  ig.add_argument(
-0003b4f0: 272d 6d27 2c20 272d 2d6d 6f6e 6974 6f72  '-m', '--monitor
-0003b500: 272c 2064 6573 743d 276d 6f6e 6974 6f72  ', dest='monitor
-0003b510: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-0003b520: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
-0003b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b540: 2020 2020 2020 2068 656c 703d 2753 6574         help='Set
-0003b550: 7570 2066 726f 7374 6572 2061 7320 6120  up froster as a 
-0003b560: 6d6f 6e69 746f 7269 6e67 2063 726f 6e6a  monitoring cronj
-0003b570: 6f62 2027 202b 0a20 2020 2020 2020 2020  ob ' +.         
-0003b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b590: 2020 2020 2020 276f 6e20 616e 2065 6332        'on an ec2
-0003b5a0: 2069 6e73 7461 6e63 6520 616e 6420 6e6f   instance and no
-0003b5b0: 7469 6679 2074 6865 2075 7365 7220 656d  tify the user em
-0003b5c0: 6169 6c20 6164 6472 6573 7327 290a 0a20  ail address').. 
-0003b5d0: 2020 2070 6172 7365 725f 636f 6e66 6967     parser_config
-0003b5e0: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
-0003b5f0: 6e27 2c20 272d 2d6e 6968 272c 2064 6573  n', '--nih', des
-0003b600: 743d 276e 6968 272c 2061 6374 696f 6e3d  t='nih', action=
-0003b610: 2773 746f 7265 5f74 7275 6527 2c0a 2020  'store_true',.  
-0003b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b630: 2020 2020 2020 2020 2020 2020 2068 656c               hel
-0003b640: 703d 2253 6574 7570 204e 4948 2072 6570  p="Setup NIH rep
-0003b650: 6f72 7465 7220 636f 6e66 6967 7572 6174  orter configurat
-0003b660: 696f 6e22 290a 0a20 2020 2070 6172 7365  ion")..    parse
-0003b670: 725f 636f 6e66 6967 2e61 6464 5f61 7267  r_config.add_arg
-0003b680: 756d 656e 7428 272d 7027 2c20 272d 2d70  ument('-p', '--p
-0003b690: 7269 6e74 272c 2064 6573 743d 2770 7269  rint', dest='pri
-0003b6a0: 6e74 272c 2061 6374 696f 6e3d 2773 746f  nt', action='sto
-0003b6b0: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
-0003b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b6d0: 2020 2020 2020 2020 2068 656c 703d 2250           help="P
-0003b6e0: 7269 6e74 2074 6865 2063 7572 7265 6e74  rint the current
-0003b6f0: 2063 6f6e 6669 6775 7261 7469 6f6e 2229   configuration")
-0003b700: 0a0a 2020 2020 7061 7273 6572 5f63 6f6e  ..    parser_con
-0003b710: 6669 672e 6164 645f 6172 6775 6d65 6e74  fig.add_argument
-0003b720: 2827 2d33 272c 2027 2d2d 7333 272c 2064  ('-3', '--s3', d
-0003b730: 6573 743d 2773 3327 2c20 6163 7469 6f6e  est='s3', action
-0003b740: 3d27 7374 6f72 655f 7472 7565 272c 0a20  ='store_true',. 
-0003b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b760: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0003b770: 6c70 3d22 5365 7475 7020 7333 2062 7563  lp="Setup s3 buc
-0003b780: 6b65 7420 636f 6e66 6967 7572 6174 696f  ket configuratio
-0003b790: 6e22 290a 0a20 2020 2070 6172 7365 725f  n")..    parser_
-0003b7a0: 636f 6e66 6967 2e61 6464 5f61 7267 756d  config.add_argum
-0003b7b0: 656e 7428 272d 7327 2c20 272d 2d73 6861  ent('-s', '--sha
-0003b7c0: 7265 6427 2c20 6465 7374 3d27 7368 6172  red', dest='shar
-0003b7d0: 6564 272c 2061 6374 696f 6e3d 2773 746f  ed', action='sto
-0003b7e0: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
-0003b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b800: 2020 2020 2020 2020 2068 656c 703d 2253           help="S
-0003b810: 6574 7570 2073 6861 7265 6420 636f 6e66  etup shared conf
-0003b820: 6967 7572 6174 696f 6e22 290a 0a20 2020  iguration")..   
-0003b830: 2070 6172 7365 725f 636f 6e66 6967 2e61   parser_config.a
-0003b840: 6464 5f61 7267 756d 656e 7428 272d 6c27  dd_argument('-l'
-0003b850: 2c20 272d 2d73 6c75 726d 272c 2064 6573  , '--slurm', des
-0003b860: 743d 2773 6c75 726d 272c 2061 6374 696f  t='slurm', actio
-0003b870: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
-0003b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b890: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0003b8a0: 656c 703d 2253 6574 7570 2073 6c75 726d  elp="Setup slurm
-0003b8b0: 2063 6f6e 6669 6775 7261 7469 6f6e 2229   configuration")
-0003b8c0: 0a0a 2020 2020 7061 7273 6572 5f63 6f6e  ..    parser_con
-0003b8d0: 6669 672e 6164 645f 6172 6775 6d65 6e74  fig.add_argument
-0003b8e0: 2827 2d75 272c 2027 2d2d 7573 6572 272c  ('-u', '--user',
-0003b8f0: 2064 6573 743d 2775 7365 7227 2c20 6163   dest='user', ac
-0003b900: 7469 6f6e 3d27 7374 6f72 655f 7472 7565  tion='store_true
-0003b910: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0003b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b930: 2020 6865 6c70 3d22 5365 7475 7020 7573    help="Setup us
-0003b940: 6572 2073 7065 6369 6669 6320 636f 6e66  er specific conf
-0003b950: 6967 7572 6174 696f 6e22 290a 0a20 2020  iguration")..   
-0003b960: 2023 202a 2a2a 0a0a 2020 2020 7061 7273   # ***..    pars
-0003b970: 6572 5f69 6e64 6578 203d 2073 7562 7061  er_index = subpa
-0003b980: 7273 6572 732e 6164 645f 7061 7273 6572  rsers.add_parser
-0003b990: 2827 696e 6465 7827 2c20 616c 6961 7365  ('index', aliase
-0003b9a0: 733d 5b27 6964 7827 5d2c 0a20 2020 2020  s=['idx'],.     
-0003b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b9d0: 2020 2020 6865 6c70 3d74 6578 7477 7261      help=textwra
-0003b9e0: 702e 6465 6465 6e74 2866 2727 270a 2020  p.dedent(f'''.  
-0003b9f0: 2020 2020 2020 2020 2020 5363 616e 2061            Scan a
-0003ba00: 2066 696c 6520 7379 7374 656d 2066 6f6c   file system fol
-0003ba10: 6465 7220 7472 6565 2075 7369 6e67 2027  der tree using '
-0003ba20: 7077 616c 6b27 2061 6e64 2067 656e 6572  pwalk' and gener
-0003ba30: 6174 6520 6120 686f 7473 706f 7473 2043  ate a hotspots C
-0003ba40: 5356 2066 696c 650a 2020 2020 2020 2020  SV file.        
-0003ba50: 2020 2020 7468 6174 206c 6973 7473 2074      that lists t
-0003ba60: 6865 206c 6172 6765 7374 2066 6f6c 6465  he largest folde
-0003ba70: 7273 2e20 4173 2074 6869 7320 7072 6f63  rs. As this proc
-0003ba80: 6573 7320 6973 2063 6f6d 7075 7465 2069  ess is compute i
-0003ba90: 6e74 656e 7369 7665 2074 6865 0a20 2020  ntensive the.   
-0003baa0: 2020 2020 2020 2020 2069 6e64 6578 206a           index j
-0003bab0: 6f62 2077 696c 6c20 6265 2061 7574 6f6d  ob will be autom
-0003bac0: 6174 6963 616c 6c79 2073 7562 6d69 7474  atically submitt
-0003bad0: 6564 2074 6f20 536c 7572 6d20 6966 2074  ed to Slurm if t
-0003bae0: 6865 2053 6c75 726d 2074 6f6f 6c73 2061  he Slurm tools a
-0003baf0: 7265 0a20 2020 2020 2020 2020 2020 2066  re.            f
-0003bb00: 6f75 6e64 2e0a 2020 2020 2020 2020 2727  ound..        ''
-0003bb10: 2729 2c20 666f 726d 6174 7465 725f 636c  '), formatter_cl
-0003bb20: 6173 733d 6172 6770 6172 7365 2e52 6177  ass=argparse.Raw
-0003bb30: 5465 7874 4865 6c70 466f 726d 6174 7465  TextHelpFormatte
-0003bb40: 7229 0a0a 2020 2020 7061 7273 6572 5f69  r)..    parser_i
-0003bb50: 6e64 6578 2e61 6464 5f61 7267 756d 656e  ndex.add_argumen
-0003bb60: 7428 2766 6f6c 6465 7273 272c 2061 6374  t('folders', act
-0003bb70: 696f 6e3d 2773 746f 7265 272c 2064 6566  ion='store', def
-0003bb80: 6175 6c74 3d5b 5d2c 2020 6e61 7267 733d  ault=[],  nargs=
-0003bb90: 272a 272c 0a20 2020 2020 2020 2020 2020  '*',.           
-0003bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bbb0: 2020 2068 656c 703d 2746 6f6c 6465 7273     help='Folders
-0003bbc0: 2079 6f75 2077 6f75 6c64 206c 696b 6520   you would like 
-0003bbd0: 746f 2069 6e64 6578 2028 7365 7061 7261  to index (separa
-0003bbe0: 7465 6420 6279 2073 7061 6365 292c 2027  ted by space), '
-0003bbf0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-0003bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bc10: 2027 7573 696e 6720 7468 6520 7077 616c   'using the pwal
-0003bc20: 6b20 6669 6c65 2073 7973 7465 6d20 6372  k file system cr
-0003bc30: 6177 6c65 7220 2729 0a0a 2020 2020 7061  awler ')..    pa
-0003bc40: 7273 6572 5f69 6e64 6578 2e61 6464 5f61  rser_index.add_a
-0003bc50: 7267 756d 656e 7428 272d 7927 2c20 272d  rgument('-y', '-
-0003bc60: 2d70 7761 6c6b 2d63 6f70 7927 2c20 6465  -pwalk-copy', de
-0003bc70: 7374 3d27 7077 616c 6b63 6f70 7927 2c20  st='pwalkcopy', 
-0003bc80: 6163 7469 6f6e 3d27 7374 6f72 6527 2c20  action='store', 
-0003bc90: 6465 6661 756c 743d 2727 2c0a 2020 2020  default='',.    
-0003bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bcb0: 2020 2020 2020 2020 2020 6865 6c70 3d27            help='
-0003bcc0: 4469 7265 6374 6f72 7920 7768 6572 6520  Directory where 
-0003bcd0: 7468 6520 7077 616c 6b20 4353 5620 6669  the pwalk CSV fi
-0003bce0: 6c65 2073 686f 756c 6420 6265 2063 6f70  le should be cop
-0003bcf0: 6965 6420 746f 2e27 290a 0a20 2020 2023  ied to.')..    #
-0003bd00: 202a 2a2a 0a0a 2020 2020 7061 7273 6572   ***..    parser
-0003bd10: 5f61 7263 6869 7665 203d 2073 7562 7061  _archive = subpa
-0003bd20: 7273 6572 732e 6164 645f 7061 7273 6572  rsers.add_parser
-0003bd30: 2827 6172 6368 6976 6527 2c20 616c 6961  ('archive', alia
-0003bd40: 7365 733d 5b27 6172 6327 5d2c 0a20 2020  ses=['arc'],.   
-0003bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bd70: 2020 2020 2020 2020 6865 6c70 3d74 6578          help=tex
-0003bd80: 7477 7261 702e 6465 6465 6e74 2866 2727  twrap.dedent(f''
-0003bd90: 270a 2020 2020 2020 2020 2020 2020 5365  '.            Se
-0003bda0: 6c65 6374 2066 726f 6d20 6120 6c69 7374  lect from a list
-0003bdb0: 206f 6620 6c61 7267 6520 666f 6c64 6572   of large folder
-0003bdc0: 732c 2074 6861 7420 6861 7320 6265 656e  s, that has been
-0003bdd0: 2063 7265 6174 6564 2062 7920 2766 726f   created by 'fro
-0003bde0: 7374 6572 2069 6e64 6578 272c 2061 6e64  ster index', and
-0003bdf0: 0a20 2020 2020 2020 2020 2020 2061 7263  .            arc
-0003be00: 6869 7665 2061 2066 6f6c 6465 7220 746f  hive a folder to
-0003be10: 2053 332f 476c 6163 6965 722e 204f 6e63   S3/Glacier. Onc
-0003be20: 6520 796f 7520 7365 6c65 6374 2061 2066  e you select a f
-0003be30: 6f6c 6465 7220 7468 6520 6172 6368 6976  older the archiv
-0003be40: 6520 6a6f 6220 7769 6c6c 2062 650a 2020  e job will be.  
-0003be50: 2020 2020 2020 2020 2020 6175 746f 6d61            automa
-0003be60: 7469 6361 6c6c 7920 7375 626d 6974 7465  tically submitte
-0003be70: 6420 746f 2053 6c75 726d 2e20 596f 7520  d to Slurm. You 
-0003be80: 6361 6e20 616c 736f 2061 7574 6f6d 6174  can also automat
-0003be90: 6520 7468 6973 2070 726f 6365 7373 0a0a  e this process..
-0003bea0: 2020 2020 2020 2020 2727 2729 2c20 666f          '''), fo
-0003beb0: 726d 6174 7465 725f 636c 6173 733d 6172  rmatter_class=ar
-0003bec0: 6770 6172 7365 2e52 6177 5465 7874 4865  gparse.RawTextHe
-0003bed0: 6c70 466f 726d 6174 7465 7229 0a0a 2020  lpFormatter)..  
-0003bee0: 2020 7061 7273 6572 5f61 7263 6869 7665    parser_archive
-0003bef0: 2e61 6464 5f61 7267 756d 656e 7428 2766  .add_argument('f
-0003bf00: 6f6c 6465 7273 272c 2061 6374 696f 6e3d  olders', action=
-0003bf10: 2773 746f 7265 272c 2064 6566 6175 6c74  'store', default
-0003bf20: 3d5b 5d2c 206e 6172 6773 3d27 2a27 2c0a  =[], nargs='*',.
-0003bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bf50: 6865 6c70 3d27 666f 6c64 6572 7320 796f  help='folders yo
-0003bf60: 7520 776f 756c 6420 6c69 6b65 2074 6f20  u would like to 
-0003bf70: 6172 6368 6976 6520 2873 6570 6172 6174  archive (separat
-0003bf80: 6564 2062 7920 7370 6163 6529 2c20 2720  ed by space), ' 
-0003bf90: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-0003bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bfb0: 2020 2774 6865 206c 6173 7420 666f 6c64    'the last fold
-0003bfc0: 6572 2069 6e20 7468 6973 206c 6973 7420  er in this list 
-0003bfd0: 6973 2074 6865 2074 6172 6765 7420 2020  is the target   
-0003bfe0: 2729 0a0a 2020 2020 7061 7273 6572 5f61  ')..    parser_a
-0003bff0: 7263 6869 7665 2e61 6464 5f61 7267 756d  rchive.add_argum
-0003c000: 656e 7428 272d 6627 2c20 272d 2d66 6f72  ent('-f', '--for
-0003c010: 6365 272c 2064 6573 743d 2766 6f72 6365  ce', dest='force
-0003c020: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-0003c030: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
-0003c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c050: 2020 2020 2020 2020 6865 6c70 3d22 466f          help="Fo
-0003c060: 7263 6520 6172 6368 6976 696e 6720 6f66  rce archiving of
-0003c070: 2061 2066 6f6c 6465 7220 7468 6174 2063   a folder that c
-0003c080: 6f6e 7461 696e 7320 7468 6520 2e66 726f  ontains the .fro
-0003c090: 7374 6572 2e6d 6435 7375 6d20 6669 6c65  ster.md5sum file
-0003c0a0: 2229 0a0a 2020 2020 7061 7273 6572 5f61  ")..    parser_a
-0003c0b0: 7263 6869 7665 2e61 6464 5f61 7267 756d  rchive.add_argum
-0003c0c0: 656e 7428 272d 4827 2c20 272d 2d68 6f74  ent('-H', '--hot
-0003c0d0: 7370 6f73 7473 272c 2064 6573 743d 2768  sposts', dest='h
-0003c0e0: 6f74 7370 6f74 7327 2c20 6163 7469 6f6e  otspots', action
-0003c0f0: 3d27 7374 6f72 655f 7472 7565 272c 0a20  ='store_true',. 
-0003c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c110: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0003c120: 656c 703d 2253 656c 6563 7420 686f 7473  elp="Select hots
-0003c130: 706f 7473 2074 6f20 6172 6368 6976 6520  pots to archive 
-0003c140: 6672 6f6d 2043 5356 2066 696c 6520 6765  from CSV file ge
-0003c150: 6e65 7261 7465 6420 6279 2027 6672 6f73  nerated by 'fros
-0003c160: 7465 7220 696e 6465 7827 2229 0a0a 2020  ter index'")..  
-0003c170: 2020 7061 7273 6572 5f61 7263 6869 7665    parser_archive
-0003c180: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
-0003c190: 7027 2c20 272d 2d70 6572 6d69 7373 696f  p', '--permissio
-0003c1a0: 6e73 272c 2064 6573 743d 2770 6572 6d69  ns', dest='permi
-0003c1b0: 7373 696f 6e73 272c 2061 6374 696f 6e3d  ssions', action=
-0003c1c0: 2773 746f 7265 5f74 7275 6527 2c0a 2020  'store_true',.  
-0003c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c1e0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0003c1f0: 6c70 3d22 5072 696e 7420 7265 6164 2061  lp="Print read a
-0003c200: 6e64 2077 7269 7465 2070 6572 6d69 7373  nd write permiss
-0003c210: 696f 6e73 2066 6f72 2074 6865 2070 726f  ions for the pro
-0003c220: 7669 6465 6420 666f 6c64 6572 2873 2922  vided folder(s)"
-0003c230: 290a 0a20 2020 2070 6172 7365 725f 6172  )..    parser_ar
-0003c240: 6368 6976 652e 6164 645f 6172 6775 6d65  chive.add_argume
-0003c250: 6e74 2827 2d6c 272c 2027 2d2d 6c61 7267  nt('-l', '--larg
-0003c260: 6572 272c 2064 6573 743d 276c 6172 6765  er', dest='large
-0003c270: 7227 2c20 7479 7065 3d69 6e74 2c20 6163  r', type=int, ac
-0003c280: 7469 6f6e 3d27 7374 6f72 6527 2c20 6465  tion='store', de
-0003c290: 6661 756c 743d 302c 0a20 2020 2020 2020  fault=0,.       
-0003c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c2b0: 2020 2020 2020 2020 2068 656c 703d 7465           help=te
-0003c2c0: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
-0003c2d0: 2727 0a20 2020 2020 2020 2020 2020 2041  ''.            A
-0003c2e0: 7263 6869 7665 2066 6f6c 6465 7273 206c  rchive folders l
-0003c2f0: 6172 6765 7220 7468 616e 203c 4769 423e  arger than <GiB>
-0003c300: 2e20 5468 6973 206f 7074 696f 6e0a 2020  . This option.  
-0003c310: 2020 2020 2020 2020 2020 776f 726b 7320            works 
-0003c320: 696e 2063 6f6e 6a75 6e63 7469 6f6e 2077  in conjunction w
-0003c330: 6974 6820 2d2d 6f6c 6465 7220 3c64 6179  ith --older <day
-0003c340: 733e 2e20 4966 2062 6f74 680a 2020 2020  s>. If both.    
-0003c350: 2020 2020 2020 2020 6f70 7469 6f6e 7320          options 
-0003c360: 6172 6520 7365 7420 6672 6f73 7465 7220  are set froster 
-0003c370: 7769 6c6c 2070 7269 6e74 2061 2063 6f6d  will print a com
-0003c380: 6d61 6e64 2074 6861 740a 2020 2020 2020  mand that.      
-0003c390: 2020 2020 2020 616c 6c6f 7773 2079 6f75        allows you
-0003c3a0: 2074 6f20 6172 6368 6976 6520 616c 6c20   to archive all 
-0003c3b0: 6d61 7463 6869 6e67 2066 6f6c 6465 7273  matching folders
-0003c3c0: 2061 7420 6f6e 6365 2e0a 2020 2020 2020   at once..      
-0003c3d0: 2020 2727 2729 290a 2020 2020 7061 7273    ''')).    pars
-0003c3e0: 6572 5f61 7263 6869 7665 2e61 6464 5f61  er_archive.add_a
-0003c3f0: 7267 756d 656e 7428 272d 6f27 2c20 272d  rgument('-o', '-
-0003c400: 2d6f 6c64 6572 272c 2064 6573 743d 276f  -older', dest='o
-0003c410: 6c64 6572 272c 2074 7970 653d 696e 742c  lder', type=int,
-0003c420: 2061 6374 696f 6e3d 2773 746f 7265 272c   action='store',
-0003c430: 2064 6566 6175 6c74 3d30 2c0a 2020 2020   default=0,.    
-0003c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c450: 2020 2020 2020 2020 2020 2020 6865 6c70              help
-0003c460: 3d74 6578 7477 7261 702e 6465 6465 6e74  =textwrap.dedent
-0003c470: 2866 2727 270a 2020 2020 2020 2020 2020  (f'''.          
-0003c480: 2020 4172 6368 6976 6520 666f 6c64 6572    Archive folder
-0003c490: 7320 7468 6174 2068 6176 6520 6e6f 7420  s that have not 
-0003c4a0: 6265 656e 2061 6363 6573 7365 6420 6d6f  been accessed mo
-0003c4b0: 7265 2074 6861 6e0a 2020 2020 2020 2020  re than.        
-0003c4c0: 2020 2020 3c64 6179 733e 2e20 286f 7074      <days>. (opt
-0003c4d0: 696f 6e61 6c6c 7920 7365 7420 2d2d 6d74  ionally set --mt
-0003c4e0: 696d 6520 746f 2073 656c 6563 7420 666f  ime to select fo
-0003c4f0: 6c64 6572 7320 7468 6174 0a20 2020 2020  lders that.     
-0003c500: 2020 2020 2020 2068 6176 6520 6e6f 7420         have not 
-0003c510: 6265 656e 206d 6f64 6966 6965 6420 6d6f  been modified mo
-0003c520: 7265 2074 6861 6e20 3c64 6179 733e 292e  re than <days>).
-0003c530: 2054 6869 7320 6f70 7469 6f6e 0a20 2020   This option.   
-0003c540: 2020 2020 2020 2020 2077 6f72 6b73 2069           works i
-0003c550: 6e20 636f 6e6a 756e 6374 696f 6e20 7769  n conjunction wi
-0003c560: 7468 202d 2d6c 6172 6765 7220 3c47 6942  th --larger <GiB
-0003c570: 3e2e 2049 6620 626f 7468 0a20 2020 2020  >. If both.     
-0003c580: 2020 2020 2020 206f 7074 696f 6e73 2061         options a
-0003c590: 7265 2073 6574 2066 726f 7374 6572 2077  re set froster w
-0003c5a0: 696c 6c20 7072 696e 7420 6120 636f 6d6d  ill print a comm
-0003c5b0: 616e 6420 7468 6174 0a20 2020 2020 2020  and that.       
-0003c5c0: 2020 2020 2061 6c6c 6f77 7320 796f 7520       allows you 
-0003c5d0: 746f 2061 7263 6869 7665 2061 6c6c 206d  to archive all m
-0003c5e0: 6174 6368 696e 6720 666f 6c64 6572 7320  atching folders 
-0003c5f0: 6174 206f 6e63 652e 0a20 2020 2020 2020  at once..       
-0003c600: 2027 2727 2929 0a0a 2020 2020 7061 7273   '''))..    pars
-0003c610: 6572 5f61 7263 6869 7665 2e61 6464 5f61  er_archive.add_a
-0003c620: 7267 756d 656e 7428 272d 2d6e 6577 6572  rgument('--newer
-0003c630: 272c 2027 2d77 272c 2064 6573 743d 276e  ', '-w', dest='n
-0003c640: 6577 6572 272c 2074 7970 653d 696e 742c  ewer', type=int,
-0003c650: 2061 6374 696f 6e3d 2773 746f 7265 272c   action='store',
-0003c660: 2064 6566 6175 6c74 3d30 2c0a 2020 2020   default=0,.    
-0003c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c680: 2020 2020 2020 2020 2020 2020 6865 6c70              help
-0003c690: 3d74 6578 7477 7261 702e 6465 6465 6e74  =textwrap.dedent
-0003c6a0: 2866 2727 270a 2020 2020 2020 2020 2020  (f'''.          
-0003c6b0: 2020 4172 6368 6976 6520 666f 6c64 6572    Archive folder
-0003c6c0: 7320 7468 6174 2068 6176 6520 6265 656e  s that have been
-0003c6d0: 2061 6363 6573 7365 6420 7769 7468 696e   accessed within
-0003c6e0: 2074 6865 206c 6173 7420 0a20 2020 2020   the last .     
-0003c6f0: 2020 2020 2020 203c 6461 7973 3e2e 2028         <days>. (
-0003c700: 6f70 7469 6f6e 616c 6c79 2073 6574 202d  optionally set -
-0003c710: 2d6d 7469 6d65 2074 6f20 7365 6c65 6374  -mtime to select
-0003c720: 2066 6f6c 6465 7273 2074 6861 740a 2020   folders that.  
-0003c730: 2020 2020 2020 2020 2020 6861 7665 206e            have n
-0003c740: 6f74 2062 6565 6e20 6d6f 6469 6669 6564  ot been modified
-0003c750: 206d 6f72 6520 7468 616e 203c 6461 7973   more than <days
-0003c760: 3e29 2e20 5468 6973 206f 7074 696f 6e0a  >). This option.
-0003c770: 2020 2020 2020 2020 2020 2020 776f 726b              work
-0003c780: 7320 696e 2063 6f6e 6a75 6e63 7469 6f6e  s in conjunction
-0003c790: 2077 6974 6820 2d2d 6c61 7267 6572 203c   with --larger <
-0003c7a0: 4769 423e 2e20 4966 2062 6f74 6820 0a20  GiB>. If both . 
-0003c7b0: 2020 2020 2020 2020 2020 206f 7074 696f             optio
-0003c7c0: 6e73 2061 7265 2073 6574 2066 726f 7374  ns are set frost
-0003c7d0: 6572 2077 696c 6c20 7072 696e 7420 6120  er will print a 
-0003c7e0: 636f 6d6d 616e 6420 7468 6174 200a 2020  command that .  
-0003c7f0: 2020 2020 2020 2020 2020 616c 6c6f 7773            allows
-0003c800: 2079 6f75 2074 6f20 6172 6368 6976 6520   you to archive 
-0003c810: 616c 6c20 6d61 7463 6869 6e67 2066 6f6c  all matching fol
-0003c820: 6465 7273 2061 7420 6f6e 6365 2e0a 2020  ders at once..  
-0003c830: 2020 2020 2020 2727 2729 290a 0a20 2020        '''))..   
-0003c840: 2070 6172 7365 725f 6172 6368 6976 652e   parser_archive.
-0003c850: 6164 645f 6172 6775 6d65 6e74 2827 2d6e  add_argument('-n
-0003c860: 272c 2027 2d2d 6e69 6827 2c20 6465 7374  ', '--nih', dest
-0003c870: 3d27 6e69 6827 2c20 6163 7469 6f6e 3d27  ='nih', action='
-0003c880: 7374 6f72 655f 7472 7565 272c 0a20 2020  store_true',.   
-0003c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c8a0: 2020 2020 2020 2020 2020 2020 2068 656c               hel
-0003c8b0: 703d 2253 6561 7263 6820 616e 6420 4c69  p="Search and Li
-0003c8c0: 6e6b 204d 6574 6164 6174 6120 6672 6f6d  nk Metadata from
-0003c8d0: 204e 4948 2052 6570 6f72 7465 7222 290a   NIH Reporter").
-0003c8e0: 0a20 2020 2070 6172 7365 725f 6172 6368  .    parser_arch
-0003c8f0: 6976 652e 6164 645f 6172 6775 6d65 6e74  ive.add_argument
-0003c900: 2827 2d6d 272c 2027 2d2d 6d74 696d 6527  ('-m', '--mtime'
-0003c910: 2c20 6465 7374 3d27 6167 656d 7469 6d65  , dest='agemtime
-0003c920: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-0003c930: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
-0003c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c950: 2020 2020 2020 2020 6865 6c70 3d22 5573          help="Us
-0003c960: 6520 6d6f 6469 6669 6564 2066 696c 6520  e modified file 
-0003c970: 7469 6d65 2028 6d74 696d 6529 2069 6e73  time (mtime) ins
-0003c980: 7465 6164 206f 6620 6163 6365 7373 6564  tead of accessed
-0003c990: 2074 696d 6520 2861 7469 6d65 2922 290a   time (atime)").
-0003c9a0: 0a20 2020 2070 6172 7365 725f 6172 6368  .    parser_arch
-0003c9b0: 6976 652e 6164 645f 6172 6775 6d65 6e74  ive.add_argument
-0003c9c0: 2827 2d72 272c 2027 2d2d 7265 6375 7273  ('-r', '--recurs
-0003c9d0: 6976 6527 2c20 6465 7374 3d27 7265 6375  ive', dest='recu
-0003c9e0: 7273 6976 6527 2c20 6163 7469 6f6e 3d27  rsive', action='
-0003c9f0: 7374 6f72 655f 7472 7565 272c 0a20 2020  store_true',.   
-0003ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ca10: 2020 2020 2020 2020 2020 2020 2068 656c               hel
-0003ca20: 703d 2241 7263 6869 7665 2074 6865 2063  p="Archive the c
-0003ca30: 7572 7265 6e74 2066 6f6c 6465 7220 616e  urrent folder an
-0003ca40: 6420 616c 6c20 7375 622d 666f 6c64 6572  d all sub-folder
-0003ca50: 7322 290a 0a20 2020 2070 6172 7365 725f  s")..    parser_
-0003ca60: 6172 6368 6976 652e 6164 645f 6172 6775  archive.add_argu
-0003ca70: 6d65 6e74 2827 2d73 272c 2027 2d2d 7265  ment('-s', '--re
-0003ca80: 7365 7427 2c20 6465 7374 3d27 7265 7365  set', dest='rese
-0003ca90: 7427 2c20 6163 7469 6f6e 3d27 7374 6f72  t', action='stor
-0003caa0: 655f 7472 7565 272c 0a20 2020 2020 2020  e_true',.       
-0003cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cac0: 2020 2020 2020 2020 2068 656c 703d 7465           help=te
-0003cad0: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
-0003cae0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-0003caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb10: 2020 2020 2020 2020 5468 6973 2077 696c          This wil
-0003cb20: 6c20 6e6f 7420 646f 776e 6c6f 6164 2061  l not download a
-0003cb30: 6e79 2064 6174 612c 2062 7574 2072 6563  ny data, but rec
-0003cb40: 7573 6976 656c 7920 7265 7365 7420 6120  usively reset a 
-0003cb50: 666f 6c64 6572 0a20 2020 2020 2020 2020  folder.         
-0003cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb80: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0003cb90: 2070 7265 7669 6f75 7320 2865 2e67 2e20   previous (e.g. 
-0003cba0: 6661 696c 6564 2920 6172 6368 6976 696e  failed) archivin
-0003cbb0: 6720 6174 7465 6d70 742e 0a20 2020 2020  g attempt..     
-0003cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cbf0: 4974 2077 696c 6c20 6465 6c65 7465 202e  It will delete .
-0003cc00: 6672 6f73 7465 722e 6d64 3573 756d 2061  froster.md5sum a
-0003cc10: 6e64 2065 7874 7261 6374 2046 726f 7374  nd extract Frost
-0003cc20: 6572 2e73 6d61 6c6c 6669 6c65 732e 7461  er.smallfiles.ta
-0003cc30: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0003cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cc60: 2020 2020 2020 2027 2727 2929 0a0a 2020         '''))..  
-0003cc70: 2020 7061 7273 6572 5f61 7263 6869 7665    parser_archive
-0003cc80: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
-0003cc90: 7427 2c20 272d 2d6e 6f2d 7461 7227 2c20  t', '--no-tar', 
-0003cca0: 6465 7374 3d27 6e6f 7461 7227 2c20 6163  dest='notar', ac
-0003ccb0: 7469 6f6e 3d27 7374 6f72 655f 7472 7565  tion='store_true
-0003ccc0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0003ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cce0: 2020 2068 656c 703d 2244 6f20 6e6f 7420     help="Do not 
-0003ccf0: 6d6f 7665 2073 6d61 6c6c 2066 696c 6573  move small files
-0003cd00: 2074 6f20 7461 7220 6669 6c65 2062 6566   to tar file bef
-0003cd10: 6f72 6520 6172 6368 6976 696e 6722 290a  ore archiving").
-0003cd20: 0a20 2020 2070 6172 7365 725f 6172 6368  .    parser_arch
-0003cd30: 6976 652e 6164 645f 6172 6775 6d65 6e74  ive.add_argument
-0003cd40: 2827 2d64 272c 2027 2d2d 6472 792d 7275  ('-d', '--dry-ru
-0003cd50: 6e27 2c20 6465 7374 3d27 6472 7972 756e  n', dest='dryrun
-0003cd60: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-0003cd70: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
-0003cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cd90: 2020 2020 2020 2020 6865 6c70 3d22 4578          help="Ex
-0003cda0: 6563 7574 6520 6120 7465 7374 2061 7263  ecute a test arc
-0003cdb0: 6869 7665 2077 6974 686f 7574 2061 6374  hive without act
-0003cdc0: 7561 6c6c 7920 636f 7079 696e 6720 7468  ually copying th
-0003cdd0: 6520 6461 7461 2229 0a0a 2020 2020 2320  e data")..    # 
-0003cde0: 2a2a 2a0a 0a20 2020 2070 6172 7365 725f  ***..    parser_
-0003cdf0: 6465 6c65 7465 203d 2073 7562 7061 7273  delete = subpars
-0003ce00: 6572 732e 6164 645f 7061 7273 6572 2827  ers.add_parser('
-0003ce10: 6465 6c65 7465 272c 2061 6c69 6173 6573  delete', aliases
-0003ce20: 3d5b 2764 656c 275d 2c0a 2020 2020 2020  =['del'],.      
-0003ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ce50: 2020 2020 6865 6c70 3d74 6578 7477 7261      help=textwra
-0003ce60: 702e 6465 6465 6e74 2866 2727 270a 2020  p.dedent(f'''.  
-0003ce70: 2020 2020 2020 2020 2020 5265 6d6f 7665            Remove
-0003ce80: 2064 6174 6120 6672 6f6d 2061 206c 6f63   data from a loc
-0003ce90: 616c 2066 696c 6573 7973 7465 6d20 666f  al filesystem fo
-0003cea0: 6c64 6572 2074 6861 7420 6861 7320 6265  lder that has be
-0003ceb0: 656e 2063 6f6e 6669 726d 6564 2074 6f0a  en confirmed to.
-0003cec0: 2020 2020 2020 2020 2020 2020 6265 2061              be a
-0003ced0: 7263 6869 7665 6420 2874 6872 6f75 6768  rchived (through
-0003cee0: 2063 6865 636b 7375 6d20 7665 7269 6669   checksum verifi
-0003cef0: 6361 7469 6f6e 292e 2055 7365 2074 6869  cation). Use thi
-0003cf00: 7320 696e 7374 6561 6420 6f66 2064 656c  s instead of del
-0003cf10: 6574 696e 6720 6d61 6e75 616c 6c79 0a20  eting manually. 
-0003cf20: 2020 2020 2020 2027 2727 292c 2066 6f72         '''), for
-0003cf30: 6d61 7474 6572 5f63 6c61 7373 3d61 7267  matter_class=arg
-0003cf40: 7061 7273 652e 5261 7754 6578 7448 656c  parse.RawTextHel
-0003cf50: 7046 6f72 6d61 7474 6572 290a 0a20 2020  pFormatter)..   
-0003cf60: 2070 6172 7365 725f 6465 6c65 7465 2e61   parser_delete.a
-0003cf70: 6464 5f61 7267 756d 656e 7428 2766 6f6c  dd_argument('fol
-0003cf80: 6465 7273 272c 2061 6374 696f 6e3d 2773  ders', action='s
-0003cf90: 746f 7265 272c 2064 6566 6175 6c74 3d5b  tore', default=[
-0003cfa0: 5d2c 2020 6e61 7267 733d 272a 272c 0a20  ],  nargs='*',. 
-0003cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cfc0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0003cfd0: 6c70 3d27 666f 6c64 6572 7320 2873 6570  lp='folders (sep
-0003cfe0: 6172 6174 6564 2062 7920 7370 6163 6529  arated by space)
-0003cff0: 2066 726f 6d20 7768 6963 6820 796f 7520   from which you 
-0003d000: 776f 756c 6420 6c69 6b65 2074 6f20 6465  would like to de
-0003d010: 6c65 7465 2066 696c 6573 2c20 2720 2b0a  lete files, ' +.
-0003d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d030: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0003d040: 796f 7520 6361 6e20 6f6e 6c79 2064 656c  you can only del
-0003d050: 6574 6520 6669 6c65 7320 7468 6174 2068  ete files that h
-0003d060: 6176 6520 6265 656e 2061 7263 6869 7665  ave been archive
-0003d070: 6427 290a 0a20 2020 2070 6172 7365 725f  d')..    parser_
-0003d080: 6465 6c65 7465 2e61 6464 5f61 7267 756d  delete.add_argum
-0003d090: 656e 7428 272d 7227 2c20 272d 2d72 6563  ent('-r', '--rec
-0003d0a0: 7572 7369 7665 272c 2064 6573 743d 2772  ursive', dest='r
-0003d0b0: 6563 7572 7369 7665 272c 2061 6374 696f  ecursive', actio
-0003d0c0: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
-0003d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d0e0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0003d0f0: 656c 703d 2244 656c 6574 6520 7468 6520  elp="Delete the 
-0003d100: 6375 7272 656e 7420 6172 6368 6976 6564  current archived
-0003d110: 2066 6f6c 6465 7220 616e 6420 616c 6c20   folder and all 
-0003d120: 6172 6368 6976 6564 2073 7562 2d66 6f6c  archived sub-fol
-0003d130: 6465 7273 2229 0a0a 2020 2020 2320 2a2a  ders")..    # **
-0003d140: 2a0a 0a20 2020 2070 6172 7365 725f 6d6f  *..    parser_mo
-0003d150: 756e 7420 3d20 7375 6270 6172 7365 7273  unt = subparsers
-0003d160: 2e61 6464 5f70 6172 7365 7228 276d 6f75  .add_parser('mou
-0003d170: 6e74 272c 2061 6c69 6173 6573 3d5b 2775  nt', aliases=['u
-0003d180: 6d6f 756e 7427 5d2c 0a20 2020 2020 2020  mount'],.       
-0003d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d1b0: 2020 6865 6c70 3d74 6578 7477 7261 702e    help=textwrap.
-0003d1c0: 6465 6465 6e74 2866 2727 270a 2020 2020  dedent(f'''.    
-0003d1d0: 2020 2020 2020 2020 4d6f 756e 7420 6f72          Mount or
-0003d1e0: 2075 6e6d 6f75 6e74 2074 6865 2072 656d   unmount the rem
-0003d1f0: 6f74 6520 5333 206f 7220 476c 6163 6965  ote S3 or Glacie
-0003d200: 7220 7374 6f72 6167 6520 696e 2079 6f75  r storage in you
-0003d210: 7220 6c6f 6361 6c20 6669 6c65 2073 7973  r local file sys
-0003d220: 7465 6d0a 2020 2020 2020 2020 2020 2020  tem.            
-0003d230: 6174 2074 6865 206c 6f63 6174 696f 6e20  at the location 
-0003d240: 6f66 2074 6865 206f 7269 6769 6e61 6c20  of the original 
-0003d250: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
-0003d260: 2727 2729 2c20 666f 726d 6174 7465 725f  '''), formatter_
-0003d270: 636c 6173 733d 6172 6770 6172 7365 2e52  class=argparse.R
-0003d280: 6177 5465 7874 4865 6c70 466f 726d 6174  awTextHelpFormat
-0003d290: 7465 7229 0a20 2020 2070 6172 7365 725f  ter).    parser_
-0003d2a0: 6d6f 756e 742e 6164 645f 6172 6775 6d65  mount.add_argume
-0003d2b0: 6e74 2827 2d2d 6d6f 756e 742d 706f 696e  nt('--mount-poin
-0003d2c0: 7427 2c20 272d 6d27 2c20 6465 7374 3d27  t', '-m', dest='
-0003d2d0: 6d6f 756e 7470 6f69 6e74 272c 2061 6374  mountpoint', act
-0003d2e0: 696f 6e3d 2773 746f 7265 272c 2064 6566  ion='store', def
-0003d2f0: 6175 6c74 3d27 272c 0a20 2020 2020 2020  ault='',.       
-0003d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d310: 2020 2020 2020 2068 656c 703d 2770 6963         help='pic
-0003d320: 6b20 6120 6375 7374 6f6d 206d 6f75 6e74  k a custom mount
-0003d330: 2070 6f69 6e74 2c20 7468 6973 206f 6e6c   point, this onl
-0003d340: 7920 776f 726b 7320 6966 2079 6f75 2073  y works if you s
-0003d350: 656c 6563 7420 6120 7369 6e67 6c65 2066  elect a single f
-0003d360: 6f6c 6465 722e 2729 0a20 2020 2070 6172  older.').    par
-0003d370: 7365 725f 6d6f 756e 742e 6164 645f 6172  ser_mount.add_ar
-0003d380: 6775 6d65 6e74 2827 2d2d 6177 7327 2c20  gument('--aws', 
-0003d390: 272d 6127 2c20 6465 7374 3d27 6177 7327  '-a', dest='aws'
-0003d3a0: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
-0003d3b0: 7472 7565 272c 2064 6566 6175 6c74 3d46  true', default=F
-0003d3c0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0003d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d3e0: 2020 2020 6865 6c70 3d22 4d6f 756e 7420      help="Mount 
-0003d3f0: 666f 6c64 6572 206f 6e20 6e65 7720 4543  folder on new EC
-0003d400: 3220 696e 7374 616e 6365 2069 6e73 7465  2 instance inste
-0003d410: 6164 206f 6620 6c6f 6361 6c20 6d61 6368  ad of local mach
-0003d420: 696e 6522 290a 2020 2020 7061 7273 6572  ine").    parser
-0003d430: 5f6d 6f75 6e74 2e61 6464 5f61 7267 756d  _mount.add_argum
-0003d440: 656e 7428 272d 2d75 6e6d 6f75 6e74 272c  ent('--unmount',
-0003d450: 2027 2d75 272c 2064 6573 743d 2775 6e6d   '-u', dest='unm
-0003d460: 6f75 6e74 272c 2061 6374 696f 6e3d 2773  ount', action='s
-0003d470: 746f 7265 5f74 7275 6527 2c20 6465 6661  tore_true', defa
-0003d480: 756c 743d 4661 6c73 652c 0a20 2020 2020  ult=False,.     
-0003d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d4a0: 2020 2020 2020 2020 2068 656c 703d 2275           help="u
-0003d4b0: 6e6d 6f75 6e74 2069 6e73 7465 6164 206f  nmount instead o
-0003d4c0: 6620 6d6f 756e 742c 2079 6f75 2063 616e  f mount, you can
-0003d4d0: 2061 6c73 6f20 7573 6520 7468 6520 756d   also use the um
-0003d4e0: 6f75 6e74 2073 7562 2063 6f6d 6d61 6e64  ount sub command
-0003d4f0: 2069 6e73 7465 6164 2e22 290a 2020 2020   instead.").    
-0003d500: 7061 7273 6572 5f6d 6f75 6e74 2e61 6464  parser_mount.add
-0003d510: 5f61 7267 756d 656e 7428 2766 6f6c 6465  _argument('folde
-0003d520: 7273 272c 2061 6374 696f 6e3d 2773 746f  rs', action='sto
-0003d530: 7265 272c 2064 6566 6175 6c74 3d5b 5d2c  re', default=[],
-0003d540: 2020 6e61 7267 733d 272a 272c 0a20 2020    nargs='*',.   
-0003d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d560: 2020 2020 2020 2020 2020 2068 656c 703d             help=
-0003d570: 2761 7263 6869 7665 6420 666f 6c64 6572  'archived folder
-0003d580: 7320 2873 6570 6172 6174 6564 2062 7920  s (separated by 
-0003d590: 7370 6163 6529 2077 6869 6368 2079 6f75  space) which you
-0003d5a0: 2077 6f75 6c64 206c 696b 6520 746f 206d   would like to m
-0003d5b0: 6f75 6e74 2e27 202b 0a20 2020 2020 2020  ount.' +.       
-0003d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d5d0: 2020 2020 2020 2027 2729 0a0a 2020 2020         '')..    
-0003d5e0: 2320 2a2a 2a0a 0a20 2020 2070 6172 7365  # ***..    parse
-0003d5f0: 725f 7265 7374 6f72 6520 3d20 7375 6270  r_restore = subp
-0003d600: 6172 7365 7273 2e61 6464 5f70 6172 7365  arsers.add_parse
-0003d610: 7228 2772 6573 746f 7265 272c 2061 6c69  r('restore', ali
-0003d620: 6173 6573 3d5b 2772 7374 275d 2c0a 2020  ases=['rst'],.  
-0003d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d650: 2020 2020 2020 2020 2068 656c 703d 7465           help=te
-0003d660: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
-0003d670: 2727 0a20 2020 2020 2020 2020 2020 2052  ''.            R
-0003d680: 6573 746f 7265 2064 6174 6120 6672 6f6d  estore data from
-0003d690: 2041 5753 2047 6c61 6369 6572 2074 6f20   AWS Glacier to 
-0003d6a0: 4157 5320 5333 204f 6e65 205a 6f6e 652d  AWS S3 One Zone-
-0003d6b0: 4941 2e20 596f 7520 646f 206e 6f74 206e  IA. You do not n
-0003d6c0: 6565 640a 2020 2020 2020 2020 2020 2020  eed.            
-0003d6d0: 746f 2064 6f77 6e6c 6f61 6420 616c 6c20  to download all 
-0003d6e0: 6461 7461 2074 6f20 6c6f 6361 6c20 7374  data to local st
-0003d6f0: 6f72 6167 6520 6166 7465 7220 7468 6520  orage after the 
-0003d700: 7265 7374 6f72 6520 6973 2063 6f6d 706c  restore is compl
-0003d710: 6574 652e 0a20 2020 2020 2020 2020 2020  ete..           
-0003d720: 204a 7573 7420 7573 6520 7468 6520 6d6f   Just use the mo
-0003d730: 756e 7420 7375 6220 636f 6d6d 616e 642e  unt sub command.
-0003d740: 0a20 2020 2020 2020 2027 2727 292c 2066  .        '''), f
-0003d750: 6f72 6d61 7474 6572 5f63 6c61 7373 3d61  ormatter_class=a
-0003d760: 7267 7061 7273 652e 5261 7754 6578 7448  rgparse.RawTextH
-0003d770: 656c 7046 6f72 6d61 7474 6572 290a 2020  elpFormatter).  
-0003d780: 2020 7061 7273 6572 5f72 6573 746f 7265    parser_restore
-0003d790: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
-0003d7a0: 2d64 6179 7327 2c20 272d 6427 2c20 6465  -days', '-d', de
-0003d7b0: 7374 3d27 6461 7973 272c 2061 6374 696f  st='days', actio
-0003d7c0: 6e3d 2773 746f 7265 272c 2064 6566 6175  n='store', defau
-0003d7d0: 6c74 3d33 302c 0a20 2020 2020 2020 2020  lt=30,.         
-0003d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d7f0: 2020 2020 2020 2068 656c 703d 274e 756d         help='Num
-0003d800: 6265 7220 6f66 2064 6179 7320 746f 206b  ber of days to k
-0003d810: 6565 7020 6461 7461 2069 6e20 5333 204f  eep data in S3 O
-0003d820: 6e65 205a 6f6e 652d 4941 2073 746f 7261  ne Zone-IA stora
-0003d830: 6765 2061 7420 2431 302f 5469 422f 6d6f  ge at $10/TiB/mo
-0003d840: 6e74 6820 2864 6566 6175 6c74 3a20 3330  nth (default: 30
-0003d850: 2927 290a 2020 2020 7061 7273 6572 5f72  )').    parser_r
-0003d860: 6573 746f 7265 2e61 6464 5f61 7267 756d  estore.add_argum
-0003d870: 656e 7428 272d 2d72 6574 7269 6576 652d  ent('--retrieve-
-0003d880: 6f70 7427 2c20 272d 7227 2c20 6465 7374  opt', '-r', dest
-0003d890: 3d27 7265 7472 6965 7665 6f70 7427 2c20  ='retrieveopt', 
-0003d8a0: 6163 7469 6f6e 3d27 7374 6f72 6527 2c20  action='store', 
-0003d8b0: 6465 6661 756c 743d 2742 756c 6b27 2c0a  default='Bulk',.
-0003d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d8e0: 6865 6c70 3d74 6578 7477 7261 702e 6465  help=textwrap.de
-0003d8f0: 6465 6e74 2866 2727 270a 2020 2020 2020  dent(f'''.      
-0003d900: 2020 2020 2020 4275 6c6b 2028 6465 6661        Bulk (defa
-0003d910: 756c 7429 3a0a 2020 2020 2020 2020 2020  ult):.          
-0003d920: 2020 2020 2020 2d20 352d 3132 2068 6f75        - 5-12 hou
-0003d930: 7273 2072 6574 7269 6576 616c 0a20 2020  rs retrieval.   
-0003d940: 2020 2020 2020 2020 2020 2020 202d 2063               - c
-0003d950: 6f73 7473 206f 6620 2432 2e35 3020 7065  osts of $2.50 pe
-0003d960: 7220 5469 420a 2020 2020 2020 2020 2020  r TiB.          
-0003d970: 2020 5374 616e 6461 7264 3a0a 2020 2020    Standard:.    
-0003d980: 2020 2020 2020 2020 2020 2020 2d20 332d              - 3-
-0003d990: 3520 686f 7572 7320 7265 7472 6965 7661  5 hours retrieva
-0003d9a0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-0003d9b0: 2020 2d20 636f 7374 7320 6f66 2024 3130    - costs of $10
-0003d9c0: 2070 6572 2054 6942 0a20 2020 2020 2020   per TiB.       
-0003d9d0: 2020 2020 2045 7870 6564 6974 6564 3a0a       Expedited:.
-0003d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d9f0: 2d20 312d 3520 6d69 6e75 7465 7320 7265  - 1-5 minutes re
-0003da00: 7472 6965 7661 6c0a 2020 2020 2020 2020  trieval.        
-0003da10: 2020 2020 2020 2020 2d20 636f 7374 7320          - costs 
-0003da20: 6f66 2024 3330 2070 6572 2054 6942 0a0a  of $30 per TiB..
-0003da30: 2020 2020 2020 2020 2020 2020 496e 2061              In a
-0003da40: 6464 6974 696f 6e20 746f 2074 6865 2072  ddition to the r
-0003da50: 6574 7269 6576 616c 2063 6f73 742c 2041  etrieval cost, A
-0003da60: 5753 2077 696c 6c20 6368 6172 6765 2079  WS will charge y
-0003da70: 6f75 2061 626f 7574 0a20 2020 2020 2020  ou about.       
-0003da80: 2020 2020 2024 3130 2f54 6942 2f6d 6f6e       $10/TiB/mon
-0003da90: 7468 2066 6f72 2074 6865 2064 7572 6174  th for the durat
-0003daa0: 696f 6e20 796f 7520 6b65 6570 2074 6865  ion you keep the
-0003dab0: 2064 6174 6120 696e 2053 332e 0a20 2020   data in S3..   
-0003dac0: 2020 2020 2020 2020 2028 436f 7374 7320           (Costs 
-0003dad0: 696e 2053 756d 6d65 7220 3230 3233 290a  in Summer 2023).
-0003dae0: 2020 2020 2020 2020 2020 2020 2727 2729              ''')
-0003daf0: 290a 2020 2020 7061 7273 6572 5f72 6573  ).    parser_res
-0003db00: 746f 7265 2e61 6464 5f61 7267 756d 656e  tore.add_argumen
-0003db10: 7428 272d 2d61 7773 272c 2027 2d61 272c  t('--aws', '-a',
-0003db20: 2064 6573 743d 2761 7773 272c 2061 6374   dest='aws', act
-0003db30: 696f 6e3d 2773 746f 7265 5f74 7275 6527  ion='store_true'
-0003db40: 2c20 6465 6661 756c 743d 4661 6c73 652c  , default=False,
-0003db50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003db70: 2068 656c 703d 2252 6573 746f 7265 2066   help="Restore f
-0003db80: 6f6c 6465 7220 6f6e 206e 6577 2041 5753  older on new AWS
-0003db90: 2045 4332 2069 6e73 7461 6e63 6520 696e   EC2 instance in
-0003dba0: 7374 6561 6420 6f66 206c 6f63 616c 206d  stead of local m
-0003dbb0: 6163 6869 6e65 2229 0a20 2020 2070 6172  achine").    par
-0003dbc0: 7365 725f 7265 7374 6f72 652e 6164 645f  ser_restore.add_
-0003dbd0: 6172 6775 6d65 6e74 2827 2d2d 696e 7374  argument('--inst
-0003dbe0: 616e 6365 2d74 7970 6527 2c20 272d 6927  ance-type', '-i'
-0003dbf0: 2c20 6465 7374 3d27 696e 7374 616e 6365  , dest='instance
-0003dc00: 7479 7065 272c 2061 6374 696f 6e3d 2773  type', action='s
-0003dc10: 746f 7265 272c 2064 6566 6175 6c74 3d22  tore', default="
-0003dc20: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0003dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dc40: 2020 2068 656c 703d 2754 6865 2045 4332     help='The EC2
-0003dc50: 2069 6e73 7461 6e63 6520 7479 7065 2069   instance type i
-0003dc60: 7320 6175 746f 2d73 656c 6563 7465 642c  s auto-selected,
-0003dc70: 2062 7574 2079 6f75 2063 616e 2070 6963   but you can pic
-0003dc80: 6b20 616e 7920 6f74 6865 7220 7479 7065  k any other type
-0003dc90: 2068 6572 6527 290a 2020 2020 7061 7273   here').    pars
-0003dca0: 6572 5f72 6573 746f 7265 2e61 6464 5f61  er_restore.add_a
-0003dcb0: 7267 756d 656e 7428 272d 2d6d 6f6e 6974  rgument('--monit
-0003dcc0: 6f72 272c 2027 2d6d 272c 2064 6573 743d  or', '-m', dest=
-0003dcd0: 276d 6f6e 6974 6f72 272c 2061 6374 696f  'monitor', actio
-0003dce0: 6e3d 2773 746f 7265 5f74 7275 6527 2c20  n='store_true', 
-0003dcf0: 6465 6661 756c 743d 4661 6c73 652c 0a20  default=False,. 
-0003dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dd10: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0003dd20: 656c 703d 224d 6f6e 6974 6f72 2045 4332  elp="Monitor EC2
-0003dd30: 2073 6572 7665 7220 666f 7220 636f 7374   server for cost
-0003dd40: 2061 6e64 2069 646c 6520 7469 6d65 2e22   and idle time."
-0003dd50: 290a 2020 2020 7061 7273 6572 5f72 6573  ).    parser_res
-0003dd60: 746f 7265 2e61 6464 5f61 7267 756d 656e  tore.add_argumen
-0003dd70: 7428 272d 2d6e 6f2d 646f 776e 6c6f 6164  t('--no-download
-0003dd80: 272c 2027 2d6c 272c 2064 6573 743d 276e  ', '-l', dest='n
-0003dd90: 6f64 6f77 6e6c 6f61 6427 2c20 6163 7469  odownload', acti
-0003dda0: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
-0003ddb0: 2064 6566 6175 6c74 3d46 616c 7365 2c0a   default=False,.
-0003ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dde0: 6865 6c70 3d22 736b 6970 2064 6f77 6e6c  help="skip downl
-0003ddf0: 6f61 6420 746f 206c 6f63 616c 2073 746f  oad to local sto
-0003de00: 7261 6765 2061 6674 6572 2072 6574 7269  rage after retri
-0003de10: 6576 616c 2066 726f 6d20 476c 6163 6965  eval from Glacie
-0003de20: 7222 290a 2020 2020 7061 7273 6572 5f72  r").    parser_r
-0003de30: 6573 746f 7265 2e61 6464 5f61 7267 756d  estore.add_argum
-0003de40: 656e 7428 2766 6f6c 6465 7273 272c 2061  ent('folders', a
-0003de50: 6374 696f 6e3d 2773 746f 7265 272c 2064  ction='store', d
-0003de60: 6566 6175 6c74 3d5b 5d2c 2020 6e61 7267  efault=[],  narg
-0003de70: 733d 272a 272c 0a20 2020 2020 2020 2020  s='*',.         
-0003de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003de90: 2020 2020 2020 2068 656c 703d 2766 6f6c         help='fol
-0003dea0: 6465 7273 2079 6f75 2077 6f75 6c64 206c  ders you would l
-0003deb0: 696b 6520 746f 2074 6f20 7265 7374 6f72  ike to to restor
-0003dec0: 6520 2873 6570 6172 6174 6564 2062 7920  e (separated by 
-0003ded0: 7370 6163 6529 2c20 2720 2b0a 2020 2020  space), ' +.    
-0003dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003def0: 2020 2020 2020 2020 2020 2020 2727 290a              '').
-0003df00: 0a20 2020 2023 202a 2a2a 0a0a 2020 2020  .    # ***..    
-0003df10: 7061 7273 6572 5f73 7368 203d 2073 7562  parser_ssh = sub
-0003df20: 7061 7273 6572 732e 6164 645f 7061 7273  parsers.add_pars
-0003df30: 6572 2827 7373 6827 2c20 616c 6961 7365  er('ssh', aliase
-0003df40: 733d 5b27 7363 7027 5d2c 0a20 2020 2020  s=['scp'],.     
-0003df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df70: 2020 6865 6c70 3d74 6578 7477 7261 702e    help=textwrap.
-0003df80: 6465 6465 6e74 2866 2727 270a 2020 2020  dedent(f'''.    
-0003df90: 2020 2020 2020 2020 4c6f 6769 6e20 746f          Login to
-0003dfa0: 2061 6e20 4157 5320 4543 3220 696e 7374   an AWS EC2 inst
-0003dfb0: 616e 6365 2074 6f20 7768 6963 6820 6461  ance to which da
-0003dfc0: 7461 2077 6173 2072 6573 746f 7265 6420  ta was restored 
-0003dfd0: 7769 7468 2074 6865 202d 2d61 7773 206f  with the --aws o
-0003dfe0: 7074 696f 6e0a 2020 2020 2020 2020 2727  ption.        ''
-0003dff0: 2729 2c20 666f 726d 6174 7465 725f 636c  '), formatter_cl
-0003e000: 6173 733d 6172 6770 6172 7365 2e52 6177  ass=argparse.Raw
-0003e010: 5465 7874 4865 6c70 466f 726d 6174 7465  TextHelpFormatte
-0003e020: 7229 0a20 2020 2070 6172 7365 725f 7373  r).    parser_ss
-0003e030: 682e 6164 645f 6172 6775 6d65 6e74 2827  h.add_argument('
-0003e040: 2d2d 6c69 7374 272c 2027 2d6c 272c 2064  --list', '-l', d
-0003e050: 6573 743d 276c 6973 7427 2c20 6163 7469  est='list', acti
-0003e060: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
-0003e070: 2064 6566 6175 6c74 3d46 616c 7365 2c0a   default=False,.
-0003e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e090: 2020 2020 2020 2020 2020 2020 6865 6c70              help
-0003e0a0: 3d22 4c69 7374 2072 756e 6e69 6e67 2046  ="List running F
-0003e0b0: 726f 7374 6572 2041 5753 2045 4332 2069  roster AWS EC2 i
-0003e0c0: 6e73 7461 6e63 6573 2229 0a20 2020 2070  nstances").    p
-0003e0d0: 6172 7365 725f 7373 682e 6164 645f 6172  arser_ssh.add_ar
-0003e0e0: 6775 6d65 6e74 2827 2d2d 7465 726d 696e  gument('--termin
-0003e0f0: 6174 6527 2c20 272d 7427 2c20 6465 7374  ate', '-t', dest
-0003e100: 3d27 7465 726d 696e 6174 6527 2c20 6163  ='terminate', ac
-0003e110: 7469 6f6e 3d27 7374 6f72 6527 2c20 6465  tion='store', de
-0003e120: 6661 756c 743d 2727 2c0a 2020 2020 2020  fault='',.      
+0003b190: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
+0003b1a0: 6270 726f 6365 7373 2e50 4950 452c 2073  bprocess.PIPE, s
+0003b1b0: 7464 6572 723d 7375 6270 726f 6365 7373  tderr=subprocess
+0003b1c0: 2e50 4950 452c 2074 6578 743d 5472 7565  .PIPE, text=True
+0003b1d0: 292e 7374 6465 7272 2e73 706c 6974 2827  ).stderr.split('
+0003b1e0: 5c6e 2729 5b30 5d2e 7370 6c69 7428 295b  \n')[0].split()[
+0003b1f0: 325d 290a 2020 2020 2020 2020 7072 696e  2]).        prin
+0003b200: 7428 2720 2020 272c 2073 7562 7072 6f63  t('   ', subproc
+0003b210: 6573 732e 7275 6e28 5b6f 732e 7061 7468  ess.run([os.path
+0003b220: 2e6a 6f69 6e28 7379 732e 7072 6566 6978  .join(sys.prefix
+0003b230: 2c20 2762 696e 272c 2027 7263 6c6f 6e65  , 'bin', 'rclone
+0003b240: 2729 2c20 272d 2d76 6572 7369 6f6e 275d  '), '--version']
+0003b250: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b270: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
+0003b280: 7072 6f63 6573 732e 5049 5045 2c20 7374  process.PIPE, st
+0003b290: 6465 7272 3d73 7562 7072 6f63 6573 732e  derr=subprocess.
+0003b2a0: 5049 5045 2c20 7465 7874 3d54 7275 6529  PIPE, text=True)
+0003b2b0: 2e73 7464 6f75 742e 7370 6c69 7428 275c  .stdout.split('\
+0003b2c0: 6e27 295b 305d 290a 0a20 2020 2020 2020  n')[0])..       
+0003b2d0: 2070 7269 6e74 2874 6578 7477 7261 702e   print(textwrap.
+0003b2e0: 6465 6465 6e74 2866 2727 270a 2020 2020  dedent(f'''.    
+0003b2f0: 2020 2020 2020 2020 4175 7468 6f72 733a          Authors:
+0003b300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b310: 2057 7269 7474 656e 2062 7920 4469 726b   Written by Dirk
+0003b320: 2050 6574 6572 7365 6e20 616e 6420 4870   Petersen and Hp
+0003b330: 6320 4e6f 7720 436f 6e73 756c 7469 6e67  c Now Consulting
+0003b340: 2053 4c0a 0a20 2020 2020 2020 2020 2020   SL..           
+0003b350: 2052 6570 6f73 6974 6f72 793a 0a20 2020   Repository:.   
+0003b360: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+0003b370: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0003b380: 6469 726b 7065 7465 7273 656e 2f66 726f  dirkpetersen/fro
+0003b390: 7374 6572 0a0a 0a20 2020 2020 2020 2020  ster...         
+0003b3a0: 2020 2043 6f70 7972 6967 6874 2028 4329     Copyright (C)
+0003b3b0: 2032 3032 3420 4f72 6567 6f6e 2048 6561   2024 Oregon Hea
+0003b3c0: 6c74 6820 2620 5363 6965 6e63 6520 556e  lth & Science Un
+0003b3d0: 6976 6572 7369 7479 2028 4f53 4855 290a  iversity (OSHU).
+0003b3e0: 0a20 2020 2020 2020 2020 2020 204c 6963  .            Lic
+0003b3f0: 656e 7365 6420 756e 6465 7220 7468 6520  ensed under the 
+0003b400: 4170 6163 6865 204c 6963 656e 7365 2c20  Apache License, 
+0003b410: 5665 7273 696f 6e20 322e 3020 2874 6865  Version 2.0 (the
+0003b420: 2022 4c69 6365 6e73 6522 293b 0a20 2020   "License");.   
+0003b430: 2020 2020 2020 2020 2079 6f75 206d 6179           you may
+0003b440: 206e 6f74 2075 7365 2074 6869 7320 6669   not use this fi
+0003b450: 6c65 2065 7863 6570 7420 696e 2063 6f6d  le except in com
+0003b460: 706c 6961 6e63 6520 7769 7468 2074 6865  pliance with the
+0003b470: 204c 6963 656e 7365 2e0a 2020 2020 2020   License..      
+0003b480: 2020 2020 2020 596f 7520 6d61 7920 6f62        You may ob
+0003b490: 7461 696e 2061 2063 6f70 7920 6f66 2074  tain a copy of t
+0003b4a0: 6865 204c 6963 656e 7365 2061 740a 0a20  he License at.. 
+0003b4b0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003b4c0: 7474 703a 2f2f 7777 772e 6170 6163 6865  ttp://www.apache
+0003b4d0: 2e6f 7267 2f6c 6963 656e 7365 732f 4c49  .org/licenses/LI
+0003b4e0: 4345 4e53 452d 322e 300a 0a20 2020 2020  CENSE-2.0..     
+0003b4f0: 2020 2020 2020 2055 6e6c 6573 7320 7265         Unless re
+0003b500: 7175 6972 6564 2062 7920 6170 706c 6963  quired by applic
+0003b510: 6162 6c65 206c 6177 206f 7220 6167 7265  able law or agre
+0003b520: 6564 2074 6f20 696e 2077 7269 7469 6e67  ed to in writing
+0003b530: 2c20 736f 6674 7761 7265 0a20 2020 2020  , software.     
+0003b540: 2020 2020 2020 2064 6973 7472 6962 7574         distribut
+0003b550: 6564 2075 6e64 6572 2074 6865 204c 6963  ed under the Lic
+0003b560: 656e 7365 2069 7320 6469 7374 7269 6275  ense is distribu
+0003b570: 7465 6420 6f6e 2061 6e20 2241 5320 4953  ted on an "AS IS
+0003b580: 2220 4241 5349 532c 0a20 2020 2020 2020  " BASIS,.       
+0003b590: 2020 2020 2057 4954 484f 5554 2057 4152       WITHOUT WAR
+0003b5a0: 5241 4e54 4945 5320 4f52 2043 4f4e 4449  RANTIES OR CONDI
+0003b5b0: 5449 4f4e 5320 4f46 2041 4e59 204b 494e  TIONS OF ANY KIN
+0003b5c0: 442c 2065 6974 6865 7220 6578 7072 6573  D, either expres
+0003b5d0: 7320 6f72 2069 6d70 6c69 6564 2e0a 2020  s or implied..  
+0003b5e0: 2020 2020 2020 2020 2020 5365 6520 7468            See th
+0003b5f0: 6520 4c69 6365 6e73 6520 666f 7220 7468  e License for th
+0003b600: 6520 7370 6563 6966 6963 206c 616e 6775  e specific langu
+0003b610: 6167 6520 676f 7665 726e 696e 6720 7065  age governing pe
+0003b620: 726d 6973 7369 6f6e 7320 616e 640a 2020  rmissions and.  
+0003b630: 2020 2020 2020 2020 2020 6c69 6d69 7461            limita
+0003b640: 7469 6f6e 7320 756e 6465 7220 7468 6520  tions under the 
+0003b650: 4c69 6365 6e73 652e 0a20 2020 2020 2020  License..       
+0003b660: 2020 2020 2027 2727 2929 0a0a 2020 2020       '''))..    
+0003b670: 6465 6620 7375 6263 6d64 5f63 6f6e 6669  def subcmd_confi
+0003b680: 6728 7365 6c66 2c20 6366 673a 2043 6f6e  g(self, cfg: Con
+0003b690: 6669 674d 616e 6167 6572 2c20 6177 733a  figManager, aws:
+0003b6a0: 2041 5753 426f 746f 293a 0a20 2020 2020   AWSBoto):.     
+0003b6b0: 2020 2027 2727 436f 6e66 6967 7572 6520     '''Configure 
+0003b6c0: 4672 6f73 7465 7220 7365 7474 696e 6773  Froster settings
+0003b6d0: 2e27 2727 0a20 2020 2020 2020 2074 7279  .'''.        try
+0003b6e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0003b6f0: 2073 656c 662e 6172 6773 2e75 7365 723a   self.args.user:
+0003b700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b710: 2072 6574 7572 6e20 6366 672e 7365 745f   return cfg.set_
+0003b720: 7573 6572 2829 0a0a 2020 2020 2020 2020  user()..        
+0003b730: 2020 2020 6966 2073 656c 662e 6172 6773      if self.args
+0003b740: 2e61 7773 3a0a 2020 2020 2020 2020 2020  .aws:.          
+0003b750: 2020 2020 2020 7265 7475 726e 2063 6667        return cfg
+0003b760: 2e73 6574 5f61 7773 2861 7773 290a 0a20  .set_aws(aws).. 
+0003b770: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0003b780: 6c66 2e61 7267 732e 7368 6172 6564 3a0a  lf.args.shared:.
+0003b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b7a0: 7265 7475 726e 2063 6667 2e73 6574 5f73  return cfg.set_s
+0003b7b0: 6861 7265 6428 290a 0a20 2020 2020 2020  hared()..       
+0003b7c0: 2020 2020 2069 6620 7365 6c66 2e61 7267       if self.arg
+0003b7d0: 732e 6e69 683a 0a20 2020 2020 2020 2020  s.nih:.         
+0003b7e0: 2020 2020 2020 2072 6574 7572 6e20 6366         return cf
+0003b7f0: 672e 7365 745f 6e69 6828 290a 0a20 2020  g.set_nih()..   
+0003b800: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0003b810: 2e61 7267 732e 7333 3a0a 2020 2020 2020  .args.s3:.      
+0003b820: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0003b830: 2063 6667 2e73 6574 5f73 3328 6177 7329   cfg.set_s3(aws)
+0003b840: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003b850: 2073 656c 662e 6172 6773 2e73 6c75 726d   self.args.slurm
+0003b860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003b870: 2020 7265 7475 726e 2063 6667 2e73 6574    return cfg.set
+0003b880: 5f73 6c75 726d 2873 656c 662e 6172 6773  _slurm(self.args
+0003b890: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0003b8a0: 6620 7365 6c66 2e61 7267 732e 7072 696e  f self.args.prin
+0003b8b0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0003b8c0: 2020 2072 6574 7572 6e20 6366 672e 7072     return cfg.pr
+0003b8d0: 696e 745f 636f 6e66 6967 2829 0a0a 2020  int_config()..  
+0003b8e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0003b8f0: 662e 6172 6773 2e6d 6f6e 6974 6f72 3a0a  f.args.monitor:.
+0003b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b910: 6672 6f73 7465 725f 6269 6e61 7279 203d  froster_binary =
+0003b920: 206f 732e 7061 7468 2e6a 6f69 6e28 6366   os.path.join(cf
+0003b930: 672e 6269 6e5f 6469 722c 2027 6672 6f73  g.bin_dir, 'fros
+0003b940: 7465 7227 290a 2020 2020 2020 2020 2020  ter').          
+0003b950: 2020 2020 2020 7265 7475 726e 2063 6667        return cfg
+0003b960: 2e61 6464 5f73 7973 7465 6d64 5f63 726f  .add_systemd_cro
+0003b970: 6e5f 6a6f 6228 0a20 2020 2020 2020 2020  n_job(.         
+0003b980: 2020 2020 2020 2020 2020 2066 277b 6672             f'{fr
+0003b990: 6f73 7465 725f 6269 6e61 7279 7d20 7265  oster_binary} re
+0003b9a0: 7374 6f72 6520 2d2d 6d6f 6e69 746f 7227  store --monitor'
+0003b9b0: 2c20 2733 3027 290a 0a20 2020 2020 2020  , '30')..       
+0003b9c0: 2020 2020 2070 7269 6e74 2866 275c 6e2a       print(f'\n*
+0003b9d0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003b9e0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2729 0a20  ************'). 
+0003b9f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0003ba00: 2866 272a 2a2a 2046 524f 5354 4552 2043  (f'*** FROSTER C
+0003ba10: 4f4e 4649 4755 5241 5449 4f4e 202a 2a2a  ONFIGURATION ***
+0003ba20: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+0003ba30: 7269 6e74 2866 272a 2a2a 2a2a 2a2a 2a2a  rint(f'*********
+0003ba40: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003ba50: 2a2a 2a2a 5c6e 2729 0a0a 2020 2020 2020  ****\n')..      
+0003ba60: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+0003ba70: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
+0003ba80: 6f6e 2066 696c 6520 6578 6973 7473 2061  on file exists a
+0003ba90: 6e64 2061 736b 2066 6f72 206f 7665 7277  nd ask for overw
+0003baa0: 7269 7465 0a20 2020 2020 2020 2020 2020  rite.           
+0003bab0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+0003bac0: 7473 2863 6667 2e63 6f6e 6669 675f 6669  ts(cfg.config_fi
+0003bad0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0003bae0: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0003baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb00: 6627 5741 524e 494e 473a 2059 6f75 2061  f'WARNING: You a
+0003bb10: 7265 2061 626f 7574 2074 6f20 6f76 6572  re about to over
+0003bb20: 7772 6974 6520 7b63 6667 2e63 6f6e 6669  write {cfg.confi
+0003bb30: 675f 6669 6c65 7d5c 6e27 290a 2020 2020  g_file}\n').    
+0003bb40: 2020 2020 2020 2020 2020 2020 6973 5f6f              is_o
+0003bb50: 7665 7277 7269 7465 203d 2069 6e71 7569  verwrite = inqui
+0003bb60: 7265 722e 636f 6e66 6972 6d28 0a20 2020  rer.confirm(.   
+0003bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb80: 206d 6573 7361 6765 3d66 2244 6f20 796f   message=f"Do yo
+0003bb90: 7520 7761 6e74 2074 6f20 636f 6e74 696e  u want to contin
+0003bba0: 7565 3f22 2c20 6465 6661 756c 743d 4661  ue?", default=Fa
+0003bbb0: 6c73 6529 0a0a 2020 2020 2020 2020 2020  lse)..          
+0003bbc0: 2020 2020 2020 6966 2069 735f 6f76 6572        if is_over
+0003bbd0: 7772 6974 653a 0a20 2020 2020 2020 2020  write:.         
+0003bbe0: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
+0003bbf0: 6d6f 7665 2863 6667 2e63 6f6e 6669 675f  move(cfg.config_
+0003bc00: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+0003bc10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc30: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
+0003bc40: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003bc50: 6366 672e 7365 745f 7573 6572 2829 3a0a  cfg.set_user():.
+0003bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc70: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+0003bc80: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0003bc90: 2063 6667 2e73 6574 5f61 7773 2861 7773   cfg.set_aws(aws
+0003bca0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003bcb0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0003bcc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003bcd0: 6e6f 7420 6366 672e 7365 745f 7368 6172  not cfg.set_shar
+0003bce0: 6564 2829 3a0a 2020 2020 2020 2020 2020  ed():.          
+0003bcf0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0003bd00: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+0003bd10: 2320 4966 2073 6861 7265 6420 636f 6e66  # If shared conf
+0003bd20: 6967 7572 6174 696f 6e20 616e 6420 7368  iguration and sh
+0003bd30: 6172 6564 5f63 6f6e 6669 672e 696e 6920  ared_config.ini 
+0003bd40: 6669 6c65 2065 7869 7374 732c 2074 6865  file exists, the
+0003bd50: 6e20 7573 6520 6974 0a20 2020 2020 2020  n use it.       
+0003bd60: 2020 2020 2069 6620 6366 672e 6973 5f73       if cfg.is_s
+0003bd70: 6861 7265 643a 0a20 2020 2020 2020 2020  hared:.         
+0003bd80: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+0003bd90: 7228 6366 672c 2027 7368 6172 6564 5f63  r(cfg, 'shared_c
+0003bda0: 6f6e 6669 675f 6669 6c65 2729 2061 6e64  onfig_file') and
+0003bdb0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0003bdc0: 6366 672e 7368 6172 6564 5f63 6f6e 6669  cfg.shared_confi
+0003bdd0: 675f 6669 6c65 293a 0a0a 2020 2020 2020  g_file):..      
+0003bde0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003bdf0: 696e 7428 6627 5c6e 2a2a 2a2a 2a2a 2a2a  int(f'\n********
+0003be00: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003be10: 2a2a 2a2a 2a2a 2a2a 2a2a 2729 0a20 2020  **********').   
+0003be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003be30: 2070 7269 6e74 2866 272a 2a2a 2046 524f   print(f'*** FRO
+0003be40: 5354 4552 2043 4f4e 4649 4755 5241 5449  STER CONFIGURATI
+0003be50: 4f4e 2044 4f4e 4520 2a2a 2a27 290a 2020  ON DONE ***').  
+0003be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003be70: 2020 7072 696e 7428 6627 2a2a 2a2a 2a2a    print(f'******
+0003be80: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003be90: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 5c6e 2729  ************\n')
+0003bea0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003beb0: 2020 2020 2020 7072 696e 7428 7465 7874        print(text
+0003bec0: 7772 6170 2e64 6564 656e 7428 6627 2727  wrap.dedent(f'''
+0003bed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003bee0: 2020 2020 2020 2020 204c 6f63 616c 2063           Local c
+0003bef0: 6f6e 6669 6775 7261 7469 6f6e 3a20 7b63  onfiguration: {c
+0003bf00: 6667 2e63 6f6e 6669 675f 6669 6c65 7d0a  fg.config_file}.
+0003bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf20: 2020 2020 2020 2020 5368 6172 6564 2063          Shared c
+0003bf30: 6f6e 6669 6775 7261 7469 6f6e 3a20 7b63  onfiguration: {c
+0003bf40: 6667 2e73 6861 7265 645f 636f 6e66 6967  fg.shared_config
+0003bf50: 5f66 696c 657d 0a0a 2020 2020 2020 2020  _file}..        
+0003bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf70: 596f 7520 6361 6e20 6f76 6572 7772 6974  You can overwrit
+0003bf80: 6520 7370 6563 6966 6963 2063 6f6e 6669  e specific confi
+0003bf90: 6775 7261 7469 6f6e 2073 6563 7469 6f6e  guration section
+0003bfa0: 732e 2043 6865 636b 206f 7074 696f 6e73  s. Check options
+0003bfb0: 2075 7369 6e67 2074 6865 2063 6f6d 6d61   using the comma
+0003bfc0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+0003bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bfe0: 6672 6f73 7465 7220 636f 6e66 6967 202d  froster config -
+0003bff0: 2d68 656c 700a 2020 2020 2020 2020 2020  -help.          
+0003c000: 2020 2020 2020 2020 2020 2020 2020 2727                ''
+0003c010: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+0003c020: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0003c030: 7275 650a 0a20 2020 2020 2020 2020 2020  rue..           
+0003c040: 2069 6620 6e6f 7420 6366 672e 7365 745f   if not cfg.set_
+0003c050: 6e69 6828 293a 0a20 2020 2020 2020 2020  nih():.         
+0003c060: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0003c070: 6c73 650a 0a20 2020 2020 2020 2020 2020  lse..           
+0003c080: 2069 6620 6e6f 7420 6366 672e 7365 745f   if not cfg.set_
+0003c090: 7333 2861 7773 293a 0a20 2020 2020 2020  s3(aws):.       
+0003c0a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003c0b0: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+0003c0c0: 2020 2069 6620 6e6f 7420 6366 672e 7365     if not cfg.se
+0003c0d0: 745f 736c 7572 6d28 7365 6c66 2e61 7267  t_slurm(self.arg
+0003c0e0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0003c0f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0003c100: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0003c110: 696e 7428 6627 5c6e 2a2a 2a2a 2a2a 2a2a  int(f'\n********
+0003c120: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003c130: 2a2a 2a2a 2a2a 2a2a 2a2a 2729 0a20 2020  **********').   
+0003c140: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0003c150: 272a 2a2a 2046 524f 5354 4552 2043 4f4e  '*** FROSTER CON
+0003c160: 4649 4755 5241 5449 4f4e 2044 4f4e 4520  FIGURATION DONE 
+0003c170: 2a2a 2a27 290a 2020 2020 2020 2020 2020  ***').          
+0003c180: 2020 7072 696e 7428 6627 2a2a 2a2a 2a2a    print(f'******
+0003c190: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0003c1a0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 5c6e 2729  ************\n')
+0003c1b0: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0003c1c0: 696e 7428 6627 5c6e 596f 7520 6361 6e20  int(f'\nYou can 
+0003c1d0: 7072 696e 7420 7468 6520 6375 7272 656e  print the curren
+0003c1e0: 7420 636f 6e66 6967 7572 6174 696f 6e20  t configuration 
+0003c1f0: 7573 696e 6720 7468 6520 636f 6d6d 616e  using the comman
+0003c200: 643a 2729 0a20 2020 2020 2020 2020 2020  d:').           
+0003c210: 2070 7269 6e74 2866 2720 2020 2066 726f   print(f'    fro
+0003c220: 7374 6572 2063 6f6e 6669 6720 2d2d 7072  ster config --pr
+0003c230: 696e 745c 6e27 290a 0a20 2020 2020 2020  int\n')..       
+0003c240: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0003c250: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+0003c260: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0003c270: 6e74 5f65 7272 6f72 2829 0a20 2020 2020  nt_error().     
+0003c280: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0003c290: 6c73 650a 0a20 2020 2064 6566 2073 7562  lse..    def sub
+0003c2a0: 636d 645f 696e 6465 7828 7365 6c66 2c20  cmd_index(self, 
+0003c2b0: 6366 673a 2043 6f6e 6669 674d 616e 6167  cfg: ConfigManag
+0003c2c0: 6572 2c20 6172 6368 3a20 4172 6368 6976  er, arch: Archiv
+0003c2d0: 6572 293a 0a20 2020 2020 2020 2027 2727  er):.        '''
+0003c2e0: 496e 6465 7820 666f 6c64 6572 7320 666f  Index folders fo
+0003c2f0: 7220 4672 6f73 7465 722e 2727 270a 2020  r Froster.'''.  
+0003c300: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0003c310: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+0003c320: 6620 7573 6572 2070 726f 7669 6465 6420  f user provided 
+0003c330: 6174 206c 6561 7374 206f 6e65 2061 7267  at least one arg
+0003c340: 756d 656e 740a 2020 2020 2020 2020 2020  ument.          
+0003c350: 2020 6966 206e 6f74 2073 656c 662e 6172    if not self.ar
+0003c360: 6773 2e66 6f6c 6465 7273 3a0a 2020 2020  gs.folders:.    
+0003c370: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0003c380: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0003c390: 2020 2020 2020 2027 5c6e 4572 726f 723a         '\nError:
+0003c3a0: 2046 6f6c 6465 7220 6e6f 7420 7072 6f76   Folder not prov
+0003c3b0: 6964 6564 2e20 4368 6563 6b20 7468 6520  ided. Check the 
+0003c3c0: 696e 6465 7820 636f 6d6d 616e 6420 7573  index command us
+0003c3d0: 6167 6520 7769 7468 2022 6672 6f73 7465  age with "froste
+0003c3e0: 7220 696e 6465 7820 2d2d 6865 6c70 225c  r index --help"\
+0003c3f0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0003c400: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+0003c410: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0003c420: 6865 636b 2069 6620 7468 6520 7072 6f76  heck if the prov
+0003c430: 6964 6564 2070 7761 6c6b 2063 6f70 7920  ided pwalk copy 
+0003c440: 666f 6c64 6572 2065 7869 7374 730a 2020  folder exists.  
+0003c450: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0003c460: 662e 6172 6773 2e70 7761 6c6b 636f 7079  f.args.pwalkcopy
+0003c470: 2061 6e64 206e 6f74 206f 732e 7061 7468   and not os.path
+0003c480: 2e69 7364 6972 2873 656c 662e 6172 6773  .isdir(self.args
+0003c490: 2e70 7761 6c6b 636f 7079 293a 0a20 2020  .pwalkcopy):.   
+0003c4a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0003c4b0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0003c4c0: 2020 2020 2020 2020 6627 5c6e 4572 726f          f'\nErro
+0003c4d0: 723a 2046 6f6c 6465 7220 227b 7365 6c66  r: Folder "{self
+0003c4e0: 2e61 7267 732e 7077 616c 6b63 6f70 797d  .args.pwalkcopy}
+0003c4f0: 2220 646f 6573 206e 6f74 2065 7869 7374  " does not exist
+0003c500: 2e5c 6e27 290a 2020 2020 2020 2020 2020  .\n').          
+0003c510: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+0003c520: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0003c530: 2043 6865 636b 2069 6620 616c 6c20 7468   Check if all th
+0003c540: 6520 7072 6f76 6964 6564 2066 6f6c 6465  e provided folde
+0003c550: 7273 2065 7869 7374 0a20 2020 2020 2020  rs exist.       
+0003c560: 2020 2020 2066 6f72 2066 6f6c 6465 7220       for folder 
+0003c570: 696e 2073 656c 662e 6172 6773 2e66 6f6c  in self.args.fol
+0003c580: 6465 7273 3a0a 2020 2020 2020 2020 2020  ders:.          
+0003c590: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+0003c5a0: 7061 7468 2e69 7364 6972 2866 6f6c 6465  path.isdir(folde
+0003c5b0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0003c5c0: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+0003c5d0: 5c6e 4572 726f 723a 2054 6865 2066 6f6c  \nError: The fol
+0003c5e0: 6465 7220 7b66 6f6c 6465 727d 2064 6f65  der {folder} doe
+0003c5f0: 7320 6e6f 7420 6578 6973 742e 5c6e 2729  s not exist.\n')
+0003c600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c610: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0003c620: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0003c630: 496e 6465 7820 7468 6520 6769 7665 6e20  Index the given 
+0003c640: 666f 6c64 6572 730a 2020 2020 2020 2020  folders.        
+0003c650: 2020 2020 6172 6368 2e69 6e64 6578 2873      arch.index(s
+0003c660: 656c 662e 6172 6773 2e66 6f6c 6465 7273  elf.args.folders
+0003c670: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+0003c680: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0003c690: 696e 745f 6572 726f 7228 290a 0a20 2020  int_error()..   
+0003c6a0: 2064 6566 2073 7562 636d 645f 6172 6368   def subcmd_arch
+0003c6b0: 6976 6528 7365 6c66 2c20 6172 6368 3a20  ive(self, arch: 
+0003c6c0: 4172 6368 6976 6572 293a 0a20 2020 2020  Archiver):.     
+0003c6d0: 2020 2027 2727 4368 6563 6b20 636f 6d6d     '''Check comm
+0003c6e0: 616e 6420 666f 7220 6172 6368 6976 696e  and for archivin
+0003c6f0: 6720 666f 6c64 6572 7320 666f 7220 4672  g folders for Fr
+0003c700: 6f73 7465 722e 2727 270a 2020 2020 2020  oster.'''.      
+0003c710: 2020 7472 793a 0a0a 2020 2020 2020 2020    try:..        
+0003c720: 2020 2020 6966 2073 656c 662e 6172 6773      if self.args
+0003c730: 2e6f 6c64 6572 203e 2030 2061 6e64 2073  .older > 0 and s
+0003c740: 656c 662e 6172 6773 2e6e 6577 6572 203e  elf.args.newer >
+0003c750: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0003c760: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+0003c770: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0003c780: 5c6e 4572 726f 723a 2043 616e 6e6f 7420  \nError: Cannot 
+0003c790: 7573 6520 626f 7468 202d 2d6f 6c64 6572  use both --older
+0003c7a0: 2061 6e64 202d 2d6e 6577 6572 2066 6c61   and --newer fla
+0003c7b0: 6773 2074 6f67 6574 6865 722e 5c6e 272c  gs together.\n',
+0003c7c0: 2066 696c 653d 7379 732e 7374 6465 7272   file=sys.stderr
+0003c7d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003c7e0: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+0003c7f0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+0003c800: 636b 2069 6620 7468 6520 7573 6572 2070  ck if the user p
+0003c810: 726f 7669 6465 6420 7468 6520 7065 726d  rovided the perm
+0003c820: 6973 7369 6f6e 7320 6172 6775 6d65 6e74  issions argument
+0003c830: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003c840: 7365 6c66 2e61 7267 732e 7065 726d 6973  self.args.permis
+0003c850: 7369 6f6e 733a 0a20 2020 2020 2020 2020  sions:.         
+0003c860: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0003c870: 6c66 2e61 7267 732e 666f 6c64 6572 733a  lf.args.folders:
+0003c880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c890: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0003c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c8b0: 2020 2020 275c 6e45 7272 6f72 3a20 466f      '\nError: Fo
+0003c8c0: 6c64 6572 206e 6f74 2070 726f 7669 6465  lder not provide
+0003c8d0: 642e 2043 6865 636b 2074 6865 2061 7263  d. Check the arc
+0003c8e0: 6869 7665 2063 6f6d 6d61 6e64 2075 7361  hive command usa
+0003c8f0: 6765 2077 6974 6820 2266 726f 7374 6572  ge with "froster
+0003c900: 2061 7263 6869 7665 202d 2d68 656c 7022   archive --help"
+0003c910: 5c6e 272c 2066 696c 653d 7379 732e 7374  \n', file=sys.st
+0003c920: 6465 7272 290a 2020 2020 2020 2020 2020  derr).          
+0003c930: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0003c940: 6974 2831 290a 0a20 2020 2020 2020 2020  it(1)..         
+0003c950: 2020 2020 2020 2023 2050 7269 6e74 2074         # Print t
+0003c960: 6865 2070 6572 6d69 7373 696f 6e73 206f  he permissions o
+0003c970: 6620 7468 6520 7072 6f76 6964 6564 2066  f the provided f
+0003c980: 6f6c 6465 7273 0a20 2020 2020 2020 2020  olders.         
+0003c990: 2020 2020 2020 2061 7263 682e 7072 696e         arch.prin
+0003c9a0: 745f 7061 7468 735f 7277 5f69 6e66 6f28  t_paths_rw_info(
+0003c9b0: 7365 6c66 2e61 7267 732e 666f 6c64 6572  self.args.folder
+0003c9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003c9d0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0003c9e0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+0003c9f0: 2074 6865 2075 7365 7220 7072 6f76 6964   the user provid
+0003ca00: 6564 2074 6865 2072 6573 6574 2061 7267  ed the reset arg
+0003ca10: 756d 656e 740a 2020 2020 2020 2020 2020  ument.          
+0003ca20: 2020 6966 2073 656c 662e 6172 6773 2e72    if self.args.r
+0003ca30: 6573 6574 3a0a 2020 2020 2020 2020 2020  eset:.          
+0003ca40: 2020 2020 2020 666f 7220 666f 6c64 6572        for folder
+0003ca50: 2069 6e20 7365 6c66 2e61 7267 732e 666f   in self.args.fo
+0003ca60: 6c64 6572 733a 0a20 2020 2020 2020 2020  lders:.         
+0003ca70: 2020 2020 2020 2020 2020 2061 7263 682e             arch.
+0003ca80: 7265 7365 745f 666f 6c64 6572 2866 6f6c  reset_folder(fol
+0003ca90: 6465 722c 2073 656c 662e 6172 6773 2e72  der, self.args.r
+0003caa0: 6563 7572 7369 7665 290a 2020 2020 2020  ecursive).      
+0003cab0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0003cac0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0003cad0: 4368 6563 6b20 6966 2074 6865 2075 7365  Check if the use
+0003cae0: 7220 7072 6f76 6964 6564 2074 6865 2068  r provided the h
+0003caf0: 6f74 7370 6f74 7320 6172 6775 6d65 6e74  otspots argument
+0003cb00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003cb10: 7365 6c66 2e61 7267 732e 686f 7473 706f  self.args.hotspo
+0003cb20: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0003cb30: 2020 2020 6966 2073 656c 662e 6172 6773      if self.args
+0003cb40: 2e66 6f6c 6465 7273 3a0a 2020 2020 2020  .folders:.      
+0003cb50: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003cb60: 696e 7428 275c 6e45 7272 6f72 3a20 496e  int('\nError: In
+0003cb70: 636f 7272 6563 7420 2266 726f 7374 6572  correct "froster
+0003cb80: 2061 7263 6869 7665 2220 7573 6167 652e   archive" usage.
+0003cb90: 2043 686f 6f73 6520 6265 7477 6565 6e3a   Choose between:
+0003cba0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0003cbb0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+0003cbc0: 2020 5573 696e 6720 2d2d 686f 7473 706f    Using --hotspo
+0003cbd0: 7473 2066 6c61 6720 746f 2073 656c 6563  ts flag to selec
+0003cbe0: 7420 686f 7473 706f 7473 2729 0a20 2020  t hotspots').   
+0003cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cc00: 2070 7269 6e74 2827 2020 2020 5072 6f76   print('    Prov
+0003cc10: 6964 6520 666f 6c64 6572 2873 2920 746f  ide folder(s) to
+0003cc20: 2061 7263 6869 7665 5c6e 2729 0a20 2020   archive\n').   
+0003cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cc40: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
+0003cc50: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0003cc60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003cc70: 2020 2020 2020 2020 6172 6368 2e61 7263          arch.arc
+0003cc80: 6869 7665 5f73 656c 6563 745f 686f 7473  hive_select_hots
+0003cc90: 706f 7473 2829 0a20 2020 2020 2020 2020  pots().         
+0003cca0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003ccb0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003ccc0: 7365 6c66 2e61 7267 732e 666f 6c64 6572  self.args.folder
+0003ccd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003cce0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0003ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cd00: 2020 2020 2020 275c 6e45 7272 6f72 3a20        '\nError: 
+0003cd10: 466f 6c64 6572 206e 6f74 2070 726f 7669  Folder not provi
+0003cd20: 6465 642e 2043 6865 636b 2074 6865 2061  ded. Check the a
+0003cd30: 7263 6869 7665 2063 6f6d 6d61 6e64 2075  rchive command u
+0003cd40: 7361 6765 2077 6974 6820 2266 726f 7374  sage with "frost
+0003cd50: 6572 2061 7263 6869 7665 202d 2d68 656c  er archive --hel
+0003cd60: 7022 5c6e 2729 0a20 2020 2020 2020 2020  p"\n').         
+0003cd70: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0003cd80: 7869 7428 3129 0a0a 2020 2020 2020 2020  xit(1)..        
+0003cd90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cdb0: 2020 2320 4172 6368 6976 6520 7468 6520    # Archive the 
+0003cdc0: 6769 7665 6e20 666f 6c64 6572 730a 2020  given folders.  
+0003cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cde0: 2020 6172 6368 2e61 7263 6869 7665 2873    arch.archive(s
+0003cdf0: 656c 662e 6172 6773 2e66 6f6c 6465 7273  elf.args.folders
+0003ce00: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+0003ce10: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0003ce20: 696e 745f 6572 726f 7228 290a 0a20 2020  int_error()..   
+0003ce30: 2064 6566 2073 7562 636d 645f 7265 7374   def subcmd_rest
+0003ce40: 6f72 6528 7365 6c66 2c20 6172 6368 3a20  ore(self, arch: 
+0003ce50: 4172 6368 6976 6572 2c20 6177 733a 2041  Archiver, aws: A
+0003ce60: 5753 426f 746f 293a 0a20 2020 2020 2020  WSBoto):.       
+0003ce70: 2027 2727 4368 6563 6b20 636f 6d6d 616e   '''Check comman
+0003ce80: 6420 666f 7220 7265 7374 6f72 696e 6720  d for restoring 
+0003ce90: 666f 6c64 6572 7320 666f 7220 4672 6f73  folders for Fros
+0003cea0: 7465 722e 2727 270a 0a20 2020 2020 2020  ter.'''..       
+0003ceb0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0003cec0: 2020 6966 2073 656c 662e 6172 6773 2e6d    if self.args.m
+0003ced0: 6f6e 6974 6f72 3a0a 2020 2020 2020 2020  onitor:.        
+0003cee0: 2020 2020 2020 2020 2320 6177 7320 696e          # aws in
+0003cef0: 6163 7469 7669 7479 2061 6e64 2063 6f73  activity and cos
+0003cf00: 7420 6d6f 6e69 746f 7269 6e67 0a20 2020  t monitoring.   
+0003cf10: 2020 2020 2020 2020 2020 2020 2061 7773               aws
+0003cf20: 2e6d 6f6e 6974 6f72 5f65 6332 2829 0a20  .monitor_ec2(). 
+0003cf30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0003cf40: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
+0003cf50: 2020 2069 6620 6e6f 7420 7365 6c66 2e61     if not self.a
+0003cf60: 7267 732e 666f 6c64 6572 733a 0a0a 2020  rgs.folders:..  
+0003cf70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0003cf80: 4765 7420 7468 6520 6c69 7374 206f 6620  Get the list of 
+0003cf90: 666f 6c64 6572 7320 6672 6f6d 2074 6865  folders from the
+0003cfa0: 2061 7263 6869 7665 0a20 2020 2020 2020   archive.       
+0003cfb0: 2020 2020 2020 2020 2066 696c 6573 203d           files =
+0003cfc0: 2061 7263 682e 6172 6368 6976 655f 6a73   arch.archive_js
+0003cfd0: 6f6e 5f67 6574 5f63 7376 280a 2020 2020  on_get_csv(.    
+0003cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cff0: 5b27 6c6f 6361 6c5f 666f 6c64 6572 272c  ['local_folder',
+0003d000: 2027 7333 5f73 746f 7261 6765 5f63 6c61   's3_storage_cla
+0003d010: 7373 272c 2027 7072 6f66 696c 6527 2c20  ss', 'profile', 
+0003d020: 2761 7263 6869 7665 5f6d 6f64 6527 5d29  'archive_mode'])
+0003d030: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003d040: 2020 6966 206e 6f74 2066 696c 6573 3a0a    if not files:.
+0003d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d060: 2020 2020 7072 696e 7428 224e 6f20 6172      print("No ar
+0003d070: 6368 6976 6573 2061 7661 696c 6162 6c65  chives available
+0003d080: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0003d090: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0003d0a0: 2830 290a 0a20 2020 2020 2020 2020 2020  (0)..           
+0003d0b0: 2020 2020 2061 7070 203d 2054 6162 6c65       app = Table
+0003d0c0: 4172 6368 6976 6528 6669 6c65 7329 0a20  Archive(files). 
+0003d0d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0003d0e0: 6574 6c69 6e65 203d 2061 7070 2e72 756e  etline = app.run
+0003d0f0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0003d100: 2020 2020 6966 206e 6f74 2072 6574 6c69      if not retli
+0003d110: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0003d120: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0003d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d140: 6966 206c 656e 2872 6574 6c69 6e65 2920  if len(retline) 
+0003d150: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
+0003d160: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0003d170: 275c 6e4e 6f20 6172 6368 6976 6564 2066  '\nNo archived f
+0003d180: 6f6c 6465 7273 2066 6f75 6e64 5c6e 2729  olders found\n')
+0003d190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d1a0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0003d1b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003d1c0: 662e 6172 6773 2e66 6f6c 6465 7273 203d  f.args.folders =
+0003d1d0: 205b 7265 746c 696e 655b 305d 5d0a 0a20   [retline[0]].. 
+0003d1e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003d1f0: 2041 7070 656e 6420 7468 6520 666f 6c64   Append the fold
+0003d200: 6572 2066 6f72 2072 6573 746f 7269 6e67  er for restoring
+0003d210: 2074 6f20 7468 6520 6172 6775 6d65 6e74   to the argument
+0003d220: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0003d230: 2020 7379 732e 6172 6776 2e61 7070 656e    sys.argv.appen
+0003d240: 6428 7365 6c66 2e61 7267 732e 666f 6c64  d(self.args.fold
+0003d250: 6572 735b 305d 290a 0a20 2020 2020 2020  ers[0])..       
+0003d260: 2020 2020 2061 7263 682e 7265 7374 6f72       arch.restor
+0003d270: 6528 7365 6c66 2e61 7267 732e 666f 6c64  e(self.args.fold
+0003d280: 6572 732c 2061 7773 290a 0a20 2020 2020  ers, aws)..     
+0003d290: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0003d2a0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0003d2b0: 2070 7269 6e74 5f65 7272 6f72 2829 0a0a   print_error()..
+0003d2c0: 2020 2020 6465 6620 7375 6263 6d64 5f64      def subcmd_d
+0003d2d0: 656c 6574 6528 7365 6c66 2c20 6172 6368  elete(self, arch
+0003d2e0: 3a20 4172 6368 6976 6572 293a 0a20 2020  : Archiver):.   
+0003d2f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0003d300: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0003d310: 662e 6172 6773 2e66 6f6c 6465 7273 3a0a  f.args.folders:.
+0003d320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d330: 2023 2047 6574 2074 6865 206c 6973 7420   # Get the list 
+0003d340: 6f66 2066 6f6c 6465 7273 2066 726f 6d20  of folders from 
+0003d350: 7468 6520 6172 6368 6976 650a 2020 2020  the archive.    
+0003d360: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0003d370: 7320 3d20 6172 6368 2e61 7263 6869 7665  s = arch.archive
+0003d380: 5f6a 736f 6e5f 6765 745f 6373 7628 0a20  _json_get_csv(. 
+0003d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d3a0: 2020 205b 276c 6f63 616c 5f66 6f6c 6465     ['local_folde
+0003d3b0: 7227 2c20 2773 335f 7374 6f72 6167 655f  r', 's3_storage_
+0003d3c0: 636c 6173 7327 2c20 2770 726f 6669 6c65  class', 'profile
+0003d3d0: 275d 290a 0a20 2020 2020 2020 2020 2020  '])..           
+0003d3e0: 2020 2020 2069 6620 6e6f 7420 6669 6c65       if not file
+0003d3f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003d400: 2020 2020 2020 2070 7269 6e74 2822 4e6f         print("No
+0003d410: 2061 7263 6869 7665 7320 6176 6169 6c61   archives availa
+0003d420: 626c 652e 2229 0a20 2020 2020 2020 2020  ble.").         
+0003d430: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0003d440: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+0003d450: 2020 2061 7070 203d 2054 6162 6c65 4172     app = TableAr
+0003d460: 6368 6976 6528 6669 6c65 7329 0a20 2020  chive(files).   
+0003d470: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0003d480: 6c69 6e65 203d 2061 7070 2e72 756e 2829  line = app.run()
+0003d490: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003d4a0: 2020 6966 206e 6f74 2072 6574 6c69 6e65    if not retline
+0003d4b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003d4c0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0003d4d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003d4e0: 206c 656e 2872 6574 6c69 6e65 2920 3c20   len(retline) < 
+0003d4f0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+0003d500: 2020 2020 2020 2070 7269 6e74 2866 275c         print(f'\
+0003d510: 6e4e 6f20 6172 6368 6976 6564 2066 6f6c  nNo archived fol
+0003d520: 6465 7273 2066 6f75 6e64 5c6e 2729 0a20  ders found\n'). 
+0003d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d540: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0003d550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003d560: 6172 6773 2e66 6f6c 6465 7273 203d 205b  args.folders = [
+0003d570: 7265 746c 696e 655b 305d 5d0a 0a20 2020  retline[0]]..   
+0003d580: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+0003d590: 7070 656e 6420 7468 6520 666f 6c64 6572  ppend the folder
+0003d5a0: 2074 6f20 6465 6c65 7465 2074 6f20 7468   to delete to th
+0003d5b0: 6520 6172 6775 6d65 6e74 730a 2020 2020  e arguments.    
+0003d5c0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0003d5d0: 6172 6776 2e61 7070 656e 6428 7365 6c66  argv.append(self
+0003d5e0: 2e61 7267 732e 666f 6c64 6572 735b 305d  .args.folders[0]
+0003d5f0: 290a 0a20 2020 2020 2020 2020 2020 2061  )..            a
+0003d600: 7263 682e 6465 6c65 7465 2873 656c 662e  rch.delete(self.
+0003d610: 6172 6773 2e66 6f6c 6465 7273 290a 0a20  args.folders).. 
+0003d620: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0003d630: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+0003d640: 2020 2020 2070 7269 6e74 5f65 7272 6f72       print_error
+0003d650: 2829 0a0a 2020 2020 6465 6620 7375 6263  ()..    def subc
+0003d660: 6d64 5f6d 6f75 6e74 2873 656c 662c 2061  md_mount(self, a
+0003d670: 7263 683a 2041 7263 6869 7665 7229 3a0a  rch: Archiver):.
+0003d680: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0003d690: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0003d6a0: 662e 6172 6773 2e6c 6973 743a 0a20 2020  f.args.list:.   
+0003d6b0: 2020 2020 2020 2020 2020 2020 2061 7263               arc
+0003d6c0: 682e 7072 696e 745f 6375 7272 656e 745f  h.print_current_
+0003d6d0: 6d6f 756e 7473 2829 0a20 2020 2020 2020  mounts().       
+0003d6e0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0003d6f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003d700: 7365 6c66 2e61 7267 732e 6d6f 756e 7470  self.args.mountp
+0003d710: 6f69 6e74 3a0a 2020 2020 2020 2020 2020  oint:.          
+0003d720: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+0003d730: 7061 7468 2e69 7364 6972 2873 656c 662e  path.isdir(self.
+0003d740: 6172 6773 2e6d 6f75 6e74 706f 696e 7429  args.mountpoint)
+0003d750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003d760: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0003d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d780: 2020 2020 2066 275c 6e45 7272 6f72 3a20       f'\nError: 
+0003d790: 466f 6c64 6572 2022 7b73 656c 662e 6172  Folder "{self.ar
+0003d7a0: 6773 2e6d 6f75 6e74 706f 696e 747d 2220  gs.mountpoint}" 
+0003d7b0: 646f 6573 206e 6f74 2065 7869 7374 2e5c  does not exist.\
+0003d7c0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0003d7d0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0003d7e0: 2831 290a 0a20 2020 2020 2020 2020 2020  (1)..           
+0003d7f0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+0003d800: 2e61 7267 732e 666f 6c64 6572 7329 203e  .args.folders) >
+0003d810: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0003d820: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+0003d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d840: 2020 2020 2020 2027 5c6e 4572 726f 723a         '\nError:
+0003d850: 2043 616e 6e6f 7420 6d6f 756e 7420 6d75   Cannot mount mu
+0003d860: 6c74 6970 6c65 2066 6f6c 6465 7273 2074  ltiple folders t
+0003d870: 6f20 6120 7369 6e67 6c65 206d 6f75 6e74  o a single mount
+0003d880: 706f 696e 742e 2729 0a20 2020 2020 2020  point.').       
+0003d890: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0003d8a0: 6e74 2827 4368 6563 6b20 7468 6520 6d6f  nt('Check the mo
+0003d8b0: 756e 7420 636f 6d6d 616e 6420 7573 6167  unt command usag
+0003d8c0: 6520 7769 7468 2022 6672 6f73 7465 7220  e with "froster 
+0003d8d0: 6d6f 756e 7420 2d2d 6865 6c70 225c 6e27  mount --help"\n'
+0003d8e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003d8f0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+0003d900: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0003d910: 6620 6e6f 7420 7365 6c66 2e61 7267 732e  f not self.args.
+0003d920: 666f 6c64 6572 733a 0a20 2020 2020 2020  folders:.       
+0003d930: 2020 2020 2020 2020 2023 2047 6574 2074           # Get t
+0003d940: 6865 206c 6973 7420 6f66 2066 6f6c 6465  he list of folde
+0003d950: 7273 2066 726f 6d20 7468 6520 6172 6368  rs from the arch
+0003d960: 6976 650a 2020 2020 2020 2020 2020 2020  ive.            
+0003d970: 2020 2020 6669 6c65 7320 3d20 6172 6368      files = arch
+0003d980: 2e61 7263 6869 7665 5f6a 736f 6e5f 6765  .archive_json_ge
+0003d990: 745f 6373 7628 0a20 2020 2020 2020 2020  t_csv(.         
+0003d9a0: 2020 2020 2020 2020 2020 205b 276c 6f63             ['loc
+0003d9b0: 616c 5f66 6f6c 6465 7227 2c20 2773 335f  al_folder', 's3_
+0003d9c0: 7374 6f72 6167 655f 636c 6173 7327 2c20  storage_class', 
+0003d9d0: 2770 726f 6669 6c65 272c 2027 6172 6368  'profile', 'arch
+0003d9e0: 6976 655f 6d6f 6465 275d 290a 0a20 2020  ive_mode'])..   
+0003d9f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003da00: 6e6f 7420 6669 6c65 733a 0a20 2020 2020  not files:.     
+0003da10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0003da20: 7269 6e74 2822 5c6e 4e6f 2061 7263 6869  rint("\nNo archi
+0003da30: 7665 7320 6176 6169 6c61 626c 652e 5c6e  ves available.\n
+0003da40: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0003da50: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+0003da60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0003da70: 7070 203d 2054 6162 6c65 4172 6368 6976  pp = TableArchiv
+0003da80: 6528 6669 6c65 7329 0a20 2020 2020 2020  e(files).       
+0003da90: 2020 2020 2020 2020 2072 6574 6c69 6e65           retline
+0003daa0: 203d 2061 7070 2e72 756e 2829 0a0a 2020   = app.run()..  
+0003dab0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003dac0: 206e 6f74 2072 6574 6c69 6e65 3a0a 2020   not retline:.  
+0003dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dae0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0003daf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003db00: 6620 6c65 6e28 7265 746c 696e 6529 203c  f len(retline) <
+0003db10: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0003db20: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
+0003db30: 5c6e 4e6f 2061 7263 6869 7665 6420 666f  \nNo archived fo
+0003db40: 6c64 6572 7320 666f 756e 645c 6e27 290a  lders found\n').
+0003db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003db60: 2020 2020 7379 732e 6578 6974 2830 290a      sys.exit(0).
+0003db70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003db80: 2073 656c 662e 6172 6773 2e66 6f6c 6465   self.args.folde
+0003db90: 7273 203d 205b 7265 746c 696e 655b 305d  rs = [retline[0]
+0003dba0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+0003dbb0: 2054 4f44 4f3a 204d 6f75 6e74 2069 6e20   TODO: Mount in 
+0003dbc0: 4157 5320 4543 3220 696e 7374 616e 6365  AWS EC2 instance
+0003dbd0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+0003dbe0: 6620 7365 6c66 2e61 7267 732e 6177 733a  f self.args.aws:
+0003dbf0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0003dc00: 2020 2063 6667 2e63 7265 6174 655f 6563     cfg.create_ec
+0003dc10: 325f 696e 7374 616e 6365 2829 0a20 2020  2_instance().   
+0003dc20: 2020 2020 2020 2020 2023 2020 2020 2072           #     r
+0003dc30: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+0003dc40: 2020 2020 2020 2020 6172 6368 2e6d 6f75          arch.mou
+0003dc50: 6e74 2866 6f6c 6465 7273 3d73 656c 662e  nt(folders=self.
+0003dc60: 6172 6773 2e66 6f6c 6465 7273 2c0a 2020  args.folders,.  
+0003dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dc80: 2020 2020 206d 6f75 6e74 706f 696e 743d       mountpoint=
+0003dc90: 7365 6c66 2e61 7267 732e 6d6f 756e 7470  self.args.mountp
+0003dca0: 6f69 6e74 290a 0a20 2020 2020 2020 2065  oint)..        e
+0003dcb0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+0003dcc0: 2020 2070 7269 6e74 5f65 7272 6f72 2829     print_error()
+0003dcd0: 0a0a 2020 2020 6465 6620 7375 6263 6d64  ..    def subcmd
+0003dce0: 5f75 6d6f 756e 7428 7365 6c66 2c20 6172  _umount(self, ar
+0003dcf0: 6368 3a20 4172 6368 6976 6572 293a 0a0a  ch: Archiver):..
+0003dd00: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0003dd10: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0003dd20: 2e61 7267 732e 6c69 7374 3a0a 2020 2020  .args.list:.    
+0003dd30: 2020 2020 2020 2020 2020 2020 6172 6368              arch
+0003dd40: 2e70 7269 6e74 5f63 7572 7265 6e74 5f6d  .print_current_m
+0003dd50: 6f75 6e74 7328 290a 2020 2020 2020 2020  ounts().        
+0003dd60: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0003dd70: 2830 290a 0a20 2020 2020 2020 2020 2020  (0)..           
+0003dd80: 2023 2047 6574 2063 7572 7265 6e74 206d   # Get current m
+0003dd90: 6f75 6e74 730a 2020 2020 2020 2020 2020  ounts.          
+0003dda0: 2020 6d6f 756e 7473 203d 2061 7263 682e    mounts = arch.
+0003ddb0: 6765 745f 6d6f 756e 7473 2829 0a20 2020  get_mounts().   
+0003ddc0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0003ddd0: 6d6f 756e 7473 2920 3d3d 2030 3a0a 2020  mounts) == 0:.  
+0003dde0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003ddf0: 696e 7428 225c 6e4e 4f54 453a 204e 6f20  int("\nNOTE: No 
+0003de00: 7263 6c6f 6e65 206d 6f75 6e74 7320 6f6e  rclone mounts on
+0003de10: 2074 6869 7320 636f 6d70 7574 6572 2e5c   this computer.\
+0003de20: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+0003de30: 2020 2020 7379 732e 6578 6974 2830 290a      sys.exit(0).
+0003de40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003de50: 6e6f 7420 7365 6c66 2e61 7267 732e 666f  not self.args.fo
+0003de60: 6c64 6572 733a 0a20 2020 2020 2020 2020  lders:.         
+0003de70: 2020 2020 2020 2023 204e 6f20 666f 6c64         # No fold
+0003de80: 6572 7320 7072 6f76 6964 6564 2c20 6d61  ers provided, ma
+0003de90: 6e75 616c 6c79 2073 656c 6563 7420 666f  nually select fo
+0003dea0: 6c64 6572 2074 6f20 756e 6d6f 756e 740a  lder to unmount.
+0003deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dec0: 6669 6c65 7320 3d20 225c 6e22 2e6a 6f69  files = "\n".joi
+0003ded0: 6e28 6d6f 756e 7473 290a 2020 2020 2020  n(mounts).      
+0003dee0: 2020 2020 2020 2020 2020 6669 6c65 7320            files 
+0003def0: 3d20 224d 6f75 6e74 706f 696e 745c 6e22  = "Mountpoint\n"
+0003df00: 202b 2066 696c 6573 0a0a 2020 2020 2020   + files..      
+0003df10: 2020 2020 2020 2020 2020 6170 7020 3d20            app = 
+0003df20: 5461 626c 6541 7263 6869 7665 2866 696c  TableArchive(fil
+0003df30: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0003df40: 2020 2020 7265 746c 696e 6520 3d20 6170      retline = ap
+0003df50: 702e 7275 6e28 290a 0a20 2020 2020 2020  p.run()..       
+0003df60: 2020 2020 2020 2020 2073 656c 662e 6172           self.ar
+0003df70: 6773 2e66 6f6c 6465 7273 203d 205b 7265  gs.folders = [re
+0003df80: 746c 696e 655b 305d 5d0a 0a20 2020 2020  tline[0]]..     
+0003df90: 2020 2020 2020 2061 7263 682e 756e 6d6f         arch.unmo
+0003dfa0: 756e 7428 7365 6c66 2e61 7267 732e 666f  unt(self.args.fo
+0003dfb0: 6c64 6572 7329 0a0a 2020 2020 2020 2020  lders)..        
+0003dfc0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0003dfd0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0003dfe0: 696e 745f 6572 726f 7228 290a 0a20 2020  int_error()..   
+0003dff0: 2064 6566 2073 7562 636d 645f 7373 6828   def subcmd_ssh(
+0003e000: 7365 6c66 2c20 6366 673a 2043 6f6e 6669  self, cfg: Confi
+0003e010: 674d 616e 6167 6572 2c20 6177 733a 2041  gManager, aws: A
+0003e020: 5753 426f 746f 293a 0a0a 2020 2020 2020  WSBoto):..      
+0003e030: 2020 696c 6973 7420 3d20 6177 732e 6563    ilist = aws.ec
+0003e040: 325f 6c69 7374 5f69 6e73 7461 6e63 6573  2_list_instances
+0003e050: 2827 4e61 6d65 272c 2027 4672 6f73 7465  ('Name', 'Froste
+0003e060: 7253 656c 6644 6573 7472 7563 7427 290a  rSelfDestruct').
+0003e070: 2020 2020 2020 2020 6970 7320 3d20 5b73          ips = [s
+0003e080: 7562 6c69 7374 5b30 5d20 666f 7220 7375  ublist[0] for su
+0003e090: 626c 6973 7420 696e 2069 6c69 7374 2069  blist in ilist i
+0003e0a0: 6620 7375 626c 6973 745d 0a20 2020 2020  f sublist].     
+0003e0b0: 2020 2069 6620 7365 6c66 2e61 7267 732e     if self.args.
+0003e0c0: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
+0003e0d0: 2020 6966 2069 7073 3a0a 2020 2020 2020    if ips:.      
+0003e0e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0003e0f0: 2252 756e 6e69 6e67 2041 5753 2045 4332  "Running AWS EC2
+0003e100: 2049 6e73 7461 6e63 6573 3a22 290a 2020   Instances:").  
+0003e110: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0003e120: 7220 726f 7720 696e 2069 6c69 7374 3a0a  r row in ilist:.
 0003e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e140: 2020 2020 2020 6d65 7461 7661 723d 273c        metavar='<
-0003e150: 686f 7374 6e61 6d65 3e27 2c20 6865 6c70  hostname>', help
-0003e160: 3d27 5465 726d 696e 6174 6520 4157 5320  ='Terminate AWS 
-0003e170: 4543 3220 696e 7374 616e 6365 2077 6974  EC2 instance wit
-0003e180: 6820 7468 6973 2070 7562 6c69 6320 4950  h this public IP
-0003e190: 2041 6464 7265 7373 2e27 290a 2020 2020   Address.').    
-0003e1a0: 7061 7273 6572 5f73 7368 2e61 6464 5f61  parser_ssh.add_a
-0003e1b0: 7267 756d 656e 7428 2773 7368 6172 6773  rgument('sshargs
-0003e1c0: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-0003e1d0: 272c 2064 6566 6175 6c74 3d5b 5d2c 206e  ', default=[], n
-0003e1e0: 6172 6773 3d27 2a27 2c0a 2020 2020 2020  args='*',.      
-0003e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e200: 2020 2020 2020 6865 6c70 3d27 6d75 6c74        help='mult
-0003e210: 6970 6c65 2061 7267 756d 656e 7473 2074  iple arguments t
-0003e220: 6f20 7373 682f 7363 7020 7375 6368 2061  o ssh/scp such a
-0003e230: 7320 686f 7374 6e61 6d65 206f 7220 7573  s hostname or us
-0003e240: 6572 4068 6f73 746e 616d 6520 6f64 6572  er@hostname oder
-0003e250: 2066 6f6c 6465 7227 202b 0a20 2020 2020   folder' +.     
-0003e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e270: 2020 2020 2020 2027 2729 0a0a 2020 2020         '')..    
-0003e280: 7265 7475 726e 2070 6172 7365 720a 0a23  return parser..#
-0003e290: 2054 4f44 4f3a 204f 4853 552d 3130 333a   TODO: OHSU-103:
-0003e2a0: 204d 6f76 6520 7468 6973 2066 756e 6374   Move this funct
-0003e2b0: 696f 6e20 746f 2075 7469 6c73 206d 6f64  ion to utils mod
-0003e2c0: 756c 650a 2320 544f 444f 3a20 4f48 5355  ule.# TODO: OHSU
-0003e2d0: 2d39 363a 2054 6f20 6265 2063 6861 6e67  -96: To be chang
-0003e2e0: 6564 2066 6f72 2061 206c 6f67 6765 720a  ed for a logger.
-0003e2f0: 0a0a 6465 6620 7072 696e 7464 6267 282a  ..def printdbg(*
-0003e300: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-0003e310: 0a20 2020 2069 6620 6973 5f64 6562 7567  .    if is_debug
-0003e320: 3a0a 2020 2020 2020 2020 6375 7272 656e  :.        curren
-0003e330: 745f 6672 616d 6520 3d20 696e 7370 6563  t_frame = inspec
-0003e340: 742e 6375 7272 656e 7466 7261 6d65 2829  t.currentframe()
-0003e350: 0a20 2020 2020 2020 2063 616c 6c69 6e67  .        calling
-0003e360: 5f66 756e 6374 696f 6e20 3d20 6375 7272  _function = curr
-0003e370: 656e 745f 6672 616d 652e 665f 6261 636b  ent_frame.f_back
-0003e380: 2e66 5f63 6f64 652e 636f 5f6e 616d 650a  .f_code.co_name.
-0003e390: 2020 2020 2020 2020 7072 696e 7428 6627          print(f'
-0003e3a0: 2044 4247 207b 6361 6c6c 696e 675f 6675   DBG {calling_fu
-0003e3b0: 6e63 7469 6f6e 7d28 293a 272c 2061 7267  nction}():', arg
-0003e3c0: 732c 206b 7761 7267 7329 0a0a 2320 544f  s, kwargs)..# TO
-0003e3d0: 444f 3a20 4f48 5355 2d31 3033 3a20 4d6f  DO: OHSU-103: Mo
-0003e3e0: 7665 2074 6869 7320 6675 6e63 7469 6f6e  ve this function
-0003e3f0: 2074 6f20 7574 696c 7320 6d6f 6475 6c65   to utils module
-0003e400: 0a0a 0a64 6566 2063 6c65 616e 5f70 6174  ...def clean_pat
-0003e410: 6873 2870 6174 6873 293a 0a20 2020 2027  hs(paths):.    '
-0003e420: 2727 436c 6561 6e20 7061 7468 7320 6279  ''Clean paths by
-0003e430: 2065 7870 616e 6469 6e67 2075 7365 7220   expanding user 
-0003e440: 616e 6420 7379 6d6c 696e 6b73 2c20 616e  and symlinks, an
-0003e450: 6420 7265 6d6f 7669 6e67 2074 7261 696c  d removing trail
-0003e460: 696e 6720 736c 6173 6865 732e 2727 270a  ing slashes.'''.
-0003e470: 0a20 2020 2069 6620 6e6f 7420 7061 7468  .    if not path
-0003e480: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
-0003e490: 6e20 5b5d 0a0a 2020 2020 636c 6561 6e65  n []..    cleane
-0003e4a0: 645f 7061 7468 7320 3d20 5b5d 0a0a 2020  d_paths = []..  
-0003e4b0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
-0003e4c0: 7468 733a 0a20 2020 2020 2020 2074 7279  ths:.        try
-0003e4d0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0003e4e0: 5370 6c69 7420 7468 6520 7061 7468 2069  Split the path i
-0003e4f0: 6e74 6f20 6974 7320 636f 6d70 6f6e 656e  nto its componen
-0003e500: 7473 0a20 2020 2020 2020 2020 2020 2063  ts.            c
-0003e510: 6c65 616e 6564 5f70 6174 6873 2e61 7070  leaned_paths.app
-0003e520: 656e 6428 6f73 2e70 6174 682e 7265 616c  end(os.path.real
-0003e530: 7061 7468 286f 732e 7061 7468 2e65 7870  path(os.path.exp
-0003e540: 616e 6475 7365 7228 7061 7468 292e 7273  anduser(path).rs
-0003e550: 7472 6970 286f 732e 7061 7468 2e73 6570  trip(os.path.sep
-0003e560: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0003e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e580: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
-0003e590: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0003e5a0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0003e5b0: 2070 7269 6e74 2866 2245 7272 6f72 2070   print(f"Error p
-0003e5c0: 726f 6365 7373 696e 6720 277b 7061 7468  rocessing '{path
-0003e5d0: 7d27 3a20 7b65 7d22 2c20 6669 6c65 3d73  }': {e}", file=s
-0003e5e0: 7973 2e73 7464 6572 7229 0a0a 2020 2020  ys.stderr)..    
-0003e5f0: 7265 7475 726e 2063 6c65 616e 6564 5f70  return cleaned_p
-0003e600: 6174 6873 0a0a 0a64 6566 2070 7269 6e74  aths...def print
-0003e610: 5f65 7272 6f72 2829 3a0a 2020 2020 6578  _error():.    ex
-0003e620: 635f 7479 7065 2c20 6578 635f 7661 6c75  c_type, exc_valu
-0003e630: 652c 2065 7863 5f74 6220 3d20 7379 732e  e, exc_tb = sys.
-0003e640: 6578 635f 696e 666f 2829 0a20 2020 2074  exc_info().    t
-0003e650: 7261 6365 6261 636b 5f64 6574 6169 6c73  raceback_details
-0003e660: 203d 2074 7261 6365 6261 636b 2e65 7874   = traceback.ext
-0003e670: 7261 6374 5f74 6228 6578 635f 7462 290a  ract_tb(exc_tb).
-0003e680: 0a20 2020 2023 2047 6574 2074 6865 206c  .    # Get the l
-0003e690: 6173 7420 6361 6c6c 2073 7461 636b 2e20  ast call stack. 
-0003e6a0: 5468 6520 7468 6972 6420 656c 656d 656e  The third elemen
-0003e6b0: 7420 696e 2074 6865 2074 7570 6c65 2069  t in the tuple i
-0003e6c0: 7320 7468 6520 6675 6e63 7469 6f6e 206e  s the function n
-0003e6d0: 616d 650a 2020 2020 6675 6e63 7469 6f6e  ame.    function
-0003e6e0: 5f6e 616d 6520 3d20 7472 6163 6562 6163  _name = tracebac
-0003e6f0: 6b5f 6465 7461 696c 735b 2d31 5d5b 325d  k_details[-1][2]
-0003e700: 0a20 2020 2066 696c 655f 6e61 6d65 203d  .    file_name =
-0003e710: 206f 732e 7061 7468 2e73 706c 6974 2865   os.path.split(e
-0003e720: 7863 5f74 622e 7462 5f66 7261 6d65 2e66  xc_tb.tb_frame.f
-0003e730: 5f63 6f64 652e 636f 5f66 696c 656e 616d  _code.co_filenam
-0003e740: 6529 5b31 5d0a 0a20 2020 2070 7269 6e74  e)[1]..    print
-0003e750: 280a 2020 2020 2020 2020 6627 5c6e 4572  (.        f'\nEr
-0003e760: 726f 723a 2066 696c 6520 7b66 696c 655f  ror: file {file_
-0003e770: 6e61 6d65 7d3a 2066 756e 6374 696f 6e20  name}: function 
-0003e780: 7b66 756e 6374 696f 6e5f 6e61 6d65 7d3a  {function_name}:
-0003e790: 206c 696e 6520 7b65 7863 5f74 622e 7462   line {exc_tb.tb
-0003e7a0: 5f6c 696e 656e 6f7d 3a20 7b65 7863 5f76  _lineno}: {exc_v
-0003e7b0: 616c 7565 7d5c 6e27 2c20 6669 6c65 3d73  alue}\n', file=s
-0003e7c0: 7973 2e73 7464 6572 7229 0a0a 0a64 6566  ys.stderr)...def
-0003e7d0: 206d 6169 6e28 293a 0a0a 2020 2020 6966   main():..    if
-0003e7e0: 206e 6f74 2073 7973 2e70 6c61 7466 6f72   not sys.platfor
-0003e7f0: 6d2e 7374 6172 7473 7769 7468 2827 6c69  m.startswith('li
-0003e800: 6e75 7827 293a 0a20 2020 2020 2020 2070  nux'):.        p
-0003e810: 7269 6e74 2827 4672 6f73 7465 7220 6375  rint('Froster cu
-0003e820: 7272 656e 746c 7920 6f6e 6c79 2072 756e  rrently only run
-0003e830: 7320 6f6e 204c 696e 7578 2078 3634 5c6e  s on Linux x64\n
-0003e840: 2729 0a20 2020 2020 2020 2073 7973 2e65  ').        sys.e
-0003e850: 7869 7428 3129 0a0a 2020 2020 7472 793a  xit(1)..    try:
-0003e860: 0a0a 2020 2020 2020 2020 2320 7061 7273  ..        # pars
-0003e870: 6520 6172 6775 6d65 6e74 7320 7573 696e  e arguments usin
-0003e880: 6720 7079 7468 6f6e 2773 2069 6e74 6572  g python's inter
-0003e890: 6e61 6c20 6d6f 6475 6c65 2061 7267 7061  nal module argpa
-0003e8a0: 7273 652e 7079 0a20 2020 2020 2020 2070  rse.py.        p
-0003e8b0: 6172 7365 7220 3d20 7061 7273 655f 6172  arser = parse_ar
-0003e8c0: 6775 6d65 6e74 7328 290a 2020 2020 2020  guments().      
-0003e8d0: 2020 6172 6773 203d 2070 6172 7365 722e    args = parser.
-0003e8e0: 7061 7273 655f 6172 6773 2829 0a0a 2020  parse_args()..  
-0003e8f0: 2020 2020 2020 2320 544f 444f 3a20 4f48        # TODO: OH
-0003e900: 5355 2d39 363a 2054 6f20 6265 2063 6861  SU-96: To be cha
-0003e910: 6e67 6564 2066 6f72 2061 206c 6f67 6765  nged for a logge
-0003e920: 720a 2020 2020 2020 2020 676c 6f62 616c  r.        global
-0003e930: 2069 735f 6465 6275 670a 2020 2020 2020   is_debug.      
-0003e940: 2020 6973 5f64 6562 7567 203d 2061 7267    is_debug = arg
-0003e950: 732e 6465 6275 670a 0a20 2020 2020 2020  s.debug..       
-0003e960: 2023 2044 6563 6c61 7269 6e67 2076 6172   # Declaring var
-0003e970: 6961 626c 6573 0a20 2020 2020 2020 2054  iables.        T
-0003e980: 4142 4c45 4353 5620 3d20 2727 2020 2320  ABLECSV = ''  # 
-0003e990: 4353 5620 7374 7269 6e67 2066 6f72 2044  CSV string for D
-0003e9a0: 6174 6154 6162 6c65 0a20 2020 2020 2020  ataTable.       
-0003e9b0: 2053 454c 4543 5445 4446 494c 4520 3d20   SELECTEDFILE = 
-0003e9c0: 2727 2020 2320 4353 5620 6669 6c65 6e61  ''  # CSV filena
-0003e9d0: 6d65 2074 6f20 6f70 656e 2069 6e20 686f  me to open in ho
-0003e9e0: 7473 706f 7473 0a20 2020 2020 2020 204d  tspots.        M
-0003e9f0: 4158 484f 5453 504f 5453 203d 2030 0a0a  AXHOTSPOTS = 0..
-0003ea00: 2020 2020 2020 2020 2320 496e 6974 2043          # Init C
-0003ea10: 6f6e 6669 6720 4d61 6e61 6765 720a 2020  onfig Manager.  
-0003ea20: 2020 2020 2020 6366 6720 3d20 436f 6e66        cfg = Conf
-0003ea30: 6967 4d61 6e61 6765 7228 290a 0a20 2020  igManager()..   
-0003ea40: 2020 2020 2023 2049 6e69 7420 4172 6368       # Init Arch
-0003ea50: 6976 6572 0a20 2020 2020 2020 2061 7263  iver.        arc
-0003ea60: 6820 3d20 4172 6368 6976 6572 2861 7267  h = Archiver(arg
-0003ea70: 732c 2063 6667 290a 0a20 2020 2020 2020  s, cfg)..       
-0003ea80: 2023 2049 6e69 7420 4157 5320 426f 746f   # Init AWS Boto
-0003ea90: 0a20 2020 2020 2020 2061 7773 203d 2041  .        aws = A
-0003eaa0: 5753 426f 746f 2861 7267 732c 2063 6667  WSBoto(args, cfg
-0003eab0: 2c20 6172 6368 290a 0a20 2020 2020 2020  , arch)..       
-0003eac0: 2023 2050 7269 6e74 2063 7572 7265 6e74   # Print current
-0003ead0: 2076 6572 7369 6f6e 206f 6620 6672 6f73   version of fros
-0003eae0: 7465 720a 2020 2020 2020 2020 6966 2061  ter.        if a
-0003eaf0: 7267 732e 7665 7273 696f 6e3a 0a20 2020  rgs.version:.   
-0003eb00: 2020 2020 2020 2020 2070 7269 6e74 5f76           print_v
-0003eb10: 6572 7369 6f6e 2829 0a20 2020 2020 2020  ersion().       
-0003eb20: 2020 2020 2073 7973 2e65 7869 7428 3029       sys.exit(0)
-0003eb30: 0a0a 2020 2020 2020 2020 6966 2063 6667  ..        if cfg
-0003eb40: 2e69 735f 7368 6172 6564 2061 6e64 2063  .is_shared and c
-0003eb50: 6667 2e73 6861 7265 645f 6469 723a 0a20  fg.shared_dir:. 
-0003eb60: 2020 2020 2020 2020 2020 2063 6667 2e61             cfg.a
-0003eb70: 7373 7572 655f 7065 726d 6973 7369 6f6e  ssure_permission
-0003eb80: 735f 616e 645f 6772 6f75 7028 6366 672e  s_and_group(cfg.
-0003eb90: 7368 6172 6564 5f64 6972 290a 0a20 2020  shared_dir)..   
-0003eba0: 2020 2020 2023 2063 616c 6c20 6120 6675       # call a fu
-0003ebb0: 6e63 7469 6f6e 2066 6f72 2065 6163 6820  nction for each 
-0003ebc0: 7375 6220 636f 6d6d 616e 6420 696e 206f  sub command in o
-0003ebd0: 7572 2043 4c49 0a20 2020 2020 2020 2069  ur CLI.        i
-0003ebe0: 6620 6172 6773 2e73 7562 636d 6420 696e  f args.subcmd in
-0003ebf0: 205b 2763 6f6e 6669 6727 2c20 2763 6e66   ['config', 'cnf
-0003ec00: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0003ec10: 7375 6263 6d64 5f63 6f6e 6669 6728 6172  subcmd_config(ar
-0003ec20: 6773 2c20 6366 672c 2061 7773 290a 2020  gs, cfg, aws).  
-0003ec30: 2020 2020 2020 656c 6966 2061 7267 732e        elif args.
-0003ec40: 7375 6263 6d64 2069 6e20 5b27 696e 6465  subcmd in ['inde
-0003ec50: 7827 2c20 2769 6e64 275d 3a0a 2020 2020  x', 'ind']:.    
-0003ec60: 2020 2020 2020 2020 7375 6263 6d64 5f69          subcmd_i
-0003ec70: 6e64 6578 2861 7267 732c 2063 6667 2c20  ndex(args, cfg, 
-0003ec80: 6172 6368 290a 2020 2020 2020 2020 656c  arch).        el
-0003ec90: 6966 2061 7267 732e 7375 6263 6d64 2069  if args.subcmd i
-0003eca0: 6e20 5b27 6172 6368 6976 6527 2c20 2761  n ['archive', 'a
-0003ecb0: 7263 275d 3a0a 2020 2020 2020 2020 2020  rc']:.          
-0003ecc0: 2020 7375 6263 6d64 5f61 7263 6869 7665    subcmd_archive
-0003ecd0: 2861 7267 732c 2061 7263 6829 0a20 2020  (args, arch).   
-0003ece0: 2020 2020 2065 6c69 6620 6172 6773 2e73       elif args.s
-0003ecf0: 7562 636d 6420 696e 205b 2772 6573 746f  ubcmd in ['resto
-0003ed00: 7265 272c 2027 7273 7427 5d3a 0a20 2020  re', 'rst']:.   
-0003ed10: 2020 2020 2020 2020 2073 7562 636d 645f           subcmd_
-0003ed20: 7265 7374 6f72 6528 6172 6773 2c20 6366  restore(args, cf
-0003ed30: 672c 2061 7263 682c 2061 7773 290a 2020  g, arch, aws).  
-0003ed40: 2020 2020 2020 656c 6966 2061 7267 732e        elif args.
-0003ed50: 7375 6263 6d64 2069 6e20 5b27 6465 6c65  subcmd in ['dele
-0003ed60: 7465 272c 2027 6465 6c27 5d3a 0a20 2020  te', 'del']:.   
-0003ed70: 2020 2020 2020 2020 2073 7562 636d 645f           subcmd_
-0003ed80: 6465 6c65 7465 2861 7267 732c 2061 7263  delete(args, arc
-0003ed90: 6829 0a20 2020 2020 2020 2065 6c69 6620  h).        elif 
-0003eda0: 6172 6773 2e73 7562 636d 6420 696e 205b  args.subcmd in [
-0003edb0: 276d 6f75 6e74 272c 2027 6d6e 7427 5d3a  'mount', 'mnt']:
-0003edc0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
-0003edd0: 636d 645f 6d6f 756e 7428 6172 6773 2c20  cmd_mount(args, 
-0003ede0: 6366 672c 2061 7263 682c 2061 7773 290a  cfg, arch, aws).
-0003edf0: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
-0003ee00: 732e 7375 6263 6d64 2069 6e20 5b27 756d  s.subcmd in ['um
-0003ee10: 6f75 6e74 275d 3a20 2023 206f 7220 6172  ount']:  # or ar
-0003ee20: 6773 2e75 6e6d 6f75 6e74 3a0a 2020 2020  gs.unmount:.    
-0003ee30: 2020 2020 2020 2020 7375 6263 6d64 5f75          subcmd_u
-0003ee40: 6d6f 756e 7428 6172 6773 2c20 6366 6729  mount(args, cfg)
-0003ee50: 0a20 2020 2020 2020 2065 6c69 6620 6172  .        elif ar
-0003ee60: 6773 2e73 7562 636d 6420 696e 205b 2773  gs.subcmd in ['s
-0003ee70: 7368 272c 2027 7363 7027 5d3a 2020 2320  sh', 'scp']:  # 
-0003ee80: 6f72 2061 7267 732e 756e 6d6f 756e 743a  or args.unmount:
-0003ee90: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
-0003eea0: 636d 645f 7373 6828 6172 6773 2c20 6366  cmd_ssh(args, cf
-0003eeb0: 672c 2061 7773 290a 2020 2020 2020 2020  g, aws).        
-0003eec0: 656c 6966 2061 7267 732e 7375 6263 6d64  elif args.subcmd
-0003eed0: 2069 6e20 5b27 6372 6564 656e 7469 616c   in ['credential
-0003eee0: 7327 2c20 2763 7264 275d 3a0a 2020 2020  s', 'crd']:.    
-0003eef0: 2020 2020 2020 2020 7375 6263 6d64 5f63          subcmd_c
-0003ef00: 7265 6465 6e74 6961 6c73 2861 7267 732c  redentials(args,
-0003ef10: 2061 7773 290a 2020 2020 2020 2020 656c   aws).        el
-0003ef20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003ef30: 7061 7273 6572 2e70 7269 6e74 5f68 656c  parser.print_hel
-0003ef40: 7028 290a 0a20 2020 2065 7863 6570 7420  p()..    except 
-0003ef50: 4b65 7962 6f61 7264 496e 7465 7272 7570  KeyboardInterrup
-0003ef60: 743a 0a20 2020 2020 2020 2070 7269 6e74  t:.        print
-0003ef70: 2827 4b65 7962 6f61 7264 2069 6e74 6572  ('Keyboard inter
-0003ef80: 7275 7074 5c6e 2729 0a20 2020 2020 2020  rupt\n').       
-0003ef90: 2073 7973 2e65 7869 7428 3029 0a0a 2020   sys.exit(0)..  
-0003efa0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0003efb0: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
-0003efc0: 2020 2070 7269 6e74 5f65 7272 6f72 2829     print_error()
-0003efd0: 0a20 2020 2020 2020 2073 7973 2e65 7869  .        sys.exi
-0003efe0: 7428 3129 0a0a 0a69 6620 5f5f 6e61 6d65  t(1)...if __name
-0003eff0: 5f5f 203d 3d20 225f 5f6d 6169 6e5f 5f22  __ == "__main__"
-0003f000: 3a0a 2020 2020 6d61 696e 2829 0a         :.    main().
+0003e140: 2020 2020 7072 696e 7428 2720 2d20 272e      print(' - '.
+0003e150: 6a6f 696e 2872 6f77 2929 0a20 2020 2020  join(row)).     
+0003e160: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003e170: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0003e180: 6e74 2827 4e6f 2072 756e 6e69 6e67 2069  nt('No running i
+0003e190: 6e73 7461 6e63 6573 2064 6574 6563 7465  nstances detecte
+0003e1a0: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+0003e1b0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+0003e1c0: 2020 2020 6966 2073 656c 662e 6172 6773      if self.args
+0003e1d0: 2e74 6572 6d69 6e61 7465 3a0a 2020 2020  .terminate:.    
+0003e1e0: 2020 2020 2020 2020 6177 732e 6563 325f          aws.ec2_
+0003e1f0: 7465 726d 696e 6174 655f 696e 7374 616e  terminate_instan
+0003e200: 6365 2873 656c 662e 6172 6773 2e74 6572  ce(self.args.ter
+0003e210: 6d69 6e61 7465 290a 2020 2020 2020 2020  minate).        
+0003e220: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+0003e230: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0003e240: 6172 6773 2e73 7368 6172 6773 3a0a 2020  args.sshargs:.  
+0003e250: 2020 2020 2020 2020 2020 6966 2027 3a27            if ':'
+0003e260: 2069 6e20 7365 6c66 2e61 7267 732e 7373   in self.args.ss
+0003e270: 6861 7267 735b 305d 3a0a 2020 2020 2020  hargs[0]:.      
+0003e280: 2020 2020 2020 2020 2020 6d79 686f 7374            myhost
+0003e290: 2c20 7265 6d6f 7465 5f70 6174 6820 3d20  , remote_path = 
+0003e2a0: 7365 6c66 2e61 7267 732e 7373 6861 7267  self.args.ssharg
+0003e2b0: 735b 305d 2e73 706c 6974 2827 3a27 290a  s[0].split(':').
+0003e2c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0003e2d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003e2e0: 2020 6d79 686f 7374 203d 2073 656c 662e    myhost = self.
+0003e2f0: 6172 6773 2e73 7368 6172 6773 5b30 5d0a  args.sshargs[0].
+0003e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e310: 7265 6d6f 7465 5f70 6174 6820 3d20 2727  remote_path = ''
+0003e320: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003e330: 2020 2020 2020 2020 2020 206d 7968 6f73             myhos
+0003e340: 7420 3d20 6366 672e 6563 325f 6c61 7374  t = cfg.ec2_last
+0003e350: 5f69 6e73 7461 6e63 650a 2020 2020 2020  _instance.      
+0003e360: 2020 6966 2069 7073 2061 6e64 206e 6f74    if ips and not
+0003e370: 206d 7968 6f73 7420 696e 2069 7073 3a0a   myhost in ips:.
+0003e380: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0003e390: 7428 6627 7b6d 7968 6f73 747d 2069 7320  t(f'{myhost} is 
+0003e3a0: 6e6f 206c 6f6e 6765 7220 7275 6e6e 696e  no longer runnin
+0003e3b0: 672c 2072 6570 6c61 6369 6e67 2077 6974  g, replacing wit
+0003e3c0: 6820 7b69 7073 5b2d 315d 7d27 290a 2020  h {ips[-1]}').  
+0003e3d0: 2020 2020 2020 2020 2020 6d79 686f 7374            myhost
+0003e3e0: 203d 2069 7073 5b2d 315d 0a20 2020 2020   = ips[-1].     
+0003e3f0: 2020 2069 6620 7365 6c66 2e61 7267 732e     if self.args.
+0003e400: 7375 6263 6d64 203d 3d20 2773 7368 273a  subcmd == 'ssh':
+0003e410: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0003e420: 6e74 2866 2743 6f6e 6e65 6374 696e 6720  nt(f'Connecting 
+0003e430: 746f 207b 6d79 686f 7374 7d20 2e2e 2e27  to {myhost} ...'
+0003e440: 290a 2020 2020 2020 2020 2020 2020 6177  ).            aw
+0003e450: 732e 7373 685f 6578 6563 7574 6528 2765  s.ssh_execute('e
+0003e460: 6332 2d75 7365 7227 2c20 6d79 686f 7374  c2-user', myhost
+0003e470: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0003e480: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0003e490: 2020 656c 6966 2073 656c 662e 6172 6773    elif self.args
+0003e4a0: 2e73 7562 636d 6420 3d3d 2027 7363 7027  .subcmd == 'scp'
+0003e4b0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0003e4c0: 206c 656e 2873 656c 662e 6172 6773 2e73   len(self.args.s
+0003e4d0: 7368 6172 6773 2920 213d 2032 3a0a 2020  shargs) != 2:.  
+0003e4e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003e4f0: 696e 7428 2754 6865 2022 7363 7022 2073  int('The "scp" s
+0003e500: 7562 2063 6f6d 6d61 6e64 2073 7570 706f  ub command suppo
+0003e510: 7274 7320 6375 7272 656e 746c 7920 3220  rts currently 2 
+0003e520: 6172 6775 6d65 6e74 7327 290a 2020 2020  arguments').    
+0003e530: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003e540: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0003e550: 2020 2020 2068 6f73 746c 6f63 203d 206e       hostloc = n
+0003e560: 6578 7428 2869 2066 6f72 2069 2c20 6974  ext((i for i, it
+0003e570: 656d 2069 6e20 656e 756d 6572 6174 6528  em in enumerate(
+0003e580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e590: 2073 656c 662e 6172 6773 2e73 7368 6172   self.args.sshar
+0003e5a0: 6773 2920 6966 2022 3a22 2069 6e20 6974  gs) if ":" in it
+0003e5b0: 656d 292c 204e 6f6e 6529 0a20 2020 2020  em), None).     
+0003e5c0: 2020 2020 2020 2069 6620 686f 7374 6c6f         if hostlo
+0003e5d0: 6320 3d3d 2030 3a0a 2020 2020 2020 2020  c == 0:.        
+0003e5e0: 2020 2020 2020 2020 2320 7468 6520 686f          # the ho
+0003e5f0: 7374 6e61 6d65 2069 7320 696e 2074 6865  stname is in the
+0003e600: 2066 6972 7374 2061 7267 756d 656e 743a   first argument:
+0003e610: 2064 6f77 6e6c 6f61 640a 2020 2020 2020   download.      
+0003e620: 2020 2020 2020 2020 2020 686f 7374 2c20            host, 
+0003e630: 7265 6d6f 7465 5f70 6174 6820 3d20 7365  remote_path = se
+0003e640: 6c66 2e61 7267 732e 7373 6861 7267 735b  lf.args.sshargs[
+0003e650: 305d 2e73 706c 6974 2827 3a27 290a 2020  0].split(':').  
+0003e660: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003e670: 7420 3d20 6177 732e 7373 685f 646f 776e  t = aws.ssh_down
+0003e680: 6c6f 6164 280a 2020 2020 2020 2020 2020  load(.          
+0003e690: 2020 2020 2020 2020 2020 2765 6332 2d75            'ec2-u
+0003e6a0: 7365 7227 2c20 686f 7374 2c20 7265 6d6f  ser', host, remo
+0003e6b0: 7465 5f70 6174 682c 2073 656c 662e 6172  te_path, self.ar
+0003e6c0: 6773 2e73 7368 6172 6773 5b31 5d29 0a20  gs.sshargs[1]). 
+0003e6d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0003e6e0: 686f 7374 6c6f 6320 3d3d 2031 3a0a 2020  hostloc == 1:.  
+0003e6f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0003e700: 7468 6520 686f 7374 6e61 6d65 2069 7320  the hostname is 
+0003e710: 696e 2074 6865 2073 6563 6f6e 6420 6172  in the second ar
+0003e720: 6775 6d65 6e74 3a20 7570 6c6f 6161 640a  gument: uploaad.
+0003e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e740: 686f 7374 2c20 7265 6d6f 7465 5f70 6174  host, remote_pat
+0003e750: 6820 3d20 7365 6c66 2e61 7267 732e 7373  h = self.args.ss
+0003e760: 6861 7267 735b 315d 2e73 706c 6974 2827  hargs[1].split('
+0003e770: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
+0003e780: 2020 2020 7265 7420 3d20 6177 732e 7373      ret = aws.ss
+0003e790: 685f 7570 6c6f 6164 280a 2020 2020 2020  h_upload(.      
+0003e7a0: 2020 2020 2020 2020 2020 2020 2020 2765                'e
+0003e7b0: 6332 2d75 7365 7227 2c20 686f 7374 2c20  c2-user', host, 
+0003e7c0: 7365 6c66 2e61 7267 732e 7373 6861 7267  self.args.ssharg
+0003e7d0: 735b 305d 2c20 7265 6d6f 7465 5f70 6174  s[0], remote_pat
+0003e7e0: 6829 0a20 2020 2020 2020 2020 2020 2065  h).            e
+0003e7f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0003e800: 2020 2020 2070 7269 6e74 2827 5468 6520       print('The 
+0003e810: 2273 6370 2220 7375 6220 636f 6d6d 616e  "scp" sub comman
+0003e820: 6420 7375 7070 6f72 7473 2063 7572 7265  d supports curre
+0003e830: 6e74 6c79 2032 2061 7267 756d 656e 7473  ntly 2 arguments
+0003e840: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0003e850: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0003e860: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0003e870: 7428 7265 742e 7374 646f 7574 2c20 7265  t(ret.stdout, re
+0003e880: 742e 7374 6465 7272 290a 0a20 2020 2064  t.stderr)..    d
+0003e890: 6566 2073 7562 636d 645f 6372 6564 656e  ef subcmd_creden
+0003e8a0: 7469 616c 7328 7365 6c66 2c20 6366 673a  tials(self, cfg:
+0003e8b0: 2043 6f6e 6669 674d 616e 6167 6572 2c20   ConfigManager, 
+0003e8c0: 6177 733a 2041 5753 426f 746f 293a 0a20  aws: AWSBoto):. 
+0003e8d0: 2020 2020 2020 2027 2727 4368 6563 6b20         '''Check 
+0003e8e0: 4157 5320 6372 6564 656e 7469 616c 7327  AWS credentials'
+0003e8f0: 2727 0a0a 2020 2020 2020 2020 7072 696e  ''..        prin
+0003e900: 7428 225c 6e43 6865 636b 696e 6720 4157  t("\nChecking AW
+0003e910: 5320 6372 6564 656e 7469 616c 732e 2e2e  S credentials...
+0003e920: 2229 0a0a 2020 2020 2020 2020 6966 2061  ")..        if a
+0003e930: 7773 2e63 6865 636b 5f63 7265 6465 6e74  ws.check_credent
+0003e940: 6961 6c73 2861 7773 5f70 726f 6669 6c65  ials(aws_profile
+0003e950: 3d63 6667 2e61 7773 5f70 726f 6669 6c65  =cfg.aws_profile
+0003e960: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+0003e970: 7269 6e74 2827 2020 2020 2e2e 2e41 5753  rint('    ...AWS
+0003e980: 2063 7265 6465 6e74 6961 6c73 2061 7265   credentials are
+0003e990: 2076 616c 6964 5c6e 2729 0a20 2020 2020   valid\n').     
+0003e9a0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0003e9b0: 7565 0a20 2020 2020 2020 2065 6c73 653a  ue.        else:
+0003e9c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0003e9d0: 6e74 2827 2020 2020 2e2e 2e41 5753 2063  nt('    ...AWS c
+0003e9e0: 7265 6465 6e74 6961 6c73 2061 7265 204e  redentials are N
+0003e9f0: 4f54 2076 616c 6964 5c6e 2729 0a20 2020  OT valid\n').   
+0003ea00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003ea10: 4661 6c73 650a 0a20 2020 2064 6566 2073  False..    def s
+0003ea20: 7562 636d 645f 7570 6461 7465 2873 656c  ubcmd_update(sel
+0003ea30: 6629 3a0a 2020 2020 2020 2020 0a20 2020  f):.        .   
+0003ea40: 2020 2020 2069 6620 7365 6c66 2e61 7267       if self.arg
+0003ea50: 732e 7263 6c6f 6e65 3a0a 2020 2020 2020  s.rclone:.      
+0003ea60: 2020 2020 2020 636d 6420 3d20 2272 636c        cmd = "rcl
+0003ea70: 6f6e 6520 7365 6c66 7570 6461 7465 220a  one selfupdate".
+0003ea80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003ea90: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
+0003eaa0: 2263 7572 6c20 2d73 2068 7474 7073 3a2f  "curl -s https:/
+0003eab0: 2f72 6177 2e67 6974 6875 6275 7365 7263  /raw.githubuserc
+0003eac0: 6f6e 7465 6e74 2e63 6f6d 2f64 6972 6b70  ontent.com/dirkp
+0003ead0: 6574 6572 7365 6e2f 6672 6f73 7465 722f  etersen/froster/
+0003eae0: 6d61 696e 2f69 6e73 7461 6c6c 2e73 683f  main/install.sh?
+0003eaf0: 2428 6461 7465 202b 2573 2920 7c20 6261  $(date +%s) | ba
+0003eb00: 7368 220a 0a20 2020 2020 2020 2070 203d  sh"..        p =
+0003eb10: 2073 7562 7072 6f63 6573 732e 506f 7065   subprocess.Pope
+0003eb20: 6e28 636d 642c 2073 7464 6f75 743d 7375  n(cmd, stdout=su
+0003eb30: 6270 726f 6365 7373 2e50 4950 452c 0a20  bprocess.PIPE,. 
+0003eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003eb50: 2020 2020 2020 2020 2020 2020 7374 6465              stde
+0003eb60: 7272 3d73 7562 7072 6f63 6573 732e 5354  rr=subprocess.ST
+0003eb70: 444f 5554 2c20 7368 656c 6c3d 5472 7565  DOUT, shell=True
+0003eb80: 290a 0a20 2020 2020 2020 2066 6f72 206c  )..        for l
+0003eb90: 696e 6520 696e 2069 7465 7228 702e 7374  ine in iter(p.st
+0003eba0: 646f 7574 2e72 6561 646c 696e 652c 2062  dout.readline, b
+0003ebb0: 2727 293a 0a20 2020 2020 2020 2020 2020  ''):.           
+0003ebc0: 2070 7269 6e74 286c 696e 652e 6465 636f   print(line.deco
+0003ebd0: 6465 2829 2c20 656e 643d 2727 290a 0a20  de(), end='').. 
+0003ebe0: 2020 2020 2020 2023 2057 6169 7420 666f         # Wait fo
+0003ebf0: 7220 7468 6520 7072 6f63 6573 7320 746f  r the process to
+0003ec00: 2066 696e 6973 6820 616e 6420 6765 7420   finish and get 
+0003ec10: 7468 6520 6578 6974 2063 6f64 650a 2020  the exit code.  
+0003ec20: 2020 2020 2020 702e 7761 6974 2829 0a0a        p.wait()..
+0003ec30: 2020 2020 2020 2020 6966 2070 2e72 6574          if p.ret
+0003ec40: 7572 6e63 6f64 6520 213d 2030 3a0a 2020  urncode != 0:.  
+0003ec50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0003ec60: 6622 4572 726f 723a 2054 6865 2075 7064  f"Error: The upd
+0003ec70: 6174 6520 6661 696c 6564 2077 6974 6820  ate failed with 
+0003ec80: 6578 6974 2063 6f64 6520 7b70 2e72 6574  exit code {p.ret
+0003ec90: 7572 6e63 6f64 657d 2e22 290a 0a20 2020  urncode}.")..   
+0003eca0: 2064 6566 2070 6172 7365 5f61 7267 756d   def parse_argum
+0003ecb0: 656e 7473 2873 656c 6629 3a0a 2020 2020  ents(self):.    
+0003ecc0: 2020 2020 2727 2747 6174 6865 7220 616e      '''Gather an
+0003ecd0: 6420 7061 7273 6520 636f 6d6d 616e 642d  d parse command-
+0003ece0: 6c69 6e65 2061 7267 756d 656e 7473 2727  line arguments''
+0003ecf0: 270a 0a20 2020 2020 2020 2070 6172 7365  '..        parse
+0003ed00: 7220 3d20 6172 6770 6172 7365 2e41 7267  r = argparse.Arg
+0003ed10: 756d 656e 7450 6172 7365 7228 7072 6f67  umentParser(prog
+0003ed20: 3d27 6672 6f73 7465 7220 272c 0a20 2020  ='froster ',.   
+0003ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ed50: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
+0003ed60: 6e3d 2741 2028 6d6f 7374 6c79 2920 6175  n='A (mostly) au
+0003ed70: 746f 6d61 7465 6420 746f 6f6c 2066 6f72  tomated tool for
+0003ed80: 2061 7263 6869 7669 6e67 206c 6172 6765   archiving large
+0003ed90: 2073 6361 6c65 2064 6174 6120 2720 2b0a   scale data ' +.
+0003eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003edc0: 2020 2020 2020 2020 2027 6166 7465 7220           'after 
+0003edd0: 6669 6e64 696e 6720 666f 6c64 6572 7320  finding folders 
+0003ede0: 696e 2074 6865 2066 696c 6520 7379 7374  in the file syst
+0003edf0: 656d 2074 6861 7420 6172 6520 776f 7274  em that are wort
+0003ee00: 6820 6172 6368 6976 696e 672e 2729 0a0a  h archiving.')..
+0003ee10: 2020 2020 2020 2020 2320 2a2a 2a0a 0a20          # ***.. 
+0003ee20: 2020 2020 2020 2070 6172 7365 722e 6164         parser.ad
+0003ee30: 645f 6172 6775 6d65 6e74 2827 2d64 272c  d_argument('-d',
+0003ee40: 2027 2d2d 6465 6275 6727 2c20 6465 7374   '--debug', dest
+0003ee50: 3d27 6465 6275 6727 2c20 6163 7469 6f6e  ='debug', action
+0003ee60: 3d27 7374 6f72 655f 7472 7565 272c 2064  ='store_true', d
+0003ee70: 6566 6175 6c74 3d46 616c 7365 2c0a 2020  efault=False,.  
+0003ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ee90: 2020 2020 2020 2020 2020 6865 6c70 3d22            help="
+0003eea0: 7665 7262 6f73 6520 6f75 7470 7574 2066  verbose output f
+0003eeb0: 6f72 2061 6c6c 2063 6f6d 6d61 6e64 7322  or all commands"
+0003eec0: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+0003eed0: 722e 6164 645f 6172 6775 6d65 6e74 2827  r.add_argument('
+0003eee0: 2d6e 272c 2027 2d2d 6e6f 2d73 6c75 726d  -n', '--no-slurm
+0003eef0: 272c 2064 6573 743d 276e 6f73 6c75 726d  ', dest='noslurm
+0003ef00: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
+0003ef10: 5f74 7275 6527 2c20 6465 6661 756c 743d  _true', default=
+0003ef20: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0003ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef40: 2020 2068 656c 703d 2264 6f20 6e6f 7420     help="do not 
+0003ef50: 7375 626d 6974 2061 2053 6c75 726d 206a  submit a Slurm j
+0003ef60: 6f62 2c20 6578 6563 7574 6520 696e 2074  ob, execute in t
+0003ef70: 6865 2066 6f72 6567 726f 756e 642e 2022  he foreground. "
+0003ef80: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+0003ef90: 722e 6164 645f 6172 6775 6d65 6e74 2827  r.add_argument('
+0003efa0: 2d63 272c 2027 2d2d 636f 7265 7327 2c20  -c', '--cores', 
+0003efb0: 6465 7374 3d27 636f 7265 7327 2c20 7479  dest='cores', ty
+0003efc0: 7065 3d69 6e74 2c20 6465 6661 756c 743d  pe=int, default=
+0003efd0: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+0003efe0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003eff0: 656c 703d 274e 756d 6265 7220 6f66 2063  elp='Number of c
+0003f000: 6f72 6573 2074 6f20 6265 2061 6c6c 6f63  ores to be alloc
+0003f010: 6174 6564 2066 6f72 2074 6865 206d 6163  ated for the mac
+0003f020: 6869 6e65 2e20 2864 6566 6175 6c74 3d34  hine. (default=4
+0003f030: 2927 290a 0a20 2020 2020 2020 2070 6172  )')..        par
+0003f040: 7365 722e 6164 645f 6172 6775 6d65 6e74  ser.add_argument
+0003f050: 2827 2d6d 272c 2027 2d2d 6d65 6d27 2c20  ('-m', '--mem', 
+0003f060: 6465 7374 3d27 6d65 6d6f 7279 272c 2074  dest='memory', t
+0003f070: 7970 653d 696e 742c 2064 6566 6175 6c74  ype=int, default
+0003f080: 3d36 342c 0a20 2020 2020 2020 2020 2020  =64,.           
+0003f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f0a0: 2068 656c 703d 2741 6d6f 756e 7420 6f66   help='Amount of
+0003f0b0: 206d 656d 6f72 7920 746f 2062 6520 616c   memory to be al
+0003f0c0: 6c6f 6361 7465 6420 666f 7220 7468 6520  located for the 
+0003f0d0: 6d61 6368 696e 6520 696e 2047 422e 2028  machine in GB. (
+0003f0e0: 6465 6661 756c 743d 3634 2927 290a 0a20  default=64)').. 
+0003f0f0: 2020 2020 2020 2070 6172 7365 722e 6164         parser.ad
+0003f100: 645f 6172 6775 6d65 6e74 2827 2d70 272c  d_argument('-p',
+0003f110: 2027 2d2d 7072 6f66 696c 6527 2c20 6465   '--profile', de
+0003f120: 7374 3d27 6177 735f 7072 6f66 696c 6527  st='aws_profile'
+0003f130: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
+0003f140: 7472 7565 272c 2064 6566 6175 6c74 3d27  true', default='
+0003f150: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0003f160: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003f170: 656c 703d 2777 6869 6368 2041 5753 2070  elp='which AWS p
+0003f180: 726f 6669 6c65 2069 6e20 7e2f 2e61 7773  rofile in ~/.aws
+0003f190: 2f20 7368 6f75 6c64 2062 6520 7573 6564  / should be used
+0003f1a0: 2e20 6465 6661 756c 743d 2261 7773 2227  . default="aws"'
+0003f1b0: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+0003f1c0: 722e 6164 645f 6172 6775 6d65 6e74 2827  r.add_argument('
+0003f1d0: 2d76 272c 2027 2d2d 7665 7273 696f 6e27  -v', '--version'
+0003f1e0: 2c20 6465 7374 3d27 7665 7273 696f 6e27  , dest='version'
+0003f1f0: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
+0003f200: 7472 7565 272c 0a20 2020 2020 2020 2020  true',.         
+0003f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f220: 2020 2068 656c 703d 2770 7269 6e74 2066     help='print f
+0003f230: 726f 7374 6572 2061 6e64 2070 6163 6b61  roster and packa
+0003f240: 6765 7320 7665 7273 696f 6e20 696e 666f  ges version info
+0003f250: 2729 0a0a 2020 2020 2020 2020 7375 6270  ')..        subp
+0003f260: 6172 7365 7273 203d 2070 6172 7365 722e  arsers = parser.
+0003f270: 6164 645f 7375 6270 6172 7365 7273 280a  add_subparsers(.
+0003f280: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+0003f290: 3d22 7375 6263 6d64 222c 2068 656c 703d  ="subcmd", help=
+0003f2a0: 2773 7562 2d63 6f6d 6d61 6e64 2068 656c  'sub-command hel
+0003f2b0: 7027 290a 0a20 2020 2020 2020 2023 202a  p')..        # *
+0003f2c0: 2a2a 0a0a 2020 2020 2020 2020 7061 7273  **..        pars
+0003f2d0: 6572 5f63 7265 6465 6e74 6961 6c73 203d  er_credentials =
+0003f2e0: 2073 7562 7061 7273 6572 732e 6164 645f   subparsers.add_
+0003f2f0: 7061 7273 6572 2827 6372 6564 656e 7469  parser('credenti
+0003f300: 616c 7327 2c20 616c 6961 7365 733d 5b27  als', aliases=['
+0003f310: 6372 6427 5d2c 0a20 2020 2020 2020 2020  crd'],.         
+0003f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f340: 2020 2020 2020 2020 2020 6865 6c70 3d74            help=t
+0003f350: 6578 7477 7261 702e 6465 6465 6e74 2866  extwrap.dedent(f
+0003f360: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+0003f370: 2020 2020 4372 6564 656e 7469 616c 206d      Credential m
+0003f380: 616e 6167 6572 0a20 2020 2020 2020 2020  anager.         
+0003f390: 2020 2027 2727 292c 2066 6f72 6d61 7474     '''), formatt
+0003f3a0: 6572 5f63 6c61 7373 3d61 7267 7061 7273  er_class=argpars
+0003f3b0: 652e 5261 7754 6578 7448 656c 7046 6f72  e.RawTextHelpFor
+0003f3c0: 6d61 7474 6572 290a 2020 2020 2020 2020  matter).        
+0003f3d0: 7061 7273 6572 5f63 7265 6465 6e74 6961  parser_credentia
+0003f3e0: 6c73 2e61 6464 5f61 7267 756d 656e 7428  ls.add_argument(
+0003f3f0: 272d 6327 2c20 272d 2d63 6865 636b 272c  '-c', '--check',
+0003f400: 2064 6573 743d 2763 7264 2d63 6865 636b   dest='crd-check
+0003f410: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
+0003f420: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
+0003f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f450: 6865 6c70 3d22 4368 6563 6b20 6966 2074  help="Check if t
+0003f460: 6865 7265 2061 7265 2076 616c 6964 2063  here are valid c
+0003f470: 7265 6465 6e74 6961 6c73 206f 6e20 6465  redentials on de
+0003f480: 6661 756c 7420 726f 7574 6573 2e22 290a  fault routes.").
+0003f490: 0a20 2020 2020 2020 2023 202a 2a2a 0a0a  .        # ***..
+0003f4a0: 2020 2020 2020 2020 7061 7273 6572 5f63          parser_c
+0003f4b0: 6f6e 6669 6720 3d20 7375 6270 6172 7365  onfig = subparse
+0003f4c0: 7273 2e61 6464 5f70 6172 7365 7228 2763  rs.add_parser('c
+0003f4d0: 6f6e 6669 6727 2c20 616c 6961 7365 733d  onfig', aliases=
+0003f4e0: 5b27 636e 6627 5d2c 0a20 2020 2020 2020  ['cnf'],.       
+0003f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f510: 2020 2020 2020 2068 656c 703d 7465 7874         help=text
+0003f520: 7772 6170 2e64 6564 656e 7428 6627 2727  wrap.dedent(f'''
+0003f530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f540: 2042 6f6f 7473 7472 6170 2074 6865 2063   Bootstrap the c
+0003f550: 6f6e 6669 6775 7274 696f 6e2c 2069 6e73  onfigurtion, ins
+0003f560: 7461 6c6c 2064 6570 656e 6465 6e63 6965  tall dependencie
+0003f570: 7320 616e 6420 7365 7475 7020 796f 7572  s and setup your
+0003f580: 2065 6e76 6972 6f6e 6d65 6e74 2e0a 2020   environment..  
+0003f590: 2020 2020 2020 2020 2020 2020 2020 596f                Yo
+0003f5a0: 7520 7769 6c6c 206e 6565 6420 746f 2061  u will need to a
+0003f5b0: 6e73 7765 7220 6120 6665 7720 7175 6573  nswer a few ques
+0003f5c0: 7469 6f6e 7320 6162 6f75 7420 796f 7572  tions about your
+0003f5d0: 2063 6c6f 7564 2061 6e64 2068 7063 2073   cloud and hpc s
+0003f5e0: 6574 7570 2e0a 2020 2020 2020 2020 2020  etup..          
+0003f5f0: 2020 2727 2729 2c20 666f 726d 6174 7465    '''), formatte
+0003f600: 725f 636c 6173 733d 6172 6770 6172 7365  r_class=argparse
+0003f610: 2e52 6177 5465 7874 4865 6c70 466f 726d  .RawTextHelpForm
+0003f620: 6174 7465 7229 0a0a 2020 2020 2020 2020  atter)..        
+0003f630: 7061 7273 6572 5f63 6f6e 6669 672e 6164  parser_config.ad
+0003f640: 645f 6172 6775 6d65 6e74 2827 2d61 272c  d_argument('-a',
+0003f650: 2027 2d2d 6177 7327 2c20 6465 7374 3d27   '--aws', dest='
+0003f660: 6177 7327 2c20 6163 7469 6f6e 3d27 7374  aws', action='st
+0003f670: 6f72 655f 7472 7565 272c 0a20 2020 2020  ore_true',.     
+0003f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f690: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0003f6a0: 6c70 3d22 5365 7475 7020 4157 5320 7072  lp="Setup AWS pr
+0003f6b0: 6f66 696c 6522 290a 0a20 2020 2020 2020  ofile")..       
+0003f6c0: 2070 6172 7365 725f 636f 6e66 6967 2e61   parser_config.a
+0003f6d0: 6464 5f61 7267 756d 656e 7428 272d 6d27  dd_argument('-m'
+0003f6e0: 2c20 272d 2d6d 6f6e 6974 6f72 272c 2064  , '--monitor', d
+0003f6f0: 6573 743d 276d 6f6e 6974 6f72 272c 2061  est='monitor', a
+0003f700: 6374 696f 6e3d 2773 746f 7265 5f74 7275  ction='store_tru
+0003f710: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
+0003f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f730: 2020 2020 2020 2068 656c 703d 2753 6574         help='Set
+0003f740: 7570 2066 726f 7374 6572 2061 7320 6120  up froster as a 
+0003f750: 6d6f 6e69 746f 7269 6e67 2063 726f 6e6a  monitoring cronj
+0003f760: 6f62 2027 202b 0a20 2020 2020 2020 2020  ob ' +.         
+0003f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f780: 2020 2020 2020 2020 2020 276f 6e20 616e            'on an
+0003f790: 2065 6332 2069 6e73 7461 6e63 6520 616e   ec2 instance an
+0003f7a0: 6420 6e6f 7469 6679 2074 6865 2075 7365  d notify the use
+0003f7b0: 7220 656d 6169 6c20 6164 6472 6573 7327  r email address'
+0003f7c0: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+0003f7d0: 725f 636f 6e66 6967 2e61 6464 5f61 7267  r_config.add_arg
+0003f7e0: 756d 656e 7428 272d 6e27 2c20 272d 2d6e  ument('-n', '--n
+0003f7f0: 6968 272c 2064 6573 743d 276e 6968 272c  ih', dest='nih',
+0003f800: 2061 6374 696f 6e3d 2773 746f 7265 5f74   action='store_t
+0003f810: 7275 6527 2c0a 2020 2020 2020 2020 2020  rue',.          
+0003f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f830: 2020 2020 2020 2020 2068 656c 703d 2253           help="S
+0003f840: 6574 7570 204e 4948 2072 6570 6f72 7465  etup NIH reporte
+0003f850: 7220 636f 6e66 6967 7572 6174 696f 6e22  r configuration"
+0003f860: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+0003f870: 725f 636f 6e66 6967 2e61 6464 5f61 7267  r_config.add_arg
+0003f880: 756d 656e 7428 272d 7027 2c20 272d 2d70  ument('-p', '--p
+0003f890: 7269 6e74 272c 2064 6573 743d 2770 7269  rint', dest='pri
+0003f8a0: 6e74 272c 2061 6374 696f 6e3d 2773 746f  nt', action='sto
+0003f8b0: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
+0003f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f8d0: 2020 2020 2020 2020 2020 2020 2068 656c               hel
+0003f8e0: 703d 2250 7269 6e74 2074 6865 2063 7572  p="Print the cur
+0003f8f0: 7265 6e74 2063 6f6e 6669 6775 7261 7469  rent configurati
+0003f900: 6f6e 2229 0a0a 2020 2020 2020 2020 7061  on")..        pa
+0003f910: 7273 6572 5f63 6f6e 6669 672e 6164 645f  rser_config.add_
+0003f920: 6172 6775 6d65 6e74 2827 2d33 272c 2027  argument('-3', '
+0003f930: 2d2d 7333 272c 2064 6573 743d 2773 3327  --s3', dest='s3'
+0003f940: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
+0003f950: 7472 7565 272c 0a20 2020 2020 2020 2020  true',.         
+0003f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f970: 2020 2020 2020 2020 2020 6865 6c70 3d22            help="
+0003f980: 5365 7475 7020 7333 2062 7563 6b65 7420  Setup s3 bucket 
+0003f990: 636f 6e66 6967 7572 6174 696f 6e22 290a  configuration").
+0003f9a0: 0a20 2020 2020 2020 2070 6172 7365 725f  .        parser_
+0003f9b0: 636f 6e66 6967 2e61 6464 5f61 7267 756d  config.add_argum
+0003f9c0: 656e 7428 272d 7327 2c20 272d 2d73 6861  ent('-s', '--sha
+0003f9d0: 7265 6427 2c20 6465 7374 3d27 7368 6172  red', dest='shar
+0003f9e0: 6564 272c 2061 6374 696f 6e3d 2773 746f  ed', action='sto
+0003f9f0: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
+0003fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fa10: 2020 2020 2020 2020 2020 2020 2068 656c               hel
+0003fa20: 703d 2253 6574 7570 2073 6861 7265 6420  p="Setup shared 
+0003fa30: 636f 6e66 6967 7572 6174 696f 6e22 290a  configuration").
+0003fa40: 0a20 2020 2020 2020 2070 6172 7365 725f  .        parser_
+0003fa50: 636f 6e66 6967 2e61 6464 5f61 7267 756d  config.add_argum
+0003fa60: 656e 7428 272d 6c27 2c20 272d 2d73 6c75  ent('-l', '--slu
+0003fa70: 726d 272c 2064 6573 743d 2773 6c75 726d  rm', dest='slurm
+0003fa80: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
+0003fa90: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
+0003faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fab0: 2020 2020 2020 2020 2020 2068 656c 703d             help=
+0003fac0: 2253 6574 7570 2073 6c75 726d 2063 6f6e  "Setup slurm con
+0003fad0: 6669 6775 7261 7469 6f6e 2229 0a0a 2020  figuration")..  
+0003fae0: 2020 2020 2020 7061 7273 6572 5f63 6f6e        parser_con
+0003faf0: 6669 672e 6164 645f 6172 6775 6d65 6e74  fig.add_argument
+0003fb00: 2827 2d75 272c 2027 2d2d 7573 6572 272c  ('-u', '--user',
+0003fb10: 2064 6573 743d 2775 7365 7227 2c20 6163   dest='user', ac
+0003fb20: 7469 6f6e 3d27 7374 6f72 655f 7472 7565  tion='store_true
+0003fb30: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0003fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fb50: 2020 2020 2020 6865 6c70 3d22 5365 7475        help="Setu
+0003fb60: 7020 7573 6572 2073 7065 6369 6669 6320  p user specific 
+0003fb70: 636f 6e66 6967 7572 6174 696f 6e22 290a  configuration").
+0003fb80: 0a20 2020 2020 2020 2023 202a 2a2a 0a0a  .        # ***..
+0003fb90: 2020 2020 2020 2020 7061 7273 6572 5f69          parser_i
+0003fba0: 6e64 6578 203d 2073 7562 7061 7273 6572  ndex = subparser
+0003fbb0: 732e 6164 645f 7061 7273 6572 2827 696e  s.add_parser('in
+0003fbc0: 6465 7827 2c20 616c 6961 7365 733d 5b27  dex', aliases=['
+0003fbd0: 6964 7827 5d2c 0a20 2020 2020 2020 2020  idx'],.         
+0003fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fc00: 2020 2020 6865 6c70 3d74 6578 7477 7261      help=textwra
+0003fc10: 702e 6465 6465 6e74 2866 2727 270a 2020  p.dedent(f'''.  
+0003fc20: 2020 2020 2020 2020 2020 2020 2020 5363                Sc
+0003fc30: 616e 2061 2066 696c 6520 7379 7374 656d  an a file system
+0003fc40: 2066 6f6c 6465 7220 7472 6565 2075 7369   folder tree usi
+0003fc50: 6e67 2027 7077 616c 6b27 2061 6e64 2067  ng 'pwalk' and g
+0003fc60: 656e 6572 6174 6520 6120 686f 7473 706f  enerate a hotspo
+0003fc70: 7473 2043 5356 2066 696c 650a 2020 2020  ts CSV file.    
+0003fc80: 2020 2020 2020 2020 2020 2020 7468 6174              that
+0003fc90: 206c 6973 7473 2074 6865 206c 6172 6765   lists the large
+0003fca0: 7374 2066 6f6c 6465 7273 2e20 4173 2074  st folders. As t
+0003fcb0: 6869 7320 7072 6f63 6573 7320 6973 2063  his process is c
+0003fcc0: 6f6d 7075 7465 2069 6e74 656e 7369 7665  ompute intensive
+0003fcd0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0003fce0: 2020 2020 2069 6e64 6578 206a 6f62 2077       index job w
+0003fcf0: 696c 6c20 6265 2061 7574 6f6d 6174 6963  ill be automatic
+0003fd00: 616c 6c79 2073 7562 6d69 7474 6564 2074  ally submitted t
+0003fd10: 6f20 536c 7572 6d20 6966 2074 6865 2053  o Slurm if the S
+0003fd20: 6c75 726d 2074 6f6f 6c73 2061 7265 0a20  lurm tools are. 
+0003fd30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0003fd40: 6f75 6e64 2e0a 2020 2020 2020 2020 2020  ound..          
+0003fd50: 2020 2727 2729 2c20 666f 726d 6174 7465    '''), formatte
+0003fd60: 725f 636c 6173 733d 6172 6770 6172 7365  r_class=argparse
+0003fd70: 2e52 6177 5465 7874 4865 6c70 466f 726d  .RawTextHelpForm
+0003fd80: 6174 7465 7229 0a0a 2020 2020 2020 2020  atter)..        
+0003fd90: 7061 7273 6572 5f69 6e64 6578 2e61 6464  parser_index.add
+0003fda0: 5f61 7267 756d 656e 7428 2766 6f6c 6465  _argument('folde
+0003fdb0: 7273 272c 2061 6374 696f 6e3d 2773 746f  rs', action='sto
+0003fdc0: 7265 272c 2064 6566 6175 6c74 3d5b 5d2c  re', default=[],
+0003fdd0: 2020 6e61 7267 733d 272a 272c 0a20 2020    nargs='*',.   
+0003fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fdf0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003fe00: 656c 703d 2746 6f6c 6465 7273 2079 6f75  elp='Folders you
+0003fe10: 2077 6f75 6c64 206c 696b 6520 746f 2069   would like to i
+0003fe20: 6e64 6578 2028 7365 7061 7261 7465 6420  ndex (separated 
+0003fe30: 6279 2073 7061 6365 292c 2027 202b 0a20  by space), ' +. 
+0003fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fe60: 2027 7573 696e 6720 7468 6520 7077 616c   'using the pwal
+0003fe70: 6b20 6669 6c65 2073 7973 7465 6d20 6372  k file system cr
+0003fe80: 6177 6c65 7220 2729 0a0a 2020 2020 2020  awler ')..      
+0003fe90: 2020 7061 7273 6572 5f69 6e64 6578 2e61    parser_index.a
+0003fea0: 6464 5f61 7267 756d 656e 7428 272d 6627  dd_argument('-f'
+0003feb0: 2c20 272d 2d66 6f72 6365 272c 2064 6573  , '--force', des
+0003fec0: 743d 2766 6f72 6365 272c 2061 6374 696f  t='force', actio
+0003fed0: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
+0003fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ff00: 2020 6865 6c70 3d22 466f 7263 6520 696e    help="Force in
+0003ff10: 6465 7869 6e67 2229 0a0a 2020 2020 2020  dexing")..      
+0003ff20: 2020 7061 7273 6572 5f69 6e64 6578 2e61    parser_index.a
+0003ff30: 6464 5f61 7267 756d 656e 7428 272d 7927  dd_argument('-y'
+0003ff40: 2c20 272d 2d70 7761 6c6b 2d63 6f70 7927  , '--pwalk-copy'
+0003ff50: 2c20 6465 7374 3d27 7077 616c 6b63 6f70  , dest='pwalkcop
+0003ff60: 7927 2c20 6163 7469 6f6e 3d27 7374 6f72  y', action='stor
+0003ff70: 6527 2c20 6465 6661 756c 743d 2727 2c0a  e', default='',.
+0003ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ffa0: 2020 6865 6c70 3d27 4469 7265 6374 6f72    help='Director
+0003ffb0: 7920 7768 6572 6520 7468 6520 7077 616c  y where the pwal
+0003ffc0: 6b20 4353 5620 6669 6c65 2073 686f 756c  k CSV file shoul
+0003ffd0: 6420 6265 2063 6f70 6965 6420 746f 2e27  d be copied to.'
+0003ffe0: 290a 0a20 2020 2020 2020 2023 202a 2a2a  )..        # ***
+0003fff0: 0a0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+00040000: 5f61 7263 6869 7665 203d 2073 7562 7061  _archive = subpa
+00040010: 7273 6572 732e 6164 645f 7061 7273 6572  rsers.add_parser
+00040020: 2827 6172 6368 6976 6527 2c20 616c 6961  ('archive', alia
+00040030: 7365 733d 5b27 6172 6327 5d2c 0a20 2020  ses=['arc'],.   
+00040040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040060: 2020 2020 2020 2020 2020 2020 6865 6c70              help
+00040070: 3d74 6578 7477 7261 702e 6465 6465 6e74  =textwrap.dedent
+00040080: 2866 2727 270a 2020 2020 2020 2020 2020  (f'''.          
+00040090: 2020 2020 2020 5365 6c65 6374 2066 726f        Select fro
+000400a0: 6d20 6120 6c69 7374 206f 6620 6c61 7267  m a list of larg
+000400b0: 6520 666f 6c64 6572 732c 2074 6861 7420  e folders, that 
+000400c0: 6861 7320 6265 656e 2063 7265 6174 6564  has been created
+000400d0: 2062 7920 2766 726f 7374 6572 2069 6e64   by 'froster ind
+000400e0: 6578 272c 2061 6e64 0a20 2020 2020 2020  ex', and.       
+000400f0: 2020 2020 2020 2020 2061 7263 6869 7665           archive
+00040100: 2061 2066 6f6c 6465 7220 746f 2053 332f   a folder to S3/
+00040110: 476c 6163 6965 722e 204f 6e63 6520 796f  Glacier. Once yo
+00040120: 7520 7365 6c65 6374 2061 2066 6f6c 6465  u select a folde
+00040130: 7220 7468 6520 6172 6368 6976 6520 6a6f  r the archive jo
+00040140: 6220 7769 6c6c 2062 650a 2020 2020 2020  b will be.      
+00040150: 2020 2020 2020 2020 2020 6175 746f 6d61            automa
+00040160: 7469 6361 6c6c 7920 7375 626d 6974 7465  tically submitte
+00040170: 6420 746f 2053 6c75 726d 2e20 596f 7520  d to Slurm. You 
+00040180: 6361 6e20 616c 736f 2061 7574 6f6d 6174  can also automat
+00040190: 6520 7468 6973 2070 726f 6365 7373 0a0a  e this process..
+000401a0: 2020 2020 2020 2020 2020 2020 2727 2729              ''')
+000401b0: 2c20 666f 726d 6174 7465 725f 636c 6173  , formatter_clas
+000401c0: 733d 6172 6770 6172 7365 2e52 6177 5465  s=argparse.RawTe
+000401d0: 7874 4865 6c70 466f 726d 6174 7465 7229  xtHelpFormatter)
+000401e0: 0a0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+000401f0: 5f61 7263 6869 7665 2e61 6464 5f61 7267  _archive.add_arg
+00040200: 756d 656e 7428 2766 6f6c 6465 7273 272c  ument('folders',
+00040210: 2061 6374 696f 6e3d 2773 746f 7265 272c   action='store',
+00040220: 2064 6566 6175 6c74 3d5b 5d2c 206e 6172   default=[], nar
+00040230: 6773 3d27 2a27 2c0a 2020 2020 2020 2020  gs='*',.        
+00040240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040250: 2020 2020 2020 2020 2020 2020 6865 6c70              help
+00040260: 3d27 666f 6c64 6572 7320 796f 7520 776f  ='folders you wo
+00040270: 756c 6420 6c69 6b65 2074 6f20 6172 6368  uld like to arch
+00040280: 6976 6520 2873 6570 6172 6174 6564 2062  ive (separated b
+00040290: 7920 7370 6163 6529 2c20 2720 2b0a 2020  y space), ' +.  
+000402a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000402b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000402c0: 2020 2774 6865 206c 6173 7420 666f 6c64    'the last fold
+000402d0: 6572 2069 6e20 7468 6973 206c 6973 7420  er in this list 
+000402e0: 6973 2074 6865 2074 6172 6765 7420 2020  is the target   
+000402f0: 2729 0a0a 2020 2020 2020 2020 7061 7273  ')..        pars
+00040300: 6572 5f61 7263 6869 7665 2e61 6464 5f61  er_archive.add_a
+00040310: 7267 756d 656e 7428 272d 6627 2c20 272d  rgument('-f', '-
+00040320: 2d66 6f72 6365 272c 2064 6573 743d 2766  -force', dest='f
+00040330: 6f72 6365 272c 2061 6374 696f 6e3d 2773  orce', action='s
+00040340: 746f 7265 5f74 7275 6527 2c0a 2020 2020  tore_true',.    
+00040350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040370: 6865 6c70 3d22 466f 7263 6520 6172 6368  help="Force arch
+00040380: 6976 696e 6720 6f66 2061 2066 6f6c 6465  iving of a folde
+00040390: 7220 7468 6174 2063 6f6e 7461 696e 7320  r that contains 
+000403a0: 7468 6520 2e66 726f 7374 6572 2e6d 6435  the .froster.md5
+000403b0: 7375 6d20 6669 6c65 2229 0a0a 2020 2020  sum file")..    
+000403c0: 2020 2020 7061 7273 6572 5f61 7263 6869      parser_archi
+000403d0: 7665 2e61 6464 5f61 7267 756d 656e 7428  ve.add_argument(
+000403e0: 272d 4827 2c20 272d 2d68 6f74 7370 6f74  '-H', '--hotspot
+000403f0: 7327 2c20 6465 7374 3d27 686f 7473 706f  s', dest='hotspo
+00040400: 7473 272c 2061 6374 696f 6e3d 2773 746f  ts', action='sto
+00040410: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
+00040420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040430: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00040440: 6c70 3d22 5365 6c65 6374 2068 6f74 7370  lp="Select hotsp
+00040450: 6f74 7320 746f 2061 7263 6869 7665 2066  ots to archive f
+00040460: 726f 6d20 4353 5620 6669 6c65 2067 656e  rom CSV file gen
+00040470: 6572 6174 6564 2062 7920 2766 726f 7374  erated by 'frost
+00040480: 6572 2069 6e64 6578 2722 290a 0a20 2020  er index'")..   
+00040490: 2020 2020 2070 6172 7365 725f 6172 6368       parser_arch
+000404a0: 6976 652e 6164 645f 6172 6775 6d65 6e74  ive.add_argument
+000404b0: 2827 2d70 272c 2027 2d2d 7065 726d 6973  ('-p', '--permis
+000404c0: 7369 6f6e 7327 2c20 6465 7374 3d27 7065  sions', dest='pe
+000404d0: 726d 6973 7369 6f6e 7327 2c20 6163 7469  rmissions', acti
+000404e0: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
+000404f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040510: 2020 2020 2068 656c 703d 2250 7269 6e74       help="Print
+00040520: 2072 6561 6420 616e 6420 7772 6974 6520   read and write 
+00040530: 7065 726d 6973 7369 6f6e 7320 666f 7220  permissions for 
+00040540: 7468 6520 7072 6f76 6964 6564 2066 6f6c  the provided fol
+00040550: 6465 7228 7329 2229 0a0a 2020 2020 2020  der(s)")..      
+00040560: 2020 7061 7273 6572 5f61 7263 6869 7665    parser_archive
+00040570: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
+00040580: 6c27 2c20 272d 2d6c 6172 6765 7227 2c20  l', '--larger', 
+00040590: 6465 7374 3d27 6c61 7267 6572 272c 2074  dest='larger', t
+000405a0: 7970 653d 696e 742c 2061 6374 696f 6e3d  ype=int, action=
+000405b0: 2773 746f 7265 272c 2064 6566 6175 6c74  'store', default
+000405c0: 3d30 2c0a 2020 2020 2020 2020 2020 2020  =0,.            
+000405d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000405e0: 2020 2020 2020 2020 6865 6c70 3d74 6578          help=tex
+000405f0: 7477 7261 702e 6465 6465 6e74 2866 2727  twrap.dedent(f''
+00040600: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00040610: 2020 4172 6368 6976 6520 666f 6c64 6572    Archive folder
+00040620: 7320 6c61 7267 6572 2074 6861 6e20 3c47  s larger than <G
+00040630: 6942 3e2e 2054 6869 7320 6f70 7469 6f6e  iB>. This option
+00040640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040650: 2077 6f72 6b73 2069 6e20 636f 6e6a 756e   works in conjun
+00040660: 6374 696f 6e20 7769 7468 202d 2d6f 6c64  ction with --old
+00040670: 6572 203c 6461 7973 3e2e 2049 6620 626f  er <days>. If bo
+00040680: 7468 0a20 2020 2020 2020 2020 2020 2020  th.             
+00040690: 2020 206f 7074 696f 6e73 2061 7265 2073     options are s
+000406a0: 6574 2066 726f 7374 6572 2077 696c 6c20  et froster will 
+000406b0: 7072 696e 7420 6120 636f 6d6d 616e 6420  print a command 
+000406c0: 7468 6174 0a20 2020 2020 2020 2020 2020  that.           
+000406d0: 2020 2020 2061 6c6c 6f77 7320 796f 7520       allows you 
+000406e0: 746f 2061 7263 6869 7665 2061 6c6c 206d  to archive all m
+000406f0: 6174 6368 696e 6720 666f 6c64 6572 7320  atching folders 
+00040700: 6174 206f 6e63 652e 0a20 2020 2020 2020  at once..       
+00040710: 2020 2020 2027 2727 2929 0a20 2020 2020       ''')).     
+00040720: 2020 2070 6172 7365 725f 6172 6368 6976     parser_archiv
+00040730: 652e 6164 645f 6172 6775 6d65 6e74 2827  e.add_argument('
+00040740: 2d6f 272c 2027 2d2d 6f6c 6465 7227 2c20  -o', '--older', 
+00040750: 6465 7374 3d27 6f6c 6465 7227 2c20 7479  dest='older', ty
+00040760: 7065 3d69 6e74 2c20 6163 7469 6f6e 3d27  pe=int, action='
+00040770: 7374 6f72 6527 2c20 6465 6661 756c 743d  store', default=
+00040780: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+00040790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000407a0: 2020 2020 2020 2068 656c 703d 7465 7874         help=text
+000407b0: 7772 6170 2e64 6564 656e 7428 6627 2727  wrap.dedent(f'''
+000407c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000407d0: 2041 7263 6869 7665 2066 6f6c 6465 7273   Archive folders
+000407e0: 2074 6861 7420 6861 7665 206e 6f74 2062   that have not b
+000407f0: 6565 6e20 6163 6365 7373 6564 206d 6f72  een accessed mor
+00040800: 6520 7468 616e 0a20 2020 2020 2020 2020  e than.         
+00040810: 2020 2020 2020 203c 6461 7973 3e2e 2028         <days>. (
+00040820: 6f70 7469 6f6e 616c 6c79 2073 6574 202d  optionally set -
+00040830: 2d6d 7469 6d65 2074 6f20 7365 6c65 6374  -mtime to select
+00040840: 2066 6f6c 6465 7273 2074 6861 740a 2020   folders that.  
+00040850: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00040860: 7665 206e 6f74 2062 6565 6e20 6d6f 6469  ve not been modi
+00040870: 6669 6564 206d 6f72 6520 7468 616e 203c  fied more than <
+00040880: 6461 7973 3e29 2e20 5468 6973 206f 7074  days>). This opt
+00040890: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000408a0: 2020 2020 776f 726b 7320 696e 2063 6f6e      works in con
+000408b0: 6a75 6e63 7469 6f6e 2077 6974 6820 2d2d  junction with --
+000408c0: 6c61 7267 6572 203c 4769 423e 2e20 4966  larger <GiB>. If
+000408d0: 2062 6f74 680a 2020 2020 2020 2020 2020   both.          
+000408e0: 2020 2020 2020 6f70 7469 6f6e 7320 6172        options ar
+000408f0: 6520 7365 7420 6672 6f73 7465 7220 7769  e set froster wi
+00040900: 6c6c 2070 7269 6e74 2061 2063 6f6d 6d61  ll print a comma
+00040910: 6e64 2074 6861 740a 2020 2020 2020 2020  nd that.        
+00040920: 2020 2020 2020 2020 616c 6c6f 7773 2079          allows y
+00040930: 6f75 2074 6f20 6172 6368 6976 6520 616c  ou to archive al
+00040940: 6c20 6d61 7463 6869 6e67 2066 6f6c 6465  l matching folde
+00040950: 7273 2061 7420 6f6e 6365 2e0a 2020 2020  rs at once..    
+00040960: 2020 2020 2020 2020 2727 2729 290a 0a20          ''')).. 
+00040970: 2020 2020 2020 2070 6172 7365 725f 6172         parser_ar
+00040980: 6368 6976 652e 6164 645f 6172 6775 6d65  chive.add_argume
+00040990: 6e74 2827 2d2d 6e65 7765 7227 2c20 272d  nt('--newer', '-
+000409a0: 7727 2c20 6465 7374 3d27 6e65 7765 7227  w', dest='newer'
+000409b0: 2c20 7479 7065 3d69 6e74 2c20 6163 7469  , type=int, acti
+000409c0: 6f6e 3d27 7374 6f72 6527 2c20 6465 6661  on='store', defa
+000409d0: 756c 743d 302c 0a20 2020 2020 2020 2020  ult=0,.         
+000409e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000409f0: 2020 2020 2020 2020 2020 2068 656c 703d             help=
+00040a00: 7465 7874 7772 6170 2e64 6564 656e 7428  textwrap.dedent(
+00040a10: 6627 2727 0a20 2020 2020 2020 2020 2020  f'''.           
+00040a20: 2020 2020 2041 7263 6869 7665 2066 6f6c       Archive fol
+00040a30: 6465 7273 2074 6861 7420 6861 7665 2062  ders that have b
+00040a40: 6565 6e20 6163 6365 7373 6564 2077 6974  een accessed wit
+00040a50: 6869 6e20 7468 6520 6c61 7374 200a 2020  hin the last .  
+00040a60: 2020 2020 2020 2020 2020 2020 2020 3c64                <d
+00040a70: 6179 733e 2e20 286f 7074 696f 6e61 6c6c  ays>. (optionall
+00040a80: 7920 7365 7420 2d2d 6d74 696d 6520 746f  y set --mtime to
+00040a90: 2073 656c 6563 7420 666f 6c64 6572 7320   select folders 
+00040aa0: 7468 6174 0a20 2020 2020 2020 2020 2020  that.           
+00040ab0: 2020 2020 2068 6176 6520 6e6f 7420 6265       have not be
+00040ac0: 656e 206d 6f64 6966 6965 6420 6d6f 7265  en modified more
+00040ad0: 2074 6861 6e20 3c64 6179 733e 292e 2054   than <days>). T
+00040ae0: 6869 7320 6f70 7469 6f6e 0a20 2020 2020  his option.     
+00040af0: 2020 2020 2020 2020 2020 2077 6f72 6b73             works
+00040b00: 2069 6e20 636f 6e6a 756e 6374 696f 6e20   in conjunction 
+00040b10: 7769 7468 202d 2d6c 6172 6765 7220 3c47  with --larger <G
+00040b20: 6942 3e2e 2049 6620 626f 7468 200a 2020  iB>. If both .  
+00040b30: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+00040b40: 7469 6f6e 7320 6172 6520 7365 7420 6672  tions are set fr
+00040b50: 6f73 7465 7220 7769 6c6c 2070 7269 6e74  oster will print
+00040b60: 2061 2063 6f6d 6d61 6e64 2074 6861 7420   a command that 
+00040b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040b80: 2061 6c6c 6f77 7320 796f 7520 746f 2061   allows you to a
+00040b90: 7263 6869 7665 2061 6c6c 206d 6174 6368  rchive all match
+00040ba0: 696e 6720 666f 6c64 6572 7320 6174 206f  ing folders at o
+00040bb0: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00040bc0: 2027 2727 2929 0a0a 2020 2020 2020 2020   '''))..        
+00040bd0: 7061 7273 6572 5f61 7263 6869 7665 2e61  parser_archive.a
+00040be0: 6464 5f61 7267 756d 656e 7428 272d 6e27  dd_argument('-n'
+00040bf0: 2c20 272d 2d6e 6968 272c 2064 6573 743d  , '--nih', dest=
+00040c00: 276e 6968 272c 2061 6374 696f 6e3d 2773  'nih', action='s
+00040c10: 746f 7265 5f74 7275 6527 2c0a 2020 2020  tore_true',.    
+00040c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c40: 6865 6c70 3d22 5365 6172 6368 2061 6e64  help="Search and
+00040c50: 204c 696e 6b20 4d65 7461 6461 7461 2066   Link Metadata f
+00040c60: 726f 6d20 4e49 4820 5265 706f 7274 6572  rom NIH Reporter
+00040c70: 2229 0a0a 2020 2020 2020 2020 7061 7273  ")..        pars
+00040c80: 6572 5f61 7263 6869 7665 2e61 6464 5f61  er_archive.add_a
+00040c90: 7267 756d 656e 7428 272d 6927 2c20 272d  rgument('-i', '-
+00040ca0: 2d6e 6968 2d72 6566 272c 2064 6573 743d  -nih-ref', dest=
+00040cb0: 276e 6968 7265 6627 2c20 6163 7469 6f6e  'nihref', action
+00040cc0: 3d27 7374 6f72 6527 2c20 6465 6661 756c  ='store', defaul
+00040cd0: 743d 2727 2c0a 2020 2020 2020 2020 2020  t='',.          
+00040ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040cf0: 2020 2020 2020 2020 2020 6865 6c70 3d22            help="
+00040d00: 5573 6520 4e49 4820 5265 706f 7274 6572  Use NIH Reporter
+00040d10: 2072 6566 6572 656e 6365 2066 6f72 2074   reference for t
+00040d20: 6865 2063 7572 7265 6e74 2061 7263 6869  he current archi
+00040d30: 7665 2229 0a0a 2020 2020 2020 2020 7061  ve")..        pa
+00040d40: 7273 6572 5f61 7263 6869 7665 2e61 6464  rser_archive.add
+00040d50: 5f61 7267 756d 656e 7428 272d 6d27 2c20  _argument('-m', 
+00040d60: 272d 2d6d 7469 6d65 272c 2064 6573 743d  '--mtime', dest=
+00040d70: 2761 6765 6d74 696d 6527 2c20 6163 7469  'agemtime', acti
+00040d80: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
+00040d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040db0: 2020 2020 2068 656c 703d 2255 7365 206d       help="Use m
+00040dc0: 6f64 6966 6965 6420 6669 6c65 2074 696d  odified file tim
+00040dd0: 6520 286d 7469 6d65 2920 696e 7374 6561  e (mtime) instea
+00040de0: 6420 6f66 2061 6363 6573 7365 6420 7469  d of accessed ti
+00040df0: 6d65 2028 6174 696d 6529 2229 0a0a 2020  me (atime)")..  
+00040e00: 2020 2020 2020 7061 7273 6572 5f61 7263        parser_arc
+00040e10: 6869 7665 2e61 6464 5f61 7267 756d 656e  hive.add_argumen
+00040e20: 7428 272d 7227 2c20 272d 2d72 6563 7572  t('-r', '--recur
+00040e30: 7369 7665 272c 2064 6573 743d 2772 6563  sive', dest='rec
+00040e40: 7572 7369 7665 272c 2061 6374 696f 6e3d  ursive', action=
+00040e50: 2773 746f 7265 5f74 7275 6527 2c0a 2020  'store_true',.  
+00040e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e80: 2020 6865 6c70 3d22 4172 6368 6976 6520    help="Archive 
+00040e90: 7468 6520 6375 7272 656e 7420 666f 6c64  the current fold
+00040ea0: 6572 2061 6e64 2061 6c6c 2073 7562 2d66  er and all sub-f
+00040eb0: 6f6c 6465 7273 2229 0a0a 2020 2020 2020  olders")..      
+00040ec0: 2020 7061 7273 6572 5f61 7263 6869 7665    parser_archive
+00040ed0: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
+00040ee0: 7327 2c20 272d 2d72 6573 6574 272c 2064  s', '--reset', d
+00040ef0: 6573 743d 2772 6573 6574 272c 2061 6374  est='reset', act
+00040f00: 696f 6e3d 2773 746f 7265 5f74 7275 6527  ion='store_true'
+00040f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00040f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f30: 2020 2020 2020 6865 6c70 3d74 6578 7477        help=textw
+00040f40: 7261 702e 6465 6465 6e74 2866 2727 270a  rap.dedent(f'''.
+00040f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f80: 2020 2020 2020 2020 5468 6973 2077 696c          This wil
+00040f90: 6c20 6e6f 7420 646f 776e 6c6f 6164 2061  l not download a
+00040fa0: 6e79 2064 6174 612c 2062 7574 2072 6563  ny data, but rec
+00040fb0: 7573 6976 656c 7920 7265 7365 7420 6120  usively reset a 
+00040fc0: 666f 6c64 6572 0a20 2020 2020 2020 2020  folder.         
+00040fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ff0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00041000: 726f 6d20 7072 6576 696f 7573 2028 652e  rom previous (e.
+00041010: 672e 2066 6169 6c65 6429 2061 7263 6869  g. failed) archi
+00041020: 7669 6e67 2061 7474 656d 7074 2e0a 2020  ving attempt..  
+00041030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041060: 2020 2020 2020 4974 2077 696c 6c20 6465        It will de
+00041070: 6c65 7465 202e 6672 6f73 7465 722e 6d64  lete .froster.md
+00041080: 3573 756d 2061 6e64 2065 7874 7261 6374  5sum and extract
+00041090: 2046 726f 7374 6572 2e73 6d61 6c6c 6669   Froster.smallfi
+000410a0: 6c65 732e 7461 720a 2020 2020 2020 2020  les.tar.        
+000410b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000410c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000410d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000410e0: 2727 2729 290a 0a20 2020 2020 2020 2070  '''))..        p
+000410f0: 6172 7365 725f 6172 6368 6976 652e 6164  arser_archive.ad
+00041100: 645f 6172 6775 6d65 6e74 2827 2d74 272c  d_argument('-t',
+00041110: 2027 2d2d 6e6f 2d74 6172 272c 2064 6573   '--no-tar', des
+00041120: 743d 276e 6f74 6172 272c 2061 6374 696f  t='notar', actio
+00041130: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
+00041140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041160: 2020 2020 6865 6c70 3d22 446f 206e 6f74      help="Do not
+00041170: 206d 6f76 6520 736d 616c 6c20 6669 6c65   move small file
+00041180: 7320 746f 2074 6172 2066 696c 6520 6265  s to tar file be
+00041190: 666f 7265 2061 7263 6869 7669 6e67 2229  fore archiving")
+000411a0: 0a0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+000411b0: 5f61 7263 6869 7665 2e61 6464 5f61 7267  _archive.add_arg
+000411c0: 756d 656e 7428 272d 6427 2c20 272d 2d64  ument('-d', '--d
+000411d0: 7279 2d72 756e 272c 2064 6573 743d 2764  ry-run', dest='d
+000411e0: 7279 7275 6e27 2c20 6163 7469 6f6e 3d27  ryrun', action='
+000411f0: 7374 6f72 655f 7472 7565 272c 0a20 2020  store_true',.   
+00041200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041220: 2068 656c 703d 2245 7865 6375 7465 2061   help="Execute a
+00041230: 2074 6573 7420 6172 6368 6976 6520 7769   test archive wi
+00041240: 7468 6f75 7420 6163 7475 616c 6c79 2063  thout actually c
+00041250: 6f70 7969 6e67 2074 6865 2064 6174 6122  opying the data"
+00041260: 290a 0a20 2020 2020 2020 2023 202a 2a2a  )..        # ***
+00041270: 0a0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+00041280: 5f64 656c 6574 6520 3d20 7375 6270 6172  _delete = subpar
+00041290: 7365 7273 2e61 6464 5f70 6172 7365 7228  sers.add_parser(
+000412a0: 2764 656c 6574 6527 2c20 616c 6961 7365  'delete', aliase
+000412b0: 733d 5b27 6465 6c27 5d2c 0a20 2020 2020  s=['del'],.     
+000412c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000412d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000412e0: 2020 2020 2020 2020 2068 656c 703d 7465           help=te
+000412f0: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
+00041300: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+00041310: 2020 2052 656d 6f76 6520 6461 7461 2066     Remove data f
+00041320: 726f 6d20 6120 6c6f 6361 6c20 6669 6c65  rom a local file
+00041330: 7379 7374 656d 2066 6f6c 6465 7220 7468  system folder th
+00041340: 6174 2068 6173 2062 6565 6e20 636f 6e66  at has been conf
+00041350: 6972 6d65 6420 746f 0a20 2020 2020 2020  irmed to.       
+00041360: 2020 2020 2020 2020 2062 6520 6172 6368           be arch
+00041370: 6976 6564 2028 7468 726f 7567 6820 6368  ived (through ch
+00041380: 6563 6b73 756d 2076 6572 6966 6963 6174  ecksum verificat
+00041390: 696f 6e29 2e20 5573 6520 7468 6973 2069  ion). Use this i
+000413a0: 6e73 7465 6164 206f 6620 6465 6c65 7469  nstead of deleti
+000413b0: 6e67 206d 616e 7561 6c6c 790a 2020 2020  ng manually.    
+000413c0: 2020 2020 2020 2020 2727 2729 2c20 666f          '''), fo
+000413d0: 726d 6174 7465 725f 636c 6173 733d 6172  rmatter_class=ar
+000413e0: 6770 6172 7365 2e52 6177 5465 7874 4865  gparse.RawTextHe
+000413f0: 6c70 466f 726d 6174 7465 7229 0a0a 2020  lpFormatter)..  
+00041400: 2020 2020 2020 7061 7273 6572 5f64 656c        parser_del
+00041410: 6574 652e 6164 645f 6172 6775 6d65 6e74  ete.add_argument
+00041420: 2827 666f 6c64 6572 7327 2c20 6163 7469  ('folders', acti
+00041430: 6f6e 3d27 7374 6f72 6527 2c20 6465 6661  on='store', defa
+00041440: 756c 743d 5b5d 2c20 206e 6172 6773 3d27  ult=[],  nargs='
+00041450: 2a27 2c0a 2020 2020 2020 2020 2020 2020  *',.            
+00041460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041470: 2020 2020 2020 2068 656c 703d 2766 6f6c         help='fol
+00041480: 6465 7273 2028 7365 7061 7261 7465 6420  ders (separated 
+00041490: 6279 2073 7061 6365 2920 6672 6f6d 2077  by space) from w
+000414a0: 6869 6368 2079 6f75 2077 6f75 6c64 206c  hich you would l
+000414b0: 696b 6520 746f 2064 656c 6574 6520 6669  ike to delete fi
+000414c0: 6c65 732c 2027 202b 0a20 2020 2020 2020  les, ' +.       
+000414d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000414e0: 2020 2020 2020 2020 2020 2020 2779 6f75              'you
+000414f0: 2063 616e 206f 6e6c 7920 6465 6c65 7465   can only delete
+00041500: 2066 696c 6573 2074 6861 7420 6861 7665   files that have
+00041510: 2062 6565 6e20 6172 6368 6976 6564 2729   been archived')
+00041520: 0a0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+00041530: 5f64 656c 6574 652e 6164 645f 6172 6775  _delete.add_argu
+00041540: 6d65 6e74 2827 2d72 272c 2027 2d2d 7265  ment('-r', '--re
+00041550: 6375 7273 6976 6527 2c20 6465 7374 3d27  cursive', dest='
+00041560: 7265 6375 7273 6976 6527 2c20 6163 7469  recursive', acti
+00041570: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
+00041580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000415a0: 2020 2020 6865 6c70 3d22 4465 6c65 7465      help="Delete
+000415b0: 2074 6865 2063 7572 7265 6e74 2061 7263   the current arc
+000415c0: 6869 7665 6420 666f 6c64 6572 2061 6e64  hived folder and
+000415d0: 2061 6c6c 2061 7263 6869 7665 6420 7375   all archived su
+000415e0: 622d 666f 6c64 6572 7322 290a 0a20 2020  b-folders")..   
+000415f0: 2020 2020 2023 202a 2a2a 0a0a 2020 2020       # ***..    
+00041600: 2020 2020 7061 7273 6572 5f6d 6f75 6e74      parser_mount
+00041610: 203d 2073 7562 7061 7273 6572 732e 6164   = subparsers.ad
+00041620: 645f 7061 7273 6572 2827 6d6f 756e 7427  d_parser('mount'
+00041630: 2c20 616c 6961 7365 733d 5b27 756d 6f75  , aliases=['umou
+00041640: 6e74 275d 2c0a 2020 2020 2020 2020 2020  nt'],.          
+00041650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041670: 2020 2068 656c 703d 7465 7874 7772 6170     help=textwrap
+00041680: 2e64 6564 656e 7428 6627 2727 0a20 2020  .dedent(f'''.   
+00041690: 2020 2020 2020 2020 2020 2020 204d 6f75               Mou
+000416a0: 6e74 206f 7220 756e 6d6f 756e 7420 7468  nt or unmount th
+000416b0: 6520 7265 6d6f 7465 2053 3320 6f72 2047  e remote S3 or G
+000416c0: 6c61 6369 6572 2073 746f 7261 6765 2069  lacier storage i
+000416d0: 6e20 796f 7572 206c 6f63 616c 2066 696c  n your local fil
+000416e0: 6520 7379 7374 656d 0a20 2020 2020 2020  e system.       
+000416f0: 2020 2020 2020 2020 2061 7420 7468 6520           at the 
+00041700: 6c6f 6361 7469 6f6e 206f 6620 7468 6520  location of the 
+00041710: 6f72 6967 696e 616c 2066 6f6c 6465 722e  original folder.
+00041720: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
+00041730: 292c 2066 6f72 6d61 7474 6572 5f63 6c61  ), formatter_cla
+00041740: 7373 3d61 7267 7061 7273 652e 5261 7754  ss=argparse.RawT
+00041750: 6578 7448 656c 7046 6f72 6d61 7474 6572  extHelpFormatter
+00041760: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+00041770: 725f 6d6f 756e 742e 6164 645f 6172 6775  r_mount.add_argu
+00041780: 6d65 6e74 2827 666f 6c64 6572 7327 2c20  ment('folders', 
+00041790: 6163 7469 6f6e 3d27 7374 6f72 6527 2c20  action='store', 
+000417a0: 6465 6661 756c 743d 5b5d 2c20 206e 6172  default=[],  nar
+000417b0: 6773 3d27 2a27 2c0a 2020 2020 2020 2020  gs='*',.        
+000417c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000417d0: 2020 2020 2020 2020 2020 6865 6c70 3d27            help='
+000417e0: 6172 6368 6976 6564 2066 6f6c 6465 7273  archived folders
+000417f0: 2028 7365 7061 7261 7465 6420 6279 2073   (separated by s
+00041800: 7061 6365 2920 7768 6963 6820 796f 7520  pace) which you 
+00041810: 776f 756c 6420 6c69 6b65 2074 6f20 6d6f  would like to mo
+00041820: 756e 742e 2720 2b0a 2020 2020 2020 2020  unt.' +.        
+00041830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041840: 2020 2020 2020 2020 2020 2727 290a 2020            '').  
+00041850: 2020 2020 2020 7061 7273 6572 5f6d 6f75        parser_mou
+00041860: 6e74 2e61 6464 5f61 7267 756d 656e 7428  nt.add_argument(
+00041870: 272d 6127 2c20 272d 2d61 7773 272c 2064  '-a', '--aws', d
+00041880: 6573 743d 2761 7773 272c 2061 6374 696f  est='aws', actio
+00041890: 6e3d 2773 746f 7265 5f74 7275 6527 2c0a  n='store_true',.
+000418a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000418b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000418c0: 2020 6865 6c70 3d22 4d6f 756e 7420 666f    help="Mount fo
+000418d0: 6c64 6572 206f 6e20 6e65 7720 4543 3220  lder on new EC2 
+000418e0: 696e 7374 616e 6365 2069 6e73 7465 6164  instance instead
+000418f0: 206f 6620 6c6f 6361 6c20 6d61 6368 696e   of local machin
+00041900: 6522 290a 0a20 2020 2020 2020 2070 6172  e")..        par
+00041910: 7365 725f 6d6f 756e 742e 6164 645f 6172  ser_mount.add_ar
+00041920: 6775 6d65 6e74 2827 2d6c 272c 2027 2d2d  gument('-l', '--
+00041930: 6c69 7374 272c 2064 6573 743d 276c 6973  list', dest='lis
+00041940: 7427 2c20 6163 7469 6f6e 3d27 7374 6f72  t', action='stor
+00041950: 655f 7472 7565 272c 0a20 2020 2020 2020  e_true',.       
+00041960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041970: 2020 2020 2020 2020 2020 2068 656c 703d             help=
+00041980: 224c 6973 7420 616c 6c20 6d6f 756e 7465  "List all mounte
+00041990: 6420 666f 6c64 6572 7322 290a 0a20 2020  d folders")..   
+000419a0: 2020 2020 2070 6172 7365 725f 6d6f 756e       parser_moun
+000419b0: 742e 6164 645f 6172 6775 6d65 6e74 2827  t.add_argument('
+000419c0: 2d6d 272c 2027 2d2d 6d6f 756e 742d 706f  -m', '--mount-po
+000419d0: 696e 7427 2c20 6465 7374 3d27 6d6f 756e  int', dest='moun
+000419e0: 7470 6f69 6e74 272c 2061 6374 696f 6e3d  tpoint', action=
+000419f0: 2773 746f 7265 272c 2064 6566 6175 6c74  'store', default
+00041a00: 3d27 272c 0a20 2020 2020 2020 2020 2020  ='',.           
+00041a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041a20: 2020 2020 2020 2068 656c 703d 2770 6963         help='pic
+00041a30: 6b20 6120 6375 7374 6f6d 206d 6f75 6e74  k a custom mount
+00041a40: 2070 6f69 6e74 2c20 7468 6973 206f 6e6c   point, this onl
+00041a50: 7920 776f 726b 7320 6966 2079 6f75 2073  y works if you s
+00041a60: 656c 6563 7420 6120 7369 6e67 6c65 2066  elect a single f
+00041a70: 6f6c 6465 722e 2729 0a0a 2020 2020 2020  older.')..      
+00041a80: 2020 2320 2a2a 2a0a 0a20 2020 2020 2020    # ***..       
+00041a90: 2070 6172 7365 725f 7265 7374 6f72 6520   parser_restore 
+00041aa0: 3d20 7375 6270 6172 7365 7273 2e61 6464  = subparsers.add
+00041ab0: 5f70 6172 7365 7228 2772 6573 746f 7265  _parser('restore
+00041ac0: 272c 2061 6c69 6173 6573 3d5b 2772 7374  ', aliases=['rst
+00041ad0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00041ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041b00: 2020 2068 656c 703d 7465 7874 7772 6170     help=textwrap
+00041b10: 2e64 6564 656e 7428 6627 2727 0a20 2020  .dedent(f'''.   
+00041b20: 2020 2020 2020 2020 2020 2020 2052 6573               Res
+00041b30: 746f 7265 2064 6174 6120 6672 6f6d 2041  tore data from A
+00041b40: 5753 2047 6c61 6369 6572 2074 6f20 4157  WS Glacier to AW
+00041b50: 5320 5333 204f 6e65 205a 6f6e 652d 4941  S S3 One Zone-IA
+00041b60: 2e20 596f 7520 646f 206e 6f74 206e 6565  . You do not nee
+00041b70: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00041b80: 2020 746f 2064 6f77 6e6c 6f61 6420 616c    to download al
+00041b90: 6c20 6461 7461 2074 6f20 6c6f 6361 6c20  l data to local 
+00041ba0: 7374 6f72 6167 6520 6166 7465 7220 7468  storage after th
+00041bb0: 6520 7265 7374 6f72 6520 6973 2063 6f6d  e restore is com
+00041bc0: 706c 6574 652e 0a20 2020 2020 2020 2020  plete..         
+00041bd0: 2020 2020 2020 204a 7573 7420 7573 6520         Just use 
+00041be0: 7468 6520 6d6f 756e 7420 7375 6220 636f  the mount sub co
+00041bf0: 6d6d 616e 642e 0a20 2020 2020 2020 2020  mmand..         
+00041c00: 2020 2027 2727 292c 2066 6f72 6d61 7474     '''), formatt
+00041c10: 6572 5f63 6c61 7373 3d61 7267 7061 7273  er_class=argpars
+00041c20: 652e 5261 7754 6578 7448 656c 7046 6f72  e.RawTextHelpFor
+00041c30: 6d61 7474 6572 290a 0a20 2020 2020 2020  matter)..       
+00041c40: 2070 6172 7365 725f 7265 7374 6f72 652e   parser_restore.
+00041c50: 6164 645f 6172 6775 6d65 6e74 2827 666f  add_argument('fo
+00041c60: 6c64 6572 7327 2c20 6163 7469 6f6e 3d27  lders', action='
+00041c70: 7374 6f72 6527 2c20 6465 6661 756c 743d  store', default=
+00041c80: 5b5d 2c20 206e 6172 6773 3d27 2a27 2c0a  [],  nargs='*',.
+00041c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041cb0: 2020 2020 6865 6c70 3d27 666f 6c64 6572      help='folder
+00041cc0: 7320 796f 7520 776f 756c 6420 6c69 6b65  s you would like
+00041cd0: 2074 6f20 746f 2072 6573 746f 7265 2028   to to restore (
+00041ce0: 7365 7061 7261 7465 6420 6279 2073 7061  separated by spa
+00041cf0: 6365 2927 290a 0a20 2020 2020 2020 2070  ce)')..        p
+00041d00: 6172 7365 725f 7265 7374 6f72 652e 6164  arser_restore.ad
+00041d10: 645f 6172 6775 6d65 6e74 2827 2d72 272c  d_argument('-r',
+00041d20: 2027 2d2d 7265 6375 7273 6976 6527 2c20   '--recursive', 
+00041d30: 6465 7374 3d27 7265 6375 7273 6976 6527  dest='recursive'
+00041d40: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
+00041d50: 7472 7565 272c 0a20 2020 2020 2020 2020  true',.         
+00041d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041d70: 2020 2020 2020 2020 2020 2068 656c 703d             help=
+00041d80: 2252 6573 746f 7265 2074 6865 2063 7572  "Restore the cur
+00041d90: 7265 6e74 2061 7263 6869 7665 6420 666f  rent archived fo
+00041da0: 6c64 6572 2061 6e64 2061 6c6c 2061 7263  lder and all arc
+00041db0: 6869 7665 6420 7375 622d 666f 6c64 6572  hived sub-folder
+00041dc0: 7322 290a 0a20 2020 2020 2020 2070 6172  s")..        par
+00041dd0: 7365 725f 7265 7374 6f72 652e 6164 645f  ser_restore.add_
+00041de0: 6172 6775 6d65 6e74 2827 2d64 272c 2027  argument('-d', '
+00041df0: 2d2d 6461 7973 272c 2064 6573 743d 2764  --days', dest='d
+00041e00: 6179 7327 2c20 6163 7469 6f6e 3d27 7374  ays', action='st
+00041e10: 6f72 6527 2c20 6465 6661 756c 743d 3330  ore', default=30
+00041e20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00041e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041e40: 2020 2020 2020 6865 6c70 3d27 4e75 6d62        help='Numb
+00041e50: 6572 206f 6620 6461 7973 2074 6f20 6b65  er of days to ke
+00041e60: 6570 2064 6174 6120 696e 2053 3320 4f6e  ep data in S3 On
+00041e70: 6520 5a6f 6e65 2d49 4120 7374 6f72 6167  e Zone-IA storag
+00041e80: 6520 6174 2024 3130 2f54 6942 2f6d 6f6e  e at $10/TiB/mon
+00041e90: 7468 2028 6465 6661 756c 743a 2033 3029  th (default: 30)
+00041ea0: 2729 0a0a 2020 2020 2020 2020 7061 7273  ')..        pars
+00041eb0: 6572 5f72 6573 746f 7265 2e61 6464 5f61  er_restore.add_a
+00041ec0: 7267 756d 656e 7428 272d 6f27 2c20 272d  rgument('-o', '-
+00041ed0: 2d72 6574 7269 6576 652d 6f70 7427 2c20  -retrieve-opt', 
+00041ee0: 6465 7374 3d27 7265 7472 6965 7665 6f70  dest='retrieveop
+00041ef0: 7427 2c20 6163 7469 6f6e 3d27 7374 6f72  t', action='stor
+00041f00: 6527 2c20 6465 6661 756c 743d 2742 756c  e', default='Bul
+00041f10: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
+00041f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041f30: 2020 2020 2020 2020 6865 6c70 3d74 6578          help=tex
+00041f40: 7477 7261 702e 6465 6465 6e74 2866 2727  twrap.dedent(f''
+00041f50: 270a 2020 2020 2020 2020 2020 2020 4d6f  '.            Mo
+00041f60: 7265 2069 6e66 6f72 6d61 7469 6f6e 2061  re information a
+00041f70: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00041f80: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
+00041f90: 6177 732e 616d 617a 6f6e 2e63 6f6d 2f41  aws.amazon.com/A
+00041fa0: 6d61 7a6f 6e53 332f 6c61 7465 7374 2f75  mazonS3/latest/u
+00041fb0: 7365 7267 7569 6465 2f72 6573 746f 7269  serguide/restori
+00041fc0: 6e67 2d6f 626a 6563 7473 2d72 6574 7269  ng-objects-retri
+00041fd0: 6576 616c 2d6f 7074 696f 6e73 2e68 746d  eval-options.htm
+00041fe0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00041ff0: 2020 6874 7470 733a 2f2f 6177 732e 616d    https://aws.am
+00042000: 617a 6f6e 2e63 6f6d 2f65 732f 7333 2f70  azon.com/es/s3/p
+00042010: 7269 6369 6e67 2f0a 0a20 2020 2020 2020  ricing/..       
+00042020: 2020 2020 2053 3320 474c 4143 4945 5220       S3 GLACIER 
+00042030: 4445 4550 2041 5243 4849 5645 206f 7220  DEEP ARCHIVE or 
+00042040: 5333 2049 4e54 454c 4c49 4745 542d 5449  S3 INTELLIGET-TI
+00042050: 4552 494e 4720 4445 4550 2041 5243 4849  ERING DEEP ARCHI
+00042060: 5645 2041 4343 4553 530a 2020 2020 2020  VE ACCESS.      
+00042070: 2020 2020 2020 2020 2020 4275 6c6b 3a0a            Bulk:.
+00042080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042090: 2020 2020 2d20 5769 7468 696e 2034 3820      - Within 48 
+000420a0: 686f 7572 7320 7265 7472 6965 7661 6c20  hours retrieval 
+000420b0: 2020 2020 2020 2020 2020 203c 2d2d 2064             <-- d
+000420c0: 6566 6175 6c74 0a20 2020 2020 2020 2020  efault.         
+000420d0: 2020 2020 2020 2020 2020 202d 2063 6f73             - cos
+000420e0: 7473 206f 6620 2432 2e35 3020 7065 7220  ts of $2.50 per 
+000420f0: 5469 420a 2020 2020 2020 2020 2020 2020  TiB.            
+00042100: 2020 2020 5374 616e 6461 7264 3a0a 2020      Standard:.  
+00042110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042120: 2020 2d20 5769 7468 696e 2031 3220 686f    - Within 12 ho
+00042130: 7572 7320 7265 7472 6965 7661 6c0a 2020  urs retrieval.  
+00042140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042150: 2020 2d20 636f 7374 7320 6f66 2024 3130    - costs of $10
+00042160: 2070 6572 2054 6942 0a20 2020 2020 2020   per TiB.       
+00042170: 2020 2020 2020 2020 2045 7870 6564 6974           Expedit
+00042180: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00042190: 2020 2020 2020 2020 2d20 392d 3132 2068          - 9-12 h
+000421a0: 6f75 7273 2072 6574 7269 6576 616c 0a20  ours retrieval. 
+000421b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000421c0: 2020 202d 2063 6f73 7473 206f 6620 2433     - costs of $3
+000421d0: 3020 7065 7220 5469 420a 2020 2020 2020  0 per TiB.      
+000421e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000421f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042210: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00042220: 5333 2047 4c41 4349 4552 2046 4c45 5849  S3 GLACIER FLEXI
+00042230: 424c 4520 5245 5452 4945 5641 4c20 6f72  BLE RETRIEVAL or
+00042240: 2053 3320 494e 5445 4c4c 4947 4554 2d54   S3 INTELLIGET-T
+00042250: 4945 5249 4e47 2041 5243 4849 5645 2041  IERING ARCHIVE A
+00042260: 4343 4553 530a 2020 2020 2020 2020 2020  CCESS.          
+00042270: 2020 2020 2020 4275 6c6b 3a0a 2020 2020        Bulk:.    
+00042280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042290: 2d20 352d 3132 2068 6f75 7273 2072 6574  - 5-12 hours ret
+000422a0: 7269 6576 616c 0a20 2020 2020 2020 2020  rieval.         
+000422b0: 2020 2020 2020 2020 2020 202d 2063 6f73             - cos
+000422c0: 7473 206f 6620 2432 2e35 3020 7065 7220  ts of $2.50 per 
+000422d0: 5469 420a 2020 2020 2020 2020 2020 2020  TiB.            
+000422e0: 2020 2020 5374 616e 6461 7264 3a0a 2020      Standard:.  
+000422f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042300: 2020 2d20 332d 3520 686f 7572 7320 7265    - 3-5 hours re
+00042310: 7472 6965 7661 6c0a 2020 2020 2020 2020  trieval.        
+00042320: 2020 2020 2020 2020 2020 2020 2d20 636f              - co
+00042330: 7374 7320 6f66 2024 3130 2070 6572 2054  sts of $10 per T
+00042340: 6942 0a20 2020 2020 2020 2020 2020 2020  iB.             
+00042350: 2020 2045 7870 6564 6974 6564 3a0a 2020     Expedited:.  
+00042360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042370: 2020 2d20 312d 3520 6d69 6e75 7465 7320    - 1-5 minutes 
+00042380: 7265 7472 6965 7661 6c0a 2020 2020 2020  retrieval.      
+00042390: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+000423a0: 636f 7374 7320 6f66 2024 3330 2070 6572  costs of $30 per
+000423b0: 2054 6942 0a0a 2020 2020 2020 2020 2020   TiB..          
+000423c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000423d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000423e0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+000423f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042400: 496e 2061 6464 6974 696f 6e20 746f 2074  In addition to t
+00042410: 6865 2072 6574 7269 6576 616c 2063 6f73  he retrieval cos
+00042420: 742c 2041 5753 2077 696c 6c20 6368 6172  t, AWS will char
+00042430: 6765 2079 6f75 2061 626f 7574 0a20 2020  ge you about.   
+00042440: 2020 2020 2020 2020 2020 2020 2024 3130               $10
+00042450: 2f54 6942 2f6d 6f6e 7468 2066 6f72 2074  /TiB/month for t
+00042460: 6865 2064 7572 6174 696f 6e20 796f 7520  he duration you 
+00042470: 6b65 6570 2074 6865 2064 6174 6120 696e  keep the data in
+00042480: 2053 332e 0a20 2020 2020 2020 2020 2020   S3..           
+00042490: 2020 2020 2028 436f 7374 7320 696e 2053       (Costs in S
+000424a0: 756d 6d65 7220 3230 3233 290a 2020 2020  ummer 2023).    
+000424b0: 2020 2020 2020 2020 2020 2020 2727 2729              ''')
+000424c0: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+000424d0: 725f 7265 7374 6f72 652e 6164 645f 6172  r_restore.add_ar
+000424e0: 6775 6d65 6e74 2827 2d61 272c 2027 2d2d  gument('-a', '--
+000424f0: 6177 7327 2c20 6465 7374 3d27 6177 7327  aws', dest='aws'
+00042500: 2c20 6163 7469 6f6e 3d27 7374 6f72 655f  , action='store_
+00042510: 7472 7565 272c 0a20 2020 2020 2020 2020  true',.         
+00042520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042530: 2020 2020 2020 2020 2020 2068 656c 703d             help=
+00042540: 2252 6573 746f 7265 2066 6f6c 6465 7220  "Restore folder 
+00042550: 6f6e 206e 6577 2041 5753 2045 4332 2069  on new AWS EC2 i
+00042560: 6e73 7461 6e63 6520 696e 7374 6561 6420  nstance instead 
+00042570: 6f66 206c 6f63 616c 206d 6163 6869 6e65  of local machine
+00042580: 2229 0a0a 2020 2020 2020 2020 7061 7273  ")..        pars
+00042590: 6572 5f72 6573 746f 7265 2e61 6464 5f61  er_restore.add_a
+000425a0: 7267 756d 656e 7428 272d 6927 2c20 272d  rgument('-i', '-
+000425b0: 2d69 6e73 7461 6e63 652d 7479 7065 272c  -instance-type',
+000425c0: 2064 6573 743d 2769 6e73 7461 6e63 6574   dest='instancet
+000425d0: 7970 6527 2c20 6163 7469 6f6e 3d27 7374  ype', action='st
+000425e0: 6f72 6527 2c20 6465 6661 756c 743d 2222  ore', default=""
+000425f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00042600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042610: 2020 2020 2020 6865 6c70 3d27 5468 6520        help='The 
+00042620: 4543 3220 696e 7374 616e 6365 2074 7970  EC2 instance typ
+00042630: 6520 6973 2061 7574 6f2d 7365 6c65 6374  e is auto-select
+00042640: 6564 2c20 6275 7420 796f 7520 6361 6e20  ed, but you can 
+00042650: 7069 636b 2061 6e79 206f 7468 6572 2074  pick any other t
+00042660: 7970 6520 6865 7265 2729 0a0a 2020 2020  ype here')..    
+00042670: 2020 2020 7061 7273 6572 5f72 6573 746f      parser_resto
+00042680: 7265 2e61 6464 5f61 7267 756d 656e 7428  re.add_argument(
+00042690: 272d 6d27 2c20 272d 2d6d 6f6e 6974 6f72  '-m', '--monitor
+000426a0: 272c 2064 6573 743d 276d 6f6e 6974 6f72  ', dest='monitor
+000426b0: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
+000426c0: 5f74 7275 6527 2c0a 2020 2020 2020 2020  _true',.        
+000426d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000426e0: 2020 2020 2020 2020 2020 2020 6865 6c70              help
+000426f0: 3d22 4d6f 6e69 746f 7220 4543 3220 7365  ="Monitor EC2 se
+00042700: 7276 6572 2066 6f72 2063 6f73 7420 616e  rver for cost an
+00042710: 6420 6964 6c65 2074 696d 652e 2229 0a0a  d idle time.")..
+00042720: 2020 2020 2020 2020 7061 7273 6572 5f72          parser_r
+00042730: 6573 746f 7265 2e61 6464 5f61 7267 756d  estore.add_argum
+00042740: 656e 7428 272d 6c27 2c20 272d 2d6e 6f2d  ent('-l', '--no-
+00042750: 646f 776e 6c6f 6164 272c 2064 6573 743d  download', dest=
+00042760: 276e 6f64 6f77 6e6c 6f61 6427 2c20 6163  'nodownload', ac
+00042770: 7469 6f6e 3d27 7374 6f72 655f 7472 7565  tion='store_true
+00042780: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00042790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427a0: 2020 2020 2020 2068 656c 703d 2273 6b69         help="ski
+000427b0: 7020 646f 776e 6c6f 6164 2074 6f20 6c6f  p download to lo
+000427c0: 6361 6c20 7374 6f72 6167 6520 6166 7465  cal storage afte
+000427d0: 7220 7265 7472 6965 7661 6c20 6672 6f6d  r retrieval from
+000427e0: 2047 6c61 6369 6572 2229 0a0a 2020 2020   Glacier")..    
+000427f0: 2020 2020 2320 2a2a 2a0a 0a20 2020 2020      # ***..     
+00042800: 2020 2070 6172 7365 725f 7373 6820 3d20     parser_ssh = 
+00042810: 7375 6270 6172 7365 7273 2e61 6464 5f70  subparsers.add_p
+00042820: 6172 7365 7228 2773 7368 272c 2061 6c69  arser('ssh', ali
+00042830: 6173 6573 3d5b 2773 6370 275d 2c0a 2020  ases=['scp'],.  
+00042840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042860: 2020 2020 2020 2020 2068 656c 703d 7465           help=te
+00042870: 7874 7772 6170 2e64 6564 656e 7428 6627  xtwrap.dedent(f'
+00042880: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+00042890: 2020 204c 6f67 696e 2074 6f20 616e 2041     Login to an A
+000428a0: 5753 2045 4332 2069 6e73 7461 6e63 6520  WS EC2 instance 
+000428b0: 746f 2077 6869 6368 2064 6174 6120 7761  to which data wa
+000428c0: 7320 7265 7374 6f72 6564 2077 6974 6820  s restored with 
+000428d0: 7468 6520 2d2d 6177 7320 6f70 7469 6f6e  the --aws option
+000428e0: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
+000428f0: 292c 2066 6f72 6d61 7474 6572 5f63 6c61  ), formatter_cla
+00042900: 7373 3d61 7267 7061 7273 652e 5261 7754  ss=argparse.RawT
+00042910: 6578 7448 656c 7046 6f72 6d61 7474 6572  extHelpFormatter
+00042920: 290a 0a20 2020 2020 2020 2070 6172 7365  )..        parse
+00042930: 725f 7373 682e 6164 645f 6172 6775 6d65  r_ssh.add_argume
+00042940: 6e74 2827 2d2d 6c69 7374 272c 2027 2d6c  nt('--list', '-l
+00042950: 272c 2064 6573 743d 276c 6973 7427 2c20  ', dest='list', 
+00042960: 6163 7469 6f6e 3d27 7374 6f72 655f 7472  action='store_tr
+00042970: 7565 272c 2064 6566 6175 6c74 3d46 616c  ue', default=Fal
+00042980: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00042990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000429a0: 2020 2020 6865 6c70 3d22 4c69 7374 2072      help="List r
+000429b0: 756e 6e69 6e67 2046 726f 7374 6572 2041  unning Froster A
+000429c0: 5753 2045 4332 2069 6e73 7461 6e63 6573  WS EC2 instances
+000429d0: 2229 0a0a 2020 2020 2020 2020 7061 7273  ")..        pars
+000429e0: 6572 5f73 7368 2e61 6464 5f61 7267 756d  er_ssh.add_argum
+000429f0: 656e 7428 272d 2d74 6572 6d69 6e61 7465  ent('--terminate
+00042a00: 272c 2027 2d74 272c 2064 6573 743d 2774  ', '-t', dest='t
+00042a10: 6572 6d69 6e61 7465 272c 2061 6374 696f  erminate', actio
+00042a20: 6e3d 2773 746f 7265 272c 2064 6566 6175  n='store', defau
+00042a30: 6c74 3d27 272c 0a20 2020 2020 2020 2020  lt='',.         
+00042a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a50: 2020 2020 2020 206d 6574 6176 6172 3d27         metavar='
+00042a60: 3c68 6f73 746e 616d 653e 272c 2068 656c  <hostname>', hel
+00042a70: 703d 2754 6572 6d69 6e61 7465 2041 5753  p='Terminate AWS
+00042a80: 2045 4332 2069 6e73 7461 6e63 6520 7769   EC2 instance wi
+00042a90: 7468 2074 6869 7320 7075 626c 6963 2049  th this public I
+00042aa0: 5020 4164 6472 6573 732e 2729 0a0a 2020  P Address.')..  
+00042ab0: 2020 2020 2020 7061 7273 6572 5f73 7368        parser_ssh
+00042ac0: 2e61 6464 5f61 7267 756d 656e 7428 2773  .add_argument('s
+00042ad0: 7368 6172 6773 272c 2061 6374 696f 6e3d  shargs', action=
+00042ae0: 2773 746f 7265 272c 2064 6566 6175 6c74  'store', default
+00042af0: 3d5b 5d2c 206e 6172 6773 3d27 2a27 2c0a  =[], nargs='*',.
+00042b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042b20: 6865 6c70 3d27 6d75 6c74 6970 6c65 2061  help='multiple a
+00042b30: 7267 756d 656e 7473 2074 6f20 7373 682f  rguments to ssh/
+00042b40: 7363 7020 7375 6368 2061 7320 686f 7374  scp such as host
+00042b50: 6e61 6d65 206f 7220 7573 6572 4068 6f73  name or user@hos
+00042b60: 746e 616d 6520 6f64 6572 2066 6f6c 6465  tname oder folde
+00042b70: 7227 202b 0a20 2020 2020 2020 2020 2020  r' +.           
+00042b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042b90: 2020 2020 2027 2729 0a0a 2020 2020 2020       '')..      
+00042ba0: 2020 2320 2a2a 2a0a 0a20 2020 2020 2020    # ***..       
+00042bb0: 2070 6172 7365 725f 7570 6461 7465 203d   parser_update =
+00042bc0: 2073 7562 7061 7273 6572 732e 6164 645f   subparsers.add_
+00042bd0: 7061 7273 6572 2827 7570 6461 7465 272c  parser('update',
+00042be0: 2061 6c69 6173 6573 3d5b 2775 7064 275d   aliases=['upd']
+00042bf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00042c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c20: 6865 6c70 3d74 6578 7477 7261 702e 6465  help=textwrap.de
+00042c30: 6465 6e74 2866 2727 270a 2020 2020 2020  dent(f'''.      
+00042c40: 2020 2020 2020 2020 2020 5570 6461 7465            Update
+00042c50: 2066 726f 7374 6572 2074 6f20 7468 6520   froster to the 
+00042c60: 6c61 7465 7374 2076 6572 7369 6f6e 0a20  latest version. 
+00042c70: 2020 2020 2020 2020 2020 2027 2727 292c             '''),
+00042c80: 2066 6f72 6d61 7474 6572 5f63 6c61 7373   formatter_class
+00042c90: 3d61 7267 7061 7273 652e 5261 7754 6578  =argparse.RawTex
+00042ca0: 7448 656c 7046 6f72 6d61 7474 6572 290a  tHelpFormatter).
+00042cb0: 0a20 2020 2020 2020 2070 6172 7365 725f  .        parser_
+00042cc0: 7570 6461 7465 2e61 6464 5f61 7267 756d  update.add_argum
+00042cd0: 656e 7428 272d 2d72 636c 6f6e 6527 2c20  ent('--rclone', 
+00042ce0: 272d 7227 2c20 6465 7374 3d27 7263 6c6f  '-r', dest='rclo
+00042cf0: 6e65 272c 2061 6374 696f 6e3d 2773 746f  ne', action='sto
+00042d00: 7265 5f74 7275 6527 2c0a 2020 2020 2020  re_true',.      
+00042d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d20: 2020 2020 2020 2020 2020 6865 6c70 3d22            help="
+00042d30: 5570 6461 7465 2072 636c 6f6e 6520 746f  Update rclone to
+00042d40: 206c 6174 6573 7473 2076 6572 7369 6f6e   latests version
+00042d50: 2229 0a20 2020 2020 2020 200a 2020 2020  ").        .    
+00042d60: 2020 2020 7265 7475 726e 2070 6172 7365      return parse
+00042d70: 720a 0a0a 2320 544f 444f 3a20 4f48 5355  r...# TODO: OHSU
+00042d80: 2d31 3033 3a20 4d6f 7665 2074 6869 7320  -103: Move this 
+00042d90: 6675 6e63 7469 6f6e 2074 6f20 7574 696c  function to util
+00042da0: 7320 6d6f 6475 6c65 0a23 2054 4f44 4f3a  s module.# TODO:
+00042db0: 204f 4853 552d 3936 3a20 546f 2062 6520   OHSU-96: To be 
+00042dc0: 6368 616e 6765 6420 666f 7220 6120 6c6f  changed for a lo
+00042dd0: 6767 6572 0a0a 0a64 6566 2070 7269 6e74  gger...def print
+00042de0: 6462 6728 2a61 7267 732c 202a 2a6b 7761  dbg(*args, **kwa
+00042df0: 7267 7329 3a0a 2020 2020 6966 2027 6973  rgs):.    if 'is
+00042e00: 5f64 6562 7567 2720 696e 2067 6c6f 6261  _debug' in globa
+00042e10: 6c73 2829 2061 6e64 2069 735f 6465 6275  ls() and is_debu
+00042e20: 673a 0a20 2020 2020 2020 2063 7572 7265  g:.        curre
+00042e30: 6e74 5f66 7261 6d65 203d 2069 6e73 7065  nt_frame = inspe
+00042e40: 6374 2e63 7572 7265 6e74 6672 616d 6528  ct.currentframe(
+00042e50: 290a 2020 2020 2020 2020 6361 6c6c 696e  ).        callin
+00042e60: 675f 6675 6e63 7469 6f6e 203d 2063 7572  g_function = cur
+00042e70: 7265 6e74 5f66 7261 6d65 2e66 5f62 6163  rent_frame.f_bac
+00042e80: 6b2e 665f 636f 6465 2e63 6f5f 6e61 6d65  k.f_code.co_name
+00042e90: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+00042ea0: 2720 4442 4720 7b63 616c 6c69 6e67 5f66  ' DBG {calling_f
+00042eb0: 756e 6374 696f 6e7d 2829 3a27 2c20 6172  unction}():', ar
+00042ec0: 6773 2c20 6b77 6172 6773 290a 0a23 2054  gs, kwargs)..# T
+00042ed0: 4f44 4f3a 204f 4853 552d 3130 333a 204d  ODO: OHSU-103: M
+00042ee0: 6f76 6520 7468 6973 2066 756e 6374 696f  ove this functio
+00042ef0: 6e20 746f 2075 7469 6c73 206d 6f64 756c  n to utils modul
+00042f00: 650a 0a0a 6465 6620 636c 6561 6e5f 7061  e...def clean_pa
+00042f10: 7468 2870 6174 6829 3a0a 2020 2020 7472  th(path):.    tr
+00042f20: 793a 0a20 2020 2020 2020 2069 6620 7061  y:.        if pa
+00042f30: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00042f40: 7265 7475 726e 206f 732e 7061 7468 2e72  return os.path.r
+00042f50: 6561 6c70 6174 6828 6f73 2e70 6174 682e  ealpath(os.path.
+00042f60: 6578 7061 6e64 7573 6572 2870 6174 6829  expanduser(path)
+00042f70: 2e72 7374 7269 7028 6f73 2e70 6174 682e  .rstrip(os.path.
+00042f80: 7365 7029 290a 2020 2020 2020 2020 656c  sep)).        el
+00042f90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00042fa0: 7265 7475 726e 2070 6174 680a 0a20 2020  return path..   
+00042fb0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00042fc0: 6e3a 0a20 2020 2020 2020 2070 7269 6e74  n:.        print
+00042fd0: 5f65 7272 6f72 2829 0a20 2020 2020 2020  _error().       
+00042fe0: 2073 7973 2e65 7869 7428 3129 0a0a 0a64   sys.exit(1)...d
+00042ff0: 6566 2063 6c65 616e 5f70 6174 685f 6c69  ef clean_path_li
+00043000: 7374 2870 6174 6873 293a 0a20 2020 2027  st(paths):.    '
+00043010: 2727 436c 6561 6e20 7061 7468 7320 6279  ''Clean paths by
+00043020: 2065 7870 616e 6469 6e67 2075 7365 7220   expanding user 
+00043030: 616e 6420 7379 6d6c 696e 6b73 2c20 616e  and symlinks, an
+00043040: 6420 7265 6d6f 7669 6e67 2074 7261 696c  d removing trail
+00043050: 696e 6720 736c 6173 6865 732e 2727 270a  ing slashes.'''.
+00043060: 0a20 2020 2069 6620 6e6f 7420 7061 7468  .    if not path
+00043070: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
+00043080: 6e20 5b5d 0a0a 2020 2020 636c 6561 6e65  n []..    cleane
+00043090: 645f 7061 7468 7320 3d20 5b5d 0a0a 2020  d_paths = []..  
+000430a0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
+000430b0: 7468 733a 0a20 2020 2020 2020 2074 7279  ths:.        try
+000430c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000430d0: 4578 7061 6e64 2075 7365 7220 616e 6420  Expand user and 
+000430e0: 7379 6d6c 696e 6b73 2c20 616e 6420 7265  symlinks, and re
+000430f0: 6d6f 7665 2074 7261 696c 696e 6720 736c  move trailing sl
+00043100: 6173 6865 7320 6f6e 6c79 2069 6620 7061  ashes only if pa
+00043110: 7468 2069 7320 6e6f 7420 656d 7074 790a  th is not empty.
+00043120: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00043130: 6174 683a 0a20 2020 2020 2020 2020 2020  ath:.           
+00043140: 2020 2020 2023 2053 706c 6974 2074 6865       # Split the
+00043150: 2070 6174 6820 696e 746f 2069 7473 2063   path into its c
+00043160: 6f6d 706f 6e65 6e74 730a 2020 2020 2020  omponents.      
+00043170: 2020 2020 2020 2020 2020 636c 6561 6e65            cleane
+00043180: 645f 7061 7468 732e 6170 7065 6e64 2863  d_paths.append(c
+00043190: 6c65 616e 5f70 6174 6828 7061 7468 2929  lean_path(path))
+000431a0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+000431b0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+000431c0: 2020 2020 2020 2020 7072 696e 745f 6572          print_er
+000431d0: 726f 7228 290a 2020 2020 2020 2020 2020  ror().          
+000431e0: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+000431f0: 2020 2072 6574 7572 6e20 636c 6561 6e65     return cleane
+00043200: 645f 7061 7468 730a 0a0a 6465 6620 6973  d_paths...def is
+00043210: 5f73 6c75 726d 5f69 6e73 7461 6c6c 6564  _slurm_installed
+00043220: 2829 3a0a 2020 2020 6966 2073 6875 7469  ():.    if shuti
+00043230: 6c2e 7768 6963 6828 2773 6261 7463 6827  l.which('sbatch'
+00043240: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00043250: 6e20 5472 7565 0a20 2020 2065 6c73 653a  n True.    else:
+00043260: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00043270: 4661 6c73 650a 0a0a 6465 6620 6973 5f69  False...def is_i
+00043280: 6e73 6964 655f 736c 7572 6d5f 6a6f 6228  nside_slurm_job(
+00043290: 293a 0a20 2020 2069 6620 6f73 2e67 6574  ):.    if os.get
+000432a0: 656e 7628 2753 4c55 524d 5f4a 4f42 5f49  env('SLURM_JOB_I
+000432b0: 4427 293a 0a20 2020 2020 2020 2072 6574  D'):.        ret
+000432c0: 7572 6e20 5472 7565 0a20 2020 2065 6c73  urn True.    els
+000432d0: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+000432e0: 6e20 4661 6c73 650a 0a0a 6465 6620 7573  n False...def us
+000432f0: 655f 736c 7572 6d28 6e6f 736c 7572 6d5f  e_slurm(noslurm_
+00043300: 666c 6167 293a 0a20 2020 2072 6574 7572  flag):.    retur
+00043310: 6e20 6973 5f73 6c75 726d 5f69 6e73 7461  n is_slurm_insta
+00043320: 6c6c 6564 2829 2061 6e64 206e 6f74 206e  lled() and not n
+00043330: 6f73 6c75 726d 5f66 6c61 6720 616e 6420  oslurm_flag and 
+00043340: 6e6f 7420 6973 5f69 6e73 6964 655f 736c  not is_inside_sl
+00043350: 7572 6d5f 6a6f 6228 290a 0a0a 6465 6620  urm_job()...def 
+00043360: 7072 696e 745f 6572 726f 7228 293a 0a20  print_error():. 
+00043370: 2020 2065 7863 5f74 7970 652c 2065 7863     exc_type, exc
+00043380: 5f76 616c 7565 2c20 6578 635f 7462 203d  _value, exc_tb =
+00043390: 2073 7973 2e65 7863 5f69 6e66 6f28 290a   sys.exc_info().
+000433a0: 2020 2020 7472 6163 6562 6163 6b5f 6465      traceback_de
+000433b0: 7461 696c 7320 3d20 7472 6163 6562 6163  tails = tracebac
+000433c0: 6b2e 6578 7472 6163 745f 7462 2865 7863  k.extract_tb(exc
+000433d0: 5f74 6229 0a0a 2020 2020 2320 4765 7420  _tb)..    # Get 
+000433e0: 7468 6520 6c61 7374 2063 616c 6c20 7374  the last call st
+000433f0: 6163 6b2e 2054 6865 2074 6869 7264 2065  ack. The third e
+00043400: 6c65 6d65 6e74 2069 6e20 7468 6520 7475  lement in the tu
+00043410: 706c 6520 6973 2074 6865 2066 756e 6374  ple is the funct
+00043420: 696f 6e20 6e61 6d65 0a20 2020 2066 756e  ion name.    fun
+00043430: 6374 696f 6e5f 6e61 6d65 203d 2074 7261  ction_name = tra
+00043440: 6365 6261 636b 5f64 6574 6169 6c73 5b2d  ceback_details[-
+00043450: 315d 5b32 5d0a 2020 2020 6669 6c65 5f6e  1][2].    file_n
+00043460: 616d 6520 3d20 6f73 2e70 6174 682e 7370  ame = os.path.sp
+00043470: 6c69 7428 6578 635f 7462 2e74 625f 6672  lit(exc_tb.tb_fr
+00043480: 616d 652e 665f 636f 6465 2e63 6f5f 6669  ame.f_code.co_fi
+00043490: 6c65 6e61 6d65 295b 315d 0a0a 2020 2020  lename)[1]..    
+000434a0: 2320 4368 6563 6b20 6966 2074 6865 2065  # Check if the e
+000434b0: 7863 6570 7469 6f6e 2069 7320 6120 4b65  xception is a Ke
+000434c0: 7962 6f61 7264 496e 7465 7272 7570 740a  yboardInterrupt.
+000434d0: 2020 2020 6966 2065 7863 5f74 7970 6520      if exc_type 
+000434e0: 6973 204b 6579 626f 6172 6449 6e74 6572  is KeyboardInter
+000434f0: 7275 7074 3a0a 2020 2020 2020 2020 7072  rupt:.        pr
+00043500: 696e 7428 6627 5c6e 4b65 7962 6f61 7264  int(f'\nKeyboard
+00043510: 2049 6e74 6572 7275 7074 5c6e 2729 0a20   Interrupt\n'). 
+00043520: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00043530: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00043540: 2020 2020 6627 5c6e 4572 726f 723a 2066      f'\nError: f
+00043550: 696c 6520 7b66 696c 655f 6e61 6d65 7d3a  ile {file_name}:
+00043560: 2066 756e 6374 696f 6e20 7b66 756e 6374   function {funct
+00043570: 696f 6e5f 6e61 6d65 7d3a 206c 696e 6520  ion_name}: line 
+00043580: 7b65 7863 5f74 622e 7462 5f6c 696e 656e  {exc_tb.tb_linen
+00043590: 6f7d 3a20 7b65 7863 5f76 616c 7565 7d5c  o}: {exc_value}\
+000435a0: 6e27 2c20 6669 6c65 3d73 7973 2e73 7464  n', file=sys.std
+000435b0: 6572 7229 0a0a 0a64 6566 206d 6169 6e28  err)...def main(
+000435c0: 293a 0a0a 2020 2020 6966 206e 6f74 2073  ):..    if not s
+000435d0: 7973 2e70 6c61 7466 6f72 6d2e 7374 6172  ys.platform.star
+000435e0: 7473 7769 7468 2827 6c69 6e75 7827 293a  tswith('linux'):
+000435f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00043600: 4672 6f73 7465 7220 6375 7272 656e 746c  Froster currentl
+00043610: 7920 6f6e 6c79 2072 756e 7320 6f6e 204c  y only runs on L
+00043620: 696e 7578 2078 3634 5c6e 2729 0a20 2020  inux x64\n').   
+00043630: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00043640: 0a0a 2020 2020 7472 793a 0a0a 2020 2020  ..    try:..    
+00043650: 2020 2020 2320 4465 636c 6172 696e 6720      # Declaring 
+00043660: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
+00043670: 2020 5441 424c 4543 5356 203d 2027 2720    TABLECSV = '' 
+00043680: 2023 2043 5356 2073 7472 696e 6720 666f   # CSV string fo
+00043690: 7220 4461 7461 5461 626c 650a 2020 2020  r DataTable.    
+000436a0: 2020 2020 5345 4c45 4354 4544 4649 4c45      SELECTEDFILE
+000436b0: 203d 2027 2720 2023 2043 5356 2066 696c   = ''  # CSV fil
+000436c0: 656e 616d 6520 746f 206f 7065 6e20 696e  ename to open in
+000436d0: 2068 6f74 7370 6f74 730a 2020 2020 2020   hotspots.      
+000436e0: 2020 4d41 5848 4f54 5350 4f54 5320 3d20    MAXHOTSPOTS = 
+000436f0: 300a 0a20 2020 2020 2020 2023 2049 6e69  0..        # Ini
+00043700: 7420 436f 6d6d 616e 6473 2063 6c61 7373  t Commands class
+00043710: 0a20 2020 2020 2020 2063 6d64 203d 2043  .        cmd = C
+00043720: 6f6d 6d61 6e64 7328 290a 0a20 2020 2020  ommands()..     
+00043730: 2020 2023 2047 6574 2074 6865 2061 7267     # Get the arg
+00043740: 730a 2020 2020 2020 2020 6172 6773 203d  s.        args =
+00043750: 2063 6d64 2e61 7267 730a 0a20 2020 2020   cmd.args..     
+00043760: 2020 2023 2049 6e69 7420 436f 6e66 6967     # Init Config
+00043770: 204d 616e 6167 6572 2063 6c61 7373 0a20   Manager class. 
+00043780: 2020 2020 2020 2063 6667 203d 2043 6f6e         cfg = Con
+00043790: 6669 674d 616e 6167 6572 2829 0a0a 2020  figManager()..  
+000437a0: 2020 2020 2020 2320 496e 6974 2041 7263        # Init Arc
+000437b0: 6869 7665 7220 636c 6173 730a 2020 2020  hiver class.    
+000437c0: 2020 2020 6172 6368 203d 2041 7263 6869      arch = Archi
+000437d0: 7665 7228 6172 6773 2c20 6366 6729 0a0a  ver(args, cfg)..
+000437e0: 2020 2020 2020 2020 2320 496e 6974 2041          # Init A
+000437f0: 5753 2042 6f74 6f20 636c 6173 730a 2020  WS Boto class.  
+00043800: 2020 2020 2020 6177 7320 3d20 4157 5342        aws = AWSB
+00043810: 6f74 6f28 6172 6773 2c20 6366 672c 2061  oto(args, cfg, a
+00043820: 7263 6829 0a0a 2020 2020 2020 2020 2320  rch)..        # 
+00043830: 5072 696e 7420 6375 7272 656e 7420 7665  Print current ve
+00043840: 7273 696f 6e20 6f66 2066 726f 7374 6572  rsion of froster
+00043850: 0a20 2020 2020 2020 2069 6620 6172 6773  .        if args
+00043860: 2e76 6572 7369 6f6e 3a0a 2020 2020 2020  .version:.      
+00043870: 2020 2020 2020 636d 642e 7072 696e 745f        cmd.print_
+00043880: 7665 7273 696f 6e28 290a 2020 2020 2020  version().      
+00043890: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+000438a0: 650a 0a20 2020 2020 2020 2069 6620 6366  e..        if cf
+000438b0: 672e 6973 5f73 6861 7265 6420 616e 6420  g.is_shared and 
+000438c0: 6366 672e 7368 6172 6564 5f64 6972 3a0a  cfg.shared_dir:.
+000438d0: 2020 2020 2020 2020 2020 2020 6366 672e              cfg.
+000438e0: 6173 7375 7265 5f70 6572 6d69 7373 696f  assure_permissio
+000438f0: 6e73 5f61 6e64 5f67 726f 7570 2863 6667  ns_and_group(cfg
+00043900: 2e73 6861 7265 645f 6469 7229 0a0a 2020  .shared_dir)..  
+00043910: 2020 2020 2020 2320 446f 206e 6f74 2061        # Do not a
+00043920: 6c6c 6f77 206f 7468 6572 2063 6f6d 6d61  llow other comma
+00043930: 6e64 7320 7261 7468 6572 2074 6861 6e20  nds rather than 
+00043940: 636f 6e66 6967 2069 6620 7468 6520 636f  config if the co
+00043950: 6e66 6967 7572 6174 696f 6e20 6973 206e  nfiguration is n
+00043960: 6f74 2073 6574 0a20 2020 2020 2020 2069  ot set.        i
+00043970: 6620 6e6f 7420 6366 672e 636f 6e66 6967  f not cfg.config
+00043980: 7572 6174 696f 6e5f 646f 6e65 2061 6e64  uration_done and
+00043990: 2061 7267 732e 7375 6263 6d64 206e 6f74   args.subcmd not
+000439a0: 2069 6e20 5b27 636f 6e66 6967 272c 2027   in ['config', '
+000439b0: 636e 6627 5d3a 0a20 2020 2020 2020 2020  cnf']:.         
+000439c0: 2020 2070 7269 6e74 2827 5c6e 5741 524e     print('\nWARN
+000439d0: 494e 473a 2046 726f 7374 6572 2069 7320  ING: Froster is 
+000439e0: 6e6f 7420 6675 6c6c 2063 6f6e 6669 6775  not full configu
+000439f0: 7265 6420 7965 743a 2729 0a20 2020 2020  red yet:').     
+00043a00: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
+00043a10: 2020 2075 7365 723a 207b 2264 6f6e 6522     user: {"done"
+00043a20: 2069 6620 6366 672e 7573 6572 5f69 6e69   if cfg.user_ini
+00043a30: 7420 656c 7365 2022 7065 6e64 696e 6722  t else "pending"
+00043a40: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+00043a50: 7072 696e 7428 6627 2020 2020 6177 733a  print(f'    aws:
+00043a60: 207b 2264 6f6e 6522 2069 6620 6366 672e   {"done" if cfg.
+00043a70: 6177 735f 696e 6974 2065 6c73 6520 2270  aws_init else "p
+00043a80: 656e 6469 6e67 227d 2729 0a20 2020 2020  ending"}').     
+00043a90: 2020 2020 2020 2070 7269 6e74 2866 2720         print(f' 
+00043aa0: 2020 2073 333a 207b 2264 6f6e 6522 2069     s3: {"done" i
+00043ab0: 6620 6366 672e 7333 5f69 6e69 7420 656c  f cfg.s3_init el
+00043ac0: 7365 2022 7065 6e64 696e 6722 7d27 290a  se "pending"}').
+00043ad0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00043ae0: 7428 6627 2020 2020 6e69 683a 207b 2264  t(f'    nih: {"d
+00043af0: 6f6e 6522 2069 6620 6366 672e 6e69 685f  one" if cfg.nih_
+00043b00: 696e 6974 2065 6c73 6520 2270 656e 6469  init else "pendi
+00043b10: 6e67 227d 2729 0a20 2020 2020 2020 2020  ng"}').         
+00043b20: 2020 2070 7269 6e74 2866 275c 6e52 756e     print(f'\nRun
+00043b30: 2022 6672 6f73 7465 7220 636f 6e66 6967   "froster config
+00043b40: 202d 2d68 656c 7022 2066 6f72 206d 6f72   --help" for mor
+00043b50: 6520 696e 666f 726d 6174 696f 6e2e 5c6e  e information.\n
+00043b60: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
+00043b70: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+00043b80: 2020 2020 2320 6361 6c6c 2061 2066 756e      # call a fun
+00043b90: 6374 696f 6e20 666f 7220 6561 6368 2073  ction for each s
+00043ba0: 7562 2063 6f6d 6d61 6e64 2069 6e20 6f75  ub command in ou
+00043bb0: 7220 434c 490a 2020 2020 2020 2020 6966  r CLI.        if
+00043bc0: 2061 7267 732e 7375 6263 6d64 2069 6e20   args.subcmd in 
+00043bd0: 5b27 636f 6e66 6967 272c 2027 636e 6627  ['config', 'cnf'
+00043be0: 5d3a 0a20 2020 2020 2020 2020 2020 2063  ]:.            c
+00043bf0: 6d64 2e73 7562 636d 645f 636f 6e66 6967  md.subcmd_config
+00043c00: 2863 6667 2c20 6177 7329 0a20 2020 2020  (cfg, aws).     
+00043c10: 2020 2065 6c69 6620 6172 6773 2e73 7562     elif args.sub
+00043c20: 636d 6420 696e 205b 2769 6e64 6578 272c  cmd in ['index',
+00043c30: 2027 696e 6427 5d3a 0a20 2020 2020 2020   'ind']:.       
+00043c40: 2020 2020 2063 6d64 2e73 7562 636d 645f       cmd.subcmd_
+00043c50: 696e 6465 7828 6366 672c 2061 7263 6829  index(cfg, arch)
+00043c60: 0a20 2020 2020 2020 2065 6c69 6620 6172  .        elif ar
+00043c70: 6773 2e73 7562 636d 6420 696e 205b 2761  gs.subcmd in ['a
+00043c80: 7263 6869 7665 272c 2027 6172 6327 5d3a  rchive', 'arc']:
+00043c90: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00043ca0: 2e73 7562 636d 645f 6172 6368 6976 6528  .subcmd_archive(
+00043cb0: 6172 6368 290a 2020 2020 2020 2020 656c  arch).        el
+00043cc0: 6966 2061 7267 732e 7375 6263 6d64 2069  if args.subcmd i
+00043cd0: 6e20 5b27 7265 7374 6f72 6527 2c20 2772  n ['restore', 'r
+00043ce0: 7374 275d 3a0a 2020 2020 2020 2020 2020  st']:.          
+00043cf0: 2020 636d 642e 7375 6263 6d64 5f72 6573    cmd.subcmd_res
+00043d00: 746f 7265 2861 7263 682c 2061 7773 290a  tore(arch, aws).
+00043d10: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
+00043d20: 732e 7375 6263 6d64 2069 6e20 5b27 6465  s.subcmd in ['de
+00043d30: 6c65 7465 272c 2027 6465 6c27 5d3a 0a20  lete', 'del']:. 
+00043d40: 2020 2020 2020 2020 2020 2063 6d64 2e73             cmd.s
+00043d50: 7562 636d 645f 6465 6c65 7465 2861 7263  ubcmd_delete(arc
+00043d60: 6829 0a20 2020 2020 2020 2065 6c69 6620  h).        elif 
+00043d70: 6172 6773 2e73 7562 636d 6420 696e 205b  args.subcmd in [
+00043d80: 276d 6f75 6e74 272c 2027 6d6e 7427 5d3a  'mount', 'mnt']:
+00043d90: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00043da0: 2e73 7562 636d 645f 6d6f 756e 7428 6172  .subcmd_mount(ar
+00043db0: 6368 290a 2020 2020 2020 2020 656c 6966  ch).        elif
+00043dc0: 2061 7267 732e 7375 6263 6d64 2069 6e20   args.subcmd in 
+00043dd0: 5b27 756d 6f75 6e74 275d 3a0a 2020 2020  ['umount']:.    
+00043de0: 2020 2020 2020 2020 636d 642e 7375 6263          cmd.subc
+00043df0: 6d64 5f75 6d6f 756e 7428 6172 6368 290a  md_umount(arch).
+00043e00: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
+00043e10: 732e 7375 6263 6d64 2069 6e20 5b27 7373  s.subcmd in ['ss
+00043e20: 6827 2c20 2773 6370 275d 3a0a 2020 2020  h', 'scp']:.    
+00043e30: 2020 2020 2020 2020 636d 642e 7375 6263          cmd.subc
+00043e40: 6d64 5f73 7368 2863 6667 2c20 6177 7329  md_ssh(cfg, aws)
+00043e50: 0a20 2020 2020 2020 2065 6c69 6620 6172  .        elif ar
+00043e60: 6773 2e73 7562 636d 6420 696e 205b 2763  gs.subcmd in ['c
+00043e70: 7265 6465 6e74 6961 6c73 272c 2027 6372  redentials', 'cr
+00043e80: 6427 5d3a 0a20 2020 2020 2020 2020 2020  d']:.           
+00043e90: 2063 6d64 2e73 7562 636d 645f 6372 6564   cmd.subcmd_cred
+00043ea0: 656e 7469 616c 7328 6366 672c 2061 7773  entials(cfg, aws
+00043eb0: 290a 2020 2020 2020 2020 656c 6966 2061  ).        elif a
+00043ec0: 7267 732e 7375 6263 6d64 2069 6e20 5b27  rgs.subcmd in ['
+00043ed0: 7570 6461 7465 272c 2027 7570 6427 5d3a  update', 'upd']:
+00043ee0: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00043ef0: 2e73 7562 636d 645f 7570 6461 7465 2829  .subcmd_update()
+00043f00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00043f10: 2020 2020 2020 2020 2020 2063 6d64 2e70             cmd.p
+00043f20: 7269 6e74 5f68 656c 7028 290a 0a20 2020  rint_help()..   
+00043f30: 2020 2020 2061 7773 2e63 6c6f 7365 5f73       aws.close_s
+00043f40: 6573 7369 6f6e 2829 0a0a 2020 2020 6578  ession()..    ex
+00043f50: 6365 7074 204b 6579 626f 6172 6449 6e74  cept KeyboardInt
+00043f60: 6572 7275 7074 3a0a 2020 2020 2020 2020  errupt:.        
+00043f70: 7072 696e 7428 274b 6579 626f 6172 6420  print('Keyboard 
+00043f80: 496e 7465 7272 7570 745c 6e27 290a 0a20  Interrupt\n').. 
+00043f90: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00043fa0: 696f 6e20 6173 2065 7863 3a0a 2020 2020  ion as exc:.    
+00043fb0: 2020 2020 7072 696e 745f 6572 726f 7228      print_error(
+00043fc0: 290a 2020 2020 2020 2020 7379 732e 6578  ).        sys.ex
+00043fd0: 6974 2831 290a 0a0a 6966 205f 5f6e 616d  it(1)...if __nam
+00043fe0: 655f 5f20 3d3d 2022 5f5f 6d61 696e 5f5f  e__ == "__main__
+00043ff0: 223a 0a20 2020 206d 6169 6e28 290a       ":.    main().
```

### Comparing `froster-0.10.1/froster.egg-info/PKG-INFO` & `froster-0.11.0/froster.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,60 +1,56 @@
 Metadata-Version: 2.1
 Name: froster
-Version: 0.10.1
+Version: 0.11.0
+Summary: UNKNOWN
+Home-page: UNKNOWN
 License: MIT
+Platform: UNKNOWN
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: duckdb<1.0
-Requires-Dist: textual<0.60
-Requires-Dist: requests<2.40
-Requires-Dist: boto3<1.40
-Requires-Dist: psutil<6.0
-Requires-Dist: visidata
-Requires-Dist: inquirer
 
 ![image](https://user-images.githubusercontent.com/1427719/235330281-bd876f06-2b2a-46fc-8505-c065bb508973.png)
 
 Froster is a user-friendly archiving tool for teams that move data between higher cost Posix file systems and lower cost S3-like object storage systems such as AWS Glacier. Froster crawls your Posix file system metadata, recommends folders for archiving, generates checksums, and uploads your selections to Glacier or other S3-like storage. It can retrieve data back from the archive using a single command. Additionally, Froster can mount S3/Glacier storage inside your on-premise file system and also restore to an AWS EC2 instance. 
 
 </br>
 
 ## Installation pre-requisite: packages
 
 ### On Debian/Ubuntu
 
 ```
 sudo apt-get update
-sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo apt-get install -y curl pipx git gcc lib32gcc-s1 unzip fuse3
 ```
 
 ### On RHEL 
 
 ```
 sudo yum update
-sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip
+sudo yum install -y curl pipx git gcc lib32gcc-s1 unzip fuse3 python3-devel
 ```
 
 ### On HPC machine
 
 Please contact your administrator to install these packages:
 ```
-curl pipx git gcc lib32gcc-s1 unzip
+curl pipx git gcc lib32gcc-s1 unzip fuse3 python3.xx-devel
 ```
 
 </br>
 
 
 ## Installation
 
 After you installed the pre-requisites, close and open the terminal again to refresh the environment.
 To install Froster, execute the following command into your terminal:
 
 ```
-curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh | bash
+curl -s https://raw.githubusercontent.com/dirkpetersen/froster/main/install.sh?$(date +%s) | bash
 
 ```
 
 ## Update (TODO)
 
 </br>
 
@@ -870,7 +866,9 @@
 Froster is a good on-ramp to Starfish. If many users in your organization end up using Froster, it is time considering Starfish as an alternative but if fewer than a handful users find Froster useful, you may be able to defer your Starfish project until you have a critical mass. You can access many advanced Starfish features through a web browser while Froster has a simple CLI/TUI interface.
 
 ## Discontinuing Froster  
 
 All good things inevitably come to an end. Consider what you might encounter when attempting to restore your data 15 years from now. While AWS Glacier and Rclone will still exist, we cannot guarantee the continued maintenance of components like Textual or DuckDB, or even Froster itself. However, even if certain tools fade away, you can always rely on utilities like Rclone or [Cyberduck](#using-cyberduck-to-browse-glacier) (for smaller amounts of data) to retrieve your data, as it is kept in its original format.   
 
 Alternatively, the shell script [s3-restore.sh](https://github.com/dirkpetersen/froster/blob/main/s3-restore.sh) simplifies this process, driving Rclone with the appropriate settings. Using the command `s3-restore.sh list`, you can view all folders archived in the JSON database `foster-archives.json` (default location: `~/.froster/config/`). To restore a specific folder, simply use the command followed by the desired path, for example: `s3-restore.sh /my/shared/folder`. It's worth noting that system administrators might hesitate to endorse tools written in programming languages they aren't familiar with, such as Python. Fortunately, `s3-restore.sh` is a straightforward bash shell script, easily customizable to suit specific needs. Note: You may have to change the AWS profile in `s3-restore.sh` to a profile you find under `~/.aws`
+
+
```

### Comparing `froster-0.10.1/setup.py` & `froster-0.11.0/setup.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,26 +1,22 @@
 from setuptools import setup, find_packages
 
 with open('README.md', 'r') as f:
     long_description = f.read()
 
+with open('requirements.txt') as f:
+    requirements = f.read().splitlines()
+
+
 setup(
     name='froster',
-    version='0.10.1',
+    version='0.11.0',
     license='MIT',
     packages=find_packages(),
-    install_requires=[
-        'duckdb<1.0',
-        'textual<0.60',
-        'requests<2.40',
-        'boto3<1.40',
-        'psutil<6.0',
-        'visidata',
-        'inquirer'
-    ],
+    install_requires=requirements,
     entry_points={
         'console_scripts': [
             'froster = froster.froster:main'
         ]
     },
     long_description=long_description,
     long_description_content_type='text/markdown',
```


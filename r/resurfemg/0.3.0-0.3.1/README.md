# Comparing `tmp/resurfemg-0.3.0-py3-none-any.whl.zip` & `tmp/resurfemg-0.3.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,32 +1,32 @@
-Zip file size: 52707 bytes, number of entries: 30
--rw-r--r--  2.0 unx       70 b- defN 24-May-27 10:14 resurfemg/__init__.py
--rw-r--r--  2.0 unx       94 b- defN 24-May-27 10:14 resurfemg/__main__.py
--rw-r--r--  2.0 unx      411 b- defN 24-May-27 10:15 resurfemg/__version__.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/cli/__init__.py
--rw-r--r--  2.0 unx     5898 b- defN 24-May-27 10:14 resurfemg/cli/cli.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/config/__init__.py
--rw-r--r--  2.0 unx    15003 b- defN 24-May-27 10:14 resurfemg/config/config.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/data_connector/__init__.py
--rw-r--r--  2.0 unx     6321 b- defN 24-May-27 10:14 resurfemg/data_connector/converter_functions.py
--rw-r--r--  2.0 unx     9456 b- defN 24-May-27 10:14 resurfemg/data_connector/tmsisdk_lite.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/helper_functions/__init__.py
--rw-r--r--  2.0 unx    14374 b- defN 24-May-27 10:14 resurfemg/helper_functions/helper_functions.py
--rw-r--r--  2.0 unx     2493 b- defN 24-May-27 10:14 resurfemg/machine_learning/ml.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/pipelines/__init__.py
--rw-r--r--  2.0 unx    11709 b- defN 24-May-27 10:14 resurfemg/pipelines/pipelines.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/postprocessing/__init__.py
--rw-r--r--  2.0 unx     4289 b- defN 24-May-27 10:14 resurfemg/postprocessing/baseline.py
--rw-r--r--  2.0 unx     5976 b- defN 24-May-27 10:14 resurfemg/postprocessing/event_detection.py
--rw-r--r--  2.0 unx    21086 b- defN 24-May-27 10:14 resurfemg/postprocessing/features.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/preprocessing/__init__.py
--rw-r--r--  2.0 unx    17468 b- defN 24-May-27 10:14 resurfemg/preprocessing/ecg_removal.py
--rw-r--r--  2.0 unx     6250 b- defN 24-May-27 10:14 resurfemg/preprocessing/envelope.py
--rw-r--r--  2.0 unx    13160 b- defN 24-May-27 10:14 resurfemg/preprocessing/filtering.py
--rw-r--r--  2.0 unx       24 b- defN 24-May-27 10:14 resurfemg/visualization/__init__.py
--rw-r--r--  2.0 unx     1411 b- defN 24-May-27 10:14 resurfemg/visualization/visualization.py
--rw-r--r--  2.0 unx    11357 b- defN 24-May-27 10:15 resurfemg-0.3.0.dist-info/LICENSE
--rw-r--r--  2.0 unx    18103 b- defN 24-May-27 10:15 resurfemg-0.3.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-May-27 10:15 resurfemg-0.3.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       10 b- defN 24-May-27 10:15 resurfemg-0.3.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2645 b- defN 24-May-27 10:15 resurfemg-0.3.0.dist-info/RECORD
-30 files, 167868 bytes uncompressed, 48393 bytes compressed:  71.2%
+Zip file size: 52856 bytes, number of entries: 30
+-rw-r--r--  2.0 unx       70 b- defN 24-May-30 13:08 resurfemg/__init__.py
+-rw-r--r--  2.0 unx       94 b- defN 24-May-30 13:08 resurfemg/__main__.py
+-rw-r--r--  2.0 unx      411 b- defN 24-May-30 13:08 resurfemg/__version__.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/cli/__init__.py
+-rw-r--r--  2.0 unx     5898 b- defN 24-May-30 13:08 resurfemg/cli/cli.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/config/__init__.py
+-rw-r--r--  2.0 unx    15003 b- defN 24-May-30 13:08 resurfemg/config/config.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/data_connector/__init__.py
+-rw-r--r--  2.0 unx     6321 b- defN 24-May-30 13:08 resurfemg/data_connector/converter_functions.py
+-rw-r--r--  2.0 unx     9456 b- defN 24-May-30 13:08 resurfemg/data_connector/tmsisdk_lite.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/helper_functions/__init__.py
+-rw-r--r--  2.0 unx    14374 b- defN 24-May-30 13:08 resurfemg/helper_functions/helper_functions.py
+-rw-r--r--  2.0 unx     2493 b- defN 24-May-30 13:08 resurfemg/machine_learning/ml.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/pipelines/__init__.py
+-rw-r--r--  2.0 unx    11709 b- defN 24-May-30 13:08 resurfemg/pipelines/pipelines.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/postprocessing/__init__.py
+-rw-r--r--  2.0 unx     4289 b- defN 24-May-30 13:08 resurfemg/postprocessing/baseline.py
+-rw-r--r--  2.0 unx     7637 b- defN 24-May-30 13:08 resurfemg/postprocessing/event_detection.py
+-rw-r--r--  2.0 unx    21086 b- defN 24-May-30 13:08 resurfemg/postprocessing/features.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/preprocessing/__init__.py
+-rw-r--r--  2.0 unx    17468 b- defN 24-May-30 13:08 resurfemg/preprocessing/ecg_removal.py
+-rw-r--r--  2.0 unx     6250 b- defN 24-May-30 13:08 resurfemg/preprocessing/envelope.py
+-rw-r--r--  2.0 unx    13160 b- defN 24-May-30 13:08 resurfemg/preprocessing/filtering.py
+-rw-r--r--  2.0 unx       24 b- defN 24-May-30 13:08 resurfemg/visualization/__init__.py
+-rw-r--r--  2.0 unx     1411 b- defN 24-May-30 13:08 resurfemg/visualization/visualization.py
+-rw-r--r--  2.0 unx    11357 b- defN 24-May-30 13:08 resurfemg-0.3.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx    18103 b- defN 24-May-30 13:08 resurfemg-0.3.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-30 13:08 resurfemg-0.3.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       10 b- defN 24-May-30 13:08 resurfemg-0.3.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2645 b- defN 24-May-30 13:08 resurfemg-0.3.1.dist-info/RECORD
+30 files, 169529 bytes uncompressed, 48542 bytes compressed:  71.4%
```

## zipnote {}

```diff
@@ -69,23 +69,23 @@
 
 Filename: resurfemg/visualization/__init__.py
 Comment: 
 
 Filename: resurfemg/visualization/visualization.py
 Comment: 
 
-Filename: resurfemg-0.3.0.dist-info/LICENSE
+Filename: resurfemg-0.3.1.dist-info/LICENSE
 Comment: 
 
-Filename: resurfemg-0.3.0.dist-info/METADATA
+Filename: resurfemg-0.3.1.dist-info/METADATA
 Comment: 
 
-Filename: resurfemg-0.3.0.dist-info/WHEEL
+Filename: resurfemg-0.3.1.dist-info/WHEEL
 Comment: 
 
-Filename: resurfemg-0.3.0.dist-info/top_level.txt
+Filename: resurfemg-0.3.1.dist-info/top_level.txt
 Comment: 
 
-Filename: resurfemg-0.3.0.dist-info/RECORD
+Filename: resurfemg-0.3.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## resurfemg/__version__.py

```diff
@@ -8,9 +8,9 @@
     VERSION_TUPLE = object
 
 version: str
 __version__: str
 __version_tuple__: VERSION_TUPLE
 version_tuple: VERSION_TUPLE
 
-__version__ = version = '0.3.0'
-__version_tuple__ = version_tuple = (0, 3, 0)
+__version__ = version = '0.3.1'
+__version_tuple__ = version_tuple = (0, 3, 1)
```

## resurfemg/postprocessing/event_detection.py

```diff
@@ -30,14 +30,16 @@
 
     # Detect the sEAdi on- and offsets
     baseline_crossings_idx = np.nonzero(
         np.diff(np.sign(emg_env - baseline)) != 0)[0]
 
     peak_start_idxs = np.zeros((len(peak_idxs),), dtype=int)
     peak_end_idxs = np.zeros((len(peak_idxs),), dtype=int)
+    valid_starts_bools = np.array([True for _ in range(len(peak_idxs))])
+    valid_ends_bools = np.array([True for _ in range(len(peak_idxs))])
     for peak_nr, peak_idx in enumerate(peak_idxs):
         delta_samples = peak_idx - baseline_crossings_idx[
             baseline_crossings_idx < peak_idx]
         if len(delta_samples) < 1:
             peak_start_idxs[peak_nr] = 0
             peak_end_idxs[peak_nr] = baseline_crossings_idx[
                 baseline_crossings_idx > peak_idx][0]
@@ -46,15 +48,48 @@
 
             peak_start_idxs[peak_nr] = int(baseline_crossings_idx[a])
             if a < len(baseline_crossings_idx) - 1:
                 peak_end_idxs[peak_nr] = int(baseline_crossings_idx[a+1])
             else:
                 peak_end_idxs[peak_nr] = len(emg_env) - 1
 
-    return (peak_idxs, peak_start_idxs, peak_end_idxs)
+        # Evaluate start validity
+        if (peak_nr > 0) and (peak_start_idxs[peak_nr] > peak_idxs[peak_nr]):
+            valid_starts_bools[peak_nr] = False
+
+        # Evaluate end validity
+        if ((peak_nr < (len(peak_idxs)-2))
+                and (valid_ends_bools[peak_nr] > peak_idxs[peak_nr+1])):
+            valid_ends_bools[peak_nr] = False
+
+        # Evaluate conflicts
+        if ((peak_nr > 0)
+                and (peak_start_idxs[peak_nr] <= peak_end_idxs[peak_nr-1])):
+            if valid_starts_bools[peak_nr] is False:
+                # The current start is already labelled as incorrect
+                pass
+            elif valid_ends_bools[peak_nr-1] is False:
+                # The previous end is already labelled as incorrect
+                pass
+            elif ((peak_idx - peak_start_idxs[peak_nr])
+                    > (peak_end_idxs[peak_nr-1] - peak_idxs[peak_nr-1])):
+                # New start is further apart from peak idx than previous end
+                # New start is probably invalid
+                valid_starts_bools[peak_nr] = False
+            else:
+                # Previous end is further apart from peak idx than new start
+                # Previous end is probably invalid
+                valid_ends_bools[peak_nr-1] = False
+
+    valid_peaks = [valid_detections[0] and valid_detections[1]
+                   for valid_detections
+                   in zip(valid_starts_bools, valid_ends_bools)]
+
+    return (peak_idxs, peak_start_idxs, peak_end_idxs,
+            valid_starts_bools, valid_ends_bools, valid_peaks)
 
 
 def onoffpeak_slope_extrapolation(
     signal,
     fs,
     peak_idxs,
     slope_window_s
@@ -105,28 +140,28 @@
                 y_val * fs // (dy_dt_val), dtype=int).astype(np.int64)
 
             start_s = max([0, max_upslope_idx - upslope_idx_ds])
 
         peak_start_idxs[peak_nr] = start_s
 
         if len(max_downslope_idxs[max_downslope_idxs > peak_idx]) < 1:
-            end_s = len(signal)
+            end_s = len(signal)-1
         else:
             if peak_nr > 0:
                 prev_downslope = dsignal_dt[max_downslope_idx]
 
             max_downslope_idx = int(
                 max_downslope_idxs[max_downslope_idxs > peak_idx][0])\
 
             y_val = signal[max_downslope_idx]
             dy_dt_val = dsignal_dt[max_downslope_idx]
             downslope_idx_ds = np.array(
                 y_val * fs // (dy_dt_val), dtype=int).astype(np.int64)
 
-            end_s = min([len(signal), max_downslope_idx - downslope_idx_ds])
+            end_s = min([len(signal)-1, max_downslope_idx - downslope_idx_ds])
 
         peak_end_idxs[peak_nr] = end_s
 
         # Evaluate start validity
         if start_s > peak_idx:
             valid_starts_bools[peak_nr] = False
 
@@ -138,15 +173,15 @@
             valid_ends_bools[peak_nr] = False
 
         # Evaluate conflicts
         if (peak_nr > 0) and (start_s < peak_end_idxs[peak_nr-1]):
             if valid_ends_bools[peak_nr-1] is False:
                 # The previous end is already labelled as incorrect
                 pass
-            elif -new_upslope > prev_downslope:
+            elif new_upslope > -prev_downslope:
                 # New upslope is steeper than previous downslope
                 # Previous downslope is probably invalid
                 valid_ends_bools[peak_nr-1] = False
             else:
                 # Previous downslope is steeper than new upslope
                 # New upslope is probably invalid
                 valid_starts_bools[peak_nr] = False
```

## Comparing `resurfemg-0.3.0.dist-info/LICENSE` & `resurfemg-0.3.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `resurfemg-0.3.0.dist-info/METADATA` & `resurfemg-0.3.1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: resurfemg
-Version: 0.3.0
+Version: 0.3.1
 Summary: A package for analysis of respiratory EMG data
 Maintainer-email: Eline Mos-Oppersma <e.oppersma@utwente.nl>, Rob Warnaar <r.s.p.warnaar@utwente.nl>
 License: Apache-2.0
 Project-URL: Homepage, https://github.com/ReSurfEMG
 Project-URL: Documentation, https://resurfemg.github.io/ReSurfEMG/
 Project-URL: Repository, https://github.com/ReSurfEMG/ReSurfEMG
 Project-URL: Issues, https://github.com/ReSurfEMG/ReSurfEMG/issues
```

## Comparing `resurfemg-0.3.0.dist-info/RECORD` & `resurfemg-0.3.1.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,30 +1,30 @@
 resurfemg/__init__.py,sha256=0qDO8PiuI6ZwPC2jH4syqDal8tIVGmNwok5nEQve1pI,70
 resurfemg/__main__.py,sha256=0EiYudOep65jOuzzaev-yuTYrevgwNOLQLbsPNlQr4E,94
-resurfemg/__version__.py,sha256=Jk2iAU7m-7Vx9XV1TtdD9ZoJraIncDq_4_Wd-qtUotg,411
+resurfemg/__version__.py,sha256=HzPz9rq3s1AiZXregKlqKaJJ2wGMtvH_a3V9la9CnpM,411
 resurfemg/cli/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/cli/cli.py,sha256=XLKnrxoFmj2-Li5GOqJreb3jk8tYenn696jQIrIDVp4,5898
 resurfemg/config/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/config/config.py,sha256=-CJHSW6_LJqAQCumOdDhruggOGTmad9XLSCEAfEfJeM,15003
 resurfemg/data_connector/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/data_connector/converter_functions.py,sha256=NJZFP7ULcFMPV6ClClwntZS9L-vWzjU-4pkbxRlb2Nk,6321
 resurfemg/data_connector/tmsisdk_lite.py,sha256=J12cMVXu7OOFuN3XG_aNlkQImacPVMdV_8lQi5wu9uE,9456
 resurfemg/helper_functions/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/helper_functions/helper_functions.py,sha256=zRR8CQi2cUsV8Zlw64YuBhJf5iwaS_vyCOYRTo5M2_o,14374
 resurfemg/machine_learning/ml.py,sha256=iApO8hnoAOdE_LE1h_texCi6RNXuzS18m1AMLmVeJdE,2493
 resurfemg/pipelines/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/pipelines/pipelines.py,sha256=A4ho9kzgpodbGrOZvo77Ij1nqkGSkVyN1_9f2PMyJK4,11709
 resurfemg/postprocessing/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/postprocessing/baseline.py,sha256=nXjmGg2LbAzGHA-MGGVCLvdbQQweTqCQJRNqljVfOIQ,4289
-resurfemg/postprocessing/event_detection.py,sha256=ImtIst0Hhv1AyH3BfQIROTxObBbDap1CtwWmp0KXA9I,5976
+resurfemg/postprocessing/event_detection.py,sha256=UlhKQQKgx2myk0E7gQz-y7RvzVbIw36a-IlcFPtvnmg,7637
 resurfemg/postprocessing/features.py,sha256=_KMg1H3BcpHk2MMLcRq40MkqYz4BWwA0-m-pWKfGFfI,21086
 resurfemg/preprocessing/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/preprocessing/ecg_removal.py,sha256=6anmZbqlVNUyTH_Dp-czEthkX7jzly58dphY-Nofkn8,17468
 resurfemg/preprocessing/envelope.py,sha256=2JECtSLgl53AkZJpot1zFpuTgBVykVZTiU4RS0VdO_A,6250
 resurfemg/preprocessing/filtering.py,sha256=MLp1iXJjkwa5Y7HHG1RtQ0Sd86YOA96jTLmc3YZSuzk,13160
 resurfemg/visualization/__init__.py,sha256=iwhKnzeBJLKxpRVjvzwiRE63_zNpIBfaKLITauVph-0,24
 resurfemg/visualization/visualization.py,sha256=HsZyTicyD9Zf6pHWjXZCRAhxpeYwwl5MannCOw_9UlQ,1411
-resurfemg-0.3.0.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-resurfemg-0.3.0.dist-info/METADATA,sha256=kmS8fVkEHcIxyyQieW1cfzVZI2Nif5xXYrjKRu9xdyQ,18103
-resurfemg-0.3.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-resurfemg-0.3.0.dist-info/top_level.txt,sha256=u30hNTZIkHnbFMEMG0n9CswHMS6bEFL6iqbq1RX6jwU,10
-resurfemg-0.3.0.dist-info/RECORD,,
+resurfemg-0.3.1.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+resurfemg-0.3.1.dist-info/METADATA,sha256=VFNjjPE9LipEp1vZo3V63snbgdyyVGU-R37JgvTniBU,18103
+resurfemg-0.3.1.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+resurfemg-0.3.1.dist-info/top_level.txt,sha256=u30hNTZIkHnbFMEMG0n9CswHMS6bEFL6iqbq1RX6jwU,10
+resurfemg-0.3.1.dist-info/RECORD,,
```

